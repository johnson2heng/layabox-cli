/*! johnson2heng出品，必出精品 */!function(t){var e={};function i(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:a})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=307)}([function(t,e){t.exports=function(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(5),n=i(49),o=i(20);class l{static distanceSquared(t,e){var i=t.x-e.x,a=t.y-e.y,r=t.z-e.z;return i*i+a*a+r*r}static distance(t,e){var i=t.x-e.x,a=t.y-e.y,r=t.z-e.z;return Math.sqrt(i*i+a*a+r*r)}static min(t,e,i){i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y),i.z=Math.min(t.z,e.z)}static max(t,e,i){i.x=Math.max(t.x,e.x),i.y=Math.max(t.y,e.y),i.z=Math.max(t.z,e.z)}static transformQuat(t,e,i){var a=t.x,r=t.y,s=t.z,n=e.x,o=e.y,l=e.z,h=e.w,_=h*a+o*s-l*r,c=h*r+l*a-n*s,d=h*s+n*r-o*a,u=-n*a-o*r-l*s;i.x=_*h+u*-n+c*-l-d*-o,i.y=c*h+u*-o+d*-n-_*-l,i.z=d*h+u*-l+_*-o-c*-n}static scalarLength(t){var e=t.x,i=t.y,a=t.z;return Math.sqrt(e*e+i*i+a*a)}static scalarLengthSquared(t){var e=t.x,i=t.y,a=t.z;return e*e+i*i+a*a}static normalize(t,e){var i=t.x,a=t.y,r=t.z,s=i*i+a*a+r*r;s>0&&(s=1/Math.sqrt(s),e.x=i*s,e.y=a*s,e.z=r*s)}static multiply(t,e,i){i.x=t.x*e.x,i.y=t.y*e.y,i.z=t.z*e.z}static scale(t,e,i){i.x=t.x*e,i.y=t.y*e,i.z=t.z*e}static lerp(t,e,i,a){var r=t.x,s=t.y,n=t.z;a.x=r+i*(e.x-r),a.y=s+i*(e.y-s),a.z=n+i*(e.z-n)}static transformV3ToV3(t,e,i){var a=l._tempVector4;l.transformV3ToV4(t,e,a),i.x=a.x,i.y=a.y,i.z=a.z}static transformV3ToV4(t,e,i){var a=t.x,r=t.y,s=t.z,n=e.elements;i.x=a*n[0]+r*n[4]+s*n[8]+n[12],i.y=a*n[1]+r*n[5]+s*n[9]+n[13],i.z=a*n[2]+r*n[6]+s*n[10]+n[14],i.w=a*n[3]+r*n[7]+s*n[11]+n[15]}static TransformNormal(t,e,i){var a=t.x,r=t.y,s=t.z,n=e.elements;i.x=a*n[0]+r*n[4]+s*n[8],i.y=a*n[1]+r*n[5]+s*n[9],i.z=a*n[2]+r*n[6]+s*n[10]}static transformCoordinate(t,e,i){var a=t.x,r=t.y,s=t.z,n=e.elements,o=a*n[3]+r*n[7]+s*n[11]+n[15];i.x=(a*n[0]+r*n[4]+s*n[8]+n[12])/o,i.y=(a*n[1]+r*n[5]+s*n[9]+n[13])/o,i.z=(a*n[2]+r*n[6]+s*n[10]+n[14])/o}static Clamp(t,e,i,a){var r=t.x,s=t.y,n=t.z,o=e.x,l=e.y,h=e.z,_=i.x,c=i.y,d=i.z;r=(r=r>_?_:r)<o?o:r,s=(s=s>c?c:s)<l?l:s,n=(n=n>d?d:n)<h?h:n,a.x=r,a.y=s,a.z=n}static add(t,e,i){i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z}static subtract(t,e,i){i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z}static cross(t,e,i){var a=t.x,r=t.y,s=t.z,n=e.x,o=e.y,l=e.z;i.x=r*l-s*o,i.y=s*n-a*l,i.z=a*o-r*n}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static equals(t,e){return n.a.nearEqual(t.x,e.x)&&n.a.nearEqual(t.y,e.y)&&n.a.nearEqual(t.z,e.z)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;arguments.length>3&&void 0!==arguments[3]&&arguments[3];r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"z",void 0),this.x=t,this.y=e,this.z=i}setValue(t,e,i){this.x=t,this.y=e,this.z=i}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=t[e+0],this.y=t[e+1],this.z=t[e+2]}cloneTo(t){var e=t;e.x=this.x,e.y=this.y,e.z=this.z}clone(){var t=new l;return this.cloneTo(t),t}toDefault(){this.x=0,this.y=0,this.z=0}forNativeElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t?(this.elements=t,this.elements[0]=this.x,this.elements[1]=this.y,this.elements[2]=this.z):this.elements=new Float32Array([this.x,this.y,this.z]),o.a.rewriteNumProperty(this,"x",0),o.a.rewriteNumProperty(this,"y",1),o.a.rewriteNumProperty(this,"z",2)}}e.a=l,r()(l,"_tempVector4",new s.a),r()(l,"_ZERO",new l(0,0,0)),r()(l,"_ONE",new l(1,1,1)),r()(l,"_NegativeUnitX",new l(-1,0,0)),r()(l,"_UnitX",new l(1,0,0)),r()(l,"_UnitY",new l(0,1,0)),r()(l,"_UnitZ",new l(0,0,1)),r()(l,"_ForwardRH",new l(0,0,-1)),r()(l,"_ForwardLH",new l(0,0,1)),r()(l,"_Up",new l(0,1,0))},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{}e.a=s,r()(s,"ARRAY_BUFFER_TYPE_DATA",0),r()(s,"ARRAY_BUFFER_TYPE_CMD",1),r()(s,"ARRAY_BUFFER_REF_REFERENCE",0),r()(s,"ARRAY_BUFFER_REF_COPY",1),r()(s,"UPLOAD_SHADER_UNIFORM_TYPE_ID",0),r()(s,"UPLOAD_SHADER_UNIFORM_TYPE_DATA",1),r()(s,"instance",void 0),r()(s,"layaGPUInstance",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{static regClass(t){s.__classMap[t.name]=t}}e.a=s,r()(s,"Laya",null),r()(s,"Timer",null),r()(s,"WorkerLoader",null),r()(s,"Dragging",null),r()(s,"GraphicsBounds",null),r()(s,"Sprite",null),r()(s,"TextRender",null),r()(s,"TextAtlas",null),r()(s,"timer",null),r()(s,"systemTimer",null),r()(s,"startTimer",null),r()(s,"updateTimer",null),r()(s,"lateTimer",null),r()(s,"physicsTimer",null),r()(s,"stage",null),r()(s,"Loader",null),r()(s,"loader",null),r()(s,"TTFLoader",null),r()(s,"SoundManager",null),r()(s,"WebAudioSound",null),r()(s,"AudioSound",null),r()(s,"ShaderCompile",null),r()(s,"ClassUtils",null),r()(s,"SceneUtils",null),r()(s,"Context",null),r()(s,"Render",null),r()(s,"MouseManager",null),r()(s,"Text",null),r()(s,"Browser",null),r()(s,"WebGL",null),r()(s,"Pool",null),r()(s,"Utils",null),r()(s,"Graphics",null),r()(s,"Submit",null),r()(s,"Stage",null),r()(s,"Resource",null),r()(s,"__classMap",{})},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{static getPoolBySign(t){return s._poolDic[t]||(s._poolDic[t]=[])}static clearBySign(t){s._poolDic[t]&&(s._poolDic[t].length=0)}static recover(t,e){e[s.POOLSIGN]||(e[s.POOLSIGN]=!0,s.getPoolBySign(t).push(e))}static recoverByClass(t){if(t){var e=t.__className||t.constructor._$gid;e&&s.recover(e,t)}}static _getClassSign(t){var e=t.__className||t._$gid;return e||(t._$gid=e=s._CLSID+"",s._CLSID++),e}static createByClass(t){return s.getItemByClass(s._getClassSign(t),t)}static getItemByClass(t,e){if(!s._poolDic[t])return new e;var i=s.getPoolBySign(t);if(i.length){var a=i.pop();a[s.POOLSIGN]=!1}else a=new e;return a}static getItemByCreateFun(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;var a=s.getPoolBySign(t),r=a.length?a.pop():e.call(i);return r[s.POOLSIGN]=!1,r}static getItem(t){var e=s.getPoolBySign(t),i=e.length?e.pop():null;return i&&(i[s.POOLSIGN]=!1),i}}e.a=s,r()(s,"_CLSID",0),r()(s,"POOLSIGN","__InPool"),r()(s,"_poolDic",{})},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(49),n=i(20);class o{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"z",void 0),r()(this,"w",void 0),this.x=t,this.y=e,this.z=i,this.w=a}setValue(t,e,i,a){this.x=t,this.y=e,this.z=i,this.w=a}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=t[e+0],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3]}cloneTo(t){var e=t;e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w}clone(){var t=new o;return this.cloneTo(t),t}static lerp(t,e,i,a){var r=t.x,s=t.y,n=t.z,o=t.w;a.x=r+i*(e.x-r),a.y=s+i*(e.y-s),a.z=n+i*(e.z-n),a.w=o+i*(e.w-o)}static transformByM4x4(t,e,i){var a=t.x,r=t.y,s=t.z,n=t.w,o=e.elements;i.x=a*o[0]+r*o[4]+s*o[8]+n*o[12],i.y=a*o[1]+r*o[5]+s*o[9]+n*o[13],i.z=a*o[2]+r*o[6]+s*o[10]+n*o[14],i.w=a*o[3]+r*o[7]+s*o[11]+n*o[15]}static equals(t,e){return s.a.nearEqual(Math.abs(t.x),Math.abs(e.x))&&s.a.nearEqual(Math.abs(t.y),Math.abs(e.y))&&s.a.nearEqual(Math.abs(t.z),Math.abs(e.z))&&s.a.nearEqual(Math.abs(t.w),Math.abs(e.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}static normalize(t,e){var i=t.length();if(i>0){var a=1/i;e.x=t.x*a,e.y=t.y*a,e.z=t.z*a,e.w=t.w*a}}static add(t,e,i){i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z,i.w=t.w+e.w}static subtract(t,e,i){i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z,i.w=t.w-e.w}static multiply(t,e,i){i.x=t.x*e.x,i.y=t.y*e.y,i.z=t.z*e.z,i.w=t.w*e.w}static scale(t,e,i){i.x=t.x*e,i.y=t.y*e,i.z=t.z*e,i.w=t.w*e}static Clamp(t,e,i,a){var r=t.x,s=t.y,n=t.z,o=t.w,l=e.x,h=e.y,_=e.z,c=e.w,d=i.x,u=i.y,f=i.z,m=i.w;r=(r=r>d?d:r)<l?l:r,s=(s=s>u?u:s)<h?h:s,n=(n=n>f?f:n)<_?_:n,o=(o=o>m?m:o)<c?c:o,a.x=r,a.y=s,a.z=n,a.w=o}static distanceSquared(t,e){var i=t.x-e.x,a=t.y-e.y,r=t.z-e.z,s=t.w-e.w;return i*i+a*a+r*r+s*s}static distance(t,e){var i=t.x-e.x,a=t.y-e.y,r=t.z-e.z,s=t.w-e.w;return Math.sqrt(i*i+a*a+r*r+s*s)}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w}static min(t,e,i){i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y),i.z=Math.min(t.z,e.z),i.w=Math.min(t.w,e.w)}static max(t,e,i){i.x=Math.max(t.x,e.x),i.y=Math.max(t.y,e.y),i.z=Math.max(t.z,e.z),i.w=Math.max(t.w,e.w)}forNativeElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t?(this.elements=t,this.elements[0]=this.x,this.elements[1]=this.y,this.elements[2]=this.z,this.elements[3]=this.w):this.elements=new Float32Array([this.x,this.y,this.z,this.w]),n.a.rewriteNumProperty(this,"x",0),n.a.rewriteNumProperty(this,"y",1),n.a.rewriteNumProperty(this,"z",2),n.a.rewriteNumProperty(this,"w",3)}}e.a=o,r()(o,"ZERO",new o),r()(o,"ONE",new o(1,1,1,1)),r()(o,"UnitX",new o(1,0,0,0)),r()(o,"UnitY",new o(0,1,0,0)),r()(o,"UnitZ",new o(0,0,1,0)),r()(o,"UnitW",new o(0,0,0,1))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(16),n=i(3);class o{constructor(){r()(this,"type",void 0),r()(this,"nativeEvent",void 0),r()(this,"target",void 0),r()(this,"currentTarget",void 0),r()(this,"_stoped",void 0),r()(this,"touchId",void 0),r()(this,"keyCode",void 0),r()(this,"delta",void 0)}setTo(t,e,i){return this.type=t,this.currentTarget=e,this.target=i,this}stopPropagation(){this._stoped=!0}get touches(){if(!this.nativeEvent)return null;var t=this.nativeEvent.touches;if(t)for(var e=n.a.stage,i=0,a=t.length;i<a;i++){var r=t[i],o=s.a.TEMP;o.setTo(r.clientX,r.clientY),e._canvasTransform.invertTransformPoint(o),e.transform.invertTransformPoint(o),r.stageX=o.x,r.stageY=o.y}return t}get altKey(){return this.nativeEvent.altKey}get ctrlKey(){return this.nativeEvent.ctrlKey}get shiftKey(){return this.nativeEvent.shiftKey}get charCode(){return this.nativeEvent.charCode}get keyLocation(){return this.nativeEvent.location||this.nativeEvent.keyLocation}get stageX(){return n.a.stage.mouseX}get stageY(){return n.a.stage.mouseY}}e.a=o,r()(o,"EMPTY",new o),r()(o,"MOUSE_DOWN","mousedown"),r()(o,"MOUSE_UP","mouseup"),r()(o,"CLICK","click"),r()(o,"RIGHT_MOUSE_DOWN","rightmousedown"),r()(o,"RIGHT_MOUSE_UP","rightmouseup"),r()(o,"RIGHT_CLICK","rightclick"),r()(o,"MOUSE_MOVE","mousemove"),r()(o,"MOUSE_OVER","mouseover"),r()(o,"MOUSE_OUT","mouseout"),r()(o,"MOUSE_WHEEL","mousewheel"),r()(o,"ROLL_OVER","mouseover"),r()(o,"ROLL_OUT","mouseout"),r()(o,"DOUBLE_CLICK","doubleclick"),r()(o,"CHANGE","change"),r()(o,"CHANGED","changed"),r()(o,"RESIZE","resize"),r()(o,"ADDED","added"),r()(o,"REMOVED","removed"),r()(o,"DISPLAY","display"),r()(o,"UNDISPLAY","undisplay"),r()(o,"ERROR","error"),r()(o,"COMPLETE","complete"),r()(o,"LOADED","loaded"),r()(o,"READY","ready"),r()(o,"PROGRESS","progress"),r()(o,"INPUT","input"),r()(o,"RENDER","render"),r()(o,"OPEN","open"),r()(o,"MESSAGE","message"),r()(o,"CLOSE","close"),r()(o,"KEY_DOWN","keydown"),r()(o,"KEY_PRESS","keypress"),r()(o,"KEY_UP","keyup"),r()(o,"FRAME","enterframe"),r()(o,"DRAG_START","dragstart"),r()(o,"DRAG_MOVE","dragmove"),r()(o,"DRAG_END","dragend"),r()(o,"ENTER","enter"),r()(o,"SELECT","select"),r()(o,"BLUR","blur"),r()(o,"FOCUS","focus"),r()(o,"VISIBILITY_CHANGE","visibilitychange"),r()(o,"FOCUS_CHANGE","focuschange"),r()(o,"PLAYED","played"),r()(o,"PAUSED","paused"),r()(o,"STOPPED","stopped"),r()(o,"START","start"),r()(o,"END","end"),r()(o,"COMPONENT_ADDED","componentadded"),r()(o,"COMPONENT_REMOVED","componentremoved"),r()(o,"RELEASED","released"),r()(o,"LINK","link"),r()(o,"LABEL","label"),r()(o,"FULL_SCREEN_CHANGE","fullscreenchange"),r()(o,"DEVICE_LOST","devicelost"),r()(o,"TRANSFORM_CHANGED","transformchanged"),r()(o,"ANIMATION_CHANGED","animationchanged"),r()(o,"TRAIL_FILTER_CHANGE","trailfilterchange"),r()(o,"TRIGGER_ENTER","triggerenter"),r()(o,"TRIGGER_STAY","triggerstay"),r()(o,"TRIGGER_EXIT","triggerexit")},function(t,e,i){"use strict";var a=i(28),r=(i.n(a),i(0)),s=i.n(r),n=i(168),o=i(54),l=i(427),h=i(270);class _{static _getNamesByDefineData(t,e){var i=_._maskMap,a=t._mask;e.length=0;for(var r=0,s=t._length;r<s;r++)for(var n=i[r],o=a[r],l=0;l<32;l++){var h=1<<l;if(o>0&&h>o)break;o&h&&e.push(n[h])}}static getDefineByName(t){var e=_._defineMap[t];if(!e){var i=_._maskMap,a=_._defineCounter,r=Math.floor(a/32),s=1<<a%32;e=new l.a(r,s),_._defineMap[t]=e,r==i.length&&(i.length++,i[r]={}),i[r][s]=t,_._defineCounter++}return e}static propertyNameToID(t){if(null!=_._propertyNameMap[t])return _._propertyNameMap[t];var e=_._propertyNameCounter++;return _._propertyNameMap[t]=e,e}static getAttributeMapByDefine(t,e){var i={};for(var a in e)i[a]=e[a];for(var r=0,s=t.length;r<s;r++){switch(t[r]){case"SIMPLEBONE":e.a_Texcoord1&&(i.a_SimpleTextureParams=e.a_Texcoord1,delete i.a_Texcoord1),i.a_SimpleTextureParams=7}}return i}static addInclude(t,e){e=e.replace(n.a._clearCR,""),n.a.addInclude(t,e)}static compileShaderByDefineNames(t,e,i,a){var r=_.find(t);if(r){var s=r.getSubShaderAt(e);if(s){var n=s._passes[i];if(n){var o=_._compileDefineDatas;o.clear();for(var l=0,h=a.length;l<h;l++)o.add(_.getDefineByName(a[l]));n.withCompile(o)}else console.warn("Shader3D: unknown passIndex.")}else console.warn("Shader3D: unknown subShaderIndex.")}else console.warn("Shader3D: unknown shader name.")}static add(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return _._preCompileShader[t]=new _(t,e,i,a,r)}static find(t){return _._preCompileShader[t]}get name(){return this._name}constructor(t,e,i,a,r){s()(this,"_attributeMap",null),s()(this,"_uniformMap",null),s()(this,"_name",void 0),s()(this,"_enableInstancing",!1),s()(this,"_supportReflectionProbe",!1),s()(this,"_subShaders",[]),this._name=t,this._attributeMap=e,this._uniformMap=i,this._enableInstancing=a,this._supportReflectionProbe=r}addSubShader(t){this._subShaders.push(t),t._owner=this}getSubShaderAt(t){return this._subShaders[t]}static compileShader(t,e,i){var a=_.find(t);if(a){var r=a.getSubShaderAt(e);if(r){var s=r._passes[i];if(s){var n=_._compileDefineDatas,o=n._mask;o.length=0;for(var l=arguments.length,h=new Array(l>3?l-3:0),c=3;c<l;c++)h[c-3]=arguments[c];for(var d=0,u=h.length;d<u;d++)o.push(h[d]);n._length=h.length,s.withCompile(n)}else console.warn("Shader3D: unknown passIndex.")}else console.warn("Shader3D: unknown subShaderIndex.")}else console.warn("Shader3D: unknown shader name.")}}e.a=_,s()(_,"_compileDefineDatas",new o.a),s()(_,"RENDER_STATE_CULL",0),s()(_,"RENDER_STATE_BLEND",1),s()(_,"RENDER_STATE_BLEND_SRC",2),s()(_,"RENDER_STATE_BLEND_DST",3),s()(_,"RENDER_STATE_BLEND_SRC_RGB",4),s()(_,"RENDER_STATE_BLEND_DST_RGB",5),s()(_,"RENDER_STATE_BLEND_SRC_ALPHA",6),s()(_,"RENDER_STATE_BLEND_DST_ALPHA",7),s()(_,"RENDER_STATE_BLEND_CONST_COLOR",8),s()(_,"RENDER_STATE_BLEND_EQUATION",9),s()(_,"RENDER_STATE_BLEND_EQUATION_RGB",10),s()(_,"RENDER_STATE_BLEND_EQUATION_ALPHA",11),s()(_,"RENDER_STATE_DEPTH_TEST",12),s()(_,"RENDER_STATE_DEPTH_WRITE",13),s()(_,"PERIOD_CUSTOM",0),s()(_,"PERIOD_MATERIAL",1),s()(_,"PERIOD_SPRITE",2),s()(_,"PERIOD_CAMERA",3),s()(_,"PERIOD_SCENE",4),s()(_,"SHADERDEFINE_LEGACYSINGALLIGHTING",void 0),s()(_,"SHADERDEFINE_GRAPHICS_API_GLES2",void 0),s()(_,"SHADERDEFINE_GRAPHICS_API_GLES3",void 0),s()(_,"_propertyNameCounter",0),s()(_,"_propertyNameMap",{}),s()(_,"_defineCounter",0),s()(_,"_defineMap",{}),s()(_,"_preCompileShader",{}),s()(_,"_maskMap",[]),s()(_,"_debugShaderVariantInfo",void 0),s()(_,"debugMode",!1),s()(_,"debugShaderVariantCollection",new h.b)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{static show(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;s._StatRender.show(t,e)}static enable(){s._StatRender.enable()}static hide(){s._StatRender.hide()}static clear(){s.trianglesFaces=s.renderBatches=s.savedRenderBatches=s.shaderCall=s.spriteRenderUseCacheCount=s.frustumCulling=s.octreeNodeCulling=s.canvasNormal=s.canvasBitmap=s.canvasReCache=0}static set onclick(t){s._StatRender.set_onclick(t)}}e.a=s,r()(s,"FPS",0),r()(s,"loopCount",0),r()(s,"shaderCall",0),r()(s,"renderBatches",0),r()(s,"savedRenderBatches",0),r()(s,"trianglesFaces",0),r()(s,"spriteCount",0),r()(s,"spriteRenderUseCacheCount",0),r()(s,"frustumCulling",0),r()(s,"octreeNodeCulling",0),r()(s,"canvasNormal",0),r()(s,"canvasBitmap",0),r()(s,"canvasReCache",0),r()(s,"renderSlow",!1),r()(s,"gpuMemory",void 0),r()(s,"cpuMemory",void 0),r()(s,"_fpsStr",void 0),r()(s,"_canvasStr",void 0),r()(s,"_spriteStr",void 0),r()(s,"_fpsData",[]),r()(s,"_timer",0),r()(s,"_count",0),r()(s,"_StatRender",null)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1),n=i(24),o=i(49),l=i(2);class h{static createRotationX(t,e){var i=e.elements,a=Math.sin(t),r=Math.cos(t);i[1]=i[2]=i[3]=i[4]=i[7]=i[8]=i[11]=i[12]=i[13]=i[14]=0,i[0]=i[15]=1,i[5]=i[10]=r,i[6]=a,i[9]=-a}static createRotationY(t,e){var i=e.elements,a=Math.sin(t),r=Math.cos(t);i[1]=i[3]=i[4]=i[6]=i[7]=i[9]=i[11]=i[12]=i[13]=i[14]=0,i[5]=i[15]=1,i[0]=i[10]=r,i[2]=-a,i[8]=a}static createRotationZ(t,e){var i=e.elements,a=Math.sin(t),r=Math.cos(t);i[2]=i[3]=i[6]=i[7]=i[8]=i[9]=i[11]=i[12]=i[13]=i[14]=0,i[10]=i[15]=1,i[0]=i[5]=r,i[1]=a,i[4]=-a}static createRotationYawPitchRoll(t,e,i,a){n.a.createFromYawPitchRoll(t,e,i,h._tempQuaternion),h.createRotationQuaternion(h._tempQuaternion,a)}static createRotationAxis(t,e,i){var a=t.x,r=t.y,s=t.z,n=Math.cos(e),o=Math.sin(e),l=a*a,h=r*r,_=s*s,c=a*r,d=a*s,u=r*s,f=i.elements;f[3]=f[7]=f[11]=f[12]=f[13]=f[14]=0,f[15]=1,f[0]=l+n*(1-l),f[1]=c-n*c+o*s,f[2]=d-n*d-o*r,f[4]=c-n*c-o*s,f[5]=h+n*(1-h),f[6]=u-n*u+o*a,f[8]=d-n*d+o*r,f[9]=u-n*u-o*a,f[10]=_+n*(1-_)}setRotation(t){var e=t.x,i=t.y,a=t.z,r=t.w,s=e*e,n=i*i,o=a*a,l=e*i,h=a*r,_=a*e,c=i*r,d=i*a,u=e*r,f=this.elements;f[0]=1-2*(n+o),f[1]=2*(l+h),f[2]=2*(_-c),f[4]=2*(l-h),f[5]=1-2*(o+s),f[6]=2*(d+u),f[8]=2*(_+c),f[9]=2*(d-u),f[10]=1-2*(n+s)}setPosition(t){var e=this.elements;e[12]=t.x,e[13]=t.y,e[14]=t.z}static createRotationQuaternion(t,e){var i=e.elements,a=t.x,r=t.y,s=t.z,n=t.w,o=a*a,l=r*r,h=s*s,_=a*r,c=s*n,d=s*a,u=r*n,f=r*s,m=a*n;i[3]=i[7]=i[11]=i[12]=i[13]=i[14]=0,i[15]=1,i[0]=1-2*(l+h),i[1]=2*(_+c),i[2]=2*(d-u),i[4]=2*(_-c),i[5]=1-2*(h+o),i[6]=2*(f+m),i[8]=2*(d+u),i[9]=2*(f-m),i[10]=1-2*(l+o)}static createTranslate(t,e){var i=e.elements;i[4]=i[8]=i[1]=i[9]=i[2]=i[6]=i[3]=i[7]=i[11]=0,i[0]=i[5]=i[10]=i[15]=1,i[12]=t.x,i[13]=t.y,i[14]=t.z}static createScaling(t,e){var i=e.elements;i[0]=t.x,i[5]=t.y,i[10]=t.z,i[1]=i[4]=i[8]=i[12]=i[9]=i[13]=i[2]=i[6]=i[14]=i[3]=i[7]=i[11]=0,i[15]=1}static multiply(t,e,i){var a=e.elements,r=t.elements,s=i.elements,n=a[0],o=a[1],l=a[2],h=a[3],_=a[4],c=a[5],d=a[6],u=a[7],f=a[8],m=a[9],p=a[10],g=a[11],v=a[12],T=a[13],E=a[14],S=a[15],R=r[0],x=r[1],A=r[2],y=r[3],I=r[4],C=r[5],M=r[6],D=r[7],b=r[8],L=r[9],O=r[10],P=r[11],N=r[12],w=r[13],B=r[14],F=r[15];s[0]=n*R+o*I+l*b+h*N,s[1]=n*x+o*C+l*L+h*w,s[2]=n*A+o*M+l*O+h*B,s[3]=n*y+o*D+l*P+h*F,s[4]=_*R+c*I+d*b+u*N,s[5]=_*x+c*C+d*L+u*w,s[6]=_*A+c*M+d*O+u*B,s[7]=_*y+c*D+d*P+u*F,s[8]=f*R+m*I+p*b+g*N,s[9]=f*x+m*C+p*L+g*w,s[10]=f*A+m*M+p*O+g*B,s[11]=f*y+m*D+p*P+g*F,s[12]=v*R+T*I+E*b+S*N,s[13]=v*x+T*C+E*L+S*w,s[14]=v*A+T*M+E*O+S*B,s[15]=v*y+T*D+E*P+S*F}static multiplyForNative(t,e,i){l.a.instance.matrix4x4Multiply(t.elements,e.elements,i.elements)}static createFromQuaternion(t,e){var i=e.elements,a=t.x,r=t.y,s=t.z,n=t.w,o=a+a,l=r+r,h=s+s,_=a*o,c=r*o,d=r*l,u=s*o,f=s*l,m=s*h,p=n*o,g=n*l,v=n*h;i[0]=1-d-m,i[1]=c+v,i[2]=u-g,i[3]=0,i[4]=c-v,i[5]=1-_-m,i[6]=f+p,i[7]=0,i[8]=u+g,i[9]=f-p,i[10]=1-_-d,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1}static createAffineTransformation(t,e,i,a){var r=a.elements,s=e.x,n=e.y,o=e.z,l=e.w,h=s+s,_=n+n,c=o+o,d=s*h,u=s*_,f=s*c,m=n*_,p=n*c,g=o*c,v=l*h,T=l*_,E=l*c,S=i.x,R=i.y,x=i.z;r[0]=(1-(m+g))*S,r[1]=(u+E)*S,r[2]=(f-T)*S,r[3]=0,r[4]=(u-E)*R,r[5]=(1-(d+g))*R,r[6]=(p+v)*R,r[7]=0,r[8]=(f+T)*x,r[9]=(p-v)*x,r[10]=(1-(d+m))*x,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1}static createLookAt(t,e,i,a){var r=a.elements,n=h._tempVector0,o=h._tempVector1,l=h._tempVector2;s.a.subtract(t,e,l),s.a.normalize(l,l),s.a.cross(i,l,n),s.a.normalize(n,n),s.a.cross(l,n,o),r[3]=r[7]=r[11]=0,r[15]=1,r[0]=n.x,r[4]=n.y,r[8]=n.z,r[1]=o.x,r[5]=o.y,r[9]=o.z,r[2]=l.x,r[6]=l.y,r[10]=l.z,r[12]=-s.a.dot(n,t),r[13]=-s.a.dot(o,t),r[14]=-s.a.dot(l,t)}static createPerspective(t,e,i,a,r){var s=1/Math.tan(.5*t),n=i/(s/e),o=i/s;h.createPerspectiveOffCenter(-n,n,-o,o,i,a,r)}static createPerspectiveOffCenter(t,e,i,a,r,s,n){var o=n.elements,l=s/(s-r);o[1]=o[2]=o[3]=o[4]=o[6]=o[7]=o[12]=o[13]=o[15]=0,o[0]=2*r/(e-t),o[5]=2*r/(a-i),o[8]=(t+e)/(e-t),o[9]=(a+i)/(a-i),o[10]=-l,o[11]=-1,o[14]=-r*l}static createOrthoOffCenter(t,e,i,a,r,s,n){var o=n.elements,l=1/(s-r);o[1]=o[2]=o[3]=o[4]=o[6]=o[8]=o[7]=o[9]=o[11]=0,o[15]=1,o[0]=2/(e-t),o[5]=2/(a-i),o[10]=-l,o[12]=(t+e)/(t-e),o[13]=(a+i)/(i-a),o[14]=-r*l}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,_=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,u=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,f=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,m=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,p=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1,g=arguments.length>16&&void 0!==arguments[16]?arguments[16]:null;r()(this,"elements",void 0);var v=this.elements=g||new Float32Array(16);v[0]=t,v[1]=e,v[2]=i,v[3]=a,v[4]=s,v[5]=n,v[6]=o,v[7]=l,v[8]=h,v[9]=_,v[10]=c,v[11]=d,v[12]=u,v[13]=f,v[14]=m,v[15]=p}getElementByRowColumn(t,e){if(t<0||t>3)throw new Error("row Rows and columns for matrices run from 0 to 3, inclusive.");if(e<0||e>3)throw new Error("column Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*t+e]}setElementByRowColumn(t,e,i){if(t<0||t>3)throw new Error("row Rows and columns for matrices run from 0 to 3, inclusive.");if(e<0||e>3)throw new Error("column Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*t+e]=i}equalsOtherMatrix(t){var e=this.elements,i=t.elements;return o.a.nearEqual(e[0],i[0])&&o.a.nearEqual(e[1],i[1])&&o.a.nearEqual(e[2],i[2])&&o.a.nearEqual(e[3],i[3])&&o.a.nearEqual(e[4],i[4])&&o.a.nearEqual(e[5],i[5])&&o.a.nearEqual(e[6],i[6])&&o.a.nearEqual(e[7],i[7])&&o.a.nearEqual(e[8],i[8])&&o.a.nearEqual(e[9],i[9])&&o.a.nearEqual(e[10],i[10])&&o.a.nearEqual(e[11],i[11])&&o.a.nearEqual(e[12],i[12])&&o.a.nearEqual(e[13],i[13])&&o.a.nearEqual(e[14],i[14])&&o.a.nearEqual(e[15],i[15])}decomposeTransRotScale(t,e,i){var a=h._tempMatrix4x4;return this.decomposeTransRotMatScale(t,a,i)?(n.a.createFromMatrix4x4(a,e),!0):(e.identity(),!1)}decomposeTransRotMatScale(t,e,i){var a=this.elements,r=t,n=e.elements,l=i;r.x=a[12],r.y=a[13],r.z=a[14];var _=a[0],c=a[1],d=a[2],u=a[4],f=a[5],m=a[6],p=a[8],g=a[9],v=a[10],T=l.x=Math.sqrt(_*_+c*c+d*d),E=l.y=Math.sqrt(u*u+f*f+m*m),S=l.z=Math.sqrt(p*p+g*g+v*v);if(o.a.isZero(T)||o.a.isZero(E)||o.a.isZero(S))return n[1]=n[2]=n[3]=n[4]=n[6]=n[7]=n[8]=n[9]=n[11]=n[12]=n[13]=n[14]=0,n[0]=n[5]=n[10]=n[15]=1,!1;var R=h._tempVector0;R.x=p/S,R.y=g/S,R.z=v/S;var x=h._tempVector1;x.x=_/T,x.y=c/T,x.z=d/T;var A=h._tempVector2;s.a.cross(R,x,A);var y=h._tempVector1;return s.a.cross(A,R,y),n[3]=n[7]=n[11]=n[12]=n[13]=n[14]=0,n[15]=1,n[0]=y.x,n[1]=y.y,n[2]=y.z,n[4]=A.x,n[5]=A.y,n[6]=A.z,n[8]=R.x,n[9]=R.y,n[10]=R.z,n[0]*_+n[1]*c+n[2]*d<0&&(l.x=-T),n[4]*u+n[5]*f+n[6]*m<0&&(l.y=-E),n[8]*p+n[9]*g+n[10]*v<0&&(l.z=-S),!0}decomposeYawPitchRoll(t){var e=Math.asin(-this.elements[9]);t.y=e,Math.cos(e)>o.a.zeroTolerance?(t.z=Math.atan2(this.elements[1],this.elements[5]),t.x=Math.atan2(this.elements[8],this.elements[10])):(t.z=Math.atan2(-this.elements[4],this.elements[0]),t.x=0)}normalize(){var t=this.elements,e=t[0],i=t[1],a=t[2],r=Math.sqrt(e*e+i*i+a*a);if(!r)return t[0]=0,t[1]=0,void(t[2]=0);1!=r&&(r=1/r,t[0]=e*r,t[1]=i*r,t[2]=a*r)}transpose(){var t,e;return e=(t=this.elements)[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}invert(t){var e=this.elements,i=t.elements,a=e[0],r=e[1],s=e[2],n=e[3],o=e[4],l=e[5],h=e[6],_=e[7],c=e[8],d=e[9],u=e[10],f=e[11],m=e[12],p=e[13],g=e[14],v=e[15],T=a*l-r*o,E=a*h-s*o,S=a*_-n*o,R=r*h-s*l,x=r*_-n*l,A=s*_-n*h,y=c*p-d*m,I=c*g-u*m,C=c*v-f*m,M=d*g-u*p,D=d*v-f*p,b=u*v-f*g,L=T*b-E*D+S*M+R*C-x*I+A*y;0!==Math.abs(L)&&(L=1/L,i[0]=(l*b-h*D+_*M)*L,i[1]=(s*D-r*b-n*M)*L,i[2]=(p*A-g*x+v*R)*L,i[3]=(u*x-d*A-f*R)*L,i[4]=(h*C-o*b-_*I)*L,i[5]=(a*b-s*C+n*I)*L,i[6]=(g*S-m*A-v*E)*L,i[7]=(c*A-u*S+f*E)*L,i[8]=(o*D-l*C+_*y)*L,i[9]=(r*C-a*D-n*y)*L,i[10]=(m*x-p*S+v*T)*L,i[11]=(d*S-c*x-f*T)*L,i[12]=(l*I-o*M-h*y)*L,i[13]=(a*M-r*I+s*y)*L,i[14]=(p*E-m*R-g*T)*L,i[15]=(c*R-d*E+u*T)*L)}static billboard(t,e,i,a,r,n){s.a.subtract(t,e,h._tempVector0);var l=s.a.scalarLengthSquared(h._tempVector0);o.a.isZero(l)?(s.a.scale(r,-1,h._tempVector1),h._tempVector1.cloneTo(h._tempVector0)):s.a.scale(h._tempVector0,1/Math.sqrt(l),h._tempVector0),s.a.cross(a,h._tempVector0,h._tempVector2),s.a.normalize(h._tempVector2,h._tempVector2),s.a.cross(h._tempVector0,h._tempVector2,h._tempVector3);var _=h._tempVector2,c=h._tempVector3,d=h._tempVector0,u=t,f=n.elements;f[0]=_.x,f[1]=_.y,f[2]=_.z,f[3]=0,f[4]=c.x,f[5]=c.y,f[6]=c.z,f[7]=0,f[8]=d.x,f[9]=d.y,f[10]=d.z,f[11]=0,f[12]=u.x,f[13]=u.y,f[14]=u.z,f[15]=1}identity(){var t=this.elements;t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1}cloneTo(t){var e,i,a;if((i=this.elements)!==(a=t.elements))for(e=0;e<16;++e)a[e]=i[e]}clone(){var t=new h;return this.cloneTo(t),t}static translation(t,e){var i=e.elements;i[0]=i[5]=i[10]=i[15]=1,i[12]=t.x,i[13]=t.y,i[14]=t.z}getTranslationVector(t){var e=this.elements;t.x=e[12],t.y=e[13],t.z=e[14]}setTranslationVector(t){var e=this.elements,i=t;e[12]=i.x,e[13]=i.y,e[14]=i.z}getForward(t){var e=this.elements;t.x=-e[8],t.y=-e[9],t.z=-e[10]}setForward(t){var e=this.elements;e[8]=-t.x,e[9]=-t.y,e[10]=-t.z}getInvertFront(){this.decomposeTransRotScale(h._tempVector0,h._tempQuaternion,h._tempVector1);var t=h._tempVector1,e=t.x<0;return t.y<0&&(e=!e),t.z<0&&(e=!e),e}}e.a=h,r()(h,"_tempMatrix4x4",new h),r()(h,"TEMPMatrix0",new h),r()(h,"TEMPMatrix1",new h),r()(h,"_tempVector0",new s.a),r()(h,"_tempVector1",new s.a),r()(h,"_tempVector2",new s.a),r()(h,"_tempVector3",new s.a),r()(h,"_tempQuaternion",new n.a),r()(h,"DEFAULT",new h),r()(h,"ZERO",new h(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(3),n=i(2);class o{static __init__(){var t=n.a.instance;o._depthFunc=t.LESS,o._blendEquation=t.FUNC_ADD,o._blendEquationRGB=t.FUNC_ADD,o._blendEquationAlpha=t.FUNC_ADD,o._sFactor=t.ONE,o._dFactor=t.ZERO,o._sFactorAlpha=t.ONE,o._dFactorAlpha=t.ZERO,o._activedTextureID=t.TEXTURE0,o._glTextureIDs=[t.TEXTURE0,t.TEXTURE1,t.TEXTURE2,t.TEXTURE3,t.TEXTURE4,t.TEXTURE5,t.TEXTURE6,t.TEXTURE7]}static useProgram(t,e){return o._useProgram!==e&&(t.useProgram(e),o._useProgram=e,!0)}static setDepthTest(t,e){e!==o._depthTest&&(o._depthTest=e,e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST))}static setDepthMask(t,e){e!==o._depthMask&&(o._depthMask=e,t.depthMask(e))}static setDepthFunc(t,e){e!==o._depthFunc&&(o._depthFunc=e,t.depthFunc(e))}static setBlend(t,e){e!==o._blend&&(o._blend=e,e?t.enable(t.BLEND):t.disable(t.BLEND))}static setBlendEquation(t,e){e!==o._blendEquation&&(o._blendEquation=e,o._blendEquationRGB=o._blendEquationAlpha=null,t.blendEquation(e))}static setBlendEquationSeparate(t,e,i){e===o._blendEquationRGB&&i===o._blendEquationAlpha||(o._blendEquationRGB=e,o._blendEquationAlpha=i,o._blendEquation=null,t.blendEquationSeparate(e,i))}static setBlendFunc(t,e,i){(arguments.length>3&&void 0!==arguments[3]&&arguments[3]||e!==o._sFactor||i!==o._dFactor)&&(o._sFactor=e,o._dFactor=i,o._sFactorRGB=null,o._dFactorRGB=null,o._sFactorAlpha=null,o._dFactorAlpha=null,t.blendFunc(e,i))}static setBlendFuncSeperate(t,e,i,a,r){e===o._sFactorRGB&&i===o._dFactorRGB&&a===o._sFactorAlpha&&r===o._dFactorAlpha||(o._sFactorRGB=e,o._dFactorRGB=i,o._sFactorAlpha=a,o._dFactorAlpha=r,o._sFactor=null,o._dFactor=null,t.blendFuncSeparate(e,i,a,r))}static setCullFace(t,e){e!==o._cullFace&&(o._cullFace=e,e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE))}static setFrontFace(t,e){e!==o._frontFace&&(o._frontFace=e,t.frontFace(e))}static activeTexture(t,e){o._activedTextureID!==e&&(t.activeTexture(e),o._activedTextureID=e)}static bindTexture(t,e,i){o._activeTextures[o._activedTextureID-t.TEXTURE0]!==i&&(t.bindTexture(e,i),o._activeTextures[o._activedTextureID-t.TEXTURE0]=i)}static __init_native(){if(s.a.Render.supportWebGLPlusRendering){var t=o;t.activeTexture=t.activeTextureForNative,t.bindTexture=t.bindTextureForNative}}static useProgramForNative(t,e){return t.useProgram(e),!0}static setDepthTestForNative(t,e){e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)}static setDepthMaskForNative(t,e){t.depthMask(e)}static setDepthFuncForNative(t,e){t.depthFunc(e)}static setBlendForNative(t,e){e?t.enable(t.BLEND):t.disable(t.BLEND)}static setBlendFuncForNative(t,e,i){t.blendFunc(e,i)}static setCullFaceForNative(t,e){e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE)}static setFrontFaceForNative(t,e){t.frontFace(e)}static activeTextureForNative(t,e){t.activeTexture(e)}static bindTextureForNative(t,e,i){t.bindTexture(e,i)}static bindVertexArrayForNative(t,e){t.bindVertexArray(e)}}e.a=o,r()(o,"_activeTextures",new Array(8)),r()(o,"_useProgram",null),r()(o,"_depthTest",!0),r()(o,"_depthMask",!0),r()(o,"_depthFunc",void 0),r()(o,"_blend",!1),r()(o,"_blendEquation",void 0),r()(o,"_blendEquationRGB",void 0),r()(o,"_blendEquationAlpha",void 0),r()(o,"_sFactor",void 0),r()(o,"_dFactor",void 0),r()(o,"_sFactorRGB",void 0),r()(o,"_dFactorRGB",void 0),r()(o,"_sFactorAlpha",void 0),r()(o,"_dFactorAlpha",void 0),r()(o,"_cullFace",!1),r()(o,"_frontFace",void 0),r()(o,"_activedTextureID",void 0),r()(o,"_glTextureIDs",void 0),r()(o,"mainContext",null)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{}e.a=s,r()(s,"Shader3D",null),r()(s,"Scene3D",null),r()(s,"MeshRenderStaticBatchManager",null),r()(s,"MeshRenderDynamicBatchManager",null),r()(s,"SubMeshDynamicBatch",null),r()(s,"Laya3D",null),r()(s,"Matrix4x4",null),r()(s,"Physics3D",null),r()(s,"ShadowLightType",null)},function(t,e,i){"use strict";var a=i(28),r=(i.n(a),i(18)),s=(i.n(r),i(0)),n=i.n(s),o=i(3),l=i(366),h=i(120),_=i(6),c=i(23),d=i(244),u=i(46),f=i(48),m=i(42),p=i(19),g=i(90),v=i(43),T=i(21),E=i(367),S=i(246),R=i(27),x=i(60),A=i(80);class y extends c.a{constructor(){super(...arguments),n()(this,"_data",void 0),n()(this,"_url",void 0),n()(this,"_type",void 0),n()(this,"_cache",void 0),n()(this,"_http",void 0),n()(this,"_useWorkerLoader",void 0),n()(this,"_customParse",!1),n()(this,"_constructParams",void 0),n()(this,"_propertyParams",void 0),n()(this,"_createCache",void 0),n()(this,"_originType",void 0)}static getTypeFromUrl(t){var e=T.a.getFileExtension(t);return e?y.typeMap[e]:(console.warn("Not recognize the resources suffix",t),"text")}load(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:o.a.WorkerLoader.enable;if(t){var n;if(y.setGroup(t,"666"),this._url=t,0===t.indexOf("data:image")?e=y.IMAGE:t=R.a.formatURL(t),this._type=e||(e=y.getTypeFromUrl(this._url)),this._cache=i,this._useWorkerLoader=s,this._data=null,s&&o.a.WorkerLoader.enableWorkerLoader(),n=e==y.IMAGE?y.textureMap[t]:y.loadedMap[t],!r&&n)return this._data=n,this.event(_.a.PROGRESS,1),void this.event(_.a.COMPLETE,this._data);if(a&&y.setGroup(t,a),null!=y.parserMap[e])return this._customParse=!0,void(y.parserMap[e]instanceof v.a?y.parserMap[e].runWith(this):y.parserMap[e].call(null,this));this._loadResourceFilter(e,t)}else this.onLoaded(null)}_loadResourceFilter(t,e){this._loadResource(t,e)}_loadResource(t,e){switch(t){case y.IMAGE:case"htmlimage":case"nativeimage":this._loadImage(e);break;case y.SOUND:this._loadSound(e);break;case y.TTF:this._loadTTF(e);break;case y.ATLAS:case y.PREFAB:case y.PLF:this._loadHttpRequestWhat(e,y.JSON);break;case y.FONT:this._loadHttpRequestWhat(e,y.XML);break;case y.PLFB:this._loadHttpRequestWhat(e,y.BUFFER);break;default:this._loadHttpRequestWhat(e,t)}}_loadHttpRequest(t,e,i,a,r,s,n,o){p.a.onVVMiniGame||p.a.onHWMiniGame?this._http=new S.a:this._http||(this._http=new S.a),s&&this._http.on(_.a.PROGRESS,r,s),a&&this._http.on(_.a.COMPLETE,i,a),this._http.on(_.a.ERROR,n,o),this._http.send(t,null,"get",e)}_loadHtmlImage(t,e,i,a,r){var s;function n(){var e=s;e.onload=null,e.onerror=null,delete y._imgCache[t]}(s=new p.a.window.Image).crossOrigin="",s.onload=function(){n(),i.call(e,s)},s.onerror=function(){n(),r.call(a)},s.src=t,y._imgCache[t]=s}_loadHttpRequestWhat(t,e){y.preLoadedMap[t]?this.onLoaded(y.preLoadedMap[t]):this._loadHttpRequest(t,e,this,this.onLoaded,this,this.onProgress,this,this.onError)}_loadTTF(t){t=R.a.formatURL(t);var e=new o.a.TTFLoader;e.complete=v.a.create(this,this.onLoaded),e.load(t)}_loadImage(t){var e=this;(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&(t=R.a.formatURL(t));var i=function(){e.event(_.a.ERROR,"Load image failed")};if("nativeimage"===this._type)this._loadHtmlImage(t,this,this.onLoaded,this,i);else{var a=T.a.getFileExtension(t);"ktx"===a||"pvr"===a?this._loadHttpRequest(t,y.BUFFER,this,this.onLoaded,this,this.onProgress,this,this.onError):this._loadHtmlImage(t,this,this.onLoaded,this,i)}}_loadSound(t){var e=new d.a._soundClass,i=this;function a(){e.offAll()}e.on(_.a.COMPLETE,this,function(){a(),i.onLoaded(e)}),e.on(_.a.ERROR,this,function(){a(),e.dispose(),i.event(_.a.ERROR,"Load sound failed")}),e.load(t)}onProgress(t){this._type===y.ATLAS?this.event(_.a.PROGRESS,.3*t):this._originType==y.HIERARCHY?this.event(_.a.PROGRESS,t/3):this.event(_.a.PROGRESS,t)}onError(t){this.event(_.a.ERROR,t)}onLoaded(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;var e=this._type;if(e==y.PLFB)this.parsePLFBData(t),this.complete(t);else if(e==y.PLF)this.parsePLFData(t),this.complete(t);else if(e===y.IMAGE){let e;if(t instanceof ArrayBuffer){let i;switch(g=T.a.getFileExtension(this._url)){case"ktx":i=x.a.ETC1RGB;break;case"pvr":i=x.a.PVRTCRGBA_4BPPV;break;default:return void console.error("unknown format",g)}(e=new m.a(0,0,i,!1,!1)).wrapModeU=A.a.Clamp,e.wrapModeV=A.a.Clamp,e.setCompressData(t),e._setCreateURL(this.url)}else t instanceof m.a?e=t:((e=new m.a(t.width,t.height,1,!1,!1)).wrapModeU=A.a.Clamp,e.wrapModeV=A.a.Clamp,e.loadImageSource(t,!0),e._setCreateURL(t.src));var i=new f.a(e);i.url=this._url,this.complete(i)}else if(e===y.SOUND||"nativeimage"===e)this.complete(t);else if("htmlimage"===e){let e=new m.a(t.width,t.height,1,!1,!1);e.wrapModeU=A.a.Clamp,e.wrapModeV=A.a.Clamp,e.loadImageSource(t,!0),e._setCreateURL(t.src),this.complete(e)}else if(e===y.ATLAS){if(t.frames){var a=[];if(!this._data){if(this._data=t,t.meta&&t.meta.image){a=t.meta.image.split(",");var r=this._url.indexOf("/")>=0?"/":"\\",s=this._url.lastIndexOf(r),n=s>=0?this._url.substr(0,s+1):"",o=null;p.a.onAndroid&&t.meta.compressTextureAndroid&&(o=".ktx"),p.a.onIOS&&t.meta.compressTextureIOS&&(o=".pvr");for(var c=0,d=a.length;c<d;c++)a[c]=o?n+a[c].replace(".png",o):n+a[c]}else a=[this._url.replace(".json",".png")];a.reverse(),t.toLoads=a,t.pics=[]}return this.event(_.a.PROGRESS,.3+1/a.length*.6),this._loadResourceFilter(y.IMAGE,R.a.formatURL(a.pop()))}if(!(t instanceof m.a))if(t instanceof ArrayBuffer){let e=this._http.url;var g;let i;switch(g=T.a.getFileExtension(e)){case"ktx":i=x.a.ETC1RGB;break;case"pvr":i=x.a.PVRTCRGBA_4BPPV;break;default:return void console.error("unknown format",g)}let a=new m.a(0,0,i,!1,!1);a.wrapModeU=A.a.Clamp,a.wrapModeV=A.a.Clamp,a.setCompressData(t),a._setCreateURL(e),t=a}else{let e=new m.a(t.width,t.height,1,!1,!1);e.wrapModeU=u.a.WARPMODE_CLAMP,e.wrapModeV=u.a.WARPMODE_CLAMP,e.loadImageSource(t,!0),e._setCreateURL(t.src),t=e}if(this._data.pics.push(t),this._data.toLoads.length>0)return this.event(_.a.PROGRESS,.3+1/this._data.toLoads.length*.6),this._loadResourceFilter(y.IMAGE,this._data.toLoads.pop());var v=this._data.frames,S=this._url.split("?")[0],I=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:S.substring(0,S.lastIndexOf("."))+"/",C=this._data.pics,M=R.a.formatURL(this._url),D=y.atlasMap[M]||(y.atlasMap[M]=[]);D.dir=I;var b=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var L in b=parseFloat(this._data.meta.scale),v){var O,P=v[L],N=C[P.frame.idx?P.frame.idx:0],w=R.a.formatURL(I+L);N.scaleRate=b,O=f.a._create(N,P.frame.x,P.frame.y,P.frame.w,P.frame.h,P.spriteSourceSize.x,P.spriteSourceSize.y,P.sourceSize.w,P.sourceSize.h,y.getRes(w)),y.cacheTexture(w,O),O.url=w,D.push(w)}else for(L in v)N=C[(P=v[L]).frame.idx?P.frame.idx:0],w=R.a.formatURL(I+L),O=f.a._create(N,P.frame.x,P.frame.y,P.frame.w,P.frame.h,P.spriteSourceSize.x,P.spriteSourceSize.y,P.sourceSize.w,P.sourceSize.h,y.getRes(w)),y.cacheTexture(w,O),O.url=w,D.push(w);delete this._data.pics,this.complete(this._data)}else if(e===y.FONT){if(!t._source)return this._data=t,this.event(_.a.PROGRESS,.5),this._loadResourceFilter(y.IMAGE,this._url.replace(".fnt",".png"));var B=new E.a;B.parseFont(this._data,new f.a(t));var F=this._url.split(".fnt")[0].split("/"),V=F[F.length-1];h.a.registerBitmapFont(V,B),this._data=B,this.complete(this._data)}else if(e===y.PREFAB){var U=new l.a;U.json=t,this.complete(U)}else this.complete(t)}parsePLFData(t){var e,i,a;for(e in t)switch(a=t[e],e){case"json":case"text":for(i in a)y.preLoadedMap[R.a.formatURL(i)]=a[i];break;default:for(i in a)y.preLoadedMap[R.a.formatURL(i)]=a[i]}}parsePLFBData(t){var e,i,a;for(a=(e=new g.a(t)).getInt32(),i=0;i<a;i++)this.parseOnePLFBFile(e)}parseOnePLFBFile(t){var e,i,a;i=t.getUTFString(),e=t.getInt32(),a=t.readArrayBuffer(e),y.preLoadedMap[R.a.formatURL(i)]=a}complete(t){this._data=t,this._customParse?this.event(_.a.LOADED,t instanceof Array?[t]:t):(y._loaders.push(this),y._isWorking||y.checkNext())}static checkNext(){y._isWorking=!0;for(var t=p.a.now();y._startIndex<y._loaders.length;)if(y._loaders[y._startIndex].endLoad(),y._startIndex++,p.a.now()-t>y.maxTimeOut)return console.warn("loader callback cost a long time:"+(p.a.now()-t)+" url="+y._loaders[y._startIndex-1].url),void o.a.systemTimer.frameOnce(1,null,y.checkNext);y._loaders.length=0,y._startIndex=0,y._isWorking=!1}endLoad(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t&&(this._data=t),this._cache&&y.cacheRes(this._url,this._data),this.event(_.a.PROGRESS,1),this.event(_.a.COMPLETE,this.data instanceof Array?[this.data]:this.data)}get url(){return this._url}get type(){return this._type}get cache(){return this._cache}get data(){return this._data}static clearRes(t){t=R.a.formatURL(t);var e=y.getAtlas(t);if(e){for(var i=0,a=e.length;i<a;i++){var r=e[i],s=y.getRes(r);delete y.textureMap[r],s&&s.destroy()}e.length=0,delete y.atlasMap[t]}var n=y.textureMap[t];n&&(n.destroy(),delete y.textureMap[t]),y.loadedMap[t]&&delete y.loadedMap[t]}static clearTextureRes(t){t=R.a.formatURL(t);var e=y.getAtlas(t);if(e&&e.length>0)e.forEach(function(t){var e=y.getRes(t);e instanceof f.a&&e.disposeBitmap()});else{var i=y.getRes(t);i instanceof f.a&&i.disposeBitmap()}}static getRes(t){var e=y.textureMap[R.a.formatURL(t)];return e||y.loadedMap[R.a.formatURL(t)]}static getAtlas(t){return y.atlasMap[R.a.formatURL(t)]}static cacheRes(t,e){t=R.a.formatURL(t),null!=y.loadedMap[t]?console.warn("Resources already exist,is repeated loading:",t):e instanceof f.a?(y.loadedMap[t]=e.bitmap,y.textureMap[t]=e):y.loadedMap[t]=e}static cacheTexture(t,e){t=R.a.formatURL(t),null!=y.textureMap[t]?console.warn("Resources already exist,is repeated loading:",t):y.textureMap[t]=e}static setGroup(t,e){y.groupMap[e]||(y.groupMap[e]=[]),y.groupMap[e].push(t)}static clearResByGroup(t){if(y.groupMap[t]){var e,i=y.groupMap[t],a=i.length;for(e=0;e<a;e++)y.clearRes(i[e]);i.length=0}}}e.a=y,n()(y,"TEXT","text"),n()(y,"JSON","json"),n()(y,"PREFAB","prefab"),n()(y,"XML","xml"),n()(y,"BUFFER","arraybuffer"),n()(y,"IMAGE","image"),n()(y,"SOUND","sound"),n()(y,"ATLAS","atlas"),n()(y,"FONT","font"),n()(y,"TTF","ttf"),n()(y,"PLF","plf"),n()(y,"PLFB","plfb"),n()(y,"HIERARCHY","HIERARCHY"),n()(y,"MESH","MESH"),n()(y,"MATERIAL","MATERIAL"),n()(y,"TEXTURE2D","TEXTURE2D"),n()(y,"TEXTURECUBE","TEXTURECUBE"),n()(y,"ANIMATIONCLIP","ANIMATIONCLIP"),n()(y,"AVATAR","AVATAR"),n()(y,"TERRAINHEIGHTDATA","TERRAINHEIGHTDATA"),n()(y,"TERRAINRES","TERRAIN"),n()(y,"typeMap",{ttf:"ttf",png:"image",jpg:"image",jpeg:"image",ktx:"image",pvr:"image",txt:"text",json:"json",prefab:"prefab",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",plf:"plf",plfb:"plfb",scene:"json",ani:"json",sk:"arraybuffer"}),n()(y,"parserMap",{}),n()(y,"maxTimeOut",100),n()(y,"groupMap",{}),n()(y,"loadedMap",{}),n()(y,"atlasMap",{}),n()(y,"textureMap",{}),n()(y,"preLoadedMap",{}),n()(y,"_imgCache",{}),n()(y,"_loaders",[]),n()(y,"_isWorking",!1),n()(y,"_startIndex",0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(79),o=i(42),l=i(60),h=i(80),_=i(24),c=i(1),d=i(416),u=i(11);class f{static _createFloatTextureBuffer(t,e){var i=new o.a(t,e,l.a.R32G32B32A32,!1,!1);return i.filterMode=n.a.Point,i.wrapModeU=h.a.Clamp,i.wrapModeV=h.a.Clamp,i.anisoLevel=0,i}static _convertToLayaVec3(t,e,i){var a=u.a.Physics3D._bullet;e.x=i?-a.btVector3_x(t):a.btVector3_x(t),e.y=a.btVector3_y(t),e.z=a.btVector3_z(t)}static _convertToBulletVec3(t,e,i){u.a.Physics3D._bullet.btVector3_setValue(e,i?-t.x:t.x,t.y,t.z)}static _rotationTransformScaleSkinAnimation(t,e,i,a,r,s,n,o,l,h,_,c){var d,u,m,p,g,v=f._tempArray16_0,T=f._tempArray16_1,E=f._tempArray16_2,S=a+a,R=r+r,x=s+s,A=a*S,y=r*S,I=r*R,C=s*S,M=s*R,D=s*x,b=n*S,L=n*R,O=n*x;for(v[15]=1,v[0]=1-I-D,v[1]=y+O,v[2]=C-L,v[4]=y-O,v[5]=1-A-D,v[6]=M+b,v[8]=C+L,v[9]=M-b,v[10]=1-A-I,T[15]=1,T[0]=o,T[5]=l,T[10]=h,d=0;d<4;d++)u=v[d],m=v[d+4],p=v[d+8],g=v[d+12],E[d]=u,E[d+4]=m,E[d+8]=p,E[d+12]=u*t+m*e+p*i+g;for(d=0;d<4;d++)u=E[d],m=E[d+4],p=E[d+8],g=E[d+12],_[d+c]=u*T[0]+m*T[1]+p*T[2]+g*T[3],_[d+c+4]=u*T[4]+m*T[5]+p*T[6]+g*T[7],_[d+c+8]=u*T[8]+m*T[9]+p*T[10]+g*T[11],_[d+c+12]=u*T[12]+m*T[13]+p*T[14]+g*T[15]}static _computeBoneAndAnimationDatasByBindPoseMatrxix(t,e,i,a,r,s){var n,o,l=0,h=0,_=t.length;for(n=0;n<_;l+=t[n].keyframeWidth,h+=16,n++)f._rotationTransformScaleSkinAnimation(e[l+0],e[l+1],e[l+2],e[l+3],e[l+4],e[l+5],e[l+6],e[l+7],e[l+8],e[l+9],a,h),0!=n&&(o=16*t[n].parentIndex,f.mulMatrixByArray(a,o,a,h,a,h));var c=i.length;for(n=0;n<c;n++)f.mulMatrixByArrayAndMatrixFast(a,16*s[n],i[n],r,16*n)}static _computeAnimationDatasByArrayAndMatrixFast(t,e,i,a){for(var r=0,s=t.length;r<s;r++)f.mulMatrixByArrayAndMatrixFast(e,16*a[r],t[r],i,16*r)}static _computeBoneAndAnimationDatasByBindPoseMatrxixOld(t,e,i,a,r){var s,n,o=0,l=0,h=t.length;for(s=0;s<h;o+=t[s].keyframeWidth,l+=16,s++)f._rotationTransformScaleSkinAnimation(e[o+7],e[o+8],e[o+9],e[o+3],e[o+4],e[o+5],e[o+6],e[o+0],e[o+1],e[o+2],a,l),0!=s&&(n=16*t[s].parentIndex,f.mulMatrixByArray(a,n,a,l,a,l));var _=i.length;for(s=0;s<_;s++){var c=16*s;f.mulMatrixByArrayAndMatrixFast(a,c,i[s],r,c)}}static _computeAnimationDatasByArrayAndMatrixFastOld(t,e,i){for(var a=t.length,r=0;r<a;r++){var s=16*r;f.mulMatrixByArrayAndMatrixFast(e,s,t[r],i,s)}}static _computeRootAnimationData(t,e,i){for(var a=0,r=0,s=0,n=t.length;a<n;r+=t[a].keyframeWidth,s+=16,a++)f.createAffineTransformationArray(e[r+0],e[r+1],e[r+2],e[r+3],e[r+4],e[r+5],e[r+6],e[r+7],e[r+8],e[r+9],i,s)}static transformVector3ArrayByQuat(t,e,i,a,r){var s=t[e],n=t[e+1],o=t[e+2],l=i.x,h=i.y,_=i.z,c=i.w,d=c*s+h*o-_*n,u=c*n+_*s-l*o,f=c*o+l*n-h*s,m=-l*s-h*n-_*o;a[r]=d*c+m*-l+u*-_-f*-h,a[r+1]=u*c+m*-h+f*-l-d*-_,a[r+2]=f*c+m*-_+d*-h-u*-l}static mulMatrixByArray(t,e,i,a,r,s){var n,o,l,h,_;if(r===i){for(i=f._tempArray16_3,n=0;n<16;++n)i[n]=r[s+n];a=0}for(n=0;n<4;n++)o=t[e+n],l=t[e+n+4],h=t[e+n+8],_=t[e+n+12],r[s+n]=o*i[a+0]+l*i[a+1]+h*i[a+2]+_*i[a+3],r[s+n+4]=o*i[a+4]+l*i[a+5]+h*i[a+6]+_*i[a+7],r[s+n+8]=o*i[a+8]+l*i[a+9]+h*i[a+10]+_*i[a+11],r[s+n+12]=o*i[a+12]+l*i[a+13]+h*i[a+14]+_*i[a+15]}static mulMatrixByArrayFast(t,e,i,a,r,s){var n,o,l,h,_;for(n=0;n<4;n++)o=t[e+n],l=t[e+n+4],h=t[e+n+8],_=t[e+n+12],r[s+n]=o*i[a+0]+l*i[a+1]+h*i[a+2]+_*i[a+3],r[s+n+4]=o*i[a+4]+l*i[a+5]+h*i[a+6]+_*i[a+7],r[s+n+8]=o*i[a+8]+l*i[a+9]+h*i[a+10]+_*i[a+11],r[s+n+12]=o*i[a+12]+l*i[a+13]+h*i[a+14]+_*i[a+15]}static mulMatrixByArrayAndMatrixFast(t,e,i,a,r){var s,n,o,l,h,_=i.elements,c=_[0],d=_[1],u=_[2],f=_[3],m=_[4],p=_[5],g=_[6],v=_[7],T=_[8],E=_[9],S=_[10],R=_[11],x=_[12],A=_[13],y=_[14],I=_[15],C=e,M=e+4,D=e+8,b=e+12,L=r,O=r+4,P=r+8,N=r+12;for(s=0;s<4;s++)n=t[C+s],o=t[M+s],l=t[D+s],h=t[b+s],a[L+s]=n*c+o*d+l*u+h*f,a[O+s]=n*m+o*p+l*g+h*v,a[P+s]=n*T+o*E+l*S+h*R,a[N+s]=n*x+o*A+l*y+h*I}static createAffineTransformationArray(t,e,i,a,r,s,n,o,l,h,_,c){var d=a+a,u=r+r,f=s+s,m=a*d,p=a*u,g=a*f,v=r*u,T=r*f,E=s*f,S=n*d,R=n*u,x=n*f;_[c+0]=(1-(v+E))*o,_[c+1]=(p+x)*o,_[c+2]=(g-R)*o,_[c+3]=0,_[c+4]=(p-x)*l,_[c+5]=(1-(m+E))*l,_[c+6]=(T+S)*l,_[c+7]=0,_[c+8]=(g+R)*h,_[c+9]=(T-S)*h,_[c+10]=(1-(m+v))*h,_[c+11]=0,_[c+12]=t,_[c+13]=e,_[c+14]=i,_[c+15]=1}static transformVector3ArrayToVector3ArrayCoordinate(t,e,i,a,r){var s=t[e+0],n=t[e+1],o=t[e+2],l=i.elements,h=s*l[3]+n*l[7]+o*l[11]+l[15];a[r]=s*l[0]+n*l[4]+o*l[8]+l[12]/h,a[r+1]=s*l[1]+n*l[5]+o*l[9]+l[13]/h,a[r+2]=s*l[2]+n*l[6]+o*l[10]+l[14]/h}static transformVector3ArrayToVector3ArrayNormal(t,e,i,a,r){var s=t[e+0],n=t[e+1],o=t[e+2],l=i.elements;a[r]=s*l[0]+n*l[4]+o*l[8],a[r+1]=s*l[1]+n*l[5]+o*l[9],a[r+2]=s*l[2]+n*l[6]+o*l[10]}static transformLightingMapTexcoordArray(t,e,i,a,r){a[r+0]=t[e+0]*i.x+i.z,a[r+1]=1-((1-t[e+1])*i.y+i.w)}static getURLVerion(t){var e=t.indexOf("?");return e>=0?t.substr(e):null}static _createAffineTransformationArray(t,e,i,a){var r=e.x,s=e.y,n=e.z,o=e.w,l=r+r,h=s+s,_=n+n,c=r*l,d=r*h,u=r*_,f=s*h,m=s*_,p=n*_,g=o*l,v=o*h,T=o*_,E=i.x,S=i.y,R=i.z;a[0]=(1-(f+p))*E,a[1]=(d+T)*E,a[2]=(u-v)*E,a[3]=0,a[4]=(d-T)*S,a[5]=(1-(c+p))*S,a[6]=(m+g)*S,a[7]=0,a[8]=(u+v)*R,a[9]=(m-g)*R,a[10]=(1-(c+f))*R,a[11]=0,a[12]=t.x,a[13]=t.y,a[14]=t.z,a[15]=1}static _mulMatrixArray(t,e,i,a,r){var s=e,n=t,o=a,l=s[i],h=s[i+1],_=s[i+2],c=s[i+3],d=s[i+4],u=s[i+5],f=s[i+6],m=s[i+7],p=s[i+8],g=s[i+9],v=s[i+10],T=s[i+11],E=s[i+12],S=s[i+13],R=s[i+14],x=s[i+15],A=n[0],y=n[1],I=n[2],C=n[3],M=n[4],D=n[5],b=n[6],L=n[7],O=n[8],P=n[9],N=n[10],w=n[11],B=n[12],F=n[13],V=n[14],U=n[15];o[r]=l*A+h*M+_*O+c*B,o[r+1]=l*y+h*D+_*P+c*F,o[r+2]=l*I+h*b+_*N+c*V,o[r+3]=l*C+h*L+_*w+c*U,o[r+4]=d*A+u*M+f*O+m*B,o[r+5]=d*y+u*D+f*P+m*F,o[r+6]=d*I+u*b+f*N+m*V,o[r+7]=d*C+u*L+f*w+m*U,o[r+8]=p*A+g*M+v*O+T*B,o[r+9]=p*y+g*D+v*P+T*F,o[r+10]=p*I+g*b+v*N+T*V,o[r+11]=p*C+g*L+v*w+T*U,o[r+12]=E*A+S*M+R*O+x*B,o[r+13]=E*y+S*D+R*P+x*F,o[r+14]=E*I+S*b+R*N+x*V,o[r+15]=E*C+S*L+R*w+x*U}static arcTanAngle(t,e){return 0==t?1==e?Math.PI/2:-Math.PI/2:t>0?Math.atan(e/t):t<0?e>0?Math.atan(e/t)+Math.PI:Math.atan(e/t)-Math.PI:0}static angleTo(t,e,i){c.a.subtract(e,t,_.a.TEMPVector30),c.a.normalize(_.a.TEMPVector30,_.a.TEMPVector30),i.x=Math.asin(_.a.TEMPVector30.y),i.y=f.arcTanAngle(-_.a.TEMPVector30.z,-_.a.TEMPVector30.x)}static transformQuat(t,e,i){var a=e,r=t.x,s=t.y,n=t.z,o=a[0],l=a[1],h=a[2],_=a[3],c=_*r+l*n-h*s,d=_*s+h*r-o*n,u=_*n+o*s-l*r,f=-o*r-l*s-h*n;i.x=c*_+f*-o+d*-h-u*-l,i.y=d*_+f*-l+u*-o-c*-h,i.z=u*_+f*-h+c*-l-d*-o}static quaternionWeight(t,e,i){i.x=t.x*e,i.y=t.y*e,i.z=t.z*e,i.w=t.w}static quaternionConjugate(t,e){e.x=-t.x,e.y=-t.y,e.z=-t.z,e.w=t.w}static scaleWeight(t,e,i){var a=t.x,r=t.y,s=t.z;i.x=a>0?Math.pow(Math.abs(a),e):-Math.pow(Math.abs(a),e),i.y=r>0?Math.pow(Math.abs(r),e):-Math.pow(Math.abs(r),e),i.z=s>0?Math.pow(Math.abs(s),e):-Math.pow(Math.abs(s),e)}static scaleBlend(t,e,i,a){var r=f._tempVector3_0,s=f._tempVector3_1;f.scaleWeight(t,1-i,r),f.scaleWeight(e,i,s);var n=i>.5?e:t;a.x=n.x>0?Math.abs(r.x*s.x):-Math.abs(r.x*s.x),a.y=n.y>0?Math.abs(r.y*s.y):-Math.abs(r.y*s.y),a.z=n.z>0?Math.abs(r.z*s.z):-Math.abs(r.z*s.z)}static matrix4x4MultiplyFFF(t,e,i){var a,r,s,n,o;if(i===e)for(e=new Float32Array(16),a=0;a<16;++a)e[a]=i[a];var l=e[0],h=e[1],_=e[2],c=e[3],d=e[4],u=e[5],f=e[6],m=e[7],p=e[8],g=e[9],v=e[10],T=e[11],E=e[12],S=e[13],R=e[14],x=e[15];for(a=0;a<4;a++)r=t[a],s=t[a+4],n=t[a+8],o=t[a+12],i[a]=r*l+s*h+n*_+o*c,i[a+4]=r*d+s*u+n*f+o*m,i[a+8]=r*p+s*g+n*v+o*T,i[a+12]=r*E+s*S+n*R+o*x}static matrix4x4MultiplyFFFForNative(t,e,i){s.a.instance.matrix4x4Multiply(t,e,i)}static matrix4x4MultiplyMFM(t,e,i){f.matrix4x4MultiplyFFF(t.elements,e,i.elements)}static _buildTexture2D(t,e,i,a){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];var s=new o.a(t,e,i,r,!0);return s.anisoLevel=1,s.filterMode=n.a.Point,d.a._generateTexture2D(s,t,e,a),s}static _drawBound(t,e,i){t.lineCount+12>t.maxLineCount&&(t.maxLineCount+=12);var a=f._tempVector3_0,r=f._tempVector3_1,s=e.min,n=e.max;a.setValue(s.x,s.y,s.z),r.setValue(n.x,s.y,s.z),t.addLine(a,r,i,i),a.setValue(s.x,s.y,s.z),r.setValue(s.x,s.y,n.z),t.addLine(a,r,i,i),a.setValue(n.x,s.y,s.z),r.setValue(n.x,s.y,n.z),t.addLine(a,r,i,i),a.setValue(s.x,s.y,n.z),r.setValue(n.x,s.y,n.z),t.addLine(a,r,i,i),a.setValue(s.x,s.y,s.z),r.setValue(s.x,n.y,s.z),t.addLine(a,r,i,i),a.setValue(s.x,s.y,n.z),r.setValue(s.x,n.y,n.z),t.addLine(a,r,i,i),a.setValue(n.x,s.y,s.z),r.setValue(n.x,n.y,s.z),t.addLine(a,r,i,i),a.setValue(n.x,s.y,n.z),r.setValue(n.x,n.y,n.z),t.addLine(a,r,i,i),a.setValue(s.x,n.y,s.z),r.setValue(n.x,n.y,s.z),t.addLine(a,r,i,i),a.setValue(s.x,n.y,s.z),r.setValue(s.x,n.y,n.z),t.addLine(a,r,i,i),a.setValue(n.x,n.y,s.z),r.setValue(n.x,n.y,n.z),t.addLine(a,r,i,i),a.setValue(s.x,n.y,n.z),r.setValue(n.x,n.y,n.z),t.addLine(a,r,i,i)}static _getHierarchyPath(t,e,i){i.length=0;for(var a=e;a!==t;){var r=a._parent;if(!r)return null;i.push(r.getChildIndex(a)),a=r}return i}static _getNodeByHierarchyPath(t,e){for(var i=t,a=e.length-1;a>=0;a--)i=i.getChildAt(e[a]);return i}}e.a=f,r()(f,"_tempVector3_0",new c.a),r()(f,"_tempVector3_1",new c.a),r()(f,"_tempArray16_0",new Float32Array(16)),r()(f,"_tempArray16_1",new Float32Array(16)),r()(f,"_tempArray16_2",new Float32Array(16)),r()(f,"_tempArray16_3",new Float32Array(16)),r()(f,"_compIdToNode",new Object)},function(t,e,i){"use strict";var a=i(18),r=(i.n(a),i(0)),s=i.n(r),n=i(55),o=i(56),l=i(31);class h{static __init__(){h.instanceWorldMatrixDeclaration=new n.a(64,[new o.a(0,l.a.Vector4,h.MESH_WORLDMATRIX_ROW0),new o.a(16,l.a.Vector4,h.MESH_WORLDMATRIX_ROW1),new o.a(32,l.a.Vector4,h.MESH_WORLDMATRIX_ROW2),new o.a(48,l.a.Vector4,h.MESH_WORLDMATRIX_ROW3)]),h.instanceMVPMatrixDeclaration=new n.a(64,[new o.a(0,l.a.Vector4,h.MESH_MVPMATRIX_ROW0),new o.a(16,l.a.Vector4,h.MESH_MVPMATRIX_ROW1),new o.a(32,l.a.Vector4,h.MESH_MVPMATRIX_ROW2),new o.a(48,l.a.Vector4,h.MESH_MVPMATRIX_ROW3)]),h.instanceSimpleAnimatorDeclaration=new n.a(16,[new o.a(0,l.a.Vector4,h.MESH_SIMPLEANIMATOR)])}static getVertexDeclaration(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i=h._vertexDeclarationMap[t+(e?"_0":"_1")];if(!i){for(var a=t.split(","),r=0,s=[],_=0,c=a.length;_<c;_++){var d;switch(a[_]){case"POSITION":d=new o.a(r,l.a.Vector3,h.MESH_POSITION0),r+=12;break;case"NORMAL":d=new o.a(r,l.a.Vector3,h.MESH_NORMAL0),r+=12;break;case"COLOR":d=new o.a(r,l.a.Vector4,h.MESH_COLOR0),r+=16;break;case"UV":d=new o.a(r,l.a.Vector2,h.MESH_TEXTURECOORDINATE0),r+=8;break;case"UV1":d=new o.a(r,l.a.Vector2,h.MESH_TEXTURECOORDINATE1),r+=8;break;case"BLENDWEIGHT":d=new o.a(r,l.a.Vector4,h.MESH_BLENDWEIGHT0),r+=16;break;case"BLENDINDICES":e?(d=new o.a(r,l.a.Vector4,h.MESH_BLENDINDICES0),r+=16):(d=new o.a(r,l.a.Byte4,h.MESH_BLENDINDICES0),r+=4);break;case"TANGENT":d=new o.a(r,l.a.Vector4,h.MESH_TANGENT0),r+=16;break;default:throw"VertexMesh: unknown vertex flag."}s.push(d)}i=new n.a(r,s),h._vertexDeclarationMap[t+(e?"_0":"_1")]=i}return i}}e.a=h,s()(h,"MESH_POSITION0",0),s()(h,"MESH_COLOR0",1),s()(h,"MESH_TEXTURECOORDINATE0",2),s()(h,"MESH_NORMAL0",3),s()(h,"MESH_TANGENT0",4),s()(h,"MESH_BLENDINDICES0",5),s()(h,"MESH_BLENDWEIGHT0",6),s()(h,"MESH_TEXTURECOORDINATE1",7),s()(h,"MESH_WORLDMATRIX_ROW0",8),s()(h,"MESH_WORLDMATRIX_ROW1",9),s()(h,"MESH_WORLDMATRIX_ROW2",10),s()(h,"MESH_WORLDMATRIX_ROW3",11),s()(h,"MESH_MVPMATRIX_ROW0",12),s()(h,"MESH_MVPMATRIX_ROW1",13),s()(h,"MESH_MVPMATRIX_ROW2",14),s()(h,"MESH_MVPMATRIX_ROW3",15),s()(h,"MESH_SIMPLEANIMATOR",7),s()(h,"instanceWorldMatrixDeclaration",void 0),s()(h,"instanceMVPMatrixDeclaration",void 0),s()(h,"instanceSimpleAnimatorDeclaration",void 0),s()(h,"_vertexDeclarationMap",{})},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(r()(this,"a",void 0),r()(this,"b",void 0),r()(this,"c",void 0),r()(this,"d",void 0),r()(this,"tx",void 0),r()(this,"ty",void 0),r()(this,"_bTransform",!1),null!=n._createFun)return n._createFun(t,e,i,a,s,o,l);this.a=t,this.b=e,this.c=i,this.d=a,this.tx=s,this.ty=o,this._checkTransform()}identity(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this._bTransform=!1,this}_checkTransform(){return this._bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d}setTranslate(t,e){return this.tx=t,this.ty=e,this}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this._bTransform=!0,this}rotate(t){var e=Math.cos(t),i=Math.sin(t),a=this.a,r=this.c,s=this.tx;return this.a=a*e-this.b*i,this.b=a*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=s*e-this.ty*i,this.ty=s*i+this.ty*e,this._bTransform=!0,this}skew(t,e){var i=Math.tan(t),a=Math.tan(e),r=this.a,s=this.b;return this.a+=a*this.c,this.b+=a*this.d,this.c+=i*r,this.d+=i*s,this}invertTransformPoint(t){var e=this.a,i=this.b,a=this.c,r=this.d,s=this.tx,n=e*r-i*a,o=r/n,l=-i/n,h=-a/n,_=e/n,c=(a*this.ty-r*s)/n,d=-(e*this.ty-i*s)/n;return t.setTo(o*t.x+h*t.y+c,l*t.x+_*t.y+d)}transformPoint(t){return t.setTo(this.a*t.x+this.c*t.y+this.tx,this.b*t.x+this.d*t.y+this.ty)}transformPointN(t){return t.setTo(this.a*t.x+this.c*t.y,this.b*t.x+this.d*t.y)}getScaleX(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)}getScaleY(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)}invert(){var t=this.a,e=this.b,i=this.c,a=this.d,r=this.tx,s=t*a-e*i;return this.a=a/s,this.b=-e/s,this.c=-i/s,this.d=t/s,this.tx=(i*this.ty-a*r)/s,this.ty=-(t*this.ty-e*r)/s,this}setTo(t,e,i,a,r,s){return this.a=t,this.b=e,this.c=i,this.d=a,this.tx=r,this.ty=s,this}concat(t){var e=this.a,i=this.c,a=this.tx;return this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d,this.tx=a*t.a+this.ty*t.c+t.tx,this.ty=a*t.b+this.ty*t.d+t.ty,this}static mul(t,e,i){var a=t.a,r=t.b,s=t.c,n=t.d,o=t.tx,l=t.ty,h=e.a,_=e.b,c=e.c,d=e.d,u=e.tx,f=e.ty;return 0!==_||0!==c?(i.a=a*h+r*c,i.b=a*_+r*d,i.c=s*h+n*c,i.d=s*_+n*d,i.tx=h*o+c*l+u,i.ty=_*o+d*l+f):(i.a=a*h,i.b=r*d,i.c=s*h,i.d=n*d,i.tx=h*o+u,i.ty=d*l+f),i}static mul16(t,e,i){var a=t.a,r=t.b,s=t.c,n=t.d,o=t.tx,l=t.ty,h=e.a,_=e.b,c=e.c,d=e.d,u=e.tx,f=e.ty;return 0!==_||0!==c?(i[0]=a*h+r*c,i[1]=a*_+r*d,i[4]=s*h+n*c,i[5]=s*_+n*d,i[12]=h*o+c*l+u,i[13]=_*o+d*l+f):(i[0]=a*h,i[1]=r*d,i[4]=s*h,i[5]=n*d,i[12]=h*o+u,i[13]=d*l+f),i}scaleEx(t,e){var i=this.a,a=this.b,r=this.c,s=this.d;0!==a||0!==r?(this.a=t*i,this.b=t*a,this.c=e*r,this.d=e*s):(this.a=t*i,this.b=0*s,this.c=0*i,this.d=e*s),this._bTransform=!0}rotateEx(t){var e=Math.cos(t),i=Math.sin(t),a=this.a,r=this.b,s=this.c,n=this.d;0!==r||0!==s?(this.a=e*a+i*s,this.b=e*r+i*n,this.c=-i*a+e*s,this.d=-i*r+e*n):(this.a=e*a,this.b=i*n,this.c=-i*a,this.d=e*n),this._bTransform=!0}clone(){var t=n.create();return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t._bTransform=this._bTransform,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t._bTransform=this._bTransform,t}toString(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty}destroy(){this.recover()}recover(){s.a.recover("Matrix",this.identity())}static create(){return s.a.getItemByClass("Matrix",n)}}e.a=n,r()(n,"EMPTY",new n),r()(n,"TEMP",new n),r()(n,"_createFun",null)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;r()(this,"x",void 0),r()(this,"y",void 0),this.x=t,this.y=e}static create(){return s.a.getItemByClass("Point",n)}setTo(t,e){return this.x=t,this.y=e,this}reset(){return this.x=this.y=0,this}recover(){s.a.recover("Point",this.reset())}distance(t,e){return Math.sqrt((this.x-t)*(this.x-t)+(this.y-e)*(this.y-e))}toString(){return this.x+","+this.y}normalize(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t>0){var e=1/t;this.x*=e,this.y*=e}}copy(t){return this.setTo(t.x,t.y)}}e.a=n,r()(n,"TEMP",new n),r()(n,"EMPTY",new n)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(3),n=i(23),o=i(27);class l extends n.a{static get cpuMemory(){return l._cpuMemory}static get gpuMemory(){return l._gpuMemory}static _addCPUMemory(t){l._cpuMemory+=t}static _addGPUMemory(t){l._gpuMemory+=t}static _addMemory(t,e){l._cpuMemory+=t,l._gpuMemory+=e}static getResourceByID(t){return l._idResourcesMap[t]}static getResourceByURL(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return l._urlResourcesMap[t][e]}static destroyUnusedResources(){for(var t in l._idResourcesMap){var e=l._idResourcesMap[t];e.lock||0!==e._referenceCount||e.destroy()}}get id(){return this._id}get url(){return this._url}get cpuMemory(){return this._cpuMemory}get gpuMemory(){return this._gpuMemory}get destroyed(){return this._destroyed}get referenceCount(){return this._referenceCount}constructor(){super(),r()(this,"_id",0),r()(this,"_url",null),r()(this,"_cpuMemory",0),r()(this,"_gpuMemory",0),r()(this,"_destroyed",!1),r()(this,"_referenceCount",0),r()(this,"lock",!1),r()(this,"name",null),this._id=++l._uniqueIDCounter,this._destroyed=!1,this._referenceCount=0,l._idResourcesMap[this.id]=this,this.lock=!1}_setCPUMemory(t){var e=t-this._cpuMemory;this._cpuMemory=t,l._addCPUMemory(e)}_setGPUMemory(t){var e=t-this._gpuMemory;this._gpuMemory=t,l._addGPUMemory(e)}_setCreateURL(t){var e;(t=o.a.formatURL(t),this._url!==t)&&(this._url&&((e=l._urlResourcesMap[this._url]).splice(e.indexOf(this),1),0===e.length&&delete l._urlResourcesMap[this._url]),t&&((e=l._urlResourcesMap[t])||(l._urlResourcesMap[t]=e=[]),e.push(this)),this._url=t)}_addReference(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._referenceCount+=t}_removeReference(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._referenceCount-=t}_clearReference(){this._referenceCount=0}_recoverResource(){}_disposeResource(){}_activeResource(){}destroy(){var t;this._destroyed||(this._destroyed=!0,this.lock=!1,this._disposeResource(),delete l._idResourcesMap[this.id],this._url&&((t=l._urlResourcesMap[this._url])&&(t.splice(t.indexOf(this),1),0===t.length&&delete l._urlResourcesMap[this._url]),s.a.Loader.loadedMap[this._url]==this&&delete s.a.Loader.loadedMap[this._url]))}}e.a=l,r()(l,"_uniqueIDCounter",0),r()(l,"_idResourcesMap",{}),r()(l,"_urlResourcesMap",{}),r()(l,"_cpuMemory",0),r()(l,"_gpuMemory",0)},function(t,e,i){"use strict";var a=i(211),r=i(34),s=i(313),n=i(150),o=i(109),l=i(111),h=i(152),_=i(59),c=Math.min,d=[].push,u=!_(function(){RegExp(4294967295,"y")});i(112)("split",2,function(t,e,i,_){var f;return f="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,e){var r=String(this);if(void 0===t&&0===e)return[];if(!a(t))return i.call(r,t,e);for(var s,n,o,l=[],_=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),c=0,u=void 0===e?4294967295:e>>>0,f=new RegExp(t.source,_+"g");(s=h.call(f,r))&&!((n=f.lastIndex)>c&&(l.push(r.slice(c,s.index)),s.length>1&&s.index<r.length&&d.apply(l,s.slice(1)),o=s[0].length,c=n,l.length>=u));)f.lastIndex===s.index&&f.lastIndex++;return c===r.length?!o&&f.test("")||l.push(""):l.push(r.slice(c)),l.length>u?l.slice(0,u):l}:"0".split(void 0,0).length?function(t,e){return void 0===t&&0===e?[]:i.call(this,t,e)}:i,[function(i,a){var r=t(this),s=void 0==i?void 0:i[e];return void 0!==s?s.call(i,r,a):f.call(String(r),i,a)},function(t,e){var a=_(f,t,this,e,f!==i);if(a.done)return a.value;var h=r(t),d=String(this),m=s(h,RegExp),p=h.unicode,g=(h.ignoreCase?"i":"")+(h.multiline?"m":"")+(h.unicode?"u":"")+(u?"y":"g"),v=new m(u?h:"^(?:"+h.source+")",g),T=void 0===e?4294967295:e>>>0;if(0===T)return[];if(0===d.length)return null===l(v,d)?[d]:[];for(var E=0,S=0,R=[];S<d.length;){v.lastIndex=u?S:0;var x,A=l(v,u?d:d.slice(S));if(null===A||(x=c(o(v.lastIndex+(u?0:S)),d.length))===E)S=n(d,S,p);else{if(R.push(d.slice(E,S)),R.length===T)return R;for(var y=1;y<=A.length-1;y++)if(R.push(A[y]),R.length===T)return R;S=E=x}}return R.push(d.slice(E)),R}]})},function(t,e,i){"use strict";var a=i(116),r=(i.n(a),i(115)),s=(i.n(r),i(0)),n=i.n(s),o=i(3);class l{static __init__(){var t=window.Laya||o.a.Laya;if(l._window)return l._window;var e=l._window=window,i=l._document=e.document,a=l.userAgent=e.navigator.userAgent,r=e.navigator.maxTouchPoints||0,s=e.navigator.platform;"my"in l.window&&("tb"in l.window.my?(window.tbMiniGame(t,t),t.TBMiniAdapter?t.TBMiniAdapter.enable():console.error("请先添加淘宝适配库,详细教程：https://ldc2.layabox.com/doc/?language=zh&nav=zh-ts-5-6-0")):a.indexOf("AlipayMiniGame")>-1&&(window.aliPayMiniGame(t,t),t.ALIMiniAdapter?t.ALIMiniAdapter.enable():console.error("请先添加阿里小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?language=zh&nav=zh-ts-5-6-0"))),-1==a.indexOf("OPPO")&&a.indexOf("MiniGame")>-1&&"wx"in l.window&&("tt"in l.window?(window.ttMiniGame(t,t),t.TTMiniAdapter?t.TTMiniAdapter.enable():console.error("请引入字节跳动小游戏的适配库")):"bl"in l.window?(window.biliMiniGame(t,t),t.BLMiniAdapter?t.BLMiniAdapter.enable():console.error("请引入bilibili小游戏的适配库,详细教程：https://ldc2.layabox.com/doc/?language=zh&nav=zh-ts-5-7-0")):"qq"in l.window?(window.qqMiniGame(t,t),t.QQMiniAdapter?t.QQMiniAdapter.enable():console.error("请引入手机QQ小游戏的适配库,详细教程：https://ldc2.layabox.com/doc/?language=zh&nav=zh-ts-5-0-0")):(window.wxMiniGame(t,t),t.MiniAdpter?t.MiniAdpter.enable():console.error("请先添加小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?nav=zh-ts-5-0-0"))),"hbs"in l.window&&(window.hwMiniGame(t,t),t.HWMiniAdapter?t.HWMiniAdapter.enable():console.error("请先添加小游戏适配库!")),a.indexOf("SwanGame")>-1&&(window.bdMiniGame(t,t),t.BMiniAdapter?t.BMiniAdapter.enable():console.error("请先添加百度小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?language=zh&nav=zh-ts-5-1-0")),a.indexOf("QuickGame")>-1&&(window.miMiniGame(t,t),t.KGMiniAdapter?t.KGMiniAdapter.enable():console.error("请先添加小米小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?language=zh&nav=zh-ts-5-2-0")),a.indexOf("OPPO")>-1&&a.indexOf("MiniGame")>-1&&(window.qgMiniGame(t,t),t.QGMiniAdapter?t.QGMiniAdapter.enable():console.error("请先添加OPPO小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?language=zh&nav=zh-ts-5-3-0")),a.indexOf("VVGame")>-1&&(window.vvMiniGame(t,t),t.VVMiniAdapter?t.VVMiniAdapter.enable():console.error("请先添加VIVO小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?language=zh&nav=zh-ts-5-4-0")),e.trace=console.log,e.requestAnimationFrame=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){return e.setTimeout(t,1e3/60)};var n=i.body.style;n.margin=0,n.overflow="hidden",n["-webkit-user-select"]="none",n["-webkit-tap-highlight-color"]="rgba(200,200,200,0)";for(var h=i.getElementsByTagName("meta"),_=0,c=!1,d="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no";_<h.length;){var u=h[_];if("viewport"==u.name){u.content=d,c=!0;break}_++}return c||((u=i.createElement("meta")).name="viewport",u.content=d,i.getElementsByTagName("head")[0].appendChild(u)),l.onMobile=!!window.isConchApp||a.indexOf("Mobile")>-1,l.onIOS=!!a.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),l.onIPhone=a.indexOf("iPhone")>-1,l.onMac=a.indexOf("Mac OS X")>-1,l.onIPad=a.indexOf("iPad")>-1||"MacIntel"===s&&r>1,l.onAndroid=a.indexOf("Android")>-1||a.indexOf("Adr")>-1,l.onWP=a.indexOf("Windows Phone")>-1,l.onQQBrowser=a.indexOf("QQBrowser")>-1,l.onMQQBrowser=a.indexOf("MQQBrowser")>-1||a.indexOf("Mobile")>-1&&a.indexOf("QQ")>-1,l.onIE=!!e.ActiveXObject||"ActiveXObject"in e,l.onWeiXin=a.indexOf("MicroMessenger")>-1,l.onSafari=a.indexOf("Safari")>-1,l.onPC=!l.onMobile,l.onMiniGame=a.indexOf("MiniGame")>-1,l.onBDMiniGame=a.indexOf("SwanGame")>-1,l.onLayaRuntime=!!l.window.conch,a.indexOf("OPPO")>-1&&a.indexOf("MiniGame")>-1?(l.onQGMiniGame=!0,l.onMiniGame=!1):"qq"in l.window&&a.indexOf("MiniGame")>-1?(l.onQQMiniGame=!0,l.onMiniGame=!1):"bl"in l.window&&a.indexOf("MiniGame")>-1?(l.onBLMiniGame=!0,l.onMiniGame=!1):"tt"in l.window&&a.indexOf("MiniGame")>-1&&(l.onTTMiniGame=!0,l.onMiniGame=!1),l.onHWMiniGame="hbs"in l.window,l.onVVMiniGame=a.indexOf("VVGame")>-1,l.onKGMiniGame=a.indexOf("QuickGame")>-1,a.indexOf("AlipayMiniGame")>-1&&(l.onAlipayMiniGame=!0,l.onMiniGame=!1),(a.indexOf("TB/")>-1||a.indexOf("Taobao/")>-1||a.indexOf("TM/")>-1)&&(l.onTBMiniGame=!0),e}static createElement(t){return l.__init__(),l._document.createElement(t)}static getElementById(t){return l.__init__(),l._document.getElementById(t)}static removeElement(t){t&&t.parentNode&&t.parentNode.removeChild(t)}static now(){return Date.now()}static get clientWidth(){return l.__init__(),l._window.innerWidth||l._document.body.clientWidth}static get clientHeight(){return l.__init__(),l._window.innerHeight||l._document.body.clientHeight||l._document.documentElement.clientHeight}static get width(){return l.__init__(),(o.a.stage&&o.a.stage.canvasRotation?l.clientHeight:l.clientWidth)*l.pixelRatio}static get height(){return l.__init__(),(o.a.stage&&o.a.stage.canvasRotation?l.clientWidth:l.clientHeight)*l.pixelRatio}static get pixelRatio(){return l._pixelRatio<0&&(l.__init__(),l.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")>-1?l._pixelRatio=2:(l._pixelRatio=l._window.devicePixelRatio||1,l._pixelRatio<1&&(l._pixelRatio=1))),l._pixelRatio}static get container(){return l._container||(l.__init__(),l._container=l.createElement("div"),l._container.id="layaContainer",l._document.body.appendChild(l._container)),l._container}static set container(t){l._container=t}static get window(){return l._window||l.__init__()}static get document(){return l.__init__(),l._document}}e.a=l,n()(l,"userAgent",void 0),n()(l,"onMobile",void 0),n()(l,"onIOS",void 0),n()(l,"onMac",void 0),n()(l,"onIPhone",void 0),n()(l,"onIPad",void 0),n()(l,"onAndroid",void 0),n()(l,"onWP",void 0),n()(l,"onQQBrowser",void 0),n()(l,"onMQQBrowser",void 0),n()(l,"onSafari",void 0),n()(l,"onIE",void 0),n()(l,"onWeiXin",void 0),n()(l,"onPC",void 0),n()(l,"onMiniGame",void 0),n()(l,"onBDMiniGame",void 0),n()(l,"onKGMiniGame",void 0),n()(l,"onQGMiniGame",void 0),n()(l,"onVVMiniGame",void 0),n()(l,"onAlipayMiniGame",void 0),n()(l,"onQQMiniGame",void 0),n()(l,"onBLMiniGame",void 0),n()(l,"onTTMiniGame",void 0),n()(l,"onHWMiniGame",void 0),n()(l,"onTBMiniGame",void 0),n()(l,"onFirefox",void 0),n()(l,"onEdge",void 0),n()(l,"onLayaRuntime",void 0),n()(l,"supportWebAudio",void 0),n()(l,"supportLocalStorage",void 0),n()(l,"canvas",void 0),n()(l,"context",void 0),n()(l,"_window",void 0),n()(l,"_document",void 0),n()(l,"_container",void 0),n()(l,"_pixelRatio",-1),n()(l,"mainCanvas",null),n()(l,"hanzi",new RegExp("^[一-龥]$")),n()(l,"fontMap",[]),n()(l,"measureText",function(t,e){var i=l.hanzi.test(t);if(i&&l.fontMap[e])return l.fontMap[e];var a=l.context;a.font=e;var r=a.measureText(t);return i&&(l.fontMap[e]=r),r})},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;r()(this,"x",void 0),r()(this,"y",void 0),this.x=t,this.y=e}setValue(t,e){this.x=t,this.y=e}static scale(t,e,i){i.x=t.x*e,i.y=t.y*e}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=t[e+0],this.y=t[e+1]}cloneTo(t){var e=t;e.x=this.x,e.y=this.y}static dot(t,e){return t.x*e.x+t.y*e.y}static normalize(t,e){var i=t.x,a=t.y,r=i*i+a*a;r>0&&(r=1/Math.sqrt(r),e.x=i*r,e.y=a*r)}static scalarLength(t){var e=t.x,i=t.y;return Math.sqrt(e*e+i*i)}clone(){var t=new s;return this.cloneTo(t),t}forNativeElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t?(this.elements=t,this.elements[0]=this.x,this.elements[1]=this.y):this.elements=new Float32Array([this.x,this.y]),s.rewriteNumProperty(this,"x",0),s.rewriteNumProperty(this,"y",1)}static rewriteNumProperty(t,e,i){Object.defineProperty(t,e,{get:function(){return this.elements[i]},set:function(t){this.elements[i]=t}})}}e.a=s,r()(s,"ZERO",new s(0,0)),r()(s,"ONE",new s(1,1))},function(t,e,i){"use strict";var a=i(28),r=(i.n(a),i(115)),s=(i.n(r),i(116)),n=(i.n(s),i(326)),o=(i.n(n),i(18)),l=(i.n(o),i(118)),h=(i.n(l),i(0)),_=i.n(h),c=i(16),d=i(26),u=i(3);class f{static toRadian(t){return t*f._pi2}static toAngle(t){return t*f._pi}static toHexColor(t){if(t<0||isNaN(t))return null;for(var e=t.toString(16);e.length<6;)e="0"+e;return"#"+e}static getGID(){return f._gid++}static concatArray(t,e){if(!e)return t;if(!t)return e;var i,a=e.length;for(i=0;i<a;i++)t.push(e[i]);return t}static clearArray(t){return t?(t.length=0,t):t}static copyArray(t,e){if(t||(t=[]),!e)return t;t.length=e.length;var i,a=e.length;for(i=0;i<a;i++)t[i]=e[i];return t}static getGlobalRecByPoints(t,e,i,a,r){var s,n;s=c.a.create().setTo(e,i),s=t.localToGlobal(s),n=c.a.create().setTo(a,r),n=t.localToGlobal(n);var o=d.a._getWrapRec([s.x,s.y,n.x,n.y]);return s.recover(),n.recover(),o}static getGlobalPosAndScale(t){return f.getGlobalRecByPoints(t,0,0,1,1)}static bind(t,e){return t.bind(e)}static updateOrder(t){if(!t||t.length<2)return!1;for(var e,i,a,r=1,s=t.length;r<s;){for(a=t[e=r],i=t[e]._zOrder;--e>-1&&t[e]._zOrder>i;)t[e+1]=t[e];t[e+1]=a,r++}return!0}static transPointList(t,e,i){var a,r=t.length;for(a=0;a<r;a+=2)t[a]+=e,t[a+1]+=i}static parseInt(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;var i=parseInt(t,e);return isNaN(i)?0:i}static getFileExtension(t){f._extReg.lastIndex=t.lastIndexOf(".");var e=f._extReg.exec(t);return e&&e.length>1?e[1].toLowerCase():null}static getFilecompatibleExtension(t){var e=t.split("."),i=e.length;return e.length>2?e[i-2]+"."+e[i-1]:null}static getTransformRelativeToWindow(t,e,i){var a=f.gStage,r=f.getGlobalPosAndScale(t),s=a._canvasTransform.clone(),n=s.tx,o=s.ty;s.rotate(-Math.PI/180*a.canvasDegree),s.scale(a.clientScaleX,a.clientScaleY);var l,h,_,c,d=a.canvasDegree%180!=0;return d?(l=i+r.y,h=e+r.x,l*=s.d,h*=s.a,90==a.canvasDegree?(l=n-l,h+=o):(l+=n,h=o-h)):(l=e+r.x,h=i+r.y,l*=s.a,h*=s.d,l+=n,h+=o),h+=a._safariOffsetY,d?(_=s.d*r.height,c=s.a*r.width):(_=s.a*r.width,c=s.d*r.height),{x:l,y:h,scaleX:_,scaleY:c}}static fitDOMElementInArea(t,e,i,a,r,s){t._fitLayaAirInitialized||(t._fitLayaAirInitialized=!0,t.style.transformOrigin=t.style.webKittransformOrigin="left top",t.style.position="absolute");var n=f.getTransformRelativeToWindow(e,i,a);t.style.transform=t.style.webkitTransform="scale("+n.scaleX+","+n.scaleY+") rotate("+f.gStage.canvasDegree+"deg)",t.style.width=r+"px",t.style.height=s+"px",t.style.left=n.x+"px",t.style.top=n.y+"px"}static isOkTextureList(t){if(!t)return!1;var e,i,a=t.length;for(e=0;e<a;e++)if(!(i=t[e])||!i._getSource())return!1;return!0}static isOKCmdList(t){if(!t)return!1;var e,i=t.length;for(e=0;e<i;e++)t[e];return!0}static getQueryString(t){if(u.a.Browser.onMiniGame)return null;if(!window.location||!window.location.search)return null;var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(e);return null!=i?unescape(i[2]):null}}e.a=f,_()(f,"gStage",null),_()(f,"_gid",1),_()(f,"_pi",180/Math.PI),_()(f,"_pi2",Math.PI/180),_()(f,"_extReg",/\.(\w+)\??/g),_()(f,"parseXMLFromString",function(t){var e;if(t=t.replace(/>\s+</g,"><"),(e=(new DOMParser).parseFromString(t,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors")>-1)throw new Error(e.firstChild.firstChild.textContent);return e})},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(12),n=i(46),o=i(17),l=i(20),h=i(1),_=i(5),c=i(7),d=i(32),u=i(30),f=i(58);class m extends o.a{static load(t,e){f.a.loader.create(t,e,null,m.MATERIAL)}static __initDefine__(){m.SHADERDEFINE_ALPHATEST=c.a.getDefineByName("ALPHATEST")}static _parse(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];var e,i=t,a=i.props,r=a.type,n=u.a.getRegClass(r);if(!n)throw"_getSprite3DHierarchyInnerUrls 错误: "+t.type+" 不是类";switch(e=new n,i.version){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":var o,d;for(var f in a)switch(f){case"type":break;case"vectors":var m=a[f];for(o=0,d=m.length;o<d;o++){var p=m[o],g=p.value;switch(g.length){case 2:e[p.name]=new l.a(g[0],g[1]);break;case 3:e[p.name]=new h.a(g[0],g[1],g[2]);break;case 4:e[p.name]=new _.a(g[0],g[1],g[2],g[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var v=a[f];for(o=0,d=v.length;o<d;o++){var T=v[o],E=T.path;E&&(e[T.name]=s.a.getRes(E))}break;case"defines":var S=a[f];for(o=0,d=S.length;o<d;o++){var R=c.a.getDefineByName(S[o]);e._shaderValues.addDefine(R)}break;case"renderStates":var x=a[f][0],A=e;A.blend=x.blend,A.cull=x.cull,A.depthTest=x.depthTest,A.depthWrite=x.depthWrite,A.blendSrc=x.srcBlend,A.blendDst=x.dstBlend;break;case"cull":e.cull=a[f];break;case"blend":e.blend=a[f];break;case"depthWrite":e.depthWrite=a[f];break;case"srcBlend":e.blendSrc=a[f];break;case"dstBlend":e.blendDst=a[f];break;default:e[f]=a[f]}break;default:throw new Error("BaseMaterial:unkonwn version.")}return e}get shaderData(){return this._shaderValues}get alphaTestValue(){return this._shaderValues.getNumber(m.ALPHATESTVALUE)}set alphaTestValue(t){this._shaderValues.setNumber(m.ALPHATESTVALUE,t)}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest=t,t?this._shaderValues.addDefine(m.SHADERDEFINE_ALPHATEST):this._shaderValues.removeDefine(m.SHADERDEFINE_ALPHATEST)}constructor(){super(),r()(this,"_alphaTest",void 0),r()(this,"_shader",void 0),r()(this,"_shaderValues",null),r()(this,"renderQueue",void 0),this._shaderValues=new d.a(this),this.renderQueue=m.RENDERQUEUE_OPAQUE,this._alphaTest=!1}_removeTetxureReference(){var t=this._shaderValues.getData();for(var e in t){var i=t[e];i&&i instanceof n.a&&i._removeReference()}}_disposeResource(){this._referenceCount>0&&this._removeTetxureReference(),this._shaderValues=null}_addReference(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super._addReference(t);var e=this._shaderValues.getData();for(var i in e){var a=e[i];a&&a instanceof n.a&&a._addReference()}}_removeReference(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super._removeReference(t),this._removeTetxureReference()}setShaderName(t){if(this._shader=c.a.find(t),!this._shader)throw new Error("BaseMaterial: unknown shader name.")}cloneTo(t){var e=t;e.name=this.name,e.renderQueue=this.renderQueue,this._shaderValues.cloneTo(e._shaderValues)}clone(){var t=new m;return this.cloneTo(t),t}get _defineDatas(){return this._shaderValues._defineDatas}}e.a=m,r()(m,"MATERIAL","MATERIAL"),r()(m,"RENDERQUEUE_OPAQUE",2e3),r()(m,"RENDERQUEUE_ALPHATEST",2450),r()(m,"RENDERQUEUE_TRANSPARENT",3e3),r()(m,"ALPHATESTVALUE",c.a.propertyNameToID("u_AlphaTestValue")),r()(m,"SHADERDEFINE_ALPHATEST",null)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(43);class n{constructor(){r()(this,"_events",void 0)}hasListener(t){return!!(this._events&&this._events[t])}event(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this._events||!this._events[t])return!1;var i=this._events[t];if(i.run)i.once&&delete this._events[t],null!=e?i.runWith(e):i.run();else{for(var a=0,r=i.length;a<r;a++){var s=i[a];s&&(null!=e?s.runWith(e):s.run()),s&&!s.once||(i.splice(a,1),a--,r--)}0===i.length&&this._events&&delete this._events[t]}return!0}on(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return this._createListener(t,e,i,a,!1)}once(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return this._createListener(t,e,i,a,!0)}_createListener(t,e,i,a,r){(!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&this.off(t,e,i,r);var s=o.create(e||this,i,a,r);this._events||(this._events={});var n=this._events;return n[t]?n[t].run?n[t]=[n[t],s]:n[t].push(s):n[t]=s,this}off(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!this._events||!this._events[t])return this;var r=this._events[t];if(null!=r)if(r.run)e&&r.caller!==e||null!=i&&r.method!==i||a&&!r.once||(delete this._events[t],r.recover());else{for(var s=0,n=0,o=r.length;n<o;n++){var l=r[n];l?!l||e&&l.caller!==e||null!=i&&l.method!==i||a&&!l.once||(s++,r[n]=null,l.recover()):s++}s===o&&delete this._events[t]}return this}offAll(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;var e=this._events;if(!e)return this;if(t)this._recoverHandlers(e[t]),delete e[t];else{for(var i in e)this._recoverHandlers(e[i]);this._events=null}return this}offAllCaller(t){if(t&&this._events)for(var e in this._events)this.off(e,t,null);return this}_recoverHandlers(t){if(t)if(t.run)t.recover();else for(var e=t.length-1;e>-1;e--)t[e]&&(t[e].recover(),t[e]=null)}isMouseEvent(t){return n.MOUSE_EVENTS[t]||!1}}e.a=n,r()(n,"MOUSE_EVENTS",{rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0});class o extends s.a{constructor(t,e,i,a){super(t,e,i,a)}recover(){this._id>0&&(this._id=0,o._pool.push(this.clear()))}static create(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return o._pool.length?o._pool.pop().setTo(t,e,i,a):new o(t,e,i,a)}}r()(o,"_pool",[])},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1),n=i(253),o=i(49),l=i(20),h=i(11);class _{static createFromYawPitchRoll(t,e,i,a){var r=.5*i,s=.5*e,n=.5*t,o=Math.sin(r),l=Math.cos(r),h=Math.sin(s),_=Math.cos(s),c=Math.sin(n),d=Math.cos(n);a.x=d*h*l+c*_*o,a.y=c*_*l-d*h*o,a.z=d*_*o-c*h*l,a.w=d*_*l+c*h*o}static multiply(t,e,i){var a=t.x,r=t.y,s=t.z,n=t.w,o=e.x,l=e.y,h=e.z,_=e.w,c=r*h-s*l,d=s*o-a*h,u=a*l-r*o,f=a*o+r*l+s*h;i.x=a*_+o*n+c,i.y=r*_+l*n+d,i.z=s*_+h*n+u,i.w=n*_-f}static arcTanAngle(t,e){return 0==t?1==e?Math.PI/2:-Math.PI/2:t>0?Math.atan(e/t):t<0?e>0?Math.atan(e/t)+Math.PI:Math.atan(e/t)-Math.PI:0}static angleTo(t,e,i){s.a.subtract(e,t,_.TEMPVector30),s.a.normalize(_.TEMPVector30,_.TEMPVector30),i.x=Math.asin(_.TEMPVector30.y),i.y=_.arcTanAngle(-_.TEMPVector30.z,-_.TEMPVector30.x)}static createFromAxisAngle(t,e,i){e*=.5;var a=Math.sin(e);i.x=a*t.x,i.y=a*t.y,i.z=a*t.z,i.w=Math.cos(e)}static createFromMatrix4x4(t,e){var i,a,r=t.elements,s=r[0]+r[5]+r[10];s>0?(i=Math.sqrt(s+1),e.w=.5*i,i=.5/i,e.x=(r[6]-r[9])*i,e.y=(r[8]-r[2])*i,e.z=(r[1]-r[4])*i):r[0]>=r[5]&&r[0]>=r[10]?(a=.5/(i=Math.sqrt(1+r[0]-r[5]-r[10])),e.x=.5*i,e.y=(r[1]+r[4])*a,e.z=(r[2]+r[8])*a,e.w=(r[6]-r[9])*a):r[5]>r[10]?(a=.5/(i=Math.sqrt(1+r[5]-r[0]-r[10])),e.x=(r[4]+r[1])*a,e.y=.5*i,e.z=(r[9]+r[6])*a,e.w=(r[8]-r[2])*a):(a=.5/(i=Math.sqrt(1+r[10]-r[0]-r[5])),e.x=(r[8]+r[2])*a,e.y=(r[9]+r[6])*a,e.z=.5*i,e.w=(r[1]-r[4])*a)}static slerp(t,e,i,a){var r,s,n,o,l,h=t.x,_=t.y,c=t.z,d=t.w,u=e.x,f=e.y,m=e.z,p=e.w;return(s=h*u+_*f+c*m+d*p)<0&&(s=-s,u=-u,f=-f,m=-m,p=-p),1-s>1e-6?(r=Math.acos(s),n=Math.sin(r),o=Math.sin((1-i)*r)/n,l=Math.sin(i*r)/n):(o=1-i,l=i),a.x=o*h+l*u,a.y=o*_+l*f,a.z=o*c+l*m,a.w=o*d+l*p,a}static lerp(t,e,i,a){var r=1-i;_.dot(t,e)>=0?(a.x=r*t.x+i*e.x,a.y=r*t.y+i*e.y,a.z=r*t.z+i*e.z,a.w=r*t.w+i*e.w):(a.x=r*t.x-i*e.x,a.y=r*t.y-i*e.y,a.z=r*t.z-i*e.z,a.w=r*t.w-i*e.w),a.normalize(a)}static add(t,e,i){i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z,i.w=t.w+e.w}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;arguments.length>4&&void 0!==arguments[4]&&arguments[4];r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"z",void 0),r()(this,"w",void 0),this.x=t,this.y=e,this.z=i,this.w=a}scaling(t,e){e.x=this.x*t,e.y=this.y*t,e.z=this.z*t,e.w=this.w*t}normalize(t){var e=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;e>0&&(e=1/Math.sqrt(e),t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e)}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}rotateX(t,e){t*=.5;var i=Math.sin(t),a=Math.cos(t);e.x=this.x*a+this.w*i,e.y=this.y*a+this.z*i,e.z=this.z*a-this.y*i,e.w=this.w*a-this.x*i}rotateY(t,e){t*=.5;var i=Math.sin(t),a=Math.cos(t);e.x=this.x*a-this.z*i,e.y=this.y*a+this.w*i,e.z=this.z*a+this.x*i,e.w=this.w*a-this.y*i}rotateZ(t,e){t*=.5;var i=Math.sin(t),a=Math.cos(t);e.x=this.x*a+this.y*i,e.y=this.y*a-this.x*i,e.z=this.z*a+this.w*i,e.w=this.w*a-this.z*i}getYawPitchRoll(t){s.a.transformQuat(s.a._ForwardRH,this,_.TEMPVector31),s.a.transformQuat(s.a._Up,this,_.TEMPVector32);var e=_.TEMPVector32;_.angleTo(s.a._ZERO,_.TEMPVector31,_.TEMPVector33);var i=_.TEMPVector33;i.x==Math.PI/2?(i.y=_.arcTanAngle(e.z,e.x),i.z=0):i.x==-Math.PI/2?(i.y=_.arcTanAngle(-e.z,-e.x),i.z=0):(h.a.Matrix4x4.createRotationY(-i.y,h.a.Matrix4x4.TEMPMatrix0),h.a.Matrix4x4.createRotationX(-i.x,h.a.Matrix4x4.TEMPMatrix1),s.a.transformCoordinate(_.TEMPVector32,h.a.Matrix4x4.TEMPMatrix0,_.TEMPVector32),s.a.transformCoordinate(_.TEMPVector32,h.a.Matrix4x4.TEMPMatrix1,_.TEMPVector32),i.z=_.arcTanAngle(e.y,-e.x)),i.y<=-Math.PI&&(i.y=Math.PI),i.z<=-Math.PI&&(i.z=Math.PI),i.y>=Math.PI&&i.z>=Math.PI&&(i.y=0,i.z=0,i.x=Math.PI-i.x);var a=t;a.x=i.y,a.y=i.x,a.z=i.z}invert(t){var e=this.x,i=this.y,a=this.z,r=this.w,s=e*e+i*i+a*a+r*r,n=s?1/s:0;t.x=-e*n,t.y=-i*n,t.z=-a*n,t.w=r*n}identity(){this.x=0,this.y=0,this.z=0,this.w=1}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=t[e+0],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3]}cloneTo(t){this!==t&&(t.x=this.x,t.y=this.y,t.z=this.z,t.w=this.w)}clone(){var t=new _;return this.cloneTo(t),t}equals(t){return o.a.nearEqual(this.x,t.x)&&o.a.nearEqual(this.y,t.y)&&o.a.nearEqual(this.z,t.z)&&o.a.nearEqual(this.w,t.w)}static rotationLookAt(t,e,i){_.lookAt(s.a._ZERO,t,e,i)}static lookAt(t,e,i,a){n.a.lookAt(t,e,i,_._tempMatrix3x3),_.rotationMatrix(_._tempMatrix3x3,a)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}static invert(t,e){var i=t.lengthSquared();o.a.isZero(i)||(i=1/i,e.x=-t.x*i,e.y=-t.y*i,e.z=-t.z*i,e.w=t.w*i)}static rotationMatrix(t,e){var i,a,r=t.elements,s=r[0],n=r[1],o=r[2],l=r[3],h=r[4],_=r[5],c=r[6],d=r[7],u=r[8],f=s+h+u;f>0?(i=Math.sqrt(f+1),e.w=.5*i,i=.5/i,e.x=(_-d)*i,e.y=(c-o)*i,e.z=(n-l)*i):s>=h&&s>=u?(a=.5/(i=Math.sqrt(1+s-h-u)),e.x=.5*i,e.y=(n+l)*a,e.z=(o+c)*a,e.w=(_-d)*a):h>u?(a=.5/(i=Math.sqrt(1+h-s-u)),e.x=(l+n)*a,e.y=.5*i,e.z=(d+_)*a,e.w=(c-o)*a):(a=.5/(i=Math.sqrt(1+u-s-h)),e.x=(c+o)*a,e.y=(d+_)*a,e.z=.5*i,e.w=(n-l)*a)}forNativeElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t?(this.elements=t,this.elements[0]=this.x,this.elements[1]=this.y,this.elements[2]=this.z,this.elements[3]=this.w):this.elements=new Float32Array([this.x,this.y,this.z,this.w]),l.a.rewriteNumProperty(this,"x",0),l.a.rewriteNumProperty(this,"y",1),l.a.rewriteNumProperty(this,"z",2),l.a.rewriteNumProperty(this,"w",3)}}e.a=_,r()(_,"TEMPVector30",new s.a),r()(_,"TEMPVector31",new s.a),r()(_,"TEMPVector32",new s.a),r()(_,"TEMPVector33",new s.a),r()(_,"_tempMatrix3x3",new n.a),r()(_,"DEFAULT",new _),r()(_,"NAN",new _(NaN,NaN,NaN,NaN))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(95);class o extends n.a{get vertexDeclaration(){return this._vertexDeclaration}set vertexDeclaration(t){this._vertexDeclaration=t}get canRead(){return this._canRead}constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),r()(this,"_canRead",void 0),r()(this,"_vertexDeclaration",null),r()(this,"_float32Reader",null);var a=s.a.instance;this._bufferUsage=e,this._bufferType=a.ARRAY_BUFFER,this._canRead=i,this._byteLength=t,this.bind(),a.bufferData(this._bufferType,this._byteLength,this._bufferUsage),i&&(this._buffer=new Uint8Array(t),this._float32Reader=new Float32Array(this._buffer.buffer))}bind(){if(n.a._bindedVertexBuffer!==this._glBuffer){var t=s.a.instance;return t.bindBuffer(t.ARRAY_BUFFER,this._glBuffer),n.a._bindedVertexBuffer=this._glBuffer,!0}return!1}orphanStorage(){this.bind(),s.a.instance.bufferData(this._bufferType,this._byteLength,this._bufferUsage)}setData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.MAX_SAFE_INTEGER;if(this.bind(),0!==i||a!==Number.MAX_SAFE_INTEGER){var r=new Uint8Array(t,i,a);s.a.instance.bufferSubData(this._bufferType,e,r),this._canRead&&this._buffer.set(r,e)}else s.a.instance.bufferSubData(this._bufferType,e,t),this._canRead&&this._buffer.set(new Uint8Array(t),e)}getUint8Data(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")}getFloat32Data(){if(this._canRead)return this._float32Reader;throw new Error("Can't read data from VertexBuffer with only write flag!")}markAsUnreadbale(){this._canRead=!1,this._buffer=null,this._float32Reader=null}destroy(){super.destroy(),this._buffer=null,this._float32Reader=null,this._vertexDeclaration=null,this._byteLength=0}}e.a=o,r()(o,"DATATYPE_FLOAT32ARRAY",0),r()(o,"DATATYPE_UINT8ARRAY",1)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4),n=i(16);class o{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"width",void 0),r()(this,"height",void 0),this.x=t,this.y=e,this.width=i,this.height=a}get right(){return this.x+this.width}get bottom(){return this.y+this.height}setTo(t,e,i,a){return this.x=t,this.y=e,this.width=i,this.height=a,this}reset(){return this.x=this.y=this.width=this.height=0,this}recover(){this!=o.TEMP&&this!=o.EMPTY?s.a.recover("Rectangle",this.reset()):console.log("recover Temp or Empty:",this)}static create(){return s.a.getItemByClass("Rectangle",o)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}contains(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.right&&e>=this.y&&e<this.bottom)}intersects(t){return!(t.x>this.x+this.width||t.x+t.width<this.x||t.y>this.y+this.height||t.y+t.height<this.y)}intersection(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.intersects(t)?(e||(e=new o),e.x=Math.max(this.x,t.x),e.y=Math.max(this.y,t.y),e.width=Math.min(this.right,t.right)-e.x,e.height=Math.min(this.bottom,t.bottom)-e.y,e):null}union(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e||(e=new o),this.clone(e),t.width<=0||t.height<=0?e:(e.addPoint(t.x,t.y),e.addPoint(t.right,t.bottom),this)}clone(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t||(t=new o),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}toString(){return this.x+","+this.y+","+this.width+","+this.height}equals(t){return!(!t||t.x!==this.x||t.y!==this.y||t.width!==this.width||t.height!==this.height)}addPoint(t,e){return this.x>t&&(this.width+=this.x-t,this.x=t),this.y>e&&(this.height+=this.y-e,this.y=e),this.width<t-this.x&&(this.width=t-this.x),this.height<e-this.y&&(this.height=e-this.y),this}_getBoundPoints(){var t=o._temB;return t.length=0,0==this.width||0==this.height?t:(t.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),t)}static _getBoundPointS(t,e,i,a){var r=o._temA;return r.length=0,0==i||0==a?r:(r.push(t,e,t+i,e,t,e+a,t+i,e+a),r)}static _getWrapRec(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!t||t.length<1)return e?e.setTo(0,0,0,0):o.TEMP.setTo(0,0,0,0);e=e||o.create();var i,a,r,s,l,h=t.length,_=n.a.TEMP;for(r=l=-(a=s=99999),i=0;i<h;i+=2)_.x=t[i],_.y=t[i+1],a=a<_.x?a:_.x,s=s<_.y?s:_.y,r=r>_.x?r:_.x,l=l>_.y?l:_.y;return e.setTo(a,s,r-a,l-s)}isEmpty(){return this.width<=0||this.height<=0}}e.a=o,r()(o,"EMPTY",new o),r()(o,"TEMP",new o),r()(o,"_temB",[]),r()(o,"_temA",[])},function(t,e,i){"use strict";var a=i(28),r=(i.n(a),i(18)),s=(i.n(r),i(0)),n=i.n(s),o=i(3);class l{constructor(t){n()(this,"_url",void 0),n()(this,"_path",void 0),this._url=l.formatURL(t),this._path=l.getPath(t)}get url(){return this._url}get path(){return this._path}static set basePath(t){l._basePath=o.a.Laya._getUrlPath(),l._basePath=l.formatURL(t)}static get basePath(){return l._basePath}static formatURL(t){if(!t)return"null path";if(t.indexOf(":")>0)return t;if(null!=l.customFormat&&(t=l.customFormat(t)),t.indexOf(":")>0)return t;var e=t.charAt(0);if("."===e)return l._formatRelativePath(l._basePath+t);if("~"===e)return l.rootPath+t.substring(1);if("d"===e){if(0===t.indexOf("data:image"))return t}else if("/"===e)return t;return l._basePath+t}static _formatRelativePath(t){for(var e=t.split("/"),i=0,a=e.length;i<a;i++)".."==e[i]&&(e.splice(i-1,2),i-=2);return e.join("/")}static getPath(t){var e=t.lastIndexOf("/");return e>0?t.substr(0,e+1):""}static getFileName(t){var e=t.lastIndexOf("/");return e>0?t.substr(e+1):t}static getAdptedFilePath(t){if(!l.exportSceneToJson||!t)return t;var e,i,a;for(i=l._adpteTypeList.length,e=0;e<i;e++)a=l._adpteTypeList[e],t=t.replace(a[0],a[1]);return t}}e.a=l,n()(l,"version",{}),n()(l,"exportSceneToJson",!1),n()(l,"_basePath",""),n()(l,"rootPath",""),n()(l,"customFormat",function(t){var e=l.version[t];return!window.conch&&e&&(t+="?v="+e),t}),n()(l,"_adpteTypeList",[[".scene3d",".json"],[".scene",".json"],[".taa",".json"],[".prefab",".json"]])},function(t,e,i){"use strict";var a=i(34),r=i(145),s=i(109),n=i(110),o=i(150),l=i(111),h=Math.max,_=Math.min,c=Math.floor,d=/\$([$&`']|\d\d?|<[^>]*>)/g,u=/\$([$&`']|\d\d?)/g,f=function(t){return void 0===t?t:String(t)};i(112)("replace",2,function(t,e,i,m){return[function(a,r){var s=t(this),n=void 0==a?void 0:a[e];return void 0!==n?n.call(a,s,r):i.call(String(s),a,r)},function(t,e){var r=m(i,t,this,e);if(r.done)return r.value;var c=a(t),d=String(this),u="function"==typeof e;u||(e=String(e));var g=c.global;if(g){var v=c.unicode;c.lastIndex=0}for(var T=[];;){var E=l(c,d);if(null===E)break;if(T.push(E),!g)break;""===String(E[0])&&(c.lastIndex=o(d,s(c.lastIndex),v))}for(var S="",R=0,x=0;x<T.length;x++){E=T[x];for(var A=String(E[0]),y=h(_(n(E.index),d.length),0),I=[],C=1;C<E.length;C++)I.push(f(E[C]));var M=E.groups;if(u){var D=[A].concat(I,y,d);void 0!==M&&D.push(M);var b=String(e.apply(void 0,D))}else b=p(A,d,y,I,M,e);y>=R&&(S+=d.slice(R,y)+b,R=y+A.length)}return S+d.slice(R)}];function p(t,e,a,s,n,o){var l=a+t.length,h=s.length,_=u;return void 0!==n&&(n=r(n),_=d),i.call(o,_,function(i,r){var o;switch(r.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,a);case"'":return e.slice(l);case"<":o=n[r.slice(1,-1)];break;default:var _=+r;if(0===_)return i;if(_>h){var d=c(_/10);return 0===d?i:d<=h?void 0===s[d-1]?r.charAt(1):s[d-1]+r.charAt(1):i}o=s[_-1]}return void 0===o?"":o})}})},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(314);class n extends s.a{static __init__(){n.reg("TEXTURE2D",n.TEXTURE2D),n.reg("PRIMITIVE",n.PRIMITIVE),n.reg("GLOW_FILTER",n.FILTERGLOW),n.reg("BLUR_FILTER",n.FILTERBLUR),n.reg("COLOR_FILTER",n.FILTERCOLOR),n.reg("COLOR_ADD",n.COLORADD),n.reg("WORLDMAT",n.WORLDMAT),n.reg("FILLTEXTURE",n.FILLTEXTURE),n.reg("MVP3D",n.MVP3D)}constructor(){super(n.__name2int,n.__int2name,n.__int2nameMap)}static reg(t,e){this._reg(t,e,n.__name2int,n.__int2name)}static toText(t,e,i){return this._toText(t,e,i)}static toInt(t){return this._toInt(t,n.__name2int)}}e.a=n,r()(n,"TEXTURE2D",1),r()(n,"PRIMITIVE",4),r()(n,"FILTERGLOW",8),r()(n,"FILTERBLUR",16),r()(n,"FILTERCOLOR",32),r()(n,"COLORADD",64),r()(n,"WORLDMAT",128),r()(n,"FILLTEXTURE",256),r()(n,"SKINMESH",512),r()(n,"MVP3D",2048),r()(n,"NOOPTMASK",n.FILTERGLOW|n.FILTERBLUR|n.FILTERCOLOR|n.FILLTEXTURE),r()(n,"__name2int",{}),r()(n,"__int2name",[]),r()(n,"__int2nameMap",[])},function(t,e,i){"use strict";var a=i(18),r=(i.n(a),i(0)),s=i.n(r),n=i(15),o=i(146),l=i(3),h=i(358);class _{static regClass(t,e){_._classMap[t]=e}static regShortClassName(t){for(var e=0;e<t.length;e++){var i=t[e],a=i.name;_._classMap[a]=i}}static getRegClass(t){return _._classMap[t]}static getClass(t){var e=_._classMap[t]||_._classMap["Laya."+t]||t,i=l.a.Laya;return"string"==typeof e?l.a.__classMap[e]||i[t]:e}static getInstance(t){var e=_.getClass(t);return e?new e:(console.warn("[error] Undefined class:",t),null)}static createByJson(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;"string"==typeof t&&(t=JSON.parse(t));var s=t.props;if(!e&&!(e=r?r.runWith(t):_.getInstance(s.runtime||t.type)))return null;var n=t.child;if(n)for(var o=0,l=n.length;o<l;o++){var h=n[o];if("render"!==h.props.name&&"render"!==h.props.renderType||!e._$set_itemRender)if("Graphic"==h.type)_._addGraphicsToSprite(h,e);else if(_._isDrawType(h.type))_._addGraphicToSprite(h,e,!0);else{var c=_.createByJson(h,null,i,a,r);"Script"===h.type?"owner"in c?c.owner=e:"target"in c&&(c.target=e):"mask"==h.props.renderType?e.mask=c:e.addChild(c)}else e.itemRender=h}if(s)for(var d in s){var u=s[d];"var"===d&&i?i[u]=e:u instanceof Array&&e[d]instanceof Function?e[d].apply(e,u):e[d]=u}return a&&t.customProps&&a.runWith([e,t]),e.created&&e.created(),e}static _addGraphicsToSprite(t,e){var i=t.child;if(i&&!(i.length<1)){var a,r,s=_._getGraphicsFromSprite(t,e),n=0,o=0;for(t.props&&(n=_._getObjVar(t.props,"x",0),o=_._getObjVar(t.props,"y",0)),0!=n&&0!=o&&s.translate(n,o),r=i.length,a=0;a<r;a++)_._addGraphicToGraphics(i[a],s);0!=n&&0!=o&&s.translate(-n,-o)}}static _addGraphicToSprite(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?_._getGraphicsFromSprite(t,e):e.graphics;_._addGraphicToGraphics(t,i)}static _getGraphicsFromSprite(t,e){if(!t||!t.props)return e.graphics;var i=t.props.renderType;if("hit"===i||"unHit"===i){var a=e._style.hitArea||(e.hitArea=new h.a);a[i]||(a[i]=new o.a);var r=a[i]}return r||(r=e.graphics),r}static _getTransformData(t){var e;("pivotX"in t||"pivotY"in t)&&(e=e||new n.a).translate(-_._getObjVar(t,"pivotX",0),-_._getObjVar(t,"pivotY",0));var i=_._getObjVar(t,"scaleX",1),a=_._getObjVar(t,"scaleY",1),r=_._getObjVar(t,"rotation",0);_._getObjVar(t,"skewX",0),_._getObjVar(t,"skewY",0);return 1==i&&1==a&&0==r||((e=e||new n.a).scale(i,a),e.rotate(.0174532922222222*r)),e}static _addGraphicToGraphics(t,e){var i,a;if((i=t.props)&&(a=_.DrawTypeDic[t.type])){var r=e,s=_._getParams(i,a[1],a[2],a[3]),n=_._tM;(n||1!=_._alpha)&&(r.save(),n&&r.transform(n),1!=_._alpha&&r.alpha(_._alpha)),r[a[0]].apply(r,s),(n||1!=_._alpha)&&r.restore()}}static _adptLineData(t){return t[2]=parseFloat(t[0])+parseFloat(t[2]),t[3]=parseFloat(t[1])+parseFloat(t[3]),t}static _adptTextureData(t){return t[0]=l.a.Loader.getRes(t[0]),t}static _adptLinesData(t){return t[2]=_._getPointListByStr(t[2]),t}static _isDrawType(t){return"Image"!==t&&t in _.DrawTypeDic}static _getParams(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;var r,s,n,o=_._temParam;for(o.length=e.length,s=e.length,r=0;r<s;r++)o[r]=_._getObjVar(t,e[r][0],e[r][1]);return _._alpha=_._getObjVar(t,"alpha",1),(n=_._getTransformData(t))?(i||(i=0),n.translate(o[i],o[i+1]),o[i]=o[i+1]=0,_._tM=n):_._tM=null,a&&_[a]&&(o=_[a](o)),o}static _getPointListByStr(t){var e,i,a=t.split(",");for(i=a.length,e=0;e<i;e++)a[e]=parseFloat(a[e]);return a}static _getObjVar(t,e,i){return e in t?t[e]:i}}e.a=_,s()(_,"DrawTypeDic",{Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}),s()(_,"_temParam",[]),s()(_,"_classMap",{}),s()(_,"_tM",void 0),s()(_,"_alpha",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2);class n{static __init__(){var t=s.a.instance;n._elementInfos={single:[1,t.FLOAT,0],vector2:[2,t.FLOAT,0],vector3:[3,t.FLOAT,0],vector4:[4,t.FLOAT,0],color:[4,t.FLOAT,0],byte4:[4,t.UNSIGNED_BYTE,0],short2:[2,t.FLOAT,0],short4:[4,t.FLOAT,0],normalizedshort2:[2,t.FLOAT,0],normalizedshort4:[4,t.FLOAT,0],halfvector2:[2,t.FLOAT,0],halfvector4:[4,t.FLOAT,0]}}static getElementInfos(t){var e=n._elementInfos[t];if(e)return e;throw"VertexElementFormat: this vertexElementFormat is not implement."}}e.a=n,r()(n,"Single","single"),r()(n,"Vector2","vector2"),r()(n,"Vector3","vector3"),r()(n,"Vector4","vector4"),r()(n,"Color","color"),r()(n,"Byte4","byte4"),r()(n,"Short2","short2"),r()(n,"Short4","short4"),r()(n,"NormalizedShort2","normalizedshort2"),r()(n,"NormalizedShort4","normalizedshort4"),r()(n,"HalfVector2","halfvector2"),r()(n,"HalfVector4","halfvector4"),r()(n,"_elementInfos",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(46),o=i(9),l=i(20),h=i(1),_=i(5),c=i(54),d=i(8);class u{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;r()(this,"_ownerResource",null),r()(this,"_data",null),r()(this,"_defineDatas",new c.a),r()(this,"_int32Data",void 0),r()(this,"_float32Data",void 0),r()(this,"_nativeArray",void 0),r()(this,"_frameCount",void 0),r()(this,"_runtimeCopyValues",[]),this._ownerResource=t,this._initData()}_initData(){this._data=new Object}getData(){return this._data}addDefine(t){this._defineDatas.add(t)}removeDefine(t){this._defineDatas.remove(t)}hasDefine(t){return this._defineDatas.has(t)}clearDefine(){this._defineDatas.clear()}getBool(t){return this._data[t]}setBool(t,e){this._data[t]=e}getInt(t){return this._data[t]}setInt(t,e){this._data[t]=e}getNumber(t){return this._data[t]}setNumber(t,e){this._data[t]=e}getVector2(t){return this._data[t]}setVector2(t,e){this._data[t]=e}getVector3(t){return this._data[t]}setVector3(t,e){this._data[t]=e}getVector(t){return this._data[t]}setVector(t,e){this._data[t]=e}getQuaternion(t){return this._data[t]}setQuaternion(t,e){this._data[t]=e}getMatrix4x4(t){return this._data[t]}setMatrix4x4(t,e){this._data[t]=e}getBuffer(t){return this._data[t]}setBuffer(t,e){this._data[t]=e}setTexture(t,e){var i=this._data[t];this._data[t]=e,this._ownerResource&&this._ownerResource.referenceCount>0&&(i&&i._removeReference(),e&&e._addReference())}getTexture(t){return this._data[t]}setAttribute(t,e){this._data[t]=e}getAttribute(t){return this._data[t]}getLength(){return this._data.length}setLength(t){this._data.length=t}cloneTo(t){var e=t,i=e._data;for(var a in this._data){var r=this._data[a];if(null!=r)if("number"==typeof r)i[a]=r;else if("number"==typeof r)i[a]=r;else if("boolean"==typeof r)i[a]=r;else if(r instanceof l.a){var s=i[a]||(i[a]=new l.a);r.cloneTo(s),i[a]=s}else if(r instanceof h.a){var c=i[a]||(i[a]=new h.a);r.cloneTo(c),i[a]=c}else if(r instanceof _.a){var d=i[a]||(i[a]=new _.a);r.cloneTo(d),i[a]=d}else if(r instanceof o.a){var u=i[a]||(i[a]=new o.a);r.cloneTo(u),i[a]=u}else r instanceof n.a&&(i[a]=r)}this._defineDatas.cloneTo(e._defineDatas)}clone(){var t=new u;return this.cloneTo(t),t}cloneToForNative(t){var e=t;this._int32Data.length-e._int32Data.length>0&&e.needRenewArrayBufferForNative(this._int32Data.length),e._int32Data.set(this._int32Data,0);var i=e._nativeArray,a=this._nativeArray.length;i.length=a;for(var r=0;r<a;r++){var s=this._nativeArray[r];if(s)if("number"==typeof s)i[r]=s,e.setNumber(r,s);else if("number"==typeof s)i[r]=s,e.setInt(r,s);else if("boolean"==typeof s)i[r]=s,e.setBool(r,s);else if(s instanceof l.a){var c=i[r]||(i[r]=new l.a);s.cloneTo(c),i[r]=c,e.setVector2(r,c)}else if(s instanceof h.a){var d=i[r]||(i[r]=new h.a);s.cloneTo(d),i[r]=d,e.setVector3(r,d)}else if(s instanceof _.a){var u=i[r]||(i[r]=new _.a);s.cloneTo(u),i[r]=u,e.setVector(r,u)}else if(s instanceof o.a){var f=i[r]||(i[r]=new o.a);s.cloneTo(f),i[r]=f,e.setMatrix4x4(r,f)}else s instanceof n.a&&(i[r]=s,e.setTexture(r,s))}this._defineDatas.cloneTo(e._defineDatas)}_initDataForNative(){this._frameCount=-1,this._runtimeCopyValues.length=0,this._nativeArray=[],this._data=new ArrayBuffer(32),this._int32Data=new Int32Array(this._data),this._float32Data=new Float32Array(this._data),s.a.instance.createArrayBufferRef(this._data,s.a.ARRAY_BUFFER_TYPE_DATA,!0)}needRenewArrayBufferForNative(t){if(t>=this._int32Data.length){var e=4*(t+1),i=this._int32Data,a=this._data.conchRef,r=this._data._ptrID;this._data=new ArrayBuffer(e),this._int32Data=new Int32Array(this._data),this._float32Data=new Float32Array(this._data),this._data.conchRef=a,this._data._ptrID=r,i&&this._int32Data.set(i,0);var n=s.a.instance;n.updateArrayBufferRef?n.updateArrayBufferRef(this._data._ptrID,a.isSyncToRender(),this._data):window.conch.updateArrayBufferRef(this._data._ptrID,a.isSyncToRender(),this._data)}}getDataForNative(){return this._nativeArray}getIntForNative(t){return this._int32Data[t]}setIntForNative(t,e){this.needRenewArrayBufferForNative(t),this._int32Data[t]=e,this._nativeArray[t]=e}getBoolForNative(t){return 1==this._int32Data[t]}setBoolForNative(t,e){this.needRenewArrayBufferForNative(t),this._int32Data[t]=e?1:0,this._nativeArray[t]=e}getNumberForNative(t){return this._float32Data[t]}setNumberForNative(t,e){this.needRenewArrayBufferForNative(t),this._float32Data[t]=e,this._nativeArray[t]=e}getMatrix4x4ForNative(t){return this._nativeArray[t]}setMatrix4x4ForNative(t,e){this.needRenewArrayBufferForNative(t),this._nativeArray[t]=e;var i=this.setReferenceForNative(e.elements);this._int32Data[t]=i}getVectorForNative(t){return this._nativeArray[t]}setVectorForNative(t,e){this.needRenewArrayBufferForNative(t),this._nativeArray[t]=e,e.elements||e.forNativeElement();var i=this.setReferenceForNative(e.elements);this._int32Data[t]=i}getVector2ForNative(t){return this._nativeArray[t]}setVector2ForNative(t,e){this.needRenewArrayBufferForNative(t),this._nativeArray[t]=e,e.elements||e.forNativeElement();var i=this.setReferenceForNative(e.elements);this._int32Data[t]=i}getVector3ForNative(t){return this._nativeArray[t]}setVector3ForNative(t,e){this.needRenewArrayBufferForNative(t),this._nativeArray[t]=e,e.elements||e.forNativeElement();var i=this.setReferenceForNative(e.elements);this._int32Data[t]=i}getQuaternionForNative(t){return this._nativeArray[t]}setQuaternionForNative(t,e){this.needRenewArrayBufferForNative(t),this._nativeArray[t]=e,e.elements||e.forNativeElement();var i=this.setReferenceForNative(e.elements);this._int32Data[t]=i}getBufferForNative(t){return this._nativeArray[t]}setBufferForNative(t,e){this.needRenewArrayBufferForNative(t),this._nativeArray[t]=e;var i=this.setReferenceForNative(e);this._int32Data[t]=i}getAttributeForNative(t){return this._nativeArray[t]}setAttributeForNative(t,e){this._nativeArray[t]=e,e._ptrID||s.a.instance.createArrayBufferRef(e,s.a.ARRAY_BUFFER_TYPE_DATA,!0),s.a.instance.syncBufferToRenderThread(e),this._int32Data[t]=e._ptrID}getTextureForNative(t){return this._nativeArray[t]}setTextureForNative(t,e){if(e){this.needRenewArrayBufferForNative(t);var i=this._nativeArray[t];this._nativeArray[t]=e;var a=e._getSource()||e.defaulteTexture._getSource();this._int32Data[t]=a.id,this._ownerResource&&this._ownerResource.referenceCount>0&&(i&&i._removeReference(),e&&e._addReference())}}setReferenceForNative(t){this.clearRuntimeCopyArray();var e=0,i=0;return u._SET_RUNTIME_VALUE_MODE_REFERENCE_?(s.a.instance.createArrayBufferRefs(t,s.a.ARRAY_BUFFER_TYPE_DATA,!0,s.a.ARRAY_BUFFER_REF_REFERENCE),e=0,i=t.getPtrID(e)):(s.a.instance.createArrayBufferRefs(t,s.a.ARRAY_BUFFER_TYPE_DATA,!0,s.a.ARRAY_BUFFER_REF_COPY),e=t.getRefNum()-1,i=t.getPtrID(e),this._runtimeCopyValues.push({obj:t,refID:e,ptrID:i})),s.a.instance.syncBufferToRenderThread(t,e),i}static setRuntimeValueMode(t){u._SET_RUNTIME_VALUE_MODE_REFERENCE_=t}clearRuntimeCopyArray(){var t=d.a.loopCount;if(this._frameCount!=t){this._frameCount=t;for(var e=0,i=this._runtimeCopyValues.length;e<i;e++){this._runtimeCopyValues[e].obj.clearRefNum()}this._runtimeCopyValues.length=0}}}e.a=u,r()(u,"_SET_RUNTIME_VALUE_MODE_REFERENCE_",!0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(122),n=i(12),o=i(27),l=i(172),h=i(7),_=i(85),c=i(58);class d extends s.a{static __init__(){}static instantiate(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;var s=t.clone();e&&e.addChild(s);var n=s.transform;if(i){var o=n.worldMatrix;t.transform.worldMatrix.cloneTo(o),n.worldMatrix=o}else a&&(n.position=a),r&&(n.rotation=r);return s}static load(t,e){c.a.loader.create(t,e,null,d.HIERARCHY)}get id(){return this._id}get layer(){return this._layer}set layer(t){if(this._layer!==t){if(!(t>=0&&t<=30))throw new Error("Layer value must be 0-30.");this._layer=t}}get url(){return this._url}get isStatic(){return this._isStatic}get transform(){return this._transform}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),r()(this,"_id",void 0),r()(this,"_url",void 0),r()(this,"_isStatic",void 0),r()(this,"_layer",void 0),r()(this,"_scripts",void 0),r()(this,"_transform",void 0),r()(this,"_hierarchyAnimator",void 0),r()(this,"_needProcessCollisions",!1),r()(this,"_needProcessTriggers",!1),this._id=++d._uniqueIDCounter,this._transform=new _.a(this),this._isStatic=e,this.layer=0,this.name=t||"New Sprite3D"}_setCreateURL(t){this._url=o.a.formatURL(t)}_changeAnimatorsToLinkSprite3D(t,e,i){var a=this.getComponent(l.a);if(a&&(a.avatar||t._changeAnimatorToLinkSprite3DNoAvatar(a,e,i)),this._parent&&this._parent instanceof d){i.unshift(this._parent.name);var r=this._parent;r._hierarchyAnimator&&r._changeAnimatorsToLinkSprite3D(t,e,i)}}_setHierarchyAnimator(t,e){this._changeHierarchyAnimator(t),this._changeAnimatorAvatar(t.avatar);for(var i=0,a=this._children.length;i<a;i++){var r=this._children[i];r._hierarchyAnimator==e&&r._setHierarchyAnimator(t,e)}}_clearHierarchyAnimator(t,e){this._changeHierarchyAnimator(e),this._changeAnimatorAvatar(e?e.avatar:null);for(var i=0,a=this._children.length;i<a;i++){var r=this._children[i];r._hierarchyAnimator==t&&r._clearHierarchyAnimator(t,e)}}_changeHierarchyAnimatorAvatar(t,e){this._changeAnimatorAvatar(e);for(var i=0,a=this._children.length;i<a;i++){var r=this._children[i];r._hierarchyAnimator==t&&r._changeHierarchyAnimatorAvatar(t,e)}}_changeAnimatorToLinkSprite3DNoAvatar(t,e,i){t._handleSpriteOwnersBySprite(e,i,this);for(var a=0,r=this._children.length;a<r;a++){var s=this._children[a],n=i.length;i.push(s.name),s._changeAnimatorToLinkSprite3DNoAvatar(t,e,i),i.splice(n,1)}}_changeHierarchyAnimator(t){this._hierarchyAnimator=t}_changeAnimatorAvatar(t){}_onAdded(){if(this._parent instanceof d){var t=this._parent;this.transform._setParent(t.transform),t._hierarchyAnimator&&(!this._hierarchyAnimator&&this._setHierarchyAnimator(t._hierarchyAnimator,null),t._changeAnimatorsToLinkSprite3D(this,!0,[this.name]))}super._onAdded()}_onRemoved(){if(super._onRemoved(),this._parent instanceof d){var t=this._parent;this.transform._setParent(null),t._hierarchyAnimator&&(this._hierarchyAnimator==t._hierarchyAnimator&&this._clearHierarchyAnimator(t._hierarchyAnimator,null),t._changeAnimatorsToLinkSprite3D(this,!1,[this.name]))}}_parse(t,e){if(void 0!==t.isStatic&&(this._isStatic=t.isStatic),void 0!==t.active&&(this.active=t.active),void 0!=t.name&&(this.name=t.name),void 0!==t.position){var i=this.transform.localPosition;i.fromArray(t.position),this.transform.localPosition=i}if(void 0!==t.rotationEuler){var a=this.transform.localRotationEuler;a.fromArray(t.rotationEuler),this.transform.localRotationEuler=a}if(void 0!==t.rotation){var r=this.transform.localRotation;r.fromArray(t.rotation),this.transform.localRotation=r}if(void 0!==t.scale){var s=this.transform.localScale;s.fromArray(t.scale),this.transform.localScale=s}void 0!=t.layer&&(this.layer=t.layer)}_cloneTo(t,e,i){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var a=t,r=this._transform,s=a._transform;a.name=this.name,a.destroyed=this.destroyed,a.active=this.active,s.localPosition=r.localPosition,s.localRotation=r.localRotation,s.localScale=r.localScale,a._isStatic=this._isStatic,a.layer=this.layer,super._cloneTo(a,e,i)}static _createSprite3DInstance(t){for(var e=t._create(),i=t._children,a=0,r=i.length;a<r;a++){var s=d._createSprite3DInstance(i[a]);e.addChild(s)}return e}static _parseSprite3DInstance(t,e,i,a){for(var r=i._children,s=a._children,n=0,o=r.length;n<o;n++)d._parseSprite3DInstance(t,e,r[n],s[n]);i._cloneTo(a,t,e)}clone(){var t=d._createSprite3DInstance(this);return d._parseSprite3DInstance(this,t,this,t),t}destroy(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.destroyed||(super.destroy(t),this._transform=null,this._scripts=null,this._url&&n.a.clearRes(this._url))}_create(){return new d}}e.a=d,r()(d,"HIERARCHY","HIERARCHY"),r()(d,"WORLDMATRIX",h.a.propertyNameToID("u_WorldMat")),r()(d,"MVPMATRIX",h.a.propertyNameToID("u_MvpMatrix")),r()(d,"_uniqueIDCounter",0)},function(t,e,i){var a=i(77);t.exports=function(t){if(!a(t))throw TypeError(t+" is not an object!");return t}},function(t,e,i){var a=i(143)("wks"),r=i(142),s=i(44).Symbol,n="function"==typeof s;(t.exports=function(t){return a[t]||(a[t]=n&&s[t]||(n?s:r)("Symbol."+t))}).store=a},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(92),n=i(316),o=i(29),l=i(66),h=i(3);class _{static _initone(t,e){_._typeClass[t]=e,_._cache[t]=[],_._cache[t]._length=0}static __init__(){}constructor(t,e){r()(this,"defines",new o.a),r()(this,"size",[0,0]),r()(this,"alpha",1),r()(this,"mmat",void 0),r()(this,"u_MvpMatrix",void 0),r()(this,"texture",void 0),r()(this,"ALPHA",1),r()(this,"shader",void 0),r()(this,"mainID",void 0),r()(this,"subID",0),r()(this,"filters",void 0),r()(this,"textureHost",void 0),r()(this,"color",void 0),r()(this,"colorAdd",void 0),r()(this,"u_mmat2",void 0),r()(this,"ref",1),r()(this,"_attribLocation",void 0),r()(this,"_inClassCache",void 0),r()(this,"_cacheID",0),r()(this,"clipMatDir",[h.a.Context._MAXSIZE,0,0,h.a.Context._MAXSIZE]),r()(this,"clipMatPos",[0,0]),r()(this,"clipOff",[0,0]),this.mainID=t,this.subID=e,this.textureHost=null,this.texture=null,this.color=null,this.colorAdd=null,this.u_mmat2=null,this._cacheID=t|e,this._inClassCache=_._cache[this._cacheID],t>0&&!this._inClassCache&&(this._inClassCache=_._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}setValue(t){}_ShaderWithCompile(){return s.a.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,n.a.create,this._attribLocation)}upload(){var t=l.a;l.a.worldMatrix4===l.a.TEMPMAT4_ARRAY||this.defines.addInt(o.a.WORLDMAT),this.mmat=t.worldMatrix4,l.a.matWVP&&(this.defines.addInt(o.a.MVP3D),this.u_MvpMatrix=l.a.matWVP.elements);var e=s.a.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();e._shaderValueWidth!==t.width||e._shaderValueHeight!==t.height?(this.size[0]=t.width,this.size[1]=t.height,e._shaderValueWidth=t.width,e._shaderValueHeight=t.height,e.upload(this,null)):e.upload(this,e._params2dQuick2||e._make2dQuick2())}setFilters(t){if(this.filters=t,t)for(var e,i=t.length,a=0;a<i;a++)(e=t[a])&&(this.defines.add(e.type),e.action.setValue(this))}clear(){this.defines._value=this.subID,this.clipOff[0]=0}release(){--this.ref<1&&(this._inClassCache&&(this._inClassCache[this._inClassCache._length++]=this),this.clear(),this.filters=null,this.ref=1,this.clipOff[0]=0)}static create(t,e){var i=_._cache[t|e];return i._length?i[--i._length]:new _._typeClass[t|e](e)}}e.a=_,r()(_,"_cache",[]),r()(_,"_typeClass",[]),r()(_,"TEMPMAT4_ARRAY",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(3),n=i(69),o=i(2),l=i(82),h=i(97),_=i(10),c=i(67),d=i(227),u=i(29),f=i(36),m=i(158),p=i(61),g=i(352),v=i(19);class T{constructor(t,e,i){r()(this,"_timeId",0),T._mainCanvas=i;let a=T._mainCanvas.source;a.id="layaCanvas",a.width=t,a.height=e,T.isConchApp&&document.body.appendChild(a),this.initRender(T._mainCanvas,t,e),window.requestAnimationFrame(function t(e){s.a.stage._loop();window.requestAnimationFrame(t)}),s.a.stage.on("visibilitychange",this,this._onVisibilitychange)}_onVisibilitychange(){s.a.stage.isVisibility?0!=this._timeId&&window.clearInterval(this._timeId):this._timeId=window.setInterval(this._enterFrame,1e3)}initRender(t,e,i){var a=o.a.instance=_.a.mainContext=function(t){var e,i=["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"];n.a.useWebGL2&&!v.a.onBDMiniGame||i.shift();for(var a=0;a<i.length;a++){try{e=t.getContext(i[a],{stencil:n.a.isStencil,alpha:n.a.isAlpha,antialias:n.a.isAntialias,premultipliedAlpha:n.a.premultipliedAlpha,preserveDrawingBuffer:n.a.preserveDrawingBuffer})}catch(t){}if(e)return"webgl2"===i[a]&&(h.a._isWebGL2=!0),new o.a,e}return null}(T._mainCanvas.source);if(!a)return!1;o.a.instance=a,o.a.layaGPUInstance=new g.a(a,h.a._isWebGL2),t.size(e,i),l.a.__init__(),p.a.__init__();var r=new l.a;return r.isMain=!0,T._context=r,t._setContext(r),u.a.__init__(),f.a.__init__(),d.a.__init__(),m.a.__int__(a),c.a._init_(a),!0}_enterFrame(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];s.a.stage._loop()}static get context(){return T._context}static get canvas(){return T._mainCanvas.source}}e.a=T,r()(T,"_context",void 0),r()(T,"_mainCanvas",void 0),r()(T,"supportWebGLPlusAnimation",!1),r()(T,"supportWebGLPlusRendering",!1),r()(T,"isConchApp",!1),r()(T,"is3DMode",void 0),T.isConchApp=null!=window.conch,T.isConchApp?T.supportWebGLPlusRendering=!1:null!=window.qq&&null!=window.qq.webglPlus&&(T.supportWebGLPlusRendering=!1)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(157);e.a=class extends n.a{constructor(){super(),r()(this,"vertexDeclaration",void 0)}applyVertexBuffer(t){if(n.a._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";var e=s.a.instance,i=t.vertexDeclaration,a=i._shaderValues.getData();for(var r in this.vertexDeclaration=i,t.bind(),a){var o=parseInt(r),l=a[r];e.enableVertexAttribArray(o),e.vertexAttribPointer(o,l[0],l[1],!!l[2],l[3],l[4])}}applyVertexBuffers(t){if(n.a._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";for(var e=s.a.instance,i=0,a=t.length;i<a;i++){var r=t[i],o=r.vertexDeclaration._shaderValues.getData();for(var l in r.bind(),o){var h=parseInt(l),_=o[l];e.enableVertexAttribArray(h),e.vertexAttribPointer(h,_[0],_[1],!!_[2],_[3],_[4])}}}applyInstanceVertexBuffer(t){if(s.a.layaGPUInstance.supportInstance()){if(n.a._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";var e=s.a.instance,i=t.vertexDeclaration._shaderValues.getData();for(var a in t.bind(),i){var r=parseInt(a),o=i[a];e.enableVertexAttribArray(r),e.vertexAttribPointer(r,o[0],o[1],!!o[2],o[3],o[4]),s.a.layaGPUInstance.vertexAttribDivisor(r,1)}}}applyIndexBuffer(t){if(n.a._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";this._bindedIndexBuffer!==t&&(t._bindForVAO(),this._bindedIndexBuffer=t)}}},function(t,e,i){"use strict";let a;i.d(e,"a",function(){return a}),function(t){t[t.UInt8=0]="UInt8",t[t.UInt16=1]="UInt16",t[t.UInt32=2]="UInt32"}(a||(a={}))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(5);class n{constructor(){r()(this,"cull",void 0),r()(this,"blend",void 0),r()(this,"srcBlend",void 0),r()(this,"dstBlend",void 0),r()(this,"srcBlendRGB",void 0),r()(this,"dstBlendRGB",void 0),r()(this,"srcBlendAlpha",void 0),r()(this,"dstBlendAlpha",void 0),r()(this,"blendConstColor",void 0),r()(this,"blendEquation",void 0),r()(this,"blendEquationRGB",void 0),r()(this,"blendEquationAlpha",void 0),r()(this,"depthTest",void 0),r()(this,"depthWrite",void 0),this.cull=n.CULL_BACK,this.blend=n.BLEND_DISABLE,this.srcBlend=n.BLENDPARAM_ONE,this.dstBlend=n.BLENDPARAM_ZERO,this.srcBlendRGB=n.BLENDPARAM_ONE,this.dstBlendRGB=n.BLENDPARAM_ZERO,this.srcBlendAlpha=n.BLENDPARAM_ONE,this.dstBlendAlpha=n.BLENDPARAM_ZERO,this.blendConstColor=new s.a(1,1,1,1),this.blendEquation=n.BLENDEQUATION_ADD,this.blendEquationRGB=n.BLENDEQUATION_ADD,this.blendEquationAlpha=n.BLENDEQUATION_ADD,this.depthTest=n.DEPTHTEST_LEQUAL,this.depthWrite=!0}cloneTo(t){var e=t;e.cull=this.cull,e.blend=this.blend,e.srcBlend=this.srcBlend,e.dstBlend=this.dstBlend,e.srcBlendRGB=this.srcBlendRGB,e.dstBlendRGB=this.dstBlendRGB,e.srcBlendAlpha=this.srcBlendAlpha,e.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo(e.blendConstColor),e.blendEquation=this.blendEquation,e.blendEquationRGB=this.blendEquationRGB,e.blendEquationAlpha=this.blendEquationAlpha,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite}clone(){var t=new n;return this.cloneTo(t),t}}e.a=n,r()(n,"CULL_NONE",0),r()(n,"CULL_FRONT",1),r()(n,"CULL_BACK",2),r()(n,"BLEND_DISABLE",0),r()(n,"BLEND_ENABLE_ALL",1),r()(n,"BLEND_ENABLE_SEPERATE",2),r()(n,"BLENDPARAM_ZERO",0),r()(n,"BLENDPARAM_ONE",1),r()(n,"BLENDPARAM_SRC_COLOR",768),r()(n,"BLENDPARAM_ONE_MINUS_SRC_COLOR",769),r()(n,"BLENDPARAM_DST_COLOR",774),r()(n,"BLENDPARAM_ONE_MINUS_DST_COLOR",775),r()(n,"BLENDPARAM_SRC_ALPHA",770),r()(n,"BLENDPARAM_ONE_MINUS_SRC_ALPHA",771),r()(n,"BLENDPARAM_DST_ALPHA",772),r()(n,"BLENDPARAM_ONE_MINUS_DST_ALPHA",773),r()(n,"BLENDPARAM_SRC_ALPHA_SATURATE",776),r()(n,"BLENDEQUATION_ADD",32774),r()(n,"BLENDEQUATION_SUBTRACT",32778),r()(n,"BLENDEQUATION_REVERSE_SUBTRACT",32779),r()(n,"DEPTHTEST_OFF",0),r()(n,"DEPTHTEST_NEVER",512),r()(n,"DEPTHTEST_LESS",513),r()(n,"DEPTHTEST_EQUAL",514),r()(n,"DEPTHTEST_LEQUAL",515),r()(n,"DEPTHTEST_GREATER",516),r()(n,"DEPTHTEST_NOTEQUAL",517),r()(n,"DEPTHTEST_GEQUAL",518),r()(n,"DEPTHTEST_ALWAYS",519)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(5),n=i(7),o=i(33),l=i(11);class h extends o.a{static __init__(){h.SHADERDEFINE_RECEIVE_SHADOW=n.a.getDefineByName("RECEIVESHADOW"),h.SAHDERDEFINE_LIGHTMAP=n.a.getDefineByName("LIGHTMAP"),h.SHADERDEFINE_LIGHTMAP_DIRECTIONAL=n.a.getDefineByName("LIGHTMAP_DIRECTIONAL")}constructor(t){super(t),r()(this,"pickColor",void 0),r()(this,"_render",void 0)}_onInActive(){super._onInActive(),this._scene._removeRenderObject(this._render)}_onActive(){super._onActive(),this._scene._addRenderObject(this._render)}_onActiveInScene(){if(super._onActiveInScene(),l.a.Laya3D._editerEnvironment){var t=this._scene,e=new s.a;t._allotPickColorByID(this.id,e),t._pickIdToSprite[this.id]=this,this._render._shaderValues.setVector(h.PICKCOLOR,e)}}_addToInitStaticBatchManager(){}_setBelongScene(t){super._setBelongScene(t),this._render._setBelongScene(t)}_setUnBelongScene(){this._render._shaderValues.removeDefine(h.SAHDERDEFINE_LIGHTMAP),super._setUnBelongScene()}_changeHierarchyAnimator(t){if(this._hierarchyAnimator){var e=this._hierarchyAnimator._renderableSprites;e.splice(e.indexOf(this),1)}t&&t._renderableSprites.push(this),super._changeHierarchyAnimator(t)}destroy(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];super.destroy(t),this._render._destroy(),this._render=null}_create(){return new h(this.name)}}e.a=h,r()(h,"SHADERDEFINE_RECEIVE_SHADOW",void 0),r()(h,"SAHDERDEFINE_LIGHTMAP",void 0),r()(h,"SHADERDEFINE_LIGHTMAP_DIRECTIONAL",void 0),r()(h,"LIGHTMAPSCALEOFFSET",n.a.propertyNameToID("u_LightmapScaleOffset")),r()(h,"LIGHTMAP",n.a.propertyNameToID("u_LightMap")),r()(h,"LIGHTMAP_DIRECTION",n.a.propertyNameToID("u_LightMapDirection")),r()(h,"PICKCOLOR",n.a.propertyNameToID("u_PickColor")),r()(h,"REFLECTIONTEXTURE",n.a.propertyNameToID("u_ReflectTexture")),r()(h,"REFLECTIONCUBE_HDR_PARAMS",n.a.propertyNameToID("u_ReflectCubeHDRParams")),r()(h,"REFLECTIONCUBE_PROBEPOSITION",n.a.propertyNameToID("u_SpecCubeProbePosition")),r()(h,"REFLECTIONCUBE_PROBEBOXMAX",n.a.propertyNameToID("u_SpecCubeBoxMax")),r()(h,"REFLECTIONCUBE_PROBEBOXMIN",n.a.propertyNameToID("u_SpecCubeBoxMin"))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(3),n=i(2),o=i(10),l=i(46),h=i(60),_=i(90),c=i(79),d=i(81),u=i(114);class f extends l.a{static __init__(){var t=new Uint8Array(3);t[0]=128,t[1]=128,t[2]=128,f.grayTexture=new f(1,1,h.a.R8G8B8,!1,!1),f.grayTexture.setPixels(t),f.grayTexture.lock=!0,t[0]=255,t[1]=255,t[2]=255,f.whiteTexture=new f(1,1,h.a.R8G8B8,!1,!1),f.whiteTexture.setPixels(t),f.whiteTexture.lock=!0,t[0]=0,t[1]=0,t[2]=0,f.blackTexture=new f(1,1,h.a.R8G8B8,!1,!1),f.blackTexture.setPixels(t),f.blackTexture.lock=!0}static _parse(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;var a=i?new f(i[0],i[1],i[2],i[3],i[4]):new f(0,0);switch(e&&(a.wrapModeU=e.wrapModeU,a.wrapModeV=e.wrapModeV,a.filterMode=e.filterMode,a.anisoLevel=e.anisoLevel),a._format){case h.a.R8G8B8:case h.a.R8G8B8A8:a.loadImageSource(t);break;case h.a.DXT1:case h.a.DXT5:case h.a.ETC1RGB:case h.a.PVRTCRGB_2BPPV:case h.a.PVRTCRGBA_2BPPV:case h.a.PVRTCRGB_4BPPV:case h.a.PVRTCRGBA_4BPPV:a.setCompressData(t);break;default:throw"Texture2D:unkonwn format."}return a}static _SimpleAnimatorTextureParse(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];var e,i,a=new _.a(t);switch(a.readUTFString()){case"LAYAANIMATORTEXTURE:0000":var r,s=a.readInt32(),n=a.readInt32();e=new Float32Array(s*s*4),i=new Float32Array(a.readArrayBuffer(4*n)),e.set(i,0),(r=new f(s,s,h.a.R32G32B32A32,!1,!1)).setPixels(e,0),r.filterMode=c.a.Point;break;case"LAYACOMPRESSANIMATORTEXTURE:0000":s=a.readInt32(),n=a.readInt32();if(e=new Uint16Array(a.readArrayBuffer(2*n)),d.a.supportTextureFormat(h.a.R16G16B16A16))(i=new Uint16Array(s*s*4)).set(e,0),(r=new f(s,s,h.a.R16G16B16A16,!1,!1)).setPixels(i,0),r.filterMode=c.a.Point;else{console.log("The platform does not support 16-bit floating-point textures"),d.a.supportTextureFormat(h.a.R32G32B32A32)||console.error("The platform does not support 32-bit floating-point textures"),i=new Float32Array(s*s*4);for(var o=0,l=e.length;o<l;o++)i[o]=u.a.convertToNumber(e[o]);(r=new f(s,s,h.a.R32G32B32A32,!1,!1)).setPixels(i,0),r.filterMode=c.a.Point}break;default:throw"Laya3D:unknow version."}return r}static load(t,e){s.a.loader.create(t,e,null,s.a.Loader.TEXTURE2D)}get defaulteTexture(){return f.grayTexture}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.a.R8G8B8A8,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(i,a),r()(this,"_canRead",void 0),r()(this,"_pixels",void 0);var o=n.a.instance;this._glTextureType=o.TEXTURE_2D,this._width=t,this._height=e,this._canRead=s,this._setWarpMode(o.TEXTURE_WRAP_S,this._wrapModeU),this._setWarpMode(o.TEXTURE_WRAP_T,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel);var l=this._gpuCompressFormat();if(a){var _=Math.max(Math.ceil(Math.log2(t))+1,Math.ceil(Math.log2(e))+1);if(!l)for(var c=0;c<_;c++)this._setPixels(null,c,Math.max(t>>c,1),Math.max(e>>c,1));this._mipmapCount=_,this._setGPUMemory(t*e*4*(1+1/3))}else l||this._setPixels(null,0,t,e),this._mipmapCount=1,this._setGPUMemory(t*e*4)}_gpuCompressFormat(){return this._format==h.a.DXT1||this._format==h.a.DXT5||this._format==h.a.ETC1RGB||this._format==h.a.PVRTCRGB_2BPPV||this._format==h.a.PVRTCRGBA_2BPPV||this._format==h.a.PVRTCRGB_4BPPV||this._format==h.a.PVRTCRGBA_4BPPV}_setPixels(t,e,i,a){var r=n.a.instance,s=this._glTextureType,l=this._getGLFormat();switch(o.a.bindTexture(r,s,this._glTexture),this.format){case h.a.R8G8B8:r.pixelStorei(r.UNPACK_ALIGNMENT,1),r.texImage2D(s,e,l,i,a,0,l,r.UNSIGNED_BYTE,t),r.pixelStorei(r.UNPACK_ALIGNMENT,4);break;case h.a.R5G6B5:r.pixelStorei(r.UNPACK_ALIGNMENT,2),r.texImage2D(s,e,l,i,a,0,l,r.UNSIGNED_SHORT_5_6_5,t),r.pixelStorei(r.UNPACK_ALIGNMENT,4);break;case h.a.R32G32B32A32:n.a.layaGPUInstance._isWebGL2?r.texImage2D(s,e,r.RGBA32F,i,a,0,l,r.FLOAT,t):r.texImage2D(s,e,r.RGBA,i,a,0,l,r.FLOAT,t);break;case h.a.R16G16B16A16:n.a.layaGPUInstance._isWebGL2?r.texImage2D(s,e,r.RGBA16F,i,a,0,l,r.HALF_FLOAT,t):r.texImage2D(s,e,r.RGBA,i,a,0,l,n.a.layaGPUInstance._oesTextureHalfFloat.HALF_FLOAT_OES,t);break;default:r.texImage2D(s,e,l,i,a,0,l,r.UNSIGNED_BYTE,t)}}_calcualatesCompressedDataSize(t,e,i){switch(t){case h.a.DXT1:case h.a.ETC1RGB:return(e+3>>2)*(i+3>>2)*8;case h.a.DXT5:return(e+3>>2)*(i+3>>2)*16;case h.a.PVRTCRGB_4BPPV:case h.a.PVRTCRGBA_4BPPV:return Math.floor((Math.max(e,8)*Math.max(i,8)*4+7)/8);case h.a.PVRTCRGB_2BPPV:case h.a.PVRTCRGBA_2BPPV:return Math.floor((Math.max(e,16)*Math.max(i,8)*2+7)/8);default:return 0}}_pharseDDS(t){var e=new Int32Array(t,0,31);if(542327876!=e[0])throw"Invalid magic number in DDS header";if(!(4&e[20]))throw"Unsupported format, must contain a FourCC code";var i=e[21];switch(this._format){case h.a.DXT1:if(827611204!==i)throw"the FourCC code is not same with texture format.";break;case h.a.DXT5:if(894720068!==i)throw"the FourCC code is not same with texture format.";break;default:throw"unknown texture format."}var a=1;if(131072&e[2]){if(a=Math.max(1,e[7]),!this._mipmap)throw"the mipmap is not same with Texture2D."}else if(this._mipmap)throw"the mipmap is not same with Texture2D.";var r=e[4],s=e[3];this._width=r,this._height=s;var n=e[1]+4;this._upLoadCompressedTexImage2D(t,r,s,a,n,0)}_pharseKTX(t){var e=new Uint8Array(t,0,12);if(171!=e[0]||75!=e[1]||84!=e[2]||88!=e[3]||32!=e[4]||49!=e[5]||49!=e[6]||187!=e[7]||13!=e[8]||10!=e[9]||26!=e[10]||10!=e[11])throw"Invalid fileIdentifier in KTX header";var i=new Int32Array(e.buffer,e.length,13);switch(i[4]){case n.a.layaGPUInstance._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL:this._format=h.a.ETC1RGB;break;default:throw"unknown texture format."}var a=i[11],r=i[6],s=i[7];this._width=r,this._height=s;var o=64+i[12];this._upLoadCompressedTexImage2D(t,r,s,a,o,4)}_pharsePVR(t){var e=new Int32Array(t,0,13);if(55727696!=e[0])throw"Invalid magic number in PVR header";switch(e[2]){case 0:this._format=h.a.PVRTCRGB_2BPPV;break;case 2:this._format=h.a.PVRTCRGB_4BPPV;break;case 1:this._format=h.a.PVRTCRGBA_2BPPV;break;case 3:this._format=h.a.PVRTCRGBA_4BPPV;break;default:throw"Texture2D:unknown PVR format."}var i=e[11],a=e[7],r=e[6];this._width=a,this._height=r;var s=e[12]+52;this._upLoadCompressedTexImage2D(t,a,r,i,s,0)}_upLoadCompressedTexImage2D(t,e,i,a,r,s){var l=n.a.instance,h=this._glTextureType;o.a.bindTexture(l,h,this._glTexture);for(var _=this._getGLFormat(),c=r,d=0;d<a;d++){c+=s;var u=this._calcualatesCompressedDataSize(this._format,e,i),f=new Uint8Array(t,c,u);l.compressedTexImage2D(h,d,_,e,i,0,f),e=Math.max(e>>1,1),i=Math.max(i>>1,1),c+=u}var m=c;this._setGPUMemory(m),this._readyed=!0,this._activeResource()}loadImageSource(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var i=n.a.instance,a=t.width,r=t.height;this._width=a,this._height=r,this._isPot(a)&&this._isPot(r)||(this._mipmap=!1),this._setWarpMode(i.TEXTURE_WRAP_S,this._wrapModeU),this._setWarpMode(i.TEXTURE_WRAP_T,this._wrapModeV),this._setFilterMode(this._filterMode),o.a.bindTexture(i,this._glTextureType,this._glTexture);var l=this._getGLFormat();s.a.Render.isConchApp?(t.setPremultiplyAlpha&&t.setPremultiplyAlpha(e),i.texImage2D(this._glTextureType,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t)):(e&&i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.format==h.a.R5G6B5?i.texImage2D(this._glTextureType,0,i.RGB,i.RGB,i.UNSIGNED_SHORT_5_6_5,t):i.texImage2D(this._glTextureType,0,l,l,i.UNSIGNED_BYTE,t),e&&i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1)),this._mipmap?(i.generateMipmap(this._glTextureType),this._setGPUMemory(a*r*4*(1+1/3))):this._setGPUMemory(a*r*4),this._canRead&&(s.a.Render.isConchApp?this._pixels=new Uint8Array(t._nativeObj.getImageData(0,0,a,r)):(s.a.Browser.canvas.size(a,r),s.a.Browser.canvas.clear(),s.a.Browser.context.drawImage(t,0,0,a,r),this._pixels=new Uint8Array(s.a.Browser.context.getImageData(0,0,a,r).data.buffer))),this._readyed=!0,this._activeResource()}setPixels(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this._gpuCompressFormat())throw"Texture2D:the format is GPU compression format.";if(!t)throw"Texture2D:pixels can't be null.";var i=Math.max(this._width>>e,1),a=Math.max(this._height>>e,1),r=i*a*this._getFormatByteCount();if(t.length<r)throw"Texture2D:pixels length should at least "+r+".";this._setPixels(t,e,i,a),this._canRead&&(this._pixels=t),this._readyed=!0,this._activeResource()}setSubPixels(t,e,i,a,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(this._gpuCompressFormat())throw"Texture2D:the format is GPU compression format.";if(!r)throw"Texture2D:pixels can't be null.";var l=n.a.instance,_=this._glTextureType;o.a.bindTexture(l,_,this._glTexture);var c=this._getGLFormat();switch(this.format){case h.a.R8G8B8:l.pixelStorei(l.UNPACK_ALIGNMENT,1),l.texSubImage2D(_,s,t,e,i,a,c,l.UNSIGNED_BYTE,r),l.pixelStorei(l.UNPACK_ALIGNMENT,4);break;case h.a.R5G6B5:l.pixelStorei(l.UNPACK_ALIGNMENT,2),l.texSubImage2D(_,s,t,e,i,a,c,l.UNSIGNED_SHORT_5_6_5,r),l.pixelStorei(l.UNPACK_ALIGNMENT,4);break;case h.a.R32G32B32A32:l.texSubImage2D(_,s,t,e,i,a,c,l.FLOAT,r);break;default:l.texSubImage2D(_,s,t,e,i,a,c,l.UNSIGNED_BYTE,r)}this._readyed=!0,this._activeResource()}setCompressData(t){switch(this._format){case h.a.DXT1:case h.a.DXT5:this._pharseDDS(t);break;case h.a.ETC1RGB:this._pharseKTX(t);break;case h.a.PVRTCRGB_2BPPV:case h.a.PVRTCRGBA_2BPPV:case h.a.PVRTCRGB_4BPPV:case h.a.PVRTCRGBA_4BPPV:this._pharsePVR(t);break;default:throw"Texture2D:unkonwn format."}}getPixels(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")}}e.a=f,r()(f,"TEXTURE2D","TEXTURE2D"),r()(f,"grayTexture",null),r()(f,"whiteTexture",null),r()(f,"blackTexture",null)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];r()(this,"caller",void 0),r()(this,"method",void 0),r()(this,"args",void 0),r()(this,"once",!1),r()(this,"_id",0),this.setTo(t,e,i,a)}setTo(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this._id=s._gid++,this.caller=t,this.method=e,this.args=i,this.once=a,this}run(){if(null==this.method)return null;var t=this._id,e=this.method.apply(this.caller,this.args);return this._id===t&&this.once&&this.recover(),e}runWith(t){if(null==this.method)return null;var e=this._id;if(null==t)var i=this.method.apply(this.caller,this.args);else i=this.args||t.unshift?this.args?this.method.apply(this.caller,this.args.concat(t)):this.method.apply(this.caller,t):this.method.call(this.caller,t);return this._id===e&&this.once&&this.recover(),i}clear(){return this.caller=null,this.method=null,this.args=null,this}recover(){this._id>0&&(this._id=0,s._pool.push(this.clear()))}static create(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return s._pool.length?s._pool.pop().setTo(t,e,i,a):new s(t,e,i,a)}}e.a=s,r()(s,"_pool",[]),r()(s,"_gid",1)},function(t,e){var i=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(t,e,i){t.exports=!i(59)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(10),o=i(149),l=i(79),h=i(60),_=i(80);class c extends o.a{get mipmap(){return this._mipmap}get format(){return this._format}get wrapModeU(){return this._wrapModeU}set wrapModeU(t){this._wrapModeU!==t&&(this._wrapModeU=t,-1!==this._width&&this._setWarpMode(s.a.instance.TEXTURE_WRAP_S,t))}get wrapModeV(){return this._wrapModeV}set wrapModeV(t){this._wrapModeV!==t&&(this._wrapModeV=t,-1!==this._height&&this._setWarpMode(s.a.instance.TEXTURE_WRAP_T,t))}get filterMode(){return this._filterMode}set filterMode(t){t!==this._filterMode&&(this._filterMode=t,-1!==this._width&&-1!==this._height&&this._setFilterMode(t))}get anisoLevel(){return this._anisoLevel}set anisoLevel(t){t!==this._anisoLevel&&(this._anisoLevel=Math.max(1,Math.min(16,t)),-1!==this._width&&-1!==this._height&&this._setAnisotropy(t))}get mipmapCount(){return this._mipmapCount}get defaulteTexture(){throw"BaseTexture:must override it."}constructor(t,e){super(),r()(this,"_readyed",void 0),r()(this,"_glTextureType",void 0),r()(this,"_glTexture",void 0),r()(this,"_format",void 0),r()(this,"_mipmap",void 0),r()(this,"_wrapModeU",void 0),r()(this,"_wrapModeV",void 0),r()(this,"_filterMode",void 0),r()(this,"_anisoLevel",void 0),r()(this,"_mipmapCount",void 0),this._wrapModeU=_.a.Repeat,this._wrapModeV=_.a.Repeat,this._filterMode=l.a.Bilinear,this._readyed=!1,this._width=-1,this._height=-1,this._format=t,this._mipmap=e,this._anisoLevel=1,this._glTexture=s.a.instance.createTexture()}_getFormatByteCount(){switch(this._format){case h.a.R8G8B8:return 3;case h.a.R8G8B8A8:return 4;case h.a.R5G6B5:case h.a.Alpha8:return 1;case h.a.R16G16B16A16:return 2;case h.a.R32G32B32A32:return 4;default:throw"Texture2D: unknown format."}}_isPot(t){return 0==(t&t-1)}_getGLFormat(){var t,e=s.a.instance,i=s.a.layaGPUInstance;switch(this._format){case h.a.R8G8B8:case h.a.R5G6B5:t=e.RGB;break;case h.a.R8G8B8A8:t=e.RGBA;break;case h.a.Alpha8:t=e.ALPHA;break;case h.a.R32G32B32A32:case h.a.R16G16B16A16:t=e.RGBA;break;case h.a.DXT1:if(!i._compressedTextureS3tc)throw"BaseTexture: not support DXT1 format.";t=i._compressedTextureS3tc.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case h.a.DXT5:if(!i._compressedTextureS3tc)throw"BaseTexture: not support DXT5 format.";t=i._compressedTextureS3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case h.a.ETC1RGB:if(!i._compressedTextureEtc1)throw"BaseTexture: not support ETC1RGB format.";t=i._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL;break;case h.a.PVRTCRGB_2BPPV:if(!i._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_2BPPV format.";t=i._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case h.a.PVRTCRGBA_2BPPV:if(!i._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_2BPPV format.";t=i._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;break;case h.a.PVRTCRGB_4BPPV:if(!i._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_4BPPV format.";t=i._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case h.a.PVRTCRGBA_4BPPV:if(!i._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_4BPPV format.";t=i._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;default:throw"BaseTexture: unknown texture format."}return t}_setFilterMode(t){var e=s.a.instance;switch(n.a.bindTexture(e,this._glTextureType,this._glTexture),t){case l.a.Point:this._mipmap?e.texParameteri(this._glTextureType,e.TEXTURE_MIN_FILTER,e.NEAREST_MIPMAP_NEAREST):e.texParameteri(this._glTextureType,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(this._glTextureType,e.TEXTURE_MAG_FILTER,e.NEAREST);break;case l.a.Bilinear:this._mipmap?e.texParameteri(this._glTextureType,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST):e.texParameteri(this._glTextureType,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(this._glTextureType,e.TEXTURE_MAG_FILTER,e.LINEAR);break;case l.a.Trilinear:this._mipmap?e.texParameteri(this._glTextureType,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR):e.texParameteri(this._glTextureType,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(this._glTextureType,e.TEXTURE_MAG_FILTER,e.LINEAR);break;default:throw new Error("BaseTexture:unknown filterMode value.")}}_setWarpMode(t,e){var i=s.a.instance;if(n.a.bindTexture(i,this._glTextureType,this._glTexture),this._isPot(this._width)&&this._isPot(this._height))switch(e){case _.a.Repeat:i.texParameteri(this._glTextureType,t,i.REPEAT);break;case _.a.Clamp:i.texParameteri(this._glTextureType,t,i.CLAMP_TO_EDGE)}else i.texParameteri(this._glTextureType,t,i.CLAMP_TO_EDGE)}_setAnisotropy(t){var e=s.a.layaGPUInstance._extTextureFilterAnisotropic;if(e){t=Math.max(t,1);var i=s.a.instance;n.a.bindTexture(i,this._glTextureType,this._glTexture),t=Math.min(i.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT),t),i.texParameterf(this._glTextureType,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}}_disposeResource(){this._glTexture&&(s.a.instance.deleteTexture(this._glTexture),this._glTexture=null,this._setGPUMemory(0))}_getSource(){return this._readyed?this._glTexture:null}generateMipmap(){this._isPot(this.width)&&this._isPot(this.height)&&s.a.instance.generateMipmap(this._glTextureType)}}e.a=c,r()(c,"_rgbmRange",5),r()(c,"FORMAT_R8G8B8",0),r()(c,"FORMAT_R8G8B8A8",1),r()(c,"FORMAT_ALPHA8",2),r()(c,"FORMAT_DXT1",3),r()(c,"FORMAT_DXT5",4),r()(c,"FORMAT_ETC1RGB",5),r()(c,"FORMAT_PVRTCRGB_2BPPV",9),r()(c,"FORMAT_PVRTCRGBA_2BPPV",10),r()(c,"FORMAT_PVRTCRGB_4BPPV",11),r()(c,"FORMAT_PVRTCRGBA_4BPPV",12),r()(c,"RENDERTEXTURE_FORMAT_RGBA_HALF_FLOAT",14),r()(c,"FORMAT_R32G32B32A32",15),r()(c,"FORMAT_DEPTH_16",0),r()(c,"FORMAT_STENCIL_8",1),r()(c,"FORMAT_DEPTHSTENCIL_16_8",2),r()(c,"FORMAT_DEPTHSTENCIL_NONE",3),r()(c,"FILTERMODE_POINT",0),r()(c,"FILTERMODE_BILINEAR",1),r()(c,"FILTERMODE_TRILINEAR",2),r()(c,"WARPMODE_REPEAT",0),r()(c,"WARPMODE_CLAMP",1)},function(t,e,i){"use strict";let a,r;i.d(e,"b",function(){return a}),i.d(e,"a",function(){return r}),function(t){t[t.R8G8B8=0]="R8G8B8",t[t.R8G8B8A8=1]="R8G8B8A8",t[t.Alpha8=2]="Alpha8",t[t.R16G16B16A16=14]="R16G16B16A16",t[t.Depth=15]="Depth",t[t.ShadowMap=16]="ShadowMap"}(a||(a={})),function(t){t[t.DEPTH_16=0]="DEPTH_16",t[t.STENCIL_8=1]="STENCIL_8",t[t.DEPTHSTENCIL_24_8=2]="DEPTHSTENCIL_24_8",t[t.DEPTHSTENCIL_NONE=3]="DEPTHSTENCIL_NONE",t[t.DEPTHSTENCIL_16_8=2]="DEPTHSTENCIL_16_8"}(r||(r={}))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(6),n=i(23),o=i(26),l=i(43),h=i(3);class _ extends n.a{static moveUV(t,e,i){for(var a=0;a<8;a+=2)i[a]+=t,i[a+1]+=e;return i}static create(t,e,i,a,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;return _._create(t,e,i,a,r,s,n,o,l)}static _create(t,e,i,a,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null;var c,d=t instanceof _,u=d?t.uv:_.DEF_UV,f=d?t.bitmap:t;f.width&&e+a>f.width&&(a=f.width-e),f.height&&i+r>f.height&&(r=f.height-i),h?(c=h).setTo(f,null,o||a,l||r):c=new _(f,null,o||a,l||r),c.width=a,c.height=r,c.offsetX=s,c.offsetY=n;var m=1/f.width,p=1/f.height;e*=m,i*=p,a*=m,r*=p;var g=c.uv[0],v=c.uv[1],T=c.uv[4],E=c.uv[5],S=T-g,R=E-v,x=_.moveUV(u[0],u[1],[e,i,e+a,i,e+a,i+r,e,i+r]);c.uv=new Float32Array([g+x[0]*S,v+x[1]*R,T-(1-x[2])*S,v+x[3]*R,T-(1-x[4])*S,E-(1-x[5])*R,g+x[6]*S,E-(1-x[7])*R]);var A=f.scaleRate;return A&&1!=A?(c.sourceWidth/=A,c.sourceHeight/=A,c.width/=A,c.height/=A,c.scaleRate=A):c.scaleRate=1,c}static createFromTexture(t,e,i,a,r){var s=t.scaleRate;1!=s&&(e*=s,i*=s,a*=s,r*=s);var n=o.a.TEMP.setTo(e-t.offsetX,i-t.offsetY,a,r),l=n.intersection(_._rect1.setTo(0,0,t.width,t.height),_._rect2);return l?_.create(t,l.x,l.y,l.width,l.height,l.x-n.x,l.y-n.y,a,r):null}get uv(){return this._uv}set uv(t){this.uvrect[0]=Math.min(t[0],t[2],t[4],t[6]),this.uvrect[1]=Math.min(t[1],t[3],t[5],t[7]),this.uvrect[2]=Math.max(t[0],t[2],t[4],t[6])-this.uvrect[0],this.uvrect[3]=Math.max(t[1],t[3],t[5],t[7])-this.uvrect[1],this._uv=t}get width(){return this._w?this._w:this.bitmap?this.uv&&this.uv!==_.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width:0}set width(t){this._w=t,this.sourceWidth||(this.sourceWidth=t)}get height(){return this._h?this._h:this.bitmap?this.uv&&this.uv!==_.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height:0}set height(t){this._h=t,this.sourceHeight||(this.sourceHeight=t)}get bitmap(){return this._bitmap}set bitmap(t){this._bitmap&&this._bitmap._removeReference(this._referenceCount),this._bitmap=t,t&&t._addReference(this._referenceCount)}get destroyed(){return this._destroyed}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(),r()(this,"uvrect",[0,0,1,1]),r()(this,"_destroyed",!1),r()(this,"_bitmap",void 0),r()(this,"_uv",void 0),r()(this,"_referenceCount",0),r()(this,"_nativeObj",void 0),r()(this,"$_GID",0),r()(this,"offsetX",0),r()(this,"offsetY",0),r()(this,"_w",0),r()(this,"_h",0),r()(this,"sourceWidth",0),r()(this,"sourceHeight",0),r()(this,"url",null),r()(this,"scaleRate",1),this.setTo(t,e,i,a)}_addReference(){this._bitmap&&this._bitmap._addReference(),this._referenceCount++}_removeReference(){this._bitmap&&this._bitmap._removeReference(),this._referenceCount--}_getSource(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._destroyed||!this._bitmap?null:(this.recoverBitmap(t),this._bitmap.destroyed?null:this.bitmap._getSource())}_onLoaded(t,e){if(e)if(e==this);else if(e instanceof _){var i=e;_._create(e,0,0,i.width,i.height,0,0,i.sourceWidth,i.sourceHeight,this)}else this.bitmap=e,this.sourceWidth=this._w=e.width,this.sourceHeight=this._h=e.height;else;t&&t.run(),this.event(s.a.READY,this)}getIsReady(){return!this._destroyed&&!!this._bitmap}setTo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.bitmap=t,this.sourceWidth=i,this.sourceHeight=a,t&&(this._w=t.width,this._h=t.height,this.sourceWidth=this.sourceWidth||t.width,this.sourceHeight=this.sourceHeight||t.height),this.uv=e||_.DEF_UV}load(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._destroyed||h.a.loader.load(t,l.a.create(this,this._onLoaded,[e]),null,"htmlimage",1,!0)}getTexturePixels(t,e,i,a){var r,s,n,o=this.bitmap,l=this._w,_=this._h,c=this.sourceWidth,d=this.sourceHeight,u=o.width,f=o.height,m=this.offsetX,p=this.offsetY;let g=i,v=a;if(t+i>l+m&&(g-=t+i-l-m),t+i>c&&(i-=t+i-c),e+a>_+p&&(v-=e+a-_-p),e+a>d&&(a-=e+a-d),i<=0||a<=0)return null;let T=m>t?m-t:0,E=p>e?p-e:0,S=t>m?t-m:0,R=e>p?e-p:0;g-=T,v-=E;var x=4*i,A=null;try{A=o.getPixels()}catch(t){}if(A){if(0==t&&0==e&&i==u&&a==f)return A;let o=this._uv.slice(),l=Math.round(o[0]*u),h=Math.round(o[1]*f);var y=new Uint8Array(i*a*4);for(r=4*l+4*S+(s=(h+R)*(x=4*u)),n=0;n<v;n++)y.set(A.slice(r,r+4*g),4*i*(n+E)+4*T),r+=x;return y}var I=new h.a.Context;I.size(i,a),I.asBitmap=!0;var C=null;if(0!=t||0!=e||i!=u||a!=f){var M=(C=this._uv.slice())[0],D=C[1],b=(C[2]-M)/l,L=(C[7]-D)/_;C=[M+S*b,D+R*L,M+(S+g)*b,D+R*L,M+(S+g)*b,D+(R+v)*L,M+S*b,D+(R+v)*L]}I._drawTextureM(this,T,E,g,v,null,1,C),I._targets.start(),I.flush(),I._targets.end(),I._targets.restore();var O=I._targets.getData(0,0,i,a);for(I.destroy(),y=new Uint8Array(i*a*4),r=0,s=(a-1)*x,n=a-1;n>=0;n--)y.set(O.slice(s,s+x),r),r+=x,s-=x;return y}getPixels(t,e,i,a){return window.conch?this._nativeObj.getImageData(t,e,i,a):this.getTexturePixels(t,e,i,a)}recoverBitmap(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;var e=this._bitmap.url;if(!this._destroyed&&(!this._bitmap||this._bitmap.destroyed)&&e){let i=h.a.Loader.loadedMap[e];i?(this.bitmap=i,t&&t()):h.a.loader.load(e,l.a.create(this,function(e){this.bitmap=e,t&&t()}),null,"htmlimage",1,!0)}}disposeBitmap(){!this._destroyed&&this._bitmap&&this._bitmap.destroy()}destroy(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._destroyed){this._destroyed=!0;var e=this._bitmap;e&&(e._removeReference(this._referenceCount),(0===e.referenceCount||t)&&e.destroy(),e=null),this.url&&this===h.a.loader.getRes(this.url)&&h.a.Loader.clearRes(this.url)}}}e.a=_,r()(_,"DEF_UV",new Float32Array([0,0,1,0,1,1,0,1])),r()(_,"NO_UV",new Float32Array([0,0,0,0,0,0,0,0])),r()(_,"INV_UV",new Float32Array([0,1,1,1,1,0,0,0])),r()(_,"_rect1",new o.a),r()(_,"_rect2",new o.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{constructor(){}static isZero(t){return Math.abs(t)<s.zeroTolerance}static nearEqual(t,e){return!!s.isZero(t-e)}static fastInvSqrt(t){return s.isZero(t)?t:1/Math.sqrt(t)}}e.a=s,r()(s,"zeroTolerance",1e-6),r()(s,"MaxValue",3.40282347e38),r()(s,"MinValue",-3.40282347e38),r()(s,"Deg2Rad",Math.PI/180)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(123),n=i(124),o=i(255),l=i(254),h=i(404),_=i(407),c=i(53),d=i(256),u=i(62),f=i(170),m=i(257),p=i(258),g=i(260),v=i(125);class T{static __bulletinit__(){this._bullet=window.Physics3D,this._bullet&&(_.a.__init__(),c.a.__init__(),d.a.__init__(),u.a.__init__(),f.a.__init__(),m.a.__init__(),p.a.__init__(),g.a.__init__(),v.a.__init__())}static __cannoninit__(){this._cannon=window.CANNON,this._cannon&&(s.a.__init__(),n.a.__init__(),o.a.__init__(),l.a.__init__(),h.a.__init__())}}e.a=T,r()(T,"_bullet",null),r()(T,"_cannon",null),r()(T,"_enablePhysics",!1)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1);class n{constructor(){}static setColliderCollision(t,e,i){}static getIColliderCollision(t,e){return!1}}e.a=n,r()(n,"COLLISIONFILTERGROUP_DEFAULTFILTER",1),r()(n,"COLLISIONFILTERGROUP_STATICFILTER",2),r()(n,"COLLISIONFILTERGROUP_KINEMATICFILTER",4),r()(n,"COLLISIONFILTERGROUP_DEBRISFILTER",8),r()(n,"COLLISIONFILTERGROUP_SENSORTRIGGER",16),r()(n,"COLLISIONFILTERGROUP_CHARACTERFILTER",32),r()(n,"COLLISIONFILTERGROUP_CUSTOMFILTER1",64),r()(n,"COLLISIONFILTERGROUP_CUSTOMFILTER2",128),r()(n,"COLLISIONFILTERGROUP_CUSTOMFILTER3",256),r()(n,"COLLISIONFILTERGROUP_CUSTOMFILTER4",512),r()(n,"COLLISIONFILTERGROUP_CUSTOMFILTER5",1024),r()(n,"COLLISIONFILTERGROUP_CUSTOMFILTER6",2048),r()(n,"COLLISIONFILTERGROUP_CUSTOMFILTER7",4096),r()(n,"COLLISIONFILTERGROUP_CUSTOMFILTER8",8192),r()(n,"COLLISIONFILTERGROUP_CUSTOMFILTER9",16384),r()(n,"COLLISIONFILTERGROUP_CUSTOMFILTER10",32768),r()(n,"COLLISIONFILTERGROUP_ALLFILTER",-1),r()(n,"gravity",new s.a(0,-9.81,0))},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){r()(this,"elements",[]),r()(this,"length",0)}_add(t){this.length===this.elements.length?this.elements.push(t):this.elements[this.length]=t}add(t){this.length===this.elements.length?this.elements.push(t):this.elements[this.length]=t,this.length++}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(9),n=i(24),o=i(1),l=i(11);class h{static __init__(){var t=l.a.Physics3D._bullet;h._btScale=t.btVector3_create(1,1,1),h._btVector30=t.btVector3_create(0,0,0),h._btQuaternion0=t.btQuaternion_create(0,0,0,1),h._btTransform0=t.btTransform_create()}static _createAffineTransformation(t,e,i){var a=e.x,r=e.y,s=e.z,n=e.w,o=a+a,l=r+r,h=s+s,_=a*o,c=a*l,d=a*h,u=r*l,f=r*h,m=s*h,p=n*o,g=n*l,v=n*h;i[0]=1-(u+m),i[1]=c+v,i[2]=d-g,i[3]=0,i[4]=c-v,i[5]=1-(_+m),i[6]=f+p,i[7]=0,i[8]=d+g,i[9]=f-p,i[10]=1-(_+u),i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1}get type(){return this._type}get localOffset(){return this._localOffset}set localOffset(t){this._localOffset=t,this._compoundParent&&this._compoundParent._updateChildTransform(this)}get localRotation(){return this._localRotation}set localRotation(t){this._localRotation=t,this._compoundParent&&this._compoundParent._updateChildTransform(this)}constructor(){r()(this,"_scale",new o.a(1,1,1)),r()(this,"_btShape",void 0),r()(this,"_type",void 0),r()(this,"_centerMatrix",new s.a),r()(this,"_attatched",!1),r()(this,"_indexInCompound",-1),r()(this,"_compoundParent",null),r()(this,"_attatchedCollisionObject",null),r()(this,"_referenceCount",0),r()(this,"_localOffset",new o.a(0,0,0)),r()(this,"_localRotation",new n.a(0,0,0,1)),r()(this,"needsCustomCollisionCallback",!1)}_setScale(t){if(this._compoundParent)this.updateLocalTransformations();else{var e=l.a.Physics3D._bullet;e.btVector3_setValue(h._btScale,t.x,t.y,t.z),e.btCollisionShape_setLocalScaling(this._btShape,h._btScale)}}_addReference(){this._referenceCount++}_removeReference(){this._referenceCount--}updateLocalTransformations(){if(this._compoundParent){var t=h._tempVector30;o.a.multiply(this.localOffset,this._scale,t),h._createAffineTransformation(t,this.localRotation,this._centerMatrix.elements)}else h._createAffineTransformation(this.localOffset,this.localRotation,this._centerMatrix.elements)}cloneTo(t){var e=t;this._localOffset.cloneTo(e.localOffset),this._localRotation.cloneTo(e.localRotation),e.localOffset=e.localOffset,e.localRotation=e.localRotation}clone(){return null}destroy(){this._btShape&&(l.a.Physics3D._bullet.btCollisionShape_destroy(this._btShape),this._btShape=null)}}e.a=h,r()(h,"SHAPEORIENTATION_UPX",0),r()(h,"SHAPEORIENTATION_UPY",1),r()(h,"SHAPEORIENTATION_UPZ",2),r()(h,"SHAPETYPES_BOX",0),r()(h,"SHAPETYPES_SPHERE",1),r()(h,"SHAPETYPES_CYLINDER",2),r()(h,"SHAPETYPES_CAPSULE",3),r()(h,"SHAPETYPES_CONVEXHULL",4),r()(h,"SHAPETYPES_COMPOUND",5),r()(h,"SHAPETYPES_STATICPLANE",6),r()(h,"SHAPETYPES_CONE",7),r()(h,"_tempVector30",new o.a),r()(h,"_btScale",void 0),r()(h,"_btVector30",void 0),r()(h,"_btQuaternion0",void 0),r()(h,"_btTransform0",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{constructor(){r()(this,"_mask",[]),r()(this,"_length",0)}_intersectionDefineDatas(t){for(var e=t._mask,i=this._mask,a=this._length-1;a>=0;a--){var r=i[a]&e[a];0==r&&a==this._length-1?this._length--:i[a]=r}}add(t){var e=t._index,i=e+1,a=this._mask,r=this._length;if(r<i){for(a.length<i&&(a.length=i);r<e;r++)a[r]=0;a[e]=t._value,this._length=i}else i>this._length?(a[e]=t._value,this._length=i):a[e]|=t._value}remove(t){var e=t._index,i=this._mask,a=this._length-1;if(!(e>a)){var r=i[e]&~t._value;e==a&&0===r?this._length--:i[e]=r}}addDefineDatas(t){var e=t._mask,i=t._length,a=this._mask,r=this._length;if(r<i){a.length=i;for(var s=0;s<r;s++)a[s]|=e[s];for(;s<i;s++)a[s]=e[s];this._length=i}else{for(s=0;s<i;s++)s<this._length?a[s]|=e[s]:a[s]=e[s];this._length=Math.max(this._length,i)}}removeDefineDatas(t){for(var e=t._mask,i=this._mask,a=this._length-1,r=t._length-1;r>=0;r--)if(!(r>a)){var s=i[r]&~e[r];r==a&&0===s?(a--,this._length--):i[r]=s}}has(t){var e=t._index;return!(e>=this._length)&&0!=(this._mask[e]&t._value)}clear(){this._length=0}cloneTo(t){var e=t,i=e._mask,a=this._mask,r=this._length;i.length=r;for(var s=0;s<r;s++)i[s]=a[s];e._length=r}clone(){var t=new s;return this.cloneTo(t),t}}e.a=s},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(31),n=i(32);class o{get id(){return this._id}get vertexStride(){return this._vertexStride}get vertexElementCount(){return this._vertexElements.length}constructor(t,e){r()(this,"_id",void 0),r()(this,"_vertexStride",void 0),r()(this,"_vertexElementsDic",void 0),r()(this,"_shaderValues",void 0),r()(this,"_vertexElements",void 0),this._id=++o._uniqueIDCounter,this._vertexElementsDic={},this._vertexStride=t,this._vertexElements=e;var i=e.length;this._shaderValues=new n.a(null);for(var a=0;a<i;a++){var l=e[a],h=l._elementUsage;this._vertexElementsDic[h]=l;var _=new Int32Array(5),c=s.a.getElementInfos(l._elementFormat);_[0]=c[0],_[1]=c[1],_[2]=c[2],_[3]=this._vertexStride,_[4]=l._offset,this._shaderValues.setAttribute(h,_)}}getVertexElementByIndex(t){return this._vertexElements[t]}getVertexElementByUsage(t){return this._vertexElementsDic[t]}}e.a=o,r()(o,"_uniqueIDCounter",1)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{get offset(){return this._offset}get elementFormat(){return this._elementFormat}get elementUsage(){return this._elementUsage}constructor(t,e,i){r()(this,"_offset",void 0),r()(this,"_elementFormat",void 0),r()(this,"_elementUsage",void 0),this._offset=t,this._elementFormat=e,this._elementUsage=i}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(157),o=i(95),l=i(39);e.a=class extends o.a{get indexType(){return this._indexType}get indexTypeByteCount(){return this._indexTypeByteCount}get indexCount(){return this._indexCount}get canRead(){return this._canRead}constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:35044,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];switch(super(),r()(this,"_indexType",void 0),r()(this,"_indexTypeByteCount",void 0),r()(this,"_indexCount",void 0),r()(this,"_canRead",void 0),this._indexType=t,this._indexCount=e,this._bufferUsage=i,this._bufferType=s.a.instance.ELEMENT_ARRAY_BUFFER,this._canRead=a,t){case l.a.UInt32:this._indexTypeByteCount=4;break;case l.a.UInt16:this._indexTypeByteCount=2;break;case l.a.UInt8:this._indexTypeByteCount=1;break;default:throw new Error("unidentification index type.")}var o=this._indexTypeByteCount*e,h=n.a._curBindedBufferState;if(this._byteLength=o,h?h._bindedIndexBuffer===this?s.a.instance.bufferData(this._bufferType,o,this._bufferUsage):(h.unBind(),this.bind(),s.a.instance.bufferData(this._bufferType,o,this._bufferUsage),h.bind()):(this.bind(),s.a.instance.bufferData(this._bufferType,o,this._bufferUsage)),a)switch(t){case l.a.UInt32:this._buffer=new Uint32Array(e);break;case l.a.UInt16:this._buffer=new Uint16Array(e);break;case l.a.UInt8:this._buffer=new Uint8Array(e)}}_bindForVAO(){if(!n.a._curBindedBufferState)throw"IndexBuffer3D: must bind current BufferState.";var t=s.a.instance;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._glBuffer)}bind(){if(n.a._curBindedBufferState)throw"IndexBuffer3D: must unbind current BufferState.";if(o.a._bindedIndexBuffer!==this._glBuffer){var t=s.a.instance;return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._glBuffer),o.a._bindedIndexBuffer=this._glBuffer,!0}return!1}setData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4294967295;var r=this._indexTypeByteCount;if(0!==i||4294967295!==a)switch(this._indexType){case l.a.UInt32:t=new Uint32Array(t.buffer,i*r,a);break;case l.a.UInt16:t=new Uint16Array(t.buffer,i*r,a);break;case l.a.UInt8:t=new Uint8Array(t.buffer,i*r,a)}var o=n.a._curBindedBufferState;if(o?o._bindedIndexBuffer===this?s.a.instance.bufferSubData(this._bufferType,e*r,t):(o.unBind(),this.bind(),s.a.instance.bufferSubData(this._bufferType,e*r,t),o.bind()):(this.bind(),s.a.instance.bufferSubData(this._bufferType,e*r,t)),this._canRead)if(0!==e||0!==i||4294967295!==a){var h=this._buffer.length-e;a>h&&(a=h);for(var _=0;_<a;_++)this._buffer[e+_]=t[_]}else this._buffer=t}getData(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")}destroy(){super.destroy(),this._buffer=null,this._byteLength=0,this._indexCount=0}}},function(t,e,i){"use strict";var a=i(138),r=(i.n(a),i(0)),s=i.n(r),n=i(3),o=i(146),l=i(199),h=i(162),_=i(122),c=i(70),d=i(241),u=i(120),f=i(363),m=i(163),p=i(2),g=i(243),v=i(244),T=i(245),E=i(12),S=i(247),R=i(369),x=i(370),A=i(27),y=i(37),I=i(239),C=i(82),M=i(121),D=i(108),b=i(17),L=i(19),O=i(238),P=i(30),N=i(68),w=i(371),B=i(4),F=i(373),V=i(8),U=i(386),G=i(388),H=i(21),z=i(251),k=i(29),W=i(389),X=i(390),Y=i(391),j=i(36),Z=i(92),q=i(228),Q=i(230),K=i(66),J=i(168),$=i(97),tt=i(10),et=i(393),it=i(394),at=i(160),rt=i(395),st=i(156),nt=i(159),ot=i(165),lt=i(23),ht=i(43),_t=i(164),ct=i(15),dt=i(396),ut=i(6),ft=i(69);class mt{static __init(t){t.forEach(function(t){t.__init$&&t.__init$()})}static init(t,e){if(!mt._isinit){mt._isinit=!0,ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=mt._arrayBufferSlice),L.a.__init__();var i=L.a.mainCanvas=new M.a(!0),a=i.source.style;a.position="absolute",a.top=a.left="0px",a.background="#000000",L.a.onKGMiniGame||L.a.onAlipayMiniGame||L.a.container.appendChild(i.source),L.a.canvas=new M.a(!0),L.a.context=L.a.canvas.getContext("2d"),L.a.supportWebAudio=v.a.__init__(),L.a.supportLocalStorage=R.a.__init__(),mt.systemTimer=new G.a(!1),G.a.gSysTimer=mt.systemTimer,mt.startTimer=new G.a(!1),mt.physicsTimer=new G.a(!1),mt.updateTimer=new G.a(!1),mt.lateTimer=new G.a(!1),mt.timer=new G.a(!1),n.a.startTimer=mt.startTimer,n.a.lateTimer=mt.lateTimer,n.a.updateTimer=mt.updateTimer,n.a.systemTimer=mt.systemTimer,n.a.timer=mt.timer,n.a.physicsTimer=mt.physicsTimer,mt.loader=new S.a,n.a.Laya=mt,n.a.loader=mt.loader,z.a.__init__(),F.a.__init(),it.a.__init__(),$.a.inner_enable();for(var r=arguments.length,s=new Array(r>2?r-2:0),o=2;o<r;o++)s[o-2]=arguments[o];if(s)for(var l=0,_=s.length;l<_;l++)s[l]&&s[l].enable&&s[l].enable();return n.a.Render.isConchApp&&mt.enableNative(),mt.enableWebGLPlus(),O.a.beginCheck(),mt.stage=new d.a,n.a.stage=mt.stage,H.a.gStage=mt.stage,A.a.rootPath=A.a._basePath=mt._getUrlPath(),st.a.__int__(),at.a.__init__(),nt.a.__init__(),mt.render=new y.a(0,0,L.a.mainCanvas),mt.render,mt.stage.size(t,e),window.stage=mt.stage,tt.a.__init__(),rt.a.__init__(),J.a.__init__(),I.a.__init__(),f.a.__init__(),m.a.instance.__init__(mt.stage,y.a.canvas),h.a.__init__(),v.a.autoStopMusic=!0,V.a._StatRender=new U.a,j.a._initone(k.a.TEXTURE2D,Y.a),j.a._initone(k.a.TEXTURE2D|k.a.FILTERGLOW,Y.a),j.a._initone(k.a.PRIMITIVE,X.a),j.a._initone(k.a.SKINMESH,W.a),y.a.canvas}}static _getUrlPath(){return A.a.getPath(location.protocol+"//"+location.host+location.pathname)}static _arrayBufferSlice(t,e){var i=new Uint8Array(this,t,e-t),a=new Uint8Array(i.length);return a.set(i),a.buffer}static alertGlobalError(t){var e=0;L.a.window.onerror=t?function(t,i,a,r,s){e++<5&&s&&this.alert("出错啦，请把此信息截图给研发商\n"+t+"\n"+s.stack)}:null}static _runScript(t){return L.a.window[mt._evcode](t)}static enableDebugPanel(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"libs/laya.debugtool.js";if(window.Laya.DebugPanel)window.Laya.DebugPanel.enable();else{var e=L.a.createElement("script");e.onload=function(){window.Laya.DebugPanel.enable()},e.src=t,L.a.document.body.appendChild(e)}}static enableWebGLPlus(){tt.a.__init_native()}static enableNative(){mt.isNativeRender_enable||(mt.isNativeRender_enable=!0,y.a.supportWebGLPlusRendering&&(Z.a.prototype.uploadTexture2D=function(t){var e=p.a.instance;e.bindTexture(e.TEXTURE_2D,t)}),K.a.width=L.a.window.innerWidth,K.a.height=L.a.window.innerHeight,L.a.measureText=function(t,e){return window.conchTextCanvas.font=e,window.conchTextCanvas.measureText(t)},d.a.clear=function(t){C.a.set2DRenderConfig();var e=N.a.create(t).arrColor,i=p.a.instance;e&&i.clearColor(e[0],e[1],e[2],e[3]),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT),K.a.clear()},c.a.drawToCanvas=c.a.drawToTexture=function(t,e,i,a,r,s){r-=t.x,s-=t.y,r|=0,s|=0,i|=0,a|=0;var n=new M.a(!1),o=n.getContext("2d");return n.size(i,a),o.asBitmap=!0,o._targets.start(),I.a.renders[e]._fun(t,o,r,s),o.flush(),o._targets.end(),o._targets.restore(),n},Object.defineProperty(D.a.prototype,"uv",{get:function(){return this._uv},set:function(t){this._uv=t}}),M.a.prototype.getTexture=function(){return this._texture||(this._texture=this.context._targets,this._texture.uv=D.a.flipyuv,this._texture.bitmap=this._texture),this._texture})}}e.a=mt,s()(mt,"stage",null),s()(mt,"systemTimer",null),s()(mt,"startTimer",null),s()(mt,"physicsTimer",null),s()(mt,"updateTimer",null),s()(mt,"lateTimer",null),s()(mt,"timer",null),s()(mt,"loader",null),s()(mt,"version","2.9.0beta"),s()(mt,"render",void 0),s()(mt,"_isinit",!1),s()(mt,"isWXOpenDataContext",!1),s()(mt,"isWXPosMsg",!1),s()(mt,"__classmap",null),s()(mt,"Config",ft.a),s()(mt,"TextRender",Q.a),s()(mt,"EventDispatcher",lt.a),s()(mt,"SoundChannel",ot.a),s()(mt,"Stage",d.a),s()(mt,"Render",y.a),s()(mt,"Browser",L.a),s()(mt,"Sprite",c.a),s()(mt,"Node",_.a),s()(mt,"Context",C.a),s()(mt,"WebGL",$.a),s()(mt,"Handler",ht.a),s()(mt,"RunDriver",_t.a),s()(mt,"Utils",H.a),s()(mt,"Input",h.a),s()(mt,"Loader",E.a),s()(mt,"LocalStorage",R.a),s()(mt,"SoundManager",v.a),s()(mt,"URL",A.a),s()(mt,"Event",ut.a),s()(mt,"Matrix",ct.a),s()(mt,"HTMLImage",dt.a),s()(mt,"Laya",mt),s()(mt,"_evcode","eval"),s()(mt,"isNativeRender_enable",!1),mt.__classmap=n.a.__classMap,n.a.Timer=G.a,n.a.Dragging=w.a,n.a.GraphicsBounds=l.a,n.a.Sprite=c.a,n.a.TextRender=Q.a,n.a.Loader=E.a,n.a.TTFLoader=x.a,n.a.WebAudioSound=T.a,n.a.SoundManager=v.a,n.a.ShaderCompile=J.a,n.a.ClassUtils=P.a,n.a.SceneUtils=F.a,n.a.Context=C.a,n.a.Render=y.a,n.a.MouseManager=m.a,n.a.Text=u.a,n.a.Browser=L.a,n.a.WebGL=$.a,n.a.AudioSound=g.a,n.a.Pool=B.a,n.a.Utils=H.a,n.a.Graphics=o.a,n.a.Submit=q.a,n.a.Stage=d.a,n.a.Resource=b.a,n.a.WorkerLoader=et.a;var pt=window._layalibs;if(pt){pt.sort(function(t,e){return t.i-e.i});for(var gt=0;gt<pt.length;gt++)pt[gt].f(window,window.document,mt)}let vt=window;vt.Laya?(vt.Laya.Laya=mt,Object.assign(vt.Laya,mt)):vt.Laya=mt;mt.__init,mt.init,mt.version,mt.alertGlobalError,mt.enableDebugPanel},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,i){"use strict";let a;i.d(e,"a",function(){return a}),function(t){t[t.R8G8B8=0]="R8G8B8",t[t.R8G8B8A8=1]="R8G8B8A8",t[t.R5G6B5=16]="R5G6B5",t[t.Alpha8=2]="Alpha8",t[t.DXT1=3]="DXT1",t[t.DXT5=4]="DXT5",t[t.ETC1RGB=5]="ETC1RGB",t[t.PVRTCRGB_2BPPV=9]="PVRTCRGB_2BPPV",t[t.PVRTCRGBA_2BPPV=10]="PVRTCRGBA_2BPPV",t[t.PVRTCRGB_4BPPV=11]="PVRTCRGB_4BPPV",t[t.PVRTCRGBA_4BPPV=12]="PVRTCRGBA_4BPPV",t[t.R32G32B32A32=15]="R32G32B32A32",t[t.R16G16B16A16=17]="R16G16B16A16"}(a||(a={}))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(93),n=i(36);class o{static __init__(){var t=o.RENDERBASE=new o(-1);t.shaderValue=new n.a(0,0),t.shaderValue.ALPHA=1,t._ref=4294967295}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.TYPE_2D;r()(this,"clipInfoID",-1),r()(this,"_mesh",null),r()(this,"_blendFn",null),r()(this,"_id",0),r()(this,"_renderType",0),r()(this,"_parent",null),r()(this,"_key",new s.a),r()(this,"_startIdx",0),r()(this,"_numEle",0),r()(this,"_ref",1),r()(this,"shaderValue",null),this._renderType=t,this._id=++o.ID}getID(){return this._id}getRenderType(){return this._renderType}toString(){return"ibindex:"+this._startIdx+" num:"+this._numEle+" key="+this._key}renderSubmit(){return 1}releaseRender(){}}e.a=o,r()(o,"TYPE_2D",1e4),r()(o,"TYPE_CANVAS",10003),r()(o,"TYPE_CMDSETRT",10004),r()(o,"TYPE_CUSTOM",10005),r()(o,"TYPE_BLURRT",10006),r()(o,"TYPE_CMDDESTORYPRERT",10007),r()(o,"TYPE_DISABLESTENCIL",10008),r()(o,"TYPE_OTHERIBVB",10009),r()(o,"TYPE_PRIMITIVE",10010),r()(o,"TYPE_RT",10011),r()(o,"TYPE_BLUR_RT",10012),r()(o,"TYPE_TARGET",10013),r()(o,"TYPE_CHANGE_VALUE",10014),r()(o,"TYPE_SHAPE",10015),r()(o,"TYPE_TEXTURE",10016),r()(o,"TYPE_FILLTEXTURE",10017),r()(o,"KEY_ONCE",-1),r()(o,"KEY_FILLRECT",1),r()(o,"KEY_DRAWTEXTURE",2),r()(o,"KEY_VG",3),r()(o,"KEY_TRIANGLES",4),r()(o,"RENDERBASE",void 0),r()(o,"ID",1),r()(o,"preRender",null)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(98),n=i(6),o=i(12),l=i(85),h=i(9),_=i(24),c=i(1),d=i(51),u=i(257),f=i(408),m=i(256),p=i(409),g=i(258),v=i(410),T=i(411),E=i(11);class S extends s.a{static __init__(){var t=E.a.Physics3D._bullet;S._btVector30=t.btVector3_create(0,0,0),S._btQuaternion0=t.btQuaternion_create(0,0,0,1)}static _createAffineTransformationArray(t,e,i,a,r,s,n,o,l){var h=a+a,_=r+r,c=s+s,d=a*h,u=a*_,f=a*c,m=r*_,p=r*c,g=s*c,v=n*h,T=n*_,E=n*c,S=o[0],R=o[1],x=o[2];l[0]=(1-(m+g))*S,l[1]=(u+E)*S,l[2]=(f-T)*S,l[3]=0,l[4]=(u-E)*R,l[5]=(1-(d+g))*R,l[6]=(p+v)*R,l[7]=0,l[8]=(f+T)*x,l[9]=(p-v)*x,l[10]=(1-(d+m))*x,l[11]=0,l[12]=t,l[13]=e,l[14]=i,l[15]=1}static _creatShape(t){var e;switch(t.type){case"BoxColliderShape":var i=t.size;e=i?new u.a(i[0],i[1],i[2]):new u.a;break;case"SphereColliderShape":e=new T.a(t.radius);break;case"CapsuleColliderShape":e=new f.a(t.radius,t.height,t.orientation);break;case"MeshColliderShape":var a=new v.a;t.mesh&&(a.mesh=o.a.getRes(t.mesh)),e=a;break;case"ConeColliderShape":e=new p.a(t.radius,t.height,t.orientation);break;case"CylinderColliderShape":e=new g.a(t.radius,t.height,t.orientation);break;default:throw"unknown shape type."}if(t.center){var r=e.localOffset;r.fromArray(t.center),e.localOffset=r}return e}static physicVector3TransformQuat(t,e,i,a,r,s){var n=t.x,o=t.y,l=t.z,h=r*n+i*l-a*o,_=r*o+a*n-e*l,c=r*l+e*o-i*n,d=-e*n-i*o-a*l;s.x=h*r+d*-e+_*-a-c*-i,s.y=_*r+d*-i+c*-e-h*-a,s.z=c*r+d*-a+h*-i-_*-e}static physicQuaternionMultiply(t,e,i,a,r,s){var n=r.x,o=r.y,l=r.z,h=r.w,_=e*l-i*o,c=i*n-t*l,d=t*o-e*n,u=t*n+e*o+i*l;s.x=t*h+n*a+_,s.y=e*h+o*a+c,s.z=i*h+l*a+d,s.w=a*h-u}get restitution(){return this._restitution}set restitution(t){this._restitution=t,this._btColliderObject&&E.a.Physics3D._bullet.btCollisionObject_setRestitution(this._btColliderObject,t)}get friction(){return this._friction}set friction(t){this._friction=t,this._btColliderObject&&E.a.Physics3D._bullet.btCollisionObject_setFriction(this._btColliderObject,t)}get rollingFriction(){return this._rollingFriction}set rollingFriction(t){this._rollingFriction=t,this._btColliderObject&&E.a.Physics3D._bullet.btCollisionObject_setRollingFriction(this._btColliderObject,t)}get ccdMotionThreshold(){return this._ccdMotionThreshold}set ccdMotionThreshold(t){this._ccdMotionThreshold=t,this._btColliderObject&&E.a.Physics3D._bullet.btCollisionObject_setCcdMotionThreshold(this._btColliderObject,t)}get ccdSweptSphereRadius(){return this._ccdSweptSphereRadius}set ccdSweptSphereRadius(t){this._ccdSweptSphereRadius=t,this._btColliderObject&&E.a.Physics3D._bullet.btCollisionObject_setCcdSweptSphereRadius(this._btColliderObject,t)}get isActive(){return!!this._btColliderObject&&E.a.Physics3D._bullet.btCollisionObject_isActive(this._btColliderObject)}get colliderShape(){return this._colliderShape}set colliderShape(t){var e=this._colliderShape;if(e&&(e._attatched=!1,e._attatchedCollisionObject=null),this._colliderShape=t,t){if(t._attatched)throw"PhysicsComponent: this shape has attatched to other entity.";if(t._attatched=!0,t._attatchedCollisionObject=this,this._btColliderObject){E.a.Physics3D._bullet.btCollisionObject_setCollisionShape(this._btColliderObject,t._btShape);var i=this._simulation&&this._enabled;i&&e&&this._removeFromSimulation(),this._onShapeChange(t),i&&(this._derivePhysicsTransformation(!0),this._addToSimulation())}}else this._simulation&&this._enabled&&e&&this._removeFromSimulation()}get simulation(){return this._simulation}get collisionGroup(){return this._collisionGroup}set collisionGroup(t){this._collisionGroup!==t&&(this._collisionGroup=t,this._simulation&&this._colliderShape&&this._enabled&&(this._removeFromSimulation(),this._addToSimulation()))}get canCollideWith(){return this._canCollideWith}set canCollideWith(t){this._canCollideWith!==t&&(this._canCollideWith=t,this._simulation&&this._colliderShape&&this._enabled&&(this._removeFromSimulation(),this._addToSimulation()))}constructor(t,e){super(),r()(this,"_restitution",0),r()(this,"_friction",.5),r()(this,"_rollingFriction",0),r()(this,"_ccdMotionThreshold",0),r()(this,"_ccdSweptSphereRadius",0),r()(this,"_collisionGroup",d.a.COLLISIONFILTERGROUP_DEFAULTFILTER),r()(this,"_canCollideWith",d.a.COLLISIONFILTERGROUP_ALLFILTER),r()(this,"_colliderShape",null),r()(this,"_transformFlag",2147483647),r()(this,"_controlBySimulation",!1),r()(this,"_btColliderObject",void 0),r()(this,"_simulation",void 0),r()(this,"_enableProcessCollisions",!0),r()(this,"_inPhysicUpdateListIndex",-1),r()(this,"canScaleShape",!0),this._collisionGroup=t,this._canCollideWith=e,S._physicObjectsMap[this.id]=this}_parseShape(t){var e=t.length;if(1===e){var i=S._creatShape(t[0]);this.colliderShape=i}else{for(var a=new m.a,r=0;r<e;r++)i=S._creatShape(t[r]),a.addChildShape(i);this.colliderShape=a}}_onScaleChange(t){this._colliderShape._setScale(t)}_onEnable(){this._simulation=this.owner._scene.physicsSimulation,E.a.Physics3D._bullet.btCollisionObject_setContactProcessingThreshold(this._btColliderObject,1e30),this._colliderShape&&(this._derivePhysicsTransformation(!0),this._addToSimulation())}_onDisable(){this._colliderShape&&(this._removeFromSimulation(),-1!==this._inPhysicUpdateListIndex&&this._simulation._physicsUpdateList.remove(this)),this._simulation=null}_onDestroy(){delete S._physicObjectsMap[this.id],E.a.Physics3D._bullet.btCollisionObject_destroy(this._btColliderObject),this._colliderShape.destroy(),super._onDestroy(),this._btColliderObject=null,this._colliderShape=null,this._simulation=null,this.owner.transform.off(n.a.TRANSFORM_CHANGED,this,this._onTransformChanged)}_isValid(){return this._simulation&&this._colliderShape&&this._enabled}_parse(t){null!=t.collisionGroup&&(this.collisionGroup=t.collisionGroup),null!=t.canCollideWith&&(this.canCollideWith=t.canCollideWith),null!=t.ccdMotionThreshold&&(this.ccdMotionThreshold=t.ccdMotionThreshold),null!=t.ccdSweptSphereRadius&&(this.ccdSweptSphereRadius=t.ccdSweptSphereRadius)}_setTransformFlag(t,e){e?this._transformFlag|=t:this._transformFlag&=~t}_getTransformFlag(t){return 0!=(this._transformFlag&t)}_addToSimulation(){}_removeFromSimulation(){}_derivePhysicsTransformation(t){var e=E.a.Physics3D._bullet,i=this._btColliderObject,a=e.btCollisionObject_getWorldTransform(i);this._innerDerivePhysicsTransformation(a,t),e.btCollisionObject_setWorldTransform(i,a)}_innerDerivePhysicsTransformation(t,e){var i=E.a.Physics3D._bullet,a=this.owner._transform;if(e||this._getTransformFlag(l.a.TRANSFORM_WORLDPOSITION)){var r=this._colliderShape.localOffset,s=a.position,n=S._btVector30;if(0!==r.x||0!==r.y||0!==r.z){var o=S._tempVector30,h=a.worldMatrix;c.a.transformCoordinate(r,h,o),i.btVector3_setValue(n,-o.x,o.y,o.z)}else i.btVector3_setValue(n,-s.x,s.y,s.z);i.btTransform_setOrigin(t,n),this._setTransformFlag(l.a.TRANSFORM_WORLDPOSITION,!1)}if(e||this._getTransformFlag(l.a.TRANSFORM_WORLDQUATERNION)){var _=this._colliderShape.localRotation,d=S._btQuaternion0,u=a.rotation;if(0!==_.x||0!==_.y||0!==_.z||1!==_.w){var f=S._tempQuaternion0;S.physicQuaternionMultiply(u.x,u.y,u.z,u.w,_,f),i.btQuaternion_setValue(d,-f.x,f.y,f.z,-f.w)}else i.btQuaternion_setValue(d,-u.x,u.y,u.z,-u.w);i.btTransform_setRotation(t,d),this._setTransformFlag(l.a.TRANSFORM_WORLDQUATERNION,!1)}(e||this._getTransformFlag(l.a.TRANSFORM_WORLDSCALE))&&(this._onScaleChange(a.getWorldLossyScale()),this._setTransformFlag(l.a.TRANSFORM_WORLDSCALE,!1))}_updateTransformComponent(t){var e=E.a.Physics3D._bullet,i=this._colliderShape,a=i.localOffset,r=i.localRotation,s=this.owner._transform,n=s.position,o=s.rotation,l=e.btTransform_getOrigin(t),h=e.btTransform_getRotation(t),_=-e.btQuaternion_x(h),d=e.btQuaternion_y(h),u=e.btQuaternion_z(h),f=-e.btQuaternion_w(h);if(0!==r.x||0!==r.y||0!==r.z||1!==r.w){var m=S._tempQuaternion0;r.invert(m),S.physicQuaternionMultiply(_,d,u,f,m,o)}else o.x=_,o.y=d,o.z=u,o.w=f;if(s.rotation=o,0!==a.x||0!==a.y||0!==a.z){var p=e.btCollisionShape_getLocalScaling(i._btShape),g=S._tempVector30;g.x=a.x*e.btVector3_x(p),g.y=a.y*e.btVector3_y(p),g.z=a.z*e.btVector3_z(p),c.a.transformQuat(g,o,g),n.x=-e.btVector3_x(l)-g.x,n.y=e.btVector3_y(l)-g.y,n.z=e.btVector3_z(l)-g.z}else n.x=-e.btVector3_x(l),n.y=e.btVector3_y(l),n.z=e.btVector3_z(l);s.position=n}_onShapeChange(t){var e=this._btColliderObject,i=E.a.Physics3D._bullet,a=i.btCollisionObject_getCollisionFlags(e);t.needsCustomCollisionCallback?0==(a&S.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)&&i.btCollisionObject_setCollisionFlags(e,a|S.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK):(a&S.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)>0&&i.btCollisionObject_setCollisionFlags(e,a^S.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)}_onAdded(){this.enabled=this._enabled,this.restitution=this._restitution,this.friction=this._friction,this.rollingFriction=this._rollingFriction,this.ccdMotionThreshold=this._ccdMotionThreshold,this.ccdSweptSphereRadius=this._ccdSweptSphereRadius,this.owner.transform.on(n.a.TRANSFORM_CHANGED,this,this._onTransformChanged)}_onTransformChanged(t){!S._addUpdateList&&this._controlBySimulation||(t&=l.a.TRANSFORM_WORLDPOSITION|l.a.TRANSFORM_WORLDQUATERNION|l.a.TRANSFORM_WORLDSCALE)&&(this._transformFlag|=t,this._isValid()&&-1===this._inPhysicUpdateListIndex&&this._simulation._physicsUpdateList.add(this))}_cloneTo(t){var e=t;e.restitution=this._restitution,e.friction=this._friction,e.rollingFriction=this._rollingFriction,e.ccdMotionThreshold=this._ccdMotionThreshold,e.ccdSweptSphereRadius=this._ccdSweptSphereRadius,e.collisionGroup=this._collisionGroup,e.canCollideWith=this._canCollideWith,e.canScaleShape=this.canScaleShape,this._colliderShape&&(e.colliderShape=this._colliderShape.clone())}}e.a=S,r()(S,"ACTIVATIONSTATE_ACTIVE_TAG",1),r()(S,"ACTIVATIONSTATE_ISLAND_SLEEPING",2),r()(S,"ACTIVATIONSTATE_WANTS_DEACTIVATION",3),r()(S,"ACTIVATIONSTATE_DISABLE_DEACTIVATION",4),r()(S,"ACTIVATIONSTATE_DISABLE_SIMULATION",5),r()(S,"COLLISIONFLAGS_STATIC_OBJECT",1),r()(S,"COLLISIONFLAGS_KINEMATIC_OBJECT",2),r()(S,"COLLISIONFLAGS_NO_CONTACT_RESPONSE",4),r()(S,"COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK",8),r()(S,"COLLISIONFLAGS_CHARACTER_OBJECT",16),r()(S,"COLLISIONFLAGS_DISABLE_VISUALIZE_OBJECT",32),r()(S,"COLLISIONFLAGS_DISABLE_SPU_COLLISION_PROCESSING",64),r()(S,"_tempVector30",new c.a),r()(S,"_tempQuaternion0",new _.a),r()(S,"_tempQuaternion1",new _.a),r()(S,"_tempMatrix4x40",new h.a),r()(S,"_btVector30",void 0),r()(S,"_btQuaternion0",void 0),r()(S,"_physicObjectsMap",{}),r()(S,"_addUpdateList",!0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(7),n=i(32);class o{static __init__(){o._screenShaderData=new n.a,o._screenShader=s.a.find("BlitScreen")}constructor(){r()(this,"_commandBuffer",null),r()(this,"_context",void 0)}run(){}recover(){this._commandBuffer=null}setContext(t){this._context=t}}e.a=o,r()(o,"_screenShaderData",void 0),r()(o,"_screenShader",void 0),r()(o,"SCREENTEXTURE_NAME","u_MainTex"),r()(o,"SCREENTEXTUREOFFSETSCALE_NAME","u_OffsetScale"),r()(o,"MAINTEXTURE_TEXELSIZE_NAME","u_MainTex_TexelSize"),r()(o,"SCREENTEXTURE_ID",s.a.propertyNameToID(o.SCREENTEXTURE_NAME)),r()(o,"SCREENTEXTUREOFFSETSCALE_ID",s.a.propertyNameToID(o.SCREENTEXTUREOFFSETSCALE_NAME)),r()(o,"MAINTEXTURE_TEXELSIZE_ID",s.a.propertyNameToID(o.MAINTEXTURE_TEXELSIZE_NAME))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(87),n=i(54);class o{constructor(){r()(this,"_transform",void 0),r()(this,"_geometry",void 0),r()(this,"material",void 0),r()(this,"render",void 0),r()(this,"staticBatch",void 0),r()(this,"renderSubShader",null),r()(this,"renderType",o.RENDERTYPE_NORMAL)}getInvertFront(){return this._transform._isFrontFaceInvert}setTransform(t){this._transform=t}setGeometry(t){this._geometry=t}addToOpaqueRenderQueue(t,e){e.elements.add(this)}addToTransparentRenderQueue(t,e){e.elements.add(this),e.lastTransparentBatched=!1,e.lastTransparentRenderElement=this}_update(t,e,i,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(this.material){var s=this.material._shader.getSubShaderAt(0);if(this.renderSubShader=null,i)if(a){var n=s.getFlag(a);if(!n)return;for(var o=i._subShaders,l=0,h=o.length;l<h;l++){var _=o[l];if(n===_.getFlag(a)){this.renderSubShader=_;break}}if(!this.renderSubShader)return}else this.renderSubShader=i.getSubShaderAt(r);else this.renderSubShader=s;var c=t._getRenderQueue(this.material.renderQueue);c.isTransparent?this.addToTransparentRenderQueue(e,c):this.addToOpaqueRenderQueue(e,c)}}_render(t){var e,i,a,r=t.invertY,n=s.a._updateMark,l=t.scene,h=t.cameraShaderValue,_=this._transform,c=this._geometry;t.renderElement=this,n!==this.render._updateMark||this.renderType!==this.render._updateRenderType?(this.render._renderUpdate(t,_),this.render._renderUpdateWithCamera(t,_),this.render._updateMark=n,this.render._updateRenderType=this.renderType):this.renderType==o.RENDERTYPE_INSTANCEBATCH&&(this.render._renderUpdate(t,_),this.render._renderUpdateWithCamera(t,_));var d=t.pipelineMode;if(c._prepareRender(t))for(var u=this.renderSubShader._passes,f=0,m=u.length;f<m;f++){var p=u[f];if(p._pipelineMode===d){var g=o._compileDefine;l._shaderValues._defineDatas.cloneTo(g),g.addDefineDatas(this.render._shaderValues._defineDatas),g.addDefineDatas(this.material._shaderValues._defineDatas);var v=t.shader=p.withCompile(g),T=v.bind(),E=n!==v._uploadMark,S=v._uploadScene!==l||E;(S||T)&&(v.uploadUniforms(v._sceneUniformParamsMap,l._shaderValues,S),v._uploadScene=l);var R=v._uploadRender!==this.render||v._uploadRenderType!==this.renderType||E;(R||T)&&(v.uploadUniforms(v._spriteUniformParamsMap,this.render._shaderValues,R),v._uploadRender=this.render,v._uploadRenderType=this.renderType);var x=v._uploadCameraShaderValue!==h||E;(x||T)&&(v.uploadUniforms(v._cameraUniformParamsMap,h,x),v._uploadCameraShaderValue=h);var A=v._uploadMaterial!==this.material||E;(A||T)&&(v.uploadUniforms(v._materialUniformParamsMap,this.material._shaderValues,A),v._uploadMaterial=this.material);var y=this.material._shaderValues;e!==this.material||i!==v?(v.uploadRenderStateBlendDepth(y),v.uploadRenderStateFrontFace(y,r,this.getInvertFront()),e=this.material,i=v,a=this.render):a!==this.render&&(v.uploadRenderStateFrontFace(y,r,this.getInvertFront()),a=this.render),c._render(t),v._uploadMark=n}}this.renderType!==o.RENDERTYPE_NORMAL&&this.render._revertBatchRenderUpdate(t)}destroy(){this._transform=null,this._geometry=null,this.material=null,this.render=null}}e.a=o,r()(o,"RENDERTYPE_NORMAL",0),r()(o,"RENDERTYPE_STATICBATCH",1),r()(o,"RENDERTYPE_INSTANCEBATCH",2),r()(o,"RENDERTYPE_VERTEXBATCH",3),r()(o,"_compileDefine",new n.a)},function(t,e,i){var a=i(76),r=i(141);t.exports=i(45)?function(t,e,i){return a.f(t,e,r(1,i))}:function(t,e,i){return t[e]=i,t}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(15);class n{static mat2MatArray(t,e){var i=t,a=e;return a[0]=i.a,a[1]=i.b,a[2]=n.EMPTYMAT4_ARRAY[2],a[3]=n.EMPTYMAT4_ARRAY[3],a[4]=i.c,a[5]=i.d,a[6]=n.EMPTYMAT4_ARRAY[6],a[7]=n.EMPTYMAT4_ARRAY[7],a[8]=n.EMPTYMAT4_ARRAY[8],a[9]=n.EMPTYMAT4_ARRAY[9],a[10]=n.EMPTYMAT4_ARRAY[10],a[11]=n.EMPTYMAT4_ARRAY[11],a[12]=i.tx,a[13]=i.ty,a[14]=n.EMPTYMAT4_ARRAY[14],a[15]=n.EMPTYMAT4_ARRAY[15],e}static restoreTempArray(){n.TEMPMAT4_ARRAY[0]=1,n.TEMPMAT4_ARRAY[1]=0,n.TEMPMAT4_ARRAY[4]=0,n.TEMPMAT4_ARRAY[5]=1,n.TEMPMAT4_ARRAY[12]=0,n.TEMPMAT4_ARRAY[13]=0}static clear(){n.worldScissorTest=!1,n.worldAlpha=1}}e.a=n,r()(n,"_MAXSIZE",99999999),r()(n,"EMPTYMAT4_ARRAY",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),r()(n,"TEMPMAT4_ARRAY",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),r()(n,"worldMatrix4",n.TEMPMAT4_ARRAY),r()(n,"worldMatrix",new s.a),r()(n,"matWVP",null),r()(n,"worldAlpha",1),r()(n,"worldScissorTest",!1),r()(n,"worldShaderDefines",void 0),r()(n,"worldFilters",void 0),r()(n,"width",0),r()(n,"height",0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(10);class n{static _init_(t){n.fns=[n.BlendNormal,n.BlendAdd,n.BlendMultiply,n.BlendScreen,n.BlendOverlay,n.BlendLight,n.BlendMask,n.BlendDestinationOut,n.BlendAddOld],n.targetFns=[n.BlendNormalTarget,n.BlendAddTarget,n.BlendMultiplyTarget,n.BlendScreenTarget,n.BlendOverlayTarget,n.BlendLightTarget,n.BlendMask,n.BlendDestinationOut,n.BlendAddTargetOld]}static BlendNormal(t){s.a.setBlendFunc(t,t.ONE,t.ONE_MINUS_SRC_ALPHA,!0)}static BlendAddOld(t){s.a.setBlendFunc(t,t.ONE,t.DST_ALPHA,!0)}static BlendAdd(t){s.a.setBlendFunc(t,t.ONE,t.ONE,!0)}static BlendMultiply(t){s.a.setBlendFunc(t,t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,!0)}static BlendScreen(t){s.a.setBlendFunc(t,t.ONE,t.ONE,!0)}static BlendOverlay(t){s.a.setBlendFunc(t,t.ONE,t.ONE_MINUS_SRC_COLOR,!0)}static BlendLight(t){s.a.setBlendFunc(t,t.ONE,t.ONE,!0)}static BlendNormalTarget(t){s.a.setBlendFunc(t,t.ONE,t.ONE_MINUS_SRC_ALPHA,!0)}static BlendAddTargetOld(t){s.a.setBlendFunc(t,t.ONE,t.DST_ALPHA,!0)}static BlendAddTarget(t){s.a.setBlendFunc(t,t.ONE,t.ONE,!0)}static BlendMultiplyTarget(t){s.a.setBlendFunc(t,t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,!0)}static BlendScreenTarget(t){s.a.setBlendFunc(t,t.ONE,t.ONE,!0)}static BlendOverlayTarget(t){s.a.setBlendFunc(t,t.ONE,t.ONE_MINUS_SRC_COLOR,!0)}static BlendLightTarget(t){s.a.setBlendFunc(t,t.ONE,t.ONE,!0)}static BlendMask(t){s.a.setBlendFunc(t,t.ZERO,t.SRC_ALPHA,!0)}static BlendDestinationOut(t){s.a.setBlendFunc(t,t.ZERO,t.ZERO,!0)}}e.a=n,r()(n,"activeBlendFunction",null),r()(n,"NAMES",["normal","add","multiply","screen","overlay","light","mask","destination-out","add_old"]),r()(n,"TOINT",{normal:0,add:1,multiply:2,screen:3,overlay:4,light:5,mask:6,"destination-out":7,lighter:1,lighter_old:8,add_old:8}),r()(n,"NORMAL","normal"),r()(n,"MASK","mask"),r()(n,"LIGHTER","lighter"),r()(n,"fns",void 0),r()(n,"targetFns",void 0)},function(t,e,i){"use strict";var a=i(18),r=(i.n(a),i(0)),s=i.n(r),n=i(21);class o{constructor(t){if(s()(this,"arrColor",[]),s()(this,"strColor",void 0),s()(this,"numColor",void 0),s()(this,"_drawStyle",void 0),null==t||"none"==t)return this.strColor="#00000000",this.numColor=0,void(this.arrColor=[0,0,0,0]);var e,i,a;if("string"==typeof t)if(t.indexOf("rgba(")>=0||t.indexOf("rgb(")>=0){var r,l,h=t;for(r=h.indexOf("("),l=h.indexOf(")"),h=h.substring(r+1,l),this.arrColor=h.split(","),i=this.arrColor.length,e=0;e<i;e++)this.arrColor[e]=parseFloat(this.arrColor[e]),e<3&&(this.arrColor[e]=Math.round(this.arrColor[e]));a=4==this.arrColor.length?256*(256*(256*this.arrColor[0]+this.arrColor[1])+this.arrColor[2])+Math.round(255*this.arrColor[3]):256*(256*this.arrColor[0]+this.arrColor[1])+this.arrColor[2],this.strColor=t}else{if(this.strColor=t,"#"===t.charAt(0)&&(t=t.substr(1)),3===(i=t.length)||4===i){var _="";for(e=0;e<i;e++)_+=t[e]+t[e];t=_}a=parseInt(t,16)}else a=t,this.strColor=n.a.toHexColor(a);this.strColor.indexOf("rgba")>=0||9===this.strColor.length?(this.arrColor=[((4278190080&a)>>>24)/255,((16711680&a)>>16)/255,((65280&a)>>8)/255,(255&a)/255],this.numColor=(4278190080&a)>>>24|(16711680&a)>>8|(65280&a)<<8|(255&a)<<24):(this.arrColor=[((16711680&a)>>16)/255,((65280&a)>>8)/255,(255&a)/255,1],this.numColor=4278190080|(16711680&a)>>16|65280&a|(255&a)<<16),this.arrColor.__id=++o._COLODID}static _initDefault(){for(var t in o._DEFAULT={},o._COLOR_MAP)o._SAVE[t]=o._DEFAULT[t]=new o(o._COLOR_MAP[t]);return o._DEFAULT}static _initSaveMap(){for(var t in o._SAVE_SIZE=0,o._SAVE={},o._DEFAULT)o._SAVE[t]=o._DEFAULT[t]}static create(t){var e=t+"",i=o._SAVE[e];return null!=i?i:(o._SAVE_SIZE<1e3&&o._initSaveMap(),o._SAVE[e]=new o(t))}}e.a=o,s()(o,"_SAVE",{}),s()(o,"_SAVE_SIZE",0),s()(o,"_COLOR_MAP",{purple:"#800080",orange:"#ffa500",white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#808080"}),s()(o,"_DEFAULT",o._initDefault()),s()(o,"_COLODID",1)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{}e.a=s,r()(s,"animationInterval",50),r()(s,"isAntialias",!1),r()(s,"isAlpha",!1),r()(s,"premultipliedAlpha",!0),r()(s,"isStencil",!0),r()(s,"preserveDrawingBuffer",!1),r()(s,"webGL2D_MeshAllocMaxMem",!0),r()(s,"is2DPixelArtGame",!1),r()(s,"useWebGL2",!0),r()(s,"allowGPUInstanceDynamicBatch",!0),r()(s,"useRetinalCanvas",!1),window.Config=s},function(t,e,i){"use strict";var a=i(18),r=(i.n(a),i(0)),s=i.n(r),n=i(3),o=i(71),l=i(6),h=i(147),_=i(148),c=i(222),d=i(15),u=i(16),f=i(26),m=i(239),p=i(82),g=i(121),v=i(48),T=i(30),E=i(21),S=i(359),R=i(360),x=i(240),A=i(146),y=i(122),I=i(84),C=i(27);class M extends y.a{destroy(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];super.destroy(t),this._style&&this._style.recover(),this._cacheStyle&&this._cacheStyle.recover(),this._boundStyle&&this._boundStyle.recover(),this._style=null,this._cacheStyle=null,this._boundStyle=null,this._transform=null,this._graphics&&this._graphics.autoDestroy&&this._graphics.destroy(),this._graphics=null,this.texture=null}constructor(){super(),s()(this,"_x",0),s()(this,"_y",0),s()(this,"_width",0),s()(this,"_height",0),s()(this,"_visible",!0),s()(this,"_mouseState",0),s()(this,"_zOrder",0),s()(this,"_renderType",0),s()(this,"_transform",null),s()(this,"_tfChanged",!1),s()(this,"_repaint",I.a.REPAINT_NONE),s()(this,"_texture",null),s()(this,"_style",x.a.EMPTY),s()(this,"_cacheStyle",R.a.EMPTY),s()(this,"_boundStyle",null),s()(this,"_graphics",null),s()(this,"mouseThrough",!1),s()(this,"autoSize",!1),s()(this,"hitTestPrior",!1)}updateZOrder(){E.a.updateOrder(this._children)&&this.repaint()}_getBoundsStyle(){return this._boundStyle||(this._boundStyle=S.a.create()),this._boundStyle}_setCustomRender(){}set customRenderEnable(t){t&&(this._renderType|=I.a.CUSTOM,this._setRenderType(this._renderType),this._setCustomRender())}get cacheAs(){return this._cacheStyle.cacheAs}_setCacheAs(t){}set cacheAs(t){t!==this._cacheStyle.userSetCache&&(this.mask&&"normal"===t||(this._setCacheAs(t),this._getCacheStyle().userSetCache=t,this._checkCanvasEnable(),this.repaint()))}_checkCanvasEnable(){var t=this._cacheStyle.needEnableCanvasRender();this._getCacheStyle().enableCanvasRender=t,t?(this._cacheStyle.needBitmapCache()?this._cacheStyle.cacheAs="bitmap":this._cacheStyle.cacheAs=this._cacheStyle.userSetCache,this._cacheStyle.reCache=!0,this._renderType|=I.a.CANVAS):(this._cacheStyle.cacheAs="none",this._cacheStyle.releaseContext(),this._renderType&=~I.a.CANVAS),this._setCacheAs(this._cacheStyle.cacheAs),this._setRenderType(this._renderType)}get staticCache(){return this._cacheStyle.staticCache}set staticCache(t){this._getCacheStyle().staticCache=t,t||this.reCache()}reCache(){this._cacheStyle.reCache=!0,this._repaint|=I.a.REPAINT_CACHE}getRepaint(){return this._repaint}_setX(t){this._x=t}_setY(t){this._y=t}_setWidth(t,e){}_setHeight(t,e){}get x(){return this._x}set x(t){if(!this.destroyed&&this._x!==t){this._setX(t),this.parentRepaint(I.a.REPAINT_CACHE);var e=this._cacheStyle.maskParent;e&&e.repaint(I.a.REPAINT_CACHE)}}get y(){return this._y}set y(t){if(!this.destroyed&&this._y!==t){this._setY(t),this.parentRepaint(I.a.REPAINT_CACHE);var e=this._cacheStyle.maskParent;e&&e.repaint(I.a.REPAINT_CACHE)}}get width(){return this.get_width()}set width(t){this.set_width(t)}set_width(t){this._width!==t&&(this._width=t,this._setWidth(this.texture,t),this._setTranformChange())}get_width(){return this.autoSize?this.texture?this.texture.width:this._graphics||0!==this._children.length?this.getSelfBounds().width:0:this._width||(this.texture?this.texture.width:0)}get height(){return this.get_height()}set height(t){this.set_height(t)}set_height(t){this._height!==t&&(this._height=t,this._setHeight(this.texture,t),this._setTranformChange())}get_height(){return this.autoSize?this.texture?this.texture.height:this._graphics||0!==this._children.length?this.getSelfBounds().height:0:this._height||(this.texture?this.texture.height:0)}get displayWidth(){return this.width*this.scaleX}get displayHeight(){return this.height*this.scaleY}setSelfBounds(t){this._getBoundsStyle().userBounds=t}getBounds(){return this._getBoundsStyle().bounds=f.a._getWrapRec(this._boundPointsToParent())}getSelfBounds(){return this._boundStyle&&this._boundStyle.userBounds?this._boundStyle.userBounds:this._graphics||0!==this._children.length||this._texture?this._getBoundsStyle().bounds=f.a._getWrapRec(this._getBoundPointsM(!1)):f.a.TEMP.setTo(0,0,this.width,this.height)}_boundPointsToParent(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e=0,i=0;this._style&&(e=this.pivotX,i=this.pivotY,t=t||0!==this._style.rotation,this._style.scrollRect&&(e+=this._style.scrollRect.x,i+=this._style.scrollRect.y));var a=this._getBoundPointsM(t);if(!a||a.length<1)return a;if(8!=a.length&&(a=t?c.a.scanPList(a):f.a._getWrapRec(a,f.a.TEMP)._getBoundPoints()),!this.transform)return E.a.transPointList(a,this._x-e,this._y-i),a;var r,s=u.a.TEMP,n=a.length;for(r=0;r<n;r+=2)s.x=a[r],s.y=a[r+1],this.toParentPoint(s),a[r]=s.x,a[r+1]=s.y;return a}getGraphicBounds(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._graphics?this._graphics.getBounds(t):f.a.TEMP.setTo(0,0,0,0)}_getBoundPointsM(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._boundStyle&&this._boundStyle.userBounds)return this._boundStyle.userBounds._getBoundPoints();if(this._boundStyle||this._getBoundsStyle(),this._boundStyle.temBM||(this._boundStyle.temBM=[]),this._style.scrollRect){var e=E.a.clearArray(this._boundStyle.temBM),i=f.a.TEMP;return i.copyFrom(this._style.scrollRect),E.a.concatArray(e,i._getBoundPoints()),e}var a,r,s,n;this._graphics?a=this._graphics.getBoundPoints():(a=E.a.clearArray(this._boundStyle.temBM),this._texture&&((i=f.a.TEMP).setTo(0,0,this.width||this._texture.width,this.height||this._texture.height),E.a.concatArray(a,i._getBoundPoints())));for(var o=0,l=(n=this._children).length;o<l;o++)(r=n[o])instanceof M&&!0===r._visible&&(s=r._boundPointsToParent(t))&&(a=a?E.a.concatArray(a,s):s);return a}_getCacheStyle(){return this._cacheStyle===R.a.EMPTY&&(this._cacheStyle=R.a.create()),this._cacheStyle}getStyle(){return this._style===x.a.EMPTY&&(this._style=x.a.create()),this._style}setStyle(t){this._style=t}get scaleX(){return this._style.scaleX}set scaleX(t){this.set_scaleX(t)}_setScaleX(t){this._style.scaleX=t}get scaleY(){return this._style.scaleY}set scaleY(t){this.set_scaleY(t)}_setScaleY(t){this._style.scaleY=t}set_scaleX(t){this.getStyle().scaleX!==t&&(this._setScaleX(t),this._setTranformChange())}get_scaleX(){return this._style.scaleX}set_scaleY(t){this.getStyle().scaleY!==t&&(this._setScaleY(t),this._setTranformChange())}get_scaleY(){return this._style.scaleY}get rotation(){return this._style.rotation}set rotation(t){this.getStyle().rotation!==t&&(this._setRotation(t),this._setTranformChange())}_setRotation(t){this._style.rotation=t}get skewX(){return this._style.skewX}set skewX(t){this.getStyle().skewX!==t&&(this._setSkewX(t),this._setTranformChange())}_setSkewX(t){this._style.skewX=t}get skewY(){return this._style.skewY}set skewY(t){this.getStyle().skewY!==t&&(this._setSkewY(t),this._setTranformChange())}_setSkewY(t){this._style.skewY=t}_createTransform(){return d.a.create()}_adjustTransform(){this._tfChanged=!1;var t=this._style,e=t.scaleX,i=t.scaleY,a=t.skewX,r=t.skewY,s=t.rotation,n=this._transform||(this._transform=this._createTransform());if(s||1!==e||1!==i||0!==a||0!==r){n._bTransform=!0;var o=.0174532922222222*(s-a),l=.0174532922222222*(s+r),h=Math.cos(l),_=Math.sin(l),c=Math.sin(o),d=Math.cos(o);n.a=e*h,n.b=e*_,n.c=-i*c,n.d=i*d,n.tx=n.ty=0}else n.identity(),this._renderType&=~I.a.TRANSFORM,this._setRenderType(this._renderType);return n}_setTransform(t){}get transform(){return this._tfChanged?this._adjustTransform():this._transform}set transform(t){this.set_transform(t)}get_transform(){return this._tfChanged?this._adjustTransform():this._transform}set_transform(t){this._tfChanged=!1;var e=this._transform||(this._transform=this._createTransform());t.copyTo(e),this._setTransform(e),t&&(this._x=e.tx,this._y=e.ty,e.tx=e.ty=0),t?this._renderType|=I.a.TRANSFORM:this._renderType&=~I.a.TRANSFORM,this._setRenderType(this._renderType),this.parentRepaint()}_setPivotX(t){this.getStyle().pivotX=t}_getPivotX(){return this._style.pivotX}_setPivotY(t){this.getStyle().pivotY=t}_getPivotY(){return this._style.pivotY}get pivotX(){return this._getPivotX()}set pivotX(t){this._setPivotX(t),this.repaint()}get pivotY(){return this._getPivotY()}set pivotY(t){this._setPivotY(t),this.repaint()}_setAlpha(t){this._style.alpha!==t&&(this.getStyle().alpha=t,1!==t?this._renderType|=I.a.ALPHA:this._renderType&=~I.a.ALPHA,this._setRenderType(this._renderType),this.parentRepaint())}_getAlpha(){return this._style.alpha}get alpha(){return this._getAlpha()}set alpha(t){t=t<0?0:t>1?1:t,this._setAlpha(t)}get visible(){return this.get_visible()}set visible(t){this.set_visible(t)}get_visible(){return this._visible}set_visible(t){this._visible!==t&&(this._visible=t,this.parentRepaint(I.a.REPAINT_ALL))}_setBlendMode(t){}get blendMode(){return this._style.blendMode}set blendMode(t){this._setBlendMode(t),this.getStyle().blendMode=t,t&&"source-over"!=t?this._renderType|=I.a.BLEND:this._renderType&=~I.a.BLEND,this._setRenderType(this._renderType),this.parentRepaint()}get graphics(){return this._graphics||(this.graphics=new A.a,this._graphics.autoDestroy=!0),this._graphics}_setGraphics(t){}_setGraphicsCallBack(){}set graphics(t){this._graphics&&(this._graphics._sp=null),this._graphics=t,t?(this._setGraphics(t),this._renderType|=I.a.GRAPHICS,t._sp=this):this._renderType&=~I.a.GRAPHICS,this._setRenderType(this._renderType),this.repaint()}get scrollRect(){return this._style.scrollRect}_setScrollRect(t){}set scrollRect(t){this.getStyle().scrollRect=t,this._setScrollRect(t),this.repaint(),t?this._renderType|=I.a.CLIP:this._renderType&=~I.a.CLIP,this._setRenderType(this._renderType)}pos(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._x!==t||this._y!==e){if(this.destroyed)return this;if(i){this._setX(t),this._setY(e),this.parentRepaint(I.a.REPAINT_CACHE);var a=this._cacheStyle.maskParent;a&&a.repaint(I.a.REPAINT_CACHE)}else this.x=t,this.y=e}return this}pivot(t,e){return this.pivotX=t,this.pivotY=e,this}size(t,e){return this.width=t,this.height=e,this}scale(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var a=this.getStyle();if(a.scaleX!=t||a.scaleY!=e){if(this.destroyed)return this;i?(this._setScaleX(t),this._setScaleY(e),this._setTranformChange()):(this.scaleX=t,this.scaleY=e)}return this}skew(t,e){return this.skewX=t,this.skewY=e,this}render(t,e,i){m.a.renders[this._renderType]._fun(this,t,e+this._x,i+this._y),this._repaint=0}drawToCanvas(t,e,i,a){return M.drawToCanvas(this,this._renderType,t,e,i,a)}drawToTexture(t,e,i,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return M.drawToTexture(this,this._renderType,t,e,i,a,r)}drawToTexture3D(t,e,i){throw"not implement"}static drawToCanvas(t,e,i,a,r,s){r-=t.x,s-=t.y,r|=0,s|=0,i|=0,a|=0;var n=new p.a;n.size(i,a),n.asBitmap=!0,n._targets.start(),n._targets.clear(0,0,0,0),m.a.renders[e]._fun(t,n,r,s),n.flush(),n._targets.end(),n._targets.restore();var o=n._targets.getData(0,0,i,a);n.destroy();for(var l=new ImageData(i,a),h=4*i,_=(new Uint8Array(h),l.data),c=a-1,d=c*h,u=0;c>=0;c--)_.set(o.subarray(u,u+h),d),d-=h,u+=h;var f=new g.a(!0);return f.size(i,a),f.getContext("2d").putImageData(l,0,0),f}static drawToTexture(t,e,i,a,r,s){let n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;M.drawtocanvCtx||(M.drawtocanvCtx=new p.a),r-=t.x,s-=t.y,r|=0,s|=0,i|=0,a|=0;var o=n?M.drawtocanvCtx:new p.a;if(o.clear(),o.size(i,a),n?o._targets=n:o.asBitmap=!0,o._targets&&(o._targets.start(),o._targets.clear(0,0,0,0),m.a.renders[e]._fun(t,o,r,s),o.flush(),o._targets.end(),o._targets.restore()),!n){var l=new v.a(o._targets,v.a.INV_UV);return o.destroy(!0),l}return t._repaint=0,n}customRender(t,e,i){this._repaint=I.a.REPAINT_ALL}_applyFilters(){}get filters(){return this._cacheStyle.filters}_setColorFilter(t){}set filters(t){t&&0===t.length&&(t=null),this._cacheStyle.filters!=t&&(this._getCacheStyle().filters=t?t.slice():null,t&&t.length?(this._setColorFilter(t[0]),this._renderType|=I.a.FILTERS):(this._setColorFilter(null),this._renderType&=~I.a.FILTERS),this._setRenderType(this._renderType),t&&t.length>0?(this._getBit(o.a.DISPLAY)||this._setBitUp(o.a.DISPLAY),1==t.length&&t[0]instanceof h.a||(this._getCacheStyle().cacheForFilters=!0,this._checkCanvasEnable())):this._cacheStyle.cacheForFilters&&(this._cacheStyle.cacheForFilters=!1,this._checkCanvasEnable()),this._getCacheStyle().hasGlowFilter=this._isHaveGlowFilter(),this.repaint())}_isHaveGlowFilter(){var t,e;if(this.filters)for(t=0;t<this.filters.length;t++)if(this.filters[t].type==_.a.GLOW)return!0;for(t=0,e=this._children.length;t<e;t++)if(this._children[t]._isHaveGlowFilter())return!0;return!1}localToGlobal(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!0===e&&(t=new u.a(t.x,t.y));var a=this;for(i=i||n.a.stage;a&&!a.destroyed&&a!=i;)t=a.toParentPoint(t),a=a.parent;return t}globalToLocal(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e&&(t=new u.a(t.x,t.y));var a=this,r=[];for(i=i||n.a.stage;a&&!a.destroyed&&a!=i;)r.push(a),a=a.parent;for(var s=r.length-1;s>=0;)t=(a=r[s]).fromParentPoint(t),s--;return t}toParentPoint(t){if(!t)return t;t.x-=this.pivotX,t.y-=this.pivotY,this.transform&&this._transform.transformPoint(t),t.x+=this._x,t.y+=this._y;var e=this._style.scrollRect;return e&&(t.x-=e.x,t.y-=e.y),t}fromParentPoint(t){if(!t)return t;t.x-=this._x,t.y-=this._y;var e=this._style.scrollRect;return e&&(t.x+=e.x,t.y+=e.y),this.transform&&this._transform.invertTransformPoint(t),t.x+=this.pivotX,t.y+=this.pivotY,t}fromStagePoint(t){return t}on(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return 1!==this._mouseState&&this.isMouseEvent(t)?(this.mouseEnabled=!0,this._setBit(o.a.HAS_MOUSE,!0),this._parent&&this._onDisplay(),this._createListener(t,e,i,a,!1)):super.on(t,e,i,a)}once(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return 1!==this._mouseState&&this.isMouseEvent(t)?(this.mouseEnabled=!0,this._setBit(o.a.HAS_MOUSE,!0),this._parent&&this._onDisplay(),this._createListener(t,e,i,a,!0)):super.once(t,e,i,a)}_onDisplay(t){if(1!==this._mouseState){var e=this;for(e=e.parent;e&&1!==e._mouseState&&!e._getBit(o.a.HAS_MOUSE);)e.mouseEnabled=!0,e._setBit(o.a.HAS_MOUSE,!0),e=e.parent}}_setParent(t){super._setParent(t),t&&this._getBit(o.a.HAS_MOUSE)&&this._onDisplay()}loadImage(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t){var i=n.a.Loader.textureMap[C.a.formatURL(t)];i||((i=new v.a).load(t),n.a.Loader.cacheTexture(t,i)),this.texture=i,i.getIsReady()?a.call(this):i.once(l.a.READY,this,a)}else this.texture=null,a.call(this);function a(){this.repaint(I.a.REPAINT_ALL),e&&e.run()}return this}static fromImage(t){return(new M).loadImage(t)}repaint(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I.a.REPAINT_CACHE;this._repaint&t||(this._repaint|=t,this.parentRepaint(t)),this._cacheStyle&&this._cacheStyle.maskParent&&this._cacheStyle.maskParent.repaint(t)}_needRepaint(){return this._repaint&I.a.REPAINT_CACHE&&this._cacheStyle.enableCanvasRender&&this._cacheStyle.reCache}_childChanged(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._children.length?this._renderType|=I.a.CHILDS:this._renderType&=~I.a.CHILDS,this._setRenderType(this._renderType),t&&this._getBit(o.a.HAS_ZORDER)&&n.a.systemTimer.callLater(this,this.updateZOrder),this.repaint(I.a.REPAINT_ALL)}parentRepaint(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I.a.REPAINT_CACHE;var e=this._parent;!e||e._repaint&t||(e._repaint|=t,e.parentRepaint(t))}get stage(){return n.a.stage}get hitArea(){return this._style.hitArea}set hitArea(t){this.getStyle().hitArea=t}_setMask(t){}get mask(){return this._cacheStyle.mask}set mask(t){t&&this.mask&&this.mask._cacheStyle.maskParent||(this._getCacheStyle().mask=t,this._setMask(t),this._checkCanvasEnable(),t?t._getCacheStyle().maskParent=this:this.mask&&(this.mask._getCacheStyle().maskParent=null),this._renderType|=I.a.MASK,this._setRenderType(this._renderType),this.parentRepaint(I.a.REPAINT_ALL))}get mouseEnabled(){return this._mouseState>1}set mouseEnabled(t){this._mouseState=t?2:1}startDrag(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:300,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.92;this._style.dragging||(this.getStyle().dragging=new n.a.Dragging),this._style.dragging.start(this,t,e,i,a,r,s,o)}stopDrag(){this._style.dragging&&this._style.dragging.stop()}_setDisplay(t){t||this._cacheStyle&&(this._cacheStyle.releaseContext(),this._cacheStyle.releaseFilterCache(),this._cacheStyle.hasGlowFilter&&(this._cacheStyle.hasGlowFilter=!1)),super._setDisplay(t)}hitTestPoint(t,e){var i=this.globalToLocal(u.a.TEMP.setTo(t,e));return t=i.x,e=i.y,(this._style.hitArea?this._style.hitArea:this._width>0&&this._height>0?f.a.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains(t,e)}getMousePoint(){return this.globalToLocal(u.a.TEMP.setTo(n.a.stage.mouseX,n.a.stage.mouseY))}get globalScaleX(){for(var t=1,e=this;e&&e!==n.a.stage;)t*=e.scaleX,e=e.parent;return t}get globalRotation(){for(var t=0,e=this;e&&e!==n.a.stage;)t+=e.rotation,e=e.parent;return t}get globalScaleY(){for(var t=1,e=this;e&&e!==n.a.stage;)t*=e.scaleY,e=e.parent;return t}get mouseX(){return this.getMousePoint().x}get mouseY(){return this.getMousePoint().y}get zOrder(){return this._zOrder}set zOrder(t){this._zOrder!=t&&(this._zOrder=t,this._parent&&(t&&this._parent._setBit(o.a.HAS_ZORDER,!0),n.a.systemTimer.callLater(this._parent,this.updateZOrder)))}get texture(){return this._texture}_setTexture(t){}set texture(t){"string"==typeof t?this.loadImage(t):this._texture!=t&&(this._texture&&this._texture._removeReference(),this._texture=t,t&&t._addReference(),this._setTexture(t),this._setWidth(this._texture,this.width),this._setHeight(this._texture,this.height),t?this._renderType|=I.a.TEXTURE:this._renderType&=~I.a.TEXTURE,this._setRenderType(this._renderType),this.repaint())}get viewport(){return this._style.viewport}set viewport(t){var e;"string"==typeof t&&((e=t.split(",")).length>3&&(t=new f.a(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]))));this.getStyle().viewport=t}_setRenderType(t){}_setTranformChange(){this._tfChanged=!0,this._renderType|=I.a.TRANSFORM,this.parentRepaint(I.a.REPAINT_CACHE)}_setBgStyleColor(t,e,i,a,r){}_setBorderStyleColor(t,e,i,a,r,s){}captureMouseEvent(t){n.a.MouseManager.instance.setCapture(this,t)}releaseMouseEvent(){n.a.MouseManager.instance.releaseCapture()}set drawCallOptimize(t){this._setBit(o.a.DRAWCALL_OPTIMIZE,t)}get drawCallOptimize(){return this._getBit(o.a.DRAWCALL_OPTIMIZE)}}e.a=M,s()(M,"drawtocanvCtx",void 0),T.a.regClass("laya.display.Sprite",M),T.a.regClass("Laya.Sprite",M)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{}e.a=s,r()(s,"NOT_ACTIVE",1),r()(s,"ACTIVE_INHIERARCHY",2),r()(s,"AWAKED",4),r()(s,"NOT_READY",8),r()(s,"DISPLAY",16),r()(s,"HAS_ZORDER",32),r()(s,"HAS_MOUSE",64),r()(s,"DISPLAYED_INSTAGE",128),r()(s,"DRAWCALL_OPTIMIZE",256)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1),n=i(169),o=i(50),l=i(11),h=i(262);class _{static get useCannonPhysics(){return _._config.isUseCannonPhysicsEngine}static set useCannonPhysics(t){_._config.isUseCannonPhysicsEngine=t,t&&(o.a.__cannoninit__(),l.a.Scene3D.cannonPhysicsSettings||(l.a.Scene3D.cannonPhysicsSettings=new h.a))}get defaultPhysicsMemory(){return this._defaultPhysicsMemory}set defaultPhysicsMemory(t){if(t<16)throw"defaultPhysicsMemory must large than 16M";this._defaultPhysicsMemory=t}get maxLightCount(){return this._maxLightCount}set maxLightCount(t){t>2048?(this._maxLightCount=2048,console.warn("Config3D: maxLightCount must less equal 2048.")):this._maxLightCount=t}get lightClusterCount(){return this._lightClusterCount}set lightClusterCount(t){t.x>128||t.y>128||t.z>128?(this._lightClusterCount.setValue(Math.min(t.x,128),Math.min(t.y,128),Math.min(t.z,128)),console.warn("Config3D: lightClusterCount X and Y、Z must less equal 128.")):t.cloneTo(this._lightClusterCount);var e=4*Math.floor(2048/this._lightClusterCount.z-1);e<this._maxLightCount&&console.warn("Config3D: if the area light(PointLight、SpotLight) count is large than "+e+",maybe the far away culster will ingonre some light."),this._maxAreaLightCountPerClusterAverage=Math.min(e,this._maxLightCount)}constructor(){r()(this,"_defaultPhysicsMemory",16),r()(this,"_maxLightCount",32),r()(this,"_lightClusterCount",new s.a(12,12,12)),r()(this,"_editerEnvironment",!1),r()(this,"_multiLighting",void 0),r()(this,"_maxAreaLightCountPerClusterAverage",void 0),r()(this,"isAntialias",!0),r()(this,"isAlpha",!1),r()(this,"premultipliedAlpha",!0),r()(this,"isStencil",!0),r()(this,"enableMultiLight",!0),r()(this,"octreeCulling",!1),r()(this,"octreeInitialSize",64),r()(this,"octreeInitialCenter",new s.a(0,0,0)),r()(this,"octreeMinNodeSize",2),r()(this,"octreeLooseness",1.25),r()(this,"debugFrustumCulling",!1),r()(this,"pbrRenderQuality",n.a.High),r()(this,"isUseCannonPhysicsEngine",!1),this._maxAreaLightCountPerClusterAverage=Math.min(4*Math.floor(2048/this._lightClusterCount.z-1),this._maxLightCount)}cloneTo(t){var e=t;e._defaultPhysicsMemory=this._defaultPhysicsMemory,e._editerEnvironment=this._editerEnvironment,e.isAntialias=this.isAntialias,e.isAlpha=this.isAlpha,e.premultipliedAlpha=this.premultipliedAlpha,e.isStencil=this.isStencil,e.octreeCulling=this.octreeCulling,this.octreeInitialCenter.cloneTo(e.octreeInitialCenter),e.octreeInitialSize=this.octreeInitialSize,e.octreeMinNodeSize=this.octreeMinNodeSize,e.octreeLooseness=this.octreeLooseness,e.debugFrustumCulling=this.debugFrustumCulling,e.maxLightCount=this.maxLightCount,e.enableMultiLight=this.enableMultiLight;var i=e.lightClusterCount;this.lightClusterCount.cloneTo(i),e.lightClusterCount=i,e.pbrRenderQuality=this.pbrRenderQuality}clone(){var t=new _;return this.cloneTo(t),t}}e.a=_,r()(_,"_config",new _),window.Config3D=_},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{static gammaToLinearSpace(t){return t<=.04045?t/12.92:t<1?Math.pow((t+.055)/1.055,2.4):Math.pow(t,2.4)}static linearToGammaSpace(t){return t<=0?0:t<=.0031308?12.92*t:t<=1?1.055*Math.pow(t,.41666)-.055:Math.pow(t,.41666)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;r()(this,"r",void 0),r()(this,"g",void 0),r()(this,"b",void 0),r()(this,"a",void 0),this.r=t,this.g=e,this.b=i,this.a=a}toLinear(t){t.r=s.gammaToLinearSpace(this.r),t.g=s.gammaToLinearSpace(this.g),t.b=s.gammaToLinearSpace(this.b)}toGamma(t){t.r=s.linearToGammaSpace(this.r),t.g=s.linearToGammaSpace(this.g),t.b=s.linearToGammaSpace(this.b)}cloneTo(t){var e=t;e.r=this.r,e.g=this.g,e.b=this.b,e.a=this.a}clone(){var t=new s;return this.cloneTo(t),t}forNativeElement(){}}e.a=s,r()(s,"RED",new s(1,0,0,1)),r()(s,"GREEN",new s(0,1,0,1)),r()(s,"BLUE",new s(0,0,1,1)),r()(s,"CYAN",new s(0,1,1,1)),r()(s,"YELLOW",new s(1,.92,.016,1)),r()(s,"MAGENTA",new s(1,0,1,1)),r()(s,"GRAY",new s(.5,.5,.5,1)),r()(s,"WHITE",new s(1,1,1,1)),r()(s,"BLACK",new s(0,0,0,1))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(101),n=i(1);class o{setMin(t){var e=this._boundBox.min;t!==e&&t.cloneTo(e),this._setUpdateFlag(o._UPDATE_CENTER|o._UPDATE_EXTENT,!0),this._setUpdateFlag(o._UPDATE_MIN,!1)}getMin(){var t=this._boundBox.min;return this._getUpdateFlag(o._UPDATE_MIN)&&(this._getMin(this.getCenter(),this.getExtent(),t),this._setUpdateFlag(o._UPDATE_MIN,!1)),t}setMax(t){var e=this._boundBox.max;t!==e&&t.cloneTo(e),this._setUpdateFlag(o._UPDATE_CENTER|o._UPDATE_EXTENT,!0),this._setUpdateFlag(o._UPDATE_MAX,!1)}getMax(){var t=this._boundBox.max;return this._getUpdateFlag(o._UPDATE_MAX)&&(this._getMax(this.getCenter(),this.getExtent(),t),this._setUpdateFlag(o._UPDATE_MAX,!1)),t}setCenter(t){t!==this._center&&t.cloneTo(this._center),this._setUpdateFlag(o._UPDATE_MIN|o._UPDATE_MAX,!0),this._setUpdateFlag(o._UPDATE_CENTER,!1)}getCenter(){return this._getUpdateFlag(o._UPDATE_CENTER)&&(this._getCenter(this.getMin(),this.getMax(),this._center),this._setUpdateFlag(o._UPDATE_CENTER,!1)),this._center}setExtent(t){t!==this._extent&&t.cloneTo(this._extent),this._setUpdateFlag(o._UPDATE_MIN|o._UPDATE_MAX,!0),this._setUpdateFlag(o._UPDATE_EXTENT,!1)}getExtent(){return this._getUpdateFlag(o._UPDATE_EXTENT)&&(this._getExtent(this.getMin(),this.getMax(),this._extent),this._setUpdateFlag(o._UPDATE_EXTENT,!1)),this._extent}constructor(t,e){r()(this,"_updateFlag",0),r()(this,"_center",new n.a),r()(this,"_extent",new n.a),r()(this,"_boundBox",new s.a(new n.a,new n.a)),t.cloneTo(this._boundBox.min),e.cloneTo(this._boundBox.max),this._setUpdateFlag(o._UPDATE_CENTER|o._UPDATE_EXTENT,!0)}_getUpdateFlag(t){return 0!=(this._updateFlag&t)}_setUpdateFlag(t,e){e?this._updateFlag|=t:this._updateFlag&=~t}_getCenter(t,e,i){n.a.add(t,e,i),n.a.scale(i,.5,i)}_getExtent(t,e,i){n.a.subtract(e,t,i),n.a.scale(i,.5,i)}_getMin(t,e,i){n.a.subtract(t,e,i)}_getMax(t,e,i){n.a.add(t,e,i)}_rotateExtents(t,e,i){var a=t.x,r=t.y,s=t.z,n=e.elements;i.x=Math.abs(n[0]*a)+Math.abs(n[4]*r)+Math.abs(n[8]*s),i.y=Math.abs(n[1]*a)+Math.abs(n[5]*r)+Math.abs(n[9]*s),i.z=Math.abs(n[2]*a)+Math.abs(n[6]*r)+Math.abs(n[10]*s)}_tranform(t,e){var i=e._center,a=e._extent;n.a.transformCoordinate(this.getCenter(),t,i),this._rotateExtents(this.getExtent(),t,a),e._boundBox.setCenterAndExtent(i,a),e._updateFlag=0}_getBoundBox(){if(this._updateFlag&o._UPDATE_MIN){var t=this._boundBox.min;this._getMin(this.getCenter(),this.getExtent(),t),this._setUpdateFlag(o._UPDATE_MIN,!1)}if(this._updateFlag&o._UPDATE_MAX){var e=this._boundBox.max;this._getMax(this.getCenter(),this.getExtent(),e),this._setUpdateFlag(o._UPDATE_MAX,!1)}return this._boundBox}calculateBoundsintersection(t){var e=this.getMax(),i=this.getMin(),a=t.getMax(),r=t.getMin(),s=o.TEMP_VECTOR3_MAX0,n=o.TEMP_VECTOR3_MAX1,l=this.getExtent(),h=t.getExtent();return s.setValue(Math.max(e.x,a.x)-Math.min(i.x,r.x),Math.max(e.y,a.y)-Math.min(i.y,r.y),Math.max(e.z,a.z)-Math.min(i.z,r.z)),n.setValue(2*(l.x+h.x),2*(l.y+h.y),2*(l.z+h.z)),s.x>n.x?-1:s.y>n.y?-1:s.z>n.z?-1:(n.x-s.x)*(n.y-s.y)*(n.z-s.z)}cloneTo(t){var e=t;this.getMin().cloneTo(e._boundBox.min),this.getMax().cloneTo(e._boundBox.max),this.getCenter().cloneTo(e._center),this.getExtent().cloneTo(e._extent),e._updateFlag=0}clone(){var t=new o(new n.a,new n.a);return this.cloneTo(t),t}}e.a=o,r()(o,"_UPDATE_MIN",1),r()(o,"_UPDATE_MAX",2),r()(o,"_UPDATE_CENTER",4),r()(o,"_UPDATE_EXTENT",8),r()(o,"TEMP_VECTOR3_MAX0",new n.a),r()(o,"TEMP_VECTOR3_MAX1",new n.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{get destroyed(){return this._destroyed}constructor(){r()(this,"_destroyed",void 0),this._destroyed=!1}_getType(){throw"GeometryElement:must override it."}_prepareRender(t){return!0}_render(t){throw"GeometryElement:must override it."}destroy(){this._destroyed||(this._destroyed=!0)}}e.a=s,r()(s,"_typeCounter",0)},function(t,e,i){var a=i(34),r=i(194),s=i(196),n=Object.defineProperty;e.f=i(45)?Object.defineProperty:function(t,e,i){if(a(t),e=s(e,!0),a(i),r)try{return n(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,i){var a=i(44),r=i(65),s=i(89),n=i(142)("src"),o=i(308),l=(""+o).split("toString");i(140).inspectSource=function(t){return o.call(t)},(t.exports=function(t,e,i,o){var h="function"==typeof i;h&&(s(i,"name")||r(i,"name",e)),t[e]!==i&&(h&&(s(i,n)||r(i,n,t[e]?""+t[e]:l.join(String(e)))),t===a?t[e]=i:o?t[e]?t[e]=i:r(t,e,i):(delete t[e],r(t,e,i)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[n]||o.call(this)})},function(t,e,i){"use strict";let a;i.d(e,"a",function(){return a}),function(t){t[t.Point=0]="Point",t[t.Bilinear=1]="Bilinear",t[t.Trilinear=2]="Trilinear"}(a||(a={}))},function(t,e,i){"use strict";let a;i.d(e,"a",function(){return a}),function(t){t[t.Repeat=0]="Repeat",t[t.Clamp=1]="Clamp"}(a||(a={}))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(60),o=i(47);class l{static get maxTextureCount(){return this._maxTextureCount}static get maxTextureSize(){return this._maxTextureSize}static get shaderCapailityLevel(){return this._shaderCapailityLevel}static supportTextureFormat(t){switch(t){case n.a.R32G32B32A32:return!(!s.a.layaGPUInstance._isWebGL2&&!s.a.layaGPUInstance._oesTextureFloat);case n.a.R16G16B16A16:return!(!s.a.layaGPUInstance._isWebGL2&&!s.a.layaGPUInstance._oesTextureHalfFloat);default:return!0}}static supportRenderTextureFormat(t){switch(t){case o.b.R16G16B16A16:return!!(s.a.layaGPUInstance._isWebGL2&&s.a.layaGPUInstance._extColorBufferFloat||s.a.layaGPUInstance._oesTextureHalfFloat&&s.a.layaGPUInstance._oesTextureHalfFloatLinear);case o.b.Depth:return!(!s.a.layaGPUInstance._isWebGL2&&!s.a.layaGPUInstance._webgl_depth_texture);case o.b.ShadowMap:return!!s.a.layaGPUInstance._isWebGL2;default:return!0}}}e.a=l,r()(l,"_maxTextureCount",void 0),r()(l,"_maxTextureSize",void 0),r()(l,"_shaderCapailityLevel",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(3),n=i(2),o=i(221),l=i(15),h=i(16),_=i(26),c=i(8),d=i(67),u=i(223),f=i(328),m=i(94),p=i(329),g=i(330),v=i(331),T=i(332),E=i(224),S=i(91),R=i(227),x=i(29),A=i(340),y=i(36),I=i(341),C=i(342),M=i(228),D=i(61),b=i(344),L=i(153),O=i(93),P=i(345),N=i(229),w=i(346),B=i(230),F=i(156),V=i(159),U=i(160),G=i(66),H=i(10),z=i(108),k=i(47),W=i(48),X=i(42);class Y{static __init__(){Y.MAXCLIPRECT=new _.a(0,0,Y._MAXSIZE,Y._MAXSIZE),j.DEFAULT=new j,E.a}drawImage(){}getImageData(){}measureText(t){return null}setTransform(){}$transform(t,e,i,a,r,s){}get lineJoin(){return""}set lineJoin(t){}get lineCap(){return""}set lineCap(t){}get miterLimit(){return""}set miterLimit(t){}clearRect(t,e,i,a){}_drawRect(t,e,i,a,r){c.a.renderBatches++,r&&(this.fillStyle=r),this.fillRect(t,e,i,a,null)}drawTexture2(t,e,i,a,r,s){}transformByMatrix(t,e,i){this.transform(t.a,t.b,t.c,t.d,t.tx+e,t.ty+i)}saveTransform(t){this.save()}restoreTransform(t){this.restore()}drawRect(t,e,i,a,r,s,n){null!=r&&(this.fillStyle=r,this.fillRect(t,e,i,a)),null!=s&&(this.strokeStyle=s,this.lineWidth=n,this.strokeRect(t,e,i,a))}alpha(t){this.globalAlpha*=t}_transform(t,e,i){this.translate(e,i),this.transform(t.a,t.b,t.c,t.d,t.tx,t.ty),this.translate(-e,-i)}_rotate(t,e,i){this.translate(e,i),this.rotate(t),this.translate(-e,-i)}_scale(t,e,i,a){this.translate(i,a),this.scale(t,e),this.translate(-i,-a)}_drawLine(t,e,i,a,r,s,n,o,l){this.beginPath(),this.strokeStyle=n,this.lineWidth=o,this.moveTo(t+i,e+a),this.lineTo(t+r,e+s),this.stroke()}_drawLines(t,e,i,a,r,s){this.beginPath(),this.strokeStyle=a,this.lineWidth=r,this.addPath(i.slice(),!1,!1,t,e),this.stroke()}drawCurves(t,e,i,a,r){this.beginPath(),this.strokeStyle=a,this.lineWidth=r,this.moveTo(t+i[0],e+i[1]);for(var s=2,n=i.length;s<n;)this.quadraticCurveTo(t+i[s++],e+i[s++],t+i[s++],e+i[s++]);this.stroke()}_fillAndStroke(t,e,i){arguments.length>3&&void 0!==arguments[3]&&arguments[3];null!=t&&(this.fillStyle=t,this.fill()),null!=e&&i>0&&(this.strokeStyle=e,this.lineWidth=i,this.stroke())}_drawCircle(t,e,i,a,r,s,n){c.a.renderBatches++,this.beginPath(!0),this.arc(t,e,i,0,Y.PI2),this.closePath(),this._fillAndStroke(a,r,s)}_drawPie(t,e,i,a,r,s,n,o,l){this.beginPath(),this.moveTo(t,e),this.arc(t,e,i,a,r),this.closePath(),this._fillAndStroke(s,n,o)}_drawPoly(t,e,i,a,r,s,n,o){this.beginPath(),this.addPath(i.slice(),!0,n,t,e),this.closePath(),this._fillAndStroke(a,r,s,n)}_drawPath(t,e,i,a,r){this.beginPath();for(var s=0,n=i.length;s<n;s++){var o=i[s];switch(o[0]){case"moveTo":this.moveTo(t+o[1],e+o[2]);break;case"lineTo":this.lineTo(t+o[1],e+o[2]);break;case"arcTo":this.arcTo(t+o[1],e+o[2],t+o[3],e+o[4],o[5]);break;case"closePath":this.closePath()}}null!=a&&(this.fillStyle=a.fillStyle,this.fill()),null!=r&&(this.strokeStyle=r.strokeStyle,this.lineWidth=r.lineWidth||1,this.lineJoin=r.lineJoin,this.lineCap=r.lineCap,this.miterLimit=r.miterLimit,this.stroke())}static set2DRenderConfig(){var t=n.a.instance;H.a.setBlend(t,!0),H.a.setBlendEquation(t,t.FUNC_ADD),d.a.activeBlendFunction=null,H.a.setBlendFunc(t,t.ONE,t.ONE_MINUS_SRC_ALPHA),H.a.setDepthTest(t,!1),H.a.setCullFace(t,!1),H.a.setDepthMask(t,!0),H.a.setFrontFace(t,t.CCW),t.viewport(0,0,G.a.width,G.a.height)}constructor(){if(r()(this,"_canvas",void 0),r()(this,"_tmpMatrix",new l.a),r()(this,"_drawTexToDrawTri_Vert",new Float32Array(8)),r()(this,"_drawTexToDrawTri_Index",new Uint16Array([0,1,2,0,2,3])),r()(this,"_tempUV",new Float32Array(8)),r()(this,"_drawTriUseAbsMatrix",!1),r()(this,"_id",++Y._COUNT),r()(this,"_other",null),r()(this,"_renderNextSubmitIndex",0),r()(this,"_path",null),r()(this,"_drawCount",1),r()(this,"_width",Y._MAXSIZE),r()(this,"_height",Y._MAXSIZE),r()(this,"_renderCount",0),r()(this,"_submits",null),r()(this,"_curSubmit",null),r()(this,"_submitKey",new O.a),r()(this,"_mesh",null),r()(this,"_pathMesh",null),r()(this,"_triangleMesh",null),r()(this,"meshlist",[]),r()(this,"_transedPoints",new Array(8)),r()(this,"_temp4Points",new Array(8)),r()(this,"_clipRect",Y.MAXCLIPRECT),r()(this,"_globalClipMatrix",new l.a(Y._MAXSIZE,0,0,Y._MAXSIZE,0,0)),r()(this,"_clipInCache",!1),r()(this,"_clipInfoID",0),r()(this,"_clipID_Gen",0),r()(this,"_curMat",void 0),r()(this,"_lastMatScaleX",1),r()(this,"_lastMatScaleY",1),r()(this,"_lastMat_a",1),r()(this,"_lastMat_b",0),r()(this,"_lastMat_c",0),r()(this,"_lastMat_d",1),r()(this,"_nBlendType",0),r()(this,"_save",null),r()(this,"_targets",null),r()(this,"_charSubmitCache",null),r()(this,"_saveMark",null),r()(this,"_shader2D",new R.a),r()(this,"sprite",null),r()(this,"_italicDeg",0),r()(this,"_lastTex",null),r()(this,"_fillColor",0),r()(this,"_flushCnt",0),r()(this,"defTexture",null),r()(this,"_colorFiler",null),r()(this,"drawTexAlign",!1),r()(this,"_incache",!1),r()(this,"isMain",!1),Y._contextcount++,Y._textRender=Y._textRender||new B.a,!this.defTexture){var t=new X.a(2,2);t.setPixels(new Uint8Array(16)),t.lock=!0,this.defTexture=new W.a(t)}this._lastTex=this.defTexture,this.clear()}clearBG(t,e,i,a){var r=H.a.mainContext;r.clearColor(t,e,i,a),r.clear(r.COLOR_BUFFER_BIT)}_getSubmits(){return this._submits}_releaseMem(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._submits){this._curMat&&this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null,this._charSubmitCache.clear();for(var e=0,i=this._submits._length;e<i;e++)this._submits[e].releaseRender();var a;for(this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path=null,this._save=null,e=0,a=this.meshlist.length;e<a;e++){this.meshlist[e].destroy()}this.meshlist.length=0,this.sprite=null,t||(this._targets&&this._targets.destroy(),this._targets=null)}}destroy(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];--Y._contextcount,this.sprite=null,this._releaseMem(t),this._charSubmitCache.destroy(),this._mesh.destroy(),t||(this._targets&&this._targets.destroy(),this._targets=null)}clear(){this._submits||(this._other=j.DEFAULT,this._curMat=l.a.create(),this._charSubmitCache=new w.a,this._mesh=F.a.getAMesh(this.isMain),this.meshlist.push(this._mesh),this._pathMesh=U.a.getAMesh(this.isMain),this.meshlist.push(this._pathMesh),this._triangleMesh=V.a.getAMesh(this.isMain),this.meshlist.push(this._triangleMesh),this._submits=[],this._save=[g.a.Create(this)],this._save.length=10,this._shader2D=new R.a),this._submitKey.clear(),this._mesh.clearVB(),this._drawCount=1,this._other=j.DEFAULT,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=Y.MAXCLIPRECT,this._curSubmit=D.a.RENDERBASE,D.a.RENDERBASE._ref=16777215,D.a.RENDERBASE._numEle=0,this._shader2D.fillStyle=this._shader2D.strokeStyle=u.a.DEFAULT;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1}size(t,e){this._width==t&&this._height==e||(this._width=t,this._height=e,this._targets&&(this._targets.destroy(),this._targets=new z.a(t,e,k.b.R8G8B8A8,-1)),this.isMain&&(H.a.mainContext.viewport(0,0,t,e),G.a.width=t,G.a.height=e)),0===t&&0===e&&this._releaseMem()}set asBitmap(t){if(t){let t=this._targets;if(!this._width||!this._height)throw Error("asBitmap no size!");t&&t.width==this._width&&t.height==this._height||(t&&t.destroy(),this._targets=new z.a(this._width,this._height,k.b.R8G8B8A8,-1))}else this._targets&&this._targets.destroy(),this._targets=null}getMatScaleX(){return this._lastMat_a==this._curMat.a&&this._lastMat_b==this._curMat.b?this._lastMatScaleX:(this._lastMatScaleX=this._curMat.getScaleX(),this._lastMat_a=this._curMat.a,this._lastMat_b=this._curMat.b,this._lastMatScaleX)}getMatScaleY(){return this._lastMat_c==this._curMat.c&&this._lastMat_d==this._curMat.d?this._lastMatScaleY:(this._lastMatScaleY=this._curMat.getScaleY(),this._lastMat_c=this._curMat.c,this._lastMat_d=this._curMat.d,this._lastMatScaleY)}setFillColor(t){this._fillColor=t}getFillColor(){return this._fillColor}set fillStyle(t){this._shader2D.fillStyle.equal(t)||(m.a.save(this,m.a.TYPE_FILESTYLE,this._shader2D,!1),this._shader2D.fillStyle=u.a.create(t),this._submitKey.other=-this._shader2D.fillStyle.toInt())}get fillStyle(){return this._shader2D.fillStyle}set globalAlpha(t){(t=Math.floor(1e3*t)/1e3)!=this._shader2D.ALPHA&&(m.a.save(this,m.a.TYPE_ALPHA,this._shader2D,!1),this._shader2D.ALPHA=t)}get globalAlpha(){return this._shader2D.ALPHA}set textAlign(t){this._other.textAlign===t||(this._other=this._other.make(),m.a.save(this,m.a.TYPE_TEXTALIGN,this._other,!1),this._other.textAlign=t)}get textAlign(){return this._other.textAlign}set textBaseline(t){this._other.textBaseline===t||(this._other=this._other.make(),m.a.save(this,m.a.TYPE_TEXTBASELINE,this._other,!1),this._other.textBaseline=t)}get textBaseline(){return this._other.textBaseline}set globalCompositeOperation(t){var e=d.a.TOINT[t];null==e||this._nBlendType===e||(m.a.save(this,m.a.TYPE_GLOBALCOMPOSITEOPERATION,this,!0),this._curSubmit=D.a.RENDERBASE,this._nBlendType=e)}get globalCompositeOperation(){return d.a.NAMES[this._nBlendType]}set strokeStyle(t){this._shader2D.strokeStyle.equal(t)||(m.a.save(this,m.a.TYPE_STROKESTYLE,this._shader2D,!1),this._shader2D.strokeStyle=u.a.create(t),this._submitKey.other=-this._shader2D.strokeStyle.toInt())}get strokeStyle(){return this._shader2D.strokeStyle}translate(t,e){0===t&&0===e||(T.a.save(this),this._curMat._bTransform?(v.a.save(this),this._curMat.tx+=t*this._curMat.a+e*this._curMat.c,this._curMat.ty+=t*this._curMat.b+e*this._curMat.d):(this._curMat.tx=t,this._curMat.ty=e))}set lineWidth(t){this._other.lineWidth===t||(this._other=this._other.make(),m.a.save(this,m.a.TYPE_LINEWIDTH,this._other,!1),this._other.lineWidth=t)}get lineWidth(){return this._other.lineWidth}save(){this._save[this._save._length++]=g.a.Create(this)}restore(){var t=this._save._length,e=this._nBlendType;if(!(t<1)){for(var i=t-1;i>=0;i--){var a=this._save[i];if(a.restore(this),a.isSaveMark())return void(this._save._length=i)}e!=this._nBlendType&&(this._curSubmit=D.a.RENDERBASE)}}set font(t){this._other=this._other.make(),m.a.save(this,m.a.TYPE_FONT,this._other,!1)}fillText(t,e,i,a,r,s){let n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"";Y._textRender.filltext(this,t,e,i,a,r,o,n,s)}drawText(t,e,i,a,r,s){Y._textRender.filltext(this,t,e,i,a,r,null,0,s)}fillWords(t,e,i,a,r){Y._textRender.fillWords(this,t,e,i,a,r,null,0)}strokeWord(t,e,i,a,r,s,n){Y._textRender.filltext(this,t,e,i,a,null,r,s,n)}fillBorderText(t,e,i,a,r,s,n,o){Y._textRender.filltext(this,t,e,i,a,r,s,n,o)}fillBorderWords(t,e,i,a,r,s,n){Y._textRender.fillWords(this,t,e,i,a,r,s,n)}_fast_filltext(t,e,i,a,r,s,n,o){let l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;Y._textRender._fast_filltext(this,t,null,e,i,a,r,s,n,o,l)}_fillRect(t,e,i,a,r){var s=this._curSubmit,n=s&&s._key.submitType===D.a.KEY_DRAWTEXTURE&&s._key.blendShader===this._nBlendType;this._mesh.vertNum+4>Y._MAXVERTNUM&&(this._mesh=F.a.getAMesh(this.isMain),this.meshlist.push(this._mesh),n=!1),n&&(n=n&&this.isSameClipInfo(s)),this.transformQuad(t,e,i,a,0,this._curMat,this._transedPoints),this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,W.a.NO_UV,r,!1),n||(s=this._curSubmit=N.a.create(this,this._mesh,y.a.create(x.a.TEXTURE2D,0)),this._submits[this._submits._length++]=s,this._copyClipInfo(s,this._globalClipMatrix),s.shaderValue.textureHost=this._lastTex,s._key.other=this._lastTex&&this._lastTex.bitmap?this._lastTex.bitmap.id:-1,s._renderType=D.a.TYPE_TEXTURE),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)}fillRect(t,e,i,a,r){var s=r?u.a.create(r):this._shader2D.fillStyle,n=this.mixRGBandAlpha(s.toInt());this._fillRect(t,e,i,a,n)}fillTexture(t,e,i,a,r,n,o,l){t._getSource()?this._fillTexture(t,t.width,t.height,t.uvrect,e,i,a,r,n,o.x,o.y):this.sprite&&s.a.systemTimer.callLater(this,this._repaintSprite)}_fillTexture(t,e,i,a,r,s,n,o,l,h,_){var c=this._curSubmit;this._mesh.vertNum+4>Y._MAXVERTNUM&&(this._mesh=F.a.getAMesh(this.isMain),this.meshlist.push(this._mesh));var d=!0,u=!0;switch(l){case"repeat":break;case"repeat-x":u=!1;break;case"repeat-y":d=!1;break;case"no-repeat":d=u=!1}var f=this._temp4Points,m=0,p=0,g=0,v=0,T=0,E=0;if(h<0?(g=r,m=-h%e/e):g=r+h,_<0?(v=s,p=-_%i/i):v=s+_,T=r+n,E=s+o,!d&&(T=Math.min(T,r+h+e)),!u&&(E=Math.min(E,s+_+i)),!(T<r||E<s||g>T||v>E)){var S=(T-r-h)/e,R=(E-s-_)/i;if(this.transformQuad(g,v,T-g,E-v,0,this._curMat,this._transedPoints),f[0]=m,f[1]=p,f[2]=S,f[3]=p,f[4]=S,f[5]=R,f[6]=m,f[7]=R,!this.clipedOff(this._transedPoints)){var A=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA);this._mesh.addQuad(this._transedPoints,f,A,!0);var I=y.a.create(x.a.TEXTURE2D,0);I.defines.add(x.a.FILLTEXTURE),I.u_TexRange=a.concat(),c=this._curSubmit=N.a.create(this,this._mesh,I),this._submits[this._submits._length++]=c,this._copyClipInfo(c,this._globalClipMatrix),c.shaderValue.textureHost=t,c._renderType=D.a.TYPE_TEXTURE,this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4}this.breakNextMerge()}}setColorFilter(t){m.a.save(this,m.a.TYPE_COLORFILTER,this,!0),this._colorFiler=t,this._curSubmit=D.a.RENDERBASE}drawTexture(t,e,i,a,r){this._drawTextureM(t,e,i,a,r,null,1,null)}drawTextures(t,e,i,a){if(t._getSource())for(var r=e.length/2,n=0,o=t.bitmap.id,l=0;l<r;l++)this._inner_drawTexture(t,o,e[n++]+i,e[n++]+a,0,0,null,null,1,!1);else this.sprite&&s.a.systemTimer.callLater(this,this._repaintSprite)}_drawTextureAddSubmit(t,e){var i=null;i=N.a.create(this,this._mesh,y.a.create(x.a.TEXTURE2D,0)),this._submits[this._submits._length++]=i,i.shaderValue.textureHost=e,i._key.other=t,i._renderType=D.a.TYPE_TEXTURE,this._curSubmit=i}_drawTextureM(t,e,i,a,r,s,n,o){var l=this.sprite;return!!t._getSource(function(){l&&l.repaint()})&&this._inner_drawTexture(t,t.bitmap.id,e,i,a,r,s,o,n,!1)}_drawRenderTexture(t,e,i,a,r,s,n,o){return this._inner_drawTexture(t,-1,e,i,a,r,s,o,1,!1)}submitDebugger(){this._submits[this._submits._length++]=L.a.create([],function(){},this)}_copyClipInfo(t,e){var i=t.shaderValue.clipMatDir;i[0]=e.a,i[1]=e.b,i[2]=e.c,i[3]=e.d;var a=t.shaderValue.clipMatPos;a[0]=e.tx,a[1]=e.ty,t.clipInfoID=this._clipInfoID,this._clipInCache&&(t.shaderValue.clipOff[0]=1)}isSameClipInfo(t){return t.clipInfoID===this._clipInfoID}_useNewTex2DSubmit(t,e){this._mesh.vertNum+e>Y._MAXVERTNUM&&(this._mesh=F.a.getAMesh(this.isMain),this.meshlist.push(this._mesh));var i=N.a.create(this,this._mesh,y.a.create(x.a.TEXTURE2D,0));this._submits[this._submits._length++]=this._curSubmit=i,i.shaderValue.textureHost=t,this._copyClipInfo(i,this._globalClipMatrix)}_drawTexRect(t,e,i,a,r){this.transformQuad(t,e,i,a,this._italicDeg,this._curMat,this._transedPoints);var s=this._transedPoints;s[0]=s[0]+.5|0,s[1]=s[1]+.5|0,s[2]=s[2]+.5|0,s[3]=s[3]+.5|0,s[4]=s[4]+.5|0,s[5]=s[5]+.5|0,s[6]=s[6]+.5|0,s[7]=s[7]+.5|0,this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,r,this._fillColor,!0),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)}drawCallOptimize(t){return this._charSubmitCache.enable(t,this),t}_inner_drawTexture(t,e,i,a,r,s,n,o,l,h){if(!(r<=0||s<=0)){var _=this._curSubmit._key;if(o=o||t._uv,_.submitType===D.a.KEY_TRIANGLES&&_.other===e){var c=this._drawTexToDrawTri_Vert;c[0]=i,c[1]=a,c[2]=i+r,c[3]=a,c[4]=i+r,c[5]=a+s,c[6]=i,c[7]=a+s,this._drawTriUseAbsMatrix=!0;var d=this._tempUV;return d[0]=o[0],d[1]=o[1],d[2]=o[2],d[3]=o[3],d[4]=o[4],d[5]=o[5],d[6]=o[6],d[7]=o[7],this.drawTriangles(t,0,0,c,d,this._drawTexToDrawTri_Index,n,l,null,null),this._drawTriUseAbsMatrix=!1,!0}var u=this._mesh,f=this._curSubmit,m=h?this._charSubmitCache.getPos():this._transedPoints;if(this.transformQuad(i,a,r||t.width,s||t.height,this._italicDeg,n||this._curMat,m),this.drawTexAlign){var p=Math.round;m[0]=p(m[0]),m[1]=p(m[1]),m[2]=p(m[2]),m[3]=p(m[3]),m[4]=p(m[4]),m[5]=p(m[5]),m[6]=p(m[6]),m[7]=p(m[7]),this.drawTexAlign=!1}var g=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*l);if(h)return this._charSubmitCache.add(this,t,e,m,o,g),!0;this._drawCount++;var v=e>=0&&_.submitType===D.a.KEY_DRAWTEXTURE&&_.other===e;return v&&(v=v&&this.isSameClipInfo(f)),this._lastTex=t,u.vertNum+4>Y._MAXVERTNUM&&(u=this._mesh=F.a.getAMesh(this.isMain),this.meshlist.push(u),v=!1),u.addQuad(m,o,g,!0),v||(this._submits[this._submits._length++]=this._curSubmit=f=N.a.create(this,u,y.a.create(x.a.TEXTURE2D,0)),f.shaderValue.textureHost=t,f._key.other=e,this._copyClipInfo(f,this._globalClipMatrix)),f._numEle+=6,u.indexNum+=6,u.vertNum+=4,!0}}transform4Points(t,e,i){var a=e.tx,r=e.ty,s=e.a,n=e.b,o=e.c,l=e.d,h=t[0],_=t[1],c=t[2],d=t[3],u=t[4],f=t[5],m=t[6],p=t[7];e._bTransform?(i[0]=h*s+_*o+a,i[1]=h*n+_*l+r,i[2]=c*s+d*o+a,i[3]=c*n+d*l+r,i[4]=u*s+f*o+a,i[5]=u*n+f*l+r,i[6]=m*s+p*o+a,i[7]=m*n+p*l+r):(i[0]=h+a,i[1]=_+r,i[2]=c+a,i[3]=d+r,i[4]=u+a,i[5]=f+r,i[6]=m+a,i[7]=p+r)}clipedOff(t){return this._clipRect.width<=0||this._clipRect.height<=0}transformQuad(t,e,i,a,r,s,n){var o=0;0!=r&&(o=Math.tan(r*Math.PI/180)*a);var l=t+i,h=e+a,_=s.tx,c=s.ty,d=s.a,u=s.b,f=s.c,m=s.d,p=t+o,g=e,v=l+o,T=e,E=l,S=h,R=t,x=h;s._bTransform?(n[0]=p*d+g*f+_,n[1]=p*u+g*m+c,n[2]=v*d+T*f+_,n[3]=v*u+T*m+c,n[4]=E*d+S*f+_,n[5]=E*u+S*m+c,n[6]=R*d+x*f+_,n[7]=R*u+x*m+c):(n[0]=p+_,n[1]=g+c,n[2]=v+_,n[3]=T+c,n[4]=E+_,n[5]=S+c,n[6]=R+_,n[7]=x+c)}pushRT(){this.addRenderObject(L.a.create(null,z.a.pushRT,this))}popRT(){this.addRenderObject(L.a.create(null,z.a.popRT,this)),this.breakNextMerge()}useRT(t){this.addRenderObject(L.a.create([t],function(t){if(!t)throw"error useRT";t.start(),t.clear(0,0,0,0)},this)),this.breakNextMerge()}RTRestore(t){this.addRenderObject(L.a.create([t],function(t){t.restore()},this)),this.breakNextMerge()}breakNextMerge(){this._curSubmit=D.a.RENDERBASE}_repaintSprite(){this.sprite&&this.sprite.repaint()}drawTextureWithTransform(t,e,i,a,r,s,n,o,h,_){let c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,d=arguments.length>11?arguments[11]:void 0;var u,f=this._curMat;_&&(u=this.globalCompositeOperation,this.globalCompositeOperation=_);var m=this._colorFiler;if(c&&this.setColorFilter(c),!s)return this._drawTextureM(t,e+n,i+o,a,r,f,h,d),_&&(this.globalCompositeOperation=u),void(c&&this.setColorFilter(m));var p=this._tmpMatrix;p.a=s.a,p.b=s.b,p.c=s.c,p.d=s.d,p.tx=s.tx+n,p.ty=s.ty+o,p._bTransform=s._bTransform,s&&f._bTransform?(l.a.mul(p,f,p),(s=p)._bTransform=!0):(p.tx+=f.tx,p.ty+=f.ty,s=p),this._drawTextureM(t,e,i,a,r,s,h,d),_&&(this.globalCompositeOperation=u),c&&this.setColorFilter(m)}_flushToTarget(t,e){G.a.worldScissorTest=!1;var i=n.a.instance;i.disable(i.SCISSOR_TEST);var a=G.a.worldAlpha,r=G.a.worldMatrix4,s=G.a.worldMatrix;G.a.worldShaderDefines;G.a.worldMatrix=l.a.EMPTY,G.a.restoreTempArray(),G.a.worldMatrix4=G.a.TEMPMAT4_ARRAY,G.a.worldAlpha=1,S.a.activeShader=null,e.start(),t._submits._length>0&&e.clear(0,0,0,0),t._curSubmit=D.a.RENDERBASE,t.flush(),t.clear(),e.restore(),t._curSubmit=D.a.RENDERBASE,S.a.activeShader=null,G.a.worldAlpha=a,G.a.worldMatrix4=r,G.a.worldMatrix=s}drawCanvas(t,e,i,a,r){if(t){var s,n=t.context;if(n._targets)n._submits._length>0&&(s=L.a.create([n,n._targets],this._flushToTarget,this),this._submits[this._submits._length++]=s),this._drawRenderTexture(n._targets,e,i,a,r,null,1,z.a.flipyuv),this._curSubmit=D.a.RENDERBASE;else{var o=t;o.touches&&o.touches.forEach(function(t){t.touch()}),s=b.a.create(t,this._shader2D.ALPHA,this._shader2D.filters),this._submits[this._submits._length++]=s,s._key.clear();var _=s._matrix;this._curMat.copyTo(_);var c=_.tx,d=_.ty;_.tx=_.ty=0,_.transformPoint(h.a.TEMP.setTo(e,i)),_.translate(h.a.TEMP.x+c,h.a.TEMP.y+d),l.a.mul(o.invMat,_,_),this._curSubmit=D.a.RENDERBASE}}}drawTarget(t,e,i,a,r,s,n){let o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:-1;this._drawCount++;if(this._mesh.vertNum+4>Y._MAXVERTNUM&&(this._mesh=F.a.getAMesh(this.isMain),this.meshlist.push(this._mesh)),this.transformQuad(e,i,a,r,0,s||this._curMat,this._transedPoints),!this.clipedOff(this._transedPoints)){this._mesh.addQuad(this._transedPoints,o||W.a.DEF_UV,4294967295,!0);var h=this._curSubmit=P.a.create(this,this._mesh,n,t);return h.blendType=-1==l?this._nBlendType:l,this._copyClipInfo(h,this._globalClipMatrix),h._numEle=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,this._submits[this._submits._length++]=h,this._curSubmit=D.a.RENDERBASE,!0}return this._curSubmit=D.a.RENDERBASE,!1}drawTriangles(t,e,i,a,r,n,o,h,_,c){let d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:4294967295;if(t._getSource()){var u=null;c&&(u=this.globalCompositeOperation,this.globalCompositeOperation=c),this._drawCount++;var f=this._tmpMatrix,m=this._triangleMesh,p=null,g=!1;_&&(p=this._colorFiler,this._colorFiler=_,this._curSubmit=D.a.RENDERBASE,g=p!=_);var v=t.bitmap,T=this._curSubmit._key,E=T.submitType===D.a.KEY_TRIANGLES&&T.other===v.id&&T.blendShader==this._nBlendType;if(m.vertNum+a.length/2>Y._MAXVERTNUM&&(m=this._triangleMesh=V.a.getAMesh(this.isMain),this.meshlist.push(m),E=!1),!E){var S=this._curSubmit=N.a.create(this,m,y.a.create(x.a.TEXTURE2D,0));S.shaderValue.textureHost=t,S._renderType=D.a.TYPE_TEXTURE,S._key.submitType=D.a.KEY_TRIANGLES,S._key.other=v.id,this._copyClipInfo(S,this._globalClipMatrix),this._submits[this._submits._length++]=S}var R=this._mixRGBandAlpha(d,this._shader2D.ALPHA*h);this._drawTriUseAbsMatrix?m.addData(a,r,n,o,R):(o?(f.a=o.a,f.b=o.b,f.c=o.c,f.d=o.d,f.tx=o.tx+e,f.ty=o.ty+i):(f.a=1,f.b=0,f.c=0,f.d=1,f.tx=e,f.ty=i),l.a.mul(f,this._curMat,f),m.addData(a,r,n,f||this._curMat,R)),this._curSubmit._numEle+=n.length,g&&(this._colorFiler=p,this._curSubmit=D.a.RENDERBASE),c&&(this.globalCompositeOperation=u)}else this.sprite&&s.a.systemTimer.callLater(this,this._repaintSprite)}transform(t,e,i,a,r,s){v.a.save(this),l.a.mul(l.a.TEMP.setTo(t,e,i,a,r,s),this._curMat,this._curMat),this._curMat._checkTransform()}_transformByMatrix(t,e,i){t.setTranslate(e,i),l.a.mul(t,this._curMat,this._curMat),t.setTranslate(0,0),this._curMat._bTransform=!0}setTransformByMatrix(t){t.copyTo(this._curMat)}rotate(t){v.a.save(this),this._curMat.rotateEx(t)}scale(t,e){v.a.save(this),this._curMat.scaleEx(t,e)}clipRect(t,e,i,a){p.a.save(this),this._clipRect==Y.MAXCLIPRECT?this._clipRect=new _.a(t,e,i,a):(this._clipRect.width=i,this._clipRect.height=a,this._clipRect.x=t,this._clipRect.y=e),this._clipID_Gen++,this._clipID_Gen%=1e4,this._clipInfoID=this._clipID_Gen;var r=this._globalClipMatrix,s=r.tx,n=r.ty,o=s+r.a,l=n+r.d;if(this._clipRect.width>=Y._MAXSIZE?(r.a=r.d=Y._MAXSIZE,r.b=r.c=r.tx=r.ty=0):(this._curMat._bTransform?(r.tx=this._clipRect.x*this._curMat.a+this._clipRect.y*this._curMat.c+this._curMat.tx,r.ty=this._clipRect.x*this._curMat.b+this._clipRect.y*this._curMat.d+this._curMat.ty,r.a=this._clipRect.width*this._curMat.a,r.b=this._clipRect.width*this._curMat.b,r.c=this._clipRect.height*this._curMat.c,r.d=this._clipRect.height*this._curMat.d):(r.tx=this._clipRect.x+this._curMat.tx,r.ty=this._clipRect.y+this._curMat.ty,r.a=this._clipRect.width,r.b=r.c=0,r.d=this._clipRect.height),this._incache&&(this._clipInCache=!0)),r.a>0&&r.d>0){var h=r.tx+r.a,c=r.ty+r.d;h<=s||c<=n||r.tx>=o||r.ty>=l?(r.a=-.1,r.d=-.1):(r.tx<s&&(r.a-=s-r.tx,r.tx=s),h>o&&(r.a-=h-o),r.ty<n&&(r.d-=n-r.ty,r.ty=n),c>l&&(r.d-=c-l),r.a<=0&&(r.a=-.1),r.d<=0&&(r.d=-.1))}}drawMesh(t,e,i,a,r,s,n,o){arguments.length>8&&void 0!==arguments[8]&&arguments[8]}addRenderObject(t){this._submits[this._submits._length++]=t}submitElement(t,e){this.isMain;var i=this._submits,a=i._length;e<0&&(e=i._length);for(var r=D.a.RENDERBASE;t<e;)this._renderNextSubmitIndex=t+1,i[t]!==D.a.RENDERBASE?(D.a.preRender=r,t+=(r=i[t]).renderSubmit()):t++;return a}flush(){this._clipID_Gen=0;var t=this.submitElement(0,this._submits._length);this._path&&this._path.reset(),A.a.instance&&A.a.getInstance().reset(),this._curSubmit=D.a.RENDERBASE;for(var e=0,i=this.meshlist.length;e<i;e++){var a=this.meshlist[e];a.canReuse?a.releaseMesh():a.destroy()}return this.meshlist.length=0,this._mesh=F.a.getAMesh(this.isMain),this._pathMesh=U.a.getAMesh(this.isMain),this._triangleMesh=V.a.getAMesh(this.isMain),this.meshlist.push(this._mesh,this._pathMesh,this._triangleMesh),this._flushCnt++,this._flushCnt%60==0&&this.isMain&&B.a.textRenderInst&&B.a.textRenderInst.GC(),t}beginPath(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._getPath().beginPath(t)}closePath(){this._path.closePath()}addPath(t,e,i,a,r){for(var s=0,n=0,o=t.length/2;n<o;n++){var l=t[s]+a,h=t[s+1]+r;t[s]=l,t[s+1]=h,s+=2}this._getPath().push(t,i)}fill(){var t=this._curMat,e=this._getPath(),i=this._curSubmit,a=i._key.submitType===D.a.KEY_VG&&i._key.blendShader===this._nBlendType;a&&(a=a&&this.isSameClipInfo(i)),a||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var r,s=this.mixRGBandAlpha(this.fillStyle.toInt()),n=0,o=0,l=e.paths.length;o<l;o++){var h=e.paths[o],_=h.path.length/2;if(!(_<3||3==_&&!h.convex)){var c,d,u,f,m=h.path.concat(),p=0;if(t._bTransform)for(p=0;p<_;p++)d=(c=p<<1)+1,u=m[c],f=m[d],m[c]=t.a*u+t.c*f+t.tx,m[d]=t.b*u+t.d*f+t.ty;else for(p=0;p<_;p++)d=(c=p<<1)+1,u=m[c],f=m[d],m[c]=u+t.tx,m[d]=f+t.ty;this._pathMesh.vertNum+_>Y._MAXVERTNUM&&(this._curSubmit._numEle+=n,n=0,this._pathMesh=U.a.getAMesh(this.isMain),this._curSubmit=this.addVGSubmit(this._pathMesh));var g=this._pathMesh.vertNum;if(h.convex){var v=_-2;r=new Array(3*v);for(var T=0,E=0;E<v;E++)r[T++]=g,r[T++]=E+1+g,r[T++]=E+2+g}else if(r=C.a.earcut(m,null,2),g>0)for(var S=0;S<r.length;S++)r[S]+=g;this._pathMesh.addVertAndIBToMesh(this,m,s,r),n+=r.length}}this._curSubmit._numEle+=n}addVGSubmit(t){var e=M.a.createShape(this,t,0,y.a.create(x.a.PRIMITIVE,0));return e._key.submitType=D.a.KEY_VG,this._submits[this._submits._length++]=e,this._copyClipInfo(e,this._globalClipMatrix),e}stroke(){if(this.lineWidth>0){var t=this.mixRGBandAlpha(this.strokeStyle._color.numColor),e=this._getPath(),i=this._curSubmit,a=i._key.submitType===D.a.KEY_VG&&i._key.blendShader===this._nBlendType;a&&(a=a&&this.isSameClipInfo(i)),a||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var r=0,s=0,n=e.paths.length;s<n;s++){var o=e.paths[s];if(!(o.path.length<=0)){var l=[],h=[],_=2*o.path.length;if(!(_<2)){this._pathMesh.vertNum+_>Y._MAXVERTNUM&&(this._curSubmit._numEle+=r,r=0,this._pathMesh=U.a.getAMesh(this.isMain),this.meshlist.push(this._pathMesh),this._curSubmit=this.addVGSubmit(this._pathMesh)),I.a.createLine2(o.path,l,this.lineWidth,this._pathMesh.vertNum,h,o.loop);var c,d,u,f,m=h.length/2,p=this._curMat,g=0;if(p._bTransform)for(g=0;g<m;g++)d=(c=g<<1)+1,u=h[c],f=h[d],h[c]=p.a*u+p.c*f+p.tx,h[d]=p.b*u+p.d*f+p.ty;else for(g=0;g<m;g++)d=(c=g<<1)+1,u=h[c],f=h[d],h[c]=u+p.tx,h[d]=f+p.ty;this._pathMesh.addVertAndIBToMesh(this,h,t,l),r+=l.length}}}this._curSubmit._numEle+=r}}moveTo(t,e){var i=this._getPath();i.newPath(),i._lastOriX=t,i._lastOriY=e,i.addPoint(t,e)}lineTo(t,e){var i=this._getPath();Math.abs(t-i._lastOriX)<.001&&Math.abs(e-i._lastOriY)<.001||(i._lastOriX=t,i._lastOriY=e,i.addPoint(t,e))}arcTo(t,e,i,a,r){var s=0,n=0,o=0,l=this._path._lastOriX-t,h=this._path._lastOriY-e,_=Math.sqrt(l*l+h*h);if(!(_<=1e-6)){var c=l/_,d=h/_,u=i-t,f=a-e,m=u*u+f*f,p=Math.sqrt(m);if(!(p<=1e-6)){var g=u/p,v=f/p,T=c+g,E=d+v,S=Math.sqrt(T*T+E*E);if(!(S<=1e-6)){var R=T/S,x=E/S,A=Math.acos(R*c+x*d),y=Math.PI/2-A,I=(_=r/Math.tan(y))*c+t,C=_*d+e,M=Math.sqrt(_*_+r*r),D=t+R*M,b=e+x*M,L=0,O=0;if(c*v-d*g>=0){var P=2*y/Y.SEGNUM;L=Math.sin(P),O=Math.cos(P)}else P=2*-y/Y.SEGNUM,L=Math.sin(P),O=Math.cos(P);var N=this._path._lastOriX,w=this._path._lastOriY,B=I,F=C;(Math.abs(B-this._path._lastOriX)>.1||Math.abs(F-this._path._lastOriY)>.1)&&(n=B,o=F,N=B,w=F,this._path._lastOriX=n,this._path._lastOriY=o,this._path.addPoint(n,o));var V=I-D,U=C-b;for(s=0;s<Y.SEGNUM;s++){var G=V*O+U*L,H=-V*L+U*O;n=G+D,o=H+b,(Math.abs(N-n)>.1||Math.abs(w-o)>.1)&&(this._path._lastOriX=n,this._path._lastOriY=o,this._path.addPoint(n,o),N=n,w=o),V=G,U=H}}}}}arc(t,e,i,a,r){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];!(arguments.length>6&&void 0!==arguments[6])||arguments[6];var n,o,l,h=0,_=0,c=0,d=0,u=0,f=0;if(_=r-a,s)if(Math.abs(_)>=2*Math.PI)_=2*-Math.PI;else for(;_>0;)_-=2*Math.PI;else if(Math.abs(_)>=2*Math.PI)_=2*Math.PI;else for(;_<0;)_+=2*Math.PI;var m=this.getMatScaleX(),p=this.getMatScaleY(),g=i*(m>p?m:p),v=2*Math.PI*g;n=_/(l=0|Math.max(v/10,10))/2,c=Math.abs(4/3*(1-Math.cos(n))/Math.sin(n)),s&&(c=-c);var T=this._getPath();for(o=0;o<=l;o++)h=a+_*(o/l),d=Math.cos(h),f=e+Math.sin(h)*i,(u=t+d*i)==this._path._lastOriX&&f==this._path._lastOriY||T.addPoint(u,f);d=Math.cos(r),f=e+Math.sin(r)*i,(u=t+d*i)==this._path._lastOriX&&f==this._path._lastOriY||T.addPoint(u,f)}quadraticCurveTo(t,e,i,a){for(var r=o.a.I.getBezierPoints([this._path._lastOriX,this._path._lastOriY,t,e,i,a],30,2),s=0,n=r.length/2;s<n;s++)this.lineTo(r[2*s],r[2*s+1]);this.lineTo(i,a)}mixRGBandAlpha(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)}_mixRGBandAlpha(t,e){if(e>=1)return t;var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24}strokeRect(t,e,i,a,r){if(this.lineWidth>0){var s=this.mixRGBandAlpha(this.strokeStyle._color.numColor),n=this.lineWidth/2;this._fillRect(t-n,e-n,i+this.lineWidth,this.lineWidth,s),this._fillRect(t-n,e-n+a,i+this.lineWidth,this.lineWidth,s),this._fillRect(t-n,e+n,this.lineWidth,a-this.lineWidth,s),this._fillRect(t-n+i,e+n,this.lineWidth,a-this.lineWidth,s)}}clip(){}drawParticle(t,e,i){i.x=t,i.y=e,this._submits[this._submits._length++]=i}_getPath(){return this._path||(this._path=new f.a)}get canvas(){return this._canvas}_fillTexture_h(t,e,i,a,r,s,n,o){a<=0&&console.error("_fillTexture_h error: oriw must>0");for(var l=s,h=Math.floor(o/a),_=o%a,c=0;c<h;c++)this._inner_drawTexture(t,e,l,n,a,r,this._curMat,i,1,!1),l+=a;if(_>0){var d=i[2]-i[0],u=i[0]+d*(_/a),f=Y.tmpuv1;f[0]=i[0],f[1]=i[1],f[2]=u,f[3]=i[3],f[4]=u,f[5]=i[5],f[6]=i[6],f[7]=i[7],this._inner_drawTexture(t,e,l,n,_,r,this._curMat,f,1,!1)}}_fillTexture_v(t,e,i,a,r,s,n,o){r<=0&&console.error("_fillTexture_v error: orih must>0");for(var l=n,h=Math.floor(o/r),_=o%r,c=0;c<h;c++)this._inner_drawTexture(t,e,s,l,a,r,this._curMat,i,1,!1),l+=r;if(_>0){var d=i[7]-i[1],u=i[1]+d*(_/r),f=Y.tmpuv1;f[0]=i[0],f[1]=i[1],f[2]=i[2],f[3]=i[3],f[4]=i[4],f[5]=u,f[6]=i[6],f[7]=u,this._inner_drawTexture(t,e,s,l,a,_,this._curMat,f,1,!1)}}drawTextureWithSizeGrid(t,e,i,a,r,s,n,o){if(t._getSource()){e+=n,i+=o;var l=t.uv,h=t.bitmap.width,_=t.bitmap.height,c=s[0],d=s[3],u=s[1],f=s[2],m=s[4],p=!1;a==h&&(d=u=0),r==_&&(c=f=0);var g=c/_,v=d/h,T=u/h,E=f/_;if(d+u>a){var S=a;p=!0,a=d+u,this.save(),this.clipRect(0+e,0+i,S,r)}var R=t.bitmap.id,x=this._curMat,A=this._tempUV,y=l[0],I=l[1],C=l[4],M=l[5],D=y,b=I,L=C,O=M;if(d&&c&&(L=y+v,O=I+g,A[0]=y,A[1]=I,A[2]=L,A[3]=I,A[4]=L,A[5]=O,A[6]=y,A[7]=O,this._inner_drawTexture(t,R,e,i,d,c,x,A,1,!1)),u&&c&&(D=C-T,b=I,L=C,O=I+g,A[0]=D,A[1]=b,A[2]=L,A[3]=b,A[4]=L,A[5]=O,A[6]=D,A[7]=O,this._inner_drawTexture(t,R,a-u+e,0+i,u,c,x,A,1,!1)),d&&f&&(D=y,b=M-E,L=y+v,O=M,A[0]=D,A[1]=b,A[2]=L,A[3]=b,A[4]=L,A[5]=O,A[6]=D,A[7]=O,this._inner_drawTexture(t,R,0+e,r-f+i,d,f,x,A,1,!1)),u&&f&&(D=C-T,b=M-E,L=C,O=M,A[0]=D,A[1]=b,A[2]=L,A[3]=b,A[4]=L,A[5]=O,A[6]=D,A[7]=O,this._inner_drawTexture(t,R,a-u+e,r-f+i,u,f,x,A,1,!1)),c&&(D=y+v,b=I,L=C-T,O=I+g,A[0]=D,A[1]=b,A[2]=L,A[3]=b,A[4]=L,A[5]=O,A[6]=D,A[7]=O,m?this._fillTexture_h(t,R,A,t.width-d-u,c,d+e,i,a-d-u):this._inner_drawTexture(t,R,d+e,i,a-d-u,c,x,A,1,!1)),f&&(D=y+v,b=M-E,L=C-T,O=M,A[0]=D,A[1]=b,A[2]=L,A[3]=b,A[4]=L,A[5]=O,A[6]=D,A[7]=O,m?this._fillTexture_h(t,R,A,t.width-d-u,f,d+e,r-f+i,a-d-u):this._inner_drawTexture(t,R,d+e,r-f+i,a-d-u,f,x,A,1,!1)),d&&(D=y,b=I+g,L=y+v,O=M-E,A[0]=D,A[1]=b,A[2]=L,A[3]=b,A[4]=L,A[5]=O,A[6]=D,A[7]=O,m?this._fillTexture_v(t,R,A,d,t.height-c-f,e,c+i,r-c-f):this._inner_drawTexture(t,R,e,c+i,d,r-c-f,x,A,1,!1)),u&&(D=C-T,b=I+g,L=C,O=M-E,A[0]=D,A[1]=b,A[2]=L,A[3]=b,A[4]=L,A[5]=O,A[6]=D,A[7]=O,m?this._fillTexture_v(t,R,A,u,t.height-c-f,a-u+e,c+i,r-c-f):this._inner_drawTexture(t,R,a-u+e,c+i,u,r-c-f,x,A,1,!1)),D=y+v,b=I+g,L=C-T,O=M-E,A[0]=D,A[1]=b,A[2]=L,A[3]=b,A[4]=L,A[5]=O,A[6]=D,A[7]=O,m){var P=Y.tmpUVRect;P[0]=D,P[1]=b,P[2]=L-D,P[3]=O-b,this._fillTexture(t,t.width-d-u,t.height-c-f,P,d+e,c+i,a-d-u,r-c-f,"repeat",0,0)}else this._inner_drawTexture(t,R,d+e,c+i,a-d-u,r-c-f,x,A,1,!1);p&&this.restore()}}}e.a=Y,r()(Y,"ENUM_TEXTALIGN_DEFAULT",0),r()(Y,"ENUM_TEXTALIGN_CENTER",1),r()(Y,"ENUM_TEXTALIGN_RIGHT",2),r()(Y,"_SUBMITVBSIZE",32e3),r()(Y,"_MAXSIZE",99999999),r()(Y,"_MAXVERTNUM",65535),r()(Y,"MAXCLIPRECT",null),r()(Y,"_COUNT",0),r()(Y,"SEGNUM",32),r()(Y,"_contextcount",0),r()(Y,"PI2",2*Math.PI),r()(Y,"_textRender",null),r()(Y,"tmpuv1",[0,0,0,0,0,0,0,0]),r()(Y,"tmpUV",[0,0,0,0,0,0,0,0]),r()(Y,"tmpUVRect",[0,0,0,0]);class j{constructor(){r()(this,"lineWidth",1),r()(this,"textAlign",void 0),r()(this,"textBaseline",void 0)}clear(){this.lineWidth=1,this.textAlign=this.textBaseline=null}make(){return this===j.DEFAULT?new j:this}}r()(j,"DEFAULT",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{}e.a=s,r()(s,"loopStTm",0),r()(s,"loopCount",0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{}e.a=s,r()(s,"ALPHA",1),r()(s,"TRANSFORM",2),r()(s,"BLEND",4),r()(s,"CANVAS",8),r()(s,"FILTERS",16),r()(s,"MASK",32),r()(s,"CLIP",64),r()(s,"STYLE",128),r()(s,"TEXTURE",256),r()(s,"GRAPHICS",512),r()(s,"LAYAGL3D",1024),r()(s,"CUSTOM",2048),r()(s,"ONECHILD",4096),r()(s,"CHILDS",8192),r()(s,"REPAINT_NONE",0),r()(s,"REPAINT_NODE",1),r()(s,"REPAINT_CACHE",2),r()(s,"REPAINT_ALL",3)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(6),n=i(23),o=i(49),l=i(9),h=i(24),_=i(1),c=i(253);class d extends n.a{get _isFrontFaceInvert(){var t=this.getWorldLossyScale(),e=t.x<0;return t.y<0&&(e=!e),t.z<0&&(e=!e),e}get owner(){return this._owner}get worldNeedUpdate(){return this._getTransformFlag(d.TRANSFORM_WORLDMATRIX)}get localPositionX(){return this._localPosition.x}set localPositionX(t){this._localPosition.x=t,this.localPosition=this._localPosition}get localPositionY(){return this._localPosition.y}set localPositionY(t){this._localPosition.y=t,this.localPosition=this._localPosition}get localPositionZ(){return this._localPosition.z}set localPositionZ(t){this._localPosition.z=t,this.localPosition=this._localPosition}get localPosition(){return this._localPosition}set localPosition(t){this._localPosition!==t&&t.cloneTo(this._localPosition),this._setTransformFlag(d.TRANSFORM_LOCALMATRIX,!0),this._onWorldPositionTransform()}get localRotationX(){return this.localRotation.x}set localRotationX(t){this._localRotation.x=t,this.localRotation=this._localRotation}get localRotationY(){return this.localRotation.y}set localRotationY(t){this._localRotation.y=t,this.localRotation=this._localRotation}get localRotationZ(){return this.localRotation.z}set localRotationZ(t){this._localRotation.z=t,this.localRotation=this._localRotation}get localRotationW(){return this.localRotation.w}set localRotationW(t){this._localRotation.w=t,this.localRotation=this._localRotation}get localRotation(){if(this._getTransformFlag(d.TRANSFORM_LOCALQUATERNION)){var t=this._localRotationEuler;h.a.createFromYawPitchRoll(t.y/d._angleToRandin,t.x/d._angleToRandin,t.z/d._angleToRandin,this._localRotation),this._setTransformFlag(d.TRANSFORM_LOCALQUATERNION,!1)}return this._localRotation}set localRotation(t){this._localRotation!==t&&t.cloneTo(this._localRotation),this._localRotation.normalize(this._localRotation),this._setTransformFlag(d.TRANSFORM_LOCALEULER|d.TRANSFORM_LOCALMATRIX,!0),this._setTransformFlag(d.TRANSFORM_LOCALQUATERNION,!1),this._onWorldRotationTransform()}get localScaleX(){return this._localScale.x}set localScaleX(t){this._localScale.x=t,this.localScale=this._localScale}get localScaleY(){return this._localScale.y}set localScaleY(t){this._localScale.y=t,this.localScale=this._localScale}get localScaleZ(){return this._localScale.z}set localScaleZ(t){this._localScale.z=t,this.localScale=this._localScale}get localScale(){return this._localScale}set localScale(t){this._localScale!==t&&t.cloneTo(this._localScale),this._setTransformFlag(d.TRANSFORM_LOCALMATRIX,!0),this._onWorldScaleTransform()}get localRotationEulerX(){return this.localRotationEuler.x}set localRotationEulerX(t){this._localRotationEuler.x=t,this.localRotationEuler=this._localRotationEuler}get localRotationEulerY(){return this.localRotationEuler.y}set localRotationEulerY(t){this._localRotationEuler.y=t,this.localRotationEuler=this._localRotationEuler}get localRotationEulerZ(){return this.localRotationEuler.z}set localRotationEulerZ(t){this._localRotationEuler.z=t,this.localRotationEuler=this._localRotationEuler}get localRotationEuler(){if(this._getTransformFlag(d.TRANSFORM_LOCALEULER)){this._localRotation.getYawPitchRoll(d._tempVector30);var t=d._tempVector30,e=this._localRotationEuler;e.x=t.y*d._angleToRandin,e.y=t.x*d._angleToRandin,e.z=t.z*d._angleToRandin,this._setTransformFlag(d.TRANSFORM_LOCALEULER,!1)}return this._localRotationEuler}set localRotationEuler(t){this._localRotationEuler!==t&&t.cloneTo(this._localRotationEuler),this._setTransformFlag(d.TRANSFORM_LOCALEULER,!1),this._setTransformFlag(d.TRANSFORM_LOCALQUATERNION|d.TRANSFORM_LOCALMATRIX,!0),this._onWorldRotationTransform()}get localMatrix(){return this._getTransformFlag(d.TRANSFORM_LOCALMATRIX)&&(l.a.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix),this._setTransformFlag(d.TRANSFORM_LOCALMATRIX,!1)),this._localMatrix}set localMatrix(t){this._localMatrix!==t&&t.cloneTo(this._localMatrix),this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._setTransformFlag(d.TRANSFORM_LOCALEULER,!0),this._setTransformFlag(d.TRANSFORM_LOCALMATRIX,!1),this._onWorldTransform()}get position(){if(this._getTransformFlag(d.TRANSFORM_WORLDPOSITION)){if(null!=this._parent){var t=this.worldMatrix.elements;this._position.x=t[12],this._position.y=t[13],this._position.z=t[14]}else this._localPosition.cloneTo(this._position);this._setTransformFlag(d.TRANSFORM_WORLDPOSITION,!1)}return this._position}set position(t){if(null!=this._parent){var e=d._tempMatrix0;this._parent.worldMatrix.invert(e),_.a.transformCoordinate(t,e,this._localPosition)}else t.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position!==t&&t.cloneTo(this._position),this._setTransformFlag(d.TRANSFORM_WORLDPOSITION,!1)}get rotation(){return this._getTransformFlag(d.TRANSFORM_WORLDQUATERNION)&&(null!=this._parent?h.a.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._setTransformFlag(d.TRANSFORM_WORLDQUATERNION,!1)),this._rotation}set rotation(t){null!=this._parent?(this._parent.rotation.invert(d._tempQuaternion0),h.a.multiply(d._tempQuaternion0,t,this._localRotation)):t.cloneTo(this._localRotation),this.localRotation=this._localRotation,t!==this._rotation&&t.cloneTo(this._rotation),this._setTransformFlag(d.TRANSFORM_WORLDQUATERNION,!1)}get rotationEuler(){if(this._getTransformFlag(d.TRANSFORM_WORLDEULER)){this.rotation.getYawPitchRoll(d._tempVector30);var t=d._tempVector30,e=this._rotationEuler;e.x=t.y*d._angleToRandin,e.y=t.x*d._angleToRandin,e.z=t.z*d._angleToRandin,this._setTransformFlag(d.TRANSFORM_WORLDEULER,!1)}return this._rotationEuler}set rotationEuler(t){h.a.createFromYawPitchRoll(t.y/d._angleToRandin,t.x/d._angleToRandin,t.z/d._angleToRandin,this._rotation),this.rotation=this._rotation,this._rotationEuler!==t&&t.cloneTo(this._rotationEuler),this._setTransformFlag(d.TRANSFORM_WORLDEULER,!1)}get worldMatrix(){return this._getTransformFlag(d.TRANSFORM_WORLDMATRIX)&&(null!=this._parent?l.a.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._setTransformFlag(d.TRANSFORM_WORLDMATRIX,!1)),this._worldMatrix}set worldMatrix(t){null===this._parent?t.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),l.a.multiply(this._localMatrix,t,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix!==t&&t.cloneTo(this._worldMatrix),this._setTransformFlag(d.TRANSFORM_WORLDMATRIX,!1)}constructor(t){super(),r()(this,"_owner",void 0),r()(this,"_localPosition",new _.a(0,0,0)),r()(this,"_localRotation",new h.a(0,0,0,1)),r()(this,"_localScale",new _.a(1,1,1)),r()(this,"_localRotationEuler",new _.a(0,0,0)),r()(this,"_localMatrix",new l.a),r()(this,"_position",new _.a(0,0,0)),r()(this,"_rotation",new h.a(0,0,0,1)),r()(this,"_scale",new _.a(1,1,1)),r()(this,"_rotationEuler",new _.a(0,0,0)),r()(this,"_worldMatrix",new l.a),r()(this,"_children",null),r()(this,"_parent",null),r()(this,"_dummy",null),r()(this,"_transformFlag",0),this._owner=t,this._children=[],this._setTransformFlag(d.TRANSFORM_LOCALQUATERNION|d.TRANSFORM_LOCALEULER|d.TRANSFORM_LOCALMATRIX,!1),this._setTransformFlag(d.TRANSFORM_WORLDPOSITION|d.TRANSFORM_WORLDQUATERNION|d.TRANSFORM_WORLDEULER|d.TRANSFORM_WORLDSCALE|d.TRANSFORM_WORLDMATRIX,!0)}_getScaleMatrix(){var t=d._tempQuaternion0,e=d._tempMatrix3x30,i=d._tempMatrix3x31,a=d._tempMatrix3x32;return c.a.createFromMatrix4x4(this.worldMatrix,i),this.rotation.invert(t),c.a.createRotationQuaternion(t,e),c.a.multiply(e,i,a),a}_setTransformFlag(t,e){e?this._transformFlag|=t:this._transformFlag&=~t}_getTransformFlag(t){return 0!=(this._transformFlag&t)}_setParent(t){if(this._parent!==t){if(this._parent){var e=this._parent._children,i=e.indexOf(this);e.splice(i,1)}t&&(t._children.push(this),t&&this._onWorldTransform()),this._parent=t}}_onWorldPositionRotationTransform(){if(!(this._getTransformFlag(d.TRANSFORM_WORLDMATRIX)&&this._getTransformFlag(d.TRANSFORM_WORLDPOSITION)&&this._getTransformFlag(d.TRANSFORM_WORLDQUATERNION)&&this._getTransformFlag(d.TRANSFORM_WORLDEULER))){this._setTransformFlag(d.TRANSFORM_WORLDMATRIX|d.TRANSFORM_WORLDPOSITION|d.TRANSFORM_WORLDQUATERNION|d.TRANSFORM_WORLDEULER,!0),this.event(s.a.TRANSFORM_CHANGED,this._transformFlag);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldPositionRotationTransform()}}_onWorldPositionScaleTransform(){if(!this._getTransformFlag(d.TRANSFORM_WORLDMATRIX)||!this._getTransformFlag(d.TRANSFORM_WORLDPOSITION)||!this._getTransformFlag(d.TRANSFORM_WORLDSCALE)){this._setTransformFlag(d.TRANSFORM_WORLDMATRIX|d.TRANSFORM_WORLDPOSITION|d.TRANSFORM_WORLDSCALE,!0),this.event(s.a.TRANSFORM_CHANGED,this._transformFlag);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldPositionScaleTransform()}}_onWorldPositionTransform(){if(!this._getTransformFlag(d.TRANSFORM_WORLDMATRIX)||!this._getTransformFlag(d.TRANSFORM_WORLDPOSITION)){this._setTransformFlag(d.TRANSFORM_WORLDMATRIX|d.TRANSFORM_WORLDPOSITION,!0),this.event(s.a.TRANSFORM_CHANGED,this._transformFlag);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldPositionTransform()}}_onWorldRotationTransform(){if(!this._getTransformFlag(d.TRANSFORM_WORLDMATRIX)||!this._getTransformFlag(d.TRANSFORM_WORLDQUATERNION)||!this._getTransformFlag(d.TRANSFORM_WORLDEULER)){this._setTransformFlag(d.TRANSFORM_WORLDMATRIX|d.TRANSFORM_WORLDQUATERNION|d.TRANSFORM_WORLDEULER,!0),this.event(s.a.TRANSFORM_CHANGED,this._transformFlag);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldPositionRotationTransform()}}_onWorldScaleTransform(){if(!this._getTransformFlag(d.TRANSFORM_WORLDMATRIX)||!this._getTransformFlag(d.TRANSFORM_WORLDSCALE)){this._setTransformFlag(d.TRANSFORM_WORLDMATRIX|d.TRANSFORM_WORLDSCALE,!0),this.event(s.a.TRANSFORM_CHANGED,this._transformFlag);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldPositionScaleTransform()}}_onWorldTransform(){if(!(this._getTransformFlag(d.TRANSFORM_WORLDMATRIX)&&this._getTransformFlag(d.TRANSFORM_WORLDPOSITION)&&this._getTransformFlag(d.TRANSFORM_WORLDQUATERNION)&&this._getTransformFlag(d.TRANSFORM_WORLDEULER)&&this._getTransformFlag(d.TRANSFORM_WORLDSCALE))){this._setTransformFlag(d.TRANSFORM_WORLDMATRIX|d.TRANSFORM_WORLDPOSITION|d.TRANSFORM_WORLDQUATERNION|d.TRANSFORM_WORLDEULER|d.TRANSFORM_WORLDSCALE,!0),this.event(s.a.TRANSFORM_CHANGED,this._transformFlag);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldTransform()}}translate(t){!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?(l.a.createFromQuaternion(this.localRotation,d._tempMatrix0),_.a.transformCoordinate(t,d._tempMatrix0,d._tempVector30),_.a.add(this.localPosition,d._tempVector30,this._localPosition),this.localPosition=this._localPosition):(_.a.add(this.position,t,this._position),this.position=this._position)}rotate(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i;!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?i=t:(_.a.scale(t,Math.PI/180,d._tempVector30),i=d._tempVector30),h.a.createFromYawPitchRoll(i.y,i.x,i.z,d._tempQuaternion0),e?(h.a.multiply(this._localRotation,d._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(h.a.multiply(d._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)}getForward(t){var e=this.worldMatrix.elements;t.x=-e[8],t.y=-e[9],t.z=-e[10]}getUp(t){var e=this.worldMatrix.elements;t.x=e[4],t.y=e[5],t.z=e[6]}getRight(t){var e=this.worldMatrix.elements;t.x=e[0],t.y=e[1],t.z=e[2]}lookAt(t,e){var i;if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]){if(i=this._localPosition,Math.abs(i.x-t.x)<o.a.zeroTolerance&&Math.abs(i.y-t.y)<o.a.zeroTolerance&&Math.abs(i.z-t.z)<o.a.zeroTolerance)return;h.a.lookAt(this._localPosition,t,e,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var a=this.position;if(i=a,Math.abs(i.x-t.x)<o.a.zeroTolerance&&Math.abs(i.y-t.y)<o.a.zeroTolerance&&Math.abs(i.z-t.z)<o.a.zeroTolerance)return;h.a.lookAt(a,t,e,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}}getWorldLossyScale(){if(this._getTransformFlag(d.TRANSFORM_WORLDSCALE)){if(null!==this._parent){var t=this._getScaleMatrix().elements;this._scale.x=t[0],this._scale.y=t[4],this._scale.z=t[8]}else this._localScale.cloneTo(this._scale);this._setTransformFlag(d.TRANSFORM_WORLDSCALE,!1)}return this._scale}setWorldLossyScale(t){if(null!==this._parent){var e=d._tempMatrix3x33,i=d._tempMatrix3x33,a=i.elements,r=this._parent._getScaleMatrix();r.invert(r),c.a.createFromScaling(t,e),c.a.multiply(r,e,i),this._localScale.x=a[0],this._localScale.y=a[4],this._localScale.z=a[8]}else t.cloneTo(this._localScale);this.localScale=this._localScale,this._scale!==t&&t.cloneTo(this._scale),this._setTransformFlag(d.TRANSFORM_WORLDSCALE,!1)}get scale(){return console.warn("Transfrm3D: discard function,please use getWorldLossyScale instead."),this.getWorldLossyScale()}set scale(t){console.warn("Transfrm3D: discard function,please use setWorldLossyScale instead."),this.setWorldLossyScale(t)}}e.a=d,r()(d,"_tempVector30",new _.a),r()(d,"_tempQuaternion0",new h.a),r()(d,"_tempMatrix0",new l.a),r()(d,"_tempMatrix3x30",new c.a),r()(d,"_tempMatrix3x31",new c.a),r()(d,"_tempMatrix3x32",new c.a),r()(d,"_tempMatrix3x33",new c.a),r()(d,"TRANSFORM_LOCALQUATERNION",1),r()(d,"TRANSFORM_LOCALEULER",2),r()(d,"TRANSFORM_LOCALMATRIX",4),r()(d,"TRANSFORM_WORLDPOSITION",8),r()(d,"TRANSFORM_WORLDQUATERNION",16),r()(d,"TRANSFORM_WORLDSCALE",32),r()(d,"TRANSFORM_WORLDMATRIX",64),r()(d,"TRANSFORM_WORLDEULER",128),r()(d,"_angleToRandin",180/Math.PI)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(37),o=i(46),l=i(47),h=i(42),_=i(10),c=i(127);class d extends o.a{static get currentActive(){return d._currentActive}static createFromPool(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.b.R8G8B8,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l.a.DEPTH_16;for(var r,s=0,n=d._pool.length;s<n;s++)if((r=d._pool[s])._width==t&&r._height==e&&r._format==i&&r._depthStencilFormat==a){r._inPool=!1;var o=d._pool[n-1];return d._pool[s]=o,d._pool.length-=1,r}return(r=new d(t,e,i,a)).lock=!0,r}static recoverToPool(t){t._inPool||(d._pool.push(t),t._inPool=!0)}get depthStencilFormat(){return this._depthStencilFormat}get defaulteTexture(){return h.a.grayTexture}constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.b.R8G8B8,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l.a.DEPTH_16;super(i,!1),r()(this,"_frameBuffer",void 0),r()(this,"_depthStencilBuffer",void 0),r()(this,"_depthStencilFormat",void 0),r()(this,"_inPool",!1),r()(this,"_isCameraTarget",!1),this._glTextureType=s.a.instance.TEXTURE_2D,this._width=t,this._height=e,this._depthStencilFormat=a,this._mipmapCount=1,this._create(t,e)}_create(t,e){var i=s.a.instance,a=i,r=this._glTextureType,n=s.a.layaGPUInstance,o=n._isWebGL2,h=this._format;if(this._frameBuffer=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,this._frameBuffer),h!==l.b.Depth&&h!==l.b.ShadowMap){switch(_.a.bindTexture(i,r,this._glTexture),h){case l.b.R8G8B8:o?a.texStorage2D(r,this._mipmapCount,a.RGB8,t,e):i.texImage2D(r,0,i.RGB,t,e,0,i.RGB,i.UNSIGNED_BYTE,null);break;case l.b.R8G8B8A8:o?a.texStorage2D(r,this._mipmapCount,a.RGBA8,t,e):i.texImage2D(r,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null);break;case l.b.Alpha8:o?a.texStorage2D(r,0,a.R8,t,e):i.texImage2D(r,0,i.ALPHA,t,e,0,i.ALPHA,i.UNSIGNED_BYTE,null);break;case l.b.R16G16B16A16:o?a.texStorage2D(r,this._mipmapCount,a.RGBA16F,t,e):i.texImage2D(r,0,i.RGBA,t,e,0,i.RGBA,n._oesTextureHalfFloat.HALF_FLOAT_OES,null)}i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this._glTexture,0)}if(h==l.b.Depth||h==l.b.ShadowMap){switch(_.a.bindTexture(i,r,this._glTexture),this._depthStencilFormat){case l.a.DEPTH_16:o?a.texStorage2D(r,this._mipmapCount,a.DEPTH_COMPONENT16,t,e):i.texImage2D(r,0,i.DEPTH_COMPONENT,t,e,0,i.DEPTH_COMPONENT,i.UNSIGNED_SHORT,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,this._glTexture,0);break;case l.a.DEPTHSTENCIL_24_8:o?a.texStorage2D(r,this._mipmapCount,a.DEPTH24_STENCIL8,t,e):i.texImage2D(r,0,i.DEPTH_STENCIL,t,e,0,i.DEPTH_STENCIL,n._webgl_depth_texture.UNSIGNED_INT_24_8_WEBGL,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,this._glTexture,0);break;default:throw"RenderTexture: depth format RenderTexture must use depthFormat with DEPTH_16 and DEPTHSTENCIL_16_8."}o&&h==l.b.ShadowMap&&a.texParameteri(r,a.TEXTURE_COMPARE_MODE,a.COMPARE_REF_TO_TEXTURE)}else if(this._depthStencilFormat!==l.a.DEPTHSTENCIL_NONE){switch(this._depthStencilBuffer=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,this._depthStencilBuffer),this._depthStencilFormat){case l.a.DEPTH_16:i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,t,e),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,this._depthStencilBuffer);break;case l.a.STENCIL_8:i.renderbufferStorage(i.RENDERBUFFER,i.STENCIL_INDEX8,t,e),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.STENCIL_ATTACHMENT,i.RENDERBUFFER,this._depthStencilBuffer);break;case l.a.DEPTHSTENCIL_24_8:i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,e),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,this._depthStencilBuffer);break;default:throw"RenderTexture: unkonw depth format."}i.bindRenderbuffer(i.RENDERBUFFER,null)}i.bindFramebuffer(i.FRAMEBUFFER,null),this._setWarpMode(i.TEXTURE_WRAP_S,this._wrapModeU),this._setWarpMode(i.TEXTURE_WRAP_T,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._readyed=!0,this._activeResource(),this._setGPUMemory(t*e*4)}_start(){var t=s.a.instance;t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),d._currentActive=this,this._isCameraTarget&&(c.a._instance.invertY=!0),this._readyed=!1}_end(){var t=s.a.instance;t.bindFramebuffer(t.FRAMEBUFFER,null),d._currentActive=null,this._isCameraTarget&&(c.a._instance.invertY=!1),this._readyed=!0}getData(t,e,i,a,r){if(n.a.isConchApp&&2==window.conchConfig.threadMode)throw"native 2 thread mode use getDataAsync";var o=s.a.instance;return o.bindFramebuffer(o.FRAMEBUFFER,this._frameBuffer),o.checkFramebufferStatus(o.FRAMEBUFFER)===o.FRAMEBUFFER_COMPLETE?(o.readPixels(t,e,i,a,o.RGBA,o.UNSIGNED_BYTE,r),o.bindFramebuffer(o.FRAMEBUFFER,null),r):(o.bindFramebuffer(o.FRAMEBUFFER,null),null)}_disposeResource(){if(this._frameBuffer){var t=s.a.instance;t.deleteTexture(this._glTexture),t.deleteFramebuffer(this._frameBuffer),t.deleteRenderbuffer(this._depthStencilBuffer),this._glTexture=null,this._frameBuffer=null,this._depthStencilBuffer=null,this._setGPUMemory(0)}}getDataAsync(t,e,i,a,r){var n=s.a.instance;n.bindFramebuffer(n.FRAMEBUFFER,this._frameBuffer),n.readPixelsAsync(t,e,i,a,n.RGBA,n.UNSIGNED_BYTE,function(t){r(new Uint8Array(t))}),n.bindFramebuffer(n.FRAMEBUFFER,null)}}e.a=d,r()(d,"_pool",[]),r()(d,"_currentActive",void 0)},function(t,e,i){"use strict";i.d(e,"b",function(){return b});var a=i(0),r=i.n(a),s=i(72),n=i(58),o=i(6),l=i(2),h=i(79),_=i(47),c=i(81),d=i(10),u=i(271),f=i(174),m=i(9),p=i(20),g=i(1),v=i(5),T=i(432),E=i(86),S=i(433),R=i(273),x=i(128),A=i(267),y=i(127),I=i(178),C=i(85),M=i(11),D=i(179);let b,L;!function(t){t[t.SolidColor=0]="SolidColor",t[t.Sky=1]="Sky",t[t.DepthOnly=2]="DepthOnly",t[t.Nothing=3]="Nothing"}(b||(b={})),function(t){t[t.BeforeForwardOpaque=0]="BeforeForwardOpaque",t[t.BeforeSkyBox=2]="BeforeSkyBox",t[t.BeforeTransparent=4]="BeforeTransparent",t[t.BeforeImageEffect=6]="BeforeImageEffect",t[t.AfterEveryThing=8]="AfterEveryThing"}(L||(L={}));class O extends R.a{get aspectRatio(){if(0===this._aspectRatio){var t=this.viewport;return t.width/t.height}return this._aspectRatio}set aspectRatio(t){if(t<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=t,this._calculateProjectionMatrix()}get viewport(){return this._offScreenRenderTexture?this._calculationViewport(this._normalizedViewport,this._offScreenRenderTexture.width,this._offScreenRenderTexture.height):this._calculationViewport(this._normalizedViewport,y.a.clientWidth,y.a.clientHeight),this._viewport}set viewport(t){var e,i;this._offScreenRenderTexture?(e=this._offScreenRenderTexture.width,i=this._offScreenRenderTexture.height):(e=y.a.clientWidth,i=y.a.clientHeight),this._normalizedViewport.x=t.x/e,this._normalizedViewport.y=t.y/i,this._normalizedViewport.width=t.width/e,this._normalizedViewport.height=t.height/i,this._calculationViewport(this._normalizedViewport,e,i),this._calculateProjectionMatrix()}get normalizedViewport(){return this._normalizedViewport}set normalizedViewport(t){var e,i;this._offScreenRenderTexture?(e=this._offScreenRenderTexture.width,i=this._offScreenRenderTexture.height):(e=y.a.clientWidth,i=y.a.clientHeight),this._normalizedViewport!==t&&t.cloneTo(this._normalizedViewport),this._calculationViewport(t,e,i),this._calculateProjectionMatrix()}get viewMatrix(){if(this._updateViewMatrix){var t=this.transform.getWorldLossyScale(),e=t.x,i=t.y,a=t.z,r=this._viewMatrix.elements;this.transform.worldMatrix.cloneTo(this._viewMatrix),r[0]/=e,r[1]/=e,r[2]/=e,r[4]/=i,r[5]/=i,r[6]/=i,r[8]/=a,r[9]/=a,r[10]/=a,this._viewMatrix.invert(this._viewMatrix),this._updateViewMatrix=!1}return this._viewMatrix}get projectionMatrix(){return this._projectionMatrix}set projectionMatrix(t){this._projectionMatrix=t,this._useUserProjectionMatrix=!0}get projectionViewMatrix(){return m.a.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}get boundFrustum(){return this._boundFrustum.matrix=this.projectionViewMatrix,this._boundFrustum}get renderTarget(){return this._offScreenRenderTexture}set renderTarget(t){var e=this._offScreenRenderTexture;e!==t&&(e&&(e._isCameraTarget=!1),t&&(t._isCameraTarget=!0),this._offScreenRenderTexture=t,this._calculateProjectionMatrix())}get postProcess(){return this._postProcess}set postProcess(t){this._postProcess=t,t&&t&&t._init(this)}get enableHDR(){return this._enableHDR}set enableHDR(t){!t||c.a.supportRenderTextureFormat(_.b.R16G16B16A16)?this._enableHDR=t:console.warn("Camera:can't enable HDR in this device.")}get enableBuiltInRenderTexture(){return this._needBuiltInRenderTexture}set enableBuiltInRenderTexture(t){this._needBuiltInRenderTexture=t}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3),r()(this,"_aspectRatio",void 0),r()(this,"_viewport",void 0),r()(this,"_normalizedViewport",void 0),r()(this,"_viewMatrix",void 0),r()(this,"_projectionMatrix",void 0),r()(this,"_projectionViewMatrix",void 0),r()(this,"_boundFrustum",void 0),r()(this,"_updateViewMatrix",!0),r()(this,"_postProcess",null),r()(this,"_enableHDR",!1),r()(this,"_viewportParams",new v.a),r()(this,"_projectionParams",new v.a),r()(this,"_needBuiltInRenderTexture",!1),r()(this,"_offScreenRenderTexture",null),r()(this,"_internalRenderTexture",null),r()(this,"_cameraEventCommandBuffer",{}),r()(this,"_clusterXPlanes",void 0),r()(this,"_clusterYPlanes",void 0),r()(this,"_clusterPlaneCacheFlag",new p.a(-1,-1)),r()(this,"_screenOffsetScale",new v.a),r()(this,"enableRender",!0),r()(this,"clearFlag",b.SolidColor),r()(this,"_boundFrustumBuffer",void 0),this._viewMatrix=new m.a,this._projectionMatrix=new m.a,this._projectionViewMatrix=new m.a,this._viewport=new T.a(0,0,0,0),this._normalizedViewport=new T.a(0,0,1,1),this._aspectRatio=t,this._boundFrustum=new f.a(new m.a),this._calculateProjectionMatrix(),n.a.stage.on(o.a.RESIZE,this,this._onScreenSizeChanged),this.transform.on(o.a.TRANSFORM_CHANGED,this,this._onTransformChanged)}_calculationViewport(t,e,i){var a=t.x*e,r=t.y*i,s=a+Math.max(t.width*e,0),n=r+Math.max(t.height*i,0),o=Math.ceil(a),l=Math.ceil(r),h=Math.floor(s),_=Math.floor(n),c=o-a>=.5?Math.floor(a):o,d=l-r>=.5?Math.floor(r):l,u=s-h>=.5?Math.ceil(s):h,f=n-_>=.5?Math.ceil(n):_;this._viewport.x=c,this._viewport.y=d,this._viewport.width=u-c,this._viewport.height=f-d}_calculateProjectionMatrix(){if(!this._useUserProjectionMatrix)if(this._orthographic){var t=.5*this.orthographicVerticalSize,e=t*this.aspectRatio;m.a.createOrthoOffCenter(-e,e,-t,t,this.nearPlane,this.farPlane,this._projectionMatrix)}else m.a.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix)}_isLayerVisible(t){return 0!=(Math.pow(2,t)&this.cullingMask)}_onTransformChanged(t){(t&=C.a.TRANSFORM_WORLDMATRIX)&&(this._updateViewMatrix=!0)}_parse(t,e){super._parse(t,e);var i=t.clearFlag;void 0!==i&&(this.clearFlag=i);var a=t.viewport;this.normalizedViewport=new T.a(a[0],a[1],a[2],a[3]);var r=t.enableHDR;void 0!==r&&(this.enableHDR=r)}_getCanvasWidth(){return this._offScreenRenderTexture?this._offScreenRenderTexture.width:y.a.clientWidth}_getCanvasHeight(){return this._offScreenRenderTexture?this._offScreenRenderTexture.height:y.a.clientHeight}_getRenderTexture(){return this._internalRenderTexture||this._offScreenRenderTexture}_needInternalRenderTexture(){return!!(this._postProcess||this._enableHDR||this._needBuiltInRenderTexture)}_getRenderTextureFormat(){return this._enableHDR?_.b.R16G16B16A16:_.b.R8G8B8}_prepareCameraToRender(){super._prepareCameraToRender();var t=this.viewport;this._viewportParams.setValue(t.x,t.y,t.width,t.height),this._projectionParams.setValue(this._nearPlane,this._farPlane,y.a._instance.invertY?-1:1,0),this._shaderValues.setVector(R.a.VIEWPORT,this._viewportParams),this._shaderValues.setVector(R.a.PROJECTION_PARAMS,this._projectionParams)}_applyViewProject(t,e,i){var a,r=this._shaderValues;t.invertY?(m.a.multiply(R.a._invertYScaleMatrix,i,R.a._invertYProjectionMatrix),m.a.multiply(R.a._invertYProjectionMatrix,e,R.a._invertYProjectionViewMatrix),i=R.a._invertYProjectionMatrix,a=R.a._invertYProjectionViewMatrix):(m.a.multiply(i,e,this._projectionViewMatrix),a=this._projectionViewMatrix),t.viewMatrix=e,t.projectionMatrix=i,t.projectionViewMatrix=a,r.setMatrix4x4(R.a.VIEWMATRIX,e),r.setMatrix4x4(R.a.PROJECTMATRIX,i),r.setMatrix4x4(R.a.VIEWPROJECTMATRIX,a)}_updateClusterPlaneXY(){var t=this.fieldOfView,e=this.aspectRatio;if(this._clusterPlaneCacheFlag.x!==t||this._clusterPlaneCacheFlag.y!==e){var i=s.a._config.lightClusterCount,a=i.x,r=i.y,n=a+1,o=r+1,l=this._clusterXPlanes,h=this._clusterYPlanes;if(!l){l=this._clusterXPlanes=new Array(n),h=this._clusterYPlanes=new Array(o);for(var _=0;_<n;_++)l[_]=new g.a;for(_=0;_<o;_++)h[_]=new g.a}var c=Math.tan(this.fieldOfView/2*Math.PI/180),d=this.aspectRatio*c,u=2*c/a,f=2*d/r;for(_=0;_<n;_++){var m=f*_-d,p=1/Math.sqrt(1+m*m);l[_].setValue(p,0,-m*p)}for(_=0;_<o;_++){m=c-u*_;var v=-1/Math.sqrt(1+m*m);h[_].setValue(0,v,-m*v)}this._clusterPlaneCacheFlag.x=t,this._clusterPlaneCacheFlag.y=e}}_applyCommandBuffer(t,e){var i=l.a.instance,a=this._cameraEventCommandBuffer[t];a&&0!=a.length&&(this._internalRenderTexture&&this._internalRenderTexture._end(),a.forEach(function(t){t._context=e,t._apply()}),E.a.currentActive&&E.a.currentActive._end(),this._internalRenderTexture?this._internalRenderTexture._start():i.bindFramebuffer(i.FRAMEBUFFER,null),i.viewport(0,0,e.viewport.width,e.viewport.height))}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.activeInHierarchy){var i,a=this.viewport,r=this._needInternalRenderTexture(),n=l.a.instance,o=y.a._instance,c=o.scene=this._scene;o.pipelineMode="Forward",r?(this._internalRenderTexture=E.a.createFromPool(a.width,a.height,this._getRenderTextureFormat(),_.a.DEPTH_16),this._internalRenderTexture.filterMode=h.a.Bilinear):this._internalRenderTexture=null;var f=c._mainDirectionLight,m=f&&f.shadowMode!==x.a.None&&D.a.supportShadow();m?(c._shaderValues.removeDefine(I.a.SHADERDEFINE_SHADOW_SPOT),c._shaderValues.addDefine(I.a.SHADERDEFINE_SHADOW),(i=M.a.Scene3D._shadowCasterPass).update(this,f,M.a.ShadowLightType.DirectionLight),i.render(o,c,M.a.ShadowLightType.DirectionLight)):c._shaderValues.removeDefine(I.a.SHADERDEFINE_SHADOW);var p=c._mainSpotLight,g=p&&p.shadowMode!==x.a.None&&D.a.supportShadow();if(g?(c._shaderValues.removeDefine(I.a.SHADERDEFINE_SHADOW),c._shaderValues.addDefine(I.a.SHADERDEFINE_SHADOW_SPOT),(i=M.a.Scene3D._shadowCasterPass).update(this,p,M.a.ShadowLightType.SpotLight),i.render(o,c,M.a.ShadowLightType.SpotLight)):c._shaderValues.removeDefine(I.a.SHADERDEFINE_SHADOW_SPOT),m&&c._shaderValues.addDefine(I.a.SHADERDEFINE_SHADOW),g&&c._shaderValues.addDefine(I.a.SHADERDEFINE_SHADOW_SPOT),o.camera=this,o.cameraShaderValue=this._shaderValues,O._updateMark++,c._preRenderScript(),r&&!this._offScreenRenderTexture&&(this.clearFlag==b.DepthOnly||this.clearFlag==b.Nothing))if(this._enableHDR){var v=E.a.createFromPool(a.width,a.height,_.b.R8G8B8,_.a.DEPTH_16);v.filterMode=h.a.Bilinear,d.a.bindTexture(n,n.TEXTURE_2D,v._getSource()),n.copyTexSubImage2D(n.TEXTURE_2D,0,0,0,a.x,y.a.clientHeight-(a.y+a.height),a.width,a.height),(S=A.a.create(v,this._internalRenderTexture)).run(),S.recover(),E.a.recoverToPool(v)}else d.a.bindTexture(n,n.TEXTURE_2D,this._internalRenderTexture._getSource()),n.copyTexSubImage2D(n.TEXTURE_2D,0,0,0,a.x,y.a.clientHeight-(a.y+a.height),a.width,a.height);var T=this._getRenderTexture();if(T&&T._start(),o.viewport=a,this._prepareCameraToRender(),s.a._config._multiLighting&&u.a.instance.update(this,this._scene),this._applyViewProject(o,this.viewMatrix,this._projectionMatrix),c._preCulling(o,this,t,e),c._clear(n,o),this._applyCommandBuffer(L.BeforeForwardOpaque,o),c._renderScene(o,M.a.Scene3D.SCENERENDERFLAG_RENDERQPAQUE),this._applyCommandBuffer(L.BeforeSkyBox,o),c._renderScene(o,M.a.Scene3D.SCENERENDERFLAG_SKYBOX),this._applyCommandBuffer(L.BeforeTransparent,o),c._renderScene(o,M.a.Scene3D.SCENERENDERFLAG_RENDERTRANSPARENT),c._postRenderScript(),this._applyCommandBuffer(L.BeforeImageEffect,o),T&&T._end(),r){if(this._postProcess)this._postProcess._render(),this._postProcess._applyPostProcessCommandBuffers();else if(this._enableHDR||this._needBuiltInRenderTexture){var S,R=this._getCanvasWidth(),C=this._getCanvasHeight();this._screenOffsetScale.setValue(a.x/R,a.y/C,a.width/R,a.height/C),(S=A.a.create(this._internalRenderTexture,this._offScreenRenderTexture?this._offScreenRenderTexture:null,this._screenOffsetScale,null,null,0,A.a._SCREENTYPE_QUAD,null,!0)).run(),S.recover()}E.a.recoverToPool(this._internalRenderTexture)}this._applyCommandBuffer(L.AfterEveryThing,o),(m||g)&&i.cleanUp()}}viewportPointToRay(t,e){S.a.calculateCursorRay(t,this.viewport,this._projectionMatrix,this.viewMatrix,null,e)}normalizedViewportPointToRay(t,e){var i=O._tempVector20,a=this.viewport;i.x=t.x*a.width,i.y=t.y*a.height,S.a.calculateCursorRay(i,this.viewport,this._projectionMatrix,this.viewMatrix,null,e)}worldToViewportPoint(t,e){m.a.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project(t,this._projectionViewMatrix,e),e.x=e.x/n.a.stage.clientScaleX,e.y=e.y/n.a.stage.clientScaleY}worldToNormalizedViewportPoint(t,e){m.a.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project(t,this._projectionViewMatrix,e),e.x=e.x/n.a.stage.clientScaleX,e.y=e.y/n.a.stage.clientScaleY}convertScreenCoordToOrthographicCoord(t,e){if(this._orthographic){var i=y.a.clientWidth,a=y.a.clientHeight,r=this.orthographicVerticalSize*this.aspectRatio/i,s=this.orthographicVerticalSize/a;return e.x=(-i/2+t.x*n.a.stage.clientScaleX)*r,e.y=(a/2-t.y*n.a.stage.clientScaleY)*s,e.z=(this.nearPlane-this.farPlane)*(t.z+1)/2-this.nearPlane,g.a.transformCoordinate(e,this.transform.worldMatrix,e),!0}return!1}destroy(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._offScreenRenderTexture=null,this.transform.off(o.a.TRANSFORM_CHANGED,this,this._onTransformChanged),super.destroy(t)}addCommandBuffer(t,e){var i=this._cameraEventCommandBuffer[t];i||(i=this._cameraEventCommandBuffer[t]=[]),i.indexOf(e)<0&&i.push(e),e._camera=this}removeCommandBuffer(t,e){var i=this._cameraEventCommandBuffer[t];if(!i)throw"Camera:unknown event.";var a=i.indexOf(e);-1!=a&&i.splice(a,1)}removeCommandBuffers(t){this._cameraEventCommandBuffer[t]&&(this._cameraEventCommandBuffer[t].length=0)}_create(){return new O}}e.a=O,r()(O,"_tempVector20",new p.a),r()(O,"_updateMark",0)},function(t,e,i){"use strict";i.d(e,"b",function(){return o});var a=i(0),r=i.n(a),s=i(101),n=i(1);let o;!function(t){t[t.Box=0]="Box",t[t.Circle=1]="Circle",t[t.Cone=2]="Cone",t[t.Hemisphere=3]="Hemisphere",t[t.Sphere=4]="Sphere"}(o||(o={}));class l{constructor(){r()(this,"enable",!0),r()(this,"randomDirection",0),r()(this,"shapeType",void 0)}_getShapeBoundBox(t){throw new Error("BaseShape: must override it.")}_getSpeedBoundBox(t){throw new Error("BaseShape: must override it.")}generatePositionAndDirection(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3];throw new Error("BaseShape: must override it.")}_calculateProceduralBounds(t,e,i){this._getShapeBoundBox(t);var a=t.min,r=t.max;n.a.multiply(a,e,a),n.a.multiply(r,e,r);var o=new s.a(new n.a,new n.a);this.randomDirection?(o.min=new n.a(-1,-1,-1),o.max=new n.a(1,1,1)):this._getSpeedBoundBox(o);var l=new s.a(new n.a,new n.a),h=l.min,_=l.max;n.a.scale(o.min,i.y,h),n.a.scale(o.max,i.y,_),n.a.add(t.min,h,h),n.a.add(t.max,_,_),n.a.min(t.min,h,t.min),n.a.max(t.max,h,t.max);var c=new s.a(new n.a,new n.a),d=c.min,u=c.max;n.a.scale(o.min,i.x,d),n.a.scale(o.max,i.x,u),n.a.min(c.min,u,h),n.a.max(c.min,u,_),n.a.min(t.min,h,t.min),n.a.max(t.max,h,t.max)}cloneTo(t){t.enable=this.enable}clone(){var t=new l;return this.cloneTo(t),t}}e.a=l},function(t,e){var i={}.hasOwnProperty;t.exports=function(t,e){return i.call(t,e)}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(15);class n{static getSystemEndian(){if(!n._sysEndian){var t=new ArrayBuffer(2);new DataView(t).setInt16(0,256,!0),n._sysEndian=256===new Int16Array(t)[0]?n.LITTLE_ENDIAN:n.BIG_ENDIAN}return n._sysEndian}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;r()(this,"_xd_",!0),r()(this,"_allocated_",8),r()(this,"_d_",void 0),r()(this,"_u8d_",void 0),r()(this,"_pos_",0),r()(this,"_length",0),t?(this._u8d_=new Uint8Array(t),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this._resizeBuffer(this._allocated_)}get buffer(){var t=this._d_.buffer;return t.byteLength===this._length?t:t.slice(0,this._length)}get endian(){return this._xd_?n.LITTLE_ENDIAN:n.BIG_ENDIAN}set endian(t){this._xd_=t===n.LITTLE_ENDIAN}set length(t){this._allocated_<t?this._resizeBuffer(this._allocated_=Math.floor(Math.max(t,2*this._allocated_))):this._allocated_>t&&this._resizeBuffer(this._allocated_=t),this._length=t}get length(){return this._length}_resizeBuffer(t){try{var e=new Uint8Array(t);null!=this._u8d_&&(this._u8d_.length<=t?e.set(this._u8d_):e.set(this._u8d_.subarray(0,t))),this._u8d_=e,this._d_=new DataView(e.buffer)}catch(e){throw"Invalid typed array length:"+t}}getString(){return this.readString()}readString(){return this._rUTF(this.getUint16())}getFloat32Array(t,e){return this.readFloat32Array(t,e)}readFloat32Array(t,e){var i=t+e;i=i>this._length?this._length:i;var a=new Float32Array(this._d_.buffer.slice(t,i));return this._pos_=i,a}getUint8Array(t,e){return this.readUint8Array(t,e)}readUint8Array(t,e){var i=t+e;i=i>this._length?this._length:i;var a=new Uint8Array(this._d_.buffer.slice(t,i));return this._pos_=i,a}getInt16Array(t,e){return this.readInt16Array(t,e)}readInt16Array(t,e){var i=t+e;i=i>this._length?this._length:i;var a=new Int16Array(this._d_.buffer.slice(t,i));return this._pos_=i,a}getFloat32(){return this.readFloat32()}readFloat32(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var t=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,t}getFloat64(){return this.readFloat64()}readFloat64(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var t=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,t}writeFloat32(t){this._ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,t,this._xd_),this._pos_+=4}writeFloat64(t){this._ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,t,this._xd_),this._pos_+=8}getInt32(){return this.readInt32()}readInt32(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var t=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,t}getUint32(){return this.readUint32()}readUint32(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var t=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,t}writeInt32(t){this._ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,t,this._xd_),this._pos_+=4}writeUint32(t){this._ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,t,this._xd_),this._pos_+=4}getInt16(){return this.readInt16()}readInt16(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var t=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,t}getUint16(){return this.readUint16()}readUint16(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var t=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,t}writeUint16(t){this._ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,t,this._xd_),this._pos_+=2}writeInt16(t){this._ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,t,this._xd_),this._pos_+=2}getUint8(){return this.readUint8()}readUint8(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._u8d_[this._pos_++]}writeUint8(t){this._ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,t),this._pos_++}_getUInt8(t){return this._readUInt8(t)}_readUInt8(t){return this._d_.getUint8(t)}_getUint16(t){return this._readUint16(t)}_readUint16(t){return this._d_.getUint16(t,this._xd_)}_getMatrix(){return this._readMatrix()}_readMatrix(){return new s.a(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())}_rUTF(t){var e,i,a=this._pos_+t,r=String.fromCharCode,s=this._u8d_,n=[],o=0;for(n.length=1e3;this._pos_<a;){if((e=s[this._pos_++])<128)0!=e&&(n[o++]=r(e));else if(e<224)n[o++]=r((63&e)<<6|127&s[this._pos_++]);else if(e<240)i=s[this._pos_++],n[o++]=r((31&e)<<12|(127&i)<<6|127&s[this._pos_++]);else{const t=(15&e)<<18|(127&(i=s[this._pos_++]))<<12|(127&s[this._pos_++])<<6|127&s[this._pos_++];if(t>=65536){const e=t-65536,i=55296|e>>10,a=56320|1023&e;n[o++]=r(i),n[o++]=r(a)}else n[o++]=r(t)}0}return n.length=o,n.join("")}getCustomString(t){return this.readCustomString(t)}readCustomString(t){for(var e,i="",a=0,r=String.fromCharCode,s=this._u8d_;t>0;)if((e=s[this._pos_])<128)i+=r(e),this._pos_++,t--;else for(a=e-128,this._pos_++,t-=a;a>0;)e=s[this._pos_++],i+=r(s[this._pos_++]<<8|e),a--;return i}get pos(){return this._pos_}set pos(t){this._pos_=t}get bytesAvailable(){return this._length-this._pos_}clear(){this._pos_=0,this.length=0}__getBuffer(){return this._d_.buffer}writeUTFBytes(t){for(var e=0,i=(t+="").length;e<i;e++){var a=t.charCodeAt(e);if(a<=127)this.writeByte(a);else if(a<=2047)this._ensureWrite(this._pos_+2),this._u8d_.set([192|a>>6,128|63&a],this._pos_),this._pos_+=2;else if(a>=55296&&a<=56319){e++;const i=t.charCodeAt(e);if(!Number.isNaN(i)&&i>=56320&&i<=57343){const t=64+(1023&a),e=1023&i,r=240|t>>8&63,s=128|t>>2&63,n=128|(3&t)<<4|e>>6&15,o=128|63&e;this._ensureWrite(this._pos_+4),this._u8d_.set([r,s,n,o],this._pos_),this._pos_+=4}}else a<=65535?(this._ensureWrite(this._pos_+3),this._u8d_.set([224|a>>12,128|a>>6&63,128|63&a],this._pos_),this._pos_+=3):(this._ensureWrite(this._pos_+4),this._u8d_.set([240|a>>18,128|a>>12&63,128|a>>6&63,128|63&a],this._pos_),this._pos_+=4)}}writeUTFString(t){var e=this.pos;this.writeUint16(1),this.writeUTFBytes(t);var i=this.pos-e-2;this._d_.setUint16(e,i,this._xd_)}readUTFString(){return this.readUTFBytes(this.getUint16())}getUTFString(){return this.readUTFString()}readUTFBytes(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(0===t)return"";var e=this.bytesAvailable;if(t>e)throw"readUTFBytes error - Out of bounds";return t=t>0?t:e,this._rUTF(t)}getUTFBytes(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return this.readUTFBytes(t)}writeByte(t){this._ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,t),this._pos_+=1}readByte(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)}getByte(){return this.readByte()}_ensureWrite(t){this._length<t&&(this._length=t),this._allocated_<t&&(this.length=t)}writeArrayBuffer(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e<0||i<0)throw"writeArrayBuffer error - Out of bounds";0==i&&(i=t.byteLength-e),this._ensureWrite(this._pos_+i);var a=new Uint8Array(t);this._u8d_.set(a.subarray(e,e+i),this._pos_),this._pos_+=i}readArrayBuffer(t){var e;return e=this._u8d_.buffer.slice(this._pos_,this._pos_+t),this._pos_=this._pos_+t,e}}e.a=n,r()(n,"BIG_ENDIAN","bigEndian"),r()(n,"LITTLE_ENDIAN","littleEndian"),r()(n,"_sysEndian",null)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(17);class n extends s.a{constructor(){super()}}e.a=n,r()(n,"activeShader",void 0),r()(n,"bindShader",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(3),n=i(8),o=i(315),l=i(10),h=i(91),_=i(2);class c extends h.a{static getShader(t){return c.sharders[t]}static create(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return new c(t,e,i,a,r)}static withCompile(t,e,i,a){if(i&&c.sharders[i])return c.sharders[i];var r=c._preCompileShader[c.SHADERNAME2ID*t];if(!r)throw new Error("withCompile shader err!"+t);return r.createShader(e,i,a,null)}static withCompile2D(t,e,i,a,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(a&&c.sharders[a])return c.sharders[a];var n=c._preCompileShader[c.SHADERNAME2ID*t+e];if(!n)throw new Error("withCompile shader err!"+t+" "+e);return n.createShader(i,a,r,s)}static addInclude(t,e){s.a.ShaderCompile.addInclude(t,e)}static preCompile(t,e,i,a){var r=c.SHADERNAME2ID*t;c._preCompileShader[r]=new s.a.ShaderCompile(e,i,a)}static preCompile2D(t,e,i,a,r){var n=c.SHADERNAME2ID*t+e;c._preCompileShader[n]=new s.a.ShaderCompile(i,a,r)}constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(super(),r()(this,"_attribInfo",null),r()(this,"customCompile",!1),r()(this,"_nameMap",void 0),r()(this,"_vs",void 0),r()(this,"_ps",void 0),r()(this,"_curActTexIndex",0),r()(this,"_reCompile",void 0),r()(this,"tag",{}),r()(this,"_vshader",void 0),r()(this,"_pshader",void 0),r()(this,"_program",null),r()(this,"_params",null),r()(this,"_paramsMap",{}),!t||!e)throw"Shader Error";this._attribInfo=s,this._id=++c._count,this._vs=t,this._ps=e,this._nameMap=a||{},null!=i&&(c.sharders[i]=this),this.recreateResource(),this.lock=!0}recreateResource(){this._compile(),this._setGPUMemory(0)}_disposeResource(){l.a.mainContext.deleteShader(this._vshader),l.a.mainContext.deleteShader(this._pshader),l.a.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this._setGPUMemory(0),this._curActTexIndex=0}_compile(){if(this._vs&&this._ps&&!this._params){var t;this._reCompile=!0,this._params=[],this.customCompile&&(t=s.a.ShaderCompile.preGetParams(this._vs,this._ps));var e,i,a,r=l.a.mainContext;this._program=r.createProgram(),this._vshader=c._createShader(r,this._vs,r.VERTEX_SHADER),this._pshader=c._createShader(r,this._ps,r.FRAGMENT_SHADER),r.attachShader(this._program,this._vshader),r.attachShader(this._program,this._pshader);var n=this._attribInfo?this._attribInfo.length:0;for(i=0;i<n;i+=2)r.bindAttribLocation(this._program,this._attribInfo[i+1],this._attribInfo[i]);if(r.linkProgram(this._program),!this.customCompile&&!r.getProgramParameter(this._program,r.LINK_STATUS))throw r.getProgramInfoLog(this._program);var o=this.customCompile?t.uniforms.length:r.getProgramParameter(this._program,r.ACTIVE_UNIFORMS);for(i=0;i<o;i++){var h=this.customCompile?t.uniforms[i]:r.getActiveUniform(this._program,i);(e={vartype:"uniform",glfun:null,ivartype:1,location:r.getUniformLocation(this._program,h.name),name:h.name,type:h.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")>0&&(e.name=e.name.substr(0,e.name.length-3),e.isArray=!0,e.location=r.getUniformLocation(this._program,e.name)),this._params.push(e)}for(i=0,a=this._params.length;i<a;i++)switch((e=this._params[i]).indexOfParams=i,e.index=1,e.value=[e.location,null],e.codename=e.name,e.name=this._nameMap[e.codename]?this._nameMap[e.codename]:e.codename,this._paramsMap[e.name]=e,e._this=this,e.uploadedValue=[],e.type){case r.INT:e.fun=e.isArray?this._uniform1iv:this._uniform1i;break;case r.FLOAT:e.fun=e.isArray?this._uniform1fv:this._uniform1f;break;case r.FLOAT_VEC2:e.fun=e.isArray?this._uniform_vec2v:this._uniform_vec2;break;case r.FLOAT_VEC3:e.fun=e.isArray?this._uniform_vec3v:this._uniform_vec3;break;case r.FLOAT_VEC4:e.fun=e.isArray?this._uniform_vec4v:this._uniform_vec4;break;case r.SAMPLER_2D:e.fun=this._uniform_sampler2D;break;case r.SAMPLER_CUBE:e.fun=this._uniform_samplerCube;break;case r.FLOAT_MAT4:e.glfun=r.uniformMatrix4fv,e.fun=this._uniformMatrix4fv;break;case r.BOOL:e.fun=this._uniform1i;break;case r.FLOAT_MAT2:case r.FLOAT_MAT3:default:throw new Error("compile shader err!")}}}static _createShader(t,e,i){var a=t.createShader(i);return t.shaderSource(a,e),t.compileShader(a),t.getShaderParameter(a,t.COMPILE_STATUS)?a:(console.log(t.getShaderInfoLog(a)),null)}getUniform(t){return this._paramsMap[t]}_uniform1f(t,e){var i=t.uploadedValue;return i[0]!==e?(l.a.mainContext.uniform1f(t.location,i[0]=e),1):0}_uniform1fv(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(l.a.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return l.a.mainContext.uniform1fv(t.location,e),1}_uniform_vec2(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(l.a.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0}_uniform_vec2v(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(l.a.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return l.a.mainContext.uniform2fv(t.location,e),1}_uniform_vec3(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(l.a.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0}_uniform_vec3v(t,e){return l.a.mainContext.uniform3fv(t.location,e),1}_uniform_vec4(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(l.a.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0}_uniform_vec4v(t,e){return l.a.mainContext.uniform4fv(t.location,e),1}_uniformMatrix2fv(t,e){return l.a.mainContext.uniformMatrix2fv(t.location,!1,e),1}_uniformMatrix3fv(t,e){return l.a.mainContext.uniformMatrix3fv(t.location,!1,e),1}_uniformMatrix4fv(t,e){return l.a.mainContext.uniformMatrix4fv(t.location,!1,e),1}_uniform1i(t,e){var i=t.uploadedValue;return i[0]!==e?(l.a.mainContext.uniform1i(t.location,i[0]=e),1):0}_uniform1iv(t,e){return l.a.mainContext.uniform1iv(t.location,e),1}_uniform_ivec2(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(l.a.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0}_uniform_ivec2v(t,e){return l.a.mainContext.uniform2iv(t.location,e),1}_uniform_vec3i(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(l.a.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0}_uniform_vec3vi(t,e){return l.a.mainContext.uniform3iv(t.location,e),1}_uniform_vec4i(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(l.a.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0}_uniform_vec4vi(t,e){return l.a.mainContext.uniform4iv(t.location,e),1}_uniform_sampler2D(t,e){var i=l.a.mainContext,a=t.uploadedValue;return null==a[0]?(a[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),l.a.activeTexture(i,i.TEXTURE0+this._curActTexIndex),l.a.bindTexture(i,i.TEXTURE_2D,e),this._curActTexIndex++,1):(l.a.activeTexture(i,i.TEXTURE0+a[0]),l.a.bindTexture(i,i.TEXTURE_2D,e),0)}_uniform_samplerCube(t,e){var i=l.a.mainContext,a=t.uploadedValue;return null==a[0]?(a[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),l.a.activeTexture(i,i.TEXTURE0+this._curActTexIndex),l.a.bindTexture(i,i.TEXTURE_CUBE_MAP,e),this._curActTexIndex++,1):(l.a.activeTexture(i,i.TEXTURE0+a[0]),l.a.bindTexture(i,i.TEXTURE_CUBE_MAP,e),0)}_noSetValue(t){console.log("no....:"+t.name)}uploadOne(t,e){l.a.useProgram(l.a.mainContext,this._program);var i=this._paramsMap[t];i.fun.call(this,i,e)}uploadTexture2D(t){var e=l.a;e._activeTextures[0]!==t&&(e.bindTexture(l.a.mainContext,_.a.instance.TEXTURE_2D,t),e._activeTextures[0]=t)}upload(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;h.a.activeShader=h.a.bindShader=this;var i=l.a.mainContext;l.a.useProgram(i,this._program),this._reCompile?(e=this._params,this._reCompile=!1):e=e||this._params;for(var a,r,s=e.length,o=0,_=0;_<s;_++)null!==(r=t[(a=e[_]).name])&&(o+=a.fun.call(this,a,r));n.a.shaderCall+=o}uploadArray(t,e,i){h.a.activeShader=this,h.a.bindShader=this,l.a.useProgram(l.a.mainContext,this._program);this._params;for(var a,r,s=0,o=e-2;o>=0;o-=2)(r=this._paramsMap[t[o]])&&null!=(a=t[o+1])&&(i&&i[r.name]&&i[r.name].bind(),s+=r.fun.call(this,r,a));n.a.shaderCall+=s}getParams(){return this._params}setAttributesLocation(t){this._attribInfo=t}}e.a=c,r()(c,"_count",0),r()(c,"_preCompileShader",{}),r()(c,"SHADERNAME2ID",2e-4),r()(c,"nameKey",new o.a),r()(c,"sharders",new Array(32))},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){r()(this,"blendShader",void 0),r()(this,"submitType",void 0),r()(this,"other",void 0),this.clear()}clear(){this.submitType=-1,this.blendShader=this.other=0}copyFrom(t){this.other=t.other,this.blendShader=t.blendShader,this.submitType=t.submitType}copyFrom2(t,e,i){this.other=i,this.submitType=e}equal3_2(t,e,i){return this.submitType===e&&this.other===i&&this.blendShader===t.blendShader}equal4_2(t,e,i){return this.submitType===e&&this.other===i&&this.blendShader===t.blendShader}equal_3(t){return this.submitType===t.submitType&&this.blendShader===t.blendShader}equal(t){return this.other===t.other&&this.submitType===t.submitType&&this.blendShader===t.blendShader}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(61);class n{static _createArray(){var t=[];return t._length=0,t}static _init(){var t=n._namemap={};return t[n.TYPE_ALPHA]="ALPHA",t[n.TYPE_FILESTYLE]="fillStyle",t[n.TYPE_FONT]="font",t[n.TYPE_LINEWIDTH]="lineWidth",t[n.TYPE_STROKESTYLE]="strokeStyle",t[n.TYPE_ENABLEMERGE]="_mergeID",t[n.TYPE_MARK]=t[n.TYPE_TRANSFORM]=t[n.TYPE_TRANSLATE]=[],t[n.TYPE_TEXTBASELINE]="textBaseline",t[n.TYPE_TEXTALIGN]="textAlign",t[n.TYPE_GLOBALCOMPOSITEOPERATION]="_nBlendType",t[n.TYPE_SHADER]="shader",t[n.TYPE_FILTERS]="filters",t[n.TYPE_COLORFILTER]="_colorFiler",t}constructor(){r()(this,"_valueName",void 0),r()(this,"_value",void 0),r()(this,"_dataObj",void 0),r()(this,"_newSubmit",void 0)}isSaveMark(){return!1}restore(t){this._dataObj[this._valueName]=this._value,n.POOL[n.POOL._length++]=this,this._newSubmit&&(t._curSubmit=s.a.RENDERBASE)}static save(t,e,i,a){if((t._saveMark._saveuse&e)!==e){t._saveMark._saveuse|=e;var r=n.POOL,s=r._length>0?r[--r._length]:new n;s._value=i[s._valueName=n._namemap[e]],s._dataObj=i,s._newSubmit=a;var o=t._save;o[o._length++]=s}}}e.a=n,r()(n,"TYPE_ALPHA",1),r()(n,"TYPE_FILESTYLE",2),r()(n,"TYPE_FONT",8),r()(n,"TYPE_LINEWIDTH",256),r()(n,"TYPE_STROKESTYLE",512),r()(n,"TYPE_MARK",1024),r()(n,"TYPE_TRANSFORM",2048),r()(n,"TYPE_TRANSLATE",4096),r()(n,"TYPE_ENABLEMERGE",8192),r()(n,"TYPE_TEXTBASELINE",16384),r()(n,"TYPE_TEXTALIGN",32768),r()(n,"TYPE_GLOBALCOMPOSITEOPERATION",65536),r()(n,"TYPE_CLIPRECT",131072),r()(n,"TYPE_CLIPRECT_STENCIL",262144),r()(n,"TYPE_IBVB",524288),r()(n,"TYPE_SHADER",1048576),r()(n,"TYPE_FILTERS",2097152),r()(n,"TYPE_FILTERS_TYPE",4194304),r()(n,"TYPE_COLORFILTER",8388608),r()(n,"POOL",n._createArray()),r()(n,"_namemap",n._init())},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2);class n{get bufferUsage(){return this._bufferUsage}constructor(){r()(this,"_glBuffer",void 0),r()(this,"_buffer",void 0),r()(this,"_bufferType",void 0),r()(this,"_bufferUsage",void 0),r()(this,"_byteLength",0),this._glBuffer=s.a.instance.createBuffer()}_bindForVAO(){}bind(){return!1}destroy(){this._glBuffer&&(s.a.instance.deleteBuffer(this._glBuffer),this._glBuffer=null)}}e.a=n,r()(n,"_bindedVertexBuffer",void 0),r()(n,"_bindedIndexBuffer",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{}e.a=s,r()(s,"BYTES_PE",4),r()(s,"BYTES_PIDX",2),r()(s,"defaultMatrix4",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),r()(s,"defaultMinusYMatrix4",[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1]),r()(s,"uniformMatrix3",[1,0,0,0,0,1,0,0,0,0,1,0]),r()(s,"_TMPARRAY",[]),r()(s,"_OFFSETX",0),r()(s,"_OFFSETY",0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(66),n=i(10);class o{static _uint8ArraySlice(){for(var t=this.length,e=new Uint8Array(this.length),i=0;i<t;i++)e[i]=this[i];return e}static _float32ArraySlice(){for(var t=this.length,e=new Float32Array(this.length),i=0;i<t;i++)e[i]=this[i];return e}static _uint16ArraySlice(){var t,e,i;if(0===arguments.length)for(t=this.length,e=new Uint16Array(t),i=0;i<t;i++)e[i]=this[i];else if(2===arguments.length){var a=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1];if(r>a)for(t=r-a,e=new Uint16Array(t),i=a;i<r;i++)e[i-a]=this[i];else e=new Uint16Array(0)}return e}static _nativeRender_enable(){}static enable(){return!0}static inner_enable(){return Float32Array.prototype.slice||(Float32Array.prototype.slice=o._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=o._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=o._uint8ArraySlice),!0}static onStageResize(t,e){null!=n.a.mainContext&&(n.a.mainContext.viewport(0,0,t,e),s.a.width=t,s.a.height=e)}}e.a=o,r()(o,"_isWebGL2",!1),r()(o,"isNativeRender_enable",!1)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4),n=i(21);class o{constructor(){r()(this,"_indexInList",void 0),r()(this,"_destroyed",void 0),r()(this,"_id",void 0),r()(this,"_enabled",void 0),r()(this,"_awaked",void 0),r()(this,"owner",void 0),this._id=n.a.getGID(),this._resetComp()}get id(){return this._id}get enabled(){return this._enabled}set enabled(t){this._enabled!=t&&(this._enabled=t,this.owner&&(t?this.owner.activeInHierarchy&&this._onEnable():this.owner.activeInHierarchy&&this._onDisable()))}get isSingleton(){return!0}get destroyed(){return this._destroyed}_isScript(){return!1}_resetComp(){this._indexInList=-1,this._enabled=!0,this._awaked=!1,this.owner=null}_getIndexInList(){return this._indexInList}_setIndexInList(t){this._indexInList=t}_onAdded(){}_onAwake(){}_onEnable(){}_onDisable(){}_onDestroy(){}onReset(){}_parse(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1]}_parseInteractive(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1]}_cloneTo(t){}_setActive(t){t?(this._awaked||(this._awaked=!0,this._onAwake()),this._enabled&&this._onEnable()):this._enabled&&this._onDisable()}destroy(){this.owner&&this.owner._destroyComponent(this)}_destroy(){this.owner.activeInHierarchy&&this._enabled&&this._setActive(!1),this._onDestroy(),this._destroyed=!0,this.onReset!==o.prototype.onReset?(this.onReset(),this._resetComp(),s.a.recoverByClass(this)):this._resetComp()}}e.a=o},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1);class n{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;r()(this,"normal",void 0),r()(this,"distance",void 0),this.normal=t,this.distance=e}static createPlaneBy3P(t,e,i,a){var r=e.x-t.x,s=e.y-t.y,n=e.z-t.z,o=i.x-t.x,l=i.y-t.y,h=i.z-t.z,_=s*h-n*l,c=n*o-r*h,d=r*l-s*o,u=1/Math.sqrt(_*_+c*c+d*d),f=_*u,m=c*u,p=d*u,g=a.normal;g.x=f,g.y=m,g.z=p,a.distance=-(f*t.x+m*t.y+p*t.z)}normalize(){var t=this.normal.x,e=this.normal.y,i=this.normal.z,a=1/Math.sqrt(t*t+e*e+i*i);this.normal.x=t*a,this.normal.y=e*a,this.normal.z=i*a,this.distance*=a}cloneTo(t){var e=t;this.normal.cloneTo(e.normal),e.distance=this.distance}clone(){var t=new n(new s.a);return this.cloneTo(t),t}}e.a=n,r()(n,"PlaneIntersectionType_Back",0),r()(n,"PlaneIntersectionType_Front",1),r()(n,"PlaneIntersectionType_Intersecting",2)},function(t,e,i){"use strict";i.d(e,"b",function(){return _});var a=i(0),r=i.n(a),s=i(72),n=i(1),o=i(33),l=i(128),h=i(9);let _;!function(t){t[t.Directional=0]="Directional",t[t.Spot=1]="Spot",t[t.Point=2]="Point"}(_||(_={}));class c extends o.a{get intensity(){return this._intensity}set intensity(t){this._intensity=t}get shadowMode(){return this._shadowMode}set shadowMode(t){this._shadowMode=t}get shadowDistance(){return this._shadowDistance}set shadowDistance(t){this._shadowDistance=t}get shadowResolution(){return this._shadowResolution}set shadowResolution(t){this._shadowResolution=t}get shadowDepthBias(){return this._shadowDepthBias}set shadowDepthBias(t){this._shadowDepthBias=t}get shadowNormalBias(){return this._shadowNormalBias}set shadowNormalBias(t){this._shadowNormalBias=t}get shadowStrength(){return this._shadowStrength}set shadowStrength(t){this._shadowStrength=t}get shadowNearPlane(){return this._shadowNearPlane}set shadowNearPlane(t){this._shadowNearPlane=t}get lightmapBakedType(){return this._lightmapBakedType}set lightmapBakedType(t){this._lightmapBakedType!==t&&(this._lightmapBakedType=t,this.activeInHierarchy&&(t!==c.LIGHTMAPBAKEDTYPE_BAKED?this._addToScene():this._removeFromScene()))}get lightWorldMatrix(){var t=this.transform.position,e=this.transform.rotation;return h.a.createAffineTransformation(t,e,n.a._ONE,this._lightWoldMatrix),this._lightWoldMatrix}constructor(){super(),r()(this,"_shadowMode",l.a.None),r()(this,"_isAlternate",!1),r()(this,"_intensityColor",void 0),r()(this,"_intensity",void 0),r()(this,"_shadowResolution",2048),r()(this,"_shadowDistance",50),r()(this,"_shadowDepthBias",1),r()(this,"_shadowNormalBias",1),r()(this,"_shadowNearPlane",.1),r()(this,"_shadowStrength",1),r()(this,"_lightmapBakedType",void 0),r()(this,"_lightType",void 0),r()(this,"_lightWoldMatrix",new h.a),r()(this,"color",void 0),this._intensity=1,this._intensityColor=new n.a,this.color=new n.a(1,1,1),this._lightmapBakedType=c.LIGHTMAPBAKEDTYPE_REALTIME}_parse(t,e){super._parse(t,e);var i=t.color;this.color.fromArray(i),this.intensity=t.intensity,this.lightmapBakedType=t.lightmapBakedType}_addToScene(){var t=this._scene,e=s.a._config.maxLightCount;t._lightCount<e?(t._lightCount++,this._addToLightQueue(),this._isAlternate=!1):(t._alternateLights.add(this),this._isAlternate=!0,console.warn("LightSprite:light count has large than maxLightCount,the latest added light will be ignore."))}_removeFromScene(){var t=this._scene;if(this._isAlternate)t._alternateLights.remove(this);else if(t._lightCount--,this._removeFromLightQueue(),t._alternateLights._length>0){var e=t._alternateLights.shift();e._addToLightQueue(),e._isAlternate=!1,t._lightCount++}}_addToLightQueue(){}_removeFromLightQueue(){}_onActive(){super._onActive(),this.lightmapBakedType!==c.LIGHTMAPBAKEDTYPE_BAKED&&this._addToScene()}_onInActive(){super._onInActive(),this.lightmapBakedType!==c.LIGHTMAPBAKEDTYPE_BAKED&&this._removeFromScene()}_create(){return new c}get diffuseColor(){return console.log("LightSprite: discard property,please use color property instead."),this.color}set diffuseColor(t){console.log("LightSprite: discard property,please use color property instead."),this.color=t}}e.a=c,r()(c,"LIGHTMAPBAKEDTYPE_REALTIME",0),r()(c,"LIGHTMAPBAKEDTYPE_MIXED",1),r()(c,"LIGHTMAPBAKEDTYPE_BAKED",2)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1);class n{constructor(t,e){r()(this,"min",void 0),r()(this,"max",void 0),this.min=t,this.max=e}_rotateExtents(t,e,i){var a=t.x,r=t.y,s=t.z,n=e.elements;i.x=Math.abs(n[0]*a)+Math.abs(n[4]*r)+Math.abs(n[8]*s),i.y=Math.abs(n[1]*a)+Math.abs(n[5]*r)+Math.abs(n[9]*s),i.z=Math.abs(n[2]*a)+Math.abs(n[6]*r)+Math.abs(n[10]*s)}getCorners(t){t.length=8;var e=this.min.x,i=this.min.y,a=this.min.z,r=this.max.x,n=this.max.y,o=this.max.z;t[0]=new s.a(e,n,o),t[1]=new s.a(r,n,o),t[2]=new s.a(r,i,o),t[3]=new s.a(e,i,o),t[4]=new s.a(e,n,a),t[5]=new s.a(r,n,a),t[6]=new s.a(r,i,a),t[7]=new s.a(e,i,a)}getCenter(t){s.a.add(this.min,this.max,t),s.a.scale(t,.5,t)}getExtent(t){s.a.subtract(this.max,this.min,t),s.a.scale(t,.5,t)}setCenterAndExtent(t,e){s.a.subtract(t,e,this.min),s.a.add(t,e,this.max)}tranform(t,e){var i=n._tempVector30,a=n._tempVector31;this.getCenter(i),this.getExtent(a),s.a.transformCoordinate(i,t,i),this._rotateExtents(a,t,a),e.setCenterAndExtent(i,a)}toDefault(){this.min.toDefault(),this.max.toDefault()}static createfromPoints(t,e){if(null==t)throw new Error("points");var i=e.min,a=e.max;i.x=Number.MAX_VALUE,i.y=Number.MAX_VALUE,i.z=Number.MAX_VALUE,a.x=-Number.MAX_VALUE,a.y=-Number.MAX_VALUE,a.z=-Number.MAX_VALUE;for(var r=0,n=t.length;r<n;++r)s.a.min(i,t[r],i),s.a.max(a,t[r],a)}static merge(t,e,i){s.a.min(t.min,e.min,i.min),s.a.max(t.max,e.max,i.max)}cloneTo(t){var e=t;this.min.cloneTo(e.min),this.max.cloneTo(e.max)}clone(){var t=new n(new s.a,new s.a);return this.cloneTo(t),t}}e.a=n,r()(n,"_tempVector30",new s.a),r()(n,"_tempVector31",new s.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(8),o=i(75),l=i(25),h=i(14);class _ extends o.a{static __init__(){_.instance=new _}constructor(){super(),r()(this,"maxInstanceCount",1024),r()(this,"instanceWorldMatrixData",new Float32Array(16*this.maxInstanceCount)),r()(this,"instanceMVPMatrixData",new Float32Array(16*this.maxInstanceCount)),r()(this,"instanceWorldMatrixBuffer",void 0),r()(this,"instanceMVPMatrixBuffer",void 0),r()(this,"instanceSimpleAnimatorData",new Float32Array(4*this.maxInstanceCount)),r()(this,"instanceSimpleAnimatorBuffer",void 0);var t=s.a.instance;this.instanceWorldMatrixBuffer=new l.a(4*this.instanceWorldMatrixData.length,t.DYNAMIC_DRAW),this.instanceMVPMatrixBuffer=new l.a(4*this.instanceMVPMatrixData.length,t.DYNAMIC_DRAW),this.instanceWorldMatrixBuffer.vertexDeclaration=h.a.instanceWorldMatrixDeclaration,this.instanceMVPMatrixBuffer.vertexDeclaration=h.a.instanceMVPMatrixDeclaration,this.instanceSimpleAnimatorBuffer=new l.a(4*this.instanceSimpleAnimatorData.length,t.DYNAMIC_DRAW),this.instanceSimpleAnimatorBuffer.vertexDeclaration=h.a.instanceSimpleAnimatorDeclaration}_render(t){var e=s.a.instance,i=t.renderElement,a=i.instanceSubMesh,r=i.instanceBatchElementList.length,o=a._indexCount;a._mesh._instanceBufferState.bind(),s.a.layaGPUInstance.drawElementsInstanced(e.TRIANGLES,o,e.UNSIGNED_SHORT,2*a._indexStart,r),n.a.renderBatches++,n.a.savedRenderBatches+=r-1,n.a.trianglesFaces+=o*r/3}}e.a=_,r()(_,"instance",void 0)},function(t,e,i){"use strict";i.d(e,"b",function(){return c});var a=i(0),r=i.n(a),s=i(5),n=i(74),o=i(33),l=i(1),h=i(12),_=i(182);let c;!function(t){t[t.off=0]="off",t[t.simple=1]="simple"}(c||(c={}));class d extends o.a{constructor(){super(),r()(this,"_boxProjection",!1),r()(this,"_importance",void 0),r()(this,"_reflectionTexture",void 0),r()(this,"_size",new l.a),r()(this,"_offset",new l.a),r()(this,"_bounds",void 0),r()(this,"_intensity",void 0),r()(this,"_reflectionHDRParams",new s.a),r()(this,"_reflectionDecodeFormat",_.a.Normal),r()(this,"_indexInReflectProbList",void 0),r()(this,"_isScene",!1)}get boxProjection(){return this._boxProjection}set boxProjection(t){this._boxProjection=t}get importance(){return this._importance}set importance(t){this._importance=t}get intensity(){return this._intensity}set intensity(t){t=Math.max(Math.min(t,1),0),this._reflectionHDRParams.x=t,this._reflectionDecodeFormat==_.a.RGBM&&(this._reflectionHDRParams.x*=5),this._intensity=t}get reflectionTexture(){return this._reflectionTexture}set reflectionTexture(t){this._reflectionTexture=t,this._reflectionTexture._addReference()}get bounds(){return this._bounds}set bounds(t){this._bounds=t}get boundsMax(){return this._bounds.getMax()}get boundsMin(){return this._bounds.getMin()}get probePosition(){return this.transform.position}get reflectionHDRParams(){return this._reflectionHDRParams}set reflectionHDRParams(t){this._reflectionHDRParams=t}_parse(t,e){super._parse(t,e),this._boxProjection=t.boxProjection,this._importance=t.importance,this._reflectionTexture=h.a.getRes(t.reflection);var i=this.transform.position;this._size.fromArray(t.boxSize),l.a.scale(this._size,.5,d.TEMPVECTOR3),this._offset.fromArray(t.boxOffset);var a=new l.a,r=new l.a;l.a.add(i,d.TEMPVECTOR3,r),l.a.add(r,this._offset,r),l.a.subtract(i,d.TEMPVECTOR3,a),l.a.add(a,this._offset,a),this._reflectionDecodeFormat=t.reflectionDecodingFormat,this.intensity=t.intensity,this._bounds?(this._bounds.setMin(a),this._bounds.setMax(r)):this.bounds=new n.a(a,r)}_setIndexInReflectionList(t){this._indexInReflectProbList=t}_getIndexInReflectionList(){return this._indexInReflectProbList}_onActive(){super._onActive(),this._reflectionTexture&&this.scene._reflectionProbeManager.add(this)}_onInActive(){super._onInActive(),this.reflectionTexture&&this.scene._reflectionProbeManager.remove(this)}destroy(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.destroyed||(super.destroy(t),this._reflectionTexture&&this._reflectionTexture._removeReference(),this._reflectionTexture=null,this._bounds=null)}_cloneTo(t,e,i){var a=t;a.bounds=this.bounds,a.boxProjection=this.boxProjection,a.importance=this.importance,a._size=this._size,a._offset=this._offset,a.intensity=this.intensity,a.reflectionHDRParams=this.reflectionHDRParams,super._cloneTo(t,e,i)}}e.a=d,r()(d,"TEMPVECTOR3",new l.a),r()(d,"defaultTextureHDRDecodeValues",new s.a(1,1,0,0))},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{}e.a=s,r()(s,"SHADERDEFINE_UV0",void 0),r()(s,"SHADERDEFINE_COLOR",void 0),r()(s,"SHADERDEFINE_UV1",void 0),r()(s,"SHADERDEFINE_GPU_INSTANCE",void 0),r()(s,"SHADERDEFINE_SPECCUBE_BOX_PROJECTION",void 0)},function(t,e,i){"use strict";class a{static _randomPointUnitArcCircle(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;var a;a=i?i.getFloat()*t:Math.random()*t,e.x=Math.cos(a),e.y=Math.sin(a)}static _randomPointInsideUnitArcCircle(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;var r;a._randomPointUnitArcCircle(t,e,i),r=i?Math.pow(i.getFloat(),.5):Math.pow(Math.random(),.5),e.x=e.x*r,e.y=e.y*r}static _randomPointUnitCircle(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var i;i=e?e.getFloat()*Math.PI*2:Math.random()*Math.PI*2,t.x=Math.cos(i),t.y=Math.sin(i)}static _randomPointInsideUnitCircle(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var i;a._randomPointUnitCircle(t),i=e?Math.pow(e.getFloat(),.5):Math.pow(Math.random(),.5),t.x=t.x*i,t.y=t.y*i}static _randomPointUnitSphere(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var i,a;e?(i=t.z=2*e.getFloat()-1,a=e.getFloat()*Math.PI*2):(i=t.z=2*Math.random()-1,a=Math.random()*Math.PI*2);var r=Math.sqrt(1-i*i);t.x=r*Math.cos(a),t.y=r*Math.sin(a)}static _randomPointInsideUnitSphere(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var i;a._randomPointUnitSphere(t),i=e?Math.pow(e.getFloat(),1/3):Math.pow(Math.random(),1/3),t.x=t.x*i,t.y=t.y*i,t.z=t.z*i}static _randomPointInsideHalfUnitBox(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e?(t.x=e.getFloat()-.5,t.y=e.getFloat()-.5,t.z=e.getFloat()-.5):(t.x=Math.random()-.5,t.y=Math.random()-.5,t.z=Math.random()-.5)}constructor(){}}e.a=a},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(3),n=i(50),o=i(2),l=i(17),h=i(74),_=i(38),c=i(57),d=i(39),u=i(102),f=i(14),m=i(25),p=i(31),g=i(73),v=i(20),T=i(1),E=i(5),S=i(13),R=i(137);class x{constructor(t,e,i){r()(this,"subMeshIndex",void 0),r()(this,"batchIndex",void 0),r()(this,"batchBoneIndex",void 0),this.subMeshIndex=t,this.batchIndex=e,this.batchBoneIndex=i}}e.b=x;class A extends l.a{static __init__(){var t=n.a._bullet;t&&(A._nativeTempVector30=t.btVector3_create(0,0,0),A._nativeTempVector31=t.btVector3_create(0,0,0),A._nativeTempVector32=t.btVector3_create(0,0,0))}static load(t,e){s.a.loader.create(t,e,null,A.MESH)}get inverseAbsoluteBindPoses(){return this._inverseBindPoses}get vertexCount(){return this._vertexCount}get indexCount(){return this._indexBuffer.indexCount}get subMeshCount(){return this._subMeshes.length}get bounds(){return this._bounds}set bounds(t){this._bounds!==t&&t.cloneTo(this._bounds)}get indexFormat(){return this._indexFormat}constructor(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];super(),r()(this,"_tempVector30",new T.a),r()(this,"_tempVector31",new T.a),r()(this,"_tempVector32",new T.a),r()(this,"_btTriangleMesh",void 0),r()(this,"_minVerticesUpdate",-1),r()(this,"_maxVerticesUpdate",-1),r()(this,"_needUpdateBounds",!0),r()(this,"_bounds",new h.a(new T.a,new T.a)),r()(this,"_isReadable",void 0),r()(this,"_bufferState",new _.a),r()(this,"_instanceBufferState",new _.a),r()(this,"_instanceBufferStateType",0),r()(this,"_subMeshes",void 0),r()(this,"_vertexBuffer",null),r()(this,"_indexBuffer",null),r()(this,"_boneNames",void 0),r()(this,"_inverseBindPoses",void 0),r()(this,"_skinnedMatrixCaches",[]),r()(this,"_vertexCount",0),r()(this,"_indexFormat",d.a.UInt16),r()(this,"_inverseBindPosesBuffer",void 0),this._isReadable=t,this._subMeshes=[]}_getPositionElement(t){for(var e=t.vertexDeclaration._vertexElements,i=0,a=e.length;i<a;i++){var r=e[i];if(r._elementFormat===p.a.Vector3&&r._elementUsage===f.a.MESH_POSITION0)return r}return null}_getVerticeElementData(t,e){t.length=this._vertexCount;var i=this._vertexBuffer.vertexDeclaration,a=i.getVertexElementByUsage(e);if(a){var r=this._vertexBuffer.getUint8Data(),s=this._vertexBuffer.getFloat32Data(),n=i.vertexStride,o=n/4,l=a._offset,h=l/4;switch(e){case f.a.MESH_TEXTURECOORDINATE0:case f.a.MESH_TEXTURECOORDINATE1:for(var _=0;_<this._vertexCount;_++){var c=o*_+h;t[_]=new v.a(s[c],s[c+1])}break;case f.a.MESH_POSITION0:case f.a.MESH_NORMAL0:for(_=0;_<this._vertexCount;_++){c=o*_+h;t[_]=new T.a(s[c],s[c+1],s[c+2])}break;case f.a.MESH_TANGENT0:case f.a.MESH_BLENDWEIGHT0:for(_=0;_<this._vertexCount;_++){c=o*_+h;t[_]=new E.a(s[c],s[c+1],s[c+2],s[c+3])}break;case f.a.MESH_COLOR0:for(_=0;_<this._vertexCount;_++){c=o*_+h;t[_]=new g.a(s[c],s[c+1],s[c+2],s[c+3])}break;case f.a.MESH_BLENDINDICES0:for(_=0;_<this._vertexCount;_++){c=n*_+l;t[_]=new E.a(r[c],r[c+1],r[c+2],r[c+3])}break;default:throw"Mesh:Unknown elementUsage."}}}_setVerticeElementData(t,e){var i=this._vertexBuffer.vertexDeclaration,a=i.getVertexElementByUsage(e);if(a){var r=this._vertexBuffer.getUint8Data(),s=this._vertexBuffer.getFloat32Data(),n=i.vertexStride,o=n/4,l=a._offset,h=l/4;switch(e){case f.a.MESH_TEXTURECOORDINATE0:case f.a.MESH_TEXTURECOORDINATE1:for(var _=0,c=t.length;_<c;_++){var d=o*_+h,u=t[_];s[d]=u.x,s[d+1]=u.y}break;case f.a.MESH_POSITION0:case f.a.MESH_NORMAL0:for(_=0,c=t.length;_<c;_++){d=o*_+h;var m=t[_];s[d]=m.x,s[d+1]=m.y,s[d+2]=m.z}break;case f.a.MESH_TANGENT0:case f.a.MESH_BLENDWEIGHT0:for(_=0,c=t.length;_<c;_++){d=o*_+h;var p=t[_];s[d]=p.x,s[d+1]=p.y,s[d+2]=p.z,s[d+3]=p.w}break;case f.a.MESH_COLOR0:for(_=0,c=t.length;_<c;_++){d=o*_+h;var g=t[_];s[d]=g.r,s[d+1]=g.g,s[d+2]=g.b,s[d+3]=g.a}break;case f.a.MESH_BLENDINDICES0:for(_=0,c=t.length;_<c;_++){d=n*_+l,p=t[_];r[d]=p.x,r[d+1]=p.y,r[d+2]=p.z,r[d+3]=p.w}break;default:throw"Mesh:Unknown elementUsage."}this._minVerticesUpdate=0,this._maxVerticesUpdate=Number.MAX_SAFE_INTEGER}else console.warn("Mesh: the mesh don't have  this VertexElement.")}_disposeResource(){for(var t=0,e=this._subMeshes.length;t<e;t++)this._subMeshes[t].destroy();this._btTriangleMesh&&n.a._bullet.btStridingMeshInterface_destroy(this._btTriangleMesh),this._vertexBuffer.destroy(),this._indexBuffer.destroy(),this._bufferState.destroy(),this._instanceBufferState.destroy(),this._setCPUMemory(0),this._setGPUMemory(0),this._bufferState=null,this._instanceBufferState=null,this._vertexBuffer=null,this._indexBuffer=null,this._subMeshes=null,this._btTriangleMesh=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null}_setSubMeshes(t){this._subMeshes=t;for(var e=0,i=t.length;e<i;e++)t[e]._indexInMesh=e}_setBuffer(t,e){var i=this._bufferState;i.bind(),i.applyVertexBuffer(t),i.applyIndexBuffer(e),i.unBind()}_setInstanceBuffer(t){var e=this._instanceBufferState;switch(e.bind(),e.applyVertexBuffer(this._vertexBuffer),e.applyInstanceVertexBuffer(u.a.instance.instanceWorldMatrixBuffer),e.applyInstanceVertexBuffer(u.a.instance.instanceMVPMatrixBuffer),t){case A.MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR:e.applyInstanceVertexBuffer(u.a.instance.instanceSimpleAnimatorBuffer)}e.applyIndexBuffer(this._indexBuffer),e.unBind()}_getPhysicMesh(){if(!this._btTriangleMesh){for(var t=n.a._bullet,e=t.btTriangleMesh_create(),i=A._nativeTempVector30,a=A._nativeTempVector31,r=A._nativeTempVector32,s=this._tempVector30,o=this._tempVector31,l=this._tempVector32,h=this._vertexBuffer,_=this._getPositionElement(h),c=h.getFloat32Data(),d=h.vertexDeclaration.vertexStride/4,u=_._offset/4,f=this._indexBuffer.getData(),m=0,p=f.length;m<p;m+=3){var g=f[m]*d+u,v=f[m+1]*d+u,T=f[m+2]*d+u;s.setValue(c[g],c[g+1],c[g+2]),o.setValue(c[v],c[v+1],c[v+2]),l.setValue(c[T],c[T+1],c[T+2]),S.a._convertToBulletVec3(s,i,!0),S.a._convertToBulletVec3(o,a,!0),S.a._convertToBulletVec3(l,r,!0),t.btTriangleMesh_addTriangle(e,i,a,r,!0)}this._btTriangleMesh=e}return this._btTriangleMesh}_uploadVerticesData(){var t=this._minVerticesUpdate,e=this._maxVerticesUpdate;if(-1!==t&&-1!==e){var i=t;this._vertexBuffer.setData(this._vertexBuffer.getUint8Data().buffer,i,i,e-t),this._minVerticesUpdate=-1,this._maxVerticesUpdate=-1}}getSubMesh(t){return this._subMeshes[t]}getPositions(t){if(!this._isReadable)throw"Mesh:can't get positions on mesh,isReadable must be true.";this._getVerticeElementData(t,f.a.MESH_POSITION0)}setPositions(t){if(!this._isReadable)throw"Mesh:setPosition() need isReadable must be true or use setVertices().";this._setVerticeElementData(t,f.a.MESH_POSITION0),this._needUpdateBounds=!0}getColors(t){if(!this._isReadable)throw"Mesh:can't get colors on mesh,isReadable must be true.";this._getVerticeElementData(t,f.a.MESH_COLOR0)}setColors(t){if(!this._isReadable)throw"Mesh:setColors() need isReadable must be true or use setVertices().";this._setVerticeElementData(t,f.a.MESH_COLOR0)}getUVs(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this._isReadable)throw"Mesh:can't get uvs on mesh,isReadable must be true.";switch(e){case 0:this._getVerticeElementData(t,f.a.MESH_TEXTURECOORDINATE0);break;case 1:this._getVerticeElementData(t,f.a.MESH_TEXTURECOORDINATE1);break;default:throw"Mesh:Invalid channel."}}setUVs(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this._isReadable)throw"Mesh:setUVs() need isReadable must be true or use setVertices().";switch(e){case 0:this._setVerticeElementData(t,f.a.MESH_TEXTURECOORDINATE0);break;case 1:this._setVerticeElementData(t,f.a.MESH_TEXTURECOORDINATE1);break;default:throw"Mesh:Invalid channel."}}getNormals(t){if(!this._isReadable)throw"Mesh:can't get colors on mesh,isReadable must be true.";this._getVerticeElementData(t,f.a.MESH_NORMAL0)}setNormals(t){if(!this._isReadable)throw"Mesh:setNormals() need must be true or use setVertices().";this._setVerticeElementData(t,f.a.MESH_NORMAL0)}getTangents(t){if(!this._isReadable)throw"Mesh:can't get colors on mesh,isReadable must be true.";this._getVerticeElementData(t,f.a.MESH_TANGENT0)}setTangents(t){if(!this._isReadable)throw"Mesh:setTangents() need isReadable must be true or use setVertices().";this._setVerticeElementData(t,f.a.MESH_TANGENT0)}getBoneWeights(t){if(!this._isReadable)throw"Mesh:can't get boneWeights on mesh,isReadable must be true.";this._getVerticeElementData(t,f.a.MESH_BLENDWEIGHT0)}setBoneWeights(t){if(!this._isReadable)throw"Mesh:setBoneWeights() need isReadable must be true or use setVertices().";this._setVerticeElementData(t,f.a.MESH_BLENDWEIGHT0)}getBoneIndices(t){if(!this._isReadable)throw"Mesh:can't get boneIndices on mesh,isReadable must be true.";this._getVerticeElementData(t,f.a.MESH_BLENDINDICES0)}setBoneIndices(t){if(!this._isReadable)throw"Mesh:setBoneIndices() need isReadable must be true or use setVertices().";this._setVerticeElementData(t,f.a.MESH_BLENDINDICES0)}markAsUnreadbale(){this._uploadVerticesData(),this._vertexBuffer.markAsUnreadbale(),this._isReadable=!1}getVertexDeclaration(){return this._vertexBuffer._vertexDeclaration}getVertices(){if(this._isReadable)return this._vertexBuffer.getUint8Data().buffer.slice(0);throw"Mesh:can't get vertices on mesh,isReadable must be true."}setVertices(t){this._vertexBuffer.setData(t),this._needUpdateBounds=!0}getIndices(){if(this._isReadable)return this._indexBuffer.getData().slice();throw"Mesh:can't get indices on subMesh,mesh's isReadable must be true."}setIndices(t){var e;t instanceof Uint32Array?e=d.a.UInt32:t instanceof Uint16Array?e=d.a.UInt16:t instanceof Uint8Array&&(e=d.a.UInt8);var i=this._indexBuffer;this._indexFormat===e&&i.indexCount===t.length||(i.destroy(),this._indexBuffer=i=new c.a(e,t.length,o.a.instance.STATIC_DRAW,this._isReadable)),i.setData(t),this._indexFormat=e}calculateBounds(){if(!this._isReadable)throw"Mesh:can't calculate bounds on subMesh,mesh's isReadable must be true.";if(this._needUpdateBounds){var t=this._tempVector30,e=this._tempVector31;t.x=t.y=t.z=Number.MAX_VALUE,e.x=e.y=e.z=-Number.MAX_VALUE;for(var i=this._vertexBuffer,a=this._getPositionElement(i),r=i.getFloat32Data(),s=i.vertexDeclaration.vertexStride/4,n=a._offset/4,o=0,l=r.length;o<l;o+=s){var h=o+n,_=r[h],c=r[h+1],d=r[h+2];t.x=Math.min(t.x,_),t.y=Math.min(t.y,c),t.z=Math.min(t.z,d),e.x=Math.max(e.x,_),e.y=Math.max(e.y,c),e.z=Math.max(e.z,d)}this._bounds.setMin(t),this._bounds.setMax(e),this._needUpdateBounds=!1}}cloneTo(t){var e=t,i=this._vertexBuffer,a=new m.a(i._byteLength,i.bufferUsage,i.canRead);a.vertexDeclaration=i.vertexDeclaration,a.setData(i.getUint8Data().slice().buffer),e._vertexBuffer=a,e._vertexCount=this._vertexCount;var r,s=this._indexBuffer,n=new c.a(d.a.UInt16,s.indexCount,s.bufferUsage,s.canRead);n.setData(s.getData().slice()),e._indexBuffer=n,e._setBuffer(e._vertexBuffer,n),e._setInstanceBuffer(this._instanceBufferStateType),e._setCPUMemory(this.cpuMemory),e._setGPUMemory(this.gpuMemory);var o=this._boneNames;if(o){var l=e._boneNames=[];for(r=0;r<o.length;r++)l[r]=o[r]}var h=this._inverseBindPoses;if(h){var _=e._inverseBindPoses=[];for(r=0;r<h.length;r++)_[r]=h[r]}var u=this._skinnedMatrixCaches.length;for(e._skinnedMatrixCaches.length=u,r=0;r<u;r++){var f=this._skinnedMatrixCaches[r];e._skinnedMatrixCaches[r]=new x(f.subMeshIndex,f.batchIndex,f.batchBoneIndex)}for(r=0;r<this.subMeshCount;r++){var p=this._subMeshes[r],g=p._subIndexBufferStart,v=p._subIndexBufferCount,T=p._boneIndicesList,E=new R.a(e);E._subIndexBufferStart.length=g.length,E._subIndexBufferCount.length=v.length,E._boneIndicesList.length=T.length;for(var S=0;S<g.length;S++)E._subIndexBufferStart[S]=g[S];for(S=0;S<v.length;S++)E._subIndexBufferCount[S]=v[S];for(S=0;S<T.length;S++)E._boneIndicesList[S]=new Uint16Array(T[S]);E._indexBuffer=n,E._indexStart=p._indexStart,E._indexCount=p._indexCount,E._indices=new Uint16Array(n.getData().buffer,2*p._indexStart,p._indexCount);var A=e._vertexBuffer;E._vertexBuffer=A,e._subMeshes.push(E)}e._setSubMeshes(e._subMeshes)}clone(){var t=new A;return this.cloneTo(t),t}}e.a=A,r()(A,"MESH","MESH"),r()(A,"MESH_INSTANCEBUFFER_TYPE_NORMAL",0),r()(A,"MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR",1),r()(A,"_nativeTempVector30",void 0),r()(A,"_nativeTempVector31",void 0),r()(A,"_nativeTempVector32",void 0)},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(42),n=i(2),o=i(46),l=i(10),h=i(91),_=i(66),c=i(3),d=i(47);class u extends o.a{static get currentActive(){return u._currentActive}get depthStencilFormat(){return this._depthStencilFormat}get defaulteTexture(){return s.a.grayTexture}getIsReady(){return!0}get sourceWidth(){return this._width}get sourceHeight(){return this._height}get offsetX(){return 0}get offsetY(){return 0}constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.b.R8G8B8,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:d.a.DEPTH_16;super(i,!1),r()(this,"_lastRT",void 0),r()(this,"_lastWidth",void 0),r()(this,"_lastHeight",void 0),r()(this,"_frameBuffer",void 0),r()(this,"_depthStencilBuffer",void 0),r()(this,"_depthStencilFormat",void 0),r()(this,"_mgrKey",0),this._glTextureType=n.a.instance.TEXTURE_2D,this._width=t,this._height=e,this._depthStencilFormat=a,this._create(t,e),this.lock=!0}_create(t,e){var i=n.a.instance;this._frameBuffer=i.createFramebuffer(),l.a.bindTexture(i,this._glTextureType,this._glTexture);var a=this._getGLFormat();if(i.texImage2D(this._glTextureType,0,a,t,e,0,a,i.UNSIGNED_BYTE,null),this._setGPUMemory(t*e*4),i.bindFramebuffer(i.FRAMEBUFFER,this._frameBuffer),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this._glTexture,0),this._depthStencilFormat!==d.a.DEPTHSTENCIL_NONE)switch(this._depthStencilBuffer=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,this._depthStencilBuffer),this._depthStencilFormat){case d.a.DEPTH_16:i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,t,e),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,this._depthStencilBuffer);break;case d.a.STENCIL_8:i.renderbufferStorage(i.RENDERBUFFER,i.STENCIL_INDEX8,t,e),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.STENCIL_ATTACHMENT,i.RENDERBUFFER,this._depthStencilBuffer);break;case d.a.DEPTHSTENCIL_24_8:i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,e),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,this._depthStencilBuffer)}i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindRenderbuffer(i.RENDERBUFFER,null),this._setWarpMode(i.TEXTURE_WRAP_S,this._wrapModeU),this._setWarpMode(i.TEXTURE_WRAP_T,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._readyed=!0,this._activeResource()}generateMipmap(){this._isPot(this.width)&&this._isPot(this.height)?(this._mipmap=!0,n.a.instance.generateMipmap(this._glTextureType),this._setFilterMode(this._filterMode),this._setGPUMemory(this.width*this.height*4*(1+1/3))):(this._mipmap=!1,this._setGPUMemory(this.width*this.height*4))}static pushRT(){u.rtStack.push({rt:u._currentActive,w:_.a.width,h:_.a.height})}static popRT(){var t=n.a.instance,e=u.rtStack.pop();e&&(u._currentActive!=e.rt&&(n.a.instance.bindFramebuffer(t.FRAMEBUFFER,e.rt?e.rt._frameBuffer:null),u._currentActive=e.rt),t.viewport(0,0,e.w,e.h),_.a.width=e.w,_.a.height=e.h)}start(){var t=n.a.instance;n.a.instance.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),this._lastRT=u._currentActive,u._currentActive=this,this._readyed=!0,t.viewport(0,0,this._width,this._height),this._lastWidth=_.a.width,this._lastHeight=_.a.height,_.a.width=this._width,_.a.height=this._height,h.a.activeShader=null}end(){var t=n.a.instance;t.bindFramebuffer(t.FRAMEBUFFER,null),u._currentActive=null,this._readyed=!0}restore(){var t=n.a.instance;this._lastRT!=u._currentActive&&(n.a.instance.bindFramebuffer(t.FRAMEBUFFER,this._lastRT?this._lastRT._frameBuffer:null),u._currentActive=this._lastRT),this._readyed=!0,t.viewport(0,0,this._lastWidth,this._lastHeight),_.a.width=this._lastWidth,_.a.height=this._lastHeight,h.a.activeShader=null}clear(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;var r=n.a.instance;r.clearColor(t,e,i,a);var s=r.COLOR_BUFFER_BIT;switch(this._depthStencilFormat){case r.DEPTH_COMPONENT16:s|=r.DEPTH_BUFFER_BIT;break;case r.STENCIL_INDEX8:s|=r.STENCIL_BUFFER_BIT;break;case r.DEPTH_STENCIL:s|=r.DEPTH_BUFFER_BIT,s|=r.STENCIL_BUFFER_BIT}r.clear(s)}getData(t,e,i,a){if(c.a.Render.isConchApp&&2==window.conchConfig.threadMode)throw"native 2 thread mode use getDataAsync";var r=n.a.instance;if(r.bindFramebuffer(r.FRAMEBUFFER,this._frameBuffer),!(r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE))return r.bindFramebuffer(r.FRAMEBUFFER,null),null;var s=new Uint8Array(this._width*this._height*4),o=this._getGLFormat();return r.readPixels(t,e,i,a,o,r.UNSIGNED_BYTE,s),r.bindFramebuffer(r.FRAMEBUFFER,null),s}getDataAsync(t,e,i,a,r){var s=n.a.instance;s.bindFramebuffer(s.FRAMEBUFFER,this._frameBuffer),s.readPixelsAsync(t,e,i,a,s.RGBA,s.UNSIGNED_BYTE,function(t){r(new Uint8Array(t))}),s.bindFramebuffer(s.FRAMEBUFFER,null)}recycle(){}_disposeResource(){if(this._frameBuffer){var t=n.a.instance;t.deleteTexture(this._glTexture),t.deleteFramebuffer(this._frameBuffer),t.deleteRenderbuffer(this._depthStencilBuffer),this._glTexture=null,this._frameBuffer=null,this._depthStencilBuffer=null,this._setGPUMemory(0)}}}e.a=u,r()(u,"_currentActive",void 0),r()(u,"rtStack",[]),r()(u,"defuv",[0,0,1,0,1,1,0,1]),r()(u,"flipyuv",[0,1,1,1,1,0,0,0])},function(t,e,i){var a=i(110),r=Math.min;t.exports=function(t){return t>0?r(a(t),9007199254740991):0}},function(t,e){var i=Math.ceil,a=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?a:i)(t)}},function(t,e,i){"use strict";var a=i(311),r=RegExp.prototype.exec;t.exports=function(t,e){var i=t.exec;if("function"==typeof i){var s=i.call(t,e);if("object"!=typeof s)throw new TypeError("RegExp exec method returned something other than an Object or null");return s}if("RegExp"!==a(t))throw new TypeError("RegExp#exec called on incompatible receiver");return r.call(t,e)}},function(t,e,i){"use strict";i(312);var a=i(78),r=i(65),s=i(59),n=i(107),o=i(35),l=i(152),h=o("species"),_=!s(function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}),c=function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var i="ab".split(t);return 2===i.length&&"a"===i[0]&&"b"===i[1]}();t.exports=function(t,e,i){var d=o(t),u=!s(function(){var e={};return e[d]=function(){return 7},7!=""[t](e)}),f=u?!s(function(){var e=!1,i=/a/;return i.exec=function(){return e=!0,null},"split"===t&&(i.constructor={},i.constructor[h]=function(){return i}),i[d](""),!e}):void 0;if(!u||!f||"replace"===t&&!_||"split"===t&&!c){var m=/./[d],p=i(n,d,""[t],function(t,e,i,a,r){return e.exec===l?u&&!r?{done:!0,value:m.call(e,i,a)}:{done:!0,value:t.call(i,e,a)}:{done:!1}}),g=p[0],v=p[1];a(String.prototype,t,g),r(RegExp.prototype,d,2==e?function(t,e){return v.call(t,this,e)}:function(t){return v.call(t,this)})}}},function(t,e,i){"use strict";var a=i(34);t.exports=function(){var t=a(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{static __init__(){for(var t=0;t<256;++t){var e=t-127;e<-27?(s._baseTable[0|t]=0,s._baseTable[256|t]=32768,s._shiftTable[0|t]=24,s._shiftTable[256|t]=24):e<-14?(s._baseTable[0|t]=1024>>-e-14,s._baseTable[256|t]=1024>>-e-14|32768,s._shiftTable[0|t]=-e-1,s._shiftTable[256|t]=-e-1):e<=15?(s._baseTable[0|t]=e+15<<10,s._baseTable[256|t]=e+15<<10|32768,s._shiftTable[0|t]=13,s._shiftTable[256|t]=13):e<128?(s._baseTable[0|t]=31744,s._baseTable[256|t]=64512,s._shiftTable[0|t]=24,s._shiftTable[256|t]=24):(s._baseTable[0|t]=31744,s._baseTable[256|t]=64512,s._shiftTable[0|t]=13,s._shiftTable[256|t]=13)}for(s._mantissaTable[0]=0,t=1;t<1024;++t){var i=t<<13;for(e=0;0==(8388608&i);)e-=8388608,i<<=1;i&=-8388609,e+=947912704,s._mantissaTable[t]=i|e}for(t=1024;t<2048;++t)s._mantissaTable[t]=939524096+(t-1024<<13);for(s._exponentTable[0]=0,t=1;t<31;++t)s._exponentTable[t]=t<<23;for(s._exponentTable[31]=1199570944,s._exponentTable[32]=2147483648,t=33;t<63;++t)s._exponentTable[t]=2147483648+(t-32<<23);for(s._exponentTable[63]=3347054592,s._offsetTable[0]=0,t=1;t<64;++t)s._offsetTable[t]=32===t?0:1024}static roundToFloat16Bits(t){s._floatView[0]=t;var e=s._uint32View[0],i=e>>23&511;return s._baseTable[i]+((8388607&e)>>s._shiftTable[i])}static convertToNumber(t){var e=t>>10;return s._uint32View[0]=s._mantissaTable[s._offsetTable[e]+(1023&t)]+s._exponentTable[e],s._floatView[0]}}e.a=s,r()(s,"_buffer",new ArrayBuffer(4)),r()(s,"_floatView",new Float32Array(s._buffer)),r()(s,"_uint32View",new Uint32Array(s._buffer)),r()(s,"_baseTable",new Uint32Array(512)),r()(s,"_shiftTable",new Uint32Array(512)),r()(s,"_mantissaTable",new Uint32Array(2048)),r()(s,"_exponentTable",new Uint32Array(64)),r()(s,"_offsetTable",new Uint32Array(64))},function(t,e,i){"use strict";var a=i(34),r=i(109),s=i(150),n=i(111);i(112)("match",1,function(t,e,i,o){return[function(i){var a=t(this),r=void 0==i?void 0:i[e];return void 0!==r?r.call(i,a):new RegExp(i)[e](String(a))},function(t){var e=o(i,t,this);if(e.done)return e.value;var l=a(t),h=String(this);if(!l.global)return n(l,h);var _=l.unicode;l.lastIndex=0;for(var c,d=[],u=0;null!==(c=n(l,h));){var f=String(c[0]);d[u]=f,""===f&&(l.lastIndex=s(h,r(l.lastIndex),_)),u++}return 0===u?null:d}]})},function(t,e,i){var a=i(44),r=i(317),s=i(76).f,n=i(322).f,o=i(211),l=i(113),h=a.RegExp,_=h,c=h.prototype,d=/a/g,u=/a/g,f=new h(d)!==d;if(i(45)&&(!f||i(59)(function(){return u[i(35)("match")]=!1,h(d)!=d||h(u)==u||"/a/i"!=h(d,"i")}))){h=function(t,e){var i=this instanceof h,a=o(t),s=void 0===e;return!i&&a&&t.constructor===h&&s?t:r(f?new _(a&&!s?t.source:t,e):_((a=t instanceof h)?t.source:t,a&&s?l.call(t):e),i?this:c,h)};for(var m=function(t){t in h||s(h,t,{configurable:!0,get:function(){return _[t]},set:function(e){_[t]=e}})},p=n(_),g=0;p.length>g;)m(p[g++]);c.constructor=h,h.prototype=c,i(78)(a,"RegExp",h)}i(325)("RegExp")},function(t,e,i){var a=i(321),r=i(107);t.exports=function(t){return a(r(t))}},function(t,e,i){"use strict";i(214);var a=i(34),r=i(113),s=i(45),n=/./.toString,o=function(t){i(78)(RegExp.prototype,"toString",t,!0)};i(59)(function(){return"/a/b"!=n.call({source:"a",flags:"b"})})?o(function(){var t=a(this);return"/".concat(t.source,"/","flags"in t?t.flags:!s&&t instanceof RegExp?r.call(t):void 0)}):"toString"!=n.name&&o(function(){return n.call(this)})},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(333),o=i(69),l=i(225),h=i(226);class _{constructor(t,e,i){r()(this,"_stride",0),r()(this,"vertNum",0),r()(this,"indexNum",0),r()(this,"_applied",!1),r()(this,"_vb",void 0),r()(this,"_ib",void 0),r()(this,"_vao",void 0),r()(this,"_attribInfo",void 0),r()(this,"_quadNum",0),r()(this,"canReuse",!1),this._stride=t,this._vb=new h.a(t,s.a.instance.DYNAMIC_DRAW),e?this._vb._resizeBuffer(e,!1):o.a.webGL2D_MeshAllocMaxMem&&this._vb._resizeBuffer(65536*t,!1),this._ib=new l.a,i&&this._ib._resizeBuffer(i,!1)}cloneWithNewVB(){var t=new _(this._stride,0,0);return t._ib=this._ib,t._quadNum=this._quadNum,t._attribInfo=this._attribInfo,t}cloneWithNewVBIB(){var t=new _(this._stride,0,0);return t._attribInfo=this._attribInfo,t}getVBW(){return this._vb.setNeedUpload(),this._vb}getVBR(){return this._vb}getIBR(){return this._ib}getIBW(){return this._ib.setNeedUpload(),this._ib}createQuadIB(t){this._quadNum=t,this._ib._resizeBuffer(6*t*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var e=this._ib.getUint16Array(),i=0,a=0,r=0;r<t;r++)e[i++]=a,e[i++]=a+2,e[i++]=a+1,e[i++]=a,e[i++]=a+3,e[i++]=a+2,a+=4;this._ib.setNeedUpload()}setAttributes(t){if(this._attribInfo=t,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"}configVAO(t){if(!this._applied){this._applied=!0,this._vao||(this._vao=new n.a),this._vao.bind(),this._vb._bindForVAO(),this._ib.setNeedUpload(),this._ib._bind_uploadForVAO();for(var e=this._attribInfo.length/3,i=0,a=0;a<e;a++){var r=this._attribInfo[i+1],s=this._attribInfo[i],o=this._attribInfo[i+2];t.enableVertexAttribArray(a),t.vertexAttribPointer(a,r,s,!1,this._stride,o),i+=3}this._vao.unBind()}}useMesh(t){this._applied||this.configVAO(t),this._vao.bind(),this._vb.bind(),this._ib._bind_upload()||this._ib.bind(),this._vb._bind_upload()||this._vb.bind()}getEleNum(){return this._ib.getBuffer().byteLength/2}releaseMesh(){}destroy(){}clearVB(){this._vb.clear()}}e.a=_,r()(_,"_gvaoid",0)},function(t,e,i){"use strict";var a=i(18),r=(i.n(a),i(28)),s=(i.n(r),i(0)),n=i.n(s),o=i(70),l=i(84),h=i(361),_=i(6),c=i(16),d=i(26),u=i(161),f=i(3),m=i(30);class p extends o.a{static defaultFontStr(){return p.defaultFontSize+"px "+p.defaultFont}constructor(){super(),n()(this,"_clipPoint",void 0),n()(this,"_text",void 0),n()(this,"_isChanged",void 0),n()(this,"_textWidth",0),n()(this,"_textHeight",0),n()(this,"_lines",[]),n()(this,"_lineWidths",[]),n()(this,"_startX",0),n()(this,"_startY",0),n()(this,"_words",void 0),n()(this,"_charSize",{}),n()(this,"_valign","top"),n()(this,"_fontSize",p.defaultFontSize),n()(this,"_font",p.defaultFont),n()(this,"_color","#000000"),n()(this,"_singleCharRender",!1),n()(this,"overflow",p.VISIBLE),this._style=h.a.EMPTY}getStyle(){return this._style===h.a.EMPTY&&(this._style=h.a.create()),this._style}_getTextStyle(){return this._style===h.a.EMPTY&&(this._style=h.a.create()),this._style}static registerBitmapFont(t,e){p._bitmapFonts||(p._bitmapFonts={}),p._bitmapFonts[t]=e}static unregisterBitmapFont(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(p._bitmapFonts&&p._bitmapFonts[t]){var i=p._bitmapFonts[t];e&&i.destroy(),delete p._bitmapFonts[t]}}destroy(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];super.destroy(t),this._clipPoint=null,this._lines=null,this._lineWidths=null,this._words&&this._words.forEach(function(t){t.cleanCache()}),this._words=null,this._charSize=null}_getBoundPointsM(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t=d.a.TEMP;return t.setTo(0,0,this.width,this.height),t._getBoundPoints()}getGraphicBounds(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t=d.a.TEMP;return t.setTo(0,0,this.width,this.height),t}get width(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]}set width(t){t!=this._width&&(super.set_width(t),this.isChanged=!0,this.borderColor&&this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1))}_getCSSStyle(){return this._style}get height(){return this._height?this._height:this.textHeight}set height(t){t!=this._height&&(super.set_height(t),this.isChanged=!0,this.borderColor&&this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1))}get textWidth(){return this._isChanged&&f.a.systemTimer.runCallLater(this,this.typeset),this._textWidth}get textHeight(){return this._isChanged&&f.a.systemTimer.runCallLater(this,this.typeset),this._textHeight}get text(){return this._text||""}get_text(){return this._text||""}set_text(t){this._text!==t&&(this.lang(t+""),this.isChanged=!0,this.event(_.a.CHANGE),this.borderColor&&this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1))}set text(t){this.set_text(t)}lang(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]&&arguments[7],arguments.length>8&&void 0!==arguments[8]&&arguments[8],arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10];if(t=p.langPacks&&p.langPacks[t]?p.langPacks[t]:t,arguments.length<2)this._text=t;else{for(var e=0,i=arguments.length;e<i;e++)t=t.replace("{"+e+"}",arguments[e+1]);this._text=t}}get font(){return this._font}set font(t){this._style.currBitmapFont&&(this._getTextStyle().currBitmapFont=null,this.scale(1,1)),p._bitmapFonts&&p._bitmapFonts[t]&&(this._getTextStyle().currBitmapFont=p._bitmapFonts[t]),this._font=t,this.isChanged=!0}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!=t&&(this._fontSize=t,this.isChanged=!0)}get bold(){return this._style.bold}set bold(t){this._getTextStyle().bold=t,this.isChanged=!0}get color(){return this._color}set color(t){this.set_color(t)}get_color(){return this._color}set_color(t){this._color!=t&&(this._color=t,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}get italic(){return this._style.italic}set italic(t){this._getTextStyle().italic=t,this.isChanged=!0}get align(){return this._style.align}set align(t){this._getTextStyle().align=t,this.isChanged=!0}get valign(){return this._valign}set valign(t){this._valign=t,this.isChanged=!0}get wordWrap(){return this._style.wordWrap}set wordWrap(t){this._getTextStyle().wordWrap=t,this.isChanged=!0}get leading(){return this._style.leading}set leading(t){this._getTextStyle().leading=t,this.isChanged=!0}get padding(){return this._style.padding}set padding(t){if("string"==typeof t){var e,i,a;for(a=(e=t.split(",")).length;e.length<4;)e.push(0);for(i=0;i<a;i++)e[i]=parseFloat(e[i])||0;t=e}this._getTextStyle().padding=t,this.isChanged=!0}get bgColor(){return this._style.bgColor}set bgColor(t){this.set_bgColor(t)}set_bgColor(t){this._getTextStyle().bgColor=t,this._renderType|=l.a.STYLE,this._setBgStyleColor(0,0,this.width,this.height,t),this._setRenderType(this._renderType),this.isChanged=!0}get_bgColor(){return this._style.bgColor}get borderColor(){return this._style.borderColor}set borderColor(t){this._getTextStyle().borderColor=t,this._renderType|=l.a.STYLE,this._setBorderStyleColor(0,0,this.width,this.height,t,1),this._setRenderType(this._renderType),this.isChanged=!0}get stroke(){return this._style.stroke}set stroke(t){this._getTextStyle().stroke=t,this.isChanged=!0}get strokeColor(){return this._style.strokeColor}set strokeColor(t){this._getTextStyle().strokeColor=t,this.isChanged=!0}set isChanged(t){this._isChanged!==t&&(this._isChanged=t,t&&f.a.systemTimer.callLater(this,this.typeset))}_getContextFont(){return(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(f.a.Browser.onIPhone&&p.fontFamilyMap[this.font]||this.font)}_isPassWordMode(){var t=this._style.asPassword;return"prompt"in this&&this.prompt==this._text&&(t=!1),t}_getPassWordTxt(t){var e,i=t.length;e="";for(var a=i;a>0;a--)e+="●";return e}_renderText(){var t=this.padding,e=this._lines.length;this.overflow!=p.VISIBLE&&(e=Math.min(e,Math.floor((this.height-t[0]-t[2])/(this.leading+this._charSize.height))+1));var i=this.scrollY/(this._charSize.height+this.leading)|0,a=this.graphics;a.clear(!0);var r=this._getContextFont();f.a.Browser.context.font=r;var s=t[3],n="left",o=this._lines,l=this.leading+this._charSize.height,h=this._style.currBitmapFont;h&&(l=this.leading+h.getMaxHeight());var _=t[0];if(!h&&this._width>0&&this._textWidth<=this._width&&("right"==this.align?(n="right",s=this._width-t[1]):"center"==this.align&&(n="center",s=.5*this._width+t[3]-t[1])),this._height>0){var c=this._textHeight>this._height?"top":this.valign;"middle"===c?_=.5*(this._height-e*l)+t[0]-t[2]:"bottom"===c&&(_=this._height-e*l-t[2])}var d=this._style;if(h&&h.autoScaleSize)var m=h.fontSize/this.fontSize;if(this._clipPoint){var g,v;if(a.save(),h&&h.autoScaleSize)g=this._width?this._width-t[3]-t[1]:this._textWidth,v=this._height?this._height-t[0]-t[2]:this._textHeight,g*=m,v*=m,a.clipRect(t[3],t[0],g,v);else a.clipRect(t[3],t[0],this._width?this._width-t[3]-t[1]:this._textWidth,this._height?this._height-t[0]-t[2]:this._textHeight);this.repaint()}var T=d.asPassword;"prompt"in this&&this.prompt==this._text&&(T=!1);for(var E=0,S=0,R=Math.min(this._lines.length,e+i)||1,x=i;x<R;x++){var A,y=o[x];if(T){var I=y.length;y="";for(var C=I;C>0;C--)y+="●"}if(null==y&&(y=""),E=s-(this._clipPoint?this._clipPoint.x:0),S=_+l*x-(this._clipPoint?this._clipPoint.y:0),this.underline&&this._drawUnderline(n,E,S,x),h){var M=this.width;h.autoScaleSize&&(M=this.width*m),h._drawText(y,this,E,S,this.align,M)}else this._words||(this._words=[]),this._words.length>x-i?A=this._words[x-i]:(A=new u.a,this._words.push(A)),A.setText(y),A.splitRender=this._singleCharRender,d.stroke?a.fillBorderText(A,E,S,r,this.color,n,d.stroke,d.strokeColor):a.fillText(A,E,S,r,this.color,n)}if(h&&h.autoScaleSize){var D=1/m;this.scale(D,D)}this._clipPoint&&a.restore(),this._startX=s,this._startY=_}_drawUnderline(t,e,i,a){var r=this._lineWidths[a];switch(t){case"center":e-=r/2;break;case"right":e-=r}i+=this._charSize.height,this._graphics.drawLine(e,i,e+r,i,this.underlineColor||this.color,1)}typeset(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);f.a.Render.isConchApp?window.conchTextCanvas.font=this._getContextFont():f.a.Browser.context.font=this._getContextFont(),this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this._parseLines(this._getPassWordTxt(this._text)):this._parseLines(this._text),this._evalTextSize(),this._checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new c.a(0,0)):this._clipPoint=null,this._renderText()}_evalTextSize(){var t,e;t=Math.max.apply(this,this._lineWidths),this._style.currBitmapFont?e=this._lines.length*(this._style.currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:(e=this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],this._lines.length&&(e-=this.leading)),t==this._textWidth&&e==this._textHeight||(this._textWidth=t,this._textHeight=e)}_checkEnabledViewportOrNot(){return this.overflow==p.SCROLL&&(this._width>0&&this._textWidth>this._width||this._height>0&&this._textHeight>this._height)}changeText(t){this._text!==t&&(this.lang(t+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())}_parseLines(t){var e=this.wordWrap||this.overflow==p.HIDDEN;if(e)var i=this._getWordWrapWidth();var a=this._style.currBitmapFont;if(a)this._charSize.width=a.getMaxWidth(),this._charSize.height=a.getMaxHeight();else{var r=null;(r=f.a.Render.isConchApp?window.conchTextCanvas.measureText(p._testWord):f.a.Browser.context.measureText(p._testWord))||(r={width:100}),this._charSize.width=r.width,this._charSize.height=r.height||this.fontSize}for(var s=t.replace(/\r\n/g,"\n").split("\n"),n=0,o=s.length;n<o;n++){var l=s[n];e?this._parseLine(l,i):(this._lineWidths.push(this._getTextWidth(l)),this._lines.push(l))}}_parseLine(t,e){var i=this._lines,a=0,r=0,s=0,n=0;if((r=this._getTextWidth(t))<=e)return i.push(t),void this._lineWidths.push(r);r=this._charSize.width,0==(a=Math.floor(e/r))&&(a=1),s=r=this._getTextWidth(t.substring(0,a));for(var o=a,l=t.length;o<l;o++)if((s+=r=this._getTextWidth(t.charAt(o)))>e)if(this.wordWrap){var h=t.substring(n,o);if(h.charCodeAt(h.length-1)<255){var _=/(?:\w|-)+$/.exec(h);_&&(o=_.index+n,0==_.index?o+=h.length:h=t.substring(n,o))}if(i.push(h),this._lineWidths.push(s-r),n=o,!(o+a<l)){i.push(t.substring(n,l)),this._lineWidths.push(this._getTextWidth(i[i.length-1])),n=-1;break}o+=a,s=r=this._getTextWidth(t.substring(n,o)),o--}else if(this.overflow==p.HIDDEN)return i.push(t.substring(0,o)),void this._lineWidths.push(this._getTextWidth(i[i.length-1]));this.wordWrap&&-1!=n&&(i.push(t.substring(n,l)),this._lineWidths.push(this._getTextWidth(i[i.length-1])))}_getTextWidth(t){var e=this._style.currBitmapFont;if(e)return e.getTextWidth(t);if(f.a.Render.isConchApp)return window.conchTextCanvas.measureText(t).width;return(f.a.Browser.context.measureText(t)||{width:100}).width}_getWordWrapWidth(){var t,e=this.padding,i=this._style.currBitmapFont;return(t=i&&i.autoScaleSize?this._width*(i.fontSize/this.fontSize):this._width)<=0&&(t=this.wordWrap?100:f.a.Browser.width),t<=0&&(t=100),t-e[3]-e[1]}getCharPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._isChanged&&f.a.systemTimer.runCallLater(this,this.typeset);for(var i=0,a=this._lines,r=0,s=0,n=a.length;s<n;s++){if(t<(i+=a[s].length)){var o=s;break}r=i}var l=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;f.a.Browser.context.font=l;var h=this._getTextWidth(this._text.substring(r,t));return(e||new c.a).setTo(this._startX+h-(this._clipPoint?this._clipPoint.x:0),this._startY+o*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))}set scrollX(t){if(!(this.overflow!=p.SCROLL||this.textWidth<this._width)&&this._clipPoint){t=t<this.padding[3]?this.padding[3]:t;var e=this._textWidth-this._width;t=t>e?e:t,this._clipPoint.x=t,this._renderText()}}get scrollX(){return this._clipPoint?this._clipPoint.x:0}set scrollY(t){if(!(this.overflow!=p.SCROLL||this.textHeight<this._height)&&this._clipPoint){t=t<this.padding[0]?this.padding[0]:t;var e=this._textHeight-this._height;t=t>e?e:t,this._clipPoint.y=t,this._renderText()}}get scrollY(){return this._clipPoint?this._clipPoint.y:0}get maxScrollX(){return this.textWidth<this._width?0:this._textWidth-this._width}get maxScrollY(){return this.textHeight<this._height?0:this._textHeight-this._height}get lines(){return this._isChanged&&this.typeset(),this._lines}get underlineColor(){return this._style.underlineColor}set underlineColor(t){this._getTextStyle().underlineColor=t,this._isChanged||this._renderText()}get underline(){return this._style.underline}set underline(t){this._getTextStyle().underline=t}set singleCharRender(t){this._singleCharRender=t}get singleCharRender(){return this._singleCharRender}}e.a=p,n()(p,"VISIBLE","visible"),n()(p,"SCROLL","scroll"),n()(p,"HIDDEN","hidden"),n()(p,"defaultFontSize",12),n()(p,"defaultFont","Arial"),n()(p,"langPacks",void 0),n()(p,"isComplexText",!1),n()(p,"fontFamilyMap",{"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}),n()(p,"_testWord","游"),n()(p,"_bitmapFonts",void 0),n()(p,"CharacterCache",!0),n()(p,"RightToLeft",!1),f.a.regClass(p),m.a.regClass("laya.display.Text",p),m.a.regClass("Laya.Text",p)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(149),n=i(48),o=i(42),l=i(3),h=i(19);e.a=class extends s.a{get source(){return this._source}_getSource(){return this._source}constructor(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super(),r()(this,"_ctx",void 0),r()(this,"_source",void 0),r()(this,"_texture",void 0),this._source=t?h.a.createElement("canvas"):this,this.lock=!0}clear(){this._ctx&&(this._ctx.clear?this._ctx.clear():this._ctx.clearRect(0,0,this._width,this._height)),this._texture&&(this._texture.destroy(),this._texture=null)}destroy(){super.destroy(),this._setCPUMemory(0),this._ctx&&this._ctx.destroy&&this._ctx.destroy(),this._ctx=null}release(){}get context(){return this._ctx?this._ctx:(this._source==this?this._ctx=new l.a.Context:this._ctx=this._source.getContext(l.a.Render.isConchApp?"layagl":"2d"),this._ctx._canvas=this,this._ctx)}_setContext(t){this._ctx=t}getContext(t){return arguments.length>1&&void 0!==arguments[1]&&arguments[1],this.context}getMemSize(){return 0}size(t,e){(this._width!=t||this._height!=e||this._source&&(this._source.width!=t||this._source.height!=e))&&(this._width=t,this._height=e,this._setCPUMemory(t*e*4),this._ctx&&this._ctx.size&&this._ctx.size(t,e),this._source&&(this._source.height=e,this._source.width=t),this._texture&&(this._texture.destroy(),this._texture=null))}getTexture(){if(!this._texture){var t=new o.a;t.loadImageSource(this.source),this._texture=new n.a(t)}return this._texture}toBase64(t,e){if(this._source){if(l.a.Render.isConchApp){var i=window;if(2==i.conchConfig.threadMode)throw"native 2 thread mode use toBase64Async";var a=this._ctx._targets.sourceWidth,r=this._ctx._targets.sourceHeight,s=this._ctx._targets.getData(0,0,a,r);return i.conchToBase64FlipY?i.conchToBase64FlipY(t,e,s.buffer,a,r):i.conchToBase64(t,e,s.buffer,a,r)}return this._source.toDataURL(t,e)}return null}toBase64Async(t,e,i){var a=this._ctx._targets.sourceWidth,r=this._ctx._targets.sourceHeight;this._ctx._targets.getDataAsync(0,0,a,r,function(s){let n=window;var o=n.conchToBase64FlipY?n.conchToBase64FlipY(t,e,s.buffer,a,r):n.conchToBase64(t,e,s.buffer,a,r);i(o)})}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(71),n=i(6),o=i(23),l=i(4),h=i(8),_=i(3),c=i(30);class d extends o.a{constructor(){super(),r()(this,"_bits",0),r()(this,"_children",d.ARRAY_EMPTY),r()(this,"_extUIChild",d.ARRAY_EMPTY),r()(this,"_parent",null),r()(this,"name",""),r()(this,"destroyed",!1),r()(this,"_conchData",void 0),r()(this,"_components",void 0),r()(this,"_activeChangeScripts",void 0),r()(this,"_scene",void 0),this.createGLBuffer()}createGLBuffer(){}_setBit(t,e){t===s.a.DISPLAY&&(this._getBit(t)!=e&&this._updateDisplayedInstage());e?this._bits|=t:this._bits&=~t}_getBit(t){return 0!=(this._bits&t)}_setUpNoticeChain(){this._getBit(s.a.DISPLAY)&&this._setBitUp(s.a.DISPLAY)}_setBitUp(t){var e=this;for(e._setBit(t,!0),e=e._parent;e;){if(e._getBit(t))return;e._setBit(t,!0),e=e._parent}}on(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return t!==n.a.DISPLAY&&t!==n.a.UNDISPLAY||this._getBit(s.a.DISPLAY)||this._setBitUp(s.a.DISPLAY),this._createListener(t,e,i,a,!1)}once(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return t!==n.a.DISPLAY&&t!==n.a.UNDISPLAY||this._getBit(s.a.DISPLAY)||this._setBitUp(s.a.DISPLAY),this._createListener(t,e,i,a,!0)}destroy(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.destroyed=!0,this._destroyAllComponent(),this._parent&&this._parent.removeChild(this),this._children&&(t?this.destroyChildren():this.removeChildren()),this.onDestroy(),this._children=null,this.offAll()}onDestroy(){}destroyChildren(){if(this._children)for(var t=0,e=this._children.length;t<e;t++)this._children[0].destroy(!0)}addChild(t){if(!t||this.destroyed||t===this)return t;if(t._zOrder&&this._setBit(s.a.HAS_ZORDER,!0),t._parent===this){var e=this.getChildIndex(t);e!==this._children.length-1&&(this._children.splice(e,1),this._children.push(t),this._childChanged())}else t._parent&&t._parent.removeChild(t),this._children===d.ARRAY_EMPTY&&(this._children=[]),this._children.push(t),t._setParent(this),this._childChanged();return t}addInputChild(t){if(this._extUIChild==d.ARRAY_EMPTY)this._extUIChild=[t];else{if(this._extUIChild.indexOf(t)>=0)return null;this._extUIChild.push(t)}return null}removeInputChild(t){var e=this._extUIChild.indexOf(t);e>=0&&this._extUIChild.splice(e,1)}addChildren(){for(var t=0,e=arguments.length;t<e;){var i;this.addChild((i=t++)<0||arguments.length<=i?void 0:arguments[i])}}addChildAt(t,e){if(!t||this.destroyed||t===this)return t;if(t._zOrder&&this._setBit(s.a.HAS_ZORDER,!0),e>=0&&e<=this._children.length){if(t._parent===this){var i=this.getChildIndex(t);this._children.splice(i,1),this._children.splice(e,0,t),this._childChanged()}else t._parent&&t._parent.removeChild(t),this._children===d.ARRAY_EMPTY&&(this._children=[]),this._children.splice(e,0,t),t._setParent(this);return t}throw new Error("appendChildAt:The index is out of bounds")}getChildIndex(t){return this._children.indexOf(t)}getChildByName(t){var e=this._children;if(e)for(var i=0,a=e.length;i<a;i++){var r=e[i];if(r.name===t)return r}return null}getChildAt(t){return this._children[t]||null}setChildIndex(t,e){var i=this._children;if(e<0||e>=i.length)throw new Error("setChildIndex:The index is out of bounds.");var a=this.getChildIndex(t);if(a<0)throw new Error("setChildIndex:node is must child of this object.");return i.splice(a,1),i.splice(e,0,t),this._childChanged(),t}_childChanged(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]}removeChild(t){if(!this._children)return t;var e=this._children.indexOf(t);return this.removeChildAt(e)}removeSelf(){return this._parent&&this._parent.removeChild(this),this}removeChildByName(t){var e=this.getChildByName(t);return e&&this.removeChild(e),e}removeChildAt(t){var e=this.getChildAt(t);return e&&(this._children.splice(t,1),e._setParent(null)),e}removeChildren(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2147483647;if(this._children&&this._children.length>0){var i=this._children;if(0===t&&e>=i.length-1){var a=i;this._children=d.ARRAY_EMPTY}else a=i.splice(t,e-t);for(var r=0,s=a.length;r<s;r++)a[r]._setParent(null)}return this}replaceChild(t,e){var i=this._children.indexOf(e);return i>-1?(this._children.splice(i,1,t),e._setParent(null),t._setParent(this),t):null}get numChildren(){return this._children.length}get parent(){return this._parent}_setParent(t){this._parent!==t&&(t?(this._parent=t,this._onAdded(),this.event(n.a.ADDED),this._getBit(s.a.DISPLAY)&&(this._setUpNoticeChain(),t.displayedInStage&&this._displayChild(this,!0)),t._childChanged(this)):(this._onRemoved(),this.event(n.a.REMOVED),this._parent._childChanged(),this._getBit(s.a.DISPLAY)&&this._displayChild(this,!1),this._parent=t))}get displayedInStage(){return this._getBit(s.a.DISPLAY)?this._getBit(s.a.DISPLAYED_INSTAGE):(this._setBitUp(s.a.DISPLAY),this._getBit(s.a.DISPLAYED_INSTAGE))}_updateDisplayedInstage(){var t;t=this;for(var e=_.a.stage,i=!1;t;){if(t._getBit(s.a.DISPLAY)){i=t._getBit(s.a.DISPLAYED_INSTAGE);break}if(t===e||t._getBit(s.a.DISPLAYED_INSTAGE)){i=!0;break}t=t._parent}this._setBit(s.a.DISPLAYED_INSTAGE,i)}_setDisplay(t){this._getBit(s.a.DISPLAYED_INSTAGE)!==t&&(this._setBit(s.a.DISPLAYED_INSTAGE,t),t?this.event(n.a.DISPLAY):this.event(n.a.UNDISPLAY))}_displayChild(t,e){var i=t._children;if(i)for(var a=0,r=i.length;a<r;a++){var n=i[a];n._getBit(s.a.DISPLAY)&&(n._children.length>0?this._displayChild(n,e):n._setDisplay(e))}t._setDisplay(e)}contains(t){if(t===this)return!0;for(;t;){if(t._parent===this)return!0;t=t._parent}return!1}timerLoop(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];(this.scene?this.scene.timer:_.a.timer).loop(t,e,i,a,r,s)}timerOnce(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];(this.scene?this.scene.timer:_.a.timer)._create(!1,!1,t,e,i,a,r)}frameLoop(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];(this.scene?this.scene.timer:_.a.timer)._create(!0,!0,t,e,i,a,r)}frameOnce(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];(this.scene?this.scene.timer:_.a.timer)._create(!0,!1,t,e,i,a,r)}clearTimer(t,e){(this.scene?this.scene.timer:_.a.timer).clear(t,e)}callLater(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(this.scene?this.scene.timer:_.a.timer).callLater(this,t,e)}runCallLater(t){(this.scene?this.scene.timer:_.a.timer).runCallLater(this,t)}get scene(){return this._scene}get active(){return!this._getBit(s.a.NOT_READY)&&!this._getBit(s.a.NOT_ACTIVE)}set active(t){if(t=!!t,!this._getBit(s.a.NOT_ACTIVE)!==t){if(this._activeChangeScripts&&0!==this._activeChangeScripts.length)throw t?"Node: can't set the main inActive node active in hierarchy,if the operate is in main inActive node or it's children script's onDisable Event.":"Node: can't set the main active node inActive in hierarchy,if the operate is in main active node or it's children script's onEnable Event.";this._setBit(s.a.NOT_ACTIVE,!t),this._parent&&this._parent.activeInHierarchy&&(t?this._processActive():this._processInActive())}}get activeInHierarchy(){return this._getBit(s.a.ACTIVE_INHIERARCHY)}_onActive(){h.a.spriteCount++}_onInActive(){h.a.spriteCount--}_onActiveInScene(){}_onInActiveInScene(){}_parse(t,e){}_setBelongScene(t){if(!this._scene){this._scene=t,this._onActiveInScene();for(var e=0,i=this._children.length;e<i;e++)this._children[e]._setBelongScene(t)}}_setUnBelongScene(){if(this._scene!==this){this._onInActiveInScene(),this._scene=null;for(var t=0,e=this._children.length;t<e;t++)this._children[t]._setUnBelongScene()}}onAwake(){}onEnable(){}_processActive(){this._activeChangeScripts||(this._activeChangeScripts=[]),this._activeHierarchy(this._activeChangeScripts),this._activeScripts()}_activeHierarchy(t){if(this._setBit(s.a.ACTIVE_INHIERARCHY,!0),this._components)for(var e=0,i=this._components.length;e<i;e++){var a=this._components[e];a._isScript()?a._enabled&&t.push(a):a._setActive(!0)}for(this._onActive(),e=0,i=this._children.length;e<i;e++){var r=this._children[e];!r._getBit(s.a.NOT_ACTIVE)&&!r._getBit(s.a.NOT_READY)&&r._activeHierarchy(t)}this._getBit(s.a.AWAKED)||(this._setBit(s.a.AWAKED,!0),this.onAwake()),this.onEnable()}_activeScripts(){for(var t=0,e=this._activeChangeScripts.length;t<e;t++){var i=this._activeChangeScripts[t];i._awaked||(i._awaked=!0,i._onAwake()),i._onEnable()}this._activeChangeScripts.length=0}_processInActive(){this._activeChangeScripts||(this._activeChangeScripts=[]),this._inActiveHierarchy(this._activeChangeScripts),this._inActiveScripts()}_inActiveHierarchy(t){if(this._onInActive(),this._components)for(var e=0,i=this._components.length;e<i;e++){var a=this._components[e];a._setActive(!1),a._isScript()&&a._enabled&&t.push(a)}for(this._setBit(s.a.ACTIVE_INHIERARCHY,!1),e=0,i=this._children.length;e<i;e++){var r=this._children[e];r&&!r._getBit(s.a.NOT_ACTIVE)&&r._inActiveHierarchy(t)}this.onDisable()}_inActiveScripts(){for(var t=0,e=this._activeChangeScripts.length;t<e;t++)this._activeChangeScripts[t].onDisable();this._activeChangeScripts.length=0}onDisable(){}_onAdded(){if(this._activeChangeScripts&&0!==this._activeChangeScripts.length)throw"Node: can't set the main inActive node active in hierarchy,if the operate is in main inActive node or it's children script's onDisable Event.";var t=this._parent.scene;t&&this._setBelongScene(t),this._parent.activeInHierarchy&&this.active&&this._processActive()}_onRemoved(){if(this._activeChangeScripts&&0!==this._activeChangeScripts.length)throw"Node: can't set the main active node inActive in hierarchy,if the operate is in main active node or it's children script's onEnable Event.";this._parent.activeInHierarchy&&this.active&&this._processInActive(),this._parent.scene&&this._setUnBelongScene()}_addComponentInstance(t){this._components=this._components||[],this._components.push(t),t.owner=this,t._onAdded(),this.activeInHierarchy&&t._setActive(!0)}_destroyComponent(t){if(this._components)for(var e=0,i=this._components.length;e<i;e++){var a=this._components[e];if(a===t){a._destroy(),this._components.splice(e,1);break}}}_destroyAllComponent(){if(this._components){for(var t=0,e=this._components.length;t<e;t++){var i=this._components[t];i&&i._destroy()}this._components.length=0}}_cloneTo(t,e,i){var a=t;if(this._components)for(var r=0,s=this._components.length;r<s;r++){var n=a.addComponent(this._components[r].constructor);this._components[r]._cloneTo(n)}}addComponentIntance(t){if(t.owner)throw"Node:the component has belong to other node.";if(t.isSingleton&&this.getComponent(t.constructor))throw"Node:the component is singleton,can't add the second one.";return this._addComponentInstance(t),t}addComponent(t){var e=l.a.createByClass(t);if(e._destroyed=!1,e.isSingleton&&this.getComponent(t))throw"无法实例"+t+"组件，"+t+"组件已存在！";return this._addComponentInstance(e),e}getComponent(t){if(this._components)for(var e=0,i=this._components.length;e<i;e++){var a=this._components[e];if(a instanceof t)return a}return null}getComponents(t){var e;if(this._components)for(var i=0,a=this._components.length;i<a;i++){var r=this._components[i];r instanceof t&&(e=e||[]).push(r)}return e}get timer(){return this.scene?this.scene.timer:_.a.timer}}e.a=d,r()(d,"ARRAY_EMPTY",[]),c.a.regClass("laya.display.Node",d),c.a.regClass("Laya.Node",d)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(9),n=i(24),o=i(1);class l{static __init__(){l._btScale=new CANNON.Vec3,l._btVector30=new CANNON.Vec3,l._btQuaternion0=new CANNON.Quaternion}static _createAffineTransformation(t,e,i){var a=e.x,r=e.y,s=e.z,n=e.w,o=a+a,l=r+r,h=s+s,_=a*o,c=a*l,d=a*h,u=r*l,f=r*h,m=s*h,p=n*o,g=n*l,v=n*h;i[0]=1-(u+m),i[1]=c+v,i[2]=d-g,i[3]=0,i[4]=c-v,i[5]=1-(_+m),i[6]=f+p,i[7]=0,i[8]=d+g,i[9]=f-p,i[10]=1-(_+u),i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1}get type(){return this._type}get localOffset(){return this._localOffset}set localOffset(t){t.cloneTo(this._localOffset)}get localRotation(){return this._localRotation}set localRotation(t){this._localRotation=t,this._compoundParent&&this._compoundParent._updateChildTransform(this)}constructor(){r()(this,"_scale",new o.a(1,1,1)),r()(this,"_btShape",void 0),r()(this,"_type",void 0),r()(this,"_centerMatrix",new s.a),r()(this,"_attatched",!1),r()(this,"_indexInCompound",-1),r()(this,"_compoundParent",null),r()(this,"_attatchedCollisionObject",null),r()(this,"_referenceCount",0),r()(this,"_localOffset",new o.a(0,0,0)),r()(this,"_localRotation",new n.a(0,0,0,1)),r()(this,"needsCustomCollisionCallback",!1)}_setScale(t){}_addReference(){this._referenceCount++}_removeReference(){this._referenceCount--}updateLocalTransformations(){if(this._compoundParent){var t=l._tempVector30;o.a.multiply(this.localOffset,this._scale,t),l._createAffineTransformation(t,this.localRotation,this._centerMatrix.elements)}else l._createAffineTransformation(this.localOffset,this.localRotation,this._centerMatrix.elements)}cloneTo(t){var e=t;this._localOffset.cloneTo(e.localOffset),this._localRotation.cloneTo(e.localRotation),e.localOffset=e.localOffset,e.localRotation=e.localRotation}clone(){return null}destroy(){this._btShape&&(this._btShape=null)}}e.a=l,r()(l,"SHAPEORIENTATION_UPX",0),r()(l,"SHAPEORIENTATION_UPY",1),r()(l,"SHAPEORIENTATION_UPZ",2),r()(l,"SHAPETYPES_BOX",0),r()(l,"SHAPETYPES_SPHERE",1),r()(l,"SHAPETYPES_CYLINDER",2),r()(l,"SHAPETYPES_CAPSULE",3),r()(l,"SHAPETYPES_CONVEXHULL",4),r()(l,"SHAPETYPES_COMPOUND",5),r()(l,"SHAPETYPES_STATICPLANE",6),r()(l,"SHAPETYPES_CONE",7),r()(l,"_tempVector30",new o.a),r()(l,"_btScale",void 0),r()(l,"_btVector30",void 0),r()(l,"_btQuaternion0",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(98),n=i(6),o=i(85),l=i(9),h=i(24),_=i(1),c=i(51),d=i(254),u=i(123),f=i(398);class m extends s.a{static __init__(){m._btVector30=new CANNON.Vec3(0,0,0),m._btQuaternion0=new CANNON.Quaternion(0,0,0,1)}static _creatShape(t){var e;switch(t.type){case"BoxColliderShape":var i=t.size;e=i?new d.a(i[0],i[1],i[2]):new d.a;break;case"SphereColliderShape":e=new f.a(t.radius);break;default:throw"unknown shape type."}if(t.center){var a=e.localOffset;a.fromArray(t.center),e.localOffset=a}return e}static physicQuaternionMultiply(t,e,i,a,r,s){var n=r.x,o=r.y,l=r.z,h=r.w,_=e*l-i*o,c=i*n-t*l,d=t*o-e*n,u=t*n+e*o+i*l;s.x=t*h+n*a+_,s.y=e*h+o*a+c,s.z=i*h+l*a+d,s.w=a*h-u}get restitution(){return this._restitution}set restitution(t){this._restitution=t,this._btColliderObject&&(this._btColliderObject.material.restitution=t)}get friction(){return this._friction}set friction(t){this._friction=t,this._btColliderObject&&(this._btColliderObject.material.friction=t)}get colliderShape(){return this._colliderShape}set colliderShape(t){var e=this._colliderShape;if(e&&(e._attatched=!1,e._attatchedCollisionObject=null),this._colliderShape=t,t){if(t._attatched)throw"PhysicsComponent: this shape has attatched to other entity.";if(t._attatched=!0,t._attatchedCollisionObject=this,this._btColliderObject){if(t.type!=u.a.SHAPETYPES_COMPOUND){this._btColliderObject.shapes.length=0,this._btColliderObject.shapeOffsets.length=0,this._btColliderObject.shapeOrientations.length=0;var i=t.localOffset,a=t._scale,r=new CANNON.Vec3(i.x*a.x,i.y*a.y,i.z*a.z);this._btColliderObject.addShape(this._colliderShape._btShape,r),this._btColliderObject.updateBoundingRadius()}else t.bindRigidBody(this);var s=this._simulation&&this._enabled;s&&e&&this._removeFromSimulation(),this._onShapeChange(t),s&&(this._derivePhysicsTransformation(!0),this._addToSimulation())}}else this._simulation&&this._enabled&&e&&this._removeFromSimulation()}get simulation(){return this._simulation}get collisionGroup(){return this._collisionGroup}set collisionGroup(t){this._collisionGroup!==t&&(this._collisionGroup=t,this._btColliderObject.collisionFilterGroup=t,this._simulation&&this._colliderShape&&this._enabled&&(this._removeFromSimulation(),this._addToSimulation()))}get canCollideWith(){return this._canCollideWith}set canCollideWith(t){this._canCollideWith!==t&&(this._canCollideWith=t,this._btColliderObject.collisionFilterMask=t,this._simulation&&this._colliderShape&&this._enabled&&(this._removeFromSimulation(),this._addToSimulation()))}constructor(t,e){super(),r()(this,"_restitution",0),r()(this,"_friction",.5),r()(this,"_collisionGroup",c.a.COLLISIONFILTERGROUP_DEFAULTFILTER),r()(this,"_canCollideWith",c.a.COLLISIONFILTERGROUP_ALLFILTER),r()(this,"_colliderShape",null),r()(this,"_transformFlag",2147483647),r()(this,"_controlBySimulation",!1),r()(this,"_btColliderObject",void 0),r()(this,"_simulation",void 0),r()(this,"_enableProcessCollisions",!0),r()(this,"_inPhysicUpdateListIndex",-1),r()(this,"canScaleShape",!0),this._collisionGroup=t,this._canCollideWith=e,m._physicObjectsMap[this.id]=this}_parseShape(t){if(1===t.length){var e=m._creatShape(t[0]);this.colliderShape=e}}_onScaleChange(t){this._colliderShape._setScale(t)}_onEnable(){this._simulation=this.owner._scene._cannonPhysicsSimulation,this._colliderShape&&(this._derivePhysicsTransformation(!0),this._addToSimulation())}_onDisable(){this._colliderShape&&(this._removeFromSimulation(),-1!==this._inPhysicUpdateListIndex&&this._simulation._physicsUpdateList.remove(this)),this._simulation=null}_onDestroy(){delete m._physicObjectsMap[this.id],this._btColliderObject=null,this._colliderShape.destroy(),super._onDestroy(),this._btColliderObject=null,this._colliderShape=null,this._simulation=null,this.owner.transform.off(n.a.TRANSFORM_CHANGED,this,this._onTransformChanged)}_isValid(){return this._simulation&&this._colliderShape&&this._enabled}_parse(t){null!=t.collisionGroup&&(this.collisionGroup=t.collisionGroup),null!=t.canCollideWith&&(this.canCollideWith=t.canCollideWith)}_setTransformFlag(t,e){e?this._transformFlag|=t:this._transformFlag&=~t}_getTransformFlag(t){return 0!=(this._transformFlag&t)}_addToSimulation(){}_removeFromSimulation(){}_derivePhysicsTransformation(t){var e=this._btColliderObject;this._innerDerivePhysicsTransformation(e,t)}_innerDerivePhysicsTransformation(t,e){var i=this.owner._transform;if(e||this._getTransformFlag(o.a.TRANSFORM_WORLDPOSITION)){var a=this._colliderShape.localOffset,r=i.position,s=m._btVector30;if(0!==a.x||0!==a.y||0!==a.z){var n=m._tempVector30,l=i.worldMatrix;_.a.transformCoordinate(a,l,n),s.set(n.x,n.y,n.z)}else s.set(r.x,r.y,r.z);t.position.set(s.x,s.y,s.z),this._setTransformFlag(o.a.TRANSFORM_WORLDPOSITION,!1)}if(e||this._getTransformFlag(o.a.TRANSFORM_WORLDQUATERNION)){var h=this._colliderShape.localRotation,c=m._btQuaternion0,d=i.rotation;if(0!==h.x||0!==h.y||0!==h.z||1!==h.w){var u=m._tempQuaternion0;m.physicQuaternionMultiply(d.x,d.y,d.z,d.w,h,u),c.set(u.x,u.y,u.z,u.w)}else c.set(d.x,d.y,d.z,d.w);t.quaternion.set(c.x,c.y,c.z,c.w),this._setTransformFlag(o.a.TRANSFORM_WORLDQUATERNION,!1)}(e||this._getTransformFlag(o.a.TRANSFORM_WORLDSCALE))&&(this._onScaleChange(i.getWorldLossyScale()),this._setTransformFlag(o.a.TRANSFORM_WORLDSCALE,!1))}_updateTransformComponent(t){var e=this._colliderShape,i=e.localOffset,a=e.localRotation,r=this.owner._transform,s=r.position,n=r.rotation,o=t.position,l=t.quaternion,h=l.x,c=l.y,d=l.z,u=l.w;if(0!==a.x||0!==a.y||0!==a.z||1!==a.w){var f=m._tempQuaternion0;a.invert(f),m.physicQuaternionMultiply(h,c,d,u,f,n)}else n.x=h,n.y=c,n.z=d,n.w=u;if(r.rotation=n,0!==i.x||0!==i.y||0!==i.z){var p=m._tempVector30;p.x=i.x,p.y=i.y,p.z=i.z,_.a.transformQuat(p,n,p),s.x=o.x-p.x,s.y=o.y-p.z,s.z=o.z-p.y}else s.x=o.x,s.y=o.y,s.z=o.z;r.position=s}_onShapeChange(t){}_onAdded(){this.enabled=this._enabled,this.restitution=this._restitution,this.friction=this._friction,this.owner.transform.on(n.a.TRANSFORM_CHANGED,this,this._onTransformChanged)}_onTransformChanged(t){!m._addUpdateList&&this._controlBySimulation||(t&=o.a.TRANSFORM_WORLDPOSITION|o.a.TRANSFORM_WORLDQUATERNION|o.a.TRANSFORM_WORLDSCALE)&&(this._transformFlag|=t,this._isValid()&&-1===this._inPhysicUpdateListIndex&&this._simulation._physicsUpdateList.add(this))}_cloneTo(t){var e=t;e.restitution=this._restitution,e.friction=this._friction,e.collisionGroup=this._collisionGroup,e.canCollideWith=this._canCollideWith,e.canScaleShape=this.canScaleShape,this._colliderShape&&(e.colliderShape=this._colliderShape.clone())}}e.a=m,r()(m,"ACTIVATIONSTATE_ACTIVE_TAG",1),r()(m,"ACTIVATIONSTATE_ISLAND_SLEEPING",2),r()(m,"ACTIVATIONSTATE_WANTS_DEACTIVATION",3),r()(m,"ACTIVATIONSTATE_DISABLE_DEACTIVATION",4),r()(m,"ACTIVATIONSTATE_DISABLE_SIMULATION",5),r()(m,"COLLISIONFLAGS_STATIC_OBJECT",1),r()(m,"COLLISIONFLAGS_KINEMATIC_OBJECT",2),r()(m,"COLLISIONFLAGS_NO_CONTACT_RESPONSE",4),r()(m,"COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK",8),r()(m,"COLLISIONFLAGS_CHARACTER_OBJECT",16),r()(m,"COLLISIONFLAGS_DISABLE_VISUALIZE_OBJECT",32),r()(m,"COLLISIONFLAGS_DISABLE_SPU_COLLISION_PROCESSING",64),r()(m,"_tempVector30",new _.a),r()(m,"_tempQuaternion0",new h.a),r()(m,"_tempQuaternion1",new h.a),r()(m,"_tempMatrix4x40",new l.a),r()(m,"_btVector30",void 0),r()(m,"_btQuaternion0",void 0),r()(m,"_physicObjectsMap",{}),r()(m,"_addUpdateList",!0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1),n=i(51),o=i(13),l=i(62),h=i(261),_=i(11);class c extends h.a{static __init__(){var t=_.a.Physics3D._bullet;c._btTempVector30=t.btVector3_create(0,0,0),c._btTempVector31=t.btVector3_create(0,0,0),c._btVector3Zero=t.btVector3_create(0,0,0),c._btInertia=t.btVector3_create(0,0,0),c._btImpulse=t.btVector3_create(0,0,0),c._btImpulseOffset=t.btVector3_create(0,0,0),c._btGravity=t.btVector3_create(0,0,0),c._btTransform0=t.btTransform_create()}get mass(){return this._mass}set mass(t){t=Math.max(t,1e-7),this._mass=t,this._isKinematic||this._updateMass(t)}get isKinematic(){return this._isKinematic}set isKinematic(t){this._isKinematic=t,this._controlBySimulation=!t;var e=_.a.Physics3D._bullet,i=!!(this._simulation&&this._enabled&&this._colliderShape);i&&this._removeFromSimulation();var a=this._btColliderObject,r=e.btCollisionObject_getCollisionFlags(a);t?(r|=l.a.COLLISIONFLAGS_KINEMATIC_OBJECT,e.btCollisionObject_setCollisionFlags(a,r),e.btCollisionObject_forceActivationState(this._btColliderObject,l.a.ACTIVATIONSTATE_DISABLE_DEACTIVATION),this._enableProcessCollisions=!1,this._updateMass(0)):((r&l.a.COLLISIONFLAGS_KINEMATIC_OBJECT)>0&&(r^=l.a.COLLISIONFLAGS_KINEMATIC_OBJECT),e.btCollisionObject_setCollisionFlags(a,r),e.btCollisionObject_setActivationState(this._btColliderObject,l.a.ACTIVATIONSTATE_ACTIVE_TAG),this._enableProcessCollisions=!0,this._updateMass(this._mass));var s=c._btVector3Zero;e.btCollisionObject_setInterpolationLinearVelocity(a,s),e.btRigidBody_setLinearVelocity(a,s),e.btCollisionObject_setInterpolationAngularVelocity(a,s),e.btRigidBody_setAngularVelocity(a,s),i&&this._addToSimulation()}get linearDamping(){return this._linearDamping}set linearDamping(t){this._linearDamping=t,this._btColliderObject&&_.a.Physics3D._bullet.btRigidBody_setDamping(this._btColliderObject,t,this._angularDamping)}get angularDamping(){return this._angularDamping}set angularDamping(t){this._angularDamping=t,this._btColliderObject&&_.a.Physics3D._bullet.btRigidBody_setDamping(this._btColliderObject,this._linearDamping,t)}get overrideGravity(){return this._overrideGravity}set overrideGravity(t){this._overrideGravity=t;var e=_.a.Physics3D._bullet;if(this._btColliderObject){var i=e.btRigidBody_getFlags(this._btColliderObject);t?0==(i&c._BT_DISABLE_WORLD_GRAVITY)&&e.btRigidBody_setFlags(this._btColliderObject,i|c._BT_DISABLE_WORLD_GRAVITY):(i&c._BT_DISABLE_WORLD_GRAVITY)>0&&e.btRigidBody_setFlags(this._btColliderObject,i^c._BT_DISABLE_WORLD_GRAVITY)}}get gravity(){return this._gravity}set gravity(t){this._gravity=t;var e=_.a.Physics3D._bullet;e.btVector3_setValue(c._btGravity,-t.x,t.y,t.z),e.btRigidBody_setGravity(this._btColliderObject,c._btGravity)}get totalForce(){if(this._btColliderObject){var t=_.a.Physics3D._bullet.btRigidBody_getTotalForce(this._btColliderObject);return o.a._convertToLayaVec3(t,this._totalForce,!0),this._totalForce}return null}get linearFactor(){return this._linearFactor}set linearFactor(t){this._linearFactor=t;var e=c._btTempVector30;o.a._convertToBulletVec3(t,e,!1),_.a.Physics3D._bullet.btRigidBody_setLinearFactor(this._btColliderObject,e)}get linearVelocity(){return this._btColliderObject&&o.a._convertToLayaVec3(_.a.Physics3D._bullet.btRigidBody_getLinearVelocity(this._btColliderObject),this._linearVelocity,!0),this._linearVelocity}set linearVelocity(t){if(this._linearVelocity=t,this._btColliderObject){var e=c._btTempVector30;o.a._convertToBulletVec3(t,e,!0),this.isSleeping&&this.wakeUp(),_.a.Physics3D._bullet.btRigidBody_setLinearVelocity(this._btColliderObject,e)}}get angularFactor(){return this._angularFactor}set angularFactor(t){this._angularFactor=t;var e=c._btTempVector30;o.a._convertToBulletVec3(t,e,!1),_.a.Physics3D._bullet.btRigidBody_setAngularFactor(this._btColliderObject,e)}get angularVelocity(){return this._btColliderObject&&o.a._convertToLayaVec3(_.a.Physics3D._bullet.btRigidBody_getAngularVelocity(this._btColliderObject),this._angularVelocity,!0),this._angularVelocity}set angularVelocity(t){if(this._angularVelocity=t,this._btColliderObject){var e=c._btTempVector30;o.a._convertToBulletVec3(t,e,!0),this.isSleeping&&this.wakeUp(),_.a.Physics3D._bullet.btRigidBody_setAngularVelocity(this._btColliderObject,e)}}get totalTorque(){if(this._btColliderObject){var t=_.a.Physics3D._bullet.btRigidBody_getTotalTorque(this._btColliderObject);return o.a._convertToLayaVec3(t,this._totalTorque,!0),this._totalTorque}return null}get detectCollisions(){return this._detectCollisions}set detectCollisions(t){this._detectCollisions!==t&&(this._detectCollisions=t,this._colliderShape&&this._enabled&&this._simulation&&(this._simulation._removeRigidBody(this),this._simulation._addRigidBody(this,this._collisionGroup,t?this._canCollideWith:0)))}get isSleeping(){return!!this._btColliderObject&&_.a.Physics3D._bullet.btCollisionObject_getActivationState(this._btColliderObject)===l.a.ACTIVATIONSTATE_ISLAND_SLEEPING}get sleepLinearVelocity(){return _.a.Physics3D._bullet.btRigidBody_getLinearSleepingThreshold(this._btColliderObject)}set sleepLinearVelocity(t){var e=_.a.Physics3D._bullet;e.btRigidBody_setSleepingThresholds(this._btColliderObject,t,e.btRigidBody_getAngularSleepingThreshold(this._btColliderObject))}get sleepAngularVelocity(){return _.a.Physics3D._bullet.btRigidBody_getAngularSleepingThreshold(this._btColliderObject)}set sleepAngularVelocity(t){var e=_.a.Physics3D._bullet;e.btRigidBody_setSleepingThresholds(this._btColliderObject,e.btRigidBody_getLinearSleepingThreshold(this._btColliderObject),t)}get btColliderObject(){return this._btColliderObject}set constaintRigidbodyA(t){this._constaintRigidbodyA=t}get constaintRigidbodyA(){return this._constaintRigidbodyA}set constaintRigidbodyB(t){this._constaintRigidbodyB=t}get constaintRigidbodyB(){return this._constaintRigidbodyB}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.a.COLLISIONFILTERGROUP_DEFAULTFILTER,arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.a.COLLISIONFILTERGROUP_ALLFILTER),r()(this,"_btLayaMotionState",void 0),r()(this,"_isKinematic",!1),r()(this,"_mass",1),r()(this,"_gravity",new s.a(0,-10,0)),r()(this,"_angularDamping",0),r()(this,"_linearDamping",0),r()(this,"_overrideGravity",!1),r()(this,"_totalTorque",new s.a(0,0,0)),r()(this,"_totalForce",new s.a(0,0,0)),r()(this,"_linearVelocity",new s.a),r()(this,"_angularVelocity",new s.a),r()(this,"_linearFactor",new s.a(1,1,1)),r()(this,"_angularFactor",new s.a(1,1,1)),r()(this,"_detectCollisions",!0),r()(this,"_constaintRigidbodyA",void 0),r()(this,"_constaintRigidbodyB",void 0),this._controlBySimulation=!0}_updateMass(t){if(this._btColliderObject&&this._colliderShape){var e=_.a.Physics3D._bullet;e.btCollisionShape_calculateLocalInertia(this._colliderShape._btShape,t,c._btInertia),e.btRigidBody_setMassProps(this._btColliderObject,t,c._btInertia),e.btRigidBody_updateInertiaTensor(this._btColliderObject)}}_onScaleChange(t){super._onScaleChange(t),this._updateMass(this._isKinematic?0:this._mass)}_derivePhysicsTransformation(t){var e=_.a.Physics3D._bullet,i=this._btColliderObject,a=e.btCollisionObject_getWorldTransform(i),r=c._btTransform0;e.btTransform_equal(r,a),this._innerDerivePhysicsTransformation(r,t),e.btRigidBody_setCenterOfMassTransform(i,r)}_onAdded(){var t=_.a.Physics3D._bullet,e=t.layaMotionState_create();t.layaMotionState_set_rigidBodyID(e,this._id),this._btLayaMotionState=e;var i=t.btRigidBodyConstructionInfo_create(0,e,null,c._btVector3Zero),a=t.btRigidBody_create(i);t.btCollisionObject_setUserIndex(a,this.id),this._btColliderObject=a,super._onAdded(),this.mass=this._mass,this.linearFactor=this._linearFactor,this.angularFactor=this._angularFactor,this.linearDamping=this._linearDamping,this.angularDamping=this._angularDamping,this.overrideGravity=this._overrideGravity,this.gravity=this._gravity,this.isKinematic=this._isKinematic,t.btRigidBodyConstructionInfo_destroy(i)}_onEnable(){super._onEnable(),this._constaintRigidbodyA&&this._constaintRigidbodyA.connectedBody._simulation&&(this._constaintRigidbodyA._createConstraint(),this._constaintRigidbodyA._onEnable()),this._constaintRigidbodyB&&this._constaintRigidbodyB.ownBody._simulation&&(this._constaintRigidbodyB._createConstraint(),this._constaintRigidbodyB._onEnable())}_onShapeChange(t){if(super._onShapeChange(t),this._isKinematic)this._updateMass(0);else{var e=_.a.Physics3D._bullet;e.btRigidBody_setCenterOfMassTransform(this._btColliderObject,e.btCollisionObject_getWorldTransform(this._btColliderObject)),this._updateMass(this._mass)}}_parse(t){if(null!=t.friction&&(this.friction=t.friction),null!=t.rollingFriction&&(this.rollingFriction=t.rollingFriction),null!=t.restitution&&(this.restitution=t.restitution),null!=t.isTrigger&&(this.isTrigger=t.isTrigger),null!=t.mass&&(this.mass=t.mass),null!=t.linearDamping&&(this.linearDamping=t.linearDamping),null!=t.angularDamping&&(this.angularDamping=t.angularDamping),null!=t.overrideGravity&&(this.overrideGravity=t.overrideGravity),null!=t.linearFactor){var e=this.linearFactor;e.fromArray(t.linearFactor),this.linearFactor=e}if(null!=t.angularFactor){var i=this.angularFactor;i.fromArray(t.angularFactor),this.angularFactor=i}t.gravity&&(this.gravity.fromArray(t.gravity),this.gravity=this.gravity),super._parse(t),this._parseShape(t.shapes),null!=t.isKinematic&&(this.isKinematic=t.isKinematic)}_onDestroy(){_.a.Physics3D._bullet.btMotionState_destroy(this._btLayaMotionState),super._onDestroy(),this._btLayaMotionState=null,this._gravity=null,this._totalTorque=null,this._linearVelocity=null,this._angularVelocity=null,this._linearFactor=null,this._angularFactor=null,this.constaintRigidbodyA&&this.constaintRigidbodyA._breakConstrained(),this.constaintRigidbodyB&&(this.constaintRigidbodyB.connectedBody=null,this.constaintRigidbodyB._onDisable())}_addToSimulation(){this._simulation._addRigidBody(this,this._collisionGroup,this._detectCollisions?this._canCollideWith:0)}_removeFromSimulation(){this._simulation._removeRigidBody(this)}_cloneTo(t){super._cloneTo(t);var e=t;e.isKinematic=this._isKinematic,e.mass=this._mass,e.gravity=this._gravity,e.angularDamping=this._angularDamping,e.linearDamping=this._linearDamping,e.overrideGravity=this._overrideGravity,e.linearVelocity=this._linearVelocity,e.angularVelocity=this._angularVelocity,e.linearFactor=this._linearFactor,e.angularFactor=this._angularFactor,e.detectCollisions=this._detectCollisions}applyForce(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var i=_.a.Physics3D._bullet,a=c._btTempVector30;if(i.btVector3_setValue(a,-t.x,t.y,t.z),e){var r=c._btTempVector31;i.btVector3_setValue(r,-e.x,e.y,e.z),i.btRigidBody_applyForce(this._btColliderObject,a,r)}else i.btRigidBody_applyCentralForce(this._btColliderObject,a)}applyTorque(t){if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var e=_.a.Physics3D._bullet,i=c._btTempVector30;e.btVector3_setValue(i,-t.x,t.y,t.z),e.btRigidBody_applyTorque(this._btColliderObject,i)}applyImpulse(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var i=_.a.Physics3D._bullet;i.btVector3_setValue(c._btImpulse,-t.x,t.y,t.z),e?(i.btVector3_setValue(c._btImpulseOffset,-e.x,e.y,e.z),i.btRigidBody_applyImpulse(this._btColliderObject,c._btImpulse,c._btImpulseOffset)):i.btRigidBody_applyCentralImpulse(this._btColliderObject,c._btImpulse)}applyTorqueImpulse(t){if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var e=_.a.Physics3D._bullet,i=c._btTempVector30;e.btVector3_setValue(i,-t.x,t.y,t.z),e.btRigidBody_applyTorqueImpulse(this._btColliderObject,i)}wakeUp(){this._btColliderObject&&_.a.Physics3D._bullet.btCollisionObject_activate(this._btColliderObject,!1)}clearForces(){var t=this._btColliderObject;if(null==t)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var e=_.a.Physics3D._bullet;e.btRigidBody_clearForces(t);var i=c._btVector3Zero;e.btCollisionObject_setInterpolationLinearVelocity(t,i),e.btRigidBody_setLinearVelocity(t,i),e.btCollisionObject_setInterpolationAngularVelocity(t,i),e.btRigidBody_setAngularVelocity(t,i)}}e.a=c,r()(c,"TYPE_STATIC",0),r()(c,"TYPE_DYNAMIC",1),r()(c,"TYPE_KINEMATIC",2),r()(c,"_BT_DISABLE_WORLD_GRAVITY",1),r()(c,"_BT_ENABLE_GYROPSCOPIC_FORCE",2),r()(c,"_btTempVector30",void 0),r()(c,"_btTempVector31",void 0),r()(c,"_btVector3Zero",void 0),r()(c,"_btTransform0",void 0),r()(c,"_btInertia",void 0),r()(c,"_btImpulse",void 0),r()(c,"_btImpulseOffset",void 0),r()(c,"_btGravity",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(171);e.a=class extends s.a{constructor(){super(),r()(this,"inTangent",void 0),r()(this,"outTangent",void 0),r()(this,"value",void 0)}cloneTo(t){super.cloneTo(t);var e=t;e.inTangent=this.inTangent,e.outTangent=this.outTangent,e.value=this.value}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{constructor(){r()(this,"viewMatrix",void 0),r()(this,"projectionMatrix",void 0),r()(this,"projectionViewMatrix",void 0),r()(this,"viewport",void 0),r()(this,"scene",void 0),r()(this,"camera",void 0),r()(this,"cameraShaderValue",void 0),r()(this,"renderElement",void 0),r()(this,"shader",void 0),r()(this,"invertY",!1),r()(this,"pipelineMode",void 0)}}e.a=s,r()(s,"_instance",new s),r()(s,"clientWidth",void 0),r()(s,"clientHeight",void 0)},function(t,e,i){"use strict";let a;i.d(e,"a",function(){return a}),function(t){t[t.None=0]="None",t[t.Hard=1]="Hard",t[t.SoftLow=2]="SoftLow",t[t.SoftHigh=3]="SoftHigh"}(a||(a={}))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(5),n=i(7),o=i(22),l=i(40),h=i(169);let _;!function(t){t[t.Opaque=0]="Opaque",t[t.Cutout=1]="Cutout",t[t.Fade=2]="Fade",t[t.Transparent=3]="Transparent"}(_||(_={}));class c extends o.a{static __init__(){c.SHADERDEFINE_ALBEDOTEXTURE=n.a.getDefineByName("ALBEDOTEXTURE"),c.SHADERDEFINE_NORMALTEXTURE=n.a.getDefineByName("NORMALTEXTURE"),c.SHADERDEFINE_PARALLAXTEXTURE=n.a.getDefineByName("PARALLAXTEXTURE"),c.SHADERDEFINE_OCCLUSIONTEXTURE=n.a.getDefineByName("OCCLUSIONTEXTURE"),c.SHADERDEFINE_EMISSION=n.a.getDefineByName("EMISSION"),c.SHADERDEFINE_EMISSIONTEXTURE=n.a.getDefineByName("EMISSIONTEXTURE"),c.SHADERDEFINE_TILINGOFFSET=n.a.getDefineByName("TILINGOFFSET"),c.SHADERDEFINE_TRANSPARENTBLEND=n.a.getDefineByName("TRANSPARENTBLEND"),c.SHADERDEFINE_LAYA_PBR_BRDF_HIGH=n.a.getDefineByName("LAYA_PBR_BRDF_HIGH"),c.SHADERDEFINE_LAYA_PBR_BRDF_LOW=n.a.getDefineByName("LAYA_PBR_BRDF_LOW")}get albedoColor(){return this._shaderValues.getVector(c.ALBEDOCOLOR)}set albedoColor(t){this._shaderValues.setVector(c.ALBEDOCOLOR,t)}get albedoTexture(){return this._shaderValues.getTexture(c.ALBEDOTEXTURE)}set albedoTexture(t){t?this._shaderValues.addDefine(c.SHADERDEFINE_ALBEDOTEXTURE):this._shaderValues.removeDefine(c.SHADERDEFINE_ALBEDOTEXTURE),this._shaderValues.setTexture(c.ALBEDOTEXTURE,t)}get normalTexture(){return this._shaderValues.getTexture(c.NORMALTEXTURE)}set normalTexture(t){t?this._shaderValues.addDefine(c.SHADERDEFINE_NORMALTEXTURE):this._shaderValues.removeDefine(c.SHADERDEFINE_NORMALTEXTURE),this._shaderValues.setTexture(c.NORMALTEXTURE,t)}get normalTextureScale(){return this._shaderValues.getNumber(c.NORMALSCALE)}set normalTextureScale(t){this._shaderValues.setNumber(c.NORMALSCALE,t)}get parallaxTexture(){return this._shaderValues.getTexture(c.PARALLAXTEXTURE)}set parallaxTexture(t){t?this._shaderValues.addDefine(c.SHADERDEFINE_PARALLAXTEXTURE):this._shaderValues.removeDefine(c.SHADERDEFINE_PARALLAXTEXTURE),this._shaderValues.setTexture(c.PARALLAXTEXTURE,t)}get parallaxTextureScale(){return this._shaderValues.getNumber(c.PARALLAXSCALE)}set parallaxTextureScale(t){this._shaderValues.setNumber(c.PARALLAXSCALE,Math.max(.005,Math.min(.08,t)))}get occlusionTexture(){return this._shaderValues.getTexture(c.OCCLUSIONTEXTURE)}set occlusionTexture(t){t?this._shaderValues.addDefine(c.SHADERDEFINE_OCCLUSIONTEXTURE):this._shaderValues.removeDefine(c.SHADERDEFINE_OCCLUSIONTEXTURE),this._shaderValues.setTexture(c.OCCLUSIONTEXTURE,t)}get occlusionTextureStrength(){return this._shaderValues.getNumber(c.OCCLUSIONSTRENGTH)}set occlusionTextureStrength(t){this._shaderValues.setNumber(c.OCCLUSIONSTRENGTH,Math.max(0,Math.min(1,t)))}get smoothness(){return this._shaderValues.getNumber(c.SMOOTHNESS)}set smoothness(t){this._shaderValues.setNumber(c.SMOOTHNESS,Math.max(0,Math.min(1,t)))}get smoothnessTextureScale(){return this._shaderValues.getNumber(c.SMOOTHNESSSCALE)}set smoothnessTextureScale(t){this._shaderValues.setNumber(c.SMOOTHNESSSCALE,Math.max(0,Math.min(1,t)))}get enableEmission(){return this._enableEmission}set enableEmission(t){t?this._shaderValues.addDefine(c.SHADERDEFINE_EMISSION):this._shaderValues.removeDefine(c.SHADERDEFINE_EMISSION),this._enableEmission=t}get emissionColor(){return this._shaderValues.getVector(c.EMISSIONCOLOR)}set emissionColor(t){this._shaderValues.setVector(c.EMISSIONCOLOR,t)}get emissionTexture(){return this._shaderValues.getTexture(c.EMISSIONTEXTURE)}set emissionTexture(t){t?this._shaderValues.addDefine(c.SHADERDEFINE_EMISSIONTEXTURE):this._shaderValues.removeDefine(c.SHADERDEFINE_EMISSIONTEXTURE),this._shaderValues.setTexture(c.EMISSIONTEXTURE,t)}get tilingOffset(){return this._shaderValues.getVector(c.TILINGOFFSET)}set tilingOffset(t){t&&(1!=t.x||1!=t.y||0!=t.z||0!=t.w)?this._shaderValues.addDefine(c.SHADERDEFINE_TILINGOFFSET):this._shaderValues.removeDefine(c.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(c.TILINGOFFSET,t)}get depthWrite(){return this._shaderValues.getBool(c.DEPTH_WRITE)}set depthWrite(t){this._shaderValues.setBool(c.DEPTH_WRITE,t)}get cull(){return this._shaderValues.getInt(c.CULL)}set cull(t){this._shaderValues.setInt(c.CULL,t)}get blend(){return this._shaderValues.getInt(c.BLEND)}set blend(t){this._shaderValues.setInt(c.BLEND,t)}get blendSrc(){return this._shaderValues.getInt(c.BLEND_SRC)}set blendSrc(t){this._shaderValues.setInt(c.BLEND_SRC,t)}get blendDst(){return this._shaderValues.getInt(c.BLEND_DST)}set blendDst(t){this._shaderValues.setInt(c.BLEND_DST,t)}get depthTest(){return this._shaderValues.getInt(c.DEPTH_TEST)}set depthTest(t){this._shaderValues.setInt(c.DEPTH_TEST,t)}set renderMode(t){switch(t){case _.Opaque:this.alphaTest=!1,this.renderQueue=o.a.RENDERQUEUE_OPAQUE,this.depthWrite=!0,this.cull=l.a.CULL_BACK,this.blend=l.a.BLEND_DISABLE,this.depthTest=l.a.DEPTHTEST_LESS,this._shaderValues.removeDefine(c.SHADERDEFINE_TRANSPARENTBLEND);break;case _.Cutout:this.renderQueue=o.a.RENDERQUEUE_ALPHATEST,this.alphaTest=!0,this.depthWrite=!0,this.cull=l.a.CULL_BACK,this.blend=l.a.BLEND_DISABLE,this.depthTest=l.a.DEPTHTEST_LESS,this._shaderValues.removeDefine(c.SHADERDEFINE_TRANSPARENTBLEND);break;case _.Fade:this.renderQueue=o.a.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=l.a.CULL_BACK,this.blend=l.a.BLEND_ENABLE_ALL,this.blendSrc=l.a.BLENDPARAM_SRC_ALPHA,this.blendDst=l.a.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=l.a.DEPTHTEST_LESS,this._shaderValues.removeDefine(c.SHADERDEFINE_TRANSPARENTBLEND);break;case _.Transparent:this.renderQueue=o.a.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=l.a.CULL_BACK,this.blend=l.a.BLEND_ENABLE_ALL,this.blendSrc=l.a.BLENDPARAM_ONE,this.blendDst=l.a.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=l.a.DEPTHTEST_LESS,this._shaderValues.addDefine(c.SHADERDEFINE_TRANSPARENTBLEND);break;default:throw new Error("PBRMaterial:unknown renderMode value.")}}constructor(){super(),r()(this,"_enableEmission",!1),this._shaderValues.setVector(c.ALBEDOCOLOR,new s.a(1,1,1,1)),this._shaderValues.setVector(c.EMISSIONCOLOR,new s.a(1,1,1,1)),this._shaderValues.setNumber(c.SMOOTHNESS,.5),this._shaderValues.setNumber(c.SMOOTHNESSSCALE,1),this._shaderValues.setNumber(c.OCCLUSIONSTRENGTH,1),this._shaderValues.setNumber(c.NORMALSCALE,1),this._shaderValues.setNumber(c.PARALLAXSCALE,.001),this._shaderValues.setNumber(o.a.ALPHATESTVALUE,.5),this.renderMode=_.Opaque}get enableReflection(){return!0}set enableReflection(t){}}e.a=c,r()(c,"SHADERDEFINE_ALBEDOTEXTURE",void 0),r()(c,"SHADERDEFINE_NORMALTEXTURE",void 0),r()(c,"SHADERDEFINE_OCCLUSIONTEXTURE",void 0),r()(c,"SHADERDEFINE_PARALLAXTEXTURE",void 0),r()(c,"SHADERDEFINE_EMISSION",void 0),r()(c,"SHADERDEFINE_EMISSIONTEXTURE",void 0),r()(c,"SHADERDEFINE_TILINGOFFSET",void 0),r()(c,"SHADERDEFINE_TRANSPARENTBLEND",void 0),r()(c,"SHADERDEFINE_LAYA_PBR_BRDF_HIGH",void 0),r()(c,"SHADERDEFINE_LAYA_PBR_BRDF_LOW",void 0),r()(c,"ALBEDOTEXTURE",n.a.propertyNameToID("u_AlbedoTexture")),r()(c,"ALBEDOCOLOR",n.a.propertyNameToID("u_AlbedoColor")),r()(c,"TILINGOFFSET",n.a.propertyNameToID("u_TilingOffset")),r()(c,"NORMALTEXTURE",n.a.propertyNameToID("u_NormalTexture")),r()(c,"NORMALSCALE",n.a.propertyNameToID("u_NormalScale")),r()(c,"SMOOTHNESS",n.a.propertyNameToID("u_Smoothness")),r()(c,"SMOOTHNESSSCALE",n.a.propertyNameToID("u_SmoothnessScale")),r()(c,"OCCLUSIONTEXTURE",n.a.propertyNameToID("u_OcclusionTexture")),r()(c,"OCCLUSIONSTRENGTH",n.a.propertyNameToID("u_occlusionStrength")),r()(c,"PARALLAXTEXTURE",n.a.propertyNameToID("u_ParallaxTexture")),r()(c,"PARALLAXSCALE",n.a.propertyNameToID("u_ParallaxScale")),r()(c,"EMISSIONTEXTURE",n.a.propertyNameToID("u_EmissionTexture")),r()(c,"EMISSIONCOLOR",n.a.propertyNameToID("u_EmissionColor")),r()(c,"CULL",n.a.propertyNameToID("s_Cull")),r()(c,"BLEND",n.a.propertyNameToID("s_Blend")),r()(c,"BLEND_SRC",n.a.propertyNameToID("s_BlendSrc")),r()(c,"BLEND_DST",n.a.propertyNameToID("s_BlendDst")),r()(c,"DEPTH_TEST",n.a.propertyNameToID("s_DepthTest")),r()(c,"DEPTH_WRITE",n.a.propertyNameToID("s_DepthWrite")),r()(c,"renderQuality",h.a.High)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(447);e.a=class{constructor(t,e){r()(this,"_attributeMap",void 0),r()(this,"_uniformMap",void 0),r()(this,"_owner",void 0),r()(this,"_flags",{}),r()(this,"_passes",[]),this._attributeMap=t,this._uniformMap=e}setFlag(t,e){e?this._flags[t]=e:delete this._flags[t]}getFlag(t){return this._flags[t]}addShaderPass(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Forward";var r=new s.a(this,t,e,i);return r._pipelineMode=a,this._passes.push(r),r}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(8),o=i(73),l=i(1),h=i(13);class _{constructor(){r()(this,"position",void 0),r()(this,"useOcclusionCulling",void 0),r()(this,"boundFrustum",void 0),r()(this,"cullingMask",void 0)}}e.a=_;class c{static __init__(){}static _drawTraversalCullingBound(t,e){for(var i=t.elements,a=0,r=t.length;a<r;a++){var s=c._tempColor0;s.r=0,s.g=1,s.b=0,s.a=1,h.a._drawBound(e,i[a].bounds._getBoundBox(),s)}}static _traversalCulling(t,e,i,a,r,s,o){for(var h=a.elements,_=t.boundFrustum,c=t.position,d=t.cullingMask,u=n.a.loopCount,f=0,m=a.length;f<m;f++){var p=h[f];if((o?p._castShadow&&p._enable:0!=(Math.pow(2,p._owner._layer)&d)&&p._enable)&&(n.a.frustumCulling++,!t.useOcclusionCulling||p._needRender(_,i))){p._renderMark=u,p._distanceForSort=l.a.distance(p.bounds.getCenter(),c);for(var g=p._renderElements,v=0,T=g.length;v<T;v++)g[v]._update(e,i,r,s)}}}static renderObjectCulling(t,e,i,a,r,s){var n=e._opaqueQueue,o=e._transparentQueue,l=e._renders;e._clearRenderQueue();var h=e._octree;if(h&&(h.updateMotionObjects(),h.shrinkRootIfPossible(),h.getCollidingWithFrustum(t,i,a,r,s)),c._traversalCulling(t,e,i,l,a,r,s),c.debugFrustumCulling){var _=e._debugTool;_.clear(),h&&(h.drawAllBounds(_),h.drawAllObjects(_)),c._drawTraversalCullingBound(l,_)}var d=n.elements.length;d>0&&n._quickSort(0,d-1),(d=o.elements.length)>0&&o._quickSort(0,d-1)}static cullingShadow(t,e,i){var a=e._renders;e._clearRenderQueue();for(var r=e._opaqueQueue,s=t.position,o=t.cullPlaneCount,h=t.cullPlanes,_=(t.cullSphere,t.direction,a.elements),c=n.a.loopCount,d=0,u=a.length;d<u;d++){var f=_[d];if(f._castShadow&&f._enable){n.a.frustumCulling++;for(var m=f.bounds,p=m.getMin(),g=m.getMax(),v=p.x,T=p.y,E=p.z,S=g.x,R=g.y,x=g.z,A=!0,y=0;y<o;y++){var I=h[y],C=I.normal;if(I.distance+C.x*(C.x<0?v:S)+C.y*(C.y<0?T:R)+C.z*(C.z<0?E:x)<0){A=!1;break}}if(A){f._renderMark=c,f._distanceForSort=l.a.distance(m.getCenter(),s);for(var M=f._renderElements,D=(y=0,M.length);y<D;y++)M[y]._update(e,i,null,null)}}}return r.elements.length>0}static cullingSpotShadow(t,e,i){var a=e._renders;e._clearRenderQueue();for(var r=e._opaqueQueue,s=a.elements,o=n.a.loopCount,h=0,_=a.length;h<_;h++){var c=s[h];if(c._castShadow&&c._enable&&c._needRender(t.boundFrustum,i)){var d=c.bounds;c._renderMark=o,c._distanceForSort=l.a.distance(d.getCenter(),t.position);for(var u=c._renderElements,f=0,m=u.length;f<m;f++)u[f]._update(e,i,null,null)}}return r.elements.length>0}static renderObjectCullingNative(t,e,i,a,r,s){var o,h,_,d=e._opaqueQueue,u=e._transparentQueue;e._clearRenderQueue();var f=a.length,m=a.elements;for(o=0;o<f;o++)m[o].bounds,m[o]._updateForNative&&m[o]._updateForNative(i);t.boundFrustum;c.cullingNative(t._boundFrustumBuffer,c._cullingBuffer,e._cullingBufferIndices,f,e._cullingBufferResult);var p=n.a.loopCount,g=i.camera._transform.position;for(o=0;o<f;o++){var v=m[o];if(!t.useOcclusionCulling||t._isLayerVisible(v._owner._layer)&&v._enable&&e._cullingBufferResult[o]){v._renderMark=p,v._distanceForSort=l.a.distance(v.bounds.getCenter(),g);var T=v._renderElements;for(h=0,_=T.length;h<_;h++){T[h]._update(e,i,r,s)}}}var E=d.elements.length;E>0&&d._quickSort(0,E-1),(E=u.elements.length)>0&&u._quickSort(0,E-1)}static cullingNative(t,e,i,a,r){return s.a.instance.culling(t,e,i,a,r)}}e.b=c,r()(c,"_tempColor0",new o.a),r()(c,"_tempVector0",new l.a),r()(c,"_cameraCullInfo",new _),r()(c,"_shadowCullInfo",new class{constructor(){r()(this,"position",void 0),r()(this,"cullPlanes",void 0),r()(this,"cullSphere",void 0),r()(this,"cullPlaneCount",void 0),r()(this,"direction",void 0)}}),r()(c,"debugFrustumCulling",!1),r()(c,"_cullingBufferLength",void 0),r()(c,"_cullingBuffer",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(37),n=i(10),o=i(46),l=i(2),h=i(3),_=i(60);let c;!function(t){t[t.PositiveX=0]="PositiveX",t[t.NegativeX=1]="NegativeX",t[t.PositiveY=2]="PositiveY",t[t.NegativeY=3]="NegativeY",t[t.PositiveZ=4]="PositiveZ",t[t.NegativeZ=5]="NegativeZ"}(c||(c={}));class d extends o.a{static get blackTexture(){return d._blackTexture}static get grayTexture(){return d._grayTexture}static __init__(){var t=new d(1,_.a.R8G8B8,!1),e=new d(1,_.a.R8G8B8,!1),i=new Uint8Array(3);i[0]=0,i[1]=0,i[2]=0,t.setSixSidePixels([i,i,i,i,i,i]),t.lock=!0,i[0]=128,i[1]=128,i[2]=128,e.setSixSidePixels([i,i,i,i,i,i]),e.lock=!0,d._grayTexture=e,d._blackTexture=t}static _parse(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;var i=e?new d(0,e[0],e[1]):new d(0);return i.setSixSideImageSources(t),i}static _parseBin(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;var i=e?new d(0,e[0],e[1]):new d(0);return i.setSixSideImageSources(t),i}static load(t,e){h.a.loader.create(t,e,null,d.TEXTURECUBE)}get defaulteTexture(){return d.grayTexture}constructor(t){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.a.R8G8B8,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this._glTextureType=l.a.instance.TEXTURE_CUBE_MAP,this._width=t,this._height=t;var e=l.a.instance;if(this._setWarpMode(e.TEXTURE_WRAP_S,this._wrapModeU),this._setWarpMode(e.TEXTURE_WRAP_T,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._mipmap){this._mipmapCount=Math.ceil(Math.log2(t))+1;for(var i=0;i<this._mipmapCount;i++)this._setPixels([],i,Math.max(t>>i,1),Math.max(t>>i,1));this._setGPUMemory(t*t*4*(1+1/3)*6)}else this._mipmapCount=1,this._setGPUMemory(t*t*4*6)}_setPixels(t,e,i,a){var r=l.a.instance,s=this._getGLFormat();n.a.bindTexture(r,this._glTextureType,this._glTexture),this.format===_.a.R8G8B8?(r.pixelStorei(r.UNPACK_ALIGNMENT,1),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_Z,e,s,i,a,0,s,r.UNSIGNED_BYTE,t[0]),r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_Z,e,s,i,a,0,s,r.UNSIGNED_BYTE,t[1]),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X,e,s,i,a,0,s,r.UNSIGNED_BYTE,t[2]),r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_X,e,s,i,a,0,s,r.UNSIGNED_BYTE,t[3]),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_Y,e,s,i,a,0,s,r.UNSIGNED_BYTE,t[4]),r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_Y,e,s,i,a,0,s,r.UNSIGNED_BYTE,t[5]),r.pixelStorei(r.UNPACK_ALIGNMENT,4)):(r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_Z,e,s,i,a,0,s,r.UNSIGNED_BYTE,t[0]),r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_Z,e,s,i,a,0,s,r.UNSIGNED_BYTE,t[1]),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X,e,s,i,a,0,s,r.UNSIGNED_BYTE,t[2]),r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_X,e,s,i,a,0,s,r.UNSIGNED_BYTE,t[3]),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_Y,e,s,i,a,0,s,r.UNSIGNED_BYTE,t[4]),r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_Y,e,s,i,a,0,s,r.UNSIGNED_BYTE,t[5]))}setSixSideImageSources(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var i,a,r=0;r<6;r++){var o=t[r];if(!o)return void console.log("TextureCube: image Source can't be null.");var h=o.width,_=o.height;if(r>0&&i!==h)return void console.log("TextureCube: each side image's width and height must same.");if((i=h)!==(a=_))return void console.log("TextureCube: each side image's width and height must same.")}this._width=i,this._height=a;var c=l.a.instance;n.a.bindTexture(c,this._glTextureType,this._glTexture);var d=this._getGLFormat();if(s.a.isConchApp){if(1==e)for(var u=0;u<6;u++)t[u].setPremultiplyAlpha(e);c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_Z,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,t[0]),c.texImage2D(c.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,t[1]),c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,t[2]),c.texImage2D(c.TEXTURE_CUBE_MAP_NEGATIVE_X,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,t[3]),c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_Y,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,t[4]),c.texImage2D(c.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,t[5])}else e&&c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_Z,0,d,d,c.UNSIGNED_BYTE,t[0]),c.texImage2D(c.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,d,d,c.UNSIGNED_BYTE,t[1]),c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X,0,d,d,c.UNSIGNED_BYTE,t[2]),c.texImage2D(c.TEXTURE_CUBE_MAP_NEGATIVE_X,0,d,d,c.UNSIGNED_BYTE,t[3]),c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_Y,0,d,d,c.UNSIGNED_BYTE,t[4]),c.texImage2D(c.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,d,d,c.UNSIGNED_BYTE,t[5]),e&&c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);this._mipmap&&this._isPot(i)&&this._isPot(a)?(c.generateMipmap(this._glTextureType),this._setGPUMemory(i*a*4*(1+1/3)*6)):this._setGPUMemory(i*a*4*6),this._setWarpMode(c.TEXTURE_WRAP_S,this._wrapModeU),this._setWarpMode(c.TEXTURE_WRAP_T,this._wrapModeV),this._setFilterMode(this._filterMode),this._readyed=!0,this._activeResource()}setSixSidePixels(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!t)throw new Error("TextureCube:pixels can't be null.");var i=Math.max(this._width>>e,1),a=Math.max(this._height>>e,1),r=i*a*this._getFormatByteCount();if(t[0].length<r)throw"TextureCube:pixels length should at least "+r+".";if(this._setPixels(t,e,i,a),0===e){var s=l.a.instance;this._setWarpMode(s.TEXTURE_WRAP_S,this._wrapModeU),this._setWarpMode(s.TEXTURE_WRAP_T,this._wrapModeV)}this._readyed=!0,this._activeResource()}setImageSource(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;var a=this._width,r=this._height;if(!e||a===e.width&&r===e.height){var s=l.a.instance;n.a.bindTexture(s,this._glTextureType,this._glTexture);var o=this._getGLFormat();switch(t){case c.NegativeX:s.texImage2D(s.TEXTURE_CUBE_MAP_NEGATIVE_X,i,o,o,s.UNSIGNED_BYTE,e);break;case c.PositiveX:s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X,i,o,o,s.UNSIGNED_BYTE,e);break;case c.NegativeY:s.texImage2D(s.TEXTURE_CUBE_MAP_NEGATIVE_Y,i,o,o,s.UNSIGNED_BYTE,e);break;case c.PositiveY:s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_Y,i,o,o,s.UNSIGNED_BYTE,e);break;case c.NegativeZ:s.texImage2D(s.TEXTURE_CUBE_MAP_NEGATIVE_Z,i,o,o,s.UNSIGNED_BYTE,e);break;case c.PositiveZ:s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_Z,i,o,o,s.UNSIGNED_BYTE,e)}this._mipmap&&this._isPot(a)&&this._isPot(r)?(s.generateMipmap(this._glTextureType),this._setGPUMemory(a*r*4*(1+1/3)*6)):this._setGPUMemory(a*r*4*6),this._setWarpMode(s.TEXTURE_WRAP_S,this._wrapModeU),this._setWarpMode(s.TEXTURE_WRAP_T,this._wrapModeV),this._setFilterMode(this._filterMode),this._readyed=!0}else console.log("TextureCube: imageSource's width and height must same.")}}e.a=d,r()(d,"TEXTURECUBE","TEXTURECUBE"),r()(d,"_blackTexture",void 0),r()(d,"_grayTexture",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(74),n=i(41),o=i(85),l=i(1),h=i(5),_=i(32),c=i(6),d=i(23),u=i(134),f=i(8),m=i(103);class p extends d.a{get id(){return this._id}get lightmapIndex(){return this._lightmapIndex}set lightmapIndex(t){this._lightmapIndex=t}get lightmapScaleOffset(){return this._lightmapScaleOffset}set lightmapScaleOffset(t){if(!t)throw"BaseRender: lightmapScaleOffset can't be null.";this._lightmapScaleOffset=t,this._shaderValues.setVector(n.a.LIGHTMAPSCALEOFFSET,t)}get enable(){return this._enable}set enable(t){this._enable=!!t}get material(){var t=this._sharedMaterials[0];if(t&&!this._materialsInstance[0]){var e=this._getInstanceMaterial(t,0),i=this._renderElements[0];i&&(i.material=e)}return this._sharedMaterials[0]}set material(t){this.sharedMaterial=t,this._isSupportReflection()}get materials(){for(var t=0,e=this._sharedMaterials.length;t<e;t++)if(!this._materialsInstance[t]){var i=this._getInstanceMaterial(this._sharedMaterials[t],t),a=this._renderElements[t];a&&(a.material=i)}return this._sharedMaterials.slice()}set materials(t){this.sharedMaterials=t,this._isSupportReflection()}get sharedMaterial(){return this._sharedMaterials[0]}set sharedMaterial(t){var e=this._sharedMaterials[0];if(e!==t){this._sharedMaterials[0]=t,this._materialsInstance[0]=!1,this._changeMaterialReference(e,t);var i=this._renderElements[0];i&&(i.material=t)}this._isSupportReflection()}get sharedMaterials(){return this._sharedMaterials.slice()}set sharedMaterials(t){for(var e=this._materialsInstance,i=this._sharedMaterials,a=0,r=i.length;a<r;a++){var s=i[a];s&&s._removeReference()}if(!t)throw new Error("BaseRender: shadredMaterials value can't be null.");var n=t.length;for(e.length=n,i.length=n,a=0;a<n;a++){s=i[a];var o=t[a];if(s!==o){e[a]=!1;var l=this._renderElements[a];l&&(l.material=o)}o&&o._addReference(),i[a]=o}this._isSupportReflection()}get bounds(){return this._boundsChange&&(this._calculateBoundingBox(),this._boundsChange=!1),this._bounds}set receiveShadow(t){this._receiveShadow!==t&&(this._receiveShadow=t,t?this._shaderValues.addDefine(n.a.SHADERDEFINE_RECEIVE_SHADOW):this._shaderValues.removeDefine(n.a.SHADERDEFINE_RECEIVE_SHADOW))}get receiveShadow(){return this._receiveShadow}get castShadow(){return this._castShadow}set castShadow(t){this._castShadow=t}get isPartOfStaticBatch(){return this._isPartOfStaticBatch}get isRender(){return-1==this._renderMark||this._renderMark==f.a.loopCount-1}set reflectionMode(t){this._reflectionMode=t}get reflectionMode(){return this._reflectionMode}constructor(t){super(),r()(this,"_id",void 0),r()(this,"_lightmapScaleOffset",new h.a(1,1,0,0)),r()(this,"_lightmapIndex",void 0),r()(this,"_receiveShadow",void 0),r()(this,"_materialsInstance",void 0),r()(this,"_indexInList",-1),r()(this,"_indexInCastShadowList",-1),r()(this,"_bounds",void 0),r()(this,"_boundsChange",!0),r()(this,"_castShadow",!1),r()(this,"_supportOctree",!0),r()(this,"_enable",void 0),r()(this,"_shaderValues",void 0),r()(this,"_sharedMaterials",[]),r()(this,"_scene",void 0),r()(this,"_owner",void 0),r()(this,"_renderElements",void 0),r()(this,"_distanceForSort",void 0),r()(this,"_renderMark",-1),r()(this,"_octreeNode",void 0),r()(this,"_indexInOctreeMotionList",-1),r()(this,"_probReflection",void 0),r()(this,"_surportReflectionProbe",void 0),r()(this,"_reflectionMode",m.b.simple),r()(this,"_updateMark",-1),r()(this,"_updateRenderType",-1),r()(this,"_isPartOfStaticBatch",!1),r()(this,"_staticBatch",null),r()(this,"sortingFudge",void 0),r()(this,"_cullingBufferIndex",void 0),this._id=++p._uniqueIDCounter,this._indexInCastShadowList=-1,this._bounds=new s.a(l.a._ZERO,l.a._ZERO),this._renderElements=[],this._owner=t,this._enable=!0,this._materialsInstance=[],this._shaderValues=new _.a(null),this.lightmapIndex=-1,this.receiveShadow=!1,this.sortingFudge=0,t&&this._owner.transform.on(c.a.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange)}_getOctreeNode(){return this._octreeNode}_setOctreeNode(t){this._octreeNode=t}_getIndexInMotionList(){return this._indexInOctreeMotionList}_setIndexInMotionList(t){this._indexInOctreeMotionList=t}_changeMaterialReference(t,e){t&&t._removeReference(),e._addReference()}_getInstanceMaterial(t,e){var i=t.clone();return i.name=i.name+"(Instance)",this._materialsInstance[e]=!0,this._changeMaterialReference(this._sharedMaterials[e],i),this._sharedMaterials[e]=i,i}_isSupportReflection(){this._surportReflectionProbe=!1;for(var t=this._sharedMaterials,e=0,i=t.length;e<i;e++){var a=t[e];this._surportReflectionProbe=this._surportReflectionProbe||a&&a._shader._supportReflectionProbe}}_addReflectionProbeUpdate(){this._surportReflectionProbe&&1==this._reflectionMode&&this._scene._reflectionProbeManager.addMotionObject(this)}_applyLightMapParams(){var t=this._scene.lightmaps,e=this._shaderValues,i=this._lightmapIndex;if(i>=0&&i<t.length){var a=t[i];e.setTexture(n.a.LIGHTMAP,a.lightmapColor),e.addDefine(n.a.SAHDERDEFINE_LIGHTMAP),a.lightmapDirection?(e.setTexture(n.a.LIGHTMAP_DIRECTION,a.lightmapDirection),e.addDefine(n.a.SHADERDEFINE_LIGHTMAP_DIRECTIONAL)):e.removeDefine(n.a.SHADERDEFINE_LIGHTMAP_DIRECTIONAL)}else e.removeDefine(n.a.SAHDERDEFINE_LIGHTMAP),e.removeDefine(n.a.SHADERDEFINE_LIGHTMAP_DIRECTIONAL)}_onWorldMatNeedChange(t){this._boundsChange=!0,this._octreeNode&&(t&=o.a.TRANSFORM_WORLDPOSITION|o.a.TRANSFORM_WORLDQUATERNION|o.a.TRANSFORM_WORLDSCALE)&&-1===this._indexInOctreeMotionList&&this._octreeNode._octree.addMotionObject(this),this._addReflectionProbeUpdate()}_calculateBoundingBox(){throw"BaseRender: must override it."}_getIndexInList(){return this._indexInList}_setIndexInList(t){this._indexInList=t}_setBelongScene(t){this._scene=t}_needRender(t,e){return!0}_renderUpdate(t,e){}_renderUpdateWithCamera(t,e){}_revertBatchRenderUpdate(t){}_destroy(){-1!==this._indexInOctreeMotionList&&this._octreeNode._octree.removeMotionObject(this),this.offAll();var t=0,e=0;for(t=0,e=this._renderElements.length;t<e;t++)this._renderElements[t].destroy();for(t=0,e=this._sharedMaterials.length;t<e;t++)this._sharedMaterials[t].destroyed||this._sharedMaterials[t]._removeReference();this._renderElements=null,this._owner=null,this._sharedMaterials=null,this._bounds=null,this._lightmapScaleOffset=null}markAsUnStatic(){this._isPartOfStaticBatch&&(u.a.instance._removeRenderSprite(this._owner),this._isPartOfStaticBatch=!1)}}e.a=p,r()(p,"_tempBoundBoxCorners",[new l.a,new l.a,new l.a,new l.a,new l.a,new l.a,new l.a,new l.a]),r()(p,"_uniqueIDCounter",0),r()(p,"_defaultLightmapScaleOffset",new h.a(1,1,0,0))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(284),n=i(135),o=i(136),l=i(457),h=i(14),_=i(52);class c extends o.a{static __init__(){c._verDec=h.a.getVertexDeclaration("POSITION,NORMAL,COLOR,UV,UV1,TANGENT")}constructor(){super(),r()(this,"_opaqueBatchMarks",[]),r()(this,"_updateCountMark",void 0),this._updateCountMark=0}_compare(t,e){var i=t._render,a=e._render,r=t.meshFilter.sharedMesh,s=e.meshFilter.sharedMesh,n=i.lightmapIndex-a.lightmapIndex;if(0===n){var o=(i.receiveShadow?1:0)-(a.receiveShadow?1:0);if(0===o){var l=i.sharedMaterial&&a.sharedMaterial?i.sharedMaterial.id-a.sharedMaterial.id:0;if(0===l){var h=r._vertexBuffer.vertexDeclaration.id-s._vertexBuffer.vertexDeclaration.id;return 0===h?s._indexBuffer.indexCount-r._indexBuffer.indexCount:h}return l}return o}return n}_getBatchRenderElementFromPool(){var t=this._batchRenderElementPool[this._batchRenderElementPoolIndex++];return t||(t=new n.a,this._batchRenderElementPool[this._batchRenderElementPoolIndex-1]=t,t.staticBatchElementList=new _.a),t}_getStaticBatch(t,e,i){var a=t[i];return a||(a=t[i]=new l.a(e,c._verDec),this._staticBatches[a._batchID]=a),a}_initStaticBatchs(t){var e=this._initBatchSprites;this._quickSort(e,0,e.length-1);for(var i,a=[],r=!1,s=0,n=0,o=e.length;n<o;n++){var l=e[n];if(r)i.addTest(l)?i.add(l):(r=!1,s++);else n!==o-1&&((i=this._getStaticBatch(a,t,s)).add(l),r=!0)}for(n=0,o=a.length;n<o;n++){var h=a[n];h&&h.finishInit()}this._initBatchSprites.length=0}_removeRenderSprite(t){var e=t._render,i=e._staticBatch,a=i._batchElements,r=a.indexOf(t);if(-1!==r){a.splice(r,1),e._staticBatch=null;for(var s=e._renderElements,n=0,o=s.length;n<o;n++)s[n].staticBatch=null}0===a.length&&(delete this._staticBatches[i._batchID],i.dispose())}_clear(){super._clear(),this._updateCountMark++}_garbageCollection(){for(var t in this._staticBatches){var e=this._staticBatches[t];0===e._batchElements.length&&(e.dispose(),delete this._staticBatches[t])}}getBatchOpaquaMark(t,e,i,a){var r=e?1:0,n=this._opaqueBatchMarks[t]||(this._opaqueBatchMarks[t]=[]),o=n[r]||(n[r]=[]),l=o[i]||(o[i]=[]);return l[a]||(l[a]=new s.a)}}e.a=c,r()(c,"_verDec",void 0),r()(c,"instance",new c)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(6),n=i(2),o=i(102),l=i(13),h=i(64),_=i(11);e.a=class extends h.a{constructor(){super(),r()(this,"_dynamicWorldPositionNormalNeedUpdate",void 0),r()(this,"_dynamicVertexBatch",void 0),r()(this,"_dynamicMultiSubMesh",void 0),r()(this,"_dynamicVertexCount",void 0),r()(this,"_dynamicWorldPositions",void 0),r()(this,"_dynamicWorldNormals",void 0),r()(this,"staticBatchIndexStart",void 0),r()(this,"staticBatchIndexEnd",void 0),r()(this,"staticBatchElementList",void 0),r()(this,"instanceSubMesh",void 0),r()(this,"instanceBatchElementList",void 0),r()(this,"vertexBatchElementList",void 0),r()(this,"vertexBatchVertexDeclaration",void 0),this._dynamicWorldPositionNormalNeedUpdate=!0}_onWorldMatrixChanged(){this._dynamicWorldPositionNormalNeedUpdate=!0}_computeWorldPositionsAndNormals(t,e,i,a){if(this._dynamicWorldPositionNormalNeedUpdate){for(var r=this._geometry,s=r._vertexBuffer,n=s.vertexDeclaration.vertexStride/4,o=s.getFloat32Data(),h=this._transform.worldMatrix,_=this._transform.rotation,c=r._indices,d=0;d<a;d++){var u=(i?c[d]:d)*n,f=3*d;l.a.transformVector3ArrayToVector3ArrayCoordinate(o,u+t,h,this._dynamicWorldPositions,f),-1!==e&&l.a.transformVector3ArrayByQuat(o,u+e,_,this._dynamicWorldNormals,f)}this._dynamicWorldPositionNormalNeedUpdate=!1}}setTransform(t){this._transform!==t&&(this._transform&&this._transform.off(s.a.TRANSFORM_CHANGED,this,this._onWorldMatrixChanged),t&&t.on(s.a.TRANSFORM_CHANGED,this,this._onWorldMatrixChanged),this._dynamicWorldPositionNormalNeedUpdate=!0,this._transform=t)}setGeometry(t){if(this._geometry!==t){var e=t,i=e._mesh;if(i){var a=i._subMeshes.length>1,r=a?e._indexCount:i._vertexCount;if(r<=_.a.SubMeshDynamicBatch.maxAllowVertexCount){var s=3*r;this._dynamicVertexBatch=!0,this._dynamicWorldPositions=new Float32Array(s),this._dynamicWorldNormals=new Float32Array(s),this._dynamicVertexCount=r,this._dynamicMultiSubMesh=a}else this._dynamicVertexBatch=!1}this._geometry=t}}addToOpaqueRenderQueue(t,e){var i=this.staticBatch,a=e.elements,r=a.elements;if(!i||this.render._probReflection&&!this.render._probReflection._isScene)if(this.renderSubShader._owner._enableInstancing&&n.a.layaGPUInstance.supportInstance()&&this.render.lightmapIndex<0&&(!this.render._probReflection||this.render._probReflection._isScene)){var s=this._geometry,l=_.a.MeshRenderDynamicBatchManager.instance,c=l.getInstanceBatchOpaquaMark(this.render.receiveShadow,this.material.id,s._id,this._transform._isFrontFaceInvert);if(l._updateCountMark===c.updateMark){var d=c.indexInList;if(c.batched){var u=r[d].instanceBatchElementList;u.length===o.a.instance.maxInstanceCount?(c.updateMark=l._updateCountMark,c.indexInList=a.length,c.batched=!1,a.add(this)):u.add(this)}else{var f=r[d],m=f.render,p=l._getBatchRenderElementFromPool();p.renderType=h.a.RENDERTYPE_INSTANCEBATCH,p.setGeometry(o.a.instance),p.material=f.material,p.setTransform(null),p.render=m,p.instanceSubMesh=s,p.renderSubShader=f.renderSubShader;var g=p.instanceBatchElementList;g.length=0,g.add(f),g.add(this),r[d]=p,c.batched=!0}}else c.updateMark=l._updateCountMark,c.indexInList=a.length,c.batched=!1,a.add(this)}else if(this._dynamicVertexBatch){var v=this._geometry._vertexBuffer.vertexDeclaration,T=_.a.MeshRenderDynamicBatchManager.instance,E=T.getVertexBatchOpaquaMark(this.render.lightmapIndex+1,this.render.receiveShadow,this.material.id,v.id);if(T._updateCountMark===E.updateMark){var S=E.indexInList;if(E.batched)r[S].vertexBatchElementList.add(this);else{var R=r[S],x=R.render,A=T._getBatchRenderElementFromPool();A.renderType=h.a.RENDERTYPE_VERTEXBATCH,A.setGeometry(_.a.SubMeshDynamicBatch.instance),A.material=R.material,A.setTransform(null),A.render=x,A.vertexBatchVertexDeclaration=v,A.renderSubShader=R.renderSubShader;var y=A.vertexBatchElementList;y.length=0,y.add(R),y.add(this),r[S]=A,E.batched=!0}}else E.updateMark=T._updateCountMark,E.indexInList=a.length,E.batched=!1,a.add(this)}else a.add(this);else{var I=_.a.MeshRenderStaticBatchManager.instance,C=I.getBatchOpaquaMark(this.render.lightmapIndex+1,this.render.receiveShadow,this.material.id,i._batchID);if(I._updateCountMark===C.updateMark){var M=C.indexInList;if(C.batched)r[M].staticBatchElementList.add(this);else{var D=r[M],b=D.render,L=I._getBatchRenderElementFromPool();L.renderType=h.a.RENDERTYPE_STATICBATCH,L.setGeometry(i),L.material=D.material;var O=i.batchOwner,P=O?O._transform:null;L.setTransform(P),L.render=b,L.renderSubShader=D.renderSubShader;var N=L.staticBatchElementList;N.length=0,N.add(D),N.add(this),r[M]=L,C.batched=!0}}else C.updateMark=I._updateCountMark,C.indexInList=a.length,C.batched=!1,a.add(this)}}addToTransparentRenderQueue(t,e){var i=this.staticBatch,a=e.elements,r=a.elements;if(i){var s=_.a.MeshRenderStaticBatchManager.instance,l=e.lastTransparentRenderElement;if(l){var c=l.render;if(l._geometry._getType()!==this._geometry._getType()||l.staticBatch!==i||l.material!==this.material||c.receiveShadow!==this.render.receiveShadow||c.lightmapIndex!==this.render.lightmapIndex)a.add(this),e.lastTransparentBatched=!1;else{if(e.lastTransparentBatched)r[a.length-1].staticBatchElementList.add(this);else{var d=s._getBatchRenderElementFromPool();d.renderType=h.a.RENDERTYPE_STATICBATCH,d.setGeometry(i),d.material=l.material;var u=i.batchOwner,f=u?u._transform:null;d.setTransform(f),d.render=this.render,d.renderSubShader=l.renderSubShader;var m=d.staticBatchElementList;m.length=0,m.add(l),m.add(this),r[a.length-1]=d}e.lastTransparentBatched=!0}}else a.add(this),e.lastTransparentBatched=!1}else if(this.renderSubShader._owner._enableInstancing&&n.a.layaGPUInstance.supportInstance()&&this.render.lightmapIndex<0&&(!this.render._probReflection||this.render._probReflection._isScene)){var p=this._geometry,g=_.a.MeshRenderDynamicBatchManager.instance,v=e.lastTransparentRenderElement;if(v){var T=v.render;if(v._geometry._getType()!==this._geometry._getType()||v._geometry!==p||v.material!==this.material||T.receiveShadow!==this.render.receiveShadow)a.add(this),e.lastTransparentBatched=!1;else if(e.lastTransparentBatched){var E=r[a.length-1].instanceBatchElementList;E.length===o.a.instance.maxInstanceCount?(a.add(this),e.lastTransparentBatched=!1):(E.add(this),e.lastTransparentBatched=!0)}else{var S=g._getBatchRenderElementFromPool();S.renderType=h.a.RENDERTYPE_INSTANCEBATCH,S.setGeometry(o.a.instance),S.material=v.material,S.setTransform(null),S.render=this.render,S.instanceSubMesh=p,S.renderSubShader=v.renderSubShader;var R=S.instanceBatchElementList;R.length=0,R.add(v),R.add(this),r[a.length-1]=S,e.lastTransparentBatched=!0}}else a.add(this),e.lastTransparentBatched=!1}else if(this._dynamicVertexBatch){var x=this._geometry._vertexBuffer.vertexDeclaration,A=_.a.MeshRenderDynamicBatchManager.instance,y=e.lastTransparentRenderElement;if(y){var I=y.render;if(y._dynamicVertexBatch&&y._geometry._getType()===this._geometry._getType()&&y._geometry._vertexBuffer._vertexDeclaration===x&&y.material===this.material&&I.receiveShadow===this.render.receiveShadow&&I.lightmapIndex===this.render.lightmapIndex){if(e.lastTransparentBatched)r[a.length-1].vertexBatchElementList.add(this);else{var C=A._getBatchRenderElementFromPool();C.renderType=h.a.RENDERTYPE_VERTEXBATCH,C.setGeometry(_.a.SubMeshDynamicBatch.instance),C.material=y.material,C.setTransform(null),C.render=this.render,C.vertexBatchVertexDeclaration=x,C.renderSubShader=y.renderSubShader;var M=C.vertexBatchElementList;M.length=0,M.add(y),M.add(this),r[a.length-1]=C}e.lastTransparentBatched=!0}else a.add(this),e.lastTransparentBatched=!1}else a.add(this),e.lastTransparentBatched=!1}else a.add(this);e.lastTransparentRenderElement=this}getInvertFront(){switch(this.renderType){case h.a.RENDERTYPE_NORMAL:return this._transform._isFrontFaceInvert;case h.a.RENDERTYPE_STATICBATCH:case h.a.RENDERTYPE_VERTEXBATCH:return!1;case h.a.RENDERTYPE_INSTANCEBATCH:return this.instanceBatchElementList.elements[0]._transform._isFrontFaceInvert;default:throw"SubMeshRenderElement: unknown renderType"}}destroy(){super.destroy(),this._dynamicWorldPositions=null,this._dynamicWorldNormals=null,this.staticBatch=null,this.staticBatchElementList=null,this.vertexBatchElementList=null,this.vertexBatchVertexDeclaration=null}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(41);class n{static _addToStaticBatchQueue(t,e){t instanceof s.a&&e.push(t);for(var i=0,a=t.numChildren;i<a;i++)n._addToStaticBatchQueue(t._children[i],e)}static _registerManager(t){n._managers.push(t)}static combine(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e||(e=[],t&&n._addToStaticBatchQueue(t,e));var i=e.length;if(i>0){for(var a=0;a<i;a++){var r=e[a];r.destroyed||(r._render._isPartOfStaticBatch?console.warn("StaticBatchManager: Sprite "+r.name+" has a part of Static Batch,it will be ignore."):r._addToInitStaticBatchManager())}for(var s=0,o=n._managers.length;s<o;s++){n._managers[s]._initStaticBatchs(t)}}}constructor(){r()(this,"_batchRenderElementPool",void 0),r()(this,"_batchRenderElementPoolIndex",void 0),r()(this,"_initBatchSprites",[]),r()(this,"_staticBatches",{}),this._batchRenderElementPoolIndex=0,this._batchRenderElementPool=[]}_partition(t,e,i){for(var a=t[Math.floor((i+e)/2)];e<=i;){for(;this._compare(t[e],a)<0;)e++;for(;this._compare(t[i],a)>0;)i--;if(e<i){var r=t[e];t[e]=t[i],t[i]=r,e++,i--}else if(e===i){e++;break}}return e}_quickSort(t,e,i){if(t.length>1){var a=this._partition(t,e,i),r=a-1;e<r&&this._quickSort(t,e,r),a<i&&this._quickSort(t,a,i)}}_compare(t,e){throw"StaticBatch:must override this function."}_initStaticBatchs(t){throw"StaticBatch:must override this function."}_getBatchRenderElementFromPool(){throw"StaticBatch:must override this function."}_addBatchSprite(t){this._initBatchSprites.push(t)}_clear(){this._batchRenderElementPoolIndex=0}_garbageCollection(){throw"StaticBatchManager: must override it."}dispose(){this._staticBatches=null}}e.a=n,r()(n,"_managers",[])},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(8),o=i(75),l=i(192),h=i(39);class _ extends o.a{get indexCount(){return this._indexCount}constructor(t){super(),r()(this,"_mesh",void 0),r()(this,"_boneIndicesList",void 0),r()(this,"_subIndexBufferStart",void 0),r()(this,"_subIndexBufferCount",void 0),r()(this,"_skinAnimationDatas",void 0),r()(this,"_indexInMesh",void 0),r()(this,"_vertexStart",void 0),r()(this,"_indexStart",void 0),r()(this,"_indexCount",void 0),r()(this,"_indices",void 0),r()(this,"_vertexBuffer",void 0),r()(this,"_indexBuffer",void 0),r()(this,"_id",void 0),this._id=++_._uniqueIDCounter,this._mesh=t,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}_setIndexRange(t,e){this._indexStart=t,this._indexCount=e,this._indices=new Uint16Array(this._indexBuffer.getData().buffer,2*t,e)}_getType(){return _._type}_prepareRender(t){return this._mesh._uploadVerticesData(),!0}_render(t){var e=this._mesh;if(e.indexFormat!==h.a.UInt32||s.a.layaGPUInstance.supportElementIndexUint32()){var i,a,r=s.a.instance,o=t.renderElement.render._skinnedData;switch(e.indexFormat){case h.a.UInt32:i=r.UNSIGNED_INT,a=4;break;case h.a.UInt16:i=r.UNSIGNED_SHORT,a=2;break;case h.a.UInt8:i=r.UNSIGNED_BYTE,a=1}if(e._bufferState.bind(),o)for(var _=o[this._indexInMesh],c=0,d=this._boneIndicesList.length;c<d;c++)t.shader.uploadCustomUniform(l.a.BONES,_[c]),r.drawElements(r.TRIANGLES,this._subIndexBufferCount[c],i,this._subIndexBufferStart[c]*a);else r.drawElements(r.TRIANGLES,this._indexCount,i,this._indexStart*a);n.a.trianglesFaces+=this._indexCount/3,n.a.renderBatches++}else console.warn("SubMesh:this device do not support IndexFormat.UInt32.")}getIndices(){if(this._mesh._isReadable)return this._indices.slice();throw"SubMesh:can't get indices on subMesh,mesh's isReadable must be true."}setIndices(t){this._indexBuffer.setData(t,this._indexStart,0,this._indexCount)}destroy(){this._destroyed||(super.destroy(),this._indexBuffer.destroy(),this._indexBuffer=null,this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null)}}e.a=_,r()(_,"_uniqueIDCounter",0),r()(_,"_type",o.a._typeCounter++)},function(t,e,i){"use strict";var a=i(139),r=i(144),s=i(145),n=i(59),o=[].sort,l=[1,2,3];a(a.P+a.F*(n(function(){l.sort(void 0)})||!n(function(){l.sort(null)})||!i(309)(o)),"Array",{sort:function(t){return void 0===t?o.call(s(this)):o.call(s(this),r(t))}})},function(t,e,i){var a=i(44),r=i(140),s=i(65),n=i(78),o=i(198),l=function(t,e,i){var h,_,c,d,u=t&l.F,f=t&l.G,m=t&l.S,p=t&l.P,g=t&l.B,v=f?a:m?a[e]||(a[e]={}):(a[e]||{}).prototype,T=f?r:r[e]||(r[e]={}),E=T.prototype||(T.prototype={});for(h in f&&(i=e),i)c=((_=!u&&v&&void 0!==v[h])?v:i)[h],d=g&&_?o(c,a):p&&"function"==typeof c?o(Function.call,c):c,v&&n(v,h,c,t&l.U),T[h]!=c&&s(T,h,d),p&&E[h]!=c&&(E[h]=c)};a.core=r,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,t.exports=l},function(t,e){var i=t.exports={version:"2.6.12"};"number"==typeof __e&&(__e=i)},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){var i=0,a=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++i+a).toString(36))}},function(t,e,i){var a=i(140),r=i(44),s=r["__core-js_shared__"]||(r["__core-js_shared__"]={});(t.exports=function(t,e){return s[t]||(s[t]=void 0!==e?e:{})})("versions",[]).push({version:a.version,mode:i(197)?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,i){var a=i(107);t.exports=function(t){return Object(a(t))}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(199),n=i(84),o=i(200),l=i(354),h=i(235),_=i(201),c=i(202),d=i(203),u=i(204),f=i(205),m=i(206),p=i(207),g=i(208),v=i(209),T=i(210),E=i(355),S=i(234),R=i(356),x=i(215),A=i(216),y=i(217),I=i(236),C=i(218),M=i(219),D=i(220),b=i(6),L=i(16),O=i(37),P=i(48),N=i(21),w=i(237),B=i(3);e.a=class{constructor(){r()(this,"_sp",null),r()(this,"_one",null),r()(this,"_render",this._renderEmpty),r()(this,"_cmds",null),r()(this,"_vectorgraphArray",null),r()(this,"_graphicBounds",null),r()(this,"autoDestroy",!1),this._createData()}_createData(){}_clearData(){}_destroyData(){}destroy(){this.clear(!0),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0,this._sp._setRenderType(0),this._sp=null),this._destroyData()}clear(){if(arguments.length>0&&void 0!==arguments[0]&&!arguments[0])this._cmds=null;else{var t=this._one;if(this._cmds){var e,i=this._cmds.length;for(e=0;e<i;e++)(t=this._cmds[e]).recover();this._cmds.length=0}else t&&t.recover()}if(this._one=null,this._render=this._renderEmpty,this._clearData(),this._sp&&(this._sp._renderType&=~n.a.GRAPHICS,this._sp._setRenderType(this._sp._renderType)),this._repaint(),this._vectorgraphArray){for(e=0,i=this._vectorgraphArray.length;e<i;e++)w.a.getInstance().deleteShape(this._vectorgraphArray[e]);this._vectorgraphArray.length=0}}_clearBoundsCache(){this._graphicBounds&&this._graphicBounds.reset()}_initGraphicBounds(){this._graphicBounds||(this._graphicBounds=s.a.create(),this._graphicBounds._graphics=this)}_repaint(){this._clearBoundsCache(),this._sp&&this._sp.repaint()}_isOnlyOne(){return!this._cmds||0===this._cmds.length}get cmds(){return this._cmds}set cmds(t){this._sp&&(this._sp._renderType|=n.a.GRAPHICS,this._sp._setRenderType(this._sp._renderType)),this._cmds=t,this._render=this._renderAll,this._repaint()}getBounds(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._initGraphicBounds(),this._graphicBounds.getBounds(t)}getBoundPoints(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._initGraphicBounds(),this._graphicBounds.getBoundPoints(t)}drawImage(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!t)return null;if(a||(a=t.sourceWidth),r||(r=t.sourceHeight),t.getIsReady()){var s=a/t.sourceWidth,o=r/t.sourceHeight;if(a=t.width*s,r=t.height*o,a<=0||r<=0)return null;e+=t.offsetX*s,i+=t.offsetY*o}this._sp&&(this._sp._renderType|=n.a.GRAPHICS,this._sp._setRenderType(this._sp._renderType));var l=d.a.create.call(this,t,e,i,a,r);return null==this._one?(this._one=l,this._render=this._renderOneImg):this._saveToCmd(null,l),this._repaint(),l}drawTexture(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,_=arguments.length>9?arguments[9]:void 0;if(!t||o<.01)return null;if(!t.getIsReady())return null;if(a||(a=t.sourceWidth),r||(r=t.sourceHeight),t.getIsReady()){var c=a/t.sourceWidth,d=r/t.sourceHeight;if(a=t.width*c,r=t.height*d,a<=0||r<=0)return null;e+=t.offsetX*c,i+=t.offsetY*d}this._sp&&(this._sp._renderType|=n.a.GRAPHICS,this._sp._setRenderType(this._sp._renderType));var u=T.a.create.call(this,t,e,i,a,r,s,o,l,h,_);return this._repaint(),this._saveToCmd(null,u)}drawTextures(t,e){return t?this._saveToCmd(O.a._context.drawTextures,E.a.create.call(this,t,e)):null}drawTriangles(t,e,i,a,r,s){let n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,_=arguments.length>10&&void 0!==arguments[10]?arguments[10]:void 0;return this._saveToCmd(O.a._context.drawTriangles,S.a.create.call(this,t,e,i,a,r,s,n,o,l,h,_))}fillTexture(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"repeat",n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return t&&t.getIsReady()?this._saveToCmd(O.a._context._fillTexture,x.a.create.call(this,t,e,i,a,r,s,n||L.a.EMPTY,{})):null}_saveToCmd(t,e){return this._sp&&(this._sp._renderType|=n.a.GRAPHICS,this._sp._setRenderType(this._sp._renderType)),null==this._one?(this._one=e,this._render=this._renderOne):(this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(e)),this._repaint(),e}clipRect(t,e,i,a){return this._saveToCmd(O.a._context.clipRect,l.a.create.call(this,t,e,i,a))}fillText(t,e,i,a,r,s){return this._saveToCmd(O.a._context.fillText,R.a.create.call(this,t,null,e,i,a||B.a.Text.defaultFontStr(),r,s,0,""))}fillBorderText(t,e,i,a,r,s,n,o){return this._saveToCmd(O.a._context.fillText,R.a.create.call(this,t,null,e,i,a||B.a.Text.defaultFontStr(),r,s,n,o))}fillWords(t,e,i,a,r){return this._saveToCmd(O.a._context.fillText,R.a.create.call(this,null,t,e,i,a||B.a.Text.defaultFontStr(),r))}fillBorderWords(t,e,i,a,r,s,n){return this._saveToCmd(O.a._context.fillText,R.a.create.call(this,null,t,e,i,a||B.a.Text.defaultFontStr(),r,"",n,s))}strokeText(t,e,i,a,r,s,n){return this._saveToCmd(O.a._context.fillText,R.a.create.call(this,t,null,e,i,a||B.a.Text.defaultFontStr(),null,n,s,r))}alpha(t){return this._saveToCmd(O.a._context.alpha,o.a.create.call(this,t))}transform(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this._saveToCmd(O.a._context._transform,M.a.create.call(this,t,e,i))}rotate(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this._saveToCmd(O.a._context._rotate,y.a.create.call(this,t,e,i))}scale(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this._saveToCmd(O.a._context._scale,C.a.create.call(this,t,e,i,a))}translate(t,e){return this._saveToCmd(O.a._context.translate,D.a.create.call(this,t,e))}save(){return this._saveToCmd(O.a._context._save,I.a.create.call(this))}restore(){return this._saveToCmd(O.a._context.restore,A.a.create.call(this))}replaceText(t){this._repaint();var e=this._cmds;if(e){for(var i=e.length-1;i>-1;i--)if(this._isTextCmd(e[i]))return e[i].text=t,!0}else if(this._one&&this._isTextCmd(this._one))return this._one.text=t,!0;return!1}_isTextCmd(t){return t.cmdID==R.a.ID}replaceTextColor(t){this._repaint();var e=this._cmds;if(e)for(var i=e.length-1;i>-1;i--)this._isTextCmd(e[i])&&this._setTextCmdColor(e[i],t);else this._one&&this._isTextCmd(this._one)&&this._setTextCmdColor(this._one,t)}_setTextCmdColor(t,e){switch(t.cmdID){case R.a.ID:t.color=e}}loadImage(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;var n=B.a.Loader.getRes(t);n?n.getIsReady()?this.drawImage(n,e,i,a,r):n.once(b.a.READY,this,this.drawImage,[n,e,i,a,r]):((n=new P.a).load(t),B.a.Loader.cacheTexture(t,n),n.once(b.a.READY,this,this.drawImage,[n,e,i,a,r])),null!=s&&(n.getIsReady()?s.call(this._sp):n.on(b.a.READY,this._sp,s))}_renderEmpty(t,e,i,a){}_renderAll(t,e,i,a){for(var r=this._cmds,s=0,n=r.length;s<n;s++)r[s].run(e,i,a)}_renderOne(t,e,i,a){e.sprite=t,this._one.run(e,i,a)}_renderOneImg(t,e,i,a){e.sprite=t,this._one.run(e,i,a)}drawLine(t,e,i,a,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;var n=s<1||s%2==0?0:.5;return this._saveToCmd(O.a._context._drawLine,u.a.create.call(this,t+n,e+n,i+n,a+n,r,s,0))}drawLines(t,e,i,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(!i||i.length<4)return null;var s=r<1||r%2==0?0:.5;return this._saveToCmd(O.a._context._drawLines,f.a.create.call(this,t+s,e+s,i,a,r,0))}drawCurves(t,e,i,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return this._saveToCmd(O.a._context.drawCurves,c.a.create.call(this,t,e,i,a,r))}drawRect(t,e,i,a,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;var o=n>=1&&s?n/2:0,l=s?n:0;return this._saveToCmd(O.a._context.drawRect,v.a.create.call(this,t+o,e+o,i-l,a-l,r,s,n))}drawCircle(t,e,i,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;var n=s>=1&&r?s/2:0;return this._saveToCmd(O.a._context._drawCircle,_.a.create.call(this,t,e,i-n,a,r,s,0))}drawPie(t,e,i,a,r,s){let n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1;var l=o>=1&&n?o/2:0,h=n?o:0;return this._saveToCmd(O.a._context._drawPie,p.a.create.call(this,t+l,e+l,i-h,N.a.toRadian(a),N.a.toRadian(r),s,n,o,0))}drawPoly(t,e,i,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;var n=!1;n=!(i.length>6);var o=s>=1&&r?s%2==0?0:.5:0;return this._saveToCmd(O.a._context._drawPoly,g.a.create.call(this,t+o,e+o,i,a,r,s,n,0))}drawPath(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return this._saveToCmd(O.a._context._drawPath,m.a.create.call(this,t,e,i,a,r))}draw9Grid(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;this._saveToCmd(null,h.a.create(t,e,i,a,r,s))}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(148),n=i(68);class o extends s.a{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),r()(this,"_mat",void 0),r()(this,"_alpha",void 0),r()(this,"_matrix",void 0),t||(t=this._copyMatrix(o.IDENTITY_MATRIX)),this._mat=new Float32Array(16),this._alpha=new Float32Array(4),this.setByMatrix(t)}gray(){return this.setByMatrix(o.GRAY_MATRIX)}color(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return this.setByMatrix([1,0,0,0,t,0,1,0,0,e,0,0,1,0,i,0,0,0,1,a])}setColor(t){var e=n.a.create(t).arrColor,i=[0,0,0,0,256*e[0],0,0,0,0,256*e[1],0,0,0,0,256*e[2],0,0,0,1,0];return this.setByMatrix(i)}setByMatrix(t){this._matrix!=t&&this._copyMatrix(t);for(var e=0,i=0,a=0;a<20;a++)a%5!=4?this._mat[e++]=t[a]:this._alpha[i++]=t[a];return this}get type(){return s.a.COLOR}adjustColor(t,e,i,a){return this.adjustHue(a),this.adjustContrast(e),this.adjustBrightness(t),this.adjustSaturation(i),this}adjustBrightness(t){return 0==(t=this._clampValue(t,100))||isNaN(t)?this:this._multiplyMatrix([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0,0,0,0,0,1])}adjustContrast(t){if(0==(t=this._clampValue(t,100))||isNaN(t))return this;var e,i=(e=t<0?127+t/100*127:127*(e=0==(e=t%1)?o.DELTA_INDEX[t]:o.DELTA_INDEX[t<<0]*(1-e)+o.DELTA_INDEX[1+(t<<0)]*e)+127)/127,a=.5*(127-e);return this._multiplyMatrix([i,0,0,0,a,0,i,0,0,a,0,0,i,0,a,0,0,0,1,0,0,0,0,0,1])}adjustSaturation(t){if(0==(t=this._clampValue(t,100))||isNaN(t))return this;var e=1+(t>0?3*t/100:t/100),i=1-e,a=.3086*i,r=.6094*i,s=.082*i;return this._multiplyMatrix([a+e,r,s,0,0,a,r+e,s,0,0,a,r,s+e,0,0,0,0,0,1,0,0,0,0,0,1])}adjustHue(t){if(0==(t=this._clampValue(t,180)/180*Math.PI)||isNaN(t))return this;var e=Math.cos(t),i=Math.sin(t),a=.213,r=.715,s=.072;return this._multiplyMatrix([a+e*(1-a)+i*-a,r+e*-r+i*-r,s+e*-s+i*(1-s),0,0,a+e*-a+.143*i,r+e*(1-r)+.14*i,s+e*-s+-.283*i,0,0,a+e*-a+-.787*i,r+e*-r+i*r,s+e*(1-s)+i*s,0,0,0,0,0,1,0,0,0,0,0,1])}reset(){return this.setByMatrix(this._copyMatrix(o.IDENTITY_MATRIX))}_multiplyMatrix(t){var e=[];this._matrix=this._fixMatrix(this._matrix);for(var i=0;i<5;i++){for(var a=0;a<5;a++)e[a]=this._matrix[a+5*i];for(a=0;a<5;a++){for(var r=0,s=0;s<5;s++)r+=t[a+5*s]*e[s];this._matrix[a+5*i]=r}}return this.setByMatrix(this._matrix)}_clampValue(t,e){return Math.min(e,Math.max(-e,t))}_fixMatrix(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null==t?o.IDENTITY_MATRIX:(t.length<o.LENGTH?t=t.slice(0,t.length).concat(o.IDENTITY_MATRIX.slice(t.length,o.LENGTH)):t.length>o.LENGTH&&(t=t.slice(0,o.LENGTH)),t)}_copyMatrix(t){var e=o.LENGTH;this._matrix||(this._matrix=[]);for(var i=0;i<e;i++)this._matrix[i]=t[i];return this._matrix}}e.a=o,r()(o,"DELTA_INDEX",[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10]),r()(o,"GRAY_MATRIX",[.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0]),r()(o,"IDENTITY_MATRIX",[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]),r()(o,"LENGTH",25)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(15),n=i(16),o=i(26),l=i(108),h=i(212),_=i(67),c=i(29),d=i(36),u=i(153);class f{constructor(){r()(this,"_glRender",void 0)}get type(){return-1}}e.a=f,r()(f,"BLUR",16),r()(f,"COLOR",32),r()(f,"GLOW",8),r()(f,"_filter",function(t,e,i,a){var r=e,m=this._next;if(m){var p=t.filters,g=p.length;if(1==g&&p[0].type==f.COLOR)return e.save(),e.setColorFilter(p[0]),m._fun.call(m,t,e,i,a),void e.restore();var v,T=d.a.create(c.a.TEXTURE2D,0),E=n.a.TEMP,S=r._curMat,R=s.a.create();S.copyTo(R);var x=0,A=0,y=null,I=t._cacheStyle.filterCache||null;if(I&&0==t.getRepaint()){if((t._cacheStyle.hasGlowFilter||!1)&&(x=50,A=25),(v=t.getBounds()).width<=0||v.height<=0)return;v.width+=x,v.height+=x,E.x=v.x*R.a+v.y*R.c,E.y=v.y*R.d+v.x*R.b,v.x=E.x,v.y=E.y,E.x=v.width*R.a+v.height*R.c,E.y=v.height*R.d+v.width*R.b,v.width=E.x,v.height=E.y}else{t._isHaveGlowFilter()&&(x=50,A=25),(v=new o.a).copyFrom(t.getSelfBounds()),v.x+=t.x,v.y+=t.y,v.x-=t.pivotX+4,v.y-=t.pivotY+4;var C=v.x,M=v.y;if(v.width+=x+8,v.height+=x+8,E.x=v.x*R.a+v.y*R.c,E.y=v.y*R.d+v.x*R.b,v.x=E.x,v.y=E.y,E.x=v.width*R.a+v.height*R.c,E.y=v.height*R.d+v.width*R.b,v.width=E.x,v.height=E.y,v.width<=0||v.height<=0)return;I&&h.a.releaseRT(I),y=h.a.getRT(v.width,v.height);var D=I=h.a.getRT(v.width,v.height);t._getCacheStyle().filterCache=I,r.pushRT(),r.useRT(y);var b=t.x-C+A,L=t.y-M+A;m._fun.call(m,t,e,b,L),r.useRT(D);for(var O=0;O<g;O++){0!=O&&(r.useRT(y),r.drawTarget(D,0,0,v.width,v.height,s.a.TEMP.identity(),T,null,_.a.TOINT.overlay),r.useRT(D));var P=p[O];switch(P.type){case f.BLUR:case f.GLOW:P._glRender&&P._glRender.render(y,e,v.width,v.height,P);break;case f.COLOR:r.setColorFilter(P),r.drawTarget(y,0,0,v.width,v.height,s.a.EMPTY.identity(),d.a.create(c.a.TEXTURE2D,0)),r.setColorFilter(null)}}r.popRT()}if(i=i-A-t.x,a=a-A-t.y,E.setTo(i,a),R.transformPoint(E),i=E.x+v.x,a=E.y+v.y,r._drawRenderTexture(I,i,a,v.width,v.height,s.a.TEMP.identity(),1,l.a.defuv),y){var N=u.a.create([y],function(t){t.destroy()},this);y=null,e.addRenderObject(N)}R.destroy()}})},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(17);e.a=class extends s.a{get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}constructor(){super(),r()(this,"_width",void 0),r()(this,"_height",void 0),this._width=-1,this._height=-1}_getSource(){throw"Bitmap: must override it."}}},function(t,e,i){"use strict";var a=i(310)(!0);t.exports=function(t,e,i){return e+(i?a(t,e).length:1)}},function(t,e){var i={}.toString;t.exports=function(t){return i.call(t).slice(8,-1)}},function(t,e,i){"use strict";var a=i(113),r=RegExp.prototype.exec,s=String.prototype.replace,n=r,o=function(){var t=/a/,e=/b*/g;return r.call(t,"a"),r.call(e,"a"),0!==t.lastIndex||0!==e.lastIndex}(),l=void 0!==/()??/.exec("")[1];(o||l)&&(n=function(t){var e,i,n,h,_=this;return l&&(i=new RegExp("^"+_.source+"$(?!\\s)",a.call(_))),o&&(e=_.lastIndex),n=r.call(_,t),o&&n&&(_.lastIndex=_.global?n.index+n[0].length:e),l&&n&&n.length>1&&s.call(n[0],i,function(){for(h=1;h<arguments.length-2;h++)void 0===arguments[h]&&(n[h]=void 0)}),n}),t.exports=n},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(93);class n{constructor(){r()(this,"fun",void 0),r()(this,"_this",void 0),r()(this,"args",void 0),r()(this,"_ref",1),r()(this,"_key",new s.a)}renderSubmit(){return this.fun.apply(this._this,this.args),1}getRenderType(){return 0}releaseRender(){if(--this._ref<1){var t=n.POOL;t[t._length++]=this}}static create(t,e,i){var a=n.POOL._length?n.POOL[--n.POOL._length]:new n;return a.fun=e,a.args=t,a._this=i,a._ref=1,a._key.clear(),a}}e.a=n,r()(n,"POOL",[]),n.POOL._length=0},function(t,e,i){var a=i(143)("keys"),r=i(142);t.exports=function(t){return a[t]||(a[t]=r(t))}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(119);class n extends s.a{static __int__(){n._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}constructor(){super(n.const_stride,4,4),this.canReuse=!0,this.setAttributes(n._fixattriInfo),n._fixib?(this._ib=n._fixib,this._quadNum=n._maxIB):(this.createQuadIB(n._maxIB),n._fixib=this._ib)}static getAMesh(t){var e=null;return e=n._POOL.length?n._POOL.pop():new n,t&&e._vb._resizeBuffer(65536*n.const_stride,!1),e}releaseMesh(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,n._POOL.push(this)}destroy(){this._vb.destroy(),this._vb.deleteBuffer()}addQuad(t,e,i,a){var r=this._vb,s=r._byteLength>>2;r.setByteLength(s+n.const_stride<<2);var o=r._floatArray32||r.getFloat32Array(),l=r._uint32Array,h=s,_=a?255:0;o[h++]=t[0],o[h++]=t[1],o[h++]=e[0],o[h++]=e[1],l[h++]=i,l[h++]=_,o[h++]=t[2],o[h++]=t[3],o[h++]=e[2],o[h++]=e[3],l[h++]=i,l[h++]=_,o[h++]=t[4],o[h++]=t[5],o[h++]=e[4],o[h++]=e[5],l[h++]=i,l[h++]=_,o[h++]=t[6],o[h++]=t[7],o[h++]=e[6],o[h++]=e[7],l[h++]=i,l[h++]=_,r._upload=!0}}e.a=n,r()(n,"const_stride",24),r()(n,"_fixib",void 0),r()(n,"_maxIB",16384),r()(n,"_fixattriInfo",void 0),r()(n,"_POOL",[])},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2);class n{constructor(){r()(this,"_nativeVertexArrayObject",void 0),r()(this,"_bindedIndexBuffer",void 0),this._nativeVertexArrayObject=s.a.layaGPUInstance.createVertexArray()}bind(){n._curBindedBufferState!==this&&(s.a.layaGPUInstance.bindVertexArray(this._nativeVertexArrayObject),n._curBindedBufferState=this)}unBind(){if(n._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";s.a.layaGPUInstance.bindVertexArray(null),n._curBindedBufferState=null}destroy(){s.a.layaGPUInstance.deleteVertexArray(this._nativeVertexArrayObject)}bindForNative(){s.a.instance.bindVertexArray(this._nativeVertexArrayObject),n._curBindedBufferState=this}unBindForNative(){s.a.instance.bindVertexArray(null),n._curBindedBufferState=null}}e.a=n,r()(n,"_curBindedBufferState",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(83),o=i(91),l=i(95);class h extends l.a{static __int__(t){}get bufferLength(){return this._buffer.byteLength}set byteLength(t){this.setByteLength(t)}setByteLength(t){this._byteLength!==t&&(t<=this._bufferSize||this._resizeBuffer(2*t+256,!0),this._byteLength=t)}needSize(t){var e=this._byteLength;if(t){var i=this._byteLength+t;i<=this._bufferSize||this._resizeBuffer(i<<1,!0),this._byteLength=i}return e}constructor(){super(),r()(this,"_maxsize",0),r()(this,"_upload",!0),r()(this,"_uploadSize",0),r()(this,"_bufferSize",0),r()(this,"_u8Array",null)}_bufferData(){this._maxsize=Math.max(this._maxsize,this._byteLength),n.a.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,s.a.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)),s.a.instance.bufferSubData(this._bufferType,0,new Uint8Array(this._buffer,0,this._byteLength))}_bufferSubData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this._maxsize=Math.max(this._maxsize,this._byteLength),n.a.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,s.a.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)),e||i){var a=this._buffer.slice(e,i);s.a.instance.bufferSubData(this._bufferType,t,a)}else s.a.instance.bufferSubData(this._bufferType,t,this._buffer)}_checkArrayUse(){}_bind_uploadForVAO(){return!!this._upload&&(this._upload=!1,this._bindForVAO(),this._bufferData(),!0)}_bind_upload(){return!!this._upload&&(this._upload=!1,this.bind(),this._bufferData(),!0)}_bind_subUpload(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return!!this._upload&&(this._upload=!1,this.bind(),this._bufferSubData(t,e,i),!0)}_resizeBuffer(t,e){var i=this._buffer;if(t<=i.byteLength)return this;var a=this._u8Array;if(e&&i&&i.byteLength>0){var r=new ArrayBuffer(t),s=a&&a.buffer==i?a:new Uint8Array(i);(a=this._u8Array=new Uint8Array(r)).set(s,0),i=this._buffer=r}else i=this._buffer=new ArrayBuffer(t),this._u8Array=null;return this._checkArrayUse(),this._upload=!0,this._bufferSize=i.byteLength,this}append(t){var e,i;this._upload=!0,e=t.byteLength,t instanceof Uint8Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint8Array(this._buffer,this._byteLength)):t instanceof Uint16Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint16Array(this._buffer,this._byteLength)):t instanceof Float32Array&&(this._resizeBuffer(this._byteLength+e,!0),i=new Float32Array(this._buffer,this._byteLength)),i.set(t,0),this._byteLength+=e,this._checkArrayUse()}appendU16Array(t,e){this._resizeBuffer(this._byteLength+2*e,!0);var i=new Uint16Array(this._buffer,this._byteLength,e);if(6==e)i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5];else if(e>=100)i.set(new Uint16Array(t.buffer,0,e));else for(var a=0;a<e;a++)i[a]=t[a];this._byteLength+=2*e,this._checkArrayUse()}appendEx(t,e){var i;this._upload=!0,i=t.byteLength,this._resizeBuffer(this._byteLength+i,!0),new e(this._buffer,this._byteLength).set(t,0),this._byteLength+=i,this._checkArrayUse()}appendEx2(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;var r,s,n;for(this._upload=!0,r=i*a,this._resizeBuffer(this._byteLength+r,!0),s=new e(this._buffer,this._byteLength),n=0;n<i;n++)s[n]=t[n];this._byteLength+=r,this._checkArrayUse()}getBuffer(){return this._buffer}setNeedUpload(){this._upload=!0}getNeedUpload(){return this._upload}upload(){var t=s.a.instance,e=this._bind_upload();return t.bindBuffer(this._bufferType,null),this._bufferType==t.ARRAY_BUFFER&&(l.a._bindedVertexBuffer=null),this._bufferType==t.ELEMENT_ARRAY_BUFFER&&(l.a._bindedIndexBuffer=null),o.a.activeShader=null,e}subUpload(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];var t=s.a.instance,e=this._bind_subUpload();return t.bindBuffer(this._bufferType,null),this._bufferType==t.ARRAY_BUFFER&&(l.a._bindedVertexBuffer=null),this._bufferType==t.ELEMENT_ARRAY_BUFFER&&(l.a._bindedIndexBuffer=null),o.a.activeShader=null,e}_disposeResource(){this._upload=!0,this._uploadSize=0}clear(){this._byteLength=0,this._upload=!0}}e.a=h,r()(h,"FLOAT32",4),r()(h,"SHORT",2)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(119);class o extends n.a{static __init__(){s.a.instance;o._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}constructor(){super(o.const_stride,4,4),this.canReuse=!0,this.setAttributes(o._fixattriInfo)}static getAMesh(t){var e;return e=o._POOL.length?o._POOL.pop():new o,t&&e._vb._resizeBuffer(65536*o.const_stride,!1),e}addData(t,e,i,a,r){var s=this._vb,n=this._ib,l=t.length>>1,h=s.needSize(l*o.const_stride)>>2,_=s._floatArray32||s.getFloat32Array(),c=s._uint32Array,d=0,u=a.a,f=a.b,m=a.c,p=a.d,g=a.tx,v=a.ty,T=0;for(T=0;T<l;T++){var E=t[d],S=t[d+1];_[h]=E*u+S*m+g,_[h+1]=E*f+S*p+v,_[h+2]=e[d],_[h+3]=e[d+1],c[h+4]=r,c[h+5]=255,h+=6,d+=2}s.setNeedUpload();var R=this.vertNum,x=i.length,A=n.needSize(i.byteLength),y=n.getUint16Array(),I=A>>1;if(R>0){var C=I+x,M=0;for(T=I;T<C;T++,M++)y[T]=i[M]+R}else y.set(i,I);n.setNeedUpload(),this.vertNum+=l,this.indexNum+=i.length}releaseMesh(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,o._POOL.push(this)}destroy(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()}}e.a=o,r()(o,"const_stride",24),r()(o,"_fixattriInfo",void 0),r()(o,"_POOL",[])},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(119);class o extends n.a{static __init__(){s.a.instance;o._fixattriInfo=[5126,2,0,5121,4,8]}constructor(){super(o.const_stride,4,4),this.canReuse=!0,this.setAttributes(o._fixattriInfo)}static getAMesh(t){var e;return e=o._POOL.length?o._POOL.pop():new o,t&&e._vb._resizeBuffer(65536*o.const_stride,!1),e}addVertAndIBToMesh(t,e,i,a){for(var r=this._vb.needSize(e.length/2*o.const_stride)>>2,s=this._vb._floatArray32||this._vb.getFloat32Array(),n=this._vb._uint32Array,l=0,h=e.length/2,_=0;_<h;_++)s[r++]=e[l],s[r++]=e[l+1],l+=2,n[r++]=i;this._vb.setNeedUpload(),this._ib.append(new Uint16Array(a)),this._ib.setNeedUpload(),this.vertNum+=h,this.indexNum+=a.length}releaseMesh(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,o._POOL.push(this)}destroy(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()}}e.a=o,r()(o,"const_stride",12),r()(o,"_fixattriInfo",void 0),r()(o,"_POOL",[])},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){r()(this,"id",void 0),r()(this,"save",[]),r()(this,"toUpperCase",null),r()(this,"changed",void 0),r()(this,"_text",void 0),r()(this,"width",-1),r()(this,"pageChars",[]),r()(this,"startID",0),r()(this,"startIDStroke",0),r()(this,"lastGCCnt",0),r()(this,"splitRender",!1),r()(this,"scalex",1),r()(this,"scaley",1)}setText(t){this.changed=!0,this._text=t,this.width=-1,this.cleanCache()}toString(){return this._text}get length(){return this._text?this._text.length:0}charCodeAt(t){return this._text?this._text.charCodeAt(t):NaN}charAt(t){return this._text?this._text.charAt(t):null}cleanCache(){let t=this.pageChars;for(var e in t){let a=t[e];var i=a.tex;1==a.words.length&&i&&i.ri&&i.destroy()}this.pageChars=[],this.startID=0,this.scalex=1,this.scaley=1}}},function(t,e,i){"use strict";var a=i(116),r=(i.n(a),i(28)),s=(i.n(r),i(0)),n=i.n(s),o=i(120),l=i(6),h=i(21),_=i(3),c=i(30);class d extends o.a{constructor(){super(),n()(this,"_focus",void 0),n()(this,"_multiline",!1),n()(this,"_editable",!0),n()(this,"_restrictPattern",void 0),n()(this,"_maxChars",1e5),n()(this,"_type","text"),n()(this,"_prompt",""),n()(this,"_promptColor","#A9A9A9"),n()(this,"_originColor","#000000"),n()(this,"_content",""),d.IOS_IFRAME=_.a.Browser.onIOS&&_.a.Browser.window.top!=_.a.Browser.window.self,this._width=100,this._height=20,this.multiline=!1,this.overflow=o.a.SCROLL,this.on(l.a.MOUSE_DOWN,this,this._onMouseDown),this.on(l.a.UNDISPLAY,this,this._onUnDisplay)}static __init__(){if(d._createInputElement(),_.a.Browser.onMobile){var t=!1;(_.a.Browser.onMiniGame||_.a.Browser.onBDMiniGame||_.a.Browser.onQGMiniGame||_.a.Browser.onKGMiniGame||_.a.Browser.onVVMiniGame||_.a.Browser.onAlipayMiniGame||_.a.Browser.onQQMiniGame||_.a.Browser.onBLMiniGame||_.a.Browser.onTTMiniGame||_.a.Browser.onHWMiniGame||_.a.Browser.onTBMiniGame)&&(t=!0),_.a.Render.canvas.addEventListener(d.IOS_IFRAME?t?"touchend":"click":"touchend",d._popupInputMethod)}}static _popupInputMethod(t){d.isInputting&&d.inputElement.focus()}static _createInputElement(){d._initInput(d.area=_.a.Browser.createElement("textarea")),d._initInput(d.input=_.a.Browser.createElement("input")),d.inputContainer=_.a.Browser.createElement("div"),d.inputContainer.style.position="absolute",d.inputContainer.style.zIndex=1e5,_.a.Browser.container.appendChild(d.inputContainer),d.inputContainer.setPos=function(t,e){d.inputContainer.style.left=t+"px",d.inputContainer.style.top=e+"px"}}static _initInput(t){var e=t.style;e.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",e.resize="none",e.backgroundColor="transparent",e.border="none",e.outline="none",e.zIndex=1,t.addEventListener("input",d._processInputting),t.addEventListener("mousemove",d._stopEvent),t.addEventListener("mousedown",d._stopEvent),t.addEventListener("touchmove",d._stopEvent),t.setFontFace=function(e){t.style.fontFamily=e},_.a.Render.isConchApp||(t.setColor=function(e){t.style.color=e},t.setFontSize=function(e){t.style.fontSize=e+"px"})}static _processInputting(t){var e=d.inputElement.target;if(e){var i=d.inputElement.value;e._restrictPattern&&(i=i.replace(/\u2006|\x27/g,""),e._restrictPattern.test(i)&&(i=i.replace(e._restrictPattern,""),d.inputElement.value=i)),e._text=i,e.event(l.a.INPUT)}}static _stopEvent(t){"touchmove"==t.type&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()}setSelection(t,e){this.focus=!0,d.inputElement.selectionStart=t,d.inputElement.selectionEnd=e}get multiline(){return this._multiline}set multiline(t){this._multiline=t,this.valign=t?"top":"middle"}get nativeInput(){return this._multiline?d.area:d.input}_onUnDisplay(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.focus=!1}_onMouseDown(t){this.focus=!0}_syncInputTransform(){var t=this.nativeInput,e=h.a.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),i=this._width-this.padding[1]-this.padding[3],a=this._height-this.padding[0]-this.padding[2];_.a.Render.isConchApp?(t.setScale(e.scaleX,e.scaleY),t.setSize(i,a),t.setPos(e.x,e.y)):(d.inputContainer.style.transform=d.inputContainer.style.webkitTransform="scale("+e.scaleX+","+e.scaleY+") rotate("+_.a.stage.canvasDegree+"deg)",t.style.width=i+"px",t.style.height=a+"px",d.inputContainer.style.left=e.x+"px",d.inputContainer.style.top=e.y+"px")}select(){this.nativeInput.select()}get focus(){return this._focus}set focus(t){var e=this.nativeInput;this._focus!==t&&(t?(e.target?e.target._focusOut():this._setInputMethod(),e.target=this,this._focusIn()):(e.target=null,this._focusOut(),_.a.Browser.document.body.scrollTop=0,e.blur(),_.a.Render.isConchApp?e.setPos(-1e4,-1e4):d.inputContainer.contains(e)&&d.inputContainer.removeChild(e)))}_setInputMethod(){d.input.parentElement&&d.inputContainer.removeChild(d.input),d.area.parentElement&&d.inputContainer.removeChild(d.area),d.inputElement=this._multiline?d.area:d.input,d.inputContainer.appendChild(d.inputElement),o.a.RightToLeft&&(d.inputElement.style.direction="rtl")}_focusIn(){d.isInputting=!0;var t=this.nativeInput;d.input&&(d.input.type=this._type),this._focus=!0;var e=t.style;e.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),t.readOnly=!this._editable,_.a.Render.isConchApp&&(t.setType(this._type),t.setForbidEdit(!this._editable)),t.maxLength=this._maxChars;this.padding;if(t.value=this._content,t.placeholder=this._prompt,_.a.stage.off(l.a.KEY_DOWN,this,this._onKeyDown),_.a.stage.on(l.a.KEY_DOWN,this,this._onKeyDown),_.a.stage.focus=this,this.event(l.a.FOCUS),_.a.Browser.onPC&&t.focus(),!(_.a.Browser.onMiniGame||_.a.Browser.onBDMiniGame||_.a.Browser.onQGMiniGame||_.a.Browser.onKGMiniGame||_.a.Browser.onVVMiniGame||_.a.Browser.onAlipayMiniGame||_.a.Browser.onQQMiniGame||_.a.Browser.onBLMiniGame||_.a.Browser.onTTMiniGame||_.a.Browser.onHWMiniGame||_.a.Browser.onTBMiniGame)){this._text;this._text=null}this.typeset(),t.setColor(this._originColor),t.setFontSize(this.fontSize),t.setFontFace(_.a.Browser.onIPhone&&o.a.fontFamilyMap[this.font]||this.font),_.a.Render.isConchApp&&t.setMultiAble&&t.setMultiAble(this._multiline),e.lineHeight=this.leading+this.fontSize+"px",e.fontStyle=this.italic?"italic":"normal",e.fontWeight=this.bold?"bold":"normal",e.textAlign=this.align,e.padding="0 0",this._syncInputTransform(),!_.a.Render.isConchApp&&_.a.Browser.onPC&&_.a.systemTimer.frameLoop(1,this,this._syncInputTransform)}_setPromptColor(){d.promptStyleDOM=_.a.Browser.getElementById("promptStyle"),d.promptStyleDOM||(d.promptStyleDOM=_.a.Browser.createElement("style"),d.promptStyleDOM.setAttribute("id","promptStyle"),_.a.Browser.document.head.appendChild(d.promptStyleDOM)),d.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"}_focusOut(){d.isInputting&&(d.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(super.set_text(this._content),super.set_color(this._originColor)):(super.set_text(this._prompt),super.set_color(this._promptColor)),_.a.stage.off(l.a.KEY_DOWN,this,this._onKeyDown),_.a.stage.focus=null,this.event(l.a.BLUR),this.event(l.a.CHANGE),_.a.Render.isConchApp&&this.nativeInput.blur(),_.a.Browser.onPC&&_.a.systemTimer.clear(this,this._syncInputTransform))}_onKeyDown(t){13===t.keyCode&&(_.a.Browser.onMobile&&!this._multiline&&(this.focus=!1),this.event(l.a.ENTER))}set text(t){super.set_color(this._originColor),t+="",this._focus?(this.nativeInput.value=t||"",this.event(l.a.CHANGE)):(this._multiline||(t=t.replace(/\r?\n/g,"")),this._content=t,t?super.set_text(t):(super.set_text(this._prompt),super.set_color(this.promptColor)))}get text(){return this._focus?this.nativeInput.value:this._content||""}changeText(t){this._content=t,this._focus?(this.nativeInput.value=t||"",this.event(l.a.CHANGE)):super.changeText(t)}set color(t){this._focus&&this.nativeInput.setColor(t),super.set_color(this._content?t:this._promptColor),this._originColor=t}get color(){return super.color}set bgColor(t){super.set_bgColor(t),_.a.Render.isConchApp&&this.nativeInput.setBgColor(t)}get bgColor(){return super.bgColor}get restrict(){return this._restrictPattern?this._restrictPattern.source:""}set restrict(t){t?((t="[^"+t+"]").indexOf("^^")>-1&&(t=t.replace("^^","")),this._restrictPattern=new RegExp(t,"g")):this._restrictPattern=null}set editable(t){this._editable=t,_.a.Render.isConchApp&&d.input.setForbidEdit(!t)}get editable(){return this._editable}get maxChars(){return this._maxChars}set maxChars(t){t<=0&&(t=1e5),this._maxChars=t}get prompt(){return this._prompt}set prompt(t){!this._text&&t&&super.set_color(this._promptColor),this.promptColor=this._promptColor,this._text?super.set_text(this._text==this._prompt?t:this._text):super.set_text(t),this._prompt=o.a.langPacks&&o.a.langPacks[t]?o.a.langPacks[t]:t}get promptColor(){return this._promptColor}set promptColor(t){this._promptColor=t,this._content||super.set_color(t)}get type(){return this._type}set type(t){this._getTextStyle().asPassword="password"===t,this._type=t}}e.a=d,n()(d,"TYPE_TEXT","text"),n()(d,"TYPE_PASSWORD","password"),n()(d,"TYPE_EMAIL","email"),n()(d,"TYPE_URL","url"),n()(d,"TYPE_NUMBER","number"),n()(d,"TYPE_RANGE","range"),n()(d,"TYPE_DATE","date"),n()(d,"TYPE_MONTH","month"),n()(d,"TYPE_WEEK","week"),n()(d,"TYPE_TIME","time"),n()(d,"TYPE_DATE_TIME","datetime"),n()(d,"TYPE_DATE_TIME_LOCAL","datetime-local"),n()(d,"TYPE_SEARCH","search"),n()(d,"input",void 0),n()(d,"area",void 0),n()(d,"inputElement",void 0),n()(d,"inputContainer",void 0),n()(d,"confirmButton",void 0),n()(d,"promptStyleDOM",void 0),n()(d,"IOS_IFRAME",!1),n()(d,"inputHeight",45),n()(d,"isInputting",!1),n()(d,"stageMatrix",void 0),c.a.regClass("laya.display.Input",d),c.a.regClass("Laya.Input",d)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(6),n=i(362),o=i(162),l=i(16),h=i(26),_=i(19),c=i(3);class d{constructor(){r()(this,"mouseX",0),r()(this,"mouseY",0),r()(this,"disableMouseEvent",!1),r()(this,"mouseDownTime",0),r()(this,"mouseMoveAccuracy",2),r()(this,"_event",new s.a),r()(this,"_stage",void 0),r()(this,"_captureSp",null),r()(this,"_captureChain",[]),r()(this,"_captureExlusiveMode",!1),r()(this,"_hitCaputreSp",!1),r()(this,"_point",new l.a),r()(this,"_rect",new h.a),r()(this,"_target",void 0),r()(this,"_lastMoveTimer",0),r()(this,"_isLeftMouse",void 0),r()(this,"_prePoint",new l.a),r()(this,"_touchIDs",{}),r()(this,"_curTouchID",NaN),r()(this,"_id",1),r()(this,"_tTouchID",void 0)}__init__(t,e){this._stage=t;var i=this;e.oncontextmenu=function(t){if(d.enabled)return!1},e.addEventListener("mousedown",function(t){d.enabled&&(_.a.onIE||t.cancelable&&t.preventDefault(),i.mouseDownTime=_.a.now(),i.runEvent(t))}),e.addEventListener("mouseup",function(t){d.enabled&&(t.cancelable&&t.preventDefault(),i.mouseDownTime=-_.a.now(),i.runEvent(t))},!0),e.addEventListener("mousemove",function(t){if(d.enabled){t.cancelable&&t.preventDefault();var e=_.a.now();if(e-i._lastMoveTimer<10)return;i._lastMoveTimer=e,i.runEvent(t)}},!0),e.addEventListener("mouseout",function(t){d.enabled&&i.runEvent(t)}),e.addEventListener("mouseover",function(t){d.enabled&&i.runEvent(t)}),e.addEventListener("touchstart",function(t){d.enabled&&(d._isFirstTouch||o.a.isInputting||t.cancelable&&t.preventDefault(),i.mouseDownTime=_.a.now(),i.runEvent(t))}),e.addEventListener("touchend",function(t){d.enabled?(d._isFirstTouch||o.a.isInputting||t.cancelable&&t.preventDefault(),d._isFirstTouch=!1,i.mouseDownTime=-_.a.now(),i.runEvent(t)):i._curTouchID=NaN},!0),e.addEventListener("touchmove",function(t){d.enabled&&(t.cancelable&&t.preventDefault(),i.runEvent(t))},!0),e.addEventListener("touchcancel",function(t){d.enabled?(t.cancelable&&t.preventDefault(),i.runEvent(t)):i._curTouchID=NaN},!0),e.addEventListener("mousewheel",function(t){d.enabled&&i.runEvent(t)}),e.addEventListener("DOMMouseScroll",function(t){d.enabled&&i.runEvent(t)})}initEvent(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var i;this._event._stoped=!1,this._event.nativeEvent=e||t,this._target=null,this._point.setTo(t.pageX||t.clientX,t.pageY||t.clientY),this._stage._canvasTransform&&(this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y),this._event.touchId=t.identifier||0,this._tTouchID=this._event.touchId,(i=n.a.I._event)._stoped=!1,i.nativeEvent=this._event.nativeEvent,i.touchId=this._event.touchId}checkMouseWheel(t){this._event.delta=t.wheelDelta?.025*t.wheelDelta:-t.detail;for(var e=n.a.I.getLastOvers(),i=0,a=e.length;i<a;i++){var r=e[i];r.event(s.a.MOUSE_WHEEL,this._event.setTo(s.a.MOUSE_WHEEL,r,this._target))}}onMouseMove(t){n.a.I.onMouseMove(t,this._tTouchID)}onMouseDown(t){if(o.a.isInputting&&c.a.stage.focus&&c.a.stage.focus.focus&&!c.a.stage.focus.contains(this._target)){var e=c.a.stage.focus._tf||c.a.stage.focus,i=t._tf||t;i instanceof o.a&&i.multiline==e.multiline?e._focusOut():e.focus=!1}n.a.I.onMouseDown(t,this._tTouchID,this._isLeftMouse)}onMouseUp(t){n.a.I.onMouseUp(t,this._tTouchID,this._isLeftMouse)}check(t,e,i,a){this._point.setTo(e,i),t.fromParentPoint(this._point),e=this._point.x,i=this._point.y;var r=t._style.scrollRect;if(r&&(this._rect.setTo(r.x,r.y,r.width,r.height),!this._rect.contains(e,i)))return!1;if(!this.disableMouseEvent){if(t.hitTestPrior&&!t.mouseThrough&&!this.hitTest(t,e,i))return!1;for(var s=t._children.length-1;s>-1;s--){var n=t._children[s];if(!n.destroyed&&n._mouseState>1&&n._visible&&this.check(n,e,i,a))return!0}for(s=t._extUIChild.length-1;s>=0;s--){var o=t._extUIChild[s];if(!o.destroyed&&o._mouseState>1&&o._visible&&this.check(o,e,i,a))return!0}}var l=!(!t.hitTestPrior||t.mouseThrough||this.disableMouseEvent)||this.hitTest(t,e,i);return l?(this._target=t,a.call(this,t),this._target==this._hitCaputreSp&&(this._hitCaputreSp=!0)):a===this.onMouseUp&&t===this._stage&&(this._target=this._stage,a.call(this,this._target)),l}hitTest(t,e,i){var a=!1;t.scrollRect&&(e-=t._style.scrollRect.x,i-=t._style.scrollRect.y);var r=t._style.hitArea;return r&&r._hit?r.contains(e,i):((t.width>0&&t.height>0||t.mouseThrough||r)&&(a=t.mouseThrough?t.getGraphicBounds().contains(e,i):(r||this._rect.setTo(0,0,t.width,t.height)).contains(e,i)),a)}_checkAllBaseUI(t,e,i){var a=this.handleExclusiveCapture(this.mouseX,this.mouseY,i);return!!a||(a=this.check(this._stage,this.mouseX,this.mouseY,i),this.handleCapture(this.mouseX,this.mouseY,i)||a)}check3DUI(t,e,i){for(var a=this._stage._3dUI,r=0,s=!1;r<a.length;r++){var n=a[r];this._stage._curUIBase=n,!n.destroyed&&n._mouseState>1&&n._visible&&(s=s||this.check(n,this.mouseX,this.mouseY,i))}return this._stage._curUIBase=this._stage,s}handleExclusiveCapture(t,e,i){if(this._captureExlusiveMode&&this._captureSp&&this._captureChain.length>0){var a;this._point.setTo(t,e);for(var r=0;r<this._captureChain.length;r++)(a=this._captureChain[r]).fromParentPoint(this._point);return this._target=a,i.call(this,a),!0}return!1}handleCapture(t,e,i){if(!this._hitCaputreSp&&this._captureSp&&this._captureChain.length>0){var a;this._point.setTo(t,e);for(var r=0;r<this._captureChain.length;r++)(a=this._captureChain[r]).fromParentPoint(this._point);return this._target=a,i.call(this,a),!0}return!1}runEvent(t){var e,i,a;switch("mousemove"!==t.type&&(this._prePoint.x=this._prePoint.y=-1e6),t.type){case"mousedown":this._touchIDs[0]=this._id++,d._isTouchRespond?d._isTouchRespond=!1:(this._isLeftMouse=0===t.button,this.initEvent(t),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseDown));break;case"mouseup":this._isLeftMouse=0===t.button,this.initEvent(t),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-t.clientX)+Math.abs(this._prePoint.y-t.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=t.clientX,this._prePoint.y=t.clientY,this.initEvent(t),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseMove));break;case"touchstart":d._isTouchRespond=!0,this._isLeftMouse=!0;var r=t.changedTouches;for(e=0,i=r.length;e<i;e++)a=r[e],(d.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=a.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[a.identifier]=this._id++,this.initEvent(a,t),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseDown));break;case"touchend":case"touchcancel":d._isTouchRespond=!0,this._isLeftMouse=!0;var o=t.changedTouches;for(e=0,i=o.length;e<i;e++){if(a=o[e],d.multiTouchEnabled||a.identifier==this._curTouchID)this._curTouchID=NaN,this.initEvent(a,t),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseUp)||this.onMouseUp(null)}break;case"touchmove":var l=t.changedTouches;for(e=0,i=l.length;e<i;e++)a=l[e],(d.multiTouchEnabled||a.identifier==this._curTouchID)&&(this.initEvent(a,t),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":this.checkMouseWheel(t);break;case"mouseout":n.a.I.stageMouseOut();break;case"mouseover":this._stage.event(s.a.MOUSE_OVER,this._event.setTo(s.a.MOUSE_OVER,this._stage,this._stage))}}setCapture(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._captureSp=t,this._captureExlusiveMode=e,this._captureChain.length=0,this._captureChain.push(t);for(var i=t;i!=c.a.stage&&i!=c.a.stage._curUIBase&&(i=i.parent);)this._captureChain.splice(0,0,i)}releaseCapture(){console.log("release capture"),this._captureSp=null}}e.a=d,r()(d,"instance",new d),r()(d,"enabled",!0),r()(d,"multiTouchEnabled",!0),r()(d,"_isTouchRespond",void 0),r()(d,"_isFirstTouch",!0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(97);class n{}e.a=n,r()(n,"createShaderCondition",function(t){var e="(function() {return "+t+";})";return window.Laya._runScript(e)}),r()(n,"changeWebGLSize",function(t,e){s.a.onStageResize(t,e)})},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(23);e.a=class extends s.a{constructor(){super(...arguments),r()(this,"url",void 0),r()(this,"loops",void 0),r()(this,"startTime",void 0),r()(this,"isStopped",!1),r()(this,"completeHandler",void 0)}set volume(t){}get volume(){return 1}get position(){return 0}get duration(){return 0}play(){}stop(){this.completeHandler&&this.completeHandler.runWith(!1)}pause(){}resume(){}__runComplete(t){t&&t.runWith(!0)}}},function(t,e){t.exports={}},function(t,e,i){"use strict";class a{static subtractVector3(t,e,i){i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2]}static lerp(t,e,i){return t*(1-i)+e*i}static scaleVector3(t,e,i){i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e}static lerpVector3(t,e,i,a){var r=t[0],s=t[1],n=t[2];a[0]=r+i*(e[0]-r),a[1]=s+i*(e[1]-s),a[2]=n+i*(e[2]-n)}static lerpVector4(t,e,i,a){var r=t[0],s=t[1],n=t[2],o=t[3];a[0]=r+i*(e[0]-r),a[1]=s+i*(e[1]-s),a[2]=n+i*(e[2]-n),a[3]=o+i*(e[3]-o)}static slerpQuaternionArray(t,e,i,a,r,s,n){var o,l,h,_,c,d=t[e+0],u=t[e+1],f=t[e+2],m=t[e+3],p=i[a+0],g=i[a+1],v=i[a+2],T=i[a+3];return(l=d*p+u*g+f*v+m*T)<0&&(l=-l,p=-p,g=-g,v=-v,T=-T),1-l>1e-6?(o=Math.acos(l),h=Math.sin(o),_=Math.sin((1-r)*o)/h,c=Math.sin(r*o)/h):(_=1-r,c=r),s[n+0]=_*d+c*p,s[n+1]=_*u+c*g,s[n+2]=_*f+c*v,s[n+3]=_*m+c*T,s}static getRotation(t,e,i,a){return Math.atan2(a-e,i-t)/Math.PI*180}static sortBigFirst(t,e){return t==e?0:e>t?1:-1}static sortSmallFirst(t,e){return t==e?0:e>t?-1:1}static sortNumBigFirst(t,e){return parseFloat(e)-parseFloat(t)}static sortNumSmallFirst(t,e){return parseFloat(t)-parseFloat(e)}static sortByKey(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var r;return r=e?i?a.sortNumBigFirst:a.sortBigFirst:i?a.sortNumSmallFirst:a.sortSmallFirst,function(e,i){return r(e[t],i[t])}}}e.a=a},function(t,e,i){"use strict";var a=i(116),r=(i.n(a),i(18)),s=(i.n(r),i(115)),n=(i.n(s),i(28)),o=(i.n(n),i(0)),l=i.n(o),h=i(2),_=i(92),c=i(392),d=i(252);class u{static __init__(){var t=h.a.instance;u.shaderParamsMap={float:t.FLOAT,int:t.INT,bool:t.BOOL,vec2:t.FLOAT_VEC2,vec3:t.FLOAT_VEC3,vec4:t.FLOAT_VEC4,ivec2:t.INT_VEC2,ivec3:t.INT_VEC3,ivec4:t.INT_VEC4,bvec2:t.BOOL_VEC2,bvec3:t.BOOL_VEC3,bvec4:t.BOOL_VEC4,mat2:t.FLOAT_MAT2,mat3:t.FLOAT_MAT3,mat4:t.FLOAT_MAT4,sampler2D:t.SAMPLER_2D,samplerCube:t.SAMPLER_CUBE}}static _parseOne(t,e,i,a,r,s){var n={type:u.shaderParamsMap[i[a+1]],name:i[a+2],size:isNaN(parseInt(i[a+3]))?1:parseInt(i[a+3])};return s&&("attribute"==r?t.push(n):e.push(n)),":"==i[a+3]&&(n.type=i[a+4],a+=2),a+=2}static addInclude(t,e){if(!e||0===e.length)throw new Error("add shader include file err:"+t);if(u.includes[t])throw new Error("add shader include file err, has add:"+t);u.includes[t]=new c.a(e)}static preGetParams(t,e){var i,a,r=[t,e],s={},n=[],o=[],l={},h=[];s.attributes=n,s.uniforms=o,s.defines=l;for(var _=0;_<2;_++){r[_]=r[_].replace(u._removeAnnotation,"");var c,d=r[_].match(u._reg);for(i=0,a=d.length;i<a;i++){var f=d[i];if("attribute"==f||"uniform"==f)i=u._parseOne(n,o,d,i,f,!0);else{if("#define"==f){h[f=d[++i]]=1;continue}if("#ifdef"==f){l[c=d[++i]]=l[c]||[];for(i++;i<a;i++)if("attribute"==(f=d[i])||"uniform"==f)i=u._parseOne(n,o,d,i,f,h[c]);else if("#else"==f)for(i++;i<a;i++)if("attribute"==(f=d[i])||"uniform"==f)i=u._parseOne(n,o,d,i,f,!h[c]);else if("#endif"==f)break}}}}return s}static splitToWords(t,e){for(var i,a,r=[],s=-1,n=0,o=t.length;n<o;n++)if(i=t.charAt(n)," \t=+-*/&%!<>()'\",;".indexOf(i)>=0){if(s>=0&&n-s>1&&(a=t.substr(s,n-s),r.push(a)),'"'==i||"'"==i){var l=t.indexOf(i,n+1);if(l<0)throw"Sharder err:"+t;r.push(t.substr(n+1,l-n-1)),n=l,s=-1;continue}"("==i&&e&&r.length>0&&(a=r[r.length-1]+";","vec4;main;".indexOf(a)<0&&(e.useFuns+=a)),s=-1}else s<0&&(s=n);return s<o&&o-s>1&&(a=t.substr(s,o-s),r.push(a)),r}constructor(t,e,i){l()(this,"_nameMap",void 0),l()(this,"_VS",void 0),l()(this,"_PS",void 0),l()(this,"defs",{});let a=this;function r(t){t=t.replace(u._clearCR,"");var e=[],i=new d.a(e);return a._compileToTree(i,t.split("\n"),0,e,a.defs),i}var s=Date.now();this._VS=r(t),this._PS=r(e),this._nameMap=i,Date.now()-s>2&&console.log("ShaderCompile use time:"+(Date.now()-s)+"  size:"+t.length+"/"+e.length)}_compileToTree(t,e,i,a,r){var s,n,o,l,h,_,c,f,m,p,g;for(m=i;m<e.length;m++)if(!((o=e[m]).length<1)&&0!==(_=o.indexOf("//"))){if(_>=0&&(o=o.substr(0,_)),s=f||new d.a(a),f=null,s.text=o,s.noCompile=!0,(_=o.indexOf("#"))>=0){for(l="#",g=_+1,p=o.length;g<p;g++){var v=o.charAt(g);if(" "===v||"\t"===v||"?"===v)break;l+=v}switch(s.name=l,l){case"#ifdef":case"#ifndef":if(s.src=o,s.noCompile=null!=o.match(/[!&|()=<>]/),s.noCompile?console.log("function():Boolean{return "+o.substr(_+s.name.length)+"}"):(c=o.replace(/^\s*/,"").split(/\s+/),s.setCondition(c[1],"#ifdef"===l?u.IFDEF_YES:u.IFDEF_ELSE),s.text="//"+s.text),s.setParent(t),t=s,r)for(c=o.substr(g).split(u._splitToWordExps3),g=0;g<c.length;g++)(o=c[g]).length&&(r[o]=!0);continue;case"#if":if(s.src=o,s.noCompile=!0,s.setParent(t),t=s,r)for(c=o.substr(g).split(u._splitToWordExps3),g=0;g<c.length;g++)(o=c[g]).length&&"defined"!=o&&(r[o]=!0);continue;case"#else":s.src=o,n=(t=t.parent).childs[t.childs.length-1],s.noCompile=n.noCompile,s.noCompile||(s.condition=n.condition,s.conditionType=n.conditionType==u.IFDEF_YES?u.IFDEF_ELSE:u.IFDEF_YES,s.text="//"+s.text+" "+n.text+" "+s.conditionType),s.setParent(t),t=s;continue;case"#endif":n=(t=t.parent).childs[t.childs.length-1],s.noCompile=n.noCompile,s.noCompile||(s.text="//"+s.text),s.setParent(t);continue;case"#include":c=u.splitToWords(o,null);var T=u.includes[c[1]];if(!T)throw"ShaderCompile error no this include file:"+c[1];if((_=c[0].indexOf("?"))<0){s.setParent(t),o=T.getWith("with"==c[2]?c[3]:null),this._compileToTree(s,o.split("\n"),0,a,r),s.text="";continue}s.setCondition(c[0].substr(_+1),u.IFDEF_YES),s.text=T.getWith("with"==c[2]?c[3]:null);break;case"#import":h=(c=u.splitToWords(o,null))[1],a.push({node:s,file:u.includes[h],ofs:s.text.length});continue}}else{if((n=t.childs[t.childs.length-1])&&!n.name){a.length>0&&u.splitToWords(o,n),f=s,n.text+="\n"+o;continue}a.length>0&&u.splitToWords(o,s)}s.setParent(t)}}createShader(t,e,i,a){var r={},s="";if(t)for(var n in t)s+="#define "+n+"\n",r[n]=!0;var o=this._VS.toscript(r,[]),l=this._PS.toscript(r,[]);return(i||_.a.create)(s+o.join("\n"),s+l.join("\n"),e,this._nameMap,a)}}e.a=u,l()(u,"IFDEF_NO",0),l()(u,"IFDEF_YES",1),l()(u,"IFDEF_ELSE",2),l()(u,"IFDEF_PARENT",3),l()(u,"_removeAnnotation",new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g")),l()(u,"_reg",new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g")),l()(u,"_splitToWordExps",new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g")),l()(u,"includes",{}),l()(u,"shaderParamsMap",void 0),l()(u,"_clearCR",new RegExp("\r","g")),l()(u,"_splitToWordExps3",new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g"))},function(t,e,i){"use strict";let a;i.d(e,"a",function(){return a}),function(t){t[t.High=0]="High",t[t.Low=1]="Low"}(a||(a={}))},function(t,e,i){"use strict";var a=i(214),r=(i.n(a),i(0)),s=i.n(r),n=i(8),o=i(1),l=i(51),h=i(412),_=i(413),c=i(62),d=i(11);class u{static __init__(){var t=d.a.Physics3D._bullet;u._btTempVector30=t.btVector3_create(0,0,0),u._btTempVector31=t.btVector3_create(0,0,0),u._btTempQuaternion0=t.btQuaternion_create(0,0,0,1),u._btTempQuaternion1=t.btQuaternion_create(0,0,0,1),u._btTempTransform0=t.btTransform_create(),u._btTempTransform1=t.btTransform_create()}static createConstraint(){}get continuousCollisionDetection(){return d.a.Physics3D._bullet.btCollisionWorld_get_m_useContinuous(this._btDispatchInfo)}set continuousCollisionDetection(t){d.a.Physics3D._bullet.btCollisionWorld_set_m_useContinuous(this._btDispatchInfo,t)}get gravity(){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";return this._gravity}set gravity(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._gravity=t;var e=d.a.Physics3D._bullet,i=u._btTempVector30;e.btVector3_setValue(i,-t.x,t.y,t.z),e.btDiscreteDynamicsWorld_setGravity(this._btDiscreteDynamicsWorld,i)}get speculativeContactRestitution(){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot Cannot perform this action when the physics engine is set to CollisionsOnly";return d.a.Physics3D._bullet.btDiscreteDynamicsWorld_getApplySpeculativeContactRestitution(this._btDiscreteDynamicsWorld)}set speculativeContactRestitution(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot Cannot perform this action when the physics engine is set to CollisionsOnly";d.a.Physics3D._bullet.btDiscreteDynamicsWorld_setApplySpeculativeContactRestitution(this._btDiscreteDynamicsWorld,t)}constructor(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];s()(this,"_btDiscreteDynamicsWorld",void 0),s()(this,"_btCollisionWorld",void 0),s()(this,"_btDispatcher",void 0),s()(this,"_btCollisionConfiguration",void 0),s()(this,"_btBroadphase",void 0),s()(this,"_btSolverInfo",void 0),s()(this,"_btDispatchInfo",void 0),s()(this,"_gravity",new o.a(0,-10,0)),s()(this,"_btVector3Zero",d.a.Physics3D._bullet.btVector3_create(0,0,0)),s()(this,"_btDefaultQuaternion",d.a.Physics3D._bullet.btQuaternion_create(0,0,0,-1)),s()(this,"_btClosestRayResultCallback",void 0),s()(this,"_btAllHitsRayResultCallback",void 0),s()(this,"_btClosestConvexResultCallback",void 0),s()(this,"_btAllConvexResultCallback",void 0),s()(this,"_collisionsUtils",new _.a),s()(this,"_previousFrameCollisions",[]),s()(this,"_currentFrameCollisions",[]),s()(this,"_currentConstraint",{}),s()(this,"_physicsUpdateList",new h.a),s()(this,"_characters",[]),s()(this,"_updatedRigidbodies",0),s()(this,"maxSubSteps",1),s()(this,"fixedTimeStep",1/60),this.maxSubSteps=t.maxSubSteps,this.fixedTimeStep=t.fixedTimeStep;var e=d.a.Physics3D._bullet;this._btCollisionConfiguration=e.btDefaultCollisionConfiguration_create(),this._btDispatcher=e.btCollisionDispatcher_create(this._btCollisionConfiguration),this._btBroadphase=e.btDbvtBroadphase_create(),e.btOverlappingPairCache_setInternalGhostPairCallback(e.btDbvtBroadphase_getOverlappingPairCache(this._btBroadphase),e.btGhostPairCallback_create());var i=t.flags;if(i&u.PHYSICSENGINEFLAGS_COLLISIONSONLY)this._btCollisionWorld=new e.btCollisionWorld(this._btDispatcher,this._btBroadphase,this._btCollisionConfiguration);else{if(i&u.PHYSICSENGINEFLAGS_SOFTBODYSUPPORT)throw"PhysicsSimulation:SoftBody processing is not yet available";var a=e.btSequentialImpulseConstraintSolver_create();this._btDiscreteDynamicsWorld=e.btDiscreteDynamicsWorld_create(this._btDispatcher,this._btBroadphase,a,this._btCollisionConfiguration),this._btCollisionWorld=this._btDiscreteDynamicsWorld}this._btDiscreteDynamicsWorld&&(this._btSolverInfo=e.btDynamicsWorld_getSolverInfo(this._btDiscreteDynamicsWorld),this._btDispatchInfo=e.btCollisionWorld_getDispatchInfo(this._btDiscreteDynamicsWorld)),this._btClosestRayResultCallback=e.ClosestRayResultCallback_create(this._btVector3Zero,this._btVector3Zero),this._btAllHitsRayResultCallback=e.AllHitsRayResultCallback_create(this._btVector3Zero,this._btVector3Zero),this._btClosestConvexResultCallback=e.ClosestConvexResultCallback_create(this._btVector3Zero,this._btVector3Zero),this._btAllConvexResultCallback=e.AllConvexResultCallback_create(this._btVector3Zero,this._btVector3Zero),this.setHitsRayResultCallbackFlag(),e.btGImpactCollisionAlgorithm_RegisterAlgorithm(this._btDispatcher)}_simulate(t){this._updatedRigidbodies=0;var e=d.a.Physics3D._bullet;this._btDiscreteDynamicsWorld?e.btDiscreteDynamicsWorld_stepSimulation(this._btDiscreteDynamicsWorld,t,this.maxSubSteps,this.fixedTimeStep):e.PerformDiscreteCollisionDetection(this._btCollisionWorld)}_destroy(){var t=d.a.Physics3D._bullet;this._btDiscreteDynamicsWorld?(t.btCollisionWorld_destroy(this._btDiscreteDynamicsWorld),this._btDiscreteDynamicsWorld=null):(t.btCollisionWorld_destroy(this._btCollisionWorld),this._btCollisionWorld=null),t.btDbvtBroadphase_destroy(this._btBroadphase),this._btBroadphase=null,t.btCollisionDispatcher_destroy(this._btDispatcher),this._btDispatcher=null,t.btDefaultCollisionConfiguration_destroy(this._btCollisionConfiguration),this._btCollisionConfiguration=null}_addPhysicsCollider(t,e,i){d.a.Physics3D._bullet.btCollisionWorld_addCollisionObject(this._btCollisionWorld,t._btColliderObject,e,i)}_removePhysicsCollider(t){d.a.Physics3D._bullet.btCollisionWorld_removeCollisionObject(this._btCollisionWorld,t._btColliderObject)}_addRigidBody(t,e,i){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";d.a.Physics3D._bullet.btDiscreteDynamicsWorld_addRigidBody(this._btCollisionWorld,t._btColliderObject,e,i)}_removeRigidBody(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";d.a.Physics3D._bullet.btDiscreteDynamicsWorld_removeRigidBody(this._btCollisionWorld,t._btColliderObject)}_addCharacter(t,e,i){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";var a=d.a.Physics3D._bullet;a.btCollisionWorld_addCollisionObject(this._btCollisionWorld,t._btColliderObject,e,i),a.btDynamicsWorld_addAction(this._btCollisionWorld,t._btKinematicCharacter)}_removeCharacter(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";var e=d.a.Physics3D._bullet;e.btCollisionWorld_removeCollisionObject(this._btCollisionWorld,t._btColliderObject),e.btDynamicsWorld_removeAction(this._btCollisionWorld,t._btKinematicCharacter)}raycastFromTo(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l.a.COLLISIONFILTERGROUP_ALLFILTER,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:l.a.COLLISIONFILTERGROUP_ALLFILTER;var s=d.a.Physics3D._bullet,n=this._btClosestRayResultCallback,o=u._btTempVector30,h=u._btTempVector31;if(s.btVector3_setValue(o,-t.x,t.y,t.z),s.btVector3_setValue(h,-e.x,e.y,e.z),s.ClosestRayResultCallback_set_m_rayFromWorld(n,o),s.ClosestRayResultCallback_set_m_rayToWorld(n,h),s.RayResultCallback_set_m_collisionFilterGroup(n,a),s.RayResultCallback_set_m_collisionFilterMask(n,r),s.RayResultCallback_set_m_collisionObject(n,null),s.RayResultCallback_set_m_closestHitFraction(n,1),s.btCollisionWorld_rayTest(this._btCollisionWorld,o,h,n),s.RayResultCallback_hasHit(n)){if(i){i.succeeded=!0,i.collider=c.a._physicObjectsMap[s.btCollisionObject_getUserIndex(s.RayResultCallback_get_m_collisionObject(n))],i.hitFraction=s.RayResultCallback_get_m_closestHitFraction(n);var _=s.ClosestRayResultCallback_get_m_hitPointWorld(n),f=i.point;f.x=-s.btVector3_x(_),f.y=s.btVector3_y(_),f.z=s.btVector3_z(_);var m=s.ClosestRayResultCallback_get_m_hitNormalWorld(n),p=i.normal;p.x=-s.btVector3_x(m),p.y=s.btVector3_y(m),p.z=s.btVector3_z(m)}return!0}return i&&(i.succeeded=!1),!1}raycastAllFromTo(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l.a.COLLISIONFILTERGROUP_ALLFILTER,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:l.a.COLLISIONFILTERGROUP_ALLFILTER;var s=d.a.Physics3D._bullet,n=this._btAllHitsRayResultCallback,o=u._btTempVector30,h=u._btTempVector31;i.length=0,s.btVector3_setValue(o,-t.x,t.y,t.z),s.btVector3_setValue(h,-e.x,e.y,e.z),s.AllHitsRayResultCallback_set_m_rayFromWorld(n,o),s.AllHitsRayResultCallback_set_m_rayToWorld(n,h),s.RayResultCallback_set_m_collisionFilterGroup(n,a),s.RayResultCallback_set_m_collisionFilterMask(n,r);var _=s.AllHitsRayResultCallback_get_m_collisionObjects(n),f=s.AllHitsRayResultCallback_get_m_hitPointWorld(n),m=s.AllHitsRayResultCallback_get_m_hitNormalWorld(n),p=s.AllHitsRayResultCallback_get_m_hitFractions(n);s.tBtCollisionObjectArray_clear(_),s.tVector3Array_clear(f),s.tVector3Array_clear(m),s.tScalarArray_clear(p),s.btCollisionWorld_rayTest(this._btCollisionWorld,o,h,n);var g=s.tBtCollisionObjectArray_size(_);if(g>0){this._collisionsUtils.recoverAllHitResultsPool();for(var v=0;v<g;v++){var T=this._collisionsUtils.getHitResult();i.push(T),T.succeeded=!0,T.collider=c.a._physicObjectsMap[s.btCollisionObject_getUserIndex(s.tBtCollisionObjectArray_at(_,v))],T.hitFraction=s.tScalarArray_at(p,v);var E=s.tVector3Array_at(f,v),S=T.point;S.x=-s.btVector3_x(E),S.y=s.btVector3_y(E),S.z=s.btVector3_z(E);var R=s.tVector3Array_at(m,v),x=T.normal;x.x=-s.btVector3_x(R),x.y=s.btVector3_y(R),x.z=s.btVector3_z(R)}return!0}return!1}rayCast(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2147483647,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l.a.COLLISIONFILTERGROUP_ALLFILTER,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:l.a.COLLISIONFILTERGROUP_ALLFILTER;var s=t.origin,n=u._tempVector30;return o.a.normalize(t.direction,n),o.a.scale(n,i,n),o.a.add(s,n,n),this.raycastFromTo(s,n,e,a,r)}rayCastAll(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2147483647,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l.a.COLLISIONFILTERGROUP_ALLFILTER,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:l.a.COLLISIONFILTERGROUP_ALLFILTER;var s=t.origin,n=u._tempVector30;return o.a.normalize(t.direction,n),o.a.scale(n,i,n),o.a.add(s,n,n),this.raycastAllFromTo(s,n,e,a,r)}shapeCast(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:l.a.COLLISIONFILTERGROUP_ALLFILTER,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:l.a.COLLISIONFILTERGROUP_ALLFILTER,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;var _=d.a.Physics3D._bullet,f=this._btClosestConvexResultCallback,m=u._btTempVector30,p=u._btTempVector31,g=u._btTempQuaternion0,v=u._btTempQuaternion1,T=u._btTempTransform0,E=u._btTempTransform1,S=t._btShape;if(_.btVector3_setValue(m,-e.x,e.y,e.z),_.btVector3_setValue(p,-i.x,i.y,i.z),_.ConvexResultCallback_set_m_collisionFilterGroup(f,n),_.ConvexResultCallback_set_m_collisionFilterMask(f,o),_.btTransform_setOrigin(T,m),_.btTransform_setOrigin(E,p),r?(_.btQuaternion_setValue(g,-r.x,r.y,r.z,-r.w),_.btTransform_setRotation(T,g)):_.btTransform_setRotation(T,this._btDefaultQuaternion),s?(_.btQuaternion_setValue(v,-s.x,s.y,s.z,-s.w),_.btTransform_setRotation(E,v)):_.btTransform_setRotation(E,this._btDefaultQuaternion),_.ClosestConvexResultCallback_set_m_hitCollisionObject(f,null),_.ConvexResultCallback_set_m_closestHitFraction(f,1),_.btCollisionWorld_convexSweepTest(this._btCollisionWorld,S,T,E,f,h),_.ConvexResultCallback_hasHit(f)){if(a){a.succeeded=!0,a.collider=c.a._physicObjectsMap[_.btCollisionObject_getUserIndex(_.ClosestConvexResultCallback_get_m_hitCollisionObject(f))],a.hitFraction=_.ConvexResultCallback_get_m_closestHitFraction(f);var R=_.ClosestConvexResultCallback_get_m_hitPointWorld(f),x=_.ClosestConvexResultCallback_get_m_hitNormalWorld(f),A=a.point,y=a.normal;A.x=-_.btVector3_x(R),A.y=_.btVector3_y(R),A.z=_.btVector3_z(R),y.x=-_.btVector3_x(x),y.y=_.btVector3_y(x),y.z=_.btVector3_z(x)}return!0}return a&&(a.succeeded=!1),!1}shapeCastAll(t,e,i,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:l.a.COLLISIONFILTERGROUP_ALLFILTER,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:l.a.COLLISIONFILTERGROUP_ALLFILTER,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;var _=d.a.Physics3D._bullet,f=this._btAllConvexResultCallback,m=u._btTempVector30,p=u._btTempVector31,g=u._btTempQuaternion0,v=u._btTempQuaternion1,T=u._btTempTransform0,E=u._btTempTransform1,S=t._btShape;a.length=0,_.btVector3_setValue(m,-e.x,e.y,e.z),_.btVector3_setValue(p,-i.x,i.y,i.z),_.ConvexResultCallback_set_m_collisionFilterGroup(f,n),_.ConvexResultCallback_set_m_collisionFilterMask(f,o),_.btTransform_setOrigin(T,m),_.btTransform_setOrigin(E,p),r?(_.btQuaternion_setValue(g,-r.x,r.y,r.z,-r.w),_.btTransform_setRotation(T,g)):_.btTransform_setRotation(T,this._btDefaultQuaternion),s?(_.btQuaternion_setValue(v,-s.x,s.y,s.z,-s.w),_.btTransform_setRotation(E,v)):_.btTransform_setRotation(E,this._btDefaultQuaternion);var R=_.AllConvexResultCallback_get_m_collisionObjects(f),x=_.AllConvexResultCallback_get_m_hitPointWorld(f),A=_.AllConvexResultCallback_get_m_hitNormalWorld(f),y=_.AllConvexResultCallback_get_m_hitFractions(f);_.tVector3Array_clear(x),_.tVector3Array_clear(A),_.tScalarArray_clear(y),_.tBtCollisionObjectArray_clear(R),_.btCollisionWorld_convexSweepTest(this._btCollisionWorld,S,T,E,f,h);var I=_.tBtCollisionObjectArray_size(R);if(I>0){this._collisionsUtils.recoverAllHitResultsPool();for(var C=0;C<I;C++){var M=this._collisionsUtils.getHitResult();a.push(M),M.succeeded=!0,M.collider=c.a._physicObjectsMap[_.btCollisionObject_getUserIndex(_.tBtCollisionObjectArray_at(R,C))],M.hitFraction=_.tScalarArray_at(y,C);var D=_.tVector3Array_at(x,C),b=M.point;b.x=-_.btVector3_x(D),b.y=_.btVector3_y(D),b.z=_.btVector3_z(D);var L=_.tVector3Array_at(A,C),O=M.normal;O.x=-_.btVector3_x(L),O.y=_.btVector3_y(L),O.z=_.btVector3_z(L)}return!0}return!1}addConstraint(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._btDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";d.a.Physics3D._bullet.btCollisionWorld_addConstraint(this._btDiscreteDynamicsWorld,t._btConstraint,e),this._currentConstraint[t.id]=t}removeConstraint(t){if(!this._btDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";d.a.Physics3D._bullet.btCollisionWorld_removeConstraint(this._btDiscreteDynamicsWorld,t._btConstraint),delete this._currentConstraint[t.id]}setHitsRayResultCallbackFlag(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;var e=d.a.Physics3D._bullet;e.RayResultCallback_set_m_flags(this._btAllHitsRayResultCallback,t),e.RayResultCallback_set_m_flags(this._btClosestRayResultCallback,t)}_updatePhysicsTransformFromRender(){for(var t=this._physicsUpdateList.elements,e=0,i=this._physicsUpdateList.length;e<i;e++){var a=t[e];a._derivePhysicsTransformation(!1),a._inPhysicUpdateListIndex=-1}this._physicsUpdateList.length=0}_updateCharacters(){for(var t=0,e=this._characters.length;t<e;t++){var i=this._characters[t];i._updateTransformComponent(d.a.Physics3D._bullet.btCollisionObject_getWorldTransform(i._btColliderObject))}}_updateCollisions(){this._collisionsUtils.recoverAllContactPointsPool();var t=this._currentFrameCollisions;this._currentFrameCollisions=this._previousFrameCollisions,this._currentFrameCollisions.length=0,this._previousFrameCollisions=t;for(var e=n.a.loopCount,i=d.a.Physics3D._bullet,a=i.btDispatcher_getNumManifolds(this._btDispatcher),r=0;r<a;r++){var s,o=i.btDispatcher_getManifoldByIndexInternal(this._btDispatcher,r),l=c.a._physicObjectsMap[i.btCollisionObject_getUserIndex(i.btPersistentManifold_getBody0(o))],h=c.a._physicObjectsMap[i.btCollisionObject_getUserIndex(i.btPersistentManifold_getBody1(o))],_=null,u=null;if((l.isTrigger||h.isTrigger)&&(l.owner._needProcessTriggers||h.owner._needProcessTriggers))for(var f=i.btPersistentManifold_getNumContacts(o),m=0;m<f;m++){var p=i.btPersistentManifold_getContactPoint(o,m),g=i.btManifoldPoint_getDistance(p);if(g<=0){u=(_=this._collisionsUtils.getCollision(l,h)).contacts,(s=_._updateFrame!==e)&&(_._isTrigger=!0,u.length=0);break}}else if((l.owner._needProcessCollisions||h.owner._needProcessCollisions)&&(l._enableProcessCollisions||h._enableProcessCollisions))for(f=i.btPersistentManifold_getNumContacts(o),m=0;m<f;m++)if(p=i.btPersistentManifold_getContactPoint(o,m),(g=i.btManifoldPoint_getDistance(p))<=0){var v=this._collisionsUtils.getContactPoints();v.colliderA=l,v.colliderB=h,v.distance=g;var T=i.btManifoldPoint_get_m_normalWorldOnB(p),E=v.normal;E.x=-i.btVector3_x(T),E.y=i.btVector3_y(T),E.z=i.btVector3_z(T);var S=i.btManifoldPoint_get_m_positionWorldOnA(p),R=v.positionOnA;R.x=-i.btVector3_x(S),R.y=i.btVector3_y(S),R.z=i.btVector3_z(S);var x=i.btManifoldPoint_get_m_positionWorldOnB(p),A=v.positionOnB;A.x=-i.btVector3_x(x),A.y=i.btVector3_y(x),A.z=i.btVector3_z(x),_||(u=(_=this._collisionsUtils.getCollision(l,h)).contacts,(s=_._updateFrame!==e)&&(_._isTrigger=!1,u.length=0)),u.push(v)}_&&s&&(this._currentFrameCollisions.push(_),_._setUpdateFrame(e))}}_eventScripts(){for(var t=n.a.loopCount,e=0,i=this._currentFrameCollisions.length;e<i;e++){var a=this._currentFrameCollisions[e],r=a._colliderA,s=a._colliderB;if(!r.destroyed&&!s.destroyed)if(t-a._lastUpdateFrame==1){var o=r.owner,l=o._scripts;if(l)if(a._isTrigger){if(o._needProcessTriggers)for(var h=0,_=l.length;h<_;h++)l[h].onTriggerStay(s)}else if(o._needProcessCollisions)for(h=0,_=l.length;h<_;h++)a.other=s,l[h].onCollisionStay(a);var c=s.owner,d=c._scripts;if(d)if(a._isTrigger){if(c._needProcessTriggers)for(h=0,_=d.length;h<_;h++)d[h].onTriggerStay(r)}else if(c._needProcessCollisions)for(h=0,_=d.length;h<_;h++)a.other=r,d[h].onCollisionStay(a)}else{if(l=(o=r.owner)._scripts)if(a._isTrigger){if(o._needProcessTriggers)for(h=0,_=l.length;h<_;h++)l[h].onTriggerEnter(s)}else if(o._needProcessCollisions)for(h=0,_=l.length;h<_;h++)a.other=s,l[h].onCollisionEnter(a);if(d=(c=s.owner)._scripts)if(a._isTrigger){if(c._needProcessTriggers)for(h=0,_=d.length;h<_;h++)d[h].onTriggerEnter(r)}else if(c._needProcessCollisions)for(h=0,_=d.length;h<_;h++)a.other=r,d[h].onCollisionEnter(a)}}for(e=0,i=this._previousFrameCollisions.length;e<i;e++){var u=this._previousFrameCollisions[e],f=u._colliderA,m=u._colliderB;if(!f.destroyed&&!m.destroyed&&t-u._updateFrame==1){if(this._collisionsUtils.recoverCollision(u),l=(o=f.owner)._scripts)if(u._isTrigger){if(o._needProcessTriggers)for(h=0,_=l.length;h<_;h++)l[h].onTriggerExit(m)}else if(o._needProcessCollisions)for(h=0,_=l.length;h<_;h++)u.other=m,l[h].onCollisionExit(u);if(d=(c=m.owner)._scripts)if(u._isTrigger){if(c._needProcessTriggers)for(h=0,_=d.length;h<_;h++)d[h].onTriggerExit(f)}else if(c._needProcessCollisions)for(h=0,_=d.length;h<_;h++)u.other=f,d[h].onCollisionExit(u)}}for(var p in this._currentConstraint){var g=this._currentConstraint[p],v=g.owner._scripts;if(g.enabled&&g._isBreakConstrained()&&v&&0!=v.length)for(e=0,i=v.length;e<i;e++)v[e].onJointBreak()}}clearForces(){if(!this._btDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";d.a.Physics3D._bullet.btDiscreteDynamicsWorld_clearForces(this._btDiscreteDynamicsWorld)}}e.a=u,s()(u,"PHYSICSENGINEFLAGS_NONE",0),s()(u,"PHYSICSENGINEFLAGS_COLLISIONSONLY",1),s()(u,"PHYSICSENGINEFLAGS_SOFTBODYSUPPORT",2),s()(u,"PHYSICSENGINEFLAGS_MULTITHREADED",4),s()(u,"PHYSICSENGINEFLAGS_USEHARDWAREWHENPOSSIBLE",8),s()(u,"SOLVERMODE_RANDMIZE_ORDER",1),s()(u,"SOLVERMODE_FRICTION_SEPARATE",2),s()(u,"SOLVERMODE_USE_WARMSTARTING",4),s()(u,"SOLVERMODE_USE_2_FRICTION_DIRECTIONS",16),s()(u,"SOLVERMODE_ENABLE_FRICTION_DIRECTION_CACHING",32),s()(u,"SOLVERMODE_DISABLE_VELOCITY_DEPENDENT_FRICTION_DIRECTION",64),s()(u,"SOLVERMODE_CACHE_FRIENDLY",128),s()(u,"SOLVERMODE_SIMD",256),s()(u,"SOLVERMODE_INTERLEAVE_CONTACT_AND_FRICTION_CONSTRAINTS",512),s()(u,"SOLVERMODE_ALLOW_ZERO_LENGTH_FRICTION_DIRECTIONS",1024),s()(u,"HITSRAYRESULTCALLBACK_FLAG_NONE",0),s()(u,"HITSRAYRESULTCALLBACK_FLAG_FILTERBACKFACESS",1),s()(u,"HITSRAYRESULTCALLBACK_FLAG_KEEPUNFILIPPEDNORMAL",2),s()(u,"HITSRAYRESULTCALLBACK_FLAG_USESUBSIMPLEXCONVEXCASTRAYTEST",4),s()(u,"HITSRAYRESULTCALLBACK_FLAG_USEGJKCONVEXCASTRAYTEST",8),s()(u,"HITSRAYRESULTCALLBACK_FLAG_TERMINATOR",4294967295),s()(u,"_btTempVector30",void 0),s()(u,"_btTempVector31",void 0),s()(u,"_btTempQuaternion0",void 0),s()(u,"_btTempQuaternion1",void 0),s()(u,"_btTempTransform0",void 0),s()(u,"_btTempTransform1",void 0),s()(u,"_tempVector30",new o.a),s()(u,"disableSimulation",!1)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{constructor(){r()(this,"time",void 0)}cloneTo(t){t.time=this.time}clone(){var t=new s;return this.cloneTo(t),t}}e.a=s},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(98),n=i(2),o=i(12),l=i(24),h=i(1),_=i(13),c=i(421),d=i(423),u=i(424);class f extends s.a{static _update(t){for(var e=t._animatorPool,i=e.elements,a=0,r=e.length;a<r;a++){var s=i[a];s&&s.enabled&&s._update()}}get speed(){return this._speed}set speed(t){this._speed=t}constructor(){super(),r()(this,"_speed",void 0),r()(this,"_keyframeNodeOwnerMap",void 0),r()(this,"_keyframeNodeOwners",[]),r()(this,"_updateMark",void 0),r()(this,"_controllerLayers",void 0),r()(this,"_linkSprites",void 0),r()(this,"_avatarNodeMap",void 0),r()(this,"_linkAvatarSpritesData",{}),r()(this,"_linkAvatarSprites",[]),r()(this,"_renderableSprites",[]),r()(this,"cullingMode",f.CULLINGMODE_CULLCOMPLETELY),r()(this,"_animationNodeLocalPositions",void 0),r()(this,"_animationNodeLocalRotations",void 0),r()(this,"_animationNodeLocalScales",void 0),r()(this,"_animationNodeWorldMatrixs",void 0),r()(this,"_animationNodeParentIndices",void 0),r()(this,"_avatar",void 0),this._controllerLayers=[],this._linkSprites={},this._speed=1,this._keyframeNodeOwnerMap={},this._updateMark=0}_linkToSprites(t){for(var e in t){for(var i=this.owner,a=t[e],r=0,s=a.length;r<s;r++){var n=a[r];if(""===n)break;if(!(i=i.getChildByName(n)))break}i&&this.linkSprite3DToAvatarNode(e,i)}}_addKeyframeNodeOwner(t,e,i){var a=e._indexInList,r=e.fullPath,s=this._keyframeNodeOwnerMap[r];if(s)s.referenceCount++,t[a]=s;else{for(var n=i,o=0,l=e.propertyCount;o<l&&(n=n[e.getPropertyByIndex(o)]);o++);(s=this._keyframeNodeOwnerMap[r]=new u.a).fullPath=r,s.indexInList=this._keyframeNodeOwners.length,s.referenceCount=1,s.propertyOwner=i;var h=e.propertyCount,_=[];for(o=0;o<h;o++)_[o]=e.getPropertyByIndex(o);if(s.property=_,s.type=e.type,n)if(0===e.type)s.defaultValue=n;else{var c=new n.constructor;n.cloneTo(c),s.defaultValue=c,s.value=new n.constructor,s.crossFixedValue=new n.constructor}this._keyframeNodeOwners.push(s),t[a]=s}}_removeKeyframeNodeOwner(t,e){var i=e.fullPath,a=this._keyframeNodeOwnerMap[i];a&&(a.referenceCount--,0===a.referenceCount&&(delete this._keyframeNodeOwnerMap[i],this._keyframeNodeOwners.splice(this._keyframeNodeOwners.indexOf(a),1)),t[e._indexInList]=null)}_getOwnersByClip(t){var e=t._clip._nodes,i=e.count,a=t._nodeOwners;a.length=i;for(var r=0;r<i;r++){for(var s=e.getNodeByIndex(r),n=this._avatar?this._avatarNodeMap[this._avatar._rootNode.name]:this.owner,o=0,l=s.ownerPathCount;o<l;o++){var h=s.getOwnerPathByIndex(o);if(""===h)break;if(!(n=n.getChildByName(h)))break}if(n){var _=s.propertyOwner;_&&(n=n[_]),n&&this._addKeyframeNodeOwner(a,s,n)}}}_updatePlayer(t,e,i,a){var r=t._clip._duration*(t.clipEnd-t.clipStart),s=e._elapsedTime,n=s+i;e._lastElapsedTime=s,e._elapsedTime=n;var o=n/r;e._normalizedTime=o;var l=o%1;e._normalizedPlayTime=l<0?l+1:l,e._duration=r;var h=t._scripts;if(!a&&n>=r){if(e._finish=!0,e._elapsedTime=r,e._normalizedPlayTime=1,h)for(var _=0,c=h.length;_<c;_++)h[_].onStateExit()}else if(h)for(_=0,c=h.length;_<c;_++)h[_].onStateUpdate()}_eventScript(t,e,i,a,r){if(r)for(var s=e.length;i<s;i++){var n=e[i];if(!(n.time<=a))break;for(var o=0,l=t.length;o<l;o++){var h=t[o],_=h[n.eventName];_&&_.apply(h,n.params)}}else for(;i>=0&&(n=e[i]).time>=a;i--)for(o=0,l=t.length;o<l;o++)(_=(h=t[o])[n.eventName])&&_.apply(h,n.params);return i}_updateEventScript(t,e){var i=this.owner._scripts;if(i){var a=t._clip,r=a._animationEvents,s=a._duration,n=e._elapsedTime,o=n%s,l=Math.abs(Math.floor(n/s)-Math.floor(e._lastElapsedTime/s)),h=e._elapsedTime>=e._lastElapsedTime;e._lastIsFront!==h&&(h?e._playEventIndex++:e._playEventIndex--,e._lastIsFront=h);var _=e._playEventIndex;if(h){var c=this._eventScript(i,r,e._playEventIndex,l>0?s:o,!0);_===e._playEventIndex&&(e._playEventIndex=c);for(var d=0,u=l-1;d<u;d++)this._eventScript(i,r,0,s,!0);l>0&&o>0&&(e._playEventIndex=this._eventScript(i,r,0,o,!0))}else{c=this._eventScript(i,r,e._playEventIndex,l>0?0:o,!1);_===e._playEventIndex&&(e._playEventIndex=c);var f=r.length-1;for(d=0,u=l-1;d<u;d++)this._eventScript(i,r,f,0,!1);l>0&&o>0&&(e._playEventIndex=this._eventScript(i,r,f,o,!1))}}}_updateClipDatas(t,e,i,a){var r=t._clip,s=r._duration,n=t.clipStart*s+i._normalizedPlayTime*i._duration,o=t._currentFrameIndices,l=i._elapsedTime>i._lastElapsedTime;r._evaluateClipDatasRealTime(r._nodes,n,o,e,l,t._realtimeDatas)}_applyFloat(t,e,i,a,r,s,n){if(i.updateMark===this._updateMark)if(a)t[e]+=r*n;else{var o=t[e];t[e]=o+r*(n-o)}else if(s)t[e]=a?i.defaultValue+n:n;else if(a)t[e]=i.defaultValue+r*n;else{var l=i.defaultValue;t[e]=l+r*(n-l)}}_applyPositionAndRotationEuler(t,e,i,a,r,s){if(t.updateMark===this._updateMark)if(e)s.x+=i*r.x,s.y+=i*r.y,s.z+=i*r.z;else{var n=s.x,o=s.y,l=s.z;s.x=n+i*(r.x-n),s.y=o+i*(r.y-o),s.z=l+i*(r.z-l)}else if(a)if(e){var h=t.defaultValue;s.x=h.x+r.x,s.y=h.y+r.y,s.z=h.z+r.z}else s.x=r.x,s.y=r.y,s.z=r.z;else if(h=t.defaultValue,e)s.x=h.x+i*r.x,s.y=h.y+i*r.y,s.z=h.z+i*r.z;else{var _=h.x,c=h.y,d=h.z;s.x=_+i*(r.x-_),s.y=c+i*(r.y-c),s.z=d+i*(r.z-d)}}_applyRotation(t,e,i,a,r,s){if(t.updateMark===this._updateMark)if(e){var n=f._tempQuaternion1;_.a.quaternionWeight(r,i,n),n.normalize(n),l.a.multiply(s,n,s)}else l.a.lerp(s,r,i,s);else if(a)if(e){var o=t.defaultValue;l.a.multiply(o,r,s)}else s.x=r.x,s.y=r.y,s.z=r.z,s.w=r.w;else o=t.defaultValue,e?(n=f._tempQuaternion1,_.a.quaternionWeight(r,i,n),n.normalize(n),l.a.multiply(o,n,s)):l.a.lerp(o,r,i,s)}_applyScale(t,e,i,a,r,s){if(t.updateMark===this._updateMark)if(e){var n=f._tempVector31;_.a.scaleWeight(r,i,n),s.x=s.x*n.x,s.y=s.y*n.y,s.z=s.z*n.z}else _.a.scaleBlend(s,r,i,s);else if(a)if(e){var o=t.defaultValue;s.x=o.x*r.x,s.y=o.y*r.y,s.z=o.z*r.z}else s.x=r.x,s.y=r.y,s.z=r.z;else o=t.defaultValue,e?(n=f._tempVector31,_.a.scaleWeight(r,i,n),s.x=o.x*n.x,s.y=o.y*n.y,s.z=o.z*n.z):_.a.scaleBlend(o,r,i,s)}_applyCrossData(t,e,i,a,r,s,n){var o=t.propertyOwner;if(o){switch(t.type){case 0:for(var h=t.property,c=h.length-1,d=0;d<c&&(o=o[h[d]]);d++);var u=r+n*(s-r);t.value=u,this._applyFloat(o,h[c],t,e,i,a,u);break;case 1:var f=o.localPosition,m=t.value,p=r.x,g=r.y,v=r.z;m.x=p+n*(s.x-p),m.y=g+n*(s.y-g),m.z=v+n*(s.z-v),this._applyPositionAndRotationEuler(t,e,i,a,m,f),o.localPosition=f;break;case 2:var T=o.localRotation,E=t.value;l.a.lerp(r,s,n,E),this._applyRotation(t,e,i,a,E,T),o.localRotation=T;break;case 3:var S=o.localScale,R=t.value;_.a.scaleBlend(r,s,n,R),this._applyScale(t,e,i,a,R,S),o.localScale=S;break;case 4:var x=o.localRotationEuler,A=t.value;p=r.x,g=r.y,v=r.z,A.x=p+n*(s.x-p),A.y=g+n*(s.y-g),A.z=v+n*(s.z-v),this._applyPositionAndRotationEuler(t,e,i,a,A,x),o.localRotationEuler=x}t.updateMark=this._updateMark}}_setClipDatasToNode(t,e,i,a){for(var r=t._realtimeDatas,s=t._clip._nodes,n=t._nodeOwners,o=0,l=s.count;o<l;o++){var h=n[o];if(h){var _=h.propertyOwner;if(_){switch(h.type){case 0:for(var c=h.property,d=c.length-1,u=0;u<d&&(_=_[c[u]]);u++);this._applyFloat(_,c[d],h,e,i,a,r[o]);break;case 1:var f=_.localPosition;this._applyPositionAndRotationEuler(h,e,i,a,r[o],f),_.localPosition=f;break;case 2:var m=_.localRotation;this._applyRotation(h,e,i,a,r[o],m),_.localRotation=m;break;case 3:var p=_.localScale;this._applyScale(h,e,i,a,r[o],p),_.localScale=p;break;case 4:var g=_.localRotationEuler;this._applyPositionAndRotationEuler(h,e,i,a,r[o],g),_.localRotationEuler=g}h.updateMark=this._updateMark}}}}_setCrossClipDatasToNode(t,e,i,a,r){for(var s=t._crossNodesOwners,n=t._crossNodesOwnersCount,o=t.blendingMode!==c.a.BLENDINGMODE_OVERRIDE,l=t.defaultWeight,h=i._realtimeDatas,_=t._destCrossClipNodeIndices,d=i._nodeOwners,u=e._realtimeDatas,f=t._srcCrossClipNodeIndices,m=e._nodeOwners,p=0;p<n;p++){var g=s[p];if(g){var v=f[p],T=_[p],E=-1!==v?u[v]:d[T].defaultValue,S=-1!==T?h[T]:m[v].defaultValue;this._applyCrossData(g,o,l,r,E,S,a)}}}_setFixedCrossClipDatasToNode(t,e,i,a){for(var r=t._crossNodesOwners,s=t._crossNodesOwnersCount,n=t.blendingMode!==c.a.BLENDINGMODE_OVERRIDE,o=t.defaultWeight,l=e._realtimeDatas,h=t._destCrossClipNodeIndices,_=0;_<s;_++){var d=r[_];if(d){var u=h[_],f=d.crossFixedValue,m=-1!==u?l[u]:d.defaultValue;this._applyCrossData(d,n,o,a,f,m,i)}}}_revertDefaultKeyframeNodes(t){for(var e=t._nodeOwners,i=0,a=e.length;i<a;i++){var r=e[i];if(r){var s=r.propertyOwner;if(s)switch(r.type){case 0:for(var n=r.property,o=n.length-1,l=0;l<o&&(s=s[n[l]]);l++);s[n[o]]=r.defaultValue;break;case 1:var h=s.localPosition,_=r.defaultValue;h.x=_.x,h.y=_.y,h.z=_.z,s.localPosition=h;break;case 2:var c=s.localRotation,d=r.defaultValue;c.x=d.x,c.y=d.y,c.z=d.z,c.w=d.w,s.localRotation=c;break;case 3:var u=s.localScale;_=r.defaultValue,u.x=_.x,u.y=_.y,u.z=_.z,s.localScale=u;break;case 4:var f=s.localRotationEuler;_=r.defaultValue,f.x=_.x,f.y=_.y,f.z=_.z,s.localRotationEuler=f;break;default:throw"Animator:unknown type."}}}}_onAdded(){var t=this.owner._parent;this.owner._setHierarchyAnimator(this,t?t._hierarchyAnimator:null),this.owner._changeAnimatorToLinkSprite3DNoAvatar(this,!0,[])}_onDestroy(){for(var t=0,e=this._controllerLayers.length;t<e;t++)this._controllerLayers[t]._removeReference();var i=this.owner._parent;this.owner._clearHierarchyAnimator(this,i?i._hierarchyAnimator:null)}_onEnable(){this.owner._scene._animatorPool.add(this);for(var t=0,e=this._controllerLayers.length;t<e;t++){if(this._controllerLayers[t].playOnWake)this.getDefaultState(t)&&this.play(null,t,0)}}_onDisable(){this.owner._scene._animatorPool.remove(this)}_handleSpriteOwnersBySprite(t,e,i){for(var a=0,r=this._controllerLayers.length;a<r;a++)for(var s=this._controllerLayers[a]._states,n=0,o=s.length;n<o;n++){var l=s[n],h=l._clip,_=e.join("/"),c=h._nodesMap[_];if(c)for(var d=l._nodeOwners,u=0,f=c.length;u<f;u++)t?this._addKeyframeNodeOwner(d,c[u],i):this._removeKeyframeNodeOwner(d,c[u])}}_parse(t){var e=t.avatar;if(e){this.avatar=o.a.getRes(e.path);var i=e.linkSprites;this._linkSprites=i,this._linkToSprites(i)}t.clipPaths;for(var a=t.playOnWake,r=t.layers,s=0;s<r.length;s++){var n=r[s],l=new c.a(n.name);l.defaultWeight=0===s?1:n.weight;var h=n.blendingMode;h&&(l.blendingMode=h),this.addControllerLayer(l);for(var _=n.states,u=0,f=_.length;u<f;u++){var m=_[u],p=m.clipPath;if(p){var g,v=m.name;if(g=o.a.getRes(p)){var T=new d.a;T.name=v,T.clip=g,l.addState(T),0===u&&(this.getControllerLayer(s).defaultState=T)}}}void 0!==a&&(l.playOnWake=a)}var E=t.cullingMode;void 0!==E&&(this.cullingMode=E)}_update(){var t=this.owner._scene.timer,e=t._delta/1e3;if(0!==this._speed&&0!==e){var i;if(this.cullingMode===f.CULLINGMODE_CULLCOMPLETELY){i=!1;for(var a=0,r=this._renderableSprites.length;a<r;a++)if(this._renderableSprites[a]._render.isRender){i=!0;break}}else i=!0;this._updateMark++;var s=t.scale;for(a=0,r=this._controllerLayers.length;a<r;a++){var n=this._controllerLayers[a],o=n._playStateInfo,l=n._crossPlayStateInfo;switch(m=n.blendingMode!==c.a.BLENDINGMODE_OVERRIDE,n._playType){case 0:var h=o._currentState,_=h._clip,d=this._speed*h.speed,u=o._finish;if(u||this._updatePlayer(h,o,e*d,_.islooping),i){var m=n.blendingMode!==c.a.BLENDINGMODE_OVERRIDE;this._updateClipDatas(h,m,o,s*d),this._setClipDatasToNode(h,m,n.defaultWeight,0===a),u||this._updateEventScript(h,o)}break;case 1:_=(h=o._currentState)._clip;var p=n._crossPlayState,g=p._clip,v=n._crossDuration,T=l._startPlayTime,E=g._duration-T,S=v>E?E/v:1,R=this._speed*p.speed;this._updatePlayer(p,l,e*S*R,g.islooping);var x=(l._elapsedTime-T)/S/v;x>=1?i&&(this._updateClipDatas(p,m,l,s*R),this._setClipDatasToNode(p,m,n.defaultWeight,0===a),n._playType=0,o._currentState=p,l._cloneTo(o)):(o._finish||(d=this._speed*h.speed,this._updatePlayer(h,o,e*d,_.islooping),i&&this._updateClipDatas(h,m,o,s*d)),i&&(this._updateClipDatas(p,m,l,s*S*R),this._setCrossClipDatasToNode(n,h,p,x,0===a))),i&&(this._updateEventScript(h,o),this._updateEventScript(p,l));break;case 2:g=(p=n._crossPlayState)._clip,v=n._crossDuration,T=l._startPlayTime,S=v>(E=g._duration-T)?E/v:1,R=this._speed*p.speed,this._updatePlayer(p,l,e*S*R,g.islooping),i&&((x=(l._elapsedTime-T)/S/v)>=1?(this._updateClipDatas(p,m,l,s*R),this._setClipDatasToNode(p,m,1,0===a),n._playType=0,o._currentState=p,l._cloneTo(o)):(this._updateClipDatas(p,m,l,s*S*R),this._setFixedCrossClipDatasToNode(n,p,x,0===a)),this._updateEventScript(p,l))}}i&&this._avatar&&this._updateAvatarNodesToSprite()}}_cloneTo(t){var e=t;e.avatar=this.avatar,e.cullingMode=this.cullingMode;for(var i=0,a=this._controllerLayers.length;i<a;i++){var r=this._controllerLayers[i];e.addControllerLayer(r.clone());for(var s=r._states,n=0,o=s.length;n<o;n++){var l=s[n].clone(),h=e.getControllerLayer(i);h.addState(l),0==n&&(h.defaultState=l)}}e._linkSprites=this._linkSprites,e._linkToSprites(this._linkSprites)}getDefaultState(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._controllerLayers[t].defaultState}addState(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._controllerLayers[e].addState(t),console.warn("Animator:this function is discard,please use animatorControllerLayer.addState() instead.")}removeState(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._controllerLayers[e].removeState(t),console.warn("Animator:this function is discard,please use animatorControllerLayer.removeState() instead.")}addControllerLayer(t){this._controllerLayers.push(t),t._animator=this,t._addReference();for(var e=t._states,i=0,a=e.length;i<a;i++)this._getOwnersByClip(e[i])}getControllerLayer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._controllerLayers[t]}play(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.NEGATIVE_INFINITY;var a=this._controllerLayers[e];if(a){var r=a.defaultState;if(!t&&!r)throw new Error("Animator:must have default clip value,please set clip property.");var s=a._playStateInfo,n=s._currentState,o=t?a._statesMap[t]:r,l=o._clip._duration;n!==o?(i!==Number.NEGATIVE_INFINITY?s._resetPlayState(l*i):s._resetPlayState(0),null!==n&&n!==o&&this._revertDefaultKeyframeNodes(n),a._playType=0,s._currentState=o):i!==Number.NEGATIVE_INFINITY&&(s._resetPlayState(l*i),a._playType=0);var h=o._scripts;if(h)for(var _=0,c=h.length;_<c;_++)h[_].onStateEnter()}else console.warn("Invalid layerIndex "+e+".")}crossFade(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.NEGATIVE_INFINITY;var r=this._controllerLayers[i];if(r){var s=r._statesMap[t];if(s){var n=r._playType;if(-1===n)return void this.play(t,i,a);var o=r._crossPlayStateInfo,l=r._crossNodesOwners,h=r._crossNodesOwnersIndicesMap,_=r._playStateInfo._currentState,c=s._nodeOwners,d=r._destCrossClipNodeIndices,u=s._clip,f=u._nodes,m=u._nodesDic;switch(n){case 0:var p=_._nodeOwners,g=r._srcCrossClipNodeIndices,v=_._clip,T=v._nodes,E=v._nodesDic;r._playType=1;for(var S=++r._crossMark,R=r._crossNodesOwnersCount=0,x=0,A=T.count;x<A;x++){var y=T.getNodeByIndex(x),I=y._indexInList,C=p[I];if(C){var M=y.fullPath;g[R]=I;var D=m[M];d[R]=D?D._indexInList:-1,h[M]=S,l[R]=C,R++}}for(x=0,A=f.count;x<A;x++){var b=(D=f.getNodeByIndex(x))._indexInList,L=c[b];if(L){var O=D.fullPath;E[O]||(g[R]=-1,d[R]=b,h[O]=S,l[R]=L,R++)}}break;case 1:case 2:for(r._playType=2,x=0,A=l.length;x<A;x++){var P=l[x];P.saveCrossFixedValue(),D=m[P.fullPath],d[x]=D?D._indexInList:-1}for(R=r._crossNodesOwnersCount,S=r._crossMark,x=0,A=f.count;x<A;x++)(L=c[b=(D=f.getNodeByIndex(x))._indexInList])&&h[O=D.fullPath]!==S&&(d[R]=b,h[O]=S,P=c[b],l[R]=P,P.saveCrossFixedValue(),R++)}r._crossNodesOwnersCount=R,r._crossPlayState=s,r._crossDuration=_._clip._duration*e,a!==Number.NEGATIVE_INFINITY?o._resetPlayState(u._duration*a):o._resetPlayState(0);var N=s._scripts;if(N)for(x=0,A=N.length;x<A;x++)N[x].onStateEnter()}else console.warn("Invalid name "+i+".")}else console.warn("Invalid layerIndex "+i+".")}getCurrentAnimatorPlayState(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._controllerLayers[t]._playStateInfo}get avatar(){return this._avatar}set avatar(t){if(this._avatar!==t)if(this._avatar=t,t)this._getAvatarOwnersAndInitDatasAsync(),this.owner._changeHierarchyAnimatorAvatar(this,t);else{var e=this.owner._parent;this.owner._changeHierarchyAnimatorAvatar(this,e?e._hierarchyAnimator._avatar:null)}}_isLinkSpriteToAnimationNodeData(t,e,i){var a=this._linkAvatarSpritesData[e];if(i)a||(this._linkAvatarSpritesData[e]=a=[]),a.push(t);else{var r=a.indexOf(t);a.splice(r,1)}}_getAvatarOwnersAndInitDatasAsync(){for(var t=0,e=this._controllerLayers.length;t<e;t++)for(var i=this._controllerLayers[t]._states,a=0,r=i.length;a<r;a++)this._getOwnersByClip(i[a]);for(var s in this._avatar._cloneDatasToAnimator(this),this._linkAvatarSpritesData){var n=this._linkAvatarSpritesData[s];if(n)for(var o=0,l=n.length;o<l;o++)this._isLinkSpriteToAnimationNode(n[o],s,!0)}}_isLinkSpriteToAnimationNode(t,e,i){if(this._avatar){var a=this._avatarNodeMap[e];if(a)if(i){t._transform._dummy=a.transform,this._linkAvatarSprites.push(t);var r=a.transform,s=t.transform;if(!s.owner.isStatic&&r){var n=s.worldMatrix,o=this.owner._transform._parent;if(o)_.a.matrix4x4MultiplyMFM(o.worldMatrix,r.getWorldMatrix(),n);else for(var l=n.elements,h=r.getWorldMatrix(),c=0;c<16;c++)l[c]=h[c];s.worldMatrix=n}}else t._transform._dummy=null,this._linkAvatarSprites.splice(this._linkAvatarSprites.indexOf(t),1)}}_updateAvatarNodesToSprite(){for(var t=0,e=this._linkAvatarSprites.length;t<e;t++){var i=this._linkAvatarSprites[t],a=i.transform._dummy,r=i.transform;if(!r.owner.isStatic&&a){var s=r.worldMatrix,n=this.owner._transform;_.a.matrix4x4MultiplyMFM(n.worldMatrix,a.getWorldMatrix(),s),r.worldMatrix=s}}}linkSprite3DToAvatarNode(t,e){return this._isLinkSpriteToAnimationNodeData(e,t,!0),this._isLinkSpriteToAnimationNode(e,t,!0),!0}unLinkSprite3DToAvatarNode(t){var e=t.transform._dummy;if(e){var i=e._owner.name;return this._isLinkSpriteToAnimationNodeData(t,i,!1),this._isLinkSpriteToAnimationNode(t,i,!1),!0}return!1}_updateAnimationNodeWorldMatix(t,e,i,a,r){n.a.instance.updateAnimationNodeWorldMatix(t,e,i,r,a)}}e.a=f,r()(f,"_tempVector30",new h.a),r()(f,"_tempVector31",new h.a),r()(f,"_tempQuaternion0",new l.a),r()(f,"_tempQuaternion1",new l.a),r()(f,"CULLINGMODE_ALWAYSANIMATE",0),r()(f,"CULLINGMODE_CULLCOMPLETELY",2)},function(t,e,i){"use strict";i.d(e,"b",function(){return n});var a=i(0),r=i.n(a),s=i(63);let n;!function(t){t[t.Int=0]="Int",t[t.Bool=1]="Bool",t[t.Number=2]="Number",t[t.Vector2=3]="Vector2",t[t.Vector3=4]="Vector3",t[t.Vector=5]="Vector",t[t.Quaternion=6]="Quaternion",t[t.Matrix4x4=7]="Matrix4x4",t[t.Buffer=8]="Buffer",t[t.Texture=9]="Texture"}(n||(n={}));class o extends s.a{constructor(){super(...arguments),r()(this,"_shaderData",null),r()(this,"_nameID",0),r()(this,"_value",null),r()(this,"_dataType",-1)}static create(t,e,i,a,r){var s;return(s=o._pool.length>0?o._pool.pop():new o)._shaderData=t,s._nameID=e,s._value=i,s._dataType=a,s._commandBuffer=r,s}run(){switch(this._dataType){case n.Int:this._shaderData.setInt(this._nameID,this._value);break;case n.Number:this._shaderData.setNumber(this._nameID,this._value);break;case n.Bool:this._shaderData.setBool(this._nameID,this._value);break;case n.Matrix4x4:this._shaderData.setMatrix4x4(this._nameID,this._value);break;case n.Quaternion:this._shaderData.setQuaternion(this._nameID,this._value);break;case n.Texture:this._shaderData.setTexture(this._nameID,this._value);break;case n.Vector:this._shaderData.setVector(this._nameID,this._value);break;case n.Vector2:this._shaderData.setVector2(this._nameID,this._value);break;case n.Vector3:this._shaderData.setVector3(this._nameID,this._value);break;case n.Buffer:this._shaderData.setBuffer(this._nameID,this._value);break;default:throw"no type shaderValue on this CommendBuffer"}}recover(){o._pool.push(this),this._shaderData=null,this._nameID=0,this._value=null,this._dataType=-1}}e.a=o,r()(o,"_pool",[])},function(t,e,i){"use strict";i.d(e,"b",function(){return h});var a=i(0),r=i.n(a),s=i(1),n=i(99),o=i(175),l=i(176);let h;!function(t){t[t.FarBottomLeft=0]="FarBottomLeft",t[t.FarTopLeft=1]="FarTopLeft",t[t.FarTopRight=2]="FarTopRight",t[t.FarBottomRight=3]="FarBottomRight",t[t.nearBottomLeft=4]="nearBottomLeft",t[t.nearTopLeft=5]="nearTopLeft",t[t.nearTopRight=6]="nearTopRight",t[t.nearBottomRight=7]="nearBottomRight",t[t.unknown=8]="unknown"}(h||(h={}));class _{static getPlanesFromMatrix(t,e,i,a,r,s,n){var o=t.elements,l=o[0],h=o[1],_=o[2],c=o[3],d=o[4],u=o[5],f=o[6],m=o[7],p=o[8],g=o[9],v=o[10],T=o[11],E=o[12],S=o[13],R=o[14],x=o[15],A=e.normal;A.x=_,A.y=f,A.z=v,e.distance=R,e.normalize();var y=i.normal;y.x=c-_,y.y=m-f,y.z=T-v,i.distance=x-R,i.normalize();var I=a.normal;I.x=c+l,I.y=m+d,I.z=T+p,a.distance=x+E,a.normalize();var C=r.normal;C.x=c-l,C.y=m-d,C.z=T-p,r.distance=x-E,r.normalize();var M=s.normal;M.x=c-h,M.y=m-u,M.z=T-g,s.distance=x-S,s.normalize();var D=n.normal;D.x=c+h,D.y=m+u,D.z=T+g,n.distance=x+S,n.normalize()}constructor(t){r()(this,"_matrix",void 0),r()(this,"_near",void 0),r()(this,"_far",void 0),r()(this,"_left",void 0),r()(this,"_right",void 0),r()(this,"_top",void 0),r()(this,"_bottom",void 0),this._matrix=t,this._near=new n.a(new s.a),this._far=new n.a(new s.a),this._left=new n.a(new s.a),this._right=new n.a(new s.a),this._top=new n.a(new s.a),this._bottom=new n.a(new s.a),_.getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}get matrix(){return this._matrix}set matrix(t){t.cloneTo(this._matrix),_.getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}get near(){return this._near}get far(){return this._far}get left(){return this._left}get right(){return this._right}get top(){return this._top}get bottom(){return this._bottom}equalsBoundFrustum(t){return this._matrix.equalsOtherMatrix(t.matrix)}equalsObj(t){if(t instanceof _){var e=t;return this.equalsBoundFrustum(e)}return!1}getPlane(t){switch(t){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}}static get3PlaneInterPoint(t,e,i,a){var r=t.normal,n=e.normal,o=i.normal;s.a.cross(n,o,_._tempV30),s.a.cross(o,r,_._tempV31),s.a.cross(r,n,_._tempV32);var l=s.a.dot(r,_._tempV30),h=s.a.dot(n,_._tempV31),c=s.a.dot(o,_._tempV32);s.a.scale(_._tempV30,-t.distance/l,_._tempV33),s.a.scale(_._tempV31,-e.distance/h,_._tempV34),s.a.scale(_._tempV32,-i.distance/c,_._tempV35),s.a.add(_._tempV33,_._tempV34,_._tempV36),s.a.add(_._tempV35,_._tempV36,a)}getCorners(t){_.get3PlaneInterPoint(this._near,this._bottom,this._right,t[h.nearBottomRight]),_.get3PlaneInterPoint(this._near,this._top,this._right,t[h.nearTopRight]),_.get3PlaneInterPoint(this._near,this._top,this._left,t[h.nearTopLeft]),_.get3PlaneInterPoint(this._near,this._bottom,this._left,t[h.nearBottomLeft]),_.get3PlaneInterPoint(this._far,this._bottom,this._right,t[h.FarBottomRight]),_.get3PlaneInterPoint(this._far,this._top,this._right,t[h.FarTopRight]),_.get3PlaneInterPoint(this._far,this._top,this._left,t[h.FarTopLeft]),_.get3PlaneInterPoint(this._far,this._bottom,this._left,t[h.FarBottomLeft])}containsPoint(t){for(var e=n.a.PlaneIntersectionType_Front,i=n.a.PlaneIntersectionType_Front,a=0;a<6;a++){switch(a){case 0:i=o.a.intersectsPlaneAndPoint(this._near,t);break;case 1:i=o.a.intersectsPlaneAndPoint(this._far,t);break;case 2:i=o.a.intersectsPlaneAndPoint(this._left,t);break;case 3:i=o.a.intersectsPlaneAndPoint(this._right,t);break;case 4:i=o.a.intersectsPlaneAndPoint(this._top,t);break;case 5:i=o.a.intersectsPlaneAndPoint(this._bottom,t)}switch(i){case n.a.PlaneIntersectionType_Back:return l.a.Disjoint;case n.a.PlaneIntersectionType_Intersecting:e=n.a.PlaneIntersectionType_Intersecting}}switch(e){case n.a.PlaneIntersectionType_Intersecting:return l.a.Intersects;default:return l.a.Contains}}intersects(t){var e=t.min,i=t.max,a=e.x,r=e.y,s=e.z,n=i.x,o=i.y,l=i.z,h=this._near.normal;if(this._near.distance+h.x*(h.x<0?a:n)+h.y*(h.y<0?r:o)+h.z*(h.z<0?s:l)<0)return!1;var _=this._left.normal;if(this._left.distance+_.x*(_.x<0?a:n)+_.y*(_.y<0?r:o)+_.z*(_.z<0?s:l)<0)return!1;var c=this._right.normal;if(this._right.distance+c.x*(c.x<0?a:n)+c.y*(c.y<0?r:o)+c.z*(c.z<0?s:l)<0)return!1;var d=this._bottom.normal;if(this._bottom.distance+d.x*(d.x<0?a:n)+d.y*(d.y<0?r:o)+d.z*(d.z<0?s:l)<0)return!1;var u=this._top.normal;if(this._top.distance+u.x*(u.x<0?a:n)+u.y*(u.y<0?r:o)+u.z*(u.z<0?s:l)<0)return!1;var f=this._far.normal;return!(this._far.distance+f.x*(f.x<0?a:n)+f.y*(f.y<0?r:o)+f.z*(f.z<0?s:l)<0)}containsBoundBox(t){for(var e=_._tempV30,i=_._tempV31,a=t.min,r=t.max,s=l.a.Contains,h=0;h<6;h++){var c=this.getPlane(h),d=c.normal;if(d.x>=0?(e.x=r.x,i.x=a.x):(e.x=a.x,i.x=r.x),d.y>=0?(e.y=r.y,i.y=a.y):(e.y=a.y,i.y=r.y),d.z>=0?(e.z=r.z,i.z=a.z):(e.z=a.z,i.z=r.z),o.a.intersectsPlaneAndPoint(c,e)===n.a.PlaneIntersectionType_Back)return l.a.Disjoint;o.a.intersectsPlaneAndPoint(c,i)===n.a.PlaneIntersectionType_Back&&(s=l.a.Intersects)}return s}containsBoundSphere(t){for(var e=n.a.PlaneIntersectionType_Front,i=n.a.PlaneIntersectionType_Front,a=0;a<6;a++){switch(a){case 0:i=o.a.intersectsPlaneAndSphere(this._near,t);break;case 1:i=o.a.intersectsPlaneAndSphere(this._far,t);break;case 2:i=o.a.intersectsPlaneAndSphere(this._left,t);break;case 3:i=o.a.intersectsPlaneAndSphere(this._right,t);break;case 4:i=o.a.intersectsPlaneAndSphere(this._top,t);break;case 5:i=o.a.intersectsPlaneAndSphere(this._bottom,t)}switch(i){case n.a.PlaneIntersectionType_Back:return l.a.Disjoint;case n.a.PlaneIntersectionType_Intersecting:e=n.a.PlaneIntersectionType_Intersecting}}switch(e){case n.a.PlaneIntersectionType_Intersecting:return l.a.Intersects;default:return l.a.Contains}}}e.a=_,r()(_,"_tempV30",new s.a),r()(_,"_tempV31",new s.a),r()(_,"_tempV32",new s.a),r()(_,"_tempV33",new s.a),r()(_,"_tempV34",new s.a),r()(_,"_tempV35",new s.a),r()(_,"_tempV36",new s.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1),n=i(99),o=i(272),l=i(49),h=i(176);class _{constructor(){}static distancePlaneToPoint(t,e){return s.a.dot(t.normal,e)-t.distance}static distanceBoxToPoint(t,e){var i=t.min,a=i.x,r=i.y,s=i.z,n=t.max,o=n.x,l=n.y,h=n.z,_=e.x,c=e.y,d=e.z,u=0;return _<a&&(u+=(a-_)*(a-_)),_>o&&(u+=(o-_)*(o-_)),c<r&&(u+=(r-c)*(r-c)),c>l&&(u+=(l-c)*(l-c)),d<s&&(u+=(s-d)*(s-d)),d>h&&(u+=(h-d)*(h-d)),Math.sqrt(u)}static distanceBoxToBox(t,e){var i,a=t.min,r=a.x,s=a.y,n=a.z,o=t.max,l=o.x,h=o.y,_=o.z,c=e.min,d=c.x,u=c.y,f=c.z,m=e.max,p=m.x,g=m.y,v=m.z,T=0;return r>p?T+=(i=r-p)*i:d>l&&(T+=(i=d-l)*i),s>g?T+=(i=s-g)*i:u>h&&(T+=(i=u-h)*i),n>v?T+=(i=n-v)*i:f>_&&(T+=(i=f-_)*i),Math.sqrt(T)}static distanceSphereToPoint(t,e){var i=Math.sqrt(s.a.distanceSquared(t.center,e));return i-=t.radius,Math.max(i,0)}static distanceSphereToSphere(t,e){var i=Math.sqrt(s.a.distanceSquared(t.center,e.center));return i-=t.radius+e.radius,Math.max(i,0)}static intersectsRayAndTriangleRD(t,e,i,a,r){var s=t.origin,n=s.x,o=s.y,h=s.z,c=t.direction,d=c.x,u=c.y,f=c.z,m=e.x,p=e.y,g=e.z,v=i.x,T=i.y,E=i.z,S=a.x,R=a.y,x=a.z,A=_._tempV30.x,y=_._tempV30.y,I=_._tempV30.z;A=v-m,y=T-p,I=E-g;var C=_._tempV31.x,M=_._tempV31.y,D=_._tempV31.z;C=S-m,M=R-p,D=x-g;var b=_._tempV32.x,L=_._tempV32.y,O=_._tempV32.z,P=A*(b=u*D-f*M)+y*(L=f*C-d*D)+I*(O=d*M-u*C);if(l.a.isZero(P))return 0,!1;var N=1/P,w=_._tempV33.x,B=_._tempV33.y,F=_._tempV33.z,V=(w=n-m)*b+(B=o-p)*L+(F=h-g)*O;if((V*=N)<0||V>1)return 0,!1;var U=_._tempV34.x,G=_._tempV34.y,H=_._tempV34.z,z=d*(U=B*I-F*y)+u*(G=F*A-w*I)+f*(H=w*y-B*A);if((z*=N)<0||V+z>1)return 0,!1;var k=C*U+M*G+D*H;return(k*=N)<0?(0,!1):(k,!0)}static intersectsRayAndTriangleRP(t,e,i,a,r){return _.intersectsRayAndTriangleRD(t,e,i,a,void 0)?(s.a.scale(t.direction,void 0,_._tempV30),s.a.add(t.origin,_._tempV30,r),!0):(r=s.a._ZERO,!1)}static intersectsRayAndPoint(t,e){s.a.subtract(t.origin,e,_._tempV30);var i=s.a.dot(_._tempV30,t.direction),a=s.a.dot(_._tempV30,_._tempV30)-l.a.zeroTolerance;return!(a>0&&i>0)&&!(i*i-a<0)}static intersectsRayAndRay(t,e,i){var a=t.origin,r=a.x,n=a.y,o=a.z,h=t.direction,c=h.x,d=h.y,u=h.z,f=e.origin,m=f.x,p=f.y,g=f.z,v=e.direction,T=v.x,E=v.y,S=v.z;s.a.cross(h,v,_._tempV30);var R=_._tempV30,x=s.a.scalarLength(_._tempV30);if(l.a.isZero(x)&&l.a.nearEqual(m,r)&&l.a.nearEqual(p,n)&&l.a.nearEqual(g,o))return s.a._ZERO,!0;x*=x;var A=m-r,y=p-n,I=g-o,C=T,M=E,D=S,b=R.x,L=R.y,O=R.z,P=(A*M*O+y*D*b+I*C*L-A*D*L-y*C*O-I*M*b)/x;M=d,D=u,C=c;s.a.scale(h,P,_._tempV30),s.a.scale(v,P,_._tempV31),s.a.add(a,_._tempV30,_._tempV32),s.a.add(f,_._tempV31,_._tempV33);var N=_._tempV32,w=_._tempV33;return l.a.nearEqual(w.x,N.x)&&l.a.nearEqual(w.y,N.y)&&l.a.nearEqual(w.z,N.z)?(_._tempV32,!0):(s.a._ZERO,!1)}static intersectsPlaneAndTriangle(t,e,i,a){var r=_.intersectsPlaneAndPoint(t,e),s=_.intersectsPlaneAndPoint(t,i),o=_.intersectsPlaneAndPoint(t,a);return r==n.a.PlaneIntersectionType_Front&&s==n.a.PlaneIntersectionType_Front&&o==n.a.PlaneIntersectionType_Front?n.a.PlaneIntersectionType_Front:r==n.a.PlaneIntersectionType_Back&&s==n.a.PlaneIntersectionType_Back&&o==n.a.PlaneIntersectionType_Back?n.a.PlaneIntersectionType_Back:n.a.PlaneIntersectionType_Intersecting}static intersectsRayAndPlaneRD(t,e){var i=e.normal,a=s.a.dot(i,t.direction);if(Math.abs(a)<l.a.zeroTolerance)return-1;var r=s.a.dot(i,t.origin),n=(-e.distance-r)/a;if(n<0){if(n<-l.a.zeroTolerance)return-1;n=0}return n}static intersectsRayAndPlaneRP(t,e,i){var a=_.intersectsRayAndPlaneRD(t,e);if(-1==a)return i.setValue(0,0,0),!1;var r=_._tempV30;return s.a.scale(t.direction,a,r),s.a.add(t.origin,r,i),!0}static intersectsRayAndBoxRD(t,e){var i=t.origin,a=i.x,r=i.y,s=i.z,n=t.direction,o=n.x,h=n.y,_=n.z,c=e.min,d=c.x,u=c.y,f=c.z,m=e.max,p=m.x,g=m.y,v=m.z,T=0,E=l.a.MaxValue;if(l.a.isZero(o)){if(a<d||a>p)return-1}else{var S=1/o,R=(d-a)*S,x=(p-a)*S;if(R>x){var A=R;R=x,x=A}if((T=Math.max(R,T))>(E=Math.min(x,E)))return-1}if(l.a.isZero(h)){if(r<u||r>g)return-1}else{var y=1/h,I=(u-r)*y,C=(g-r)*y;if(I>C){var M=I;I=C,C=M}if((T=Math.max(I,T))>(E=Math.min(C,E)))return-1}if(l.a.isZero(_)){if(s<f||s>v)return-1}else{var D=1/_,b=(f-s)*D,L=(v-s)*D;if(b>L){var O=b;b=L,L=O}if((T=Math.max(b,T))>(E=Math.min(L,E)))return-1}return T}static intersectsRayAndBoxRP(t,e,i){var a=_.intersectsRayAndBoxRD(t,e);return-1===a?(s.a._ZERO.cloneTo(i),a):(s.a.scale(t.direction,a,_._tempV30),s.a.add(t.origin,_._tempV30,_._tempV31),_._tempV31.cloneTo(i),a)}static intersectsRayAndSphereRD(t,e){var i=e.radius;s.a.subtract(t.origin,e.center,_._tempV30);var a=s.a.dot(_._tempV30,t.direction),r=s.a.dot(_._tempV30,_._tempV30)-i*i;if(r>0&&a>0)return-1;var n=a*a-r;if(n<0)return-1;var o=-a-Math.sqrt(n);return o<0&&(o=0),o}static intersectsRayAndSphereRP(t,e,i){var a=_.intersectsRayAndSphereRD(t,e);return-1===a?(s.a._ZERO.cloneTo(i),a):(s.a.scale(t.direction,a,_._tempV30),s.a.add(t.origin,_._tempV30,_._tempV31),_._tempV31.cloneTo(i),a)}static intersectsSphereAndTriangle(t,e,i,a){var r=t.center,n=t.radius;return _.closestPointPointTriangle(r,e,i,a,_._tempV30),s.a.subtract(_._tempV30,r,_._tempV31),s.a.dot(_._tempV31,_._tempV31)<=n*n}static intersectsPlaneAndPoint(t,e){var i=s.a.dot(t.normal,e)+t.distance;return i>0?n.a.PlaneIntersectionType_Front:i<0?n.a.PlaneIntersectionType_Back:n.a.PlaneIntersectionType_Intersecting}static intersectsPlaneAndPlane(t,e){s.a.cross(t.normal,e.normal,_._tempV30);var i=s.a.dot(_._tempV30,_._tempV30);return!l.a.isZero(i)}static intersectsPlaneAndPlaneRL(t,e,i){var a=t.normal,r=e.normal;s.a.cross(a,r,_._tempV34);var n=s.a.dot(_._tempV34,_._tempV34);return!l.a.isZero(n)&&(s.a.scale(r,t.distance,_._tempV30),s.a.scale(a,e.distance,_._tempV31),s.a.subtract(_._tempV30,_._tempV31,_._tempV32),s.a.cross(_._tempV32,_._tempV34,_._tempV33),s.a.normalize(_._tempV34,_._tempV34),new o.a(_._tempV33,_._tempV34),!0)}static intersectsPlaneAndBox(t,e){var i=t.distance,a=t.normal,r=a.x,o=a.y,l=a.z,h=e.min,c=h.x,d=h.y,u=h.z,f=e.max,m=f.x,p=f.y,g=f.z;_._tempV30.x=r>0?c:m,_._tempV30.y=o>0?d:p,_._tempV30.z=l>0?u:g,_._tempV31.x=r>0?m:c,_._tempV31.y=o>0?p:d,_._tempV31.z=l>0?g:u;var v=s.a.dot(a,_._tempV30);return v+i>0?n.a.PlaneIntersectionType_Front:(v=s.a.dot(a,_._tempV31))+i<0?n.a.PlaneIntersectionType_Back:n.a.PlaneIntersectionType_Intersecting}static intersectsPlaneAndSphere(t,e){var i=e.radius,a=s.a.dot(t.normal,e.center)+t.distance;return a>i?n.a.PlaneIntersectionType_Front:a<-i?n.a.PlaneIntersectionType_Back:n.a.PlaneIntersectionType_Intersecting}static intersectsBoxAndBox(t,e){var i=t.min,a=t.max,r=e.min,s=e.max;return!(i.x>s.x||r.x>a.x)&&(!(i.y>s.y||r.y>a.y)&&!(i.z>s.z||r.z>a.z))}static intersectsBoxAndSphere(t,e){var i=e.center,a=e.radius,r=_._tempV30;return s.a.Clamp(i,t.min,t.max,r),s.a.distanceSquared(i,r)<=a*a}static intersectsSphereAndSphere(t,e){var i=t.radius+e.radius;return s.a.distanceSquared(t.center,e.center)<=i*i}static boxContainsPoint(t,e){var i=t.min,a=t.max;return i.x<=e.x&&a.x>=e.x&&i.y<=e.y&&a.y>=e.y&&i.z<=e.z&&a.z>=e.z?h.a.Contains:h.a.Disjoint}static boxContainsBox(t,e){var i=t.min,a=i.x,r=i.y,s=i.z,n=t.max,o=n.x,l=n.y,_=n.z,c=e.min,d=c.x,u=c.y,f=c.z,m=e.max,p=m.x,g=m.y,v=m.z;return o<d||a>p?h.a.Disjoint:l<u||r>g?h.a.Disjoint:_<f||s>v?h.a.Disjoint:a<=d&&p<=o&&r<=u&&g<=l&&s<=f&&v<=_?h.a.Contains:h.a.Intersects}static boxContainsSphere(t,e){var i=t.min,a=i.x,r=i.y,n=i.z,o=t.max,l=o.x,c=o.y,d=o.z,u=e.center,f=u.x,m=u.y,p=u.z,g=e.radius;return s.a.Clamp(u,i,o,_._tempV30),s.a.distanceSquared(u,_._tempV30)>g*g?h.a.Disjoint:a+g<=f&&f<=l-g&&l-a>g&&r+g<=m&&m<=c-g&&c-r>g&&n+g<=p&&p<=d-g&&d-n>g?h.a.Contains:h.a.Intersects}static sphereContainsPoint(t,e){return s.a.distanceSquared(e,t.center)<=t.radius*t.radius?h.a.Contains:h.a.Disjoint}static sphereContainsTriangle(t,e,i,a){var r=_.sphereContainsPoint(t,e),s=_.sphereContainsPoint(t,i),n=_.sphereContainsPoint(t,a);return r==h.a.Contains&&s==h.a.Contains&&n==h.a.Contains?h.a.Contains:_.intersectsSphereAndTriangle(t,e,i,a)?h.a.Intersects:h.a.Disjoint}static sphereContainsBox(t,e){var i=t.center,a=i.x,r=i.y,n=i.z,o=t.radius,l=e.min,c=l.x,d=l.y,u=l.z,f=e.max,m=f.x,p=f.y,g=f.z,v=_._tempV30;v.x,v.y,v.z;if(!_.intersectsBoxAndSphere(e,t))return h.a.Disjoint;var T=o*o;return a-c,r-p,n-g,s.a.scalarLengthSquared(_._tempV30)>T?h.a.Intersects:(a-m,r-p,n-g,s.a.scalarLengthSquared(_._tempV30)>T?h.a.Intersects:(a-m,r-d,n-g,s.a.scalarLengthSquared(_._tempV30)>T?h.a.Intersects:(a-c,r-d,n-g,s.a.scalarLengthSquared(_._tempV30)>T?h.a.Intersects:(a-c,r-p,n-u,s.a.scalarLengthSquared(_._tempV30)>T?h.a.Intersects:(a-m,r-p,n-u,s.a.scalarLengthSquared(_._tempV30)>T?h.a.Intersects:(a-m,r-d,n-u,s.a.scalarLengthSquared(_._tempV30)>T?h.a.Intersects:(a-c,r-d,n-u,s.a.scalarLengthSquared(_._tempV30)>T?h.a.Intersects:h.a.Contains)))))))}static sphereContainsSphere(t,e){var i=t.radius,a=e.radius,r=s.a.distance(t.center,e.center);return i+a<r?h.a.Disjoint:i-a<r?h.a.Intersects:h.a.Contains}static closestPointPointTriangle(t,e,i,a,r){s.a.subtract(i,e,_._tempV30),s.a.subtract(a,e,_._tempV31),s.a.subtract(t,e,_._tempV32),s.a.subtract(t,i,_._tempV33),s.a.subtract(t,a,_._tempV34);var n=s.a.dot(_._tempV30,_._tempV32),o=s.a.dot(_._tempV31,_._tempV32),l=s.a.dot(_._tempV30,_._tempV33),h=s.a.dot(_._tempV31,_._tempV33),c=s.a.dot(_._tempV30,_._tempV34),d=s.a.dot(_._tempV31,_._tempV34);if(n<=0&&o<=0)e.cloneTo(r);else if(l>=0&&h<=l)i.cloneTo(r);else{var u=n*h-l*o;if(u<=0&&n>=0&&l<=0){var f=n/(n-l);return s.a.scale(_._tempV30,f,r),void s.a.add(e,r,r)}if(d>=0&&c<=d)a.cloneTo(r);else{var m=c*o-n*d;if(m<=0&&o>=0&&d<=0){var p=o/(o-d);return s.a.scale(_._tempV31,p,r),void s.a.add(e,r,r)}var g=l*d-c*h;if(g<=0&&h-l>=0&&c-d>=0){var v=(h-l)/(h-l+(c-d));return s.a.subtract(a,i,r),s.a.scale(r,v,r),void s.a.add(i,r,r)}var T=1/(g+m+u),E=m*T,S=u*T;s.a.scale(_._tempV30,E,_._tempV35),s.a.scale(_._tempV31,S,_._tempV36),s.a.add(_._tempV35,_._tempV36,r),s.a.add(e,r,r)}}}static closestPointPlanePoint(t,e,i){var a=t.normal,r=s.a.dot(a,e)-t.distance;s.a.scale(a,r,_._tempV30),s.a.subtract(e,_._tempV30,i)}static closestPointBoxPoint(t,e,i){s.a.max(e,t.min,_._tempV30),s.a.min(_._tempV30,t.max,i)}static closestPointSpherePoint(t,e,i){var a=t.center;s.a.subtract(e,a,i),s.a.normalize(i,i),s.a.scale(i,t.radius,i),s.a.add(i,a,i)}static closestPointSphereSphere(t,e,i){var a=t.center;s.a.subtract(e.center,a,i),s.a.normalize(i,i),s.a.scale(i,t.radius,i),s.a.add(i,a,i)}}e.a=_,r()(_,"_tempV30",new s.a),r()(_,"_tempV31",new s.a),r()(_,"_tempV32",new s.a),r()(_,"_tempV33",new s.a),r()(_,"_tempV34",new s.a),r()(_,"_tempV35",new s.a),r()(_,"_tempV36",new s.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{}e.a=s,r()(s,"Disjoint",0),r()(s,"Contains",1),r()(s,"Intersects",2)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(8),o=i(38),l=i(57),h=i(14),_=i(25),c=i(275),d=i(39);class u extends c.a{static __init__(){u.instance=new u}constructor(){super();var t=s.a.instance,e=new Float32Array([-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1]),i=new Uint8Array([0,1,2,2,3,0,4,7,6,6,5,4,0,3,7,7,4,0,1,5,6,6,2,1,3,2,6,6,7,3,0,4,5,5,1,0]),a=h.a.getVertexDeclaration("POSITION");this._vertexBuffer=new _.a(8*a.vertexStride,t.STATIC_DRAW,!1),this._vertexBuffer.vertexDeclaration=a,this._indexBuffer=new l.a(d.a.UInt8,36,t.STATIC_DRAW,!1),this._vertexBuffer.setData(e.buffer),this._indexBuffer.setData(i);var r=new o.a;r.bind(),r.applyVertexBuffer(this._vertexBuffer),r.applyIndexBuffer(this._indexBuffer),r.unBind(),this._bufferState=r}_render(t){var e=s.a.instance;e.drawElements(e.TRIANGLES,36,e.UNSIGNED_BYTE,0),n.a.trianglesFaces+=12,n.a.renderBatches++}}e.a=u,r()(u,"instance",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{}e.a=s,r()(s,"SHADERDEFINE_FOG",void 0),r()(s,"SHADERDEFINE_DIRECTIONLIGHT",void 0),r()(s,"SHADERDEFINE_POINTLIGHT",void 0),r()(s,"SHADERDEFINE_SPOTLIGHT",void 0),r()(s,"SHADERDEFINE_SHADOW",void 0),r()(s,"SHADERDEFINE_SHADOW_CASCADE",void 0),r()(s,"SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW",void 0),r()(s,"SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH",void 0),r()(s,"SHADERDEFINE_SHADOW_SPOT",void 0),r()(s,"SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW",void 0),r()(s,"SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH",void 0),r()(s,"SHADERDEFINE_GI_AMBIENT_SH",void 0)},function(t,e,i){"use strict";var a,r=i(0),s=i.n(r),n=i(2),o=i(79),l=i(47),h=i(80),_=i(174),c=i(49),d=i(9),u=i(99),f=i(1),m=i(86),p=i(13),g=i(100),v=i(180),T=i(128),E=i(81);!function(t){t[t.Near=0]="Near",t[t.Far=1]="Far",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.Bottom=4]="Bottom",t[t.Top=5]="Top"}(a||(a={}));class S{static supportShadow(){return n.a.layaGPUInstance._isWebGL2||E.a.supportRenderTextureFormat(l.b.Depth)}static init(){n.a.layaGPUInstance._isWebGL2?S._shadowTextureFormat=l.b.ShadowMap:S._shadowTextureFormat=l.b.Depth}static getTemporaryShadowTexture(t,e,i){var a=m.a.createFromPool(t,e,S._shadowTextureFormat,i);return a.filterMode=o.a.Bilinear,a.wrapModeU=h.a.Clamp,a.wrapModeV=h.a.Clamp,a}static getShadowBias(t,e,i,a){var r;t._lightType==g.b.Directional?r=2/e.elements[0]:t._lightType==g.b.Spot?r=Math.tan(.5*t.spotAngle*c.a.Deg2Rad)*t.range:(console.warn("ShadowUtils:Only spot and directional shadow casters are supported now."),r=0);var s=r/i,n=-t._shadowDepthBias*s,o=-t._shadowNormalBias*s;if(t.shadowMode==T.a.SoftHigh){const t=2.5;n*=t,o*=t}a.setValue(n,o,0,0)}static getCameraFrustumPlanes(t,e){_.a.getPlanesFromMatrix(t,e[a.Near],e[a.Far],e[a.Left],e[a.Right],e[a.Top],e[a.Bottom])}static getFarWithRadius(t,e){return Math.sqrt(t*t/e)}static getCascadesSplitDistance(t,e,i,a,r,s,n,o){o[0]=i;var l=a-i,h=Math.tan(.5*r),_=1+h*h*(s*s+1);switch(n){case v.a.NoCascades:o[1]=S.getFarWithRadius(a,_);break;case v.a.TwoCascades:o[1]=S.getFarWithRadius(i+l*t,_),o[2]=S.getFarWithRadius(a,_);break;case v.a.FourCascades:o[1]=S.getFarWithRadius(i+l*e.x,_),o[2]=S.getFarWithRadius(i+l*e.y,_),o[3]=S.getFarWithRadius(i+l*e.z,_),o[4]=S.getFarWithRadius(a,_)}}static applySliceTransform(t,e,i,a,r){var s=S._tempMatrix0.elements,n=1/e,o=1/i;s[0]=t.resolution*n,s[5]=t.resolution*o,s[12]=t.offsetX*n,s[13]=t.offsetY*o,s[1]=s[2]=s[2]=s[4]=s[6]=s[7]=s[8]=s[9]=s[11]=s[14]=0,s[10]=s[15]=1;var l=16*a;p.a._mulMatrixArray(s,r,l,r,l)}static getDirectionLightShadowCullPlanes(t,e,i,r,s,n){var o=S._frustumCorners,l=S._backPlaneFaces,h=S._frustumPlaneNeighbors,c=S._frustumTwoPlaneCorners,d=S._edgePlanePoint2,m=n.cullPlanes,p=t[a.Near],g=t[a.Far],v=t[a.Left],T=t[a.Right],E=t[a.Bottom],R=t[a.Top],x=i[e]-r,A=S._adjustNearPlane,y=S._adjustFarPlane;p.normal.cloneTo(A.normal),g.normal.cloneTo(y.normal),A.distance=p.distance-x,y.distance=Math.min(-p.distance+n.sphereCenterZ+n.splitBoundSphere.radius,g.distance),_.a.get3PlaneInterPoint(A,E,T,o[_.b.nearBottomRight]),_.a.get3PlaneInterPoint(A,R,T,o[_.b.nearTopRight]),_.a.get3PlaneInterPoint(A,R,v,o[_.b.nearTopLeft]),_.a.get3PlaneInterPoint(A,E,v,o[_.b.nearBottomLeft]),_.a.get3PlaneInterPoint(y,E,T,o[_.b.FarBottomRight]),_.a.get3PlaneInterPoint(y,R,T,o[_.b.FarTopRight]),_.a.get3PlaneInterPoint(y,R,v,o[_.b.FarTopLeft]),_.a.get3PlaneInterPoint(y,E,v,o[_.b.FarBottomLeft]);for(var I=0,C=0;C<6;C++){var M;switch(C){case a.Near:M=A;break;case a.Far:M=y;break;default:M=t[C]}f.a.dot(M.normal,s)<0&&(M.cloneTo(m[I]),l[I]=C,I++)}var D=I;for(C=0;C<I;C++)for(var b=l[C],L=h[b],O=0;O<4;O++){for(var P=L[O],N=!0,w=0;w<I;w++)if(P==l[w]){N=!1;break}if(N){var B=c[b][P],F=o[B[0]],V=o[B[1]];f.a.add(F,s,d),u.a.createPlaneBy3P(F,V,d,m[D++])}}n.cullPlaneCount=D}static getBoundSphereByFrustum(t,e,i,a,r,s,n){var o,l,h=Math.sqrt(1+a*a)*Math.tan(i/2),_=h*h,c=e-t,d=e+t;_>c/d?(o=e,l=e*h):(o=.5*d*(1+_),l=.5*Math.sqrt(c*c+2*(e*e+t*t)*_+d*d*_*_));var u=n.center;return n.radius=l,f.a.scale(s,o,u),f.a.add(r,u,u),o}static getMaxTileResolutionInAtlas(t,e,i){for(var a=Math.min(t,e),r=Math.floor(t/a)*Math.floor(e/a);r<i;)a=Math.floor(a>>1),r=Math.floor(t/a)*Math.floor(e/a);return a}static getDirectionalLightMatrices(t,e,i,a,r,s,n,o){var l=n.splitBoundSphere,h=l.center,_=l.radius,c=s/2,u=_*c/(c-S.atlasBorderSize),m=2*u,g=s/m,v=m/s,T=Math.ceil(f.a.dot(h,t)*g)*v,E=Math.ceil(f.a.dot(h,e)*g)*v,R=f.a.dot(h,i);h.x=t.x*T+e.x*E+i.x*R,h.y=t.y*T+e.y*E+i.y*R,h.z=t.z*T+e.z*E+i.z*R;var x=n.position,A=n.viewMatrix,y=n.projectionMatrix,I=n.viewProjectMatrix;n.resolution=s,n.offsetX=a%2*s,n.offsetY=Math.floor(a/2)*s,f.a.scale(i,_+r,x),f.a.subtract(h,x,x),d.a.createLookAt(x,h,t,A),d.a.createOrthoOffCenter(-u,u,-u,u,0,2*_+r,y),d.a.multiply(y,A,I),p.a._mulMatrixArray(S._shadowMapScaleOffsetMatrix.elements,I.elements,0,o,16*a)}static getSpotLightShadowData(t,e,i,a,r,s){var n=t.position=e.transform.position;t.resolution=i,s.setValue(1/i,1/i,i,i),t.offsetX=0,t.offsetY=0;var o=e.lightWorldMatrix,l=t.viewMatrix,h=t.projectionMatrix,_=t.viewProjectMatrix,c=t.cameraCullInfo.boundFrustum;o.invert(l),d.a.createPerspective(3.1416*e.spotAngle/180,1,.1,e.range,h),a.y=e.shadowStrength,d.a.multiply(h,l,_),c.matrix=_,_.cloneTo(r),t.cameraCullInfo.position=n}static prepareShadowReceiverShaderValues(t,e,i,a,r,s,n,o,l){if(s.setValue(1/e,1/i,e,i),n.setValue(t._shadowStrength,0,0,0),r>1){const t=16;for(var h=r*t,_=4*t;h<_;h++)o[h]=0;for(h=0;h<r;h++){var c=a[h].splitBoundSphere,d=c.center,u=c.radius,f=4*h;l[f]=d.x,l[f+1]=d.y,l[f+2]=d.z,l[f+3]=u*u}const e=4;for(h=r*e,_=4*e;h<_;h++)l[h]=0}}}e.a=S,s()(S,"_tempMatrix0",new d.a),s()(S,"_shadowMapScaleOffsetMatrix",new d.a(.5,0,0,0,0,.5,0,0,0,0,1,0,.5,.5,0,1)),s()(S,"_shadowTextureFormat",void 0),s()(S,"_frustumCorners",[new f.a,new f.a,new f.a,new f.a,new f.a,new f.a,new f.a,new f.a]),s()(S,"_adjustNearPlane",new u.a(new f.a)),s()(S,"_adjustFarPlane",new u.a(new f.a)),s()(S,"_backPlaneFaces",new Array(5)),s()(S,"_edgePlanePoint2",new f.a),s()(S,"_frustumPlaneNeighbors",[[a.Left,a.Right,a.Top,a.Bottom],[a.Left,a.Right,a.Top,a.Bottom],[a.Near,a.Far,a.Top,a.Bottom],[a.Near,a.Far,a.Top,a.Bottom],[a.Near,a.Far,a.Left,a.Right],[a.Near,a.Far,a.Left,a.Right]]),s()(S,"_frustumTwoPlaneCorners",[[[_.b.unknown,_.b.unknown],[_.b.unknown,_.b.unknown],[_.b.nearBottomLeft,_.b.nearTopLeft],[_.b.nearTopRight,_.b.nearBottomRight],[_.b.nearBottomRight,_.b.nearBottomLeft],[_.b.nearTopLeft,_.b.nearTopRight]],[[_.b.unknown,_.b.unknown],[_.b.unknown,_.b.unknown],[_.b.FarTopLeft,_.b.FarBottomLeft],[_.b.FarBottomRight,_.b.FarTopRight],[_.b.FarBottomLeft,_.b.FarBottomRight],[_.b.FarTopRight,_.b.FarTopLeft]],[[_.b.nearTopLeft,_.b.nearBottomLeft],[_.b.FarBottomLeft,_.b.FarTopLeft],[_.b.unknown,_.b.unknown],[_.b.unknown,_.b.unknown],[_.b.nearBottomLeft,_.b.FarBottomLeft],[_.b.FarTopLeft,_.b.nearTopLeft]],[[_.b.nearBottomRight,_.b.nearTopRight],[_.b.FarTopRight,_.b.FarBottomRight],[_.b.unknown,_.b.unknown],[_.b.unknown,_.b.unknown],[_.b.FarBottomRight,_.b.nearBottomRight],[_.b.nearTopRight,_.b.FarTopRight]],[[_.b.nearBottomLeft,_.b.nearBottomRight],[_.b.FarBottomRight,_.b.FarBottomLeft],[_.b.FarBottomLeft,_.b.nearBottomLeft],[_.b.nearBottomRight,_.b.FarBottomRight],[_.b.unknown,_.b.unknown],[_.b.unknown,_.b.unknown]],[[_.b.nearTopRight,_.b.nearTopLeft],[_.b.FarTopLeft,_.b.FarTopRight],[_.b.nearTopLeft,_.b.FarTopLeft],[_.b.FarTopRight,_.b.nearTopRight],[_.b.unknown,_.b.unknown],[_.b.unknown,_.b.unknown]]]),s()(S,"atlasBorderSize",4)},function(t,e,i){"use strict";let a;i.d(e,"a",function(){return a}),function(t){t[t.NoCascades=0]="NoCascades",t[t.TwoCascades=1]="TwoCascades",t[t.FourCascades=2]="FourCascades"}(a||(a={}))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(72),n=i(3),o=i(70),l=i(2),h=i(12),_=i(27),c=i(37),d=i(82),u=i(47),f=i(182),m=i(61),p=i(93),g=i(10),v=i(172),T=i(279),E=i(131),S=i(271),R=i(449),x=i(450),A=i(1),y=i(5),I=i(50),C=i(62),M=i(280),D=i(170),b=i(177),L=i(281),O=i(274),P=i(132),N=i(7),w=i(32),B=i(13),F=i(87),V=i(453),U=i(22),G=i(129),H=i(169),z=i(40),k=i(183),W=i(454),X=i(458),Y=i(459),j=i(462),Z=i(178),q=i(285),Q=i(54),K=i(136),J=i(184),$=i(255),tt=i(262),et=i(124),it=i(464),at=i(465),rt=i(173);let st;!function(t){t[t.SolidColor=0]="SolidColor",t[t.SphericalHarmonics=1]="SphericalHarmonics"}(st||(st={}));class nt extends o.a{static __init__(){var t=s.a._config;if(t._multiLighting){const a=4;var e=t.maxLightCount,i=t.lightClusterCount;S.a.instance=new S.a(i.x,i.y,i.z,Math.min(t.maxLightCount,t._maxAreaLightCountPerClusterAverage)),nt._lightTexture=B.a._createFloatTextureBuffer(a,e),nt._lightTexture.lock=!0,nt._lightPixles=new Float32Array(e*a*4)}Z.a.SHADERDEFINE_FOG=N.a.getDefineByName("FOG"),Z.a.SHADERDEFINE_DIRECTIONLIGHT=N.a.getDefineByName("DIRECTIONLIGHT"),Z.a.SHADERDEFINE_POINTLIGHT=N.a.getDefineByName("POINTLIGHT"),Z.a.SHADERDEFINE_SPOTLIGHT=N.a.getDefineByName("SPOTLIGHT"),Z.a.SHADERDEFINE_SHADOW=N.a.getDefineByName("SHADOW"),Z.a.SHADERDEFINE_SHADOW_CASCADE=N.a.getDefineByName("SHADOW_CASCADE"),Z.a.SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW=N.a.getDefineByName("SHADOW_SOFT_SHADOW_LOW"),Z.a.SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH=N.a.getDefineByName("SHADOW_SOFT_SHADOW_HIGH"),Z.a.SHADERDEFINE_GI_AMBIENT_SH=N.a.getDefineByName("GI_AMBIENT_SH"),Z.a.SHADERDEFINE_SHADOW_SPOT=N.a.getDefineByName("SHADOW_SPOT"),Z.a.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW=N.a.getDefineByName("SHADOW_SPOT_SOFT_SHADOW_LOW"),Z.a.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH=N.a.getDefineByName("SHADOW_SPOT_SOFT_SHADOW_HIGH");var a=s.a._config,r=nt._configDefineValues;switch(a._multiLighting||r.add(N.a.SHADERDEFINE_LEGACYSINGALLIGHTING),l.a.layaGPUInstance._isWebGL2?r.add(N.a.SHADERDEFINE_GRAPHICS_API_GLES3):r.add(N.a.SHADERDEFINE_GRAPHICS_API_GLES2),a.pbrRenderQuality){case H.a.High:r.add(G.a.SHADERDEFINE_LAYA_PBR_BRDF_HIGH);break;case H.a.Low:r.add(G.a.SHADERDEFINE_LAYA_PBR_BRDF_LOW);break;default:throw"Scene3D:unknown shader quality."}a.isUseCannonPhysicsEngine?nt.cannonPhysicsSettings=new tt.a:nt.physicsSettings=new M.a}static load(t,e){n.a.loader.create(t,e,null,nt.HIERARCHY)}get url(){return this._url}get enableFog(){return this._enableFog}set enableFog(t){this._enableFog!==t&&(this._enableFog=t,t?this._shaderValues.addDefine(Z.a.SHADERDEFINE_FOG):this._shaderValues.removeDefine(Z.a.SHADERDEFINE_FOG))}get fogColor(){return this._shaderValues.getVector3(nt.FOGCOLOR)}set fogColor(t){this._shaderValues.setVector3(nt.FOGCOLOR,t)}get fogStart(){return this._shaderValues.getNumber(nt.FOGSTART)}set fogStart(t){this._shaderValues.setNumber(nt.FOGSTART,t)}get fogRange(){return this._shaderValues.getNumber(nt.FOGRANGE)}set fogRange(t){this._shaderValues.setNumber(nt.FOGRANGE,t)}get ambientMode(){return this._ambientMode}set ambientMode(t){if(this._ambientMode!==t){switch(t){case st.SolidColor:this._shaderValues.removeDefine(Z.a.SHADERDEFINE_GI_AMBIENT_SH);break;case st.SphericalHarmonics:this._shaderValues.addDefine(Z.a.SHADERDEFINE_GI_AMBIENT_SH);break;default:throw"Scene3D: unknown ambientMode."}this._ambientMode=t}}get ambientColor(){return this._shaderValues.getVector3(nt.AMBIENTCOLOR)}set ambientColor(t){this._shaderValues.setVector3(nt.AMBIENTCOLOR,t)}get ambientSphericalHarmonics(){return this._ambientSphericalHarmonics}set ambientSphericalHarmonics(t){var e=t||R.a._default;this._applySHCoefficients(e,Math.pow(this._ambientSphericalHarmonicsIntensity,2.2)),this._ambientSphericalHarmonics!=t&&t.cloneTo(this._ambientSphericalHarmonics)}get ambientSphericalHarmonicsIntensity(){return this._ambientSphericalHarmonicsIntensity}set ambientSphericalHarmonicsIntensity(t){if(t=Math.max(Math.min(t,8),0),this._ambientSphericalHarmonicsIntensity!==t){var e=this._ambientSphericalHarmonics||R.a._default;this._applySHCoefficients(e,Math.pow(t,2.2)),this._ambientSphericalHarmonicsIntensity=t}}get reflection(){return this._reflection}set reflection(t){this._reflection!=t&&(t._addReference(),this._reflectionProbeManager.sceneReflectionProbe=t,this._reflection=t||P.a.blackTexture,this._reflectionProbeManager._needUpdateAllRender=!0)}get reflectionDecodingFormat(){return this._reflectionDecodeFormat}set reflectionDecodingFormat(t){this._reflectionDecodeFormat!=t&&(this._reflectionCubeHDRParams.x=this._reflectionIntensity,this._reflectionDecodeFormat==f.a.RGBM&&(this._reflectionCubeHDRParams.x*=5),this._reflectionDecodeFormat=t,this._reflectionProbeManager.sceneReflectionCubeHDRParam=this._reflectionCubeHDRParams)}get reflectionIntensity(){return this._reflectionIntensity}set reflectionIntensity(t){t=Math.max(Math.min(t,1),0),this._reflectionCubeHDRParams.x=t,this._reflectionDecodeFormat==f.a.RGBM&&(this._reflectionCubeHDRParams.x*=5),this._reflectionIntensity=t,this._reflectionProbeManager.sceneReflectionCubeHDRParam=this._reflectionCubeHDRParams}get skyRenderer(){return this._skyRenderer}get physicsSimulation(){return this._physicsSimulation}get cannonPhysicsSimulation(){return this._cannonPhysicsSimulation}get timer(){return this._timer}set timer(t){this._timer=t}get input(){return this._input}get lightmaps(){return this._lightmaps.slice()}set lightmaps(t){var e=this._lightmaps;if(e)for(var i=0,a=e.length;i<a;i++){(s=e[i]).lightmapColor._removeReference(),s.lightmapDirection._removeReference()}if(t){var r=t.length;for(e.length=r,i=0;i<r;i++){var s;(s=t[i]).lightmapColor&&s.lightmapColor._addReference(),s.lightmapDirection&&s.lightmapDirection._addReference(),e[i]=s}}else e.length=0}constructor(){super(),r()(this,"_url",void 0),r()(this,"_group",void 0),r()(this,"_lightCount",0),r()(this,"_pointLights",new V.b),r()(this,"_spotLights",new V.b),r()(this,"_directionLights",new V.b),r()(this,"_alternateLights",new V.a),r()(this,"_lightmaps",[]),r()(this,"_skyRenderer",new O.a),r()(this,"_enableFog",void 0),r()(this,"_input",new x.a),r()(this,"_timer",n.a.timer),r()(this,"_time",0),r()(this,"_shCoefficients",new Array(7)),r()(this,"_ambientMode",st.SolidColor),r()(this,"_ambientSphericalHarmonics",new R.a),r()(this,"_ambientSphericalHarmonicsIntensity",1),r()(this,"_reflection",void 0),r()(this,"_reflectionDecodeFormat",f.a.Normal),r()(this,"_reflectionIntensity",1),r()(this,"_mainDirectionLight",void 0),r()(this,"_mainSpotLight",void 0),r()(this,"_mainPointLight",void 0),r()(this,"_physicsSimulation",void 0),r()(this,"_cannonPhysicsSimulation",void 0),r()(this,"_octree",void 0),r()(this,"_collsionTestList",[]),r()(this,"_shaderValues",void 0),r()(this,"_renders",new T.a),r()(this,"_opaqueQueue",new X.a(!1)),r()(this,"_transparentQueue",new X.a(!0)),r()(this,"_cameraPool",[]),r()(this,"_animatorPool",new T.a),r()(this,"_scriptPool",new Array),r()(this,"_tempScriptPool",new Array),r()(this,"_needClearScriptPool",!1),r()(this,"_reflectionCubeHDRParams",new y.a),r()(this,"_reflectionProbeManager",new at.a),r()(this,"currentCreationLayer",Math.pow(2,0)),r()(this,"enableLight",!0),r()(this,"_debugTool",void 0),r()(this,"_key",new p.a),r()(this,"_cullingBufferIndices",void 0),r()(this,"_cullingBufferResult",void 0),r()(this,"_pickIdToSprite",new Object),r()(this,"_reflectionMode",0),!s.a._config.isUseCannonPhysicsEngine&&I.a._bullet?this._physicsSimulation=new D.a(nt.physicsSettings):I.a._cannon&&(this._cannonPhysicsSimulation=new $.a(nt.cannonPhysicsSettings)),this._shaderValues=new w.a(null),this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new A.a(.7,.7,.7),this.ambientColor=new A.a(.212,.227,.259),this.reflectionIntensity=1,this.reflection=P.a.blackTexture;for(var t=0;t<7;t++)this._shCoefficients[t]=new y.a;if(this._reflectionProbeManager.sceneReflectionCubeHDRParam=this._reflectionCubeHDRParams,this._scene=this,this._input.__init__(c.a.canvas,this),nt.octreeCulling&&(this._octree=new Y.a(nt.octreeInitialSize,nt.octreeInitialCenter,nt.octreeMinNodeSize,nt.octreeLooseness)),E.b.debugFrustumCulling){this._debugTool=new W.a;var e=new k.a;e.renderQueue=U.a.RENDERQUEUE_TRANSPARENT,e.alphaTest=!1,e.depthWrite=!1,e.cull=z.a.CULL_BACK,e.blend=z.a.BLEND_ENABLE_ALL,e.blendSrc=z.a.BLENDPARAM_SRC_ALPHA,e.blendDst=z.a.BLENDPARAM_ONE_MINUS_SRC_ALPHA,e.depthTest=z.a.DEPTHTEST_LESS,this._debugTool.pixelLineRenderer.sharedMaterial=e}}_applySHCoefficients(t,e){for(var i=this._shCoefficients,a=0;a<3;a++){var r=i[a],s=i[a+3];r.setValue(t.getCoefficient(a,3)*e,t.getCoefficient(a,1)*e,t.getCoefficient(a,2)*e,(t.getCoefficient(a,0)-t.getCoefficient(a,6))*e),s.setValue(t.getCoefficient(a,4)*e,t.getCoefficient(a,5)*e,3*t.getCoefficient(a,6)*e,t.getCoefficient(a,7)*e)}i[6].setValue(t.getCoefficient(0,8)*e,t.getCoefficient(1,8)*e,t.getCoefficient(2,8)*e,1);var n=this._shaderValues;n.setVector(nt.AMBIENTSHAR,i[0]),n.setVector(nt.AMBIENTSHAG,i[1]),n.setVector(nt.AMBIENTSHAB,i[2]),n.setVector(nt.AMBIENTSHBR,i[3]),n.setVector(nt.AMBIENTSHBG,i[4]),n.setVector(nt.AMBIENTSHBB,i[5]),n.setVector(nt.AMBIENTSHC,i[6])}_update(){var t=this.timer._delta/1e3;this._time+=t,this._shaderValues.setNumber(nt.TIME,this._time);var e=this._physicsSimulation;if(!I.a._enablePhysics||D.a.disableSimulation||s.a._config.isUseCannonPhysicsEngine||(e._updatePhysicsTransformFromRender(),C.a._addUpdateList=!1,e._simulate(t),e._updateCharacters(),C.a._addUpdateList=!0,e._updateCollisions(),e._eventScripts()),I.a._cannon&&s.a._config.isUseCannonPhysicsEngine){var i=this._cannonPhysicsSimulation;i._updatePhysicsTransformFromRender(),et.a._addUpdateList=!1,i._simulate(t),et.a._addUpdateList=!0,i._updateCollisions(),i._eventScripts()}this._input._update(),this._clearScript(),this._updateScript(),v.a._update(this),it.a._update(),this._reflectionProbeManager._needUpdateAllRender?this._reflectionProbeManager.updateAllRenderObjects(this._renders):this._reflectionProbeManager.update(),this._lateUpdateScript()}_binarySearchIndexInCameraPool(t){for(var e,i=0,a=this._cameraPool.length-1;i<=a;){e=Math.floor((i+a)/2);var r=this._cameraPool[e]._renderingOrder;if(r==t._renderingOrder)return e;r>t._renderingOrder?a=e-1:i=e+1}return i}_allotPickColorByID(t,e){var i=Math.floor(t/65025);t-=255*i*255;var a=Math.floor(t/255),r=t-=255*a;e.x=i/255,e.y=a/255,e.z=r/255,e.w=1}_searchIDByPickColor(t){return 255*t.x*255+255*t.y+t.z}onEnable(){this._input._onCanvasEvent(c.a.canvas)}onDisable(){this._input._offCanvasEvent(c.a.canvas)}_setCreateURL(t){this._url=_.a.formatURL(t)}_getGroup(){return this._group}_setGroup(t){this._group=t}_clearScript(){if(this._needClearScriptPool){for(var t=this._scriptPool,e=0,i=t.length;e<i;e++){var a=t[e];a&&(a._indexInPool=this._tempScriptPool.length,this._tempScriptPool.push(a))}this._scriptPool=this._tempScriptPool,t.length=0,this._tempScriptPool=t,this._needClearScriptPool=!1}}_updateScript(){for(var t=this._scriptPool,e=0,i=t.length;e<i;e++){var a=t[e];a&&a.enabled&&a.onUpdate()}}_lateUpdateScript(){for(var t=this._scriptPool,e=0,i=t.length;e<i;e++){var a=t[e];a&&a.enabled&&a.onLateUpdate()}}_onActive(){super._onActive(),n.a.stage._scene3Ds.push(this)}_onInActive(){super._onInActive();var t=n.a.stage._scene3Ds;t.splice(t.indexOf(this),1)}_prepareSceneToRender(){var t=this._shaderValues;if(s.a._config._multiLighting){var e=nt._lightTexture,i=nt._lightPixles;const s=e.width,x=4*s;var a=0,r=this._directionLights._length,n=this._directionLights._elements;if(r>0){var o=this._directionLights.getBrightestLight();this._mainDirectionLight=n[o],this._directionLights.normalLightOrdering(o);for(var l=0;l<r;l++,a++){var h=(E=n[l])._direction,_=E._intensityColor,c=x*a;A.a.scale(E.color,E._intensity,_),E.transform.worldMatrix.getForward(h),A.a.normalize(h,h),i[c]=_.x,i[c+1]=_.y,i[c+2]=_.z,i[c+4]=h.x,i[c+5]=h.y,i[c+6]=h.z,0==l&&(t.setVector3(nt.SUNLIGHTDIRCOLOR,_),t.setVector3(nt.SUNLIGHTDIRECTION,h))}t.addDefine(Z.a.SHADERDEFINE_DIRECTIONLIGHT)}else t.removeDefine(Z.a.SHADERDEFINE_DIRECTIONLIGHT);var d=this._pointLights._length;if(d>0){var u=this._pointLights._elements,f=this._pointLights.getBrightestLight();this._mainPointLight=u[f],this._pointLights.normalLightOrdering(f);for(l=0;l<d;l++,a++){var m=(R=u[l]).transform.position;_=R._intensityColor,c=x*a;A.a.scale(R.color,R._intensity,_),i[c]=_.x,i[c+1]=_.y,i[c+2]=_.z,i[c+3]=R.range,i[c+4]=m.x,i[c+5]=m.y,i[c+6]=m.z}t.addDefine(Z.a.SHADERDEFINE_POINTLIGHT)}else t.removeDefine(Z.a.SHADERDEFINE_POINTLIGHT);var p=this._spotLights._length;if(p>0){var g=this._spotLights._elements,v=this._spotLights.getBrightestLight();this._mainSpotLight=g[v],this._spotLights.normalLightOrdering(v);for(l=0;l<p;l++,a++){var T=g[l];h=T._direction,m=T.transform.position,_=T._intensityColor,c=x*a;A.a.scale(T.color,T._intensity,_),T.transform.worldMatrix.getForward(h),A.a.normalize(h,h),i[c]=_.x,i[c+1]=_.y,i[c+2]=_.z,i[c+3]=T.range,i[c+4]=m.x,i[c+5]=m.y,i[c+6]=m.z,i[c+7]=T.spotAngle*Math.PI/180,i[c+8]=h.x,i[c+9]=h.y,i[c+10]=h.z}t.addDefine(Z.a.SHADERDEFINE_SPOTLIGHT)}else t.removeDefine(Z.a.SHADERDEFINE_SPOTLIGHT);a>0&&e.setSubPixels(0,0,s,a,i,0),t.setTexture(nt.LIGHTBUFFER,e),t.setInt(nt.DIRECTIONLIGHTCOUNT,this._directionLights._length),t.setTexture(nt.CLUSTERBUFFER,S.a.instance._clusterTexture)}else{if(this._directionLights._length>0){var E=this._directionLights._elements[0];this._mainDirectionLight=E,A.a.scale(E.color,E._intensity,E._intensityColor),E.transform.worldMatrix.getForward(E._direction),A.a.normalize(E._direction,E._direction),t.setVector3(nt.LIGHTDIRCOLOR,E._intensityColor),t.setVector3(nt.LIGHTDIRECTION,E._direction),t.setVector3(nt.SUNLIGHTDIRCOLOR,E._intensityColor),t.setVector3(nt.SUNLIGHTDIRECTION,E._direction),t.addDefine(Z.a.SHADERDEFINE_DIRECTIONLIGHT)}else t.removeDefine(Z.a.SHADERDEFINE_DIRECTIONLIGHT);if(this._pointLights._length>0){var R=this._pointLights._elements[0];this._mainPointLight=R,A.a.scale(R.color,R._intensity,R._intensityColor),t.setVector3(nt.POINTLIGHTCOLOR,R._intensityColor),t.setVector3(nt.POINTLIGHTPOS,R.transform.position),t.setNumber(nt.POINTLIGHTRANGE,R.range),t.addDefine(Z.a.SHADERDEFINE_POINTLIGHT)}else t.removeDefine(Z.a.SHADERDEFINE_POINTLIGHT);if(this._spotLights._length>0){var x=this._spotLights._elements[0];this._mainSpotLight=x,A.a.scale(x.color,x._intensity,x._intensityColor),t.setVector3(nt.SPOTLIGHTCOLOR,x._intensityColor),t.setVector3(nt.SPOTLIGHTPOS,x.transform.position),x.transform.worldMatrix.getForward(x._direction),A.a.normalize(x._direction,x._direction),t.setVector3(nt.SPOTLIGHTDIRECTION,x._direction),t.setNumber(nt.SPOTLIGHTRANGE,x.range),t.setNumber(nt.SPOTLIGHTSPOTANGLE,x.spotAngle*Math.PI/180),t.addDefine(Z.a.SHADERDEFINE_SPOTLIGHT)}else t.removeDefine(Z.a.SHADERDEFINE_SPOTLIGHT)}}_addScript(t){var e=this._scriptPool;t._indexInPool=e.length,e.push(t)}_removeScript(t){this._scriptPool[t._indexInPool]=null,t._indexInPool=-1,this._needClearScriptPool=!0}_preRenderScript(){for(var t=this._scriptPool,e=0,i=t.length;e<i;e++){var a=t[e];a&&a.enabled&&a.onPreRender()}}_postRenderScript(){for(var t=this._scriptPool,e=0,i=t.length;e<i;e++){var a=t[e];a&&a.enabled&&a.onPostRender()}}_addCamera(t){for(var e=this._binarySearchIndexInCameraPool(t),i=t._renderingOrder,a=this._cameraPool.length;e<a&&this._cameraPool[e]._renderingOrder<=i;)e++;this._cameraPool.splice(e,0,t)}_removeCamera(t){this._cameraPool.splice(this._cameraPool.indexOf(t),1)}_preCulling(t,e,i,a){var r=E.b._cameraCullInfo;r.position=e._transform.position,r.cullingMask=e.cullingMask,r.boundFrustum=e.boundFrustum,r.useOcclusionCulling=e.useOcclusionCulling,E.b.renderObjectCulling(r,this,t,i,a,!1)}_clear(t,e){var i,a,r,s=e.viewport,n=e.camera,o=n._getRenderTexture(),l=s.width,h=s.height;n._needInternalRenderTexture()?(i=0,a=0):(i=s.x,a=n._getCanvasHeight()-s.y-h),t.viewport(i,a,l,h);var _=n.clearFlag;switch(_!==F.b.Sky||n.skyRenderer._isAvailable()||this._skyRenderer._isAvailable()||(_=F.b.SolidColor),_){case F.b.SolidColor:var c=n.clearColor;if(t.enable(t.SCISSOR_TEST),t.scissor(i,a,l,h),c?t.clearColor(c.x,c.y,c.z,c.w):t.clearColor(0,0,0,0),o)switch(r=t.COLOR_BUFFER_BIT,o.depthStencilFormat){case u.a.DEPTH_16:r|=t.DEPTH_BUFFER_BIT;break;case u.a.STENCIL_8:r|=t.STENCIL_BUFFER_BIT;break;case u.a.DEPTHSTENCIL_24_8:r|=t.DEPTH_BUFFER_BIT,r|=t.STENCIL_BUFFER_BIT}else r=t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT;g.a.setDepthMask(t,!0),t.clear(r),t.disable(t.SCISSOR_TEST);break;case F.b.Sky:case F.b.DepthOnly:if(t.enable(t.SCISSOR_TEST),t.scissor(i,a,l,h),o)switch(o.depthStencilFormat){case u.a.DEPTH_16:r=t.DEPTH_BUFFER_BIT;break;case u.a.STENCIL_8:r=t.STENCIL_BUFFER_BIT;break;case u.a.DEPTHSTENCIL_24_8:r=t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT}else r=t.DEPTH_BUFFER_BIT;g.a.setDepthMask(t,!0),t.clear(r),t.disable(t.SCISSOR_TEST);break;case F.b.Nothing:break;default:throw new Error("Scene3D:camera clearFlag invalid.")}}_renderScene(t,e){var i=t.camera;switch(e){case nt.SCENERENDERFLAG_RENDERQPAQUE:this._opaqueQueue._render(t);break;case nt.SCENERENDERFLAG_SKYBOX:i.clearFlag===F.b.Sky&&(i.skyRenderer._isAvailable()?i.skyRenderer._render(t):this._skyRenderer._isAvailable()&&this._skyRenderer._render(t));break;case nt.SCENERENDERFLAG_RENDERTRANSPARENT:if(this._transparentQueue._render(t),E.b.debugFrustumCulling)for(var a=this._debugTool._render._renderElements,r=0,s=a.length;r<s;r++)a[r]._update(this,t,null,null),a[r]._render(t)}}_parse(t,e){var i=t.lightmaps;if(i){for(var a=i.length,r=new Array(a),s=0;s<a;s++){var n=new j.a,o=i[s];o.path?n.lightmapColor=h.a.getRes(o.path):(n.lightmapColor=h.a.getRes(o.color.path),o.direction&&(n.lightmapDirection=h.a.getRes(o.direction.path))),r[s]=n}this.lightmaps=r}var l=t.ambientColor;if(l){var _=this.ambientColor;_.fromArray(l),this.ambientColor=_}var c=t.sky;if(c)switch(this._skyRenderer.material=h.a.getRes(c.material.path),c.mesh){case"SkyBox":this._skyRenderer.mesh=b.a.instance;break;case"SkyDome":this._skyRenderer.mesh=L.a.instance;break;default:this.skyRenderer.mesh=b.a.instance}this.enableFog=t.enableFog,this.fogStart=t.fogStart,this.fogRange=t.fogRange;var d=t.fogColor;if(d){var u=this.fogColor;u.fromArray(d),this.fogColor=u}var f=t.ambientSphericalHarmonics;if(f){var m=this.ambientSphericalHarmonics;for(s=0;s<3;s++){var p=9*s;m.setCoefficients(s,f[p],f[p+1],f[p+2],f[p+3],f[p+4],f[p+5],f[p+6],f[p+7],f[p+8])}this.ambientSphericalHarmonics=m}var g=t.reflection;void 0!=g&&(this.reflection=h.a.getRes(g));var v=t.reflectionDecodingFormat;void 0!=v&&(this.reflectionDecodingFormat=v);var T=t.ambientMode;void 0!=T&&(this.ambientMode=T);var E=t.ambientSphericalHarmonicsIntensity;void 0!=E&&(this.ambientSphericalHarmonicsIntensity=E);var S=t.reflectionIntensity;void 0!=S&&(this.reflectionIntensity=S)}_addRenderObject(t){this._octree&&t._supportOctree?this._octree.add(t):this._renders.add(t),t._addReflectionProbeUpdate()}_removeRenderObject(t){this._octree&&t._supportOctree?this._octree.remove(t):this._renders.remove(t)}_getRenderQueue(t){return t<=2500?this._opaqueQueue:this._transparentQueue}_clearRenderQueue(){this._opaqueQueue.clear(),this._transparentQueue.clear();for(var t=K.a._managers,e=0,i=t.length;e<i;e++)t[e]._clear();var a=J.a._managers;for(e=0,i=a.length;e<i;e++)a[e]._clear()}destroy(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.destroyed){super.destroy(t),this._skyRenderer.destroy(),this._skyRenderer=null,this._directionLights=null,this._pointLights=null,this._spotLights=null,this._alternateLights=null,this._shaderValues=null,this._renders=null,this._cameraPool=null,this._octree=null,this._physicsSimulation&&this._physicsSimulation._destroy(),this._reflection._removeReference(),this._reflection=null;var e=this._lightmaps;if(e)for(var i=0,a=e.length;i<a;i++){var r=e[i];r.lightmapColor&&r.lightmapColor._removeReference(),r.lightmapDirection&&r.lightmapDirection._removeReference()}this._lightmaps=null,this._reflectionProbeManager.destroy(),h.a.clearRes(this.url)}}render(t,e,i){t._curSubmit=m.a.RENDERBASE,this._children.length>0&&t.addRenderObject(this)}renderSubmit(){var t,e,i;l.a.instance;for(this._prepareSceneToRender(),t=0,i=(e=this._cameraPool.length)-1;t<e;t++){c.a.supportWebGLPlusRendering&&w.a.setRuntimeValueMode(t==i);var a=this._cameraPool[t];a.enableRender&&a.render()}return d.a.set2DRenderConfig(),1}getRenderType(){return 0}releaseRender(){}reUse(t,e){return 0}setGlobalShaderValue(t,e,i){var a=N.a.propertyNameToID(t);switch(e){case rt.b.Int:this._shaderValues.setInt(a,i);break;case rt.b.Number:this._shaderValues.setNumber(a,i);break;case rt.b.Bool:this._shaderValues.setBool(a,i);break;case rt.b.Matrix4x4:this._shaderValues.setMatrix4x4(a,i);break;case rt.b.Quaternion:this._shaderValues.setQuaternion(a,i);break;case rt.b.Texture:this._shaderValues.setTexture(a,i);break;case rt.b.Vector:this._shaderValues.setVector(a,i);break;case rt.b.Vector2:this._shaderValues.setVector2(a,i);break;case rt.b.Vector3:this._shaderValues.setVector3(a,i);break;case rt.b.Buffer:this._shaderValues.setBuffer(a,i)}}get customReflection(){return this._reflection}set customReflection(t){this._reflection!=t&&(t._addReference(),this._reflectionProbeManager.sceneReflectionProbe=t,this._reflection=t)}get reflectionMode(){return this._reflectionMode}set reflectionMode(t){this._reflectionMode=t}setlightmaps(t){for(var e=this._lightmaps,i=0,a=e.length;i<a;i++)e[i].lightmapColor._removeReference();if(!t)throw new Error("Scene3D: value value can't be null.");var r=t.length;for(e.length=r,i=0;i<r;i++){var s=t[i];s._addReference(),e[i]||(e[i]=new j.a),e[i].lightmapColor=s}}getlightmaps(){for(var t=new Array(this._lightmaps.length),e=0;e<this._lightmaps.length;e++)t[e]=this._lightmaps[e].lightmapColor;return t}}e.a=nt,r()(nt,"_lightTexture",void 0),r()(nt,"_lightPixles",void 0),r()(nt,"_shadowCasterPass",new q.a),r()(nt,"HIERARCHY","HIERARCHY"),r()(nt,"physicsSettings",void 0),r()(nt,"cannonPhysicsSettings",void 0),r()(nt,"octreeCulling",!1),r()(nt,"octreeInitialSize",64),r()(nt,"octreeInitialCenter",new A.a(0,0,0)),r()(nt,"octreeMinNodeSize",2),r()(nt,"octreeLooseness",1.25),r()(nt,"REFLECTIONMODE_SKYBOX",0),r()(nt,"REFLECTIONMODE_CUSTOM",1),r()(nt,"SCENERENDERFLAG_RENDERQPAQUE",0),r()(nt,"SCENERENDERFLAG_SKYBOX",1),r()(nt,"SCENERENDERFLAG_RENDERTRANSPARENT",2),r()(nt,"FOGCOLOR",N.a.propertyNameToID("u_FogColor")),r()(nt,"FOGSTART",N.a.propertyNameToID("u_FogStart")),r()(nt,"FOGRANGE",N.a.propertyNameToID("u_FogRange")),r()(nt,"DIRECTIONLIGHTCOUNT",N.a.propertyNameToID("u_DirationLightCount")),r()(nt,"LIGHTBUFFER",N.a.propertyNameToID("u_LightBuffer")),r()(nt,"CLUSTERBUFFER",N.a.propertyNameToID("u_LightClusterBuffer")),r()(nt,"SUNLIGHTDIRECTION",N.a.propertyNameToID("u_SunLight.direction")),r()(nt,"SUNLIGHTDIRCOLOR",N.a.propertyNameToID("u_SunLight.color")),r()(nt,"AMBIENTSHAR",N.a.propertyNameToID("u_AmbientSHAr")),r()(nt,"AMBIENTSHAG",N.a.propertyNameToID("u_AmbientSHAg")),r()(nt,"AMBIENTSHAB",N.a.propertyNameToID("u_AmbientSHAb")),r()(nt,"AMBIENTSHBR",N.a.propertyNameToID("u_AmbientSHBr")),r()(nt,"AMBIENTSHBG",N.a.propertyNameToID("u_AmbientSHBg")),r()(nt,"AMBIENTSHBB",N.a.propertyNameToID("u_AmbientSHBb")),r()(nt,"AMBIENTSHC",N.a.propertyNameToID("u_AmbientSHC")),r()(nt,"LIGHTDIRECTION",N.a.propertyNameToID("u_DirectionLight.direction")),r()(nt,"LIGHTDIRCOLOR",N.a.propertyNameToID("u_DirectionLight.color")),r()(nt,"POINTLIGHTPOS",N.a.propertyNameToID("u_PointLight.position")),r()(nt,"POINTLIGHTRANGE",N.a.propertyNameToID("u_PointLight.range")),r()(nt,"POINTLIGHTATTENUATION",N.a.propertyNameToID("u_PointLight.attenuation")),r()(nt,"POINTLIGHTCOLOR",N.a.propertyNameToID("u_PointLight.color")),r()(nt,"SPOTLIGHTPOS",N.a.propertyNameToID("u_SpotLight.position")),r()(nt,"SPOTLIGHTDIRECTION",N.a.propertyNameToID("u_SpotLight.direction")),r()(nt,"SPOTLIGHTSPOTANGLE",N.a.propertyNameToID("u_SpotLight.spot")),r()(nt,"SPOTLIGHTRANGE",N.a.propertyNameToID("u_SpotLight.range")),r()(nt,"SPOTLIGHTCOLOR",N.a.propertyNameToID("u_SpotLight.color")),r()(nt,"AMBIENTCOLOR",N.a.propertyNameToID("u_AmbientColor")),r()(nt,"TIME",N.a.propertyNameToID("u_Time")),r()(nt,"_configDefineValues",new Q.a)},function(t,e,i){"use strict";let a;i.d(e,"a",function(){return a}),function(t){t[t.Normal=0]="Normal",t[t.RGBM=1]="RGBM"}(a||(a={}))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(5),n=i(7),o=i(22);class l extends o.a{static __initDefine__(){}get color(){return this._shaderValues.getVector(l.COLOR)}set color(t){this._shaderValues.setVector(l.COLOR,t)}set depthWrite(t){this._shaderValues.setBool(l.DEPTH_WRITE,t)}get depthWrite(){return this._shaderValues.getBool(l.DEPTH_WRITE)}set cull(t){this._shaderValues.setInt(l.CULL,t)}get cull(){return this._shaderValues.getInt(l.CULL)}set blend(t){this._shaderValues.setInt(l.BLEND,t)}get blend(){return this._shaderValues.getInt(l.BLEND)}set blendSrc(t){this._shaderValues.setInt(l.BLEND_SRC,t)}get blendSrc(){return this._shaderValues.getInt(l.BLEND_SRC)}set blendDst(t){this._shaderValues.setInt(l.BLEND_DST,t)}get blendDst(){return this._shaderValues.getInt(l.BLEND_DST)}set depthTest(t){this._shaderValues.setInt(l.DEPTH_TEST,t)}get depthTest(){return this._shaderValues.getInt(l.DEPTH_TEST)}constructor(){super(),this.setShaderName("LineShader"),this._shaderValues.setVector(l.COLOR,new s.a(1,1,1,1))}clone(){var t=new l;return this.cloneTo(t),t}}e.a=l,r()(l,"COLOR",n.a.propertyNameToID("u_Color")),r()(l,"defaultMaterial",void 0),r()(l,"CULL",n.a.propertyNameToID("s_Cull")),r()(l,"BLEND",n.a.propertyNameToID("s_Blend")),r()(l,"BLEND_SRC",n.a.propertyNameToID("s_BlendSrc")),r()(l,"BLEND_DST",n.a.propertyNameToID("s_BlendDst")),r()(l,"DEPTH_TEST",n.a.propertyNameToID("s_DepthTest")),r()(l,"DEPTH_WRITE",n.a.propertyNameToID("s_DepthWrite"))},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{static _registerManager(t){s._managers.push(t)}constructor(){r()(this,"_batchRenderElementPool",void 0),r()(this,"_batchRenderElementPoolIndex",void 0),this._batchRenderElementPool=[]}_clear(){this._batchRenderElementPoolIndex=0}_getBatchRenderElementFromPool(){throw"StaticBatch:must override this function."}dispose(){}}e.a=s,r()(s,"_managers",[])},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(134),n=i(102),o=i(9),l=i(13),h=i(276),_=i(104),c=i(133),d=i(64),u=i(135),f=i(41),m=i(33),p=i(103),g=i(132);e.a=class extends c.a{constructor(t){super(t),r()(this,"_revertStaticBatchDefineUV1",!1),r()(this,"_projectionViewWorldMatrix",void 0),this._projectionViewWorldMatrix=new o.a}_createRenderElement(){return new u.a}_onMeshChange(t){if(t){var e=t.subMeshCount;this._renderElements.length=e;for(var i=0;i<e;i++){var a=this._renderElements[i];if(!a){var r=this.sharedMaterials[i];(a=this._renderElements[i]=this._createRenderElement()).setTransform(this._owner._transform),a.render=this,a.material=r||h.a.defaultMaterial}a.setGeometry(t.getSubMesh(i))}}else this._renderElements.length=0;this._boundsChange=!0}_calculateBoundingBox(){var t=this._owner.meshFilter.sharedMesh;if(t){var e=this._owner.transform.worldMatrix;t.bounds._tranform(e,this._bounds)}}_needRender(t,e){return!t||t.intersects(this.bounds._getBoundBox())}_renderUpdate(t,e){this._applyLightMapParams();var i=t.renderElement;switch(i.renderType){case d.a.RENDERTYPE_NORMAL:this._shaderValues.setMatrix4x4(m.a.WORLDMATRIX,e.worldMatrix);break;case d.a.RENDERTYPE_STATICBATCH:e?this._shaderValues.setMatrix4x4(m.a.WORLDMATRIX,e.worldMatrix):this._shaderValues.setMatrix4x4(m.a.WORLDMATRIX,o.a.DEFAULT),this._shaderValues.hasDefine(_.a.SHADERDEFINE_UV1)?this._revertStaticBatchDefineUV1=!1:(this._shaderValues.addDefine(_.a.SHADERDEFINE_UV1),this._revertStaticBatchDefineUV1=!0),this._shaderValues.setVector(f.a.LIGHTMAPSCALEOFFSET,c.a._defaultLightmapScaleOffset);break;case d.a.RENDERTYPE_VERTEXBATCH:this._shaderValues.setMatrix4x4(m.a.WORLDMATRIX,o.a.DEFAULT);break;case d.a.RENDERTYPE_INSTANCEBATCH:for(var a=n.a.instance.instanceWorldMatrixData,r=i.instanceBatchElementList,s=r.elements,l=r.length,h=0;h<l;h++)a.set(s[h]._transform.worldMatrix.elements,16*h);var u=n.a.instance.instanceWorldMatrixBuffer;u.orphanStorage(),u.setData(a.buffer,0,0,16*l*4),this._shaderValues.addDefine(_.a.SHADERDEFINE_GPU_INSTANCE)}this._probReflection&&(this._reflectionMode==p.b.off?(this._shaderValues.removeDefine(_.a.SHADERDEFINE_SPECCUBE_BOX_PROJECTION),this._shaderValues.setVector(f.a.REFLECTIONCUBE_HDR_PARAMS,p.a.defaultTextureHDRDecodeValues),this._shaderValues.setTexture(f.a.REFLECTIONTEXTURE,g.a.blackTexture)):(this._probReflection.boxProjection?(this._shaderValues.addDefine(_.a.SHADERDEFINE_SPECCUBE_BOX_PROJECTION),this._shaderValues.setVector3(f.a.REFLECTIONCUBE_PROBEPOSITION,this._probReflection.probePosition),this._shaderValues.setVector3(f.a.REFLECTIONCUBE_PROBEBOXMAX,this._probReflection.boundsMax),this._shaderValues.setVector3(f.a.REFLECTIONCUBE_PROBEBOXMIN,this._probReflection.boundsMin)):this._shaderValues.removeDefine(_.a.SHADERDEFINE_SPECCUBE_BOX_PROJECTION),this._shaderValues.setTexture(f.a.REFLECTIONTEXTURE,this._probReflection.reflectionTexture),this._shaderValues.setVector(f.a.REFLECTIONCUBE_HDR_PARAMS,this._probReflection.reflectionHDRParams)))}_renderUpdateWithCamera(t,e){var i=t.projectionViewMatrix;if(i){var a=t.renderElement;switch(a.renderType){case d.a.RENDERTYPE_NORMAL:case d.a.RENDERTYPE_STATICBATCH:case d.a.RENDERTYPE_VERTEXBATCH:e?(o.a.multiply(i,e.worldMatrix,this._projectionViewWorldMatrix),this._shaderValues.setMatrix4x4(m.a.MVPMATRIX,this._projectionViewWorldMatrix)):this._shaderValues.setMatrix4x4(m.a.MVPMATRIX,i);break;case d.a.RENDERTYPE_INSTANCEBATCH:for(var r=n.a.instance.instanceMVPMatrixData,s=a.instanceBatchElementList,h=s.elements,_=s.length,c=0;c<_;c++){var u=h[c]._transform.worldMatrix;l.a.mulMatrixByArray(i.elements,0,u.elements,0,r,16*c)}var f=n.a.instance.instanceMVPMatrixBuffer;f.orphanStorage(),f.setData(r.buffer,0,0,16*_*4)}}}_revertBatchRenderUpdate(t){switch(t.renderElement.renderType){case d.a.RENDERTYPE_STATICBATCH:this._revertStaticBatchDefineUV1&&this._shaderValues.removeDefine(_.a.SHADERDEFINE_UV1),this._shaderValues.setVector(f.a.LIGHTMAPSCALEOFFSET,this.lightmapScaleOffset);break;case d.a.RENDERTYPE_INSTANCEBATCH:this._shaderValues.removeDefine(_.a.SHADERDEFINE_GPU_INSTANCE)}}_destroy(){this._isPartOfStaticBatch&&s.a.instance._removeRenderSprite(this._owner),super._destroy()}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(14),n=i(104);class o{get sharedMesh(){return this._sharedMesh}set sharedMesh(t){if(this._sharedMesh!==t){var e=this._owner._render._shaderValues,i=this._sharedMesh;if(i){i._removeReference(),this._getMeshDefine(i,o._meshVerticeDefine);for(var a=0,r=o._meshVerticeDefine.length;a<r;a++)e.removeDefine(o._meshVerticeDefine[a])}if(t){t._addReference(),this._getMeshDefine(t,o._meshVerticeDefine);for(a=0,r=o._meshVerticeDefine.length;a<r;a++)e.addDefine(o._meshVerticeDefine[a])}this._owner._render._onMeshChange(t),this._sharedMesh=t}}constructor(t){r()(this,"_owner",void 0),r()(this,"_sharedMesh",void 0),this._owner=t}_getMeshDefine(t,e){e.length=0;for(var i=0,a=t._subMeshes.length;i<a;i++)for(var r=t.getSubMesh(i)._vertexBuffer._vertexDeclaration._vertexElements,o=0,l=r.length;o<l;o++){switch(r[o]._elementUsage){case s.a.MESH_COLOR0:e.push(n.a.SHADERDEFINE_COLOR);break;case s.a.MESH_TEXTURECOORDINATE0:e.push(n.a.SHADERDEFINE_UV0);break;case s.a.MESH_TEXTURECOORDINATE1:e.push(n.a.SHADERDEFINE_UV1)}}}destroy(){this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)}}e.a=o,r()(o,"_meshVerticeDefine",[])},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(291);class n{get mode(){return this._mode}set mode(t){this._mode=t}get colorRGBKeysCount(){return this._colorRGBKeysCount}get colorAlphaKeysCount(){return this._colorAlphaKeysCount}get maxColorRGBKeysCount(){return this._maxColorRGBKeysCount}get maxColorAlphaKeysCount(){return this._maxColorAlphaKeysCount}constructor(t,e){r()(this,"_mode",0),r()(this,"_maxColorRGBKeysCount",0),r()(this,"_maxColorAlphaKeysCount",0),r()(this,"_colorRGBKeysCount",0),r()(this,"_colorAlphaKeysCount",0),r()(this,"_alphaElements",null),r()(this,"_rgbElements",null),this._maxColorRGBKeysCount=t,this._maxColorAlphaKeysCount=e,this._rgbElements=new Float32Array(4*t),this._alphaElements=new Float32Array(2*e)}addColorRGB(t,e){if(this._colorRGBKeysCount<this._maxColorRGBKeysCount){var i=4*this._colorRGBKeysCount;this._rgbElements[i]=t,this._rgbElements[i+1]=e.r,this._rgbElements[i+2]=e.g,this._rgbElements[i+3]=e.b,this._colorRGBKeysCount++}else console.warn("Gradient:warning:data count must lessEqual than "+this._maxColorRGBKeysCount)}addColorAlpha(t,e){if(this._colorAlphaKeysCount<this._maxColorAlphaKeysCount){var i=2*this._colorAlphaKeysCount;this._alphaElements[i]=t,this._alphaElements[i+1]=e,this._colorAlphaKeysCount++}else console.warn("Gradient:warning:data count must lessEqual than "+this._maxColorAlphaKeysCount)}updateColorRGB(t,e,i){if(t<this._colorRGBKeysCount){var a=4*t;this._rgbElements[a]=e,this._rgbElements[a+1]=i.r,this._rgbElements[a+2]=i.g,this._rgbElements[a+3]=i.b}else console.warn("Gradient:warning:index must lessEqual than colorRGBKeysCount:"+this._colorRGBKeysCount)}updateColorAlpha(t,e,i){if(t<this._colorAlphaKeysCount){var a=2*t;this._alphaElements[a]=e,this._alphaElements[a+1]=i}else console.warn("Gradient:warning:index must lessEqual than colorAlphaKeysCount:"+this._colorAlphaKeysCount)}evaluateColorRGB(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t=Math.min(Math.max(t,0),1);var r=this._rgbElements,n=i;if(a)for(var o=n;o>=0;o--){var l=4*o;if(t===(f=r[l]))return e.r=r[l+1],e.g=r[l+2],e.b=r[l+3],n;switch(this._mode){case s.a.Blend:if(t>f){if(t>(u=r[l+4]))throw"Gradient:wrong startSearchIndex.";var h=u-f,_=u-t,c=t-f;return e.r=(_*r[l+1]+c*r[l+5])/h,e.g=(_*r[l+2]+c*r[l+6])/h,e.b=(_*r[l+3]+c*r[l+7])/h,n}n--;continue;case s.a.Fixed:if(t>f){if(t>r[l+4])throw"Gradient:wrong startSearchIndex.";return e.r=r[l+5],e.g=r[l+6],e.b=r[l+7],n}n--;continue;default:throw"Gradient:unknown mode."}}else{o=0;for(var d=this._rgbElements.length;o<d;o++){var u;if(t===(u=r[l=4*o]))return e.r=r[l+1],e.g=r[l+2],e.b=r[l+3],n;switch(this._mode){case s.a.Blend:if(t<u){var f;if(t<(f=r[l-4]))throw"Gradient:wrong startSearchIndex.";h=u-f,_=u-t,c=t-f;return e.r=(_*r[l-3]+c*r[l+1])/h,e.g=(_*r[l-2]+c*r[l+2])/h,e.b=(_*r[l-1]+c*r[l+3])/h,n}n++;continue;case s.a.Fixed:if(t<u){if(t<r[l-4])throw"Gradient:wrong startSearchIndex.";return e.r=r[l+1],e.g=r[l+2],e.b=r[l+3],n}n++;continue;default:throw"Gradient:unknown mode."}}}return n}evaluateColorAlpha(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t=Math.min(Math.max(t,0),1);var r=this._alphaElements,n=i;if(a)for(var o=n;o>=0;o--){if(t===(f=r[d=2*o]))return e.a=r[d+1],n;switch(this._mode){case s.a.Blend:if(t>f){if(t>(u=r[d+2]))throw"Gradient:wrong startSearchIndex.";var l=u-f,h=u-t,_=t-f;return e.a=(h*r[d+1]+_*r[d+3])/l,n}n--;continue;case s.a.Fixed:if(t>f){if(t>r[d+2])throw"Gradient:wrong startSearchIndex.";return e.a=r[d+3],n}n--;continue;default:throw"Gradient:unknown mode."}}else{o=n;for(var c=this._alphaElements.length;o<c;o++){var d,u;if(t===(u=r[d=2*o]))return e.a=r[d+1],n;switch(this._mode){case s.a.Blend:if(t<u){var f;if(t<(f=r[d-2]))throw"Gradient:wrong startSearchIndex.";l=u-f,h=u-t,_=t-f;return e.a=(h*r[d-1]+_*r[d+1])/l,n}n++;continue;case s.a.Fixed:if(t<u){if(t<r[d-2])throw"Gradient:wrong startSearchIndex.";return e.a=r[d+1],n}n++;continue;default:throw"Gradient:unknown mode."}}}return n}cloneTo(t){var e,i,a=t;a._colorAlphaKeysCount=this._colorAlphaKeysCount;var r=a._alphaElements;for(e=0,i=this._alphaElements.length;e<i;e++)r[e]=this._alphaElements[e];a._colorRGBKeysCount=this._colorRGBKeysCount;var s=a._rgbElements;for(e=0,i=this._rgbElements.length;e<i;e++)s[e]=this._rgbElements[e]}clone(){var t=new n(this._maxColorRGBKeysCount,this._maxColorAlphaKeysCount);return this.cloneTo(t),t}}e.a=n},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(7);class n{}e.a=n,r()(n,"SHADERDEFINE_RENDERMODE_BILLBOARD",void 0),r()(n,"SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD",void 0),r()(n,"SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD",void 0),r()(n,"SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD",void 0),r()(n,"SHADERDEFINE_COLOROVERLIFETIME",void 0),r()(n,"SHADERDEFINE_RANDOMCOLOROVERLIFETIME",void 0),r()(n,"SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT",void 0),r()(n,"SHADERDEFINE_VELOCITYOVERLIFETIMECURVE",void 0),r()(n,"SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT",void 0),r()(n,"SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE",void 0),r()(n,"SHADERDEFINE_TEXTURESHEETANIMATIONCURVE",void 0),r()(n,"SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE",void 0),r()(n,"SHADERDEFINE_ROTATIONOVERLIFETIME",void 0),r()(n,"SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE",void 0),r()(n,"SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT",void 0),r()(n,"SHADERDEFINE_ROTATIONOVERLIFETIMECURVE",void 0),r()(n,"SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS",void 0),r()(n,"SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES",void 0),r()(n,"SHADERDEFINE_SIZEOVERLIFETIMECURVE",void 0),r()(n,"SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE",void 0),r()(n,"SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES",void 0),r()(n,"SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE",void 0),r()(n,"SHADERDEFINE_RENDERMODE_MESH",void 0),r()(n,"SHADERDEFINE_SHAPE",void 0),r()(n,"WORLDPOSITION",s.a.propertyNameToID("u_WorldPosition")),r()(n,"WORLDROTATION",s.a.propertyNameToID("u_WorldRotation")),r()(n,"POSITIONSCALE",s.a.propertyNameToID("u_PositionScale")),r()(n,"SIZESCALE",s.a.propertyNameToID("u_SizeScale")),r()(n,"SCALINGMODE",s.a.propertyNameToID("u_ScalingMode")),r()(n,"GRAVITY",s.a.propertyNameToID("u_Gravity")),r()(n,"THREEDSTARTROTATION",s.a.propertyNameToID("u_ThreeDStartRotation")),r()(n,"STRETCHEDBILLBOARDLENGTHSCALE",s.a.propertyNameToID("u_StretchedBillboardLengthScale")),r()(n,"STRETCHEDBILLBOARDSPEEDSCALE",s.a.propertyNameToID("u_StretchedBillboardSpeedScale")),r()(n,"SIMULATIONSPACE",s.a.propertyNameToID("u_SimulationSpace")),r()(n,"CURRENTTIME",s.a.propertyNameToID("u_CurrentTime")),r()(n,"VOLVELOCITYCONST",s.a.propertyNameToID("u_VOLVelocityConst")),r()(n,"VOLVELOCITYGRADIENTX",s.a.propertyNameToID("u_VOLVelocityGradientX")),r()(n,"VOLVELOCITYGRADIENTY",s.a.propertyNameToID("u_VOLVelocityGradientY")),r()(n,"VOLVELOCITYGRADIENTZ",s.a.propertyNameToID("u_VOLVelocityGradientZ")),r()(n,"VOLVELOCITYCONSTMAX",s.a.propertyNameToID("u_VOLVelocityConstMax")),r()(n,"VOLVELOCITYGRADIENTXMAX",s.a.propertyNameToID("u_VOLVelocityGradientMaxX")),r()(n,"VOLVELOCITYGRADIENTYMAX",s.a.propertyNameToID("u_VOLVelocityGradientMaxY")),r()(n,"VOLVELOCITYGRADIENTZMAX",s.a.propertyNameToID("u_VOLVelocityGradientMaxZ")),r()(n,"VOLSPACETYPE",s.a.propertyNameToID("u_VOLSpaceType")),r()(n,"COLOROVERLIFEGRADIENTALPHAS",s.a.propertyNameToID("u_ColorOverLifeGradientAlphas")),r()(n,"COLOROVERLIFEGRADIENTCOLORS",s.a.propertyNameToID("u_ColorOverLifeGradientColors")),r()(n,"MAXCOLOROVERLIFEGRADIENTALPHAS",s.a.propertyNameToID("u_MaxColorOverLifeGradientAlphas")),r()(n,"MAXCOLOROVERLIFEGRADIENTCOLORS",s.a.propertyNameToID("u_MaxColorOverLifeGradientColors")),r()(n,"SOLSIZEGRADIENT",s.a.propertyNameToID("u_SOLSizeGradient")),r()(n,"SOLSIZEGRADIENTX",s.a.propertyNameToID("u_SOLSizeGradientX")),r()(n,"SOLSIZEGRADIENTY",s.a.propertyNameToID("u_SOLSizeGradientY")),r()(n,"SOLSizeGradientZ",s.a.propertyNameToID("u_SOLSizeGradientZ")),r()(n,"SOLSizeGradientMax",s.a.propertyNameToID("u_SOLSizeGradientMax")),r()(n,"SOLSIZEGRADIENTXMAX",s.a.propertyNameToID("u_SOLSizeGradientMaxX")),r()(n,"SOLSIZEGRADIENTYMAX",s.a.propertyNameToID("u_SOLSizeGradientMaxY")),r()(n,"SOLSizeGradientZMAX",s.a.propertyNameToID("u_SOLSizeGradientMaxZ")),r()(n,"ROLANGULARVELOCITYCONST",s.a.propertyNameToID("u_ROLAngularVelocityConst")),r()(n,"ROLANGULARVELOCITYCONSTSEPRARATE",s.a.propertyNameToID("u_ROLAngularVelocityConstSeprarate")),r()(n,"ROLANGULARVELOCITYGRADIENT",s.a.propertyNameToID("u_ROLAngularVelocityGradient")),r()(n,"ROLANGULARVELOCITYGRADIENTX",s.a.propertyNameToID("u_ROLAngularVelocityGradientX")),r()(n,"ROLANGULARVELOCITYGRADIENTY",s.a.propertyNameToID("u_ROLAngularVelocityGradientY")),r()(n,"ROLANGULARVELOCITYGRADIENTZ",s.a.propertyNameToID("u_ROLAngularVelocityGradientZ")),r()(n,"ROLANGULARVELOCITYCONSTMAX",s.a.propertyNameToID("u_ROLAngularVelocityConstMax")),r()(n,"ROLANGULARVELOCITYCONSTMAXSEPRARATE",s.a.propertyNameToID("u_ROLAngularVelocityConstMaxSeprarate")),r()(n,"ROLANGULARVELOCITYGRADIENTMAX",s.a.propertyNameToID("u_ROLAngularVelocityGradientMax")),r()(n,"ROLANGULARVELOCITYGRADIENTXMAX",s.a.propertyNameToID("u_ROLAngularVelocityGradientMaxX")),r()(n,"ROLANGULARVELOCITYGRADIENTYMAX",s.a.propertyNameToID("u_ROLAngularVelocityGradientMaxY")),r()(n,"ROLANGULARVELOCITYGRADIENTZMAX",s.a.propertyNameToID("u_ROLAngularVelocityGradientMaxZ")),r()(n,"ROLANGULARVELOCITYGRADIENTWMAX",s.a.propertyNameToID("u_ROLAngularVelocityGradientMaxW")),r()(n,"TEXTURESHEETANIMATIONCYCLES",s.a.propertyNameToID("u_TSACycles")),r()(n,"TEXTURESHEETANIMATIONSUBUVLENGTH",s.a.propertyNameToID("u_TSASubUVLength")),r()(n,"TEXTURESHEETANIMATIONGRADIENTUVS",s.a.propertyNameToID("u_TSAGradientUVs")),r()(n,"TEXTURESHEETANIMATIONGRADIENTMAXUVS",s.a.propertyNameToID("u_TSAMaxGradientUVs"))},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{constructor(){}}e.a=s,r()(s,"PARTICLE_CORNERTEXTURECOORDINATE0",5),r()(s,"PARTICLE_POSITION0",1),r()(s,"PARTICLE_COLOR0",2),r()(s,"PARTICLE_TEXTURECOORDINATE0",3),r()(s,"PARTICLE_SHAPEPOSITIONSTARTLIFETIME",4),r()(s,"PARTICLE_DIRECTIONTIME",0),r()(s,"PARTICLE_STARTCOLOR0",6),r()(s,"PARTICLE_ENDCOLOR0",7),r()(s,"PARTICLE_STARTSIZE",8),r()(s,"PARTICLE_STARTROTATION",9),r()(s,"PARTICLE_STARTSPEED",10),r()(s,"PARTICLE_RANDOM0",11),r()(s,"PARTICLE_RANDOM1",12),r()(s,"PARTICLE_SIMULATIONWORLDPOSTION",13),r()(s,"PARTICLE_SIMULATIONWORLDROTATION",14)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(6),n=i(2),o=i(8),l=i(9),h=i(1),_=i(13),c=i(74),d=i(185),u=i(41),f=i(33),m=i(85),p=i(64),g=i(191),v=i(103),T=i(104),E=i(132);class S extends d.a{get localBounds(){return this._localBounds}set localBounds(t){this._localBounds=t}get rootBone(){return this._cacheRootBone}set rootBone(t){this._cacheRootBone!=t&&(this._cacheRootBone?this._cacheRootBone.transform.off(s.a.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange):this._owner.transform.off(s.a.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange),t?t.transform.on(s.a.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange):this._owner.transform.on(s.a.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange),this._cacheRootBone=t,this._onWorldMatNeedChange(m.a.TRANSFORM_WORLDPOSITION|m.a.TRANSFORM_WORLDQUATERNION|m.a.TRANSFORM_WORLDSCALE))}get bones(){return this._bones}constructor(t){super(t),r()(this,"_cacheMesh",void 0),r()(this,"_bones",[]),r()(this,"_skinnedData",void 0),r()(this,"_skinnedDataLoopMarks",[]),r()(this,"_localBounds",new c.a(h.a._ZERO,h.a._ZERO)),r()(this,"_cacheAnimator",void 0),r()(this,"_cacheRootBone",void 0),r()(this,"_rootBone",void 0),r()(this,"_cacheAvatar",void 0),r()(this,"_cacheRootAnimationNode",void 0),r()(this,"_cacheAnimationNode",[]),r()(this,"_cacheAnimationNodeIndices",void 0)}_computeSkinnedData(){if(this._cacheMesh&&this._cacheAvatar||this._cacheMesh&&!this._cacheAvatar)for(var t=this._cacheMesh._inverseBindPoses,e=this._cacheMesh._skinnedMatrixCaches,i=0,a=this._cacheMesh.subMeshCount;i<a;i++)for(var r=this._cacheMesh.getSubMesh(i)._boneIndicesList,s=this._skinnedData[i],n=0,o=r.length;n<o;n++){var l=r[n];this._computeSubSkinnedData(t,l,s[n],e)}}_computeSubSkinnedData(t,e,i,a){for(var r=0,s=e.length;r<s;r++){var n=e[r];if(this._skinnedDataLoopMarks[n]===o.a.loopCount)for(var l=a[n],h=this._skinnedData[l.subMeshIndex][l.batchIndex],c=16*l.batchBoneIndex,d=16*r,u=0;u<16;u++)i[d+u]=h[c+u];else this._cacheAvatar?_.a._mulMatrixArray(this._cacheAnimationNode[n].transform.getWorldMatrix(),t[n].elements,0,i,16*r):_.a._mulMatrixArray(this._bones[n].transform.worldMatrix.elements,t[n].elements,0,i,16*r),this._skinnedDataLoopMarks[n]=o.a.loopCount}}_onWorldMatNeedChange(t){this._boundsChange=!0,this._octreeNode&&(this._cacheAvatar?-1===this._indexInOctreeMotionList&&this._octreeNode._octree.addMotionObject(this):(t&=m.a.TRANSFORM_WORLDPOSITION|m.a.TRANSFORM_WORLDQUATERNION|m.a.TRANSFORM_WORLDSCALE)&&-1===this._indexInOctreeMotionList&&this._octreeNode._octree.addMotionObject(this))}_createRenderElement(){return new p.a}_onMeshChange(t){super._onMeshChange(t),this._cacheMesh=t;var e=t.subMeshCount;this._skinnedData=[],this._skinnedDataLoopMarks.length=t._inverseBindPoses.length;for(var i=0;i<e;i++)for(var a=t.getSubMesh(i)._boneIndicesList,r=a.length,s=this._skinnedData[i]=[],n=0;n<r;n++)s[n]=new Float32Array(16*a[n].length);this._cacheAvatar&&t&&this._getCacheAnimationNodes()}_setCacheAnimator(t){this._cacheAnimator=t,this._shaderValues.addDefine(g.a.SHADERDEFINE_BONE),this._setRootNode()}_calculateBoundingBox(){if(this._cacheAvatar)if(this._cacheAnimator&&this._rootBone){var t=S._tempMatrix4x4;_.a.matrix4x4MultiplyMFM(this._cacheAnimator.owner.transform.worldMatrix,this._cacheRootAnimationNode.transform.getWorldMatrix(),t),this._localBounds._tranform(t,this._bounds)}else super._calculateBoundingBox();else this._cacheRootBone?this._localBounds._tranform(this._cacheRootBone.transform.worldMatrix,this._bounds):this._localBounds._tranform(this._owner.transform.worldMatrix,this._bounds)}_renderUpdate(t,e){if(this._cacheAnimator)if(this._computeSkinnedData(),this._cacheAvatar){var i=this._cacheAnimator.owner._transform;this._shaderValues.setMatrix4x4(f.a.WORLDMATRIX,i.worldMatrix)}else this._shaderValues.setMatrix4x4(f.a.WORLDMATRIX,l.a.DEFAULT);else this._shaderValues.setMatrix4x4(f.a.WORLDMATRIX,e.worldMatrix);this._probReflection&&(this._reflectionMode==v.b.off?(this._shaderValues.removeDefine(T.a.SHADERDEFINE_SPECCUBE_BOX_PROJECTION),this._shaderValues.setVector(u.a.REFLECTIONCUBE_HDR_PARAMS,v.a.defaultTextureHDRDecodeValues),this._shaderValues.setTexture(u.a.REFLECTIONTEXTURE,E.a.blackTexture)):(this._probReflection.boxProjection?(this._shaderValues.addDefine(T.a.SHADERDEFINE_SPECCUBE_BOX_PROJECTION),this._shaderValues.setVector3(u.a.REFLECTIONCUBE_PROBEPOSITION,this._probReflection.probePosition),this._shaderValues.setVector3(u.a.REFLECTIONCUBE_PROBEBOXMAX,this._probReflection.boundsMax),this._shaderValues.setVector3(u.a.REFLECTIONCUBE_PROBEBOXMIN,this._probReflection.boundsMin)):this._shaderValues.removeDefine(T.a.SHADERDEFINE_SPECCUBE_BOX_PROJECTION),this._shaderValues.setTexture(u.a.REFLECTIONTEXTURE,this._probReflection.reflectionTexture),this._shaderValues.setVector(u.a.REFLECTIONCUBE_HDR_PARAMS,this._probReflection.reflectionHDRParams)))}_renderUpdateWithCamera(t,e){var i=t.projectionViewMatrix;if(this._cacheAnimator)if(this._cacheAvatar){var a=this._cacheAnimator.owner._transform;l.a.multiply(i,a.worldMatrix,this._projectionViewWorldMatrix),this._shaderValues.setMatrix4x4(f.a.MVPMATRIX,this._projectionViewWorldMatrix)}else this._shaderValues.setMatrix4x4(f.a.MVPMATRIX,i);else l.a.multiply(i,e.worldMatrix,this._projectionViewWorldMatrix),this._shaderValues.setMatrix4x4(f.a.MVPMATRIX,this._projectionViewWorldMatrix)}_destroy(){super._destroy(),this._cacheAvatar?this._cacheRootAnimationNode&&this._cacheRootAnimationNode.transform.off(s.a.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange):this._cacheRootBone?!this._cacheRootBone.destroyed&&this._cacheRootBone.transform.off(s.a.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange):this._owner&&!this._owner.destroyed&&this._owner.transform.off(s.a.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange)}get bounds(){return(this._boundsChange||this._cacheAvatar)&&(this._calculateBoundingBox(),this._boundsChange=!1),this._bounds}_setRootBone(t){this._rootBone=t,this._setRootNode()}_setRootNode(){var t;t=this._cacheAnimator&&this._rootBone&&this._cacheAvatar?this._cacheAnimator._avatarNodeMap[this._rootBone]:null,this._cacheRootAnimationNode!=t&&(this._onWorldMatNeedChange(m.a.TRANSFORM_WORLDPOSITION|m.a.TRANSFORM_WORLDQUATERNION|m.a.TRANSFORM_WORLDSCALE),this._owner.transform.off(s.a.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange),this._cacheRootAnimationNode&&this._cacheRootAnimationNode.transform.off(s.a.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange),t&&t.transform.on(s.a.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange),this._cacheRootAnimationNode=t)}_getCacheAnimationNodes(){var t=this._cacheMesh._boneNames,e=this._cacheMesh._inverseBindPoses.length;this._cacheAnimationNode.length=e;for(var i=this._cacheAnimator._avatarNodeMap,a=0;a<e;a++){var r=i[t[a]];this._cacheAnimationNode[a]=r}}_setCacheAvatar(t){this._cacheAvatar!==t&&(this._cacheMesh?(this._cacheAvatar=t,t&&(this._shaderValues.addDefine(g.a.SHADERDEFINE_BONE),this._getCacheAnimationNodes())):this._cacheAvatar=t,this._setRootNode())}_computeSubSkinnedDataNative(t,e,i,a,r){n.a.instance.computeSubSkinnedData(t,e,i,a,r)}_computeSkinnedDataForNative(){if(this._cacheMesh&&this._cacheAvatar||this._cacheMesh&&!this._cacheAvatar)for(var t=this._cacheMesh._inverseBindPoses,e=this._cacheMesh._skinnedMatrixCaches,i=0,a=this._cacheMesh.subMeshCount;i<a;i++)for(var r=this._cacheMesh.getSubMesh(i)._boneIndicesList,s=this._skinnedData[i],n=0,o=r.length;n<o;n++){var l=r[n];this._computeSubSkinnedData(t,l,s[n],e)}}}e.a=S,r()(S,"_tempMatrix4x4",new l.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{}e.a=s,r()(s,"SHADERDEFINE_BONE",void 0),r()(s,"SHADERDEFINE_SIMPLEBONE",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(12),n=i(1),o=i(5),l=i(7),h=i(13),_=i(186),c=i(41),d=i(190),u=i(191);class f extends c.a{static __init__(){u.a.SHADERDEFINE_BONE=l.a.getDefineByName("BONE"),u.a.SHADERDEFINE_SIMPLEBONE=l.a.getDefineByName("SIMPLEBONE")}get meshFilter(){return this._meshFilter}get skinnedMeshRenderer(){return this._render}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),r()(this,"_meshFilter",void 0),this._meshFilter=new _.a(this),this._render=new d.a(this),t&&(this._meshFilter.sharedMesh=t)}_parse(t,e){super._parse(t,e);var i=this.skinnedMeshRenderer,a=t.lightmapIndex;null!=a&&(i.lightmapIndex=a);var r,l=t.lightmapScaleOffset;if(l&&(i.lightmapScaleOffset=new o.a(l[0],l[1],l[2],l[3])),void 0!=t.enableRender&&(i.enable=t.enableRender),void 0!=t.receiveShadows&&(i.receiveShadow=t.receiveShadows),void 0!=t.castShadow&&(i.castShadow=t.castShadow),r=t.meshPath){var h=s.a.getRes(r);h&&(this.meshFilter.sharedMesh=h)}var _=t.materials;if(_){var c=i.sharedMaterials,d=_.length;c.length=d;for(var u=0;u<d;u++)c[u]=s.a.getRes(_[u].path);i.sharedMaterials=c}var f=t.boundBox,m=f.min,p=f.max;if(i.localBounds.setMin(new n.a(m[0],m[1],m[2])),i.localBounds.setMax(new n.a(p[0],p[1],p[2])),e){var g=t.rootBone;i.rootBone=e[g];var v,T=t.bones;for(u=0,v=T.length;u<v;u++)i.bones.push(e[T[u]])}else t.rootBone&&i._setRootBone(t.rootBone)}_changeHierarchyAnimator(t){super._changeHierarchyAnimator(t),this.skinnedMeshRenderer._setCacheAnimator(t)}_changeAnimatorAvatar(t){this.skinnedMeshRenderer._setCacheAvatar(t)}_cloneTo(t,e,i){var a=t;a.meshFilter.sharedMesh=this.meshFilter.sharedMesh;var r=this._render,s=a._render;s.enable=r.enable,s.sharedMaterials=r.sharedMaterials,s.castShadow=r.castShadow;var n=r.lightmapScaleOffset;n&&(s.lightmapScaleOffset=n.clone()),s.receiveShadow=r.receiveShadow,s.sortingFudge=r.sortingFudge,s._rootBone=r._rootBone;var o=r.bones,l=s.bones,_=o.length;l.length=_;var c=r.rootBone;if(c){var d=h.a._getHierarchyPath(e,c,f._tempArray0);s.rootBone=d?h.a._getNodeByHierarchyPath(i,d):c}for(var u=0;u<o.length;u++)d=h.a._getHierarchyPath(e,o[u],f._tempArray0),l[u]=d?h.a._getNodeByHierarchyPath(i,d):o[u];var m=r.localBounds;m&&m.cloneTo(s.localBounds),super._cloneTo(t,e,i)}destroy(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.destroyed||(super.destroy(t),this._meshFilter.destroy())}_create(){return new f}}e.a=f,r()(f,"_tempArray0",[]),r()(f,"BONES",l.a.propertyNameToID("u_Bones")),r()(f,"SIMPLE_SIMPLEANIMATORTEXTURE",l.a.propertyNameToID("u_SimpleAnimatorTexture")),r()(f,"SIMPLE_SIMPLEANIMATORPARAMS",l.a.propertyNameToID("u_SimpleAnimatorParams")),r()(f,"SIMPLE_SIMPLEANIMATORTEXTURESIZE",l.a.propertyNameToID("u_SimpleAnimatorTextureSize"))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(55),n=i(56),o=i(31);class l{static get vertexDeclaration1(){return l._vertexDeclaration1}static get vertexDeclaration2(){return l._vertexDeclaration2}get vertexDeclaration(){return l._vertexDeclaration1}static __init__(){l._vertexDeclaration1=new s.a(32,[new n.a(0,o.a.Vector3,l.TRAIL_POSITION0),new n.a(12,o.a.Vector3,l.TRAIL_OFFSETVECTOR),new n.a(24,o.a.Single,l.TRAIL_TIME0),new n.a(28,o.a.Single,l.TRAIL_TEXTURECOORDINATE0Y)]),l._vertexDeclaration2=new s.a(20,[new n.a(0,o.a.Single,l.TRAIL_TEXTURECOORDINATE0X),new n.a(4,o.a.Color,l.TRAIL_COLOR)])}}e.a=l,r()(l,"TRAIL_POSITION0",0),r()(l,"TRAIL_OFFSETVECTOR",1),r()(l,"TRAIL_TIME0",2),r()(l,"TRAIL_TEXTURECOORDINATE0Y",3),r()(l,"TRAIL_TEXTURECOORDINATE0X",4),r()(l,"TRAIL_COLOR",5),r()(l,"_vertexDeclaration1",void 0),r()(l,"_vertexDeclaration2",void 0)},function(t,e,i){t.exports=!i(45)&&!i(59)(function(){return 7!=Object.defineProperty(i(195)("div"),"a",{get:function(){return 7}}).a})},function(t,e,i){var a=i(77),r=i(44).document,s=a(r)&&a(r.createElement);t.exports=function(t){return s?r.createElement(t):{}}},function(t,e,i){var a=i(77);t.exports=function(t,e){if(!a(t))return t;var i,r;if(e&&"function"==typeof(i=t.toString)&&!a(r=i.call(t)))return r;if("function"==typeof(i=t.valueOf)&&!a(r=i.call(t)))return r;if(!e&&"function"==typeof(i=t.toString)&&!a(r=i.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},function(t,e){t.exports=!1},function(t,e,i){var a=i(144);t.exports=function(t,e,i){if(a(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,a){return t.call(e,i,a)};case 3:return function(i,a,r){return t.call(e,i,a,r)}}return function(){return t.apply(e,arguments)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(200),n=i(201),o=i(202),l=i(203),h=i(204),_=i(205),c=i(206),d=i(207),u=i(208),f=i(209),m=i(210),p=i(215),g=i(216),v=i(217),T=i(218),E=i(219),S=i(220),R=i(221),x=i(222),A=i(15),y=i(16),I=i(26),C=i(37),M=i(4),D=i(21),b=i(234),L=i(235),O=i(236);class P{constructor(){r()(this,"_temp",void 0),r()(this,"_bounds",void 0),r()(this,"_rstBoundPoints",void 0),r()(this,"_cacheBoundsType",!1),r()(this,"_graphics",void 0)}destroy(){this._graphics=null,this._cacheBoundsType=!1,this._temp&&(this._temp.length=0),this._rstBoundPoints&&(this._rstBoundPoints.length=0),this._bounds&&this._bounds.recover(),this._bounds=null,M.a.recover("GraphicsBounds",this)}static create(){return M.a.getItemByClass("GraphicsBounds",P)}reset(){this._temp&&(this._temp.length=0)}getBounds(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(!this._bounds||!this._temp||this._temp.length<1||t!=this._cacheBoundsType)&&(this._bounds=I.a._getWrapRec(this.getBoundPoints(t),this._bounds)),this._cacheBoundsType=t,this._bounds}getBoundPoints(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(!this._temp||this._temp.length<1||t!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(t)),this._cacheBoundsType=t,this._rstBoundPoints=D.a.copyArray(this._rstBoundPoints,this._temp)}_getCmdPoints(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];C.a._context;var e,i=this._graphics.cmds;if((e=this._temp||(this._temp=[])).length=0,i||null==this._graphics._one||(P._tempCmds.length=0,P._tempCmds.push(this._graphics._one),i=P._tempCmds),!i)return e;var a=P._tempMatrixArrays;a.length=0;var r=P._initMatrix;r.identity();for(var A,y,M=P._tempMatrix,N=0,w=i.length;N<w;N++)switch((A=i[N]).cmdID){case s.a.ID:case O.a.ID:a.push(r),r=r.clone();break;case g.a.ID:r=a.pop();break;case T.a.ID:M.identity(),M.translate(-A.pivotX,-A.pivotY),M.scale(A.scaleX,A.scaleY),M.translate(A.pivotX,A.pivotY),this._switchMatrix(r,M);break;case v.a.ID:M.identity(),M.translate(-A.pivotX,-A.pivotY),M.rotate(A.angle),M.translate(A.pivotX,A.pivotY),this._switchMatrix(r,M);break;case S.a.ID:M.identity(),M.translate(A.tx,A.ty),this._switchMatrix(r,M);break;case E.a.ID:M.identity(),M.translate(-A.pivotX,-A.pivotY),M.concat(A.matrix),M.translate(A.pivotX,A.pivotY),this._switchMatrix(r,M);break;case l.a.ID:case p.a.ID:P._addPointArrToRst(e,I.a._getBoundPointS(A.x,A.y,A.width,A.height),r);break;case m.a.ID:r.copyTo(M),A.matrix&&M.concat(A.matrix),P._addPointArrToRst(e,I.a._getBoundPointS(A.x,A.y,A.width,A.height),M);break;case l.a.ID:if(y=A.texture,t)A.width&&A.height?P._addPointArrToRst(e,I.a._getBoundPointS(A.x,A.y,A.width,A.height),r):P._addPointArrToRst(e,I.a._getBoundPointS(A.x,A.y,y.width,y.height),r);else{var B=(A.width||y.sourceWidth)/y.width,F=(A.height||y.sourceHeight)/y.height,V=B*y.sourceWidth,U=F*y.sourceHeight,G=y.offsetX>0?y.offsetX:0,H=y.offsetY>0?y.offsetY:0;G*=B,H*=F,P._addPointArrToRst(e,I.a._getBoundPointS(A.x-G,A.y-H,V,U),r)}break;case p.a.ID:A.width&&A.height?P._addPointArrToRst(e,I.a._getBoundPointS(A.x,A.y,A.width,A.height),r):(y=A.texture,P._addPointArrToRst(e,I.a._getBoundPointS(A.x,A.y,y.width,y.height),r));break;case m.a.ID:var z;A.matrix?(r.copyTo(M),M.concat(A.matrix),z=M):z=r,t?A.width&&A.height?P._addPointArrToRst(e,I.a._getBoundPointS(A.x,A.y,A.width,A.height),z):(y=A.texture,P._addPointArrToRst(e,I.a._getBoundPointS(A.x,A.y,y.width,y.height),z)):(y=A.texture,B=(A.width||y.sourceWidth)/y.width,F=(A.height||y.sourceHeight)/y.height,V=B*y.sourceWidth,U=F*y.sourceHeight,G=y.offsetX>0?y.offsetX:0,H=y.offsetY>0?y.offsetY:0,G*=B,H*=F,P._addPointArrToRst(e,I.a._getBoundPointS(A.x-G,A.y-H,V,U),z));break;case f.a.ID:P._addPointArrToRst(e,I.a._getBoundPointS(A.x,A.y,A.width,A.height),r);break;case n.a.ID:P._addPointArrToRst(e,I.a._getBoundPointS(A.x-A.radius,A.y-A.radius,A.radius+A.radius,A.radius+A.radius),r);break;case h.a.ID:var k;P._tempPoints.length=0,k=.5*A.lineWidth,A.fromX==A.toX?P._tempPoints.push(A.fromX+k,A.fromY,A.toX+k,A.toY,A.fromX-k,A.fromY,A.toX-k,A.toY):A.fromY==A.toY?P._tempPoints.push(A.fromX,A.fromY+k,A.toX,A.toY+k,A.fromX,A.fromY-k,A.toX,A.toY-k):P._tempPoints.push(A.fromX,A.fromY,A.toX,A.toY),P._addPointArrToRst(e,P._tempPoints,r);break;case o.a.ID:P._addPointArrToRst(e,R.a.I.getBezierPoints(A.points),r,A.x,A.y);break;case _.a.ID:case u.a.ID:P._addPointArrToRst(e,A.points,r,A.x,A.y);break;case c.a.ID:P._addPointArrToRst(e,this._getPathPoints(A.paths),r,A.x,A.y);break;case d.a.ID:P._addPointArrToRst(e,this._getPiePoints(A.x,A.y,A.radius,A.startAngle,A.endAngle),r);break;case b.a.ID:P._addPointArrToRst(e,this._getTriAngBBXPoints(A.vertices),r);break;case L.a.ID:P._addPointArrToRst(e,this._getDraw9GridBBXPoints(A),r)}return e.length>200?e=D.a.copyArray(e,I.a._getWrapRec(e)._getBoundPoints()):e.length>8&&(e=x.a.scanPList(e)),e}_switchMatrix(t,e){e.concat(t),e.copyTo(t)}static _addPointArrToRst(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;var s,n;for(n=e.length,s=0;s<n;s+=2)P._addPointToRst(t,e[s]+a,e[s+1]+r,i)}static _addPointToRst(t,e,i,a){var r=y.a.TEMP;r.setTo(e||0,i||0),a.transformPoint(r),t.push(r.x,r.y)}_getPiePoints(t,e,i,a,r){var s=P._tempPoints;P._tempPoints.length=0;var n=Math.PI/180,o=r-a;if(o>=360||o<=-360)return s.push(t-i,e-i),s.push(t+i,e-i),s.push(t+i,e+i),s.push(t-i,e+i),s;s.push(t,e);var l=o%360;l<0&&(l+=360);var h=a+l,_=a*n,c=h*n;s.push(t+i*Math.cos(_),e+i*Math.sin(_)),s.push(t+i*Math.cos(c),e+i*Math.sin(c));for(var d=90*Math.ceil(a/90),u=90*Math.floor(h/90),f=d;f<=u;f+=90){var m=f*n;s.push(t+i*Math.cos(m),e+i*Math.sin(m))}return s}_getTriAngBBXPoints(t){var e=t.length;if(e<2)return[];for(var i=t[0],a=t[1],r=i,s=a,n=2;n<e;){var o=t[n++],l=t[n++];i>o&&(i=o),a>l&&(a=l),r<o&&(r=o),s<l&&(s=l)}return[i,a,r,a,r,s,i,s]}_getDraw9GridBBXPoints(t){var e=t.width,i=t.height;return[0,0,e,0,e,i,0,i]}_getPathPoints(t){var e,i,a,r=P._tempPoints;for(r.length=0,i=t.length,e=0;e<i;e++)(a=t[e]).length>1&&(r.push(a[1],a[2]),a.length>3&&r.push(a[3],a[4]));return r}}e.a=P,r()(P,"_tempMatrix",new A.a),r()(P,"_initMatrix",new A.a),r()(P,"_tempPoints",[]),r()(P,"_tempMatrixArrays",[]),r()(P,"_tempCmds",[])},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){r()(this,"alpha",void 0)}static create(t){var e=s.a.getItemByClass("AlphaCmd",n);return e.alpha=t,e}recover(){s.a.recover("AlphaCmd",this)}run(t,e,i){t.alpha(this.alpha)}get cmdID(){return n.ID}}e.a=n,r()(n,"ID","Alpha")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"radius",void 0),r()(this,"fillColor",void 0),r()(this,"lineColor",void 0),r()(this,"lineWidth",void 0),r()(this,"vid",void 0)}static create(t,e,i,a,r,o,l){var h=s.a.getItemByClass("DrawCircleCmd",n);return h.x=t,h.y=e,h.radius=i,h.fillColor=a,h.lineColor=r,h.lineWidth=o,h.vid=l,h}recover(){this.fillColor=null,this.lineColor=null,s.a.recover("DrawCircleCmd",this)}run(t,e,i){t._drawCircle(this.x+e,this.y+i,this.radius,this.fillColor,this.lineColor,this.lineWidth,this.vid)}get cmdID(){return n.ID}}e.a=n,r()(n,"ID","DrawCircle")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"points",void 0),r()(this,"lineColor",void 0),r()(this,"lineWidth",void 0)}static create(t,e,i,a,r){var o=s.a.getItemByClass("DrawCurvesCmd",n);return o.x=t,o.y=e,o.points=i,o.lineColor=a,o.lineWidth=r,o}recover(){this.points=null,this.lineColor=null,s.a.recover("DrawCurvesCmd",this)}run(t,e,i){this.points&&t.drawCurves(this.x+e,this.y+i,this.points,this.lineColor,this.lineWidth)}get cmdID(){return n.ID}}e.a=n,r()(n,"ID","DrawCurves")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){r()(this,"texture",void 0),r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"width",void 0),r()(this,"height",void 0)}static create(t,e,i,a,r){var o=s.a.getItemByClass("DrawImageCmd",n);return o.texture=t,t._addReference(),o.x=e,o.y=i,o.width=a,o.height=r,o}recover(){this.texture&&this.texture._removeReference(),this.texture=null,s.a.recover("DrawImageCmd",this)}run(t,e,i){this.texture&&t.drawTexture(this.texture,this.x+e,this.y+i,this.width,this.height)}get cmdID(){return n.ID}}e.a=n,r()(n,"ID","DrawImage")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){r()(this,"fromX",void 0),r()(this,"fromY",void 0),r()(this,"toX",void 0),r()(this,"toY",void 0),r()(this,"lineColor",void 0),r()(this,"lineWidth",void 0),r()(this,"vid",void 0)}static create(t,e,i,a,r,o,l){var h=s.a.getItemByClass("DrawLineCmd",n);return h.fromX=t,h.fromY=e,h.toX=i,h.toY=a,h.lineColor=r,h.lineWidth=o,h.vid=l,h}recover(){s.a.recover("DrawLineCmd",this)}run(t,e,i){t._drawLine(e,i,this.fromX,this.fromY,this.toX,this.toY,this.lineColor,this.lineWidth,this.vid)}get cmdID(){return n.ID}}e.a=n,r()(n,"ID","DrawLine")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"points",void 0),r()(this,"lineColor",void 0),r()(this,"lineWidth",void 0),r()(this,"vid",void 0)}static create(t,e,i,a,r,o){var l=s.a.getItemByClass("DrawLinesCmd",n);return l.x=t,l.y=e,l.points=i,l.lineColor=a,l.lineWidth=r,l.vid=o,l}recover(){this.points=null,this.lineColor=null,s.a.recover("DrawLinesCmd",this)}run(t,e,i){this.points&&t._drawLines(this.x+e,this.y+i,this.points,this.lineColor,this.lineWidth,this.vid)}get cmdID(){return n.ID}}e.a=n,r()(n,"ID","DrawLines")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"paths",void 0),r()(this,"brush",void 0),r()(this,"pen",void 0)}static create(t,e,i,a,r){var o=s.a.getItemByClass("DrawPathCmd",n);return o.x=t,o.y=e,o.paths=i,o.brush=a,o.pen=r,o}recover(){this.paths=null,this.brush=null,this.pen=null,s.a.recover("DrawPathCmd",this)}run(t,e,i){this.paths&&t._drawPath(this.x+e,this.y+i,this.paths,this.brush,this.pen)}get cmdID(){return n.ID}}e.a=n,r()(n,"ID","DrawPath")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"radius",void 0),r()(this,"_startAngle",void 0),r()(this,"_endAngle",void 0),r()(this,"fillColor",void 0),r()(this,"lineColor",void 0),r()(this,"lineWidth",void 0),r()(this,"vid",void 0)}static create(t,e,i,a,r,o,l,h,_){var c=s.a.getItemByClass("DrawPieCmd",n);return c.x=t,c.y=e,c.radius=i,c._startAngle=a,c._endAngle=r,c.fillColor=o,c.lineColor=l,c.lineWidth=h,c.vid=_,c}recover(){this.fillColor=null,this.lineColor=null,s.a.recover("DrawPieCmd",this)}run(t,e,i){t._drawPie(this.x+e,this.y+i,this.radius,this._startAngle,this._endAngle,this.fillColor,this.lineColor,this.lineWidth,this.vid)}get cmdID(){return n.ID}get startAngle(){return 180*this._startAngle/Math.PI}set startAngle(t){this._startAngle=t*Math.PI/180}get endAngle(){return 180*this._endAngle/Math.PI}set endAngle(t){this._endAngle=t*Math.PI/180}}e.a=n,r()(n,"ID","DrawPie")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"points",void 0),r()(this,"fillColor",void 0),r()(this,"lineColor",void 0),r()(this,"lineWidth",void 0),r()(this,"isConvexPolygon",void 0),r()(this,"vid",void 0)}static create(t,e,i,a,r,o,l,h){var _=s.a.getItemByClass("DrawPolyCmd",n);return _.x=t,_.y=e,_.points=i,_.fillColor=a,_.lineColor=r,_.lineWidth=o,_.isConvexPolygon=l,_.vid=h,_}recover(){this.points=null,this.fillColor=null,this.lineColor=null,s.a.recover("DrawPolyCmd",this)}run(t,e,i){this.points&&t._drawPoly(this.x+e,this.y+i,this.points,this.fillColor,this.lineColor,this.lineWidth,this.isConvexPolygon,this.vid)}get cmdID(){return n.ID}}e.a=n,r()(n,"ID","DrawPoly")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"width",void 0),r()(this,"height",void 0),r()(this,"fillColor",void 0),r()(this,"lineColor",void 0),r()(this,"lineWidth",void 0)}static create(t,e,i,a,r,o,l){var h=s.a.getItemByClass("DrawRectCmd",n);return h.x=t,h.y=e,h.width=i,h.height=a,h.fillColor=r,h.lineColor=o,h.lineWidth=l,h}recover(){this.fillColor=null,this.lineColor=null,s.a.recover("DrawRectCmd",this)}run(t,e,i){t.drawRect(this.x+e,this.y+i,this.width,this.height,this.fillColor,this.lineColor,this.lineWidth)}get cmdID(){return n.ID}}e.a=n,r()(n,"ID","DrawRect")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(147),n=i(4);class o{constructor(){r()(this,"texture",void 0),r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"width",void 0),r()(this,"height",void 0),r()(this,"matrix",void 0),r()(this,"alpha",void 0),r()(this,"color",void 0),r()(this,"colorFlt",null),r()(this,"blendMode",void 0),r()(this,"uv",null)}static create(t,e,i,a,r,l,h,_,c,d){var u=n.a.getItemByClass("DrawTextureCmd",o);return u.texture=t,t._addReference(),u.x=e,u.y=i,u.width=a,u.height=r,u.matrix=l,u.alpha=h,u.color=_,u.blendMode=c,u.uv=void 0==d?null:d,_&&(u.colorFlt=new s.a,u.colorFlt.setColor(_)),u}recover(){this.texture&&this.texture._removeReference(),this.texture=null,this.matrix=null,n.a.recover("DrawTextureCmd",this)}run(t,e,i){this.texture&&t.drawTextureWithTransform(this.texture,this.x,this.y,this.width,this.height,this.matrix,e,i,this.alpha,this.blendMode,this.colorFlt,this.uv)}get cmdID(){return o.ID}}e.a=o,r()(o,"ID","DrawTexture")},function(t,e,i){var a=i(77),r=i(151),s=i(35)("match");t.exports=function(t){var e;return a(t)&&(void 0!==(e=t[s])?!!e:"RegExp"==r(t))}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(108),n=i(47);class o{static getRT(t,e){return e|=0,(t|=0)>=1e4&&console.error("getRT error! w too big"),new s.a(t,e,n.b.R8G8B8A8,-1)}static releaseRT(t){t.destroy()}}e.a=o,r()(o,"dict",{})},function(t,e,i){var a=i(89),r=i(117),s=i(323)(!1),n=i(154)("IE_PROTO");t.exports=function(t,e){var i,o=r(t),l=0,h=[];for(i in o)i!=n&&a(o,i)&&h.push(i);for(;e.length>l;)a(o,i=e[l++])&&(~s(h,i)||h.push(i));return h}},function(t,e,i){i(45)&&"g"!=/./g.flags&&i(76).f(RegExp.prototype,"flags",{configurable:!0,get:i(113)})},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){r()(this,"texture",void 0),r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"width",void 0),r()(this,"height",void 0),r()(this,"type",void 0),r()(this,"offset",void 0),r()(this,"other",void 0)}static create(t,e,i,a,r,o,l,h){var _=s.a.getItemByClass("FillTextureCmd",n);return _.texture=t,_.x=e,_.y=i,_.width=a,_.height=r,_.type=o,_.offset=l,_.other=h,_}recover(){this.texture=null,this.offset=null,this.other=null,s.a.recover("FillTextureCmd",this)}run(t,e,i){t.fillTexture(this.texture,this.x+e,this.y+i,this.width,this.height,this.type,this.offset,this.other)}get cmdID(){return n.ID}}e.a=n,r()(n,"ID","FillTexture")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{static create(){return s.a.getItemByClass("RestoreCmd",n)}recover(){s.a.recover("RestoreCmd",this)}run(t,e,i){t.restore()}get cmdID(){return n.ID}}e.a=n,r()(n,"ID","Restore")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){r()(this,"angle",void 0),r()(this,"pivotX",void 0),r()(this,"pivotY",void 0)}static create(t,e,i){var a=s.a.getItemByClass("RotateCmd",n);return a.angle=t,a.pivotX=e,a.pivotY=i,a}recover(){s.a.recover("RotateCmd",this)}run(t,e,i){t._rotate(this.angle,this.pivotX+e,this.pivotY+i)}get cmdID(){return n.ID}}e.a=n,r()(n,"ID","Rotate")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){r()(this,"scaleX",void 0),r()(this,"scaleY",void 0),r()(this,"pivotX",void 0),r()(this,"pivotY",void 0)}static create(t,e,i,a){var r=s.a.getItemByClass("ScaleCmd",n);return r.scaleX=t,r.scaleY=e,r.pivotX=i,r.pivotY=a,r}recover(){s.a.recover("ScaleCmd",this)}run(t,e,i){t._scale(this.scaleX,this.scaleY,this.pivotX+e,this.pivotY+i)}get cmdID(){return n.ID}}e.a=n,r()(n,"ID","Scale")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){r()(this,"matrix",void 0),r()(this,"pivotX",void 0),r()(this,"pivotY",void 0)}static create(t,e,i){var a=s.a.getItemByClass("TransformCmd",n);return a.matrix=t,a.pivotX=e,a.pivotY=i,a}recover(){this.matrix=null,s.a.recover("TransformCmd",this)}run(t,e,i){t._transform(this.matrix,this.pivotX+e,this.pivotY+i)}get cmdID(){return n.ID}}e.a=n,r()(n,"ID","Transform")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){r()(this,"tx",void 0),r()(this,"ty",void 0)}static create(t,e){var i=s.a.getItemByClass("TranslateCmd",n);return i.tx=t,i.ty=e,i}recover(){s.a.recover("TranslateCmd",this)}run(t,e,i){t.translate(this.tx,this.ty)}get cmdID(){return n.ID}}e.a=n,r()(n,"ID","Translate")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(16);class n{constructor(){r()(this,"_controlPoints",[new s.a,new s.a,new s.a]),r()(this,"_calFun",this.getPoint2)}_switchPoint(t,e){var i=this._controlPoints.shift();i.setTo(t,e),this._controlPoints.push(i)}getPoint2(t,e){var i=this._controlPoints[0],a=this._controlPoints[1],r=this._controlPoints[2],s=Math.pow(1-t,2)*i.x+2*t*(1-t)*a.x+Math.pow(t,2)*r.x,n=Math.pow(1-t,2)*i.y+2*t*(1-t)*a.y+Math.pow(t,2)*r.y;e.push(s,n)}getPoint3(t,e){var i=this._controlPoints[0],a=this._controlPoints[1],r=this._controlPoints[2],s=this._controlPoints[3],n=Math.pow(1-t,3)*i.x+3*a.x*t*(1-t)*(1-t)+3*r.x*t*t*(1-t)+s.x*Math.pow(t,3),o=Math.pow(1-t,3)*i.y+3*a.y*t*(1-t)*(1-t)+3*r.y*t*t*(1-t)+s.y*Math.pow(t,3);e.push(n,o)}insertPoints(t,e){var i,a;for(a=1/(t=t>0?t:5),i=0;i<=1;i+=a)this._calFun(i,e)}getBezierPoints(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;var a,r;if((r=t.length)<2*(i+1))return[];var n=[];switch(i){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=i;)this._controlPoints.push(s.a.create());for(a=0;a<2*i;a+=2)this._switchPoint(t[a],t[a+1]);for(a=2*i;a<r;a+=2)this._switchPoint(t[a],t[a+1]),a/2%i==0&&this.insertPoints(e,n);return n}}e.a=n,r()(n,"I",new n)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(16),n=i(21);class o{static multiply(t,e,i){return(t.x-i.x)*(e.y-i.y)-(e.x-i.x)*(t.y-i.y)}static dis(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)}static _getPoints(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;for(o._mPointList||(o._mPointList=[]);o._mPointList.length<t;)o._mPointList.push(new s.a);return i||(i=[]),i.length=0,e?o.getFrom(i,o._mPointList,t):o.getFromR(i,o._mPointList,t),i}static getFrom(t,e,i){var a;for(a=0;a<i;a++)t.push(e[a]);return t}static getFromR(t,e,i){var a;for(a=0;a<i;a++)t.push(e.pop());return t}static pListToPointList(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var i,a=t.length/2,r=o._getPoints(a,e,o._tempPointList);for(i=0;i<a;i++)r[i].setTo(t[i+i],t[i+i+1]);return r}static pointListToPlist(t){var e,i,a=t.length,r=o._temPList;for(r.length=0,e=0;e<a;e++)i=t[e],r.push(i.x,i.y);return r}static scanPList(t){return n.a.copyArray(t,o.pointListToPlist(o.scan(o.pListToPointList(t,!0))))}static scan(t){var e,i,a,r,s,l=0,h=t.length,_={};for((r=o._temArr).length=0,e=(h=t.length)-1;e>=0;e--)(s=(a=t[e]).x+"_"+a.y)in _||(_[s]=!0,r.push(a));for(h=r.length,n.a.copyArray(t,r),e=1;e<h;e++)(t[e].y<t[l].y||t[e].y==t[l].y&&t[e].x<t[l].x)&&(l=e);for(a=t[0],t[0]=t[l],t[l]=a,e=1;e<h-1;e++){for(l=e,i=e+1;i<h;i++)(o.multiply(t[i],t[l],t[0])>0||0==o.multiply(t[i],t[l],t[0])&&o.dis(t[0],t[i])<o.dis(t[0],t[l]))&&(l=i);a=t[e],t[e]=t[l],t[l]=a}if((r=o._temArr).length=0,t.length<3)return n.a.copyArray(r,t);for(r.push(t[0],t[1],t[2]),e=3;e<h;e++){for(;r.length>=2&&o.multiply(t[e],r[r.length-1],r[r.length-2])>=0;)r.pop();t[e]&&r.push(t[e])}return r}}e.a=o,r()(o,"_mPointList",void 0),r()(o,"_tempPointList",[]),r()(o,"_temPList",[]),r()(o,"_temArr",[])},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(68);class n{static create(t){if(t){var e=t instanceof s.a?t:s.a.create(t);return e._drawStyle||(e._drawStyle=new n(t))}return n.DEFAULT}constructor(t){r()(this,"_color",void 0),this.setValue(t)}setValue(t){this._color=t?t instanceof s.a?t:s.a.create(t):s.a.create("#000000")}reset(){this._color=s.a.create("#000000")}toInt(){return this._color.numColor}equal(t){return"string"==typeof t?this._color.strColor===t:t instanceof s.a&&this._color.numColor===t.numColor}toColorStr(){return this._color.strColor}}e.a=n,r()(n,"DEFAULT",new n("#000000"))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(15),n=i(61),o=i(156),l=i(159),h=i(160);class _{constructor(t,e){r()(this,"submitStartPos",0),r()(this,"submitEndPos",0),r()(this,"context",void 0),r()(this,"touches",[]),r()(this,"submits",[]),r()(this,"sprite",null),r()(this,"_mesh",void 0),r()(this,"_pathMesh",void 0),r()(this,"_triangleMesh",void 0),r()(this,"meshlist",[]),r()(this,"_oldMesh",void 0),r()(this,"_oldPathMesh",void 0),r()(this,"_oldTriMesh",void 0),r()(this,"_oldMeshList",void 0),r()(this,"cachedClipInfo",new s.a),r()(this,"oldTx",0),r()(this,"oldTy",0),r()(this,"invMat",new s.a),this.context=t,this.sprite=e,t._globalClipMatrix.copyTo(this.cachedClipInfo)}startRec(){let t=this.context;t._charSubmitCache&&t._charSubmitCache._enable&&(t._charSubmitCache.enable(!1,t),t._charSubmitCache.enable(!0,t)),t._incache=!0,this.touches.length=0,t.touches=this.touches,t._globalClipMatrix.copyTo(this.cachedClipInfo),this.submits.length=0,this.submitStartPos=t._submits._length;for(var e=0,i=this.meshlist.length;e<i;e++){var a=this.meshlist[e];a.canReuse?a.releaseMesh():a.destroy()}this.meshlist.length=0,this._mesh=o.a.getAMesh(!1),this._pathMesh=h.a.getAMesh(!1),this._triangleMesh=l.a.getAMesh(!1),this.meshlist.push(this._mesh),this.meshlist.push(this._pathMesh),this.meshlist.push(this._triangleMesh),t._curSubmit=n.a.RENDERBASE,this._oldMesh=t._mesh,this._oldPathMesh=t._pathMesh,this._oldTriMesh=t._triangleMesh,this._oldMeshList=t.meshlist,t._mesh=this._mesh,t._pathMesh=this._pathMesh,t._triangleMesh=this._triangleMesh,t.meshlist=this.meshlist,this.oldTx=t._curMat.tx,this.oldTy=t._curMat.ty,t._curMat.tx=0,t._curMat.ty=0,t._curMat.copyTo(this.invMat),this.invMat.invert()}endRec(){let t=this.context;t._charSubmitCache&&t._charSubmitCache._enable&&(t._charSubmitCache.enable(!1,t),t._charSubmitCache.enable(!0,t));var e=t._submits;this.submitEndPos=e._length;for(var i=this.submitEndPos-this.submitStartPos,a=0;a<i;a++)this.submits.push(e[this.submitStartPos+a]);e._length-=i,t._mesh=this._oldMesh,t._pathMesh=this._oldPathMesh,t._triangleMesh=this._oldTriMesh,t.meshlist=this._oldMeshList,t._curSubmit=n.a.RENDERBASE,t._curMat.tx=this.oldTx,t._curMat.ty=this.oldTy,t.touches=null,t._incache=!1}isCacheValid(){var t=this.context._globalClipMatrix;return t.a==this.cachedClipInfo.a&&t.b==this.cachedClipInfo.b&&t.c==this.cachedClipInfo.c&&t.d==this.cachedClipInfo.d&&t.tx==this.cachedClipInfo.tx&&t.ty==this.cachedClipInfo.ty}flushsubmit(){var t=n.a.RENDERBASE;this.submits.forEach(function(e){e!=n.a.RENDERBASE&&(n.a.preRender=t,t=e,e.renderSubmit())})}releaseMem(){}}e.a=_,r()(_,"matI",new s.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(95),o=i(158);class l extends o.a{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:35044;super(),r()(this,"_uint16Array",void 0),this._bufferUsage=t,this._bufferType=s.a.instance.ELEMENT_ARRAY_BUFFER,this._buffer=new ArrayBuffer(8)}_checkArrayUse(){this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))}getUint16Array(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))}_bindForVAO(){var t=s.a.instance;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._glBuffer)}bind(){if(n.a._bindedIndexBuffer!==this._glBuffer){var t=s.a.instance;return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._glBuffer),n.a._bindedIndexBuffer=this._glBuffer,!0}return!1}destory(){this._uint16Array=null,this._buffer=null}disposeResource(){this._disposeResource()}}e.a=l,r()(l,"create",function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:35044;return new l(t)})},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(158),n=i(2),o=i(95);class l extends s.a{get vertexStride(){return this._vertexStride}constructor(t,e){super(),r()(this,"_floatArray32",void 0),r()(this,"_uint32Array",void 0),r()(this,"_vertexStride",void 0),this._vertexStride=t,this._bufferUsage=e,this._bufferType=n.a.instance.ARRAY_BUFFER,this._buffer=new ArrayBuffer(8),this._floatArray32=new Float32Array(this._buffer),this._uint32Array=new Uint32Array(this._buffer)}getFloat32Array(){return this._floatArray32}appendArray(t){var e=this._byteLength>>2;this.setByteLength(this._byteLength+4*t.length),this.getFloat32Array().set(t,e),this._upload=!0}_checkArrayUse(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer)),this._uint32Array&&(this._uint32Array=new Uint32Array(this._buffer))}deleteBuffer(){super._disposeResource()}_bindForVAO(){var t=n.a.instance;t.bindBuffer(t.ARRAY_BUFFER,this._glBuffer)}bind(){if(o.a._bindedVertexBuffer!==this._glBuffer){var t=n.a.instance;return t.bindBuffer(t.ARRAY_BUFFER,this._glBuffer),o.a._bindedVertexBuffer=this._glBuffer,!0}return!1}destroy(){super.destroy(),this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null}}e.a=l,r()(l,"create",function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:35048;return new l(t,e)})},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(29),n=i(223),o=i(92),l=i(334),h=i(335),_=i(336),c=i(337),d=i(338),u=i(339);e.a=class{constructor(){r()(this,"ALPHA",1),r()(this,"shader",void 0),r()(this,"filters",void 0),r()(this,"defines",new s.a),r()(this,"shaderType",0),r()(this,"colorAdd",void 0),r()(this,"fillStyle",n.a.DEFAULT),r()(this,"strokeStyle",n.a.DEFAULT)}destroy(){this.defines=null,this.filters=null}static __init__(){o.a.preCompile2D(0,s.a.TEXTURE2D,l.a,h.a,null),o.a.preCompile2D(0,s.a.PRIMITIVE,_.a,c.a,null),o.a.preCompile2D(0,s.a.SKINMESH,d.a,u.a,null)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(8),n=i(67),o=i(96),l=i(10),h=i(61);class _ extends h.a{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.a.TYPE_2D)}renderSubmit(){if(0===this._numEle||!this._mesh||0==this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t._getSource();if(!e)return 1;this.shaderValue.texture=e}var i=l.a.mainContext;return this._mesh.useMesh(i),this.shaderValue.upload(),n.a.activeBlendFunction!==this._blendFn&&(l.a.setBlend(i,!0),this._blendFn(i),n.a.activeBlendFunction=this._blendFn),i.drawElements(i.TRIANGLES,this._numEle,i.UNSIGNED_SHORT,this._startIdx),s.a.renderBatches++,s.a.trianglesFaces+=this._numEle/3,1}releaseRender(){h.a.RENDERBASE!=this&&--this._ref<1&&(_.POOL[_._poolSize++]=this,this.shaderValue.release(),this.shaderValue=null,this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))}static create(t,e,i){var a=_._poolSize?_.POOL[--_._poolSize]:new _;a._ref=1,a._mesh=e,a._key.clear(),a._startIdx=e.indexNum*o.a.BYTES_PIDX,a._numEle=0;var r=t._nBlendType;a._blendFn=t._targets?n.a.targetFns[r]:n.a.fns[r],a.shaderValue=i,a.shaderValue.setValue(t._shader2D);var s=t._shader2D.filters;return s&&a.shaderValue.setFilters(s),a}static createShape(t,e,i,a){var r=_._poolSize?_.POOL[--_._poolSize]:new _;r._mesh=e,r._numEle=i,r._startIdx=2*e.indexNum,r._ref=1,r.shaderValue=a,r.shaderValue.setValue(t._shader2D);var s=t._nBlendType;return r._key.blendShader=s,r._blendFn=t._targets?n.a.targetFns[s]:n.a.fns[s],r}}e.a=_,r()(_,"_poolSize",0),r()(_,"POOL",[])},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(61),n=i(8),o=i(10),l=i(67),h=i(91),_=i(29),c=i(96);class d extends s.a{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.a.TYPE_2D)}releaseRender(){--this._ref<1&&(d.POOL[d._poolSize++]=this,this.shaderValue.release(),this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))}renderSubmit(){if(0===this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t?t._getSource():null;if(!e)return 1}var i=o.a.mainContext;this._mesh.useMesh(i);var a=s.a.preRender,r=s.a.preRender._key;return 0===this._key.blendShader&&this._key.submitType===r.submitType&&this._key.blendShader===r.blendShader&&h.a.activeShader&&s.a.preRender.clipInfoID==this.clipInfoID&&a.shaderValue.defines._value===this.shaderValue.defines._value&&0==(this.shaderValue.defines._value&_.a.NOOPTMASK)?h.a.activeShader.uploadTexture2D(e):(l.a.activeBlendFunction!==this._blendFn&&(o.a.setBlend(i,!0),this._blendFn(i),l.a.activeBlendFunction=this._blendFn),this.shaderValue.texture=e,this.shaderValue.upload()),i.drawElements(i.TRIANGLES,this._numEle,i.UNSIGNED_SHORT,this._startIdx),n.a.renderBatches++,n.a.trianglesFaces+=this._numEle/3,1}static create(t,e,i){var a=d._poolSize?d.POOL[--d._poolSize]:new d(s.a.TYPE_TEXTURE);a._mesh=e,a._key.clear(),a._key.submitType=s.a.KEY_DRAWTEXTURE,a._ref=1,a._startIdx=e.indexNum*c.a.BYTES_PIDX,a._numEle=0;var r=t._nBlendType;if(a._key.blendShader=r,a._blendFn=t._targets?l.a.targetFns[r]:l.a.fns[r],a.shaderValue=i,t._colorFiler){var n=t._colorFiler;i.defines.add(n.type),i.colorMat=n._mat,i.colorAlpha=n._alpha}return a}}e.a=d,r()(d,"_poolSize",0),r()(d,"POOL",[])},function(t,e,i){"use strict";var a=i(118),r=(i.n(a),i(28)),s=(i.n(r),i(0)),n=i.n(s),o=i(347),l=i(231),h=i(16),_=i(83),c=i(48),d=i(232),u=i(161),f=i(349),m=i(350),p=i(351),g=i(3);class v{constructor(){n()(this,"fontSizeInfo",{}),n()(this,"charRender",void 0),n()(this,"mapFont",{}),n()(this,"fontID",0),n()(this,"mapColor",[]),n()(this,"colorID",0),n()(this,"fontScaleX",1),n()(this,"fontScaleY",1),n()(this,"_curStrPos",0),n()(this,"textAtlases",[]),n()(this,"isoTextures",[]),n()(this,"bmpData32",void 0),n()(this,"lastFont",null),n()(this,"fontSizeW",0),n()(this,"fontSizeH",0),n()(this,"fontSizeOffX",0),n()(this,"fontSizeOffY",0),n()(this,"renderPerChar",!0),n()(this,"tmpAtlasPos",new h.a),n()(this,"textureMem",0),n()(this,"fontStr",void 0),g.a.TextAtlas=o.a;var t=!1,e=g.a.Laya.MiniAdpter;e&&e.systemInfo&&e.systemInfo.system&&(t="ios 10.1.1"===e.systemInfo.system.toLowerCase()),(g.a.Browser.onMiniGame||g.a.Browser.onTTMiniGame||g.a.Browser.onBLMiniGame||g.a.Browser.onAlipayMiniGame||g.a.Browser.onTBMiniGame)&&!t&&(v.isWan1Wan=!0),this.charRender=g.a.Render.isConchApp?new p.a:new m.a(2048,2048,v.scaleFontWithCtx,!v.isWan1Wan,!1),v.textRenderInst=this,g.a.Laya.textRender=this,v.atlasWidth2=v.atlasWidth*v.atlasWidth}setFont(t){if(this.lastFont!=t){this.lastFont=t;var e=this.getFontSizeInfo(t._family),i=e>>24,a=e>>16&255,r=e>>8&255,s=255&e,n=t._size/v.standardFontSize;this.fontSizeOffX=Math.ceil(i*n),this.fontSizeOffY=Math.ceil(a*n),this.fontSizeW=Math.ceil(r*n),this.fontSizeH=Math.ceil(s*n),t._font.indexOf("italic")>=0?this.fontStr=t._font.replace("italic",""):this.fontStr=t._font}}getNextChar(t){var e=t.length,i=this._curStrPos;if(!t.substring)return null;if(i>=e)return null;for(var a=i,r=0;a<e;a++){var s=t.charCodeAt(a);if(s>>>11==27){if(1==r)break;r=1,a++}else if(65038===s||65039===s);else if(8205==s)r=2;else if(0==r)r=1;else if(1==r)break}return this._curStrPos=a,t.substring(i,a)}filltext(t,e,i,a,r,s,n,o,l){let h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;if(!(e.length<=0)){var _=d.a.Parse(r),c=0;switch(l){case"center":c=g.a.Context.ENUM_TEXTALIGN_CENTER;break;case"right":c=g.a.Context.ENUM_TEXTALIGN_RIGHT}this._fast_filltext(t,e,null,i,a,_,s,n,o,c,h)}}fillWords(t,e,i,a,r,s,n,o){if(e&&!(e.length<=0)){var l="string"==typeof r?d.a.Parse(r):r;this._fast_filltext(t,null,e,i,a,l,s,n,o,0,0)}}_fast_filltext(t,e,i,a,r,s,n,o,l,h){arguments.length>10&&void 0!==arguments[10]&&arguments[10];if((!e||e.length>=1)&&!(i&&i.length<1)){if(l<0&&(l=0),this.setFont(s),this.fontScaleX=this.fontScaleY=1,v.scaleFontWithCtx){var _=1,c=1;if(g.a.Render.isConchApp&&!window.conchTextCanvas.scale||(_=t.getMatScaleX(),c=t.getMatScaleY()),_<1e-4||c<.1)return;_>1&&(this.fontScaleX=_),c>1&&(this.fontScaleY=c)}s._italic&&(t._italicDeg=13);var d=e,f=!i&&e instanceof u.a,m=e&&e.toString(),p=!!i,T=f?d.pageChars:[],E=0;switch(f?(m=d._text,(E=d.width)<0&&(E=d.width=this.charRender.getWidth(this.fontStr,m))):E=m?this.charRender.getWidth(this.fontStr,m):0,h){case g.a.Context.ENUM_TEXTALIGN_CENTER:a-=E/2;break;case g.a.Context.ENUM_TEXTALIGN_RIGHT:a-=E}d&&T&&this.hasFreedText(T)&&(T=d.pageChars=[]);var S=null,R=this.renderPerChar=!f||v.forceSplitRender||p||f&&d.splitRender;if(!T||T.length<1)if(f&&(d.scalex=this.fontScaleX,d.scaley=this.fontScaleY),R){var x,A=0,y=0;for(this._curStrPos=0;;){if(i){var I=i[this._curStrPos++];I?(x=I.char,A=I.x,y=I.y):x=null}else x=this.getNextChar(m);if(!x)break;if(!(S=this.getCharRenderInfo(x,s,n,o,l,!1)))break;if(S.isSpace);else{var C=T[S.tex.id];if(C)C=C.words;else{var M={texgen:S.tex.genID,tex:S.tex,words:[]};T[S.tex.id]=M,C=M.words}C.push({ri:S,x:A,y:y,w:S.bmpWidth/this.fontScaleX,h:S.bmpHeight/this.fontScaleY}),A+=S.width}}}else{var D=g.a.Render.isConchApp?0:s._size/3|0,b=v.noAtlas||(E+D+D)*this.fontScaleX>v.atlasWidth;S=this.getCharRenderInfo(m,s,n,o,l,b),T[0]={texgen:S.tex.genID,tex:S.tex,words:[{ri:S,x:0,y:0,w:S.bmpWidth/this.fontScaleX,h:S.bmpHeight/this.fontScaleY}]}}this._drawResortedWords(t,a,r,T),t._italicDeg=0}}_drawResortedWords(t,e,i,a){var r=!!t._charSubmitCache&&t._charSubmitCache._enable,s=t._curMat;a.length;for(var n in a){var o=a[n];if(o){var l=o.words,h=l.length;if(!(h<=0))for(var _=a[n].tex,c=0;c<h;c++){var d=l[c],u=d.ri;if(!u.isSpace){if(u.touch(),t.drawTexAlign=!0,g.a.Render.isConchApp)t._drawTextureM(_.texture,e+d.x-u.orix,i+d.y-u.oriy,d.w,d.h,null,1,u.uv);else{let a=_;t._inner_drawTexture(a.texture,a.id,e+d.x-u.orix,i+d.y-u.oriy,d.w,d.h,s,u.uv,1,r)}t.touches&&t.touches.push(u)}}}}}hasFreedText(t){for(let a in t){var e=t[a];if(e){var i=e.tex;if(i.__destroyed||i.genID!=e.texgen)return!0}}return!1}getCharRenderInfo(t,e,i,a,r){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];var n=this.mapFont[e._family];void 0==n&&(this.mapFont[e._family]=n=this.fontID++);var o=t+"_"+n+"_"+e._size+"_"+i;r>0&&(o+="_"+a+r),e._bold&&(o+="P"),1==this.fontScaleX&&1==this.fontScaleY||(o+=(20*this.fontScaleX|0)+"_"+(20*this.fontScaleY|0));var h,_,c=0,d=this.textAtlases.length;if(!s)for(c=0;c<d;c++)if(h=(_=this.textAtlases[c]).charMaps[o])return h.touch(),h;h=new f.a,this.charRender.scale(this.fontScaleX,this.fontScaleY),h.char=t,h.height=e._size;var u=g.a.Render.isConchApp?0:e._size/3|0,m=null;r||(r=0);var p=Math.ceil((this.charRender.getWidth(this.fontStr,t)+2*r)*this.fontScaleX);if(p>this.charRender.canvasWidth&&(this.charRender.canvasWidth=Math.min(2048,p+2*u)),s){if(this.charRender.fontsz=e._size,m=this.charRender.getCharBmp(t,this.fontStr,r,i,a,h,u,u,u,u,null)){var T=l.a.getTextTexture(m.width,m.height);T.addChar(m,0,0,h.uv),h.tex=T,h.orix=u,h.oriy=u,T.ri=h,this.isoTextures.push(T)}}else{var E=t.length,S=1*r,R=Math.ceil((this.fontSizeW+2*S)*this.fontScaleX),x=Math.ceil((this.fontSizeH+2*S)*this.fontScaleY);v.imgdtRect[0]=(u-this.fontSizeOffX-S)*this.fontScaleX|0,v.imgdtRect[1]=(u-this.fontSizeOffY-S)*this.fontScaleY|0,this.renderPerChar||1==E?(v.imgdtRect[2]=Math.max(p,R),v.imgdtRect[3]=Math.max(p,x)):(v.imgdtRect[2]=-1,v.imgdtRect[3]=x),this.charRender.fontsz=e._size,(m=this.charRender.getCharBmp(t,this.fontStr,r,i,a,h,u,u,u,u,v.imgdtRect))&&(_=this.addBmpData(m,h),v.isWan1Wan?(h.orix=u,h.oriy=u):(h.orix=this.fontSizeOffX+S,h.oriy=this.fontSizeOffY+S),_.charMaps[o]=h)}return h}addBmpData(t,e){for(var i,a=t.width,r=t.height,s=this.textAtlases.length,n=!1,l=0;l<s&&!(n=(i=this.textAtlases[l]).getAEmpty(a,r,this.tmpAtlasPos));l++);if(!n){if(i=new o.a,this.textAtlases.push(i),!(n=i.getAEmpty(a,r,this.tmpAtlasPos)))throw"err1";this.cleanAtlases()}return n&&(i.texture.addChar(t,this.tmpAtlasPos.x,this.tmpAtlasPos.y,e.uv),e.tex=i.texture),i}GC(){for(var t=0,e=this.textAtlases.length,i=v.destroyAtlasDt,a=0,r=_.a.loopCount,s=-1,n=0,o=null,h=null;t<e;t++){if(o=(h=this.textAtlases[t]).texture){o.curUsedCovRate,a+=o.curUsedCovRateAtlas;var c=h.usedRate-o.curUsedCovRateAtlas;n<c&&(n=c,s=t)}r-h.texture.lastTouchTm>i&&(v.showLog&&console.log(h.texture.id),h.destroy(),this.textAtlases[t]=this.textAtlases[e-1],e--,t--,s=-1)}for(this.textAtlases.length=e,e=this.isoTextures.length,t=0;t<e;t++)r-(o=this.isoTextures[t]).lastTouchTm>v.destroyUnusedTextureDt&&(o.ri.deleted=!0,o.ri.tex=null,o.destroy(),this.isoTextures[t]=this.isoTextures[e-1],e--,t--);this.isoTextures.length=e;var d=this.textAtlases.length>1&&this.textAtlases.length-a>=2;(v.atlasWidth*v.atlasWidth*4*this.textAtlases.length>v.cleanMem||d||v.simClean)&&(v.simClean=!1,v.showLog&&console.log("清理使用率低的贴图。总使用率:",a,":",this.textAtlases.length,"最差贴图:"+s),s>=0&&((h=this.textAtlases[s]).destroy(),this.textAtlases[s]=this.textAtlases[this.textAtlases.length-1],this.textAtlases.length=this.textAtlases.length-1)),l.a.clean()}cleanAtlases(){}getCharBmp(t){}checkBmpLine(t,e,i,a){this.bmpData32.buffer!=t.data.buffer&&(this.bmpData32=new Uint32Array(t.data.buffer));for(var r=t.width*e+i,s=i;s<a;s++)if(0!=this.bmpData32[r++])return!0;return!1}updateBbx(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var a=t.width,r=t.height,s=0,n=e[1],o=0,l=n;if(this.checkBmpLine(t,n,0,a))for(;;){if((l=(n+o)/2|0)+1>=n){e[1]=l;break}this.checkBmpLine(t,l,0,a)?n=l:o=l}if(e[3]>r)e[3]=r;else if(l=n=e[3],o=r,this.checkBmpLine(t,n,0,a))for(;;){if((l=(n+o)/2|0)-1<=n){e[3]=l;break}this.checkBmpLine(t,l,0,a)?n=l:o=l}if(!i){var h=e[0],_=a*e[1];for(l=e[1];l<e[3];l++){for(s=0;s<h;s++)if(0!=this.bmpData32[_+s]){h=s;break}_+=a}e[0]=h;var c=e[2];for(_=a*e[1],l=e[1];l<e[3];l++){for(s=c;s<a;s++)if(0!=this.bmpData32[_+s]){c=s;break}_+=a}e[2]=c}}getFontSizeInfo(t){var e=this.fontSizeInfo[t];if(void 0!=e)return e;var i="bold "+v.standardFontSize+"px "+t;if(v.isWan1Wan){this.fontSizeW=1.5*this.charRender.getWidth(i,"有"),this.fontSizeH=1.5*v.standardFontSize;var a=this.fontSizeW<<8|this.fontSizeH;return this.fontSizeInfo[t]=a,a}v.pixelBBX[0]=v.standardFontSize/2,v.pixelBBX[1]=v.standardFontSize/2,v.pixelBBX[2]=v.standardFontSize,v.pixelBBX[3]=v.standardFontSize;var r=16,s=16;this.charRender.scale(1,1),v.tmpRI.height=v.standardFontSize,this.charRender.fontsz=v.standardFontSize;var n=this.charRender.getCharBmp("g",i,0,"red",null,v.tmpRI,r,s,16,16);g.a.Render.isConchApp&&(n.data=new Uint8ClampedArray(n.data)),this.bmpData32=new Uint32Array(n.data.buffer),this.updateBbx(n,v.pixelBBX,!1),n=this.charRender.getCharBmp("有",i,0,"red",null,v.tmpRI,s,s,16,16),g.a.Render.isConchApp&&(n.data=new Uint8ClampedArray(n.data)),this.bmpData32=new Uint32Array(n.data.buffer),v.pixelBBX[2]<r+v.tmpRI.width&&(v.pixelBBX[2]=r+v.tmpRI.width),this.updateBbx(n,v.pixelBBX,!1),g.a.Render.isConchApp&&(r=0,s=0);var o=Math.max(r-v.pixelBBX[0],0)<<24|Math.max(s-v.pixelBBX[1],0)<<16|v.pixelBBX[2]-v.pixelBBX[0]<<8|v.pixelBBX[3]-v.pixelBBX[1];return this.fontSizeInfo[t]=o,o}printDbgInfo(){for(var t in console.log("图集个数:"+this.textAtlases.length+",每个图集大小:"+v.atlasWidth+"x"+v.atlasWidth," 用canvas:",v.isWan1Wan),console.log("图集占用空间:"+v.atlasWidth*v.atlasWidth*4/1024/1024*this.textAtlases.length+"M"),console.log("缓存用到的字体:"),this.mapFont){var e=this.getFontSizeInfo(t),i=e>>24,a=e>>16&255,r=e>>8&255,s=255&e;console.log("    "+t," off:",i,a," size:",r,s)}var n=0;console.log("缓存数据:");var o=0,l=0;this.textAtlases.forEach(function(t){var e=t.texture.id,i=_.a.loopCount-t.texture.lastTouchTm,a=i>0?i+"帧以前":"当前帧";for(var r in o+=t.texture.curUsedCovRate,l+=t.texture.curUsedCovRateAtlas,console.log("--图集(id:"+e+",当前使用率:"+(1e3*t.texture.curUsedCovRate|0)+"‰","当前图集使用率:",(100*t.texture.curUsedCovRateAtlas|0)+"%","图集使用率:",100*t.usedRate|0,"%, 使用于:"+a+")--:"),t.charMaps){var s=t.charMaps[r];console.log("     off:",s.orix,s.oriy," bmp宽高:",s.bmpWidth,s.bmpHeight,"无效:",s.deleted,"touchdt:",_.a.loopCount-s.touchTick,"位置:",s.uv[0]*v.atlasWidth|0,s.uv[1]*v.atlasWidth|0,"字符:",s.char,"key:",r),n++}}),console.log("独立贴图文字("+this.isoTextures.length+"个):"),this.isoTextures.forEach(function(t){console.log("    size:",t._texW,t._texH,"touch间隔:",_.a.loopCount-t.lastTouchTm,"char:",t.ri.char)}),console.log("总缓存:",n,"总使用率:",o,"总当前图集使用率:",l)}showAtlas(t,e,i,a,r,s){if(!this.textAtlases[t])return console.log("没有这个图集"),null;var n=new g.a.Sprite,o=this.textAtlases[t].texture,l={width:v.atlasWidth,height:v.atlasWidth,sourceWidth:v.atlasWidth,sourceHeight:v.atlasWidth,offsetX:0,offsetY:0,getIsReady:function(){return!0},_addReference:function(){},_removeReference:function(){},_getSource:function(){return o._getSource()},bitmap:{id:o.id},_uv:c.a.DEF_UV};return n.size=function(t,i){return this.width=t,this.height=i,n.graphics.clear(),n.graphics.drawRect(0,0,n.width,n.height,e),n.graphics.drawTexture(l,0,0,n.width,n.height),this},n.graphics.drawRect(0,0,r,s,e),n.graphics.drawTexture(l,0,0,r,s),n.pos(i,a),g.a.stage.addChild(n),n}filltext_native(t,e,i,a,r,s,n,o,l,h){let _=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0;if(!(e&&e.length<=0||i&&i.length<1)){var c=d.a.Parse(s),u=0;switch(h){case"center":u=g.a.Context.ENUM_TEXTALIGN_CENTER;break;case"right":u=g.a.Context.ENUM_TEXTALIGN_RIGHT}return this._fast_filltext(t,e,i,a,r,c,n,o,l,u,_)}}}e.a=v,n()(v,"useOldCharBook",!1),n()(v,"atlasWidth",1024),n()(v,"noAtlas",!1),n()(v,"forceSplitRender",!1),n()(v,"forceWholeRender",!1),n()(v,"scaleFontWithCtx",!0),n()(v,"standardFontSize",32),n()(v,"destroyAtlasDt",10),n()(v,"checkCleanTextureDt",2e3),n()(v,"destroyUnusedTextureDt",3e3),n()(v,"cleanMem",104857600),n()(v,"isWan1Wan",!1),n()(v,"showLog",!1),n()(v,"debugUV",!1),n()(v,"atlasWidth2",void 0),n()(v,"tmpRI",new f.a),n()(v,"pixelBBX",[0,0,0,0]),n()(v,"textRenderInst",void 0),n()(v,"imgdtRect",[0,0,0,0]),n()(v,"simClean",!1),l.a.gTextRender=v},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(83),o=i(17),l=i(10),h=i(3);class _ extends o.a{constructor(t,e){super(),r()(this,"_source",void 0),r()(this,"_texW",0),r()(this,"_texH",0),r()(this,"__destroyed",!1),r()(this,"_discardTm",0),r()(this,"genID",0),r()(this,"bitmap",{id:0,_glTexture:null}),r()(this,"curUsedCovRate",0),r()(this,"curUsedCovRateAtlas",0),r()(this,"lastTouchTm",0),r()(this,"ri",null),this._texW=t||_.gTextRender.atlasWidth,this._texH=e||_.gTextRender.atlasWidth,this.bitmap.id=this.id,this.lock=!0}recreateResource(){if(!this._source){var t=s.a.instance,e=this._source=t.createTexture();this.bitmap._glTexture=e,l.a.bindTexture(t,t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this._texW,this._texH,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),_.gTextRender.debugUV&&this.fillWhite()}}addChar(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(_.gTextRender.isWan1Wan)return this.addCharCanvas(t,e,i,a);!this._source&&this.recreateResource();var r=s.a.instance;l.a.bindTexture(r,r.TEXTURE_2D,this._source),!h.a.Render.isConchApp&&r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var n,o,c,d,u=t.data;return t.data instanceof Uint8ClampedArray&&(u=new Uint8Array(u.buffer)),r.texSubImage2D(r.TEXTURE_2D,0,e,i,t.width,t.height,r.RGBA,r.UNSIGNED_BYTE,u),!h.a.Render.isConchApp&&r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n=e/this._texW,o=i/this._texH,c=(e+t.width)/this._texW,d=(i+t.height)/this._texH,(a=a||new Array(8))[0]=n,a[1]=o,a[2]=c,a[3]=o,a[4]=c,a[5]=d,a[6]=n,a[7]=d,a}addCharCanvas(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;!this._source&&this.recreateResource();var r,n,o,_,c=s.a.instance;return l.a.bindTexture(c,c.TEXTURE_2D,this._source),!h.a.Render.isConchApp&&c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),c.texSubImage2D(c.TEXTURE_2D,0,e,i,c.RGBA,c.UNSIGNED_BYTE,t),!h.a.Render.isConchApp&&c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),h.a.Render.isConchApp?(r=e/this._texW,n=i/this._texH,o=(e+t.width)/this._texW,_=(i+t.height)/this._texH):(r=(e+1)/this._texW,n=(i+1)/this._texH,o=(e+t.width-1)/this._texW,_=(i+t.height-1)/this._texH),(a=a||new Array(8))[0]=r,a[1]=n,a[2]=o,a[3]=n,a[4]=o,a[5]=_,a[6]=r,a[7]=_,a}fillWhite(){!this._source&&this.recreateResource();var t=s.a.instance,e=new Uint8Array(this._texW*this._texH*4);e.fill(255),t.texSubImage2D(t.TEXTURE_2D,0,0,0,this._texW,this._texH,t.RGBA,t.UNSIGNED_BYTE,e)}discard(){h.a.stage.setGlobalRepaint(),this.destroy()}static getTextTexture(t,e){return new _(t,e)}destroy(){this.__destroyed=!0;var t=s.a.instance;this._source&&t.deleteTexture(this._source),this._source=null}static clean(){var t=n.a.loopStTm;if(0===_.cleanTm&&(_.cleanTm=t),t-_.cleanTm>=_.gTextRender.checkCleanTextureDt){for(var e=0;e<_.poolLen;e++){var i=_.pool[e];t-i._discardTm>=_.gTextRender.destroyUnusedTextureDt&&(i.destroy(),_.pool[e]=_.pool[_.poolLen-1],_.poolLen--,e--)}_.cleanTm=t}}touchRect(t,e){this.lastTouchTm!=e&&(this.curUsedCovRate=0,this.curUsedCovRateAtlas=0,this.lastTouchTm=e);var i=_.gTextRender.atlasWidth*_.gTextRender.atlasWidth,a=h.a.TextAtlas.atlasGridW*h.a.TextAtlas.atlasGridW;this.curUsedCovRate+=t.bmpWidth*t.bmpHeight/i,this.curUsedCovRateAtlas+=Math.ceil(t.bmpWidth/h.a.TextAtlas.atlasGridW)*Math.ceil(t.bmpHeight/h.a.TextAtlas.atlasGridW)/(i/a)}get texture(){return this}_getSource(){return this._source}drawOnScreen(t,e){}}e.a=_,r()(_,"gTextRender",null),r()(_,"pool",new Array(10)),r()(_,"poolLen",0),r()(_,"cleanTm",0)},function(t,e,i){"use strict";var a=i(18),r=(i.n(a),i(0)),s=i.n(r);class n{static Parse(t){if(t===n._lastFont)return n._lastFontInfo;var e=n._cache[t];return e||(e=n._cache[t]=new n(t)),n._lastFont=t,n._lastFontInfo=e,e}constructor(t){s()(this,"_id",void 0),s()(this,"_font","14px Arial"),s()(this,"_family","Arial"),s()(this,"_size",14),s()(this,"_italic",!1),s()(this,"_bold",!1),this._id=n._gfontID++,this.setFont(t||this._font)}setFont(t){this._font=t;var e=t.split(" "),i=e.length;if(i<2)1==i&&e[0].indexOf("px")>0&&(this._size=parseInt(e[0]));else{for(var a=-1,r=0;r<i;r++)if(e[r].indexOf("px")>0||e[r].indexOf("pt")>0){a=r,this._size=parseInt(e[r]),this._size<=0&&(console.error("font parse error:"+t),this._size=14);break}var s=a+1,n=e[s];for(s++;s<i;s++)n+=" "+e[s];this._family=n.split(",")[0],this._italic=e.indexOf("italic")>=0,this._bold=e.indexOf("bold")>=0}}}e.a=n,s()(n,"EMPTY",new n(null)),s()(n,"_cache",{}),s()(n,"_gfontID",0),s()(n,"_lastFont",""),s()(n,"_lastFontInfo",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){r()(this,"fontsz",16)}getWidth(t,e){return 0}scale(t,e){}get canvasWidth(){return 0}set canvasWidth(t){}getCharBmp(t,e,i,a,r,s,n,o,l,h){return arguments.length>10&&void 0!==arguments[10]&&arguments[10],null}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(147),n=i(68),o=i(4);class l{constructor(){r()(this,"texture",void 0),r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"vertices",void 0),r()(this,"uvs",void 0),r()(this,"indices",void 0),r()(this,"matrix",void 0),r()(this,"alpha",void 0),r()(this,"blendMode",void 0),r()(this,"color",void 0),r()(this,"colorNum",void 0)}static create(t,e,i,a,r,h,_,c,d,u,f){var m=o.a.getItemByClass("DrawTrianglesCmd",l);if(m.texture=t,m.x=e,m.y=i,m.vertices=a,m.uvs=r,m.indices=h,m.matrix=_,m.alpha=c,d){m.color=new s.a;var p=n.a.create(d).arrColor;m.color.color(255*p[0],255*p[1],255*p[2],255*p[3])}return m.blendMode=u,m.colorNum=f,m}recover(){this.texture=null,this.vertices=null,this.uvs=null,this.indices=null,this.matrix=null,o.a.recover("DrawTrianglesCmd",this)}run(t,e,i){t.drawTriangles(this.texture,this.x+e,this.y+i,this.vertices,this.uvs,this.indices,this.matrix,this.alpha,this.color,this.blendMode,this.colorNum)}get cmdID(){return l.ID}}e.a=l,r()(l,"ID","DrawTriangles")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{static create(t,e,i,a,r,o){var l=s.a.getItemByClass("Draw9GridTexture",n);return l.texture=t,t._addReference(),l.x=e,l.y=i,l.width=a,l.height=r,l.sizeGrid=o,l}recover(){this.texture._removeReference(),s.a.recover("Draw9GridTexture",this)}run(t,e,i){t.drawTextureWithSizeGrid(this.texture,this.x,this.y,this.width,this.height,this.sizeGrid,e,i)}get cmdID(){return n.ID}constructor(){r()(this,"texture",void 0),r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"width",void 0),r()(this,"height",void 0),r()(this,"sizeGrid",void 0)}}e.a=n,r()(n,"ID","Draw9GridTexture")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{static create(){return s.a.getItemByClass("SaveCmd",n)}recover(){s.a.recover("SaveCmd",this)}run(t,e,i){t.save()}get cmdID(){return n.ID}}e.a=n,r()(n,"ID","Save")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(238);class n{constructor(){r()(this,"useDic",{}),r()(this,"shapeDic",{}),r()(this,"shapeLineDic",{}),r()(this,"_id",0),r()(this,"_checkKey",!1),r()(this,"_freeIdArray",[]),s.a.regCacheByFunction(this.startDispose.bind(this),this.getCacheList.bind(this))}static getInstance(){return n.instance=n.instance||new n}getId(){return this._id++}addShape(t,e){this.shapeDic[t]=e,this.useDic[t]||(this.useDic[t]=!0)}addLine(t,e){this.shapeLineDic[t]=e,this.shapeLineDic[t]||(this.shapeLineDic[t]=!0)}getShape(t){this._checkKey&&null!=this.useDic[t]&&(this.useDic[t]=!0)}deleteShape(t){this.shapeDic[t]&&(this.shapeDic[t]=null,delete this.shapeDic[t]),this.shapeLineDic[t]&&(this.shapeLineDic[t]=null,delete this.shapeLineDic[t]),null!=this.useDic[t]&&delete this.useDic[t]}getCacheList(){var t,e=[];for(t in this.shapeDic)e.push(this.shapeDic[t]);for(t in this.shapeLineDic)e.push(this.shapeLineDic[t]);return e}startDispose(t){var e;for(e in this.useDic)this.useDic[e]=!1;this._checkKey=!0}endDispose(){if(this._checkKey){var t;for(t in this.useDic)this.useDic[t]||this.deleteShape(t);this._checkKey=!1}}}e.a=n,r()(n,"instance",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(3);class n{constructor(){}static regCacheByFunction(t,e){var i;n.unRegCacheByFunction(t,e),i={tryDispose:t,getCacheList:e},n._cacheList.push(i)}static unRegCacheByFunction(t,e){var i,a;for(a=n._cacheList.length,i=0;i<a;i++)if(n._cacheList[i].tryDispose==t&&n._cacheList[i].getCacheList==e)return void n._cacheList.splice(i,1)}static forceDispose(){var t,e=n._cacheList.length;for(t=0;t<e;t++)n._cacheList[t].tryDispose(!0)}static beginCheck(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;s.a.systemTimer.loop(t,null,n._checkLoop)}static stopCheck(){s.a.systemTimer.clear(null,n._checkLoop)}static _checkLoop(){var t=n._cacheList;if(!(t.length<1)){var e,i,a=s.a.Browser.now();for(i=e=t.length;e>0&&(n._index++,n._index=n._index%i,t[n._index].tryDispose(!1),!(s.a.Browser.now()-a>n.loopTimeLimit));)e--}}}e.a=n,r()(n,"loopTimeLimit",2),r()(n,"_cacheList",[]),r()(n,"_index",0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(71),n=i(84),o=i(148),l=i(15),h=i(26),_=i(48),c=i(212),d=i(8),u=i(67),f=i(224),m=i(29),p=i(36),g=i(153),v=i(10),T=i(357),E=i(3);class S{static __init__(){var t,e,i;for(T.a.__init__(),i=new S(S.INIT,null),e=S.renders.length=2*n.a.CHILDS,t=0;t<e;t++)S.renders[t]=i;S.renders[0]=new S(0,null)}static _initRenderFun(t,e,i,a){var r=t._renderType;(S.renders[r]=S._getTypeRender(r))._fun(t,e,i,a)}static _getTypeRender(t){if(T.a.map[t])return new S(t,null);for(var e=null,i=n.a.CHILDS;i>0;)i&t&&(e=new S(i,e)),i>>=1;return e}constructor(t,e){if(r()(this,"_next",void 0),r()(this,"_fun",void 0),T.a.map[t])return this._fun=T.a.map[t],void(this._next=S.NORENDER);switch(this._next=e||S.NORENDER,t){case 0:return void(this._fun=this._no);case n.a.ALPHA:return void(this._fun=this._alpha);case n.a.TRANSFORM:return void(this._fun=this._transform);case n.a.BLEND:return void(this._fun=this._blend);case n.a.CANVAS:return void(this._fun=this._canvas);case n.a.MASK:return void(this._fun=this._mask);case n.a.CLIP:return void(this._fun=this._clip);case n.a.STYLE:return void(this._fun=this._style);case n.a.GRAPHICS:return void(this._fun=this._graphics);case n.a.CHILDS:return void(this._fun=this._children);case n.a.CUSTOM:return void(this._fun=this._custom);case n.a.TEXTURE:return void(this._fun=this._texture);case n.a.FILTERS:return void(this._fun=o.a._filter);case S.INIT:return void(this._fun=S._initRenderFun)}this.onCreate(t)}onCreate(t){}_style(t,e,i,a){var r=t._style;null!=r.render&&r.render(t,e,i,a);var s=this._next;s._fun.call(s,t,e,i,a)}_no(t,e,i,a){}_custom(t,e,i,a){t.customRender(e,i,a),this._next._fun.call(this._next,t,e,0,0)}_clip(t,e,i,a){var r=this._next;if(r!=S.NORENDER){var s=t._style.scrollRect,n=s.width,o=s.height;0!==n&&0!==o&&(e.save(),e.clipRect(i,a,n,o),r._fun.call(r,t,e,i-s.x,a-s.y),e.restore())}}_texture(t,e,i,a){var r=t.texture;if(r._getSource()){var s=t._width||r.sourceWidth,n=t._height||r.sourceHeight,o=s/r.sourceWidth,l=n/r.sourceHeight;if(s=r.width*o,n=r.height*l,s<=0||n<=0)return;var h=i-t.pivotX+r.offsetX*o,_=a-t.pivotY+r.offsetY*l;e.drawTexture(r,h,_,s,n)}var c=this._next;c!=S.NORENDER&&c._fun.call(c,t,e,i,a)}_graphics(t,e,i,a){var r=t._style,s=t._graphics;s&&s._render(t,e,i-r.pivotX,a-r.pivotY);var n=this._next;n!=S.NORENDER&&n._fun.call(n,t,e,i,a)}_image(t,e,i,a){var r=t._style;e.drawTexture2(i,a,r.pivotX,r.pivotY,t.transform,t._graphics._one)}_image2(t,e,i,a){var r=t._style;e.drawTexture2(i,a,r.pivotX,r.pivotY,t.transform,t._graphics._one)}_alpha(t,e,i,a){var r;if((r=t._style.alpha)>.01||t._needRepaint()){var s=e.globalAlpha;e.globalAlpha*=r;var n=this._next;n._fun.call(n,t,e,i,a),e.globalAlpha=s}}_transform(t,e,i,a){var r=t.transform,s=this._next;t._style;r&&s!=S.NORENDER?(e.save(),e.transform(r.a,r.b,r.c,r.d,r.tx+i,r.ty+a),s._fun.call(s,t,e,0,0),e.restore()):s!=S.NORENDER&&s._fun.call(s,t,e,i,a)}_children(t,e,i,a){var r,n=t._style,o=t._children,l=o.length;i-=t.pivotX,a-=t.pivotY;var h=t._getBit(s.a.DRAWCALL_OPTIMIZE)&&e.drawCallOptimize(!0);if(n.viewport){var _,c,d=n.viewport,u=d.x,f=d.y,m=d.right,p=d.bottom;for(g=0;g<l;++g)(r=o[g])._visible&&(_=r._x)<m&&_+r.width>u&&(c=r._y)<p&&c+r.height>f&&r.render(e,i,a)}else for(var g=0;g<l;++g)(r=o[g])._visible&&r.render(e,i,a);h&&e.drawCallOptimize(!1)}_canvas(t,e,i,a){var r=t._cacheStyle,s=this._next;if(r.enableCanvasRender){"bitmap"===r.cacheAs?d.a.canvasBitmap++:d.a.canvasNormal++;var n=!1,o=!1;if(r.canvas){var l=r.canvas,h=(l.context,l.touches);if(h)for(var _=0;_<h.length;_++)if(h[_].deleted){o=!0;break}n=l.isCacheValid&&!l.isCacheValid()}if(t._needRepaint()||!r.canvas||o||n||E.a.stage.isGlobalRepaint())if("normal"===r.cacheAs){if(e._targets)return void s._fun.call(s,t,e,i,a);this._canvas_webgl_normal_repaint(t,e)}else this._canvas_repaint(t,e,i,a);var c=r.cacheRect;e.drawCanvas(r.canvas,i+c.x,a+c.y,c.width,c.height)}else s._fun.call(s,t,e,i,a)}_canvas_repaint(t,e,i,a){var r,s,n,o,l,h,_,c,u,f=t._cacheStyle,m=this._next,p=f.canvas,g=f.cacheAs;if(_=(u=f._calculateCacheRect(t,g,i,a)).x,c=u.y,l=(o=f.cacheRect).width*_,h=o.height*c,s=o.x,n=o.y,"bitmap"===g&&(l>2048||h>2048))return console.warn("cache bitmap size larger than 2048,cache ignored"),f.releaseContext(),void m._fun.call(m,t,e,i,a);if(p||(f.createContext(),p=f.canvas),(r=p.context).sprite=t,(p.width!=l||p.height!=h)&&p.size(l,h),"bitmap"===g?r.asBitmap=!0:"normal"===g&&(r.asBitmap=!1),r.clear(),1!=_||1!=c){var v=r;v.save(),v.scale(_,c),m._fun.call(m,t,r,-s,-n),v.restore(),t._applyFilters()}else v=r,m._fun.call(m,t,r,-s,-n),t._applyFilters();f.staticCache&&(f.reCache=!1),d.a.canvasReCache++}_canvas_webgl_normal_repaint(t,e){var i=t._cacheStyle,a=this._next,r=i.canvas,s=i.cacheAs;i._calculateCacheRect(t,s,0,0),r||(r=new f.a(e,t),i.canvas=r);var n=r.context;r.startRec(),a._fun.call(a,t,n,t.pivotX,t.pivotY),t._applyFilters(),d.a.canvasReCache++,r.endRec()}_blend(t,e,i,a){var r=t._style,s=this._next;r.blendMode?(e.save(),e.globalCompositeOperation=r.blendMode,s._fun.call(s,t,e,i,a),e.restore()):s._fun.call(s,t,e,i,a)}_mask(t,e,i,a){var r=this._next,s=t.mask,n=e;if(s){n.save();var o=n.globalCompositeOperation,d=new h.a;if(d.copyFrom(s.getBounds()),d.width=Math.round(d.width),d.height=Math.round(d.height),d.x=Math.round(d.x),d.y=Math.round(d.y),d.width>0&&d.height>0){var u=d.width,f=d.height,v=c.a.getRT(u,f);n.breakNextMerge(),n.pushRT(),n.addRenderObject(g.a.create([n,v,u,f],S.tmpTarget,this)),s.render(n,-d.x,-d.y),n.breakNextMerge(),n.popRT(),n.save();let e=.1;n.clipRect(i+d.x-t.getStyle().pivotX+e,a+d.y-t.getStyle().pivotY+e,u-2*e,f-2*e),r._fun.call(r,t,n,i,a),n.restore(),o=n.globalCompositeOperation,n.addRenderObject(g.a.create(["mask"],S.setBlendMode,this));var T=p.a.create(m.a.TEXTURE2D,0),E=_.a.INV_UV;n.drawTarget(v,i+d.x-t.getStyle().pivotX,a+d.y-t.getStyle().pivotY,u,f,l.a.TEMP.identity(),T,E,6),n.addRenderObject(g.a.create([v],S.recycleTarget,this)),n.addRenderObject(g.a.create([o],S.setBlendMode,this))}n.restore()}else r._fun.call(r,t,e,i,a)}static tmpTarget(t,e,i,a){e.start(),e.clear(0,0,0,0)}static recycleTarget(t){c.a.releaseRT(t)}static setBlendMode(t){var e=v.a.mainContext;u.a.targetFns[u.a.TOINT[t]](e)}}e.a=S,r()(S,"INIT",69905),r()(S,"renders",[]),r()(S,"NORENDER",new S(0,null)),r()(S,"tempUV",new Array(8))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){r()(this,"scaleX",void 0),r()(this,"scaleY",void 0),r()(this,"skewX",void 0),r()(this,"skewY",void 0),r()(this,"pivotX",void 0),r()(this,"pivotY",void 0),r()(this,"rotation",void 0),r()(this,"alpha",void 0),r()(this,"scrollRect",void 0),r()(this,"viewport",void 0),r()(this,"hitArea",void 0),r()(this,"dragging",void 0),r()(this,"blendMode",void 0),this.reset()}reset(){return this.scaleX=this.scaleY=1,this.skewX=this.skewY=0,this.pivotX=this.pivotY=this.rotation=0,this.alpha=1,this.scrollRect&&this.scrollRect.recover(),this.scrollRect=null,this.viewport&&this.viewport.recover(),this.viewport=null,this.hitArea=null,this.dragging=null,this.blendMode=null,this}recover(){this!==n.EMPTY&&s.a.recover("SpriteStyle",this.reset())}static create(){return s.a.getItemByClass("SpriteStyle",n)}}e.a=n,r()(n,"EMPTY",new n)},function(t,e,i){"use strict";var a=i(118),r=(i.n(a),i(0)),s=i.n(r),n=i(70),o=i(69),l=i(162),h=i(84),_=i(71),c=i(6),d=i(163),u=i(15),f=i(16),m=i(37),p=i(83),g=i(82),v=i(19),T=i(242),E=i(68),S=i(164),R=i(237),x=i(66),A=i(8),y=i(3),I=i(2),C=i(30);class M extends n.a{constructor(){super(),s()(this,"focus",void 0),s()(this,"offset",new f.a),s()(this,"_frameRate","fast"),s()(this,"designWidth",0),s()(this,"designHeight",0),s()(this,"canvasRotation",!1),s()(this,"canvasDegree",0),s()(this,"renderingEnabled",!0),s()(this,"screenAdaptationEnabled",!0),s()(this,"_canvasTransform",new u.a),s()(this,"_screenMode","none"),s()(this,"_scaleMode","noscale"),s()(this,"_alignV","top"),s()(this,"_alignH","left"),s()(this,"_bgColor","black"),s()(this,"_mouseMoveTime",0),s()(this,"_renderCount",0),s()(this,"_safariOffsetY",0),s()(this,"_frameStartTime",0),s()(this,"_previousOrientation",v.a.window.orientation),s()(this,"_isFocused",void 0),s()(this,"_isVisibility",void 0),s()(this,"_wgColor",[0,0,0,1]),s()(this,"_scene3Ds",[]),s()(this,"_globalRepaintSet",!1),s()(this,"_globalRepaintGet",!1),s()(this,"_3dUI",[]),s()(this,"_curUIBase",null),s()(this,"useRetinalCanvas",!1),super.set_transform(this._createTransform()),this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._setBit(_.a.DISPLAYED_INSTAGE,!0),this._setBit(_.a.ACTIVE_INHIERARCHY,!0),this._isFocused=!0,this._isVisibility=!0,this.useRetinalCanvas=o.a.useRetinalCanvas;var t=v.a.window;t.addEventListener("focus",()=>{this._isFocused=!0,this.event(c.a.FOCUS),this.event(c.a.FOCUS_CHANGE)}),t.addEventListener("blur",()=>{this._isFocused=!1,this.event(c.a.BLUR),this.event(c.a.FOCUS_CHANGE),this._isInputting()&&(l.a.inputElement.target.focus=!1)});var e="visibilityState",i="visibilitychange",a=t.document;void 0!==a.hidden?(i="visibilitychange",e="visibilityState"):void 0!==a.mozHidden?(i="mozvisibilitychange",e="mozVisibilityState"):void 0!==a.msHidden?(i="msvisibilitychange",e="msVisibilityState"):void 0!==a.webkitHidden&&(i="webkitvisibilitychange",e="webkitVisibilityState"),t.document.addEventListener(i,()=>{"hidden"==v.a.document[e]?(this._isVisibility=!1,this._isInputting()&&(l.a.inputElement.target.focus=!1)):this._isVisibility=!0,this.renderingEnabled=this._isVisibility,this.event(c.a.VISIBILITY_CHANGE)}),t.addEventListener("resize",()=>{var t=v.a.window.orientation;null!=t&&t!=this._previousOrientation&&this._isInputting()&&(l.a.inputElement.target.focus=!1),this._previousOrientation=t,this._isInputting()||(v.a.onSafari&&(this._safariOffsetY=(v.a.window.__innerHeight||v.a.document.body.clientHeight||v.a.document.documentElement.clientHeight)-v.a.window.innerHeight),this._resetCanvas())}),t.addEventListener("orientationchange",t=>{this._resetCanvas()}),this.on(c.a.MOUSE_MOVE,this,this._onmouseMove),v.a.onMobile&&this.on(c.a.MOUSE_DOWN,this,this._onmouseMove)}_isInputting(){return v.a.onMobile&&l.a.isInputting}set width(t){this.designWidth=t,super.set_width(t),y.a.systemTimer.callLater(this,this._changeCanvasSize)}get width(){return super.get_width()}set height(t){this.designHeight=t,super.set_height(t),y.a.systemTimer.callLater(this,this._changeCanvasSize)}get height(){return super.get_height()}set transform(t){super.set_transform(t)}get transform(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||this._createTransform()}get isFocused(){return this._isFocused}get isVisibility(){return this._isVisibility}_changeCanvasSize(){this.setScreenSize(v.a.clientWidth*v.a.pixelRatio,v.a.clientHeight*v.a.pixelRatio)}_resetCanvas(){this.screenAdaptationEnabled&&this._changeCanvasSize()}setScreenSize(t,e){var i=!1;if(this._screenMode!==M.SCREEN_NONE&&(i=(t/e<1?M.SCREEN_VERTICAL:M.SCREEN_HORIZONTAL)!==this._screenMode)){var a=e;e=t,t=a}this.canvasRotation=i;var r=m.a._mainCanvas,s=r.source.style,n=this._canvasTransform.identity(),o=this._scaleMode,l=t/this.designWidth,_=e/this.designHeight,d=this.useRetinalCanvas?t:this.designWidth,u=this.useRetinalCanvas?e:this.designHeight,f=t,p=e,g=v.a.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,o){case M.SCALE_NOSCALE:l=_=1,f=this.designWidth,p=this.designHeight;break;case M.SCALE_SHOWALL:l=_=Math.min(l,_),d=f=Math.round(this.designWidth*l),u=p=Math.round(this.designHeight*_);break;case M.SCALE_NOBORDER:l=_=Math.max(l,_),f=Math.round(this.designWidth*l),p=Math.round(this.designHeight*_);break;case M.SCALE_FULL:l=_=1,this._width=d=t,this._height=u=e;break;case M.SCALE_FIXED_WIDTH:_=l,this._height=u=Math.round(e/l);break;case M.SCALE_FIXED_HEIGHT:l=_,this._width=d=Math.round(t/_);break;case M.SCALE_FIXED_AUTO:t/e<this.designWidth/this.designHeight?(_=l,this._height=u=Math.round(e/l)):(l=_,this._width=d=Math.round(t/_))}this.useRetinalCanvas&&(f=d=t,p=u=e),l*=this.scaleX,_*=this.scaleY,1===l&&1===_?this.transform.identity():(this.transform.a=this._formatData(l/(f/d)),this.transform.d=this._formatData(_/(p/u))),r.size(d,u),S.a.changeWebGLSize(d,u),n.scale(f/d/g,p/u/g),this._alignH===M.ALIGN_LEFT?this.offset.x=0:this._alignH===M.ALIGN_RIGHT?this.offset.x=t-f:this.offset.x=.5*(t-f)/g,this._alignV===M.ALIGN_TOP?this.offset.y=0:this._alignV===M.ALIGN_BOTTOM?this.offset.y=e-p:this.offset.y=.5*(e-p)/g,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),n.translate(this.offset.x,this.offset.y),this._safariOffsetY&&n.translate(0,this._safariOffsetY),this.canvasDegree=0,i&&(this._screenMode===M.SCREEN_HORIZONTAL?(n.rotate(Math.PI/2),n.translate(e/g,0),this.canvasDegree=90):(n.rotate(-Math.PI/2),n.translate(0,t/g),this.canvasDegree=-90)),n.a=this._formatData(n.a),n.d=this._formatData(n.d),n.tx=this._formatData(n.tx),n.ty=this._formatData(n.ty),super.set_transform(this.transform),s.transformOrigin=s.webkitTransformOrigin=s.msTransformOrigin=s.mozTransformOrigin=s.oTransformOrigin="0px 0px 0px",s.transform=s.webkitTransform=s.msTransform=s.mozTransform=s.oTransform="matrix("+n.toString()+")",s.width=d,s.height=u,this._safariOffsetY&&n.translate(0,-this._safariOffsetY),n.translate(parseInt(s.left)||0,parseInt(s.top)||0),this.visible=!0,this._repaint|=h.a.REPAINT_CACHE,this.event(c.a.RESIZE)}_formatData(t){return Math.abs(t)<1e-6?0:Math.abs(1-t)<.001?t>0?1:-1:t}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode=t,y.a.systemTimer.callLater(this,this._changeCanvasSize)}get alignH(){return this._alignH}set alignH(t){this._alignH=t,y.a.systemTimer.callLater(this,this._changeCanvasSize)}get alignV(){return this._alignV}set alignV(t){this._alignV=t,y.a.systemTimer.callLater(this,this._changeCanvasSize)}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t,this._wgColor=t?E.a.create(t).arrColor:null,m.a.canvas.style.background=t||"none"}get mouseX(){return Math.round(d.a.instance.mouseX/this.clientScaleX)}get mouseY(){return Math.round(d.a.instance.mouseY/this.clientScaleY)}getMousePoint(){return f.a.TEMP.setTo(this.mouseX,this.mouseY)}get clientScaleX(){return this._transform?this._transform.getScaleX():1}get clientScaleY(){return this._transform?this._transform.getScaleY():1}get screenMode(){return this._screenMode}set screenMode(t){this._screenMode=t}repaint(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.a.REPAINT_CACHE;this._repaint|=t}parentRepaint(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.a.REPAINT_CACHE}_loop(){return this._globalRepaintGet=this._globalRepaintSet,this._globalRepaintSet=!1,this.render(m.a._context,0,0),!0}getFrameTm(){return this._frameStartTime}_onmouseMove(t){this._mouseMoveTime=v.a.now()}getTimeFromFrameStart(){return v.a.now()-this._frameStartTime}set visible(t){this.visible!==t&&(super.set_visible(t),m.a._mainCanvas.source.style.visibility=t?"visible":"hidden")}get visible(){return super.visible}render(t,e,i){if(window.conch)this.renderToNative(t,e,i);else{if(this._frameRate===M.FRAME_SLEEP){var a=v.a.now();if(!(a-this._frameStartTime>=1e3))return;this._frameStartTime=a}else{if(!this._visible)return this._renderCount++,void(this._renderCount%5==0&&(T.a.I._update(),A.a.loopCount++,p.a.loopCount=A.a.loopCount,this._updateTimers()));this._frameStartTime=v.a.now(),p.a.loopStTm=this._frameStartTime}this._renderCount++;var r=(this._frameRate===M.FRAME_MOUSE?this._frameStartTime-this._mouseMoveTime<2e3?M.FRAME_FAST:M.FRAME_SLOW:this._frameRate)!==M.FRAME_SLOW,s=this._renderCount%2==0;if(A.a.renderSlow=!r,r||s){if(T.a.I._update(),A.a.loopCount++,p.a.loopCount=A.a.loopCount,this.renderingEnabled){for(var n=0,o=this._scene3Ds.length;n<o;n++)this._scene3Ds[n]._update();t.clear(),super.render(t,e,i),A.a._StatRender.renderNotCanvas(t,e,i)}this.renderingEnabled&&(M.clear(this._bgColor),t.flush(),R.a.instance&&R.a.getInstance().endDispose()),this._updateTimers()}}}renderToNative(t,e,i){if(this._renderCount++,this._visible){if(T.a.I._update(),A.a.loopCount++,p.a.loopCount=A.a.loopCount,this.renderingEnabled){for(var a=0,r=this._scene3Ds.length;a<r;a++)this._scene3Ds[a]._update();t.clear(),super.render(t,e,i),A.a._StatRender.renderNotCanvas(t,e,i)}this.renderingEnabled&&(M.clear(this._bgColor),t.flush(),R.a.instance&&R.a.getInstance().endDispose()),this._updateTimers()}else this._renderCount%5==0&&(T.a.I._update(),A.a.loopCount++,p.a.loopCount=A.a.loopCount,this._updateTimers())}_updateTimers(){y.a.systemTimer._update(),y.a.startTimer._update(),y.a.physicsTimer._update(),y.a.updateTimer._update(),y.a.lateTimer._update(),y.a.timer._update()}set fullScreenEnabled(t){var e=v.a.document,i=m.a.canvas;t?(i.addEventListener("mousedown",this._requestFullscreen),i.addEventListener("touchstart",this._requestFullscreen),e.addEventListener("fullscreenchange",this._fullScreenChanged),e.addEventListener("mozfullscreenchange",this._fullScreenChanged),e.addEventListener("webkitfullscreenchange",this._fullScreenChanged),e.addEventListener("msfullscreenchange",this._fullScreenChanged)):(i.removeEventListener("mousedown",this._requestFullscreen),i.removeEventListener("touchstart",this._requestFullscreen),e.removeEventListener("fullscreenchange",this._fullScreenChanged),e.removeEventListener("mozfullscreenchange",this._fullScreenChanged),e.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),e.removeEventListener("msfullscreenchange",this._fullScreenChanged))}get frameRate(){return y.a.Render.isConchApp?this._frameRateNative:this._frameRate}set frameRate(t){if(y.a.Render.isConchApp){var e=window.conch;switch(t){case M.FRAME_FAST:e.config.setLimitFPS(60);break;case M.FRAME_MOUSE:e.config.setMouseFrame(2e3);break;case M.FRAME_SLOW:e.config.setSlowFrame(!0);break;case M.FRAME_SLEEP:e.config.setLimitFPS(1)}this._frameRateNative=t}else this._frameRate=t}_requestFullscreen(){var t=v.a.document.documentElement;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()}_fullScreenChanged(){y.a.stage.event(c.a.FULL_SCREEN_CHANGE)}exitFullscreen(){var t=v.a.document;t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen&&t.webkitExitFullscreen()}isGlobalRepaint(){return this._globalRepaintGet}setGlobalRepaint(){this._globalRepaintSet=!0}add3DUI(t){var e=t.rootView;this._3dUI.indexOf(e)>=0||this._3dUI.push(e)}remove3DUI(t){var e=t.rootView,i=this._3dUI.indexOf(e);return i>=0&&(this._3dUI.splice(i,1),!0)}}e.a=M,s()(M,"SCALE_NOSCALE","noscale"),s()(M,"SCALE_EXACTFIT","exactfit"),s()(M,"SCALE_SHOWALL","showall"),s()(M,"SCALE_NOBORDER","noborder"),s()(M,"SCALE_FULL","full"),s()(M,"SCALE_FIXED_WIDTH","fixedwidth"),s()(M,"SCALE_FIXED_HEIGHT","fixedheight"),s()(M,"SCALE_FIXED_AUTO","fixedauto"),s()(M,"ALIGN_LEFT","left"),s()(M,"ALIGN_RIGHT","right"),s()(M,"ALIGN_CENTER","center"),s()(M,"ALIGN_TOP","top"),s()(M,"ALIGN_MIDDLE","middle"),s()(M,"ALIGN_BOTTOM","bottom"),s()(M,"SCREEN_NONE","none"),s()(M,"SCREEN_HORIZONTAL","horizontal"),s()(M,"SCREEN_VERTICAL","vertical"),s()(M,"FRAME_FAST","fast"),s()(M,"FRAME_SLOW","slow"),s()(M,"FRAME_MOUSE","mouse"),s()(M,"FRAME_SLEEP","sleep"),s()(M,"clear",function(t){g.a.set2DRenderConfig();var e=I.a.instance;x.a.worldScissorTest&&e.disable(e.SCISSOR_TEST);var i=m.a.context,a=0==i._submits._length||o.a.preserveDrawingBuffer?E.a.create(t).arrColor:y.a.stage._wgColor;a?i.clearBG(a[0],a[1],a[2],a[3]):i.clearBG(0,0,0,0),x.a.clear()}),C.a.regClass("laya.display.Stage",M),C.a.regClass("Laya.Stage",M)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(3);class n{constructor(){r()(this,"_pool",[]),r()(this,"_map",{}),r()(this,"_laters",[])}_update(){let t=this._laters,e=t.length;if(e>0){for(let i=0,a=e-1;i<=a;i++){let e=t[i];this._map[e.key]=null,null!==e.method&&(e.run(),e.clear()),this._pool.push(e),i===a&&(a=t.length-1)}t.length=0}}_getHandler(t,e){var i=t?t.$_GID||(t.$_GID=s.a.Utils.getGID()):0,a=e.$_TID||(e.$_TID=s.a.Timer._mid++);return this._map[i+"."+a]}callLater(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==this._getHandler(t,e)){let s;(s=this._pool.length?this._pool.pop():new o).caller=t,s.method=e,s.args=i;var a=t?t.$_GID:0,r=e.$_TID;s.key=a+"."+r,this._map[s.key]=s,this._laters.push(s)}}runCallLater(t,e){var i=this._getHandler(t,e);i&&null!=i.method&&(this._map[i.key]=null,i.run(),i.clear())}}e.a=n,r()(n,"I",new n);class o{constructor(){r()(this,"key",void 0),r()(this,"caller",void 0),r()(this,"method",void 0),r()(this,"args",void 0)}clear(){this.caller=null,this.method=null,this.args=null}run(){var t=this.caller;if(t&&t.destroyed)return this.clear();var e=this.method,i=this.args;null!=e&&(i?e.apply(t,i):e.call(t))}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(364),n=i(6),o=i(23),l=i(27),h=i(37),_=i(19),c=i(4),d=i(3);class u extends o.a{constructor(){super(...arguments),r()(this,"url",void 0),r()(this,"audio",void 0),r()(this,"loaded",!1)}dispose(){var t=u._audioCache[this.url];c.a.clearBySign("audio:"+this.url),t&&(h.a.isConchApp||(t.src=""),delete u._audioCache[this.url])}static _initMusicAudio(){u._musicAudio||(u._musicAudio||(u._musicAudio=_.a.createElement("audio")),h.a.isConchApp||_.a.document.addEventListener("mousedown",u._makeMusicOK))}static _makeMusicOK(){_.a.document.removeEventListener("mousedown",u._makeMusicOK),u._musicAudio.src?u._musicAudio.play():(u._musicAudio.src="",u._musicAudio.load())}load(t){var e;if(t=l.a.formatURL(t),this.url=t,t==d.a.SoundManager._bgMusic?(u._initMusicAudio(),(e=u._musicAudio).src!=t&&(u._audioCache[e.src]=null,e=null)):e=u._audioCache[t],e&&e.readyState>=2)this.event(n.a.COMPLETE);else{e||(t==d.a.SoundManager._bgMusic?(u._initMusicAudio(),e=u._musicAudio):e=_.a.createElement("audio"),u._audioCache[t]=e,e.src=t),e.addEventListener("canplaythrough",a),e.addEventListener("error",r);var i=this;this.audio=e,e.load?e.load():r()}function a(){s(),i.loaded=!0,i.event(n.a.COMPLETE)}function r(){e.load=null,s(),i.event(n.a.ERROR)}function s(){e.removeEventListener("canplaythrough",a),e.removeEventListener("error",r)}}play(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.url)return null;var i,a;if(!(i=this.url==d.a.SoundManager._bgMusic?u._musicAudio:u._audioCache[this.url]))return null;a=c.a.getItem("audio:"+this.url),h.a.isConchApp?a||((a=_.a.createElement("audio")).src=this.url):this.url==d.a.SoundManager._bgMusic?(u._initMusicAudio(),(a=u._musicAudio).src=this.url):a=a||i.cloneNode(!0);var r=new s.a(a);return r.url=this.url,r.loops=e,r.startTime=t,r.play(),d.a.SoundManager.addChannel(r),r}get duration(){var t;return(t=u._audioCache[this.url])?t.duration:0}}e.a=u,r()(u,"_audioCache",{}),r()(u,"_musicAudio",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(6),n=i(243),o=i(245),l=i(27),h=i(21),_=i(3);class c{static __init__(){var t=_.a.Browser.window,e=!!(t.AudioContext||t.webkitAudioContext||t.mozAudioContext);return e&&o.a.initWebAudio(),c._soundClass=e?o.a:n.a,n.a._initMusicAudio(),c._musicClass=n.a,e}static addChannel(t){c._channels.indexOf(t)>=0||c._channels.push(t)}static removeChannel(t){var e;for(e=c._channels.length-1;e>=0;e--)c._channels[e]==t&&c._channels.splice(e,1)}static disposeSoundLater(t){c._lastSoundUsedTimeDic[t]=_.a.Browser.now(),c._isCheckingDispose||(c._isCheckingDispose=!0,_.a.timer.loop(5e3,null,c._checkDisposeSound))}static _checkDisposeSound(){var t,e=_.a.Browser.now(),i=!1;for(t in c._lastSoundUsedTimeDic)e-c._lastSoundUsedTimeDic[t]>3e4?(delete c._lastSoundUsedTimeDic[t],c.disposeSoundIfNotUsed(t)):i=!0;i||(c._isCheckingDispose=!1,_.a.timer.clear(null,c._checkDisposeSound))}static disposeSoundIfNotUsed(t){var e;for(e=c._channels.length-1;e>=0;e--)if(c._channels[e].url==t)return;c.destroySound(t)}static set autoStopMusic(t){_.a.stage.off(s.a.BLUR,null,c._stageOnBlur),_.a.stage.off(s.a.FOCUS,null,c._stageOnFocus),_.a.stage.off(s.a.VISIBILITY_CHANGE,null,c._visibilityChange),c._autoStopMusic=t,t&&(_.a.stage.on(s.a.BLUR,null,c._stageOnBlur),_.a.stage.on(s.a.FOCUS,null,c._stageOnFocus),_.a.stage.on(s.a.VISIBILITY_CHANGE,null,c._visibilityChange))}static get autoStopMusic(){return c._autoStopMusic}static _visibilityChange(){_.a.stage.isVisibility?c._stageOnFocus():c._stageOnBlur()}static _stageOnBlur(){c._isActive=!1,c._musicChannel&&(c._musicChannel.isStopped||(c._blurPaused=!0,c._musicChannel.pause())),c.stopAllSound(),_.a.stage.once(s.a.MOUSE_DOWN,null,c._stageOnFocus)}static _recoverWebAudio(){o.a.ctx&&"running"!=o.a.ctx.state&&o.a.ctx.resume&&o.a.ctx.resume()}static _stageOnFocus(){c._isActive=!0,c._recoverWebAudio(),_.a.stage.off(s.a.MOUSE_DOWN,null,c._stageOnFocus),c._blurPaused&&c._musicChannel&&c._musicChannel.isStopped&&(c._blurPaused=!1,c._musicChannel.resume())}static set muted(t){t!=c._muted&&(t&&c.stopAllSound(),c.musicMuted=t,c._muted=t)}static get muted(){return c._muted}static set soundMuted(t){c._soundMuted=t}static get soundMuted(){return c._soundMuted}static set musicMuted(t){t!=c._musicMuted&&(t?(c._bgMusic&&c._musicChannel&&!c._musicChannel.isStopped?_.a.Render.isConchApp?c._musicChannel._audio&&(c._musicChannel._audio.muted=!0):c._musicChannel.pause():c._musicChannel=null,c._musicMuted=t):(c._musicMuted=t,c._bgMusic&&c._musicChannel&&(_.a.Render.isConchApp?c._musicChannel._audio&&(c._musicChannel._audio.muted=!1):c._musicChannel.resume())))}static get musicMuted(){return c._musicMuted}static get useAudioMusic(){return c._useAudioMusic}static set useAudioMusic(t){c._useAudioMusic=t,c._musicClass=t?n.a:null}static playSound(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!c._isActive||!t)return null;if(c._muted)return null;if(c._recoverWebAudio(),(t=l.a.formatURL(t))==c._bgMusic){if(c._musicMuted)return null}else{if(_.a.Render.isConchApp){var s=h.a.getFileExtension(t);if("wav"!=s&&"ogg"!=s)return alert("The sound only supports wav or ogg format,for optimal performance reason,please refer to the official website document."),null}if(c._soundMuted)return null}var n,o;return _.a.Browser.onBDMiniGame||_.a.Browser.onMiniGame||_.a.Browser.onKGMiniGame||_.a.Browser.onQGMiniGame||_.a.Browser.onVVMiniGame||_.a.Browser.onAlipayMiniGame||_.a.Browser.onQQMiniGame||_.a.Browser.onBLMiniGame||_.a.Browser.onTTMiniGame||_.a.Browser.onHWMiniGame||_.a.Browser.onTBMiniGame||(n=_.a.loader.getRes(t)),a||(a=c._soundClass),n||((n=new a).load(t),_.a.Browser.onBDMiniGame||_.a.Browser.onMiniGame||_.a.Browser.onKGMiniGame||_.a.Browser.onQGMiniGame||_.a.Browser.onVVMiniGame||_.a.Browser.onAlipayMiniGame||_.a.Browser.onQQMiniGame||_.a.Browser.onBLMiniGame||_.a.Browser.onTTMiniGame||_.a.Browser.onHWMiniGame||_.a.Browser.onTBMiniGame||_.a.Loader.cacheRes(t,n)),(o=n.play(r,e))?(o.url=t,o.volume=t==c._bgMusic?c.musicVolume:c.soundVolume,o.completeHandler=i,o):null}static destroySound(t){var e=_.a.loader.getRes(t);e&&(_.a.Loader.clearRes(t),e.dispose())}static playMusic(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return t=l.a.formatURL(t),c._bgMusic=t,c._musicChannel&&c._musicChannel.stop(),c._musicChannel=c.playSound(t,e,i,c._musicClass,a)}static stopSound(t){var e,i;for(t=l.a.formatURL(t),e=c._channels.length-1;e>=0;e--)(i=c._channels[e]).url==t&&i.stop()}static stopAll(){var t;for(c._bgMusic=null,t=c._channels.length-1;t>=0;t--)c._channels[t].stop()}static stopAllSound(){var t,e;for(t=c._channels.length-1;t>=0;t--)(e=c._channels[t]).url!=c._bgMusic&&e.stop()}static stopMusic(){c._musicChannel&&c._musicChannel.stop(),c._bgMusic=null}static setSoundVolume(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var i,a;if(e)e=l.a.formatURL(e),c._setVolume(e,t);else for(c.soundVolume=t,i=c._channels.length-1;i>=0;i--)(a=c._channels[i]).url!=c._bgMusic&&(a.volume=t)}static setMusicVolume(t){c.musicVolume=t,c._setVolume(c._bgMusic,t)}static _setVolume(t,e){var i,a;for(t=l.a.formatURL(t),i=c._channels.length-1;i>=0;i--)(a=c._channels[i]).url==t&&(a.volume=e)}}e.a=c,r()(c,"musicVolume",1),r()(c,"soundVolume",1),r()(c,"playbackRate",1),r()(c,"_useAudioMusic",!0),r()(c,"_muted",!1),r()(c,"_soundMuted",!1),r()(c,"_musicMuted",!1),r()(c,"_bgMusic",null),r()(c,"_musicChannel",null),r()(c,"_channels",[]),r()(c,"_autoStopMusic",void 0),r()(c,"_blurPaused",!1),r()(c,"_isActive",!0),r()(c,"_soundClass",void 0),r()(c,"_musicClass",void 0),r()(c,"_lastSoundUsedTimeDic",{}),r()(c,"_isCheckingDispose",!1),r()(c,"autoReleaseSound",!0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(365),n=i(6),o=i(23),l=i(27),h=i(3);class _ extends o.a{constructor(){super(...arguments),r()(this,"url",void 0),r()(this,"loaded",!1),r()(this,"data",void 0),r()(this,"audioBuffer",void 0),r()(this,"__toPlays",void 0),r()(this,"_disposed",!1)}static decode(){_.buffs.length<=0||_.isDecoding||(_.isDecoding=!0,_.tInfo=_.buffs.shift(),_.ctx.decodeAudioData(_.tInfo.buffer,_._done,_._fail))}static _done(t){_.e.event("loaded:"+_.tInfo.url,t),_.isDecoding=!1,_.decode()}static _fail(){_.e.event("err:"+_.tInfo.url,null),_.isDecoding=!1,_.decode()}static _playEmptySound(){if(null!=_.ctx){var t=_.ctx.createBufferSource();t.buffer=_._miniBuffer,t.connect(_.ctx.destination),t.start(0,0,0)}}static _unlock(){_._unlocked||(_._playEmptySound(),"running"==_.ctx.state&&(window.document.removeEventListener("mousedown",_._unlock,!0),window.document.removeEventListener("touchend",_._unlock,!0),window.document.removeEventListener("touchstart",_._unlock,!0),_._unlocked=!0))}static initWebAudio(){"running"!=_.ctx.state&&(_._unlock(),window.document.addEventListener("mousedown",_._unlock,!0),window.document.addEventListener("touchend",_._unlock,!0),window.document.addEventListener("touchstart",_._unlock,!0))}load(t){var e=this;if(t=l.a.formatURL(t),this.url=t,this.audioBuffer=_._dataCache[t],this.audioBuffer)this._loaded(this.audioBuffer);else if(_.e.on("loaded:"+t,this,this._loaded),_.e.on("err:"+t,this,this._err),!_.__loadingSound[t]){_.__loadingSound[t]=!0;var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){e._disposed?e._removeLoadEvents():(e.data=i.response,_.buffs.push({buffer:e.data,url:e.url}),_.decode())},i.onerror=function(t){e._err()},i.send()}}_err(){this._removeLoadEvents(),_.__loadingSound[this.url]=!1,this.event(n.a.ERROR)}_loaded(t){this._removeLoadEvents(),this._disposed||(this.audioBuffer=t,_._dataCache[this.url]=this.audioBuffer,this.loaded=!0,this.event(n.a.COMPLETE))}_removeLoadEvents(){_.e.off("loaded:"+this.url,this,this._loaded),_.e.off("err:"+this.url,this,this._err)}__playAfterLoaded(){if(this.__toPlays){var t,e,i,a;for(e=(i=this.__toPlays).length,t=0;t<e;t++)(a=i[t])[2]&&!a[2].isStopped&&this.play(a[0],a[1],a[2]);this.__toPlays.length=0}}play(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return i=i||new s.a,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([t,e,i]),this.once(n.a.COMPLETE,this,this.__playAfterLoaded),this.load(this.url)),i.url=this.url,i.loops=e,i.audioBuffer=this.audioBuffer,i.startTime=t,i.play(),h.a.SoundManager.addChannel(i),i}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}dispose(){this._disposed=!0,delete _._dataCache[this.url],delete _.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]}}e.a=_,r()(_,"_dataCache",{}),r()(_,"webAudioEnabled",window.AudioContext||window.webkitAudioContext||window.mozAudioContext),r()(_,"ctx",_.webAudioEnabled?new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext):void 0),r()(_,"buffs",[]),r()(_,"isDecoding",!1),r()(_,"_miniBuffer",_.ctx?_.ctx.createBuffer(1,1,22050):void 0),r()(_,"e",new o.a),r()(_,"_unlocked",!1),r()(_,"tInfo",void 0),r()(_,"__loadingSound",{})},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(27),n=i(6),o=i(23),l=i(21),h=i(19);class _ extends o.a{constructor(){super(...arguments),r()(this,"_http",new XMLHttpRequest),r()(this,"_responseType",void 0),r()(this,"_data",void 0),r()(this,"_url",void 0)}send(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"get",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"text",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._responseType=a,this._data=null,(h.a.onVVMiniGame||h.a.onQGMiniGame||h.a.onQQMiniGame||h.a.onAlipayMiniGame||h.a.onBLMiniGame||h.a.onHWMiniGame||h.a.onTTMiniGame||h.a.onTBMiniGame)&&(t=_._urlEncode(t)),this._url=t;var n=this,o=this._http;t=s.a.getAdptedFilePath(t),o.open(i,t,!0);let l=!1;if(r)for(var c=0;c<r.length;c++)o.setRequestHeader(r[c++],r[c]);else window.conch||(e&&"string"!=typeof e?(o.setRequestHeader("Content-Type","application/json"),l=!0):o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));let d="arraybuffer"!==a?"text":"arraybuffer";o.responseType=d,o.dataType&&(o.dataType=d),o.onerror=function(t){n._onError(t)},o.onabort=function(t){n._onAbort(t)},o.onprogress=function(t){n._onProgress(t)},o.onload=function(t){n._onLoad(t)},h.a.onBLMiniGame&&h.a.onAndroid&&!e&&(e={}),o.send(l?JSON.stringify(e):e)}_onProgress(t){t&&t.lengthComputable&&this.event(n.a.PROGRESS,t.loaded/t.total)}_onAbort(t){this.error("Request was aborted by user")}_onError(t){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)}_onLoad(t){var e=this._http,i=void 0!==e.status?e.status:200;200===i||204===i||0===i?this.complete():this.error("["+e.status+"]"+e.statusText+":"+e.responseURL)}error(t){this.clear(),console.warn(this.url,t),this.event(n.a.ERROR,t)}complete(){this.clear();var t=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=l.a.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(e){t=!1,this.error(e.message)}t&&this.event(n.a.COMPLETE,this._data instanceof Array?[this._data]:this._data)}clear(){var t=this._http;t.onerror=t.onabort=t.onprogress=t.onload=null}get url(){return this._url}get data(){return this._data}get http(){return this._http}}e.a=_,r()(_,"_urlEncode",encodeURI)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(3),n=i(6),o=i(23),l=i(27),h=i(17),_=i(48),c=i(43),d=i(21),u=i(368),f=i(12);class m extends o.a{getProgress(){return this._statInfo.loaded/this._statInfo.count}resetProgress(){this._statInfo.count=this._statInfo.loaded=1}constructor(){super(),r()(this,"retryNum",1),r()(this,"retryDelay",0),r()(this,"maxLoader",5),r()(this,"_loaders",[]),r()(this,"_loaderCount",0),r()(this,"_resInfos",[]),r()(this,"_infoPool",[]),r()(this,"_maxPriority",5),r()(this,"_failRes",{}),r()(this,"_statInfo",{count:1,loaded:1});for(var t=0;t<this._maxPriority;t++)this._resInfos[t]=[]}create(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];this._create(t,!0,e,i,a,r,s,n,o)}_create(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if(t instanceof Array){var h=!0,_=t,d=_.length,u=0;if(a)var f=c.a.create(a.caller,a?a.method:null,a.args,!1);for(var m=0;m<d;m++){var p=_[m];"string"==typeof p&&(p=_[m]={url:p}),p.progress=0}for(m=0;m<d;m++){p=_[m];var g=a?c.a.create(null,function(t,e){t.progress=e;for(var i=0,a=0;a<d;a++){i+=_[a].progress}var r=i/d;f.runWith(r)},[p],!1):null,v=a||i?c.a.create(null,function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;u++,t.progress=1,e||(h=!1),u===d&&i&&i.runWith(h)},[p]):null;this._createOne(p.url,e,v,g,p.type||r,p.constructParams||s,p.propertyParams||n,p.priority||o,l)}}else this._createOne(t,e,i,a,r,s,n,o,l)}_createOne(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,_=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];var u=this.getRes(t);if(u)!e&&u instanceof h.a&&u._addReference(),a&&a.runWith(1),i&&i.runWith(u);else{var p=m.createMap[d.a.getFilecompatibleExtension(t)]?d.a.getFilecompatibleExtension(t):d.a.getFileExtension(t);if(r||(r=m.createMap[p]?m.createMap[p][0]:null),!r)return void this.load(t,i,a,r,l,_);if(!f.a.parserMap[r])return void this.load(t,i,a,r,l,_);this._createLoad(t,c.a.create(null,function(a){a&&(!e&&a instanceof h.a&&a._addReference(),a._setCreateURL(t)),i&&i.runWith(a),s.a.loader.event(t)}),a,r,n,o,l,_,!0)}}load(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,_=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:s.a.WorkerLoader.enable;if(t instanceof Array)return this._loadAssets(t,e,i,a,r,o,h);var d;if(d=a===f.a.IMAGE?f.a.textureMap[l.a.formatURL(t)]:f.a.loadedMap[l.a.formatURL(t)],_||null==d){var g;g=t,(t=u.a.getFileLoadPath(t))!=g&&"nativeimage"!==a?a=f.a.ATLAS:g=null;var v=m._resMap[t];v?(e&&(g?e&&v._createListener(n.a.COMPLETE,this,this._resInfoLoaded,[g,e],!1,!1):e&&v._createListener(n.a.COMPLETE,e.caller,e.method,e.args,!1,!1)),i&&v._createListener(n.a.PROGRESS,i.caller,i.method,i.args,!1,!1)):((v=this._infoPool.length?this._infoPool.pop():new p).url=t,v.type=a,v.cache=o,v.group=h,v.ignoreCache=_,v.useWorkerLoader=c,v.originalUrl=g,e&&v.on(n.a.COMPLETE,e.caller,e.method,e.args),i&&v.on(n.a.PROGRESS,i.caller,i.method,i.args),m._resMap[t]=v,r=r<this._maxPriority?r:this._maxPriority-1,this._resInfos[r].push(v),this._statInfo.count++,this.event(n.a.PROGRESS,this.getProgress()),this._next())}else s.a.systemTimer.callLater(this,function(){i&&i.runWith(1),e&&e.runWith(d instanceof Array?[d]:d),this._loaderCount||this.event(n.a.COMPLETE)});return this}_resInfoLoaded(t,e){e.runWith(f.a.getRes(t))}_createLoad(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,h=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],_=arguments.length>8&&void 0!==arguments[8]&&arguments[8];if(t instanceof Array)return this._loadAssets(t,e,i,a,l,h);var c=f.a.getRes(t);if(null!=c)s.a.systemTimer.frameOnce(1,this,function(){i&&i.runWith(1),e&&e.runWith(c),this._loaderCount||this.event(n.a.COMPLETE)});else{var d=m._resMap[t];d?(e&&d._createListener(n.a.COMPLETE,e.caller,e.method,e.args,!1,!1),i&&d._createListener(n.a.PROGRESS,i.caller,i.method,i.args,!1,!1)):((d=this._infoPool.length?this._infoPool.pop():new p).url=t,d.type=a,d.cache=!1,d.ignoreCache=_,d.originalUrl=null,d.group=null,d.createCache=h,d.createConstructParams=r,d.createPropertyParams=o,e&&d.on(n.a.COMPLETE,e.caller,e.method,e.args),i&&d.on(n.a.PROGRESS,i.caller,i.method,i.args),m._resMap[t]=d,l=l<this._maxPriority?l:this._maxPriority-1,this._resInfos[l].push(d),this._statInfo.count++,this.event(n.a.PROGRESS,this.getProgress()),this._next())}return this}_next(){if(!(this._loaderCount>=this.maxLoader)){for(var t=0;t<this._maxPriority;t++)for(var e=this._resInfos[t];e.length>0;){var i=e.shift();if(i)return this._doLoad(i)}this._loaderCount||this.event(n.a.COMPLETE)}}_doLoad(t){this._loaderCount++;var e=this._loaders.length?this._loaders.pop():new f.a;e.on(n.a.COMPLETE,null,a),e.on(n.a.PROGRESS,null,function(e){t.event(n.a.PROGRESS,e)}),e.on(n.a.ERROR,null,function(t){a(null)});var i=this;function a(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e.offAll(),e._data=null,e._customParse=!1,i._loaders.push(e),i._endLoad(t,a instanceof Array?[a]:a),i._loaderCount--,i._next()}e._constructParams=t.createConstructParams,e._propertyParams=t.createPropertyParams,e._createCache=t.createCache,e.load(t.url,t.type,t.cache,t.group,t.ignoreCache,t.useWorkerLoader)}_endLoad(t,e){var i=t.url;if(null==e){var a=this._failRes[i]||0;if(a<this.retryNum)return console.warn("[warn]Retry to load:",i),this._failRes[i]=a+1,void s.a.systemTimer.once(this.retryDelay,this,this._addReTry,[t],!1);f.a.clearRes(i),console.warn("[error]Failed to load:",i),this.event(n.a.ERROR,i)}this._failRes[i]&&(this._failRes[i]=0),delete m._resMap[i],t.originalUrl&&(e=f.a.getRes(t.originalUrl)),t.event(n.a.COMPLETE,e),t.offAll(),this._infoPool.push(t),this._statInfo.loaded++,this.event(n.a.PROGRESS,this.getProgress())}_addReTry(t){this._resInfos[this._maxPriority-1].push(t),this._next()}clearRes(t){f.a.clearRes(t)}clearTextureRes(t){f.a.clearTextureRes(t)}getRes(t){return f.a.getRes(t)}cacheRes(t,e){f.a.cacheRes(t,e)}setGroup(t,e){f.a.setGroup(t,e)}clearResByGroup(t){f.a.clearResByGroup(t)}static cacheRes(t,e){f.a.cacheRes(t,e)}clearUnLoaded(){for(var t=0;t<this._maxPriority;t++){for(var e=this._resInfos[t],i=e.length-1;i>-1;i--){var a=e[i];a&&(a.offAll(),this._infoPool.push(a))}e.length=0}this._loaderCount=0,m._resMap={}}cancelLoadByUrls(t){if(t)for(var e=0,i=t.length;e<i;e++)this.cancelLoadByUrl(t[e])}cancelLoadByUrl(t){for(var e=0;e<this._maxPriority;e++)for(var i=this._resInfos[e],a=i.length-1;a>-1;a--){var r=i[a];r&&r.url===t&&(i[a]=null,r.offAll(),this._infoPool.push(r))}m._resMap[t]&&delete m._resMap[t]}_loadAssets(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;for(var o=t.length,l=0,h=0,_=[],d=!0,u=0;u<o;u++){let o,l=t[u];(o="string"==typeof l?{url:l,type:a,size:1,priority:r}:l).size||(o.size=1),o.progress=0,h+=o.size,_.push(o);var f=i?c.a.create(null,g,[o],!1):null,m=e||i?c.a.create(null,p,[o]):null;this.load(o.url,m,f,o.type,o.priority||1,s,o.group||n,!1,o.useWorkerLoader)}function p(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;l++,t.progress=1,i||(d=!1),l===o&&e&&e.runWith(d)}function g(t,e){if(null!=i){t.progress=e;for(var a=0,r=0;r<_.length;r++){var s=_[r];if(s){let t=void 0==s.progress?0:s.progress;a+=void 0==s.size?0:s.size*t}}var n=a/h;i.runWith(n)}}return this}decodeBitmaps(t){var e,i,a=t.length;for(i=s.a.Render._context,e=0;e<a;e++){var r,n;if(r=f.a.getAtlas(t[e]))this._decodeTexture(r[0],i);else(n=this.getRes(t[e]))&&n instanceof _.a&&this._decodeTexture(n,i)}}_decodeTexture(t,e){var i=t.bitmap;if(t&&i){var a=i.source||i.image;if(a&&a instanceof HTMLImageElement){e.drawImage(a,0,0,1,1);e.getImageData(0,0,1,1)}}}}e.a=m,r()(m,"_resMap",{}),r()(m,"createMap",{atlas:[null,f.a.ATLAS]});class p extends o.a{constructor(){super(...arguments),r()(this,"url",void 0),r()(this,"type",void 0),r()(this,"cache",void 0),r()(this,"group",void 0),r()(this,"ignoreCache",void 0),r()(this,"useWorkerLoader",void 0),r()(this,"originalUrl",void 0),r()(this,"createCache",void 0),r()(this,"createConstructParams",void 0),r()(this,"createPropertyParams",void 0)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{static linearNone(t,e,i,a){return i*t/a+e}static linearIn(t,e,i,a){return i*t/a+e}static linearInOut(t,e,i,a){return i*t/a+e}static linearOut(t,e,i,a){return i*t/a+e}static bounceIn(t,e,i,a){return i-s.bounceOut(a-t,0,i,a)+e}static bounceInOut(t,e,i,a){return t<.5*a?.5*s.bounceIn(2*t,0,i,a)+e:.5*s.bounceOut(2*t-a,0,i,a)+.5*i+e}static bounceOut(t,e,i,a){return(t/=a)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e}static backIn(t,e,i,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return i*(t/=a)*t*((r+1)*t-r)+e}static backInOut(t,e,i,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return(t/=.5*a)<1?.5*i*(t*t*((1+(r*=1.525))*t-r))+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e}static backOut(t,e,i,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return i*((t=t/a-1)*t*((r+1)*t+r)+1)+e}static elasticIn(t,e,i,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;var o;return 0==t?e:1==(t/=a)?e+i:(n||(n=.3*a),!r||i>0&&r<i||i<0&&r<-i?(r=i,o=n/4):o=n/s.PI2*Math.asin(i/r),-r*Math.pow(2,10*(t-=1))*Math.sin((t*a-o)*s.PI2/n)+e)}static elasticInOut(t,e,i,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;var o;return 0==t?e:2==(t/=.5*a)?e+i:(n||(n=a*(.3*1.5)),!r||i>0&&r<i||i<0&&r<-i?(r=i,o=n/4):o=n/s.PI2*Math.asin(i/r),t<1?r*Math.pow(2,10*(t-=1))*Math.sin((t*a-o)*s.PI2/n)*-.5+e:r*Math.pow(2,-10*(t-=1))*Math.sin((t*a-o)*s.PI2/n)*.5+i+e)}static elasticOut(t,e,i,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;var o;return 0==t?e:1==(t/=a)?e+i:(n||(n=.3*a),!r||i>0&&r<i||i<0&&r<-i?(r=i,o=n/4):o=n/s.PI2*Math.asin(i/r),r*Math.pow(2,-10*t)*Math.sin((t*a-o)*s.PI2/n)+i+e)}static strongIn(t,e,i,a){return i*(t/=a)*t*t*t*t+e}static strongInOut(t,e,i,a){return(t/=.5*a)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e}static strongOut(t,e,i,a){return i*((t=t/a-1)*t*t*t*t+1)+e}static sineInOut(t,e,i,a){return.5*-i*(Math.cos(Math.PI*t/a)-1)+e}static sineIn(t,e,i,a){return-i*Math.cos(t/a*s.HALF_PI)+i+e}static sineOut(t,e,i,a){return i*Math.sin(t/a*s.HALF_PI)+e}static quintIn(t,e,i,a){return i*(t/=a)*t*t*t*t+e}static quintInOut(t,e,i,a){return(t/=.5*a)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e}static quintOut(t,e,i,a){return i*((t=t/a-1)*t*t*t*t+1)+e}static quartIn(t,e,i,a){return i*(t/=a)*t*t*t+e}static quartInOut(t,e,i,a){return(t/=.5*a)<1?.5*i*t*t*t*t+e:.5*-i*((t-=2)*t*t*t-2)+e}static quartOut(t,e,i,a){return-i*((t=t/a-1)*t*t*t-1)+e}static cubicIn(t,e,i,a){return i*(t/=a)*t*t+e}static cubicInOut(t,e,i,a){return(t/=.5*a)<1?.5*i*t*t*t+e:.5*i*((t-=2)*t*t+2)+e}static cubicOut(t,e,i,a){return i*((t=t/a-1)*t*t+1)+e}static quadIn(t,e,i,a){return i*(t/=a)*t+e}static quadInOut(t,e,i,a){return(t/=.5*a)<1?.5*i*t*t+e:.5*-i*(--t*(t-2)-1)+e}static quadOut(t,e,i,a){return-i*(t/=a)*(t-2)+e}static expoIn(t,e,i,a){return 0==t?e:i*Math.pow(2,10*(t/a-1))+e-.001*i}static expoInOut(t,e,i,a){return 0==t?e:t==a?e+i:(t/=.5*a)<1?.5*i*Math.pow(2,10*(t-1))+e:.5*i*(2-Math.pow(2,-10*--t))+e}static expoOut(t,e,i,a){return t==a?e+i:i*(1-Math.pow(2,-10*t/a))+e}static circIn(t,e,i,a){return-i*(Math.sqrt(1-(t/=a)*t)-1)+e}static circInOut(t,e,i,a){return(t/=.5*a)<1?.5*-i*(Math.sqrt(1-t*t)-1)+e:.5*i*(Math.sqrt(1-(t-=2)*t)+1)+e}static circOut(t,e,i,a){return i*Math.sqrt(1-(t=t/a-1)*t)+e}}e.a=s,r()(s,"HALF_PI",.5*Math.PI),r()(s,"PI2",2*Math.PI)},function(t,e,i){var a=i(213),r=i(155);t.exports=Object.keys||function(t){return a(t,r)}},function(t,e,i){var a=i(76).f,r=i(89),s=i(35)("toStringTag");t.exports=function(t,e,i){t&&!r(t=i?t:t.prototype,s)&&a(t,s,{configurable:!0,value:e})}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(21),n=i(3);class o{static __init__(){o.I=new o,o.supportWeakMap||n.a.systemTimer.loop(o.delInterval,null,o.clearCache)}static clearCache(){for(var t=0,e=o._maps.length;t<e;t++){o._maps[t]._obj={}}}constructor(){r()(this,"_obj",void 0),this._obj={},o._maps.push(this)}set(t,e){null!=t&&(o.supportWeakMap||("string"==typeof t||"number"==typeof t?this._obj[t]=e:(t.$_GID||(t.$_GID=s.a.getGID()),this._obj[t.$_GID]=e)))}get(t){return null==t?null:o.supportWeakMap?void 0:"string"==typeof t||"number"==typeof t?this._obj[t]:this._obj[t.$_GID]}del(t){null!=t&&(o.supportWeakMap||("string"==typeof t||"number"==typeof t?delete this._obj[t]:delete this._obj[this._obj.$_GID]))}has(t){return null!=t&&(o.supportWeakMap?void 0:"string"==typeof t||"number"==typeof t?null!=this._obj[t]:null!=this._obj[this._obj.$_GID])}}e.a=o,r()(o,"supportWeakMap",!1),r()(o,"delInterval",6e5),r()(o,"I",void 0),r()(o,"_maps",[])},function(t,e,i){"use strict";var a=i(28),r=(i.n(a),i(0)),s=i.n(r),n=i(3);class o{constructor(t){s()(this,"childs",[]),s()(this,"text",""),s()(this,"parent",void 0),s()(this,"name",void 0),s()(this,"noCompile",void 0),s()(this,"includefiles",void 0),s()(this,"condition",void 0),s()(this,"conditionType",void 0),s()(this,"useFuns",""),s()(this,"z",0),s()(this,"src",void 0),this.includefiles=t}setParent(t){t.childs.push(this),this.z=t.z+1,this.parent=t}setCondition(t,e){t&&(this.conditionType=e,t=t.replace(/(\s*$)/g,""),this.condition=function(){return this[t]},this.condition.__condition=t)}toscript(t,e){return this._toscript(t,e,++o.__id)}_toscript(t,e,i){if(this.childs.length<1&&!this.text)return e;e.length;if(this.condition){var a=!!this.condition.call(t);if(this.conditionType===n.a.ShaderCompile.IFDEF_ELSE&&(a=!a),!a)return e}if(this.noCompile&&this.text&&e.push(this.text),this.childs.length>0&&this.childs.forEach(function(a,r,s){a._toscript(t,e,i)}),this.includefiles.length>0&&this.useFuns.length>0)for(var r,s=0,o=this.includefiles.length;s<o;s++)this.includefiles[s].curUseID!=i&&(r=this.includefiles[s].file.getFunsScript(this.useFuns)).length>0&&(this.includefiles[s].curUseID=i,e[0]=r+e[0]);return e}}e.a=o,s()(o,"__id",1)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1);class n{static createRotationQuaternion(t,e){var i=t.x,a=t.y,r=t.z,s=t.w,n=i*i,o=a*a,l=r*r,h=i*a,_=r*s,c=r*i,d=a*s,u=a*r,f=i*s,m=e.elements;m[0]=1-2*(o+l),m[1]=2*(h+_),m[2]=2*(c-d),m[3]=2*(h-_),m[4]=1-2*(l+n),m[5]=2*(u+f),m[6]=2*(c+d),m[7]=2*(u-f),m[8]=1-2*(o+n)}static createFromTranslation(t,e){var i=e.elements;i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=t.x,i[7]=t.y,i[8]=1}static createFromRotation(t,e){var i=e.elements,a=Math.sin(t),r=Math.cos(t);i[0]=r,i[1]=a,i[2]=0,i[3]=-a,i[4]=r,i[5]=0,i[6]=0,i[7]=0,i[8]=1}static createFromScaling(t,e){var i=e.elements;i[0]=t.x,i[1]=0,i[2]=0,i[3]=0,i[4]=t.y,i[5]=0,i[6]=0,i[7]=0,i[8]=t.z}static createFromMatrix4x4(t,e){var i=t.elements,a=e.elements;a[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=i[4],a[4]=i[5],a[5]=i[6],a[6]=i[8],a[7]=i[9],a[8]=i[10]}static multiply(t,e,i){var a=t.elements,r=e.elements,s=i.elements,n=a[0],o=a[1],l=a[2],h=a[3],_=a[4],c=a[5],d=a[6],u=a[7],f=a[8],m=r[0],p=r[1],g=r[2],v=r[3],T=r[4],E=r[5],S=r[6],R=r[7],x=r[8];s[0]=m*n+p*h+g*d,s[1]=m*o+p*_+g*R,s[2]=m*l+p*c+g*f,s[3]=v*n+T*h+E*d,s[4]=v*o+T*_+E*u,s[5]=v*l+T*c+E*f,s[6]=S*n+R*h+x*d,s[7]=S*o+R*_+x*u,s[8]=S*l+R*c+x*f}constructor(){r()(this,"elements",void 0);var t=this.elements=new Float32Array(9);t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}determinant(){var t=this.elements,e=t[0],i=t[1],a=t[2],r=t[3],s=t[4],n=t[5],o=t[6],l=t[7],h=t[8];return e*(h*s-n*l)+i*(-h*r+n*o)+a*(l*r-s*o)}translate(t,e){var i=e.elements,a=this.elements,r=a[0],s=a[1],n=a[2],o=a[3],l=a[4],h=a[5],_=a[6],c=a[7],d=a[8],u=t.x,f=t.y;i[0]=r,i[1]=s,i[2]=n,i[3]=o,i[4]=l,i[5]=h,i[6]=u*r+f*o+_,i[7]=u*s+f*l+c,i[8]=u*n+f*h+d}rotate(t,e){var i=e.elements,a=this.elements,r=a[0],s=a[1],n=a[2],o=a[3],l=a[4],h=a[5],_=a[6],c=a[7],d=a[8],u=Math.sin(t),f=Math.cos(t);i[0]=f*r+u*o,i[1]=f*s+u*l,i[2]=f*n+u*h,i[3]=f*o-u*r,i[4]=f*l-u*s,i[5]=f*h-u*n,i[6]=_,i[7]=c,i[8]=d}scale(t,e){var i=e.elements,a=this.elements,r=t.x,s=t.y;i[0]=r*a[0],i[1]=r*a[1],i[2]=r*a[2],i[3]=s*a[3],i[4]=s*a[4],i[5]=s*a[5],i[6]=a[6],i[7]=a[7],i[8]=a[8]}invert(t){var e=t.elements,i=this.elements,a=i[0],r=i[1],s=i[2],n=i[3],o=i[4],l=i[5],h=i[6],_=i[7],c=i[8],d=c*o-l*_,u=-c*n+l*h,f=_*n-o*h,m=a*d+r*u+s*f;m||(t=null),m=1/m,e[0]=d*m,e[1]=(-c*r+s*_)*m,e[2]=(l*r-s*o)*m,e[3]=u*m,e[4]=(c*a-s*h)*m,e[5]=(-l*a+s*n)*m,e[6]=f*m,e[7]=(-_*a+r*h)*m,e[8]=(o*a-r*n)*m}transpose(t){var e=t.elements,i=this.elements;if(t===this){var a=i[1],r=i[2],s=i[5];e[1]=i[3],e[2]=i[6],e[3]=a,e[5]=i[7],e[6]=r,e[7]=s}else e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8]}identity(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}cloneTo(t){var e,i,a;if((i=this.elements)!==(a=t.elements))for(e=0;e<9;++e)a[e]=i[e]}clone(){var t=new n;return this.cloneTo(t),t}static lookAt(t,e,i,a){s.a.subtract(t,e,n._tempV30),s.a.normalize(n._tempV30,n._tempV30),s.a.cross(i,n._tempV30,n._tempV31),s.a.normalize(n._tempV31,n._tempV31),s.a.cross(n._tempV30,n._tempV31,n._tempV32);var r=n._tempV30,o=n._tempV31,l=n._tempV32,h=a.elements;h[0]=o.x,h[3]=o.y,h[6]=o.z,h[1]=l.x,h[4]=l.y,h[7]=l.z,h[2]=r.x,h[5]=r.y,h[8]=r.z}}e.a=n,r()(n,"DEFAULT",new n),r()(n,"_tempV30",new s.a),r()(n,"_tempV31",new s.a),r()(n,"_tempV32",new s.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(123);class n extends s.a{static __init__(){n._btSize=new CANNON.Vec3}get sizeX(){return this._sizeX}get sizeY(){return this._sizeY}get sizeZ(){return this._sizeZ}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(),r()(this,"_sizeX",void 0),r()(this,"_sizeY",void 0),r()(this,"_sizeZ",void 0),this._sizeX=t,this._sizeY=e,this._sizeZ=i,this._type=s.a.SHAPETYPES_BOX;var a=new CANNON.Vec3(t/2,e/2,i/2);this._btShape=new CANNON.Box(a)}_setScale(t){this._scale.setValue(t.x,t.y,t.z),this._btShape.halfExtents.set(this.sizeX/2*t.x,this.sizeY/2*t.y,this.sizeZ/2*t.z),this._btShape.updateConvexPolyhedronRepresentation(),this._btShape.updateBoundingSphereRadius()}clone(){var t=new n(this._sizeX,this._sizeY,this._sizeZ);return this.cloneTo(t),t}}e.a=n,r()(n,"_btSize",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(8),n=i(1),o=i(51),l=i(399),h=i(400),_=i(124);class c{static __init__(){c._btTempVector30=new CANNON.Vec3(0,0,0),c._btTempVector31=new CANNON.Vec3(0,0,0)}static createConstraint(){}get continuousCollisionDetection(){return!1}set continuousCollisionDetection(t){throw"Simulation:Cannon physical engine does not support this feature"}get gravity(){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";return this._gravity}set gravity(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._gravity=t,this._btDiscreteDynamicsWorld.gravity.set(t.x,t.y,t.z)}get solverIterations(){if(!this._btDiscreteDynamicsWorld||!this._btDiscreteDynamicsWorld.solver)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";return this._iterations}set solverIterations(t){if(!this._btDiscreteDynamicsWorld||!this._btDiscreteDynamicsWorld.solver)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._btDiscreteDynamicsWorld.solver.iterations=t,this._iterations=t}get speculativeContactRestitution(){return!1}set speculativeContactRestitution(t){}constructor(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];r()(this,"_btDiscreteDynamicsWorld",void 0),r()(this,"_btBroadphase",void 0),r()(this,"_gravity",new n.a(0,-10,0)),r()(this,"_iterations",void 0),r()(this,"_btClosestRayResultCallback",new CANNON.RaycastResult),r()(this,"_btRayoption",{}),r()(this,"_collisionsUtils",new h.a),r()(this,"_previousFrameCollisions",[]),r()(this,"_currentFrameCollisions",[]),r()(this,"_physicsUpdateList",new l.a),r()(this,"_updatedRigidbodies",0),r()(this,"maxSubSteps",1),r()(this,"fixedTimeStep",1/60),this.maxSubSteps=t.maxSubSteps,this.fixedTimeStep=t.fixedTimeStep,this._btDiscreteDynamicsWorld=new CANNON.World,this._btBroadphase=new CANNON.NaiveBroadphase,this._btDiscreteDynamicsWorld.broadphase=this._btBroadphase,this._btDiscreteDynamicsWorld.defaultContactMaterial.contactEquationRelaxation=t.contactEquationRelaxation,this._btDiscreteDynamicsWorld.defaultContactMaterial.contactEquationStiffness=t.contactEquationStiffness,this.gravity=this._gravity}_simulate(t){this._updatedRigidbodies=0,this._btDiscreteDynamicsWorld&&(this._btDiscreteDynamicsWorld.callBackBody.length=0,this._btDiscreteDynamicsWorld.allContacts.length=0,this._btDiscreteDynamicsWorld.step(this.fixedTimeStep,t,this.maxSubSteps));for(var e=this._btDiscreteDynamicsWorld.callBackBody,i=0,a=e.length;i<a;i++){var r=e[i],s=_.a._physicObjectsMap[r.layaID];s._simulation._updatedRigidbodies++,s._updateTransformComponent(s._btColliderObject)}}_destroy(){this._btDiscreteDynamicsWorld=null,this._btBroadphase=null}_addPhysicsCollider(t){this._btDiscreteDynamicsWorld.addBody(t._btColliderObject)}_removePhysicsCollider(t){this._btDiscreteDynamicsWorld.removeBody(t._btColliderObject)}_addRigidBody(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._btDiscreteDynamicsWorld.addBody(t._btColliderObject)}_removeRigidBody(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._btDiscreteDynamicsWorld.removeBody(t._btColliderObject)}raycastFromTo(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.a.COLLISIONFILTERGROUP_ALLFILTER,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o.a.COLLISIONFILTERGROUP_ALLFILTER;var s=this._btClosestRayResultCallback;s.hasHit=!1;var n=this._btRayoption,l=c._btTempVector30,h=c._btTempVector31;if(l.set(t.x,t.y,t.z),h.set(e.x,e.y,e.z),n.skipBackfaces=!0,n.collisionFilterMask=r,n.collisionFilterGroup=a,n.result=s,this._btDiscreteDynamicsWorld.raycastClosest(l,h,n,s),s.hasHit){if(i){i.succeeded=!0,i.collider=_.a._physicObjectsMap[s.body.layaID];var d=i.point,u=i.normal,f=s.hitPointWorld,m=s.hitNormalWorld;d.setValue(f.x,f.y,f.z),u.setValue(m.x,m.y,m.z)}return!0}return i.succeeded=!1,!1}raycastAllFromTo(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.a.COLLISIONFILTERGROUP_ALLFILTER,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o.a.COLLISIONFILTERGROUP_ALLFILTER;var s=this._btRayoption,n=c._btTempVector30,l=c._btTempVector31;return n.set(t.x,t.y,t.z),l.set(e.x,e.y,e.z),s.skipBackfaces=!0,s.collisionFilterMask=r,s.collisionFilterGroup=a,i.length=0,this._btDiscreteDynamicsWorld.raycastAll(n,l,s,function(t){var e=this._collisionsUtils.getHitResult();i.push(e),e.succeeded=!0,e.collider=_.a._physicObjectsMap[t.body.layaID];var a=e.point,r=e.normal,s=t.hitPointWorld,n=t.hitNormalWorld;a.setValue(s.x,s.y,s.z),r.setValue(n.x,n.y,n.z)}),0!=i.length}rayCast(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2147483647,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.a.COLLISIONFILTERGROUP_ALLFILTER,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o.a.COLLISIONFILTERGROUP_ALLFILTER;var s=t.origin,l=c._tempVector30;return n.a.normalize(t.direction,l),n.a.scale(l,i,l),n.a.add(s,l,l),this.raycastFromTo(s,l,e,a,r)}rayCastAll(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2147483647,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.a.COLLISIONFILTERGROUP_ALLFILTER,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o.a.COLLISIONFILTERGROUP_ALLFILTER;var s=t.origin,l=c._tempVector30;return n.a.normalize(t.direction,l),n.a.scale(l,i,l),n.a.add(s,l,l),this.raycastAllFromTo(s,l,e,a,r)}_updatePhysicsTransformFromRender(){for(var t=this._physicsUpdateList.elements,e=0,i=this._physicsUpdateList.length;e<i;e++){var a=t[e];a._derivePhysicsTransformation(!1),a._inPhysicUpdateListIndex=-1}this._physicsUpdateList.length=0}_updateCollisions(){this._collisionsUtils.recoverAllContactPointsPool();var t=this._currentFrameCollisions;this._currentFrameCollisions=this._previousFrameCollisions,this._currentFrameCollisions.length=0,this._previousFrameCollisions=t;for(var e=s.a.loopCount,i=this._btDiscreteDynamicsWorld.allContacts,a=i.length,r=0;r<a;r++){var n,o=i[r],l=_.a._physicObjectsMap[o.bi.layaID],h=_.a._physicObjectsMap[o.bj.layaID],c=null,d=null;if((l.isTrigger||h.isTrigger)&&(l.owner._needProcessTriggers||h.owner._needProcessTriggers))d=(c=this._collisionsUtils.getCollision(l,h)).contacts,(n=c._updateFrame!==e)&&(c._isTrigger=!0,d.length=0);else if((l.owner._needProcessCollisions||h.owner._needProcessCollisions)&&(l._enableProcessCollisions||h._enableProcessCollisions)){var u=this._collisionsUtils.getContactPoints();u.colliderA=l,u.colliderB=h;var f=u.normal,m=u.positionOnA,p=u.positionOnB,g=o.ni,v=o.ri,T=o.rj;f.setValue(g.x,g.y,g.z),m.setValue(v.x,v.y,v.z),p.setValue(T.x,T.y,-T.z),d=(c=this._collisionsUtils.getCollision(l,h)).contacts,(n=c._updateFrame!==e)&&(c._isTrigger=!1,d.length=0),d.push(u)}c&&n&&(this._currentFrameCollisions.push(c),c._setUpdateFrame(e))}}_eventScripts(){for(var t=s.a.loopCount,e=0,i=this._currentFrameCollisions.length;e<i;e++){var a=this._currentFrameCollisions[e],r=a._colliderA,n=a._colliderB;if(!r.destroyed&&!n.destroyed)if(t-a._lastUpdateFrame==1){var o=r.owner,l=o._scripts;if(l)if(a._isTrigger){if(o._needProcessTriggers)for(var h=0,_=l.length;h<_;h++)l[h].onTriggerStay(n)}else if(o._needProcessCollisions)for(h=0,_=l.length;h<_;h++)a.other=n,l[h].onCollisionStay(a);var c=n.owner,d=c._scripts;if(d)if(a._isTrigger){if(c._needProcessTriggers)for(h=0,_=d.length;h<_;h++)d[h].onTriggerStay(r)}else if(c._needProcessCollisions)for(h=0,_=d.length;h<_;h++)a.other=r,d[h].onCollisionStay(a)}else{if(l=(o=r.owner)._scripts)if(a._isTrigger){if(o._needProcessTriggers)for(h=0,_=l.length;h<_;h++)l[h].onTriggerEnter(n)}else if(o._needProcessCollisions)for(h=0,_=l.length;h<_;h++)a.other=n,l[h].onCollisionEnter(a);if(d=(c=n.owner)._scripts)if(a._isTrigger){if(c._needProcessTriggers)for(h=0,_=d.length;h<_;h++)d[h].onTriggerEnter(r)}else if(c._needProcessCollisions)for(h=0,_=d.length;h<_;h++)a.other=r,d[h].onCollisionEnter(a)}}for(e=0,i=this._previousFrameCollisions.length;e<i;e++){var u=this._previousFrameCollisions[e],f=u._colliderA,m=u._colliderB;if(!f.destroyed&&!m.destroyed&&t-u._updateFrame==1){if(this._collisionsUtils.recoverCollision(u),l=(o=f.owner)._scripts)if(u._isTrigger){if(o._needProcessTriggers)for(h=0,_=l.length;h<_;h++)l[h].onTriggerExit(m)}else if(o._needProcessCollisions)for(h=0,_=l.length;h<_;h++)u.other=m,l[h].onCollisionExit(u);if(d=(c=m.owner)._scripts)if(u._isTrigger){if(c._needProcessTriggers)for(h=0,_=d.length;h<_;h++)d[h].onTriggerExit(f)}else if(c._needProcessCollisions)for(h=0,_=d.length;h<_;h++)u.other=f,d[h].onCollisionExit(u)}}}clearForces(){if(!this._btDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly"}}e.a=c,r()(c,"PHYSICSENGINEFLAGS_NONE",0),r()(c,"PHYSICSENGINEFLAGS_COLLISIONSONLY",1),r()(c,"PHYSICSENGINEFLAGS_SOFTBODYSUPPORT",2),r()(c,"PHYSICSENGINEFLAGS_MULTITHREADED",4),r()(c,"PHYSICSENGINEFLAGS_USEHARDWAREWHENPOSSIBLE",8),r()(c,"SOLVERMODE_RANDMIZE_ORDER",1),r()(c,"SOLVERMODE_FRICTION_SEPARATE",2),r()(c,"SOLVERMODE_USE_WARMSTARTING",4),r()(c,"SOLVERMODE_USE_2_FRICTION_DIRECTIONS",16),r()(c,"SOLVERMODE_ENABLE_FRICTION_DIRECTION_CACHING",32),r()(c,"SOLVERMODE_DISABLE_VELOCITY_DEPENDENT_FRICTION_DIRECTION",64),r()(c,"SOLVERMODE_CACHE_FRIENDLY",128),r()(c,"SOLVERMODE_SIMD",256),r()(c,"SOLVERMODE_INTERLEAVE_CONTACT_AND_FRICTION_CONSTRAINTS",512),r()(c,"SOLVERMODE_ALLOW_ZERO_LENGTH_FRICTION_DIRECTIONS",1024),r()(c,"_btTempVector30",void 0),r()(c,"_btTempVector31",void 0),r()(c,"_tempVector30",new n.a),r()(c,"disableSimulation",!1)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(53),n=i(11);class o extends s.a{static __init__(){var t=n.a.Physics3D._bullet;o._btVector3One=t.btVector3_create(1,1,1),o._btTransform=t.btTransform_create(),o._btOffset=t.btVector3_create(0,0,0),o._btRotation=t.btQuaternion_create(0,0,0,1)}constructor(){super(),r()(this,"_childColliderShapes",[]),this._type=s.a.SHAPETYPES_COMPOUND,this._btShape=n.a.Physics3D._bullet.btCompoundShape_create()}_clearChildShape(t){t._attatched=!1,t._compoundParent=null,t._indexInCompound=-1}_addReference(){}_removeReference(){}_updateChildTransform(t){var e=n.a.Physics3D._bullet,i=t.localOffset,a=t.localRotation,r=s.a._btVector30,o=s.a._btQuaternion0,l=s.a._btTransform0;e.btVector3_setValue(r,-i.x,i.y,i.z),e.btQuaternion_setValue(o,-a.x,a.y,a.z,-a.w),e.btTransform_setOrigin(l,r),e.btTransform_setRotation(l,o),e.btCompoundShape_updateChildTransform(this._btShape,t._indexInCompound,l,!0)}addChildShape(t){if(t._attatched)throw"CompoundColliderShape: this shape has attatched to other entity.";t._attatched=!0,t._compoundParent=this,t._indexInCompound=this._childColliderShapes.length,this._childColliderShapes.push(t);var e=t.localOffset,i=t.localRotation,a=n.a.Physics3D._bullet;a.btVector3_setValue(o._btOffset,-e.x,e.y,e.z),a.btQuaternion_setValue(o._btRotation,-i.x,i.y,i.z,-i.w),a.btTransform_setOrigin(o._btTransform,o._btOffset),a.btTransform_setRotation(o._btTransform,o._btRotation);var r=a.btCollisionShape_getLocalScaling(this._btShape);a.btCollisionShape_setLocalScaling(this._btShape,o._btVector3One),a.btCompoundShape_addChildShape(this._btShape,o._btTransform,t._btShape),a.btCollisionShape_setLocalScaling(this._btShape,r),this._attatchedCollisionObject&&(this._attatchedCollisionObject.colliderShape=this)}removeChildShape(t){if(t._compoundParent===this){var e=t._indexInCompound;this._clearChildShape(t);var i=this._childColliderShapes[this._childColliderShapes.length-1];i._indexInCompound=e,this._childColliderShapes[e]=i,this._childColliderShapes.pop(),n.a.Physics3D._bullet.btCompoundShape_removeChildShapeByIndex(this._btShape,e)}}clearChildShape(){for(var t=0,e=this._childColliderShapes.length;t<e;t++)this._clearChildShape(this._childColliderShapes[t]),n.a.Physics3D._bullet.btCompoundShape_removeChildShapeByIndex(this._btShape,0);this._childColliderShapes.length=0}getChildShapeCount(){return this._childColliderShapes.length}cloneTo(t){var e=t;e.clearChildShape();for(var i=0,a=this._childColliderShapes.length;i<a;i++)e.addChildShape(this._childColliderShapes[i].clone())}clone(){var t=new o;return this.cloneTo(t),t}destroy(){super.destroy();for(var t=0,e=this._childColliderShapes.length;t<e;t++){var i=this._childColliderShapes[t];0===i._referenceCount&&i.destroy()}}}e.a=o,r()(o,"_btVector3One",void 0),r()(o,"_btTransform",void 0),r()(o,"_btOffset",void 0),r()(o,"_btRotation",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(53),n=i(11);class o extends s.a{static __init__(){o._btSize=n.a.Physics3D._bullet.btVector3_create(0,0,0)}get sizeX(){return this._sizeX}get sizeY(){return this._sizeY}get sizeZ(){return this._sizeZ}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(),r()(this,"_sizeX",void 0),r()(this,"_sizeY",void 0),r()(this,"_sizeZ",void 0),this._sizeX=t,this._sizeY=e,this._sizeZ=i,this._type=s.a.SHAPETYPES_BOX;var a=n.a.Physics3D._bullet;a.btVector3_setValue(o._btSize,t/2,e/2,i/2),this._btShape=a.btBoxShape_create(o._btSize)}clone(){var t=new o(this._sizeX,this._sizeY,this._sizeZ);return this.cloneTo(t),t}}e.a=o,r()(o,"_btSize",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(53),n=i(11);class o extends s.a{static __init__(){o._btSize=n.a.Physics3D._bullet.btVector3_create(0,0,0)}get radius(){return this._radius}get height(){return this._height}get orientation(){return this._orientation}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.a.SHAPEORIENTATION_UPY;super(),r()(this,"_orientation",void 0),r()(this,"_radius",1),r()(this,"_height",.5),this._radius=t,this._height=e,this._orientation=i,this._type=s.a.SHAPETYPES_CYLINDER;var a=n.a.Physics3D._bullet;switch(i){case s.a.SHAPEORIENTATION_UPX:a.btVector3_setValue(o._btSize,e/2,t,t),this._btShape=a.btCylinderShapeX_create(o._btSize);break;case s.a.SHAPEORIENTATION_UPY:a.btVector3_setValue(o._btSize,t,e/2,t),this._btShape=a.btCylinderShape_create(o._btSize);break;case s.a.SHAPEORIENTATION_UPZ:a.btVector3_setValue(o._btSize,t,t,e/2),this._btShape=a.btCylinderShapeZ_create(o._btSize);break;default:throw"CapsuleColliderShape:unknown orientation."}}clone(){var t=new o(this._radius,this._height,this._orientation);return this.cloneTo(t),t}}e.a=o,r()(o,"_btSize",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1);e.a=class{constructor(){r()(this,"succeeded",!1),r()(this,"collider",null),r()(this,"point",new s.a),r()(this,"normal",new s.a),r()(this,"hitFraction",0)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1),n=i(51),o=i(13),l=i(62),h=i(11);class _ extends l.a{static __init__(){_._btTempVector30=h.a.Physics3D._bullet.btVector3_create(0,0,0)}get fallSpeed(){return this._fallSpeed}set fallSpeed(t){this._fallSpeed=t,h.a.Physics3D._bullet.btKinematicCharacterController_setFallSpeed(this._btKinematicCharacter,t)}get jumpSpeed(){return this._jumpSpeed}set jumpSpeed(t){this._jumpSpeed=t,h.a.Physics3D._bullet.btKinematicCharacterController_setJumpSpeed(this._btKinematicCharacter,t)}get gravity(){return this._gravity}set gravity(t){this._gravity=t;var e=h.a.Physics3D._bullet,i=_._btTempVector30;e.btVector3_setValue(i,-t.x,t.y,t.z),e.btKinematicCharacterController_setGravity(this._btKinematicCharacter,i)}get maxSlope(){return this._maxSlope}set maxSlope(t){this._maxSlope=t,h.a.Physics3D._bullet.btKinematicCharacterController_setMaxSlope(this._btKinematicCharacter,t/180*Math.PI)}get isGrounded(){return h.a.Physics3D._bullet.btKinematicCharacterController_onGround(this._btKinematicCharacter)}get stepHeight(){return this._stepHeight}set stepHeight(t){this._stepHeight=t,h.a.Physics3D._bullet.btKinematicCharacterController_setStepHeight(this._btKinematicCharacter,t)}get upAxis(){return this._upAxis}set upAxis(t){this._upAxis=t;var e=_._btTempVector30;o.a._convertToBulletVec3(t,e,!1),h.a.Physics3D._bullet.btKinematicCharacterController_setUp(this._btKinematicCharacter,e)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.a.COLLISIONFILTERGROUP_DEFAULTFILTER,arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.a.COLLISIONFILTERGROUP_ALLFILTER),r()(this,"_stepHeight",void 0),r()(this,"_upAxis",new s.a(0,1,0)),r()(this,"_maxSlope",45),r()(this,"_jumpSpeed",10),r()(this,"_fallSpeed",55),r()(this,"_gravity",new s.a(0,3*-9.8,0)),r()(this,"_btKinematicCharacter",null),this._stepHeight=t,e&&(this._upAxis=e),this._controlBySimulation=!0}_constructCharacter(){var t=h.a.Physics3D._bullet;this._btKinematicCharacter&&t.btKinematicCharacterController_destroy(this._btKinematicCharacter);var e=_._btTempVector30;t.btVector3_setValue(e,this._upAxis.x,this._upAxis.y,this._upAxis.z),this._btKinematicCharacter=t.btKinematicCharacterController_create(this._btColliderObject,this._colliderShape._btShape,this._stepHeight,e),this.fallSpeed=this._fallSpeed,this.maxSlope=this._maxSlope,this.jumpSpeed=this._jumpSpeed,this.gravity=this._gravity}_onShapeChange(t){super._onShapeChange(t),this._constructCharacter()}_onAdded(){var t=h.a.Physics3D._bullet,e=t.btPairCachingGhostObject_create();t.btCollisionObject_setUserIndex(e,this.id),t.btCollisionObject_setCollisionFlags(e,l.a.COLLISIONFLAGS_CHARACTER_OBJECT),this._btColliderObject=e,this._colliderShape&&this._constructCharacter(),super._onAdded()}_addToSimulation(){this._simulation._characters.push(this),this._simulation._addCharacter(this,this._collisionGroup,this._canCollideWith)}_removeFromSimulation(){this._simulation._removeCharacter(this);var t=this._simulation._characters;t.splice(t.indexOf(this),1)}_cloneTo(t){super._cloneTo(t);var e=t;e.stepHeight=this._stepHeight,e.upAxis=this._upAxis,e.maxSlope=this._maxSlope,e.jumpSpeed=this._jumpSpeed,e.fallSpeed=this._fallSpeed,e.gravity=this._gravity}_onDestroy(){h.a.Physics3D._bullet.btKinematicCharacterController_destroy(this._btKinematicCharacter),super._onDestroy(),this._btKinematicCharacter=null}move(t){var e=_._btVector30,i=h.a.Physics3D._bullet;i.btVector3_setValue(e,-t.x,t.y,t.z),i.btKinematicCharacterController_setWalkDirection(this._btKinematicCharacter,e)}jump(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;var e=h.a.Physics3D._bullet,i=_._btVector30;t?(o.a._convertToBulletVec3(t,i,!0),e.btKinematicCharacterController_jump(this._btKinematicCharacter,i)):(e.btVector3_setValue(i,0,0,0),e.btKinematicCharacterController_jump(this._btKinematicCharacter,i))}}e.a=_,r()(_,"_btTempVector30",void 0),r()(_,"UPAXIS_X",0),r()(_,"UPAXIS_Y",1),r()(_,"UPAXIS_Z",2)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(62),n=i(11);e.a=class extends s.a{get isTrigger(){return this._isTrigger}set isTrigger(t){this._isTrigger=t;var e=n.a.Physics3D._bullet;if(this._btColliderObject){var i=e.btCollisionObject_getCollisionFlags(this._btColliderObject);t?0==(i&s.a.COLLISIONFLAGS_NO_CONTACT_RESPONSE)&&e.btCollisionObject_setCollisionFlags(this._btColliderObject,i|s.a.COLLISIONFLAGS_NO_CONTACT_RESPONSE):0!=(i&s.a.COLLISIONFLAGS_NO_CONTACT_RESPONSE)&&e.btCollisionObject_setCollisionFlags(this._btColliderObject,i^s.a.COLLISIONFLAGS_NO_CONTACT_RESPONSE)}}constructor(t,e){super(t,e),r()(this,"_isTrigger",!1)}_onAdded(){super._onAdded(),this.isTrigger=this._isTrigger}_cloneTo(t){super._cloneTo(t),t.isTrigger=this._isTrigger}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){r()(this,"flags",0),r()(this,"maxSubSteps",3),r()(this,"fixedTimeStep",1/60),r()(this,"contactEquationRelaxation",10),r()(this,"contactEquationStiffness",1e6)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){r()(this,"_ownerPath",[]),r()(this,"_propertys",[]),r()(this,"_keyFrames",[]),r()(this,"_indexInList",void 0),r()(this,"type",void 0),r()(this,"fullPath",void 0),r()(this,"propertyOwner",void 0)}get ownerPathCount(){return this._ownerPath.length}get propertyCount(){return this._propertys.length}get keyFramesCount(){return this._keyFrames.length}_setOwnerPathCount(t){this._ownerPath.length=t}_setOwnerPathByIndex(t,e){this._ownerPath[t]=e}_joinOwnerPath(t){return this._ownerPath.join(t)}_setPropertyCount(t){this._propertys.length=t}_setPropertyByIndex(t,e){this._propertys[t]=e}_joinProperty(t){return this._propertys.join(t)}_setKeyframeCount(t){this._keyFrames.length=t}_setKeyframeByIndex(t,e){this._keyFrames[t]=e}getOwnerPathByIndex(t){return this._ownerPath[t]}getPropertyByIndex(t){return this._propertys[t]}getKeyframeByIndex(t){return this._keyFrames[t]}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){r()(this,"time",void 0),r()(this,"eventName",void 0),r()(this,"params",void 0)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(171),n=i(24),o=i(5);e.a=class extends s.a{constructor(){super(),r()(this,"inTangent",new o.a),r()(this,"outTangent",new o.a),r()(this,"value",new n.a)}cloneTo(t){super.cloneTo(t);var e=t;this.inTangent.cloneTo(e.inTangent),this.outTangent.cloneTo(e.outTangent),this.value.cloneTo(e.value)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(171),n=i(1);e.a=class extends s.a{constructor(){super(),r()(this,"inTangent",new n.a),r()(this,"outTangent",new n.a),r()(this,"value",new n.a)}cloneTo(t){super.cloneTo(t);var e=t;this.inTangent.cloneTo(e.inTangent),this.outTangent.cloneTo(e.outTangent),this.value.cloneTo(e.value)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(5),o=i(86),l=i(54),h=i(127),_=i(268),c=i(269),d=i(63);class u extends d.a{constructor(){super(...arguments),r()(this,"_source",null),r()(this,"_dest",null),r()(this,"_offsetScale",null),r()(this,"_shader",null),r()(this,"_shaderData",null),r()(this,"_subShader",0),r()(this,"_sourceTexelSize",new n.a),r()(this,"_screenType",0),r()(this,"_drawDefineCavans",!1)}static create(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:u._SCREENTYPE_QUAD,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];var h;return(h=u._pool.length>0?u._pool.pop():new u)._source=t,h._dest=e,h._offsetScale=i,h._shader=a,h._shaderData=r,h._subShader=s,h._screenType=n,h._commandBuffer=o,h._drawDefineCavans=l,h}run(){var t;if(this._source)t=this._source;else{if(!this._commandBuffer._camera._internalRenderTexture)throw"camera internalRenderTexture is null,please set camera enableBuiltInRenderTexture";t=this._commandBuffer._camera._internalRenderTexture}var e=this._shader||d.a._screenShader,i=this._shaderData||d.a._screenShaderData,a=this._dest?this._dest:this._drawDefineCavans?this._dest:this._commandBuffer._camera._internalRenderTexture;s.a.instance.viewport(0,0,a?a.width:h.a.clientWidth,a?a.height:h.a.clientHeight),i.setTexture(d.a.SCREENTEXTURE_ID,t),i.setVector(d.a.SCREENTEXTUREOFFSETSCALE_ID,this._offsetScale||u._defaultOffsetScale),this._sourceTexelSize.setValue(1/t.width,1/t.height,t.width,t.height),i.setVector(d.a.MAINTEXTURE_TEXELSIZE_ID,this._sourceTexelSize),o.a.currentActive&&o.a.currentActive._end(),a&&a._start();for(var r=e.getSubShaderAt(this._subShader)._passes,n=0,l=r.length;n<l;n++){var f=u._compileDefine;i._defineDatas.cloneTo(f);var m=r[n].withCompile(f);switch(m.bind(),m.uploadUniforms(m._materialUniformParamsMap,i,!0),m.uploadRenderStateBlendDepth(i),m.uploadRenderStateFrontFace(i,!1,null),this._screenType){case u._SCREENTYPE_QUAD:h.a._instance.invertY?_.a.instance.renderInvertUV():_.a.instance.render();break;case u._SCREENTYPE_TRIANGLE:h.a._instance.invertY?c.a.instance.renderInvertUV():c.a.instance.render();break;default:throw"BlitScreenQuadCMD:unknown screen Type."}}a&&a._end()}recover(){u._pool.push(this),this._source=null,this._dest=null,this._offsetScale=null,this._shader=null,this._shaderData=null,this._drawDefineCavans=!1,super.recover()}}e.a=u,r()(u,"_SCREENTYPE_QUAD",0),r()(u,"_SCREENTYPE_TRIANGLE",1),r()(u,"_compileDefine",new l.a),r()(u,"_pool",[]),r()(u,"_defaultOffsetScale",new n.a(0,0,1,1))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(17),o=i(8),l=i(25),h=i(55),_=i(56),c=i(31),d=i(38);class u extends n.a{static __init__(){u._vertexDeclaration=new h.a(16,[new _.a(0,c.a.Vector4,u.SCREENQUAD_POSITION_UV)]),u.instance=new u,u.instance.lock=!0}constructor(){super(),r()(this,"_vertexBuffer",void 0),r()(this,"_bufferState",new d.a),r()(this,"_vertexBufferInvertUV",void 0),r()(this,"_bufferStateInvertUV",new d.a);var t=s.a.instance;this._vertexBuffer=new l.a(64,t.STATIC_DRAW,!1),this._vertexBuffer.vertexDeclaration=u._vertexDeclaration,this._vertexBuffer.setData(u._vertices.buffer),this._bufferState.bind(),this._bufferState.applyVertexBuffer(this._vertexBuffer),this._bufferState.unBind(),this._vertexBufferInvertUV=new l.a(64,t.STATIC_DRAW,!1),this._vertexBufferInvertUV.vertexDeclaration=u._vertexDeclaration,this._vertexBufferInvertUV.setData(u._verticesInvertUV.buffer),this._bufferStateInvertUV.bind(),this._bufferStateInvertUV.applyVertexBuffer(this._vertexBufferInvertUV),this._bufferStateInvertUV.unBind(),this._setGPUMemory(this._vertexBuffer._byteLength+this._vertexBufferInvertUV._byteLength)}render(){var t=s.a.instance;this._bufferState.bind(),t.drawArrays(t.TRIANGLE_STRIP,0,4),o.a.renderBatches++}renderInvertUV(){var t=s.a.instance;this._bufferStateInvertUV.bind(),t.drawArrays(t.TRIANGLE_STRIP,0,4),o.a.renderBatches++}destroy(){super.destroy(),this._bufferState.destroy(),this._vertexBuffer.destroy(),this._bufferStateInvertUV.destroy(),this._vertexBufferInvertUV.destroy(),this._setGPUMemory(0)}}e.a=u,r()(u,"SCREENQUAD_POSITION_UV",0),r()(u,"_vertexDeclaration",void 0),r()(u,"_vertices",new Float32Array([1,1,1,1,1,-1,1,0,-1,1,0,1,-1,-1,0,0])),r()(u,"_verticesInvertUV",new Float32Array([1,1,1,0,1,-1,1,1,-1,1,0,0,-1,-1,0,1])),r()(u,"instance",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(38),n=i(25),o=i(55),l=i(56),h=i(31),_=i(2),c=i(17),d=i(8);class u extends c.a{static __init__(){u._vertexDeclaration=new o.a(16,[new l.a(0,h.a.Vector4,u.SCREENTRIANGLE_POSITION_UV)]),u.instance=new u,u.instance.lock=!0}constructor(){super(),r()(this,"_vertexBuffer",void 0),r()(this,"_bufferState",new s.a),r()(this,"_vertexBufferInvertUV",void 0),r()(this,"_bufferStateInvertUV",new s.a);var t=_.a.instance;this._vertexBuffer=new n.a(48,t.STATIC_DRAW,!1),this._vertexBuffer.vertexDeclaration=u._vertexDeclaration,this._vertexBuffer.setData(u._vertices.buffer),this._bufferState.bind(),this._bufferState.applyVertexBuffer(this._vertexBuffer),this._bufferState.unBind(),this._vertexBufferInvertUV=new n.a(48,t.STATIC_DRAW,!1),this._vertexBufferInvertUV.vertexDeclaration=u._vertexDeclaration,this._vertexBufferInvertUV.setData(u._verticesInvertUV.buffer),this._bufferStateInvertUV.bind(),this._bufferStateInvertUV.applyVertexBuffer(this._vertexBufferInvertUV),this._bufferStateInvertUV.unBind(),this._setGPUMemory(this._vertexBuffer._byteLength+this._vertexBufferInvertUV._byteLength)}render(){var t=_.a.instance;this._bufferState.bind(),t.drawArrays(t.TRIANGLES,0,3),d.a.renderBatches++}renderInvertUV(){var t=_.a.instance;this._bufferStateInvertUV.bind(),t.drawArrays(t.TRIANGLES,0,3),d.a.renderBatches++}destroy(){super.destroy(),this._bufferState.destroy(),this._vertexBuffer.destroy(),this._bufferStateInvertUV.destroy(),this._vertexBufferInvertUV.destroy(),this._setGPUMemory(0)}}e.a=u,r()(u,"SCREENTRIANGLE_POSITION_UV",0),r()(u,"_vertexDeclaration",void 0),r()(u,"_vertices",new Float32Array([-1,-1,0,0,-1,3,0,2,3,-1,2,0])),r()(u,"_verticesInvertUV",new Float32Array([-1,-1,0,1,-1,3,0,-1,3,-1,2,1])),r()(u,"instance",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(11);class n{get shader(){return this._shader}get subShaderIndex(){return this._subShaderIndex}get passIndex(){return this._passIndex}get defineNames(){return this._defineNames}constructor(t,e,i,a){r()(this,"_shader",void 0),r()(this,"_subShaderIndex",0),r()(this,"_passIndex",0),r()(this,"_defineNames",void 0),this.setValue(t,e,i,a)}setValue(t,e,i,a){if(!t)throw"ShaderVariantInfo:Shader can't be null.";var r=t.getSubShaderAt(e);if(!r)throw"ShaderVariantInfo:Shader don't have subShaderIndex of ".concat(e,".");var n=r._passes[i];if(!n)throw"ShaderVariantInfo:Shader don't have passIndex of ".concat(i,".");for(var o=n._validDefine,l=0,h=a.length;l<h;l++){var _=a[l];if(!o.has(s.a.Shader3D.getDefineByName(_)))throw"ShaderVariantInfo:Invalid defineName ".concat(_," in ").concat(t._name," subShaderIndex of ").concat(e," passIndex of ").concat(i,".")}this._shader=t,this._subShaderIndex=e,this._passIndex=i,this._defineNames=a}equal(t){if(this._shader!==t._shader||this._subShaderIndex!==t._subShaderIndex||this._passIndex!==t._passIndex)return!1;var e=this._defineNames,i=t._defineNames;if(e.length!==i.length)return!1;for(var a=0,r=this._defineNames.length;a<r;a++)if(e[a]!==i[a])return!1;return!0}clone(){return new n(this._shader,this._subShaderIndex,this._passIndex,this._defineNames.slice())}}e.a=n;e.b=class{constructor(){r()(this,"_allCompiled",!1),r()(this,"_variants",[])}get allCompiled(){return this._allCompiled}get variantCount(){return this._variants.length}add(t){for(var e=0,i=this._variants.length;e<i;e++)if(this._variants[e].equal(t))return!1;return this._variants.push(t.clone()),this._allCompiled=!1,!0}remove(t){for(var e=0,i=this._variants.length;e<i;e++)if(this._variants[e].equal(t))return this._variants.splice(e,1),!0;return!1}contatins(t){for(var e=0,i=this._variants.length;e<i;e++)if(this._variants[e].equal(t))return!0;return!1}getByIndex(t){return this._variants[t]}clear(){this._variants.length=0}compile(){if(!this._allCompiled){for(var t=this._variants,e=0,i=t.length;e<i;e++){var a=t[e];s.a.Shader3D.compileShaderByDefineNames(a._shader._name,a._subShaderIndex,a._passIndex,a._defineNames)}this._allCompiled=!0}}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(72),n=i(20),o=i(1),l=i(13);class h{constructor(){r()(this,"updateMark",-1),r()(this,"pointLightCount",0),r()(this,"spotLightCount",0),r()(this,"indices",[])}}class _{constructor(t,e,i,a){r()(this,"_xSlices",void 0),r()(this,"_ySlices",void 0),r()(this,"_zSlices",void 0),r()(this,"_clusterDatas",void 0),r()(this,"_clusterPixels",void 0),r()(this,"_updateMark",0),r()(this,"_depthSliceParam",new n.a),r()(this,"_clusterTexture",void 0),this._xSlices=t,this._ySlices=e,this._zSlices=i;var s=t*e,o=i*(1+Math.ceil(a/4));this._clusterTexture=l.a._createFloatTextureBuffer(s,o),this._clusterTexture.lock=!0,this._clusterPixels=new Float32Array(s*o*4);for(var _=new Array(this._zSlices),c=0;c<this._zSlices;c++){_[c]=new Array(this._ySlices);for(var d=0;d<this._ySlices;d++){_[c][d]=new Array(this._xSlices);for(var u=0;u<this._xSlices;u++)_[c][d][u]=new h}}this._clusterDatas=_}_insertSpotLightSphere(t,e,i,a,r){var s=_._tempVector35;s.x=r.x-t.x,s.y=r.y-t.y,s.z=r.z-t.z;var n=o.a.dot(s,s),l=r.w;if(!(n>l*l))return!1;var h=o.a.dot(s,e);return!(Math.cos(a)*Math.sqrt(n-h*h)-h*Math.sin(a)>l||h>l+i||h<-l)}_placePointLightToClusters(t,e){for(var i=this._clusterDatas,a=this._updateMark,r=e.zMin,s=e.zMax;r<s;r++)for(var n=e.yMin,o=e.yMax;n<o;n++)for(var l=e.xMin,h=e.xMax;l<h;l++){var _=i[r][n][l];_.updateMark!=a&&(_.pointLightCount=0,_.spotLightCount=0,_.updateMark=a);var c=_.indices,d=_.pointLightCount++;d<c.length?c[d]=t:c.push(t)}}_placeSpotLightToClusters(t,e){for(var i=this._clusterDatas,a=this._updateMark,r=e.zMin,s=e.zMax;r<s;r++)for(var n=e.yMin,o=e.yMax;n<o;n++)for(var l=e.xMin,h=e.xMax;l<h;l++){var _=i[r][n][l];_.updateMark!=a&&(_.pointLightCount=0,_.spotLightCount=0,_.updateMark=a);var c=_.indices,d=_.pointLightCount+_.spotLightCount++;d<c.length?c[d]=t:c.push(t)}}_insertConePlane(t,e,i,a,r){var s=_._tempVector36,n=_._tempVector37;o.a.cross(r,e,s),o.a.cross(s,e,n),o.a.normalize(n,n);var l=i*Math.tan(a),h=t.x+i*e.x+l*n.x,c=t.y+i*e.y+l*n.y,d=t.z+i*e.z+l*n.z;return h*r.x+c*r.y+d*r.z<=0||t.x*r.x+t.y*r.y+t.z*r.z<=0}_shrinkSphereLightZPerspective(t,e,i,a,r){var s=i.z,n=s-a,o=s+a;if(n>e||o<=t)return!1;var l=this._depthSliceParam;return r.zMin=Math.floor(Math.log2(Math.max(n,t))*l.x-l.y),r.zMax=Math.min(Math.ceil(Math.log2(o)*l.x-l.y),this._zSlices),!0}_shrinkSpotLightZPerspective(t,e,i,a,r,s,n){var o=a.x,l=a.y,h=a.z,_=Math.tan(s)*r,c=i.x,d=i.y,u=i.z,f=o-c,m=l-d,p=h-u,g=f*f+m*m+p*p,v=Math.sqrt(1-p*p/g),T=Math.max(Math.min(u,h-v*_),i.z-r),E=Math.min(Math.max(u,h+v*_),i.z+r);if(T>e||E<=t)return!1;var S=this._depthSliceParam;return n.zMin=Math.floor(Math.log2(Math.max(T,t))*S.x-S.y),n.zMax=Math.min(Math.ceil(Math.log2(E)*S.x-S.y),this._zSlices),!0}_shrinkSphereLightByBoundOrth(t,e,i,a,r,s,n){var o=r.z,l=o-s,h=o+s;if(l>a||h<=i)return!1;var _=r.x,c=_-s,d=_+s;if(c>t||d<=-t)return!1;var u=r.y,f=u-s,m=u+s;if(f>e||m<=-e)return!1;var p=this._xSlices,g=this._ySlices,v=this._depthSliceParam,T=2*t/p,E=2*e/g;return n.xMin=Math.max(Math.floor((c+t)/T),0),n.xMax=Math.min(Math.ceil((d+t)/T),p),n.yMin=Math.max(Math.floor((e-m)/E),0),n.yMax=Math.min(Math.ceil((e-f)/E),g),n.zMin=Math.floor(Math.log2(Math.max(l,i))*v.x-v.y),n.zMax=Math.min(Math.ceil(Math.log2(h)*v.x-v.y),this._zSlices),!0}_shrinkSpotLightByBoundOrth(t,e,i,a,r,s,n,o,l){var h=s.x,_=s.y,c=s.z,d=Math.tan(o)*n,u=r.x,f=r.y,m=r.z,p=h-u,g=_-f,v=c-m,T=p*p+g*g+v*v,E=Math.sqrt(1-v*v/T),S=Math.max(Math.min(m,c-E*d),r.z-n),R=Math.min(Math.max(m,c+E*d),r.z+n);if(S>a||R<=i)return!1;var x=Math.sqrt(1-p*p/T),A=Math.max(Math.min(u,h-x*d),r.x-n),y=Math.min(Math.max(u,h+x*d),r.x+n);if(A>t||y<=-t)return!1;var I=Math.sqrt(1-g*g/T),C=Math.max(Math.min(f,_-I*d),r.y-n),M=Math.min(Math.max(f,_+I*d),r.y+n);if(C>e||M<=-e)return!1;var D=this._xSlices,b=this._ySlices,L=this._depthSliceParam,O=2*t/D,P=2*e/b;return l.xMin=Math.max(Math.floor((A+t)/O),0),l.xMax=Math.min(Math.ceil((y+t)/O),D),l.yMin=Math.max(Math.floor((e-M)/P),0),l.yMax=Math.min(Math.ceil((e-C)/P),b),l.zMin=Math.floor(Math.log2(Math.max(S,i))*L.x-L.y),l.zMax=Math.min(Math.ceil(Math.log2(R)*L.x-L.y),this._zSlices),!0}_shrinkXYByRadiusPerspective(t,e,i,a,r){var s,n,o,l,h,_=t.x,c=t.y,d=t.z,u=this._ySlices+1;for(h=0;h<u;h++){if(c*(f=r[h]).y+d*f.z<e){n=Math.max(0,h-1);break}}if(h==u)return!1;for(l=this._ySlices,h=n+1;h<u;h++){if(c*(f=r[h]).y+d*f.z<=-e){l=Math.max(0,h);break}}for(u=this._xSlices+1,h=0;h<u;h++){if(_*(f=a[h]).x+d*f.z<e){s=Math.max(0,h-1);break}}for(o=this._xSlices,h=s+1;h<u;h++){var f;if(_*(f=a[h]).x+d*f.z<=-e){o=Math.max(0,h);break}}return i.xMin=s,i.xMax=o,i.yMin=n,i.yMax=l,!0}_shrinkSpotXYByConePerspective(t,e,i,a,r,s,n){for(var o,l,h,c,d=_._tempVector32,u=r.yMax+1,f=r.yMin+1;f<u;f++)if(this._insertConePlane(t,e,i,a,n[f])){l=Math.max(0,f-1);break}c=r.yMax;for(f=l+1;f<u;f++){var m=n[f];if(d.setValue(0,-m.y,-m.z),!this._insertConePlane(t,e,i,a,d)){c=Math.max(0,f);break}}u=r.xMax+1;for(f=r.xMin+1;f<u;f++)if(this._insertConePlane(t,e,i,a,s[f])){o=Math.max(0,f-1);break}h=r.xMax;for(f=o+1;f<u;f++){m=s[f];if(d.setValue(-m.x,0,-m.z),!this._insertConePlane(t,e,i,a,d)){h=Math.max(0,f);break}}r.xMin=o,r.xMax=h,r.yMin=l,r.yMax=c}_updatePointLightPerspective(t,e,i,a,r,s,n){var l=_._tempLightBound,h=_._tempVector30;o.a.transformV3ToV3(a._transform.position,i,h),h.z*=-1,this._shrinkSphereLightZPerspective(t,e,h,a.range,l)&&this._shrinkXYByRadiusPerspective(h,a.range,l,s,n)&&this._placePointLightToClusters(r,l)}_updateSpotLightPerspective(t,e,i,a,r,s,n){var l=_._tempLightBound,h=_._tempVector30,c=_._tempVector31,d=_._tempVector34,u=a._transform.position,f=a.range;a._transform.worldMatrix.getForward(c),o.a.normalize(c,c),o.a.scale(c,f,d),o.a.add(u,d,d),o.a.transformV3ToV3(u,i,h),o.a.transformV3ToV3(d,i,d),h.z*=-1,d.z*=-1;var m=a.spotAngle/2*Math.PI/180;if(this._shrinkSpotLightZPerspective(t,e,h,d,f,m,l)&&this._shrinkXYByRadiusPerspective(h,f,l,s,n)){var p=_._tempVector33;p.x=d.x-h.x,p.y=d.y-h.y,p.z=d.z-h.z,o.a.normalize(p,p),this._shrinkSpotXYByConePerspective(h,p,f,m,l,s,n),this._placeSpotLightToClusters(r,l)}}_updatePointLightOrth(t,e,i,a,r,s,n){var l=_._tempLightBound,h=_._tempVector30;o.a.transformV3ToV3(s._transform.position,r,h),h.z*=-1,this._shrinkSphereLightByBoundOrth(t,e,i,a,h,s.range,l)&&this._placePointLightToClusters(n,l)}_updateSpotLightOrth(t,e,i,a,r,s,n){var l=_._tempLightBound,h=_._tempVector30,c=_._tempVector31,d=_._tempVector34,u=s._transform.position,f=s.range;s._transform.worldMatrix.getForward(c),o.a.normalize(c,c),o.a.scale(c,f,d),o.a.add(u,d,d),o.a.transformV3ToV3(u,r,h),o.a.transformV3ToV3(d,r,d),h.z*=-1,d.z*=-1;var m=s.spotAngle/2*Math.PI/180;this._shrinkSpotLightByBoundOrth(t,e,i,a,h,d,f,m,l)&&this._placeSpotLightToClusters(n,l)}update(t,e){this._updateMark++;var i=t.nearPlane;this._depthSliceParam.x=s.a._config.lightClusterCount.z/Math.log2(t.farPlane/i),this._depthSliceParam.y=Math.log2(i)*this._depthSliceParam.x;var a=t.nearPlane,r=t.farPlane,n=t.viewMatrix,o=e._directionLights._length,l=e._pointLights,h=l._length,_=l._elements,c=e._spotLights,d=c._length,u=c._elements;if(t.orthographic){for(var f=t.orthographicVerticalSize/2,m=f*t.aspectRatio,p=0;p<h;p++,o++)this._updatePointLightOrth(m,f,a,r,n,_[p],o);for(p=0;p<d;p++,o++)this._updateSpotLightOrth(m,f,a,r,n,u[p],o)}else{t._updateClusterPlaneXY();var g=t._clusterXPlanes,v=t._clusterYPlanes;for(p=0;p<h;p++,o++)this._updatePointLightPerspective(a,r,n,_[p],o,g,v);for(p=0;p<d;p++,o++)this._updateSpotLightPerspective(a,r,n,u[p],o,g,v)}if(h+d>0){for(var T=this._xSlices,E=this._ySlices,S=this._zSlices,R=T*E*4,x=R*S,A=this._clusterPixels,y=A.length,I=this._clusterDatas,C=this._updateMark,M=!0,D=0;D<S;D++)for(var b=0;b<E;b++)for(var L=0;L<T;L++){var O=I[D][b][L],P=4*(L+b*T+D*T*E);if(O.updateMark!==C)A[P]=0,A[P+1]=0;else if(M){var N=O.indices,w=O.pointLightCount,B=O.spotLightCount,F=w+B;if(x+F<y){A[P]=w,A[P+1]=B,A[P+2]=Math.floor(x/R),A[P+3]=x%R;for(p=0;p<F;p++)A[x++]=N[p]}else{F=y-(x+F),w=Math.min(w,F),A[P]=w,A[P+1]=Math.min(B,F-w),A[P+2]=Math.floor(x/R),A[P+3]=x%R;for(p=0;p<F;p++)A[x++]=N[p];M=!1}}}var V=this._clusterTexture.width;this._clusterTexture.setSubPixels(0,0,V,Math.ceil(x/(4*V)),A)}}}e.a=_,r()(_,"_tempVector30",new o.a),r()(_,"_tempVector31",new o.a),r()(_,"_tempVector32",new o.a),r()(_,"_tempVector33",new o.a),r()(_,"_tempVector34",new o.a),r()(_,"_tempVector35",new o.a),r()(_,"_tempVector36",new o.a),r()(_,"_tempVector37",new o.a),r()(_,"_tempLightBound",new class{constructor(){r()(this,"xMin",void 0),r()(this,"xMax",void 0),r()(this,"yMin",void 0),r()(this,"yMax",void 0),r()(this,"zMin",void 0),r()(this,"zMax",void 0)}}),r()(_,"instance",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(t,e){r()(this,"origin",void 0),r()(this,"direction",void 0),this.origin=t,this.direction=e}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(58),n=i(6),o=i(12),l=i(9),h=i(1),_=i(5),c=i(274),d=i(7),u=i(32),f=i(33);class m extends f.a{get skyRenderer(){return this._skyRenderer}get fieldOfView(){return this._fieldOfView}set fieldOfView(t){this._fieldOfView=t,this._calculateProjectionMatrix()}get nearPlane(){return this._nearPlane}set nearPlane(t){this._nearPlane=t,this._calculateProjectionMatrix()}get farPlane(){return this._farPlane}set farPlane(t){this._farPlane=t,this._calculateProjectionMatrix()}get orthographic(){return this._orthographic}set orthographic(t){this._orthographic=t,this._calculateProjectionMatrix()}get orthographicVerticalSize(){return this._orthographicVerticalSize}set orthographicVerticalSize(t){this._orthographicVerticalSize=t,this._calculateProjectionMatrix()}get renderingOrder(){return this._renderingOrder}set renderingOrder(t){this._renderingOrder=t,this._sortCamerasByRenderingOrder()}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;super(),r()(this,"_renderingOrder",void 0),r()(this,"_nearPlane",void 0),r()(this,"_farPlane",void 0),r()(this,"_fieldOfView",void 0),r()(this,"_orthographicVerticalSize",void 0),r()(this,"_skyRenderer",new c.a),r()(this,"_forward",new h.a),r()(this,"_up",new h.a),r()(this,"_orthographic",void 0),r()(this,"_useUserProjectionMatrix",void 0),r()(this,"_shaderValues",void 0),r()(this,"clearColor",new _.a(100/255,149/255,237/255,1)),r()(this,"cullingMask",void 0),r()(this,"useOcclusionCulling",void 0),this._shaderValues=new u.a(null),this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=t,this._farPlane=e,this.cullingMask=2147483647,this.useOcclusionCulling=!0}_sortCamerasByRenderingOrder(){if(this.displayedInStage)for(var t=this.scene._cameraPool,e=t.length-1,i=0;i<e;i++)if(t[i].renderingOrder>t[e].renderingOrder){var a=t[i];t[i]=t[e],t[e]=a}}_calculateProjectionMatrix(){}_onScreenSizeChanged(){this._calculateProjectionMatrix()}_prepareCameraToRender(){var t=this._shaderValues;this.transform.getForward(this._forward),this.transform.getUp(this._up),t.setVector3(m.CAMERAPOS,this.transform.position),t.setVector3(m.CAMERADIRECTION,this._forward),t.setVector3(m.CAMERAUP,this._up)}render(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1]}addLayer(t){this.cullingMask|=Math.pow(2,t)}removeLayer(t){this.cullingMask&=~Math.pow(2,t)}addAllLayers(){this.cullingMask=2147483647}removeAllLayers(){this.cullingMask=0}resetProjectionMatrix(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()}_onActive(){this._scene._addCamera(this),super._onActive()}_onInActive(){this._scene._removeCamera(this),super._onInActive()}_parse(t,e){super._parse(t,e),this.orthographic=t.orthographic,void 0!==t.orthographicVerticalSize&&(this.orthographicVerticalSize=t.orthographicVerticalSize),void 0!==t.fieldOfView&&(this.fieldOfView=t.fieldOfView),this.nearPlane=t.nearPlane,this.farPlane=t.farPlane;var i=t.clearColor;this.clearColor=new _.a(i[0],i[1],i[2],i[3]);var a=t.skyboxMaterial;a&&(this._skyRenderer.material=o.a.getRes(a.path))}destroy(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._skyRenderer.destroy(),this._skyRenderer=null,s.a.stage.off(n.a.RESIZE,this,this._onScreenSizeChanged),super.destroy(t)}_create(){return new m}}e.a=m,r()(m,"_tempMatrix4x40",new l.a),r()(m,"CAMERAPOS",d.a.propertyNameToID("u_CameraPos")),r()(m,"VIEWMATRIX",d.a.propertyNameToID("u_View")),r()(m,"PROJECTMATRIX",d.a.propertyNameToID("u_Projection")),r()(m,"VIEWPROJECTMATRIX",d.a.propertyNameToID("u_ViewProjection")),r()(m,"CAMERADIRECTION",d.a.propertyNameToID("u_CameraDirection")),r()(m,"CAMERAUP",d.a.propertyNameToID("u_CameraUp")),r()(m,"VIEWPORT",d.a.propertyNameToID("u_Viewport")),r()(m,"PROJECTION_PARAMS",d.a.propertyNameToID("u_ProjectionParams")),r()(m,"RENDERINGTYPE_DEFERREDLIGHTING","DEFERREDLIGHTING"),r()(m,"RENDERINGTYPE_FORWARDRENDERING","FORWARDRENDERING"),r()(m,"_invertYScaleMatrix",new l.a(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)),r()(m,"_invertYProjectionMatrix",new l.a),r()(m,"_invertYProjectionViewMatrix",new l.a),r()(m,"CLEARFLAG_SOLIDCOLOR",0),r()(m,"CLEARFLAG_SKY",1),r()(m,"CLEARFLAG_DEPTHONLY",2),r()(m,"CLEARFLAG_NONE",3)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(3),n=i(2),o=i(8),l=i(10),h=i(9),_=i(1),c=i(54),d=i(32),u=i(177);class f{get material(){return this._material}set material(t){this._material!==t&&(this._material&&this._material._removeReference(),t&&t._addReference(),this._material=t)}get mesh(){return this._mesh}set mesh(t){this._mesh!==t&&(this._mesh=t)}constructor(){r()(this,"_material",void 0),r()(this,"_mesh",u.a.instance)}_isAvailable(){return!(!this._material||!this._mesh)}_render(t){if(this._material&&this._mesh){var e=n.a.instance,i=t.scene,a=t.cameraShaderValue,r=t.camera,c=d.a._SET_RUNTIME_VALUE_MODE_REFERENCE_;s.a.Render.supportWebGLPlusRendering&&d.a.setRuntimeValueMode(!1),l.a.setCullFace(e,!1),l.a.setDepthFunc(e,e.LEQUAL),l.a.setDepthMask(e,!1);var u=f._compileDefine;this._material._shaderValues._defineDatas.cloneTo(u);var m=t.shader=this._material._shader.getSubShaderAt(0)._passes[0].withCompile(u),p=m.bind(),g=o.a.loopCount!==m._uploadMark,v=m._uploadScene!==i||g;(v||p)&&(m.uploadUniforms(m._sceneUniformParamsMap,i._shaderValues,v),m._uploadScene=i);r._getRenderTexture();var T=m._uploadCameraShaderValue!==a||g;if(T||p){var E=f._tempMatrix0,S=f._tempMatrix1;r.viewMatrix.cloneTo(E),r.projectionMatrix.cloneTo(S),E.setTranslationVector(_.a._ZERO),r.orthographic&&h.a.createPerspective(r.fieldOfView,r.aspectRatio,r.nearPlane,r.farPlane,S);var R=1/Math.tan(3.1416*r.fieldOfView/180*.5);S.elements[0]=R/r.aspectRatio,S.elements[5]=R,S.elements[10]=1e-6-1,S.elements[11]=-1,S.elements[14]=-0,r._applyViewProject(t,E,S),m.uploadUniforms(m._cameraUniformParamsMap,a,T),m._uploadCameraShaderValue=a}var x=m._uploadMaterial!==this._material||g;(x||p)&&(m.uploadUniforms(m._materialUniformParamsMap,this._material._shaderValues,x),m._uploadMaterial=this._material),this._mesh._bufferState.bind(),this._mesh._render(t),s.a.Render.supportWebGLPlusRendering&&d.a.setRuntimeValueMode(c),l.a.setDepthFunc(e,e.LESS),l.a.setDepthMask(e,!0),r._applyViewProject(t,r.viewMatrix,r.projectionMatrix)}}destroy(){this._material&&(this._material._removeReference(),this._material=null)}}e.a=f,r()(f,"_tempMatrix0",new h.a),r()(f,"_tempMatrix1",new h.a),r()(f,"_compileDefine",new c.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){r()(this,"_vertexBuffer",void 0),r()(this,"_indexBuffer",void 0),r()(this,"_bufferState",void 0)}_render(t){}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(5),n=i(7),o=i(22),l=i(40);class h extends o.a{static __initDefine__(){h.SHADERDEFINE_DIFFUSEMAP=n.a.getDefineByName("DIFFUSEMAP"),h.SHADERDEFINE_NORMALMAP=n.a.getDefineByName("NORMALMAP"),h.SHADERDEFINE_SPECULARMAP=n.a.getDefineByName("SPECULARMAP"),h.SHADERDEFINE_TILINGOFFSET=n.a.getDefineByName("TILINGOFFSET"),h.SHADERDEFINE_ENABLEVERTEXCOLOR=n.a.getDefineByName("ENABLEVERTEXCOLOR")}get _ColorR(){return this._albedoColor.x}set _ColorR(t){this._albedoColor.x=t,this.albedoColor=this._albedoColor}get _ColorG(){return this._albedoColor.y}set _ColorG(t){this._albedoColor.y=t,this.albedoColor=this._albedoColor}get _ColorB(){return this._albedoColor.z}set _ColorB(t){this._albedoColor.z=t,this.albedoColor=this._albedoColor}get _ColorA(){return this._albedoColor.w}set _ColorA(t){this._albedoColor.w=t,this.albedoColor=this._albedoColor}get _Color(){return this._shaderValues.getVector(h.ALBEDOCOLOR)}set _Color(t){this.albedoColor=t}get _SpecColorR(){return this._shaderValues.getVector(h.MATERIALSPECULAR).x}set _SpecColorR(t){this._shaderValues.getVector(h.MATERIALSPECULAR).x=t}get _SpecColorG(){return this._shaderValues.getVector(h.MATERIALSPECULAR).y}set _SpecColorG(t){this._shaderValues.getVector(h.MATERIALSPECULAR).y=t}get _SpecColorB(){return this._shaderValues.getVector(h.MATERIALSPECULAR).z}set _SpecColorB(t){this._shaderValues.getVector(h.MATERIALSPECULAR).z=t}get _SpecColorA(){return this._shaderValues.getVector(h.MATERIALSPECULAR).w}set _SpecColorA(t){this._shaderValues.getVector(h.MATERIALSPECULAR).w=t}get _SpecColor(){return this._shaderValues.getVector(h.MATERIALSPECULAR)}set _SpecColor(t){this.specularColor=t}get _AlbedoIntensity(){return this._albedoIntensity}set _AlbedoIntensity(t){if(this._albedoIntensity!==t){var e=this._shaderValues.getVector(h.ALBEDOCOLOR);s.a.scale(this._albedoColor,t,e),this._albedoIntensity=t,this._shaderValues.setVector(h.ALBEDOCOLOR,e)}}get _Shininess(){return this._shaderValues.getNumber(h.SHININESS)}set _Shininess(t){t=Math.max(0,Math.min(1,t)),this._shaderValues.setNumber(h.SHININESS,t)}get _MainTex_STX(){return this._shaderValues.getVector(h.TILINGOFFSET).x}set _MainTex_STX(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.x=t,this.tilingOffset=e}get _MainTex_STY(){return this._shaderValues.getVector(h.TILINGOFFSET).y}set _MainTex_STY(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.y=t,this.tilingOffset=e}get _MainTex_STZ(){return this._shaderValues.getVector(h.TILINGOFFSET).z}set _MainTex_STZ(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.z=t,this.tilingOffset=e}get _MainTex_STW(){return this._shaderValues.getVector(h.TILINGOFFSET).w}set _MainTex_STW(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.w=t,this.tilingOffset=e}get _MainTex_ST(){return this._shaderValues.getVector(h.TILINGOFFSET)}set _MainTex_ST(t){this.tilingOffset=t}get _Cutoff(){return this.alphaTestValue}set _Cutoff(t){this.alphaTestValue=t}set renderMode(t){switch(t){case h.RENDERMODE_OPAQUE:this.alphaTest=!1,this.renderQueue=o.a.RENDERQUEUE_OPAQUE,this.depthWrite=!0,this.cull=l.a.CULL_BACK,this.blend=l.a.BLEND_DISABLE,this.depthTest=l.a.DEPTHTEST_LESS;break;case h.RENDERMODE_CUTOUT:this.renderQueue=o.a.RENDERQUEUE_ALPHATEST,this.alphaTest=!0,this.depthWrite=!0,this.cull=l.a.CULL_BACK,this.blend=l.a.BLEND_DISABLE,this.depthTest=l.a.DEPTHTEST_LESS;break;case h.RENDERMODE_TRANSPARENT:this.renderQueue=o.a.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=l.a.CULL_BACK,this.blend=l.a.BLEND_ENABLE_ALL,this.blendSrc=l.a.BLENDPARAM_SRC_ALPHA,this.blendDst=l.a.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=l.a.DEPTHTEST_LESS;break;default:throw new Error("Material:renderMode value error.")}}get enableVertexColor(){return this._enableVertexColor}set enableVertexColor(t){this._enableVertexColor=t,t?this._shaderValues.addDefine(h.SHADERDEFINE_ENABLEVERTEXCOLOR):this._shaderValues.removeDefine(h.SHADERDEFINE_ENABLEVERTEXCOLOR)}get tilingOffsetX(){return this._MainTex_STX}set tilingOffsetX(t){this._MainTex_STX=t}get tilingOffsetY(){return this._MainTex_STY}set tilingOffsetY(t){this._MainTex_STY=t}get tilingOffsetZ(){return this._MainTex_STZ}set tilingOffsetZ(t){this._MainTex_STZ=t}get tilingOffsetW(){return this._MainTex_STW}set tilingOffsetW(t){this._MainTex_STW=t}get tilingOffset(){return this._shaderValues.getVector(h.TILINGOFFSET)}set tilingOffset(t){t&&(1!=t.x||1!=t.y||0!=t.z||0!=t.w)?this._shaderValues.addDefine(h.SHADERDEFINE_TILINGOFFSET):this._shaderValues.removeDefine(h.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(h.TILINGOFFSET,t)}get albedoColorR(){return this._ColorR}set albedoColorR(t){this._ColorR=t}get albedoColorG(){return this._ColorG}set albedoColorG(t){this._ColorG=t}get albedoColorB(){return this._ColorB}set albedoColorB(t){this._ColorB=t}get albedoColorA(){return this._ColorA}set albedoColorA(t){this._ColorA=t}get albedoColor(){return this._albedoColor}set albedoColor(t){var e=this._shaderValues.getVector(h.ALBEDOCOLOR);s.a.scale(t,this._albedoIntensity,e),this._albedoColor=t,this._shaderValues.setVector(h.ALBEDOCOLOR,e)}get albedoIntensity(){return this._albedoIntensity}set albedoIntensity(t){this._AlbedoIntensity=t}get specularColorR(){return this._SpecColorR}set specularColorR(t){this._SpecColorR=t}get specularColorG(){return this._SpecColorG}set specularColorG(t){this._SpecColorG=t}get specularColorB(){return this._SpecColorB}set specularColorB(t){this._SpecColorB=t}get specularColorA(){return this._SpecColorA}set specularColorA(t){this._SpecColorA=t}get specularColor(){return this._shaderValues.getVector(h.MATERIALSPECULAR)}set specularColor(t){this._shaderValues.setVector(h.MATERIALSPECULAR,t)}get shininess(){return this._Shininess}set shininess(t){this._Shininess=t}get albedoTexture(){return this._shaderValues.getTexture(h.ALBEDOTEXTURE)}set albedoTexture(t){t?this._shaderValues.addDefine(h.SHADERDEFINE_DIFFUSEMAP):this._shaderValues.removeDefine(h.SHADERDEFINE_DIFFUSEMAP),this._shaderValues.setTexture(h.ALBEDOTEXTURE,t)}get normalTexture(){return this._shaderValues.getTexture(h.NORMALTEXTURE)}set normalTexture(t){t?this._shaderValues.addDefine(h.SHADERDEFINE_NORMALMAP):this._shaderValues.removeDefine(h.SHADERDEFINE_NORMALMAP),this._shaderValues.setTexture(h.NORMALTEXTURE,t)}get specularTexture(){return this._shaderValues.getTexture(h.SPECULARTEXTURE)}set specularTexture(t){t?this._shaderValues.addDefine(h.SHADERDEFINE_SPECULARMAP):this._shaderValues.removeDefine(h.SHADERDEFINE_SPECULARMAP),this._shaderValues.setTexture(h.SPECULARTEXTURE,t)}get depthWrite(){return this._shaderValues.getBool(h.DEPTH_WRITE)}set depthWrite(t){this._shaderValues.setBool(h.DEPTH_WRITE,t)}get cull(){return this._shaderValues.getInt(h.CULL)}set cull(t){this._shaderValues.setInt(h.CULL,t)}get blend(){return this._shaderValues.getInt(h.BLEND)}set blend(t){this._shaderValues.setInt(h.BLEND,t)}get blendSrc(){return this._shaderValues.getInt(h.BLEND_SRC)}set blendSrc(t){this._shaderValues.setInt(h.BLEND_SRC,t)}get blendDst(){return this._shaderValues.getInt(h.BLEND_DST)}set blendDst(t){this._shaderValues.setInt(h.BLEND_DST,t)}get depthTest(){return this._shaderValues.getInt(h.DEPTH_TEST)}set depthTest(t){this._shaderValues.setInt(h.DEPTH_TEST,t)}constructor(){super(),r()(this,"_albedoColor",void 0),r()(this,"_albedoIntensity",void 0),r()(this,"_enableLighting",void 0),r()(this,"_enableVertexColor",!1),this.setShaderName("BLINNPHONG"),this._albedoIntensity=1,this._albedoColor=new s.a(1,1,1,1);var t=this._shaderValues;t.setVector(h.ALBEDOCOLOR,new s.a(1,1,1,1)),t.setVector(h.MATERIALSPECULAR,new s.a(1,1,1,1)),t.setNumber(h.SHININESS,.078125),t.setNumber(o.a.ALPHATESTVALUE,.5),t.setVector(h.TILINGOFFSET,new s.a(1,1,0,0)),this._enableLighting=!0,this.renderMode=h.RENDERMODE_OPAQUE}clone(){var t=new h;return this.cloneTo(t),t}cloneTo(t){super.cloneTo(t);var e=t;e._enableLighting=this._enableLighting,e._albedoIntensity=this._albedoIntensity,e._enableVertexColor=this._enableVertexColor,this._albedoColor.cloneTo(e._albedoColor)}}e.a=h,r()(h,"SPECULARSOURCE_DIFFUSEMAPALPHA",void 0),r()(h,"SPECULARSOURCE_SPECULARMAP",void 0),r()(h,"RENDERMODE_OPAQUE",0),r()(h,"RENDERMODE_CUTOUT",1),r()(h,"RENDERMODE_TRANSPARENT",2),r()(h,"SHADERDEFINE_DIFFUSEMAP",void 0),r()(h,"SHADERDEFINE_NORMALMAP",void 0),r()(h,"SHADERDEFINE_SPECULARMAP",void 0),r()(h,"SHADERDEFINE_TILINGOFFSET",void 0),r()(h,"SHADERDEFINE_ENABLEVERTEXCOLOR",void 0),r()(h,"ALBEDOTEXTURE",n.a.propertyNameToID("u_DiffuseTexture")),r()(h,"NORMALTEXTURE",n.a.propertyNameToID("u_NormalTexture")),r()(h,"SPECULARTEXTURE",n.a.propertyNameToID("u_SpecularTexture")),r()(h,"ALBEDOCOLOR",n.a.propertyNameToID("u_DiffuseColor")),r()(h,"MATERIALSPECULAR",n.a.propertyNameToID("u_MaterialSpecular")),r()(h,"SHININESS",n.a.propertyNameToID("u_Shininess")),r()(h,"TILINGOFFSET",n.a.propertyNameToID("u_TilingOffset")),r()(h,"CULL",n.a.propertyNameToID("s_Cull")),r()(h,"BLEND",n.a.propertyNameToID("s_Blend")),r()(h,"BLEND_SRC",n.a.propertyNameToID("s_BlendSrc")),r()(h,"BLEND_DST",n.a.propertyNameToID("s_BlendDst")),r()(h,"DEPTH_TEST",n.a.propertyNameToID("s_DepthTest")),r()(h,"DEPTH_WRITE",n.a.propertyNameToID("s_DepthWrite")),r()(h,"defaultMaterial",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(278),o=i(37),l=i(17),h=i(8),_=i(10),c=i(40),d=i(7),u=i(448);e.a=class extends l.a{constructor(t,e,i,a,s){super(),r()(this,"_attributeMap",void 0),r()(this,"_uniformMap",void 0),r()(this,"_globaluniformMap",void 0),r()(this,"_shaderPass",void 0),r()(this,"_vs",void 0),r()(this,"_ps",void 0),r()(this,"_curActTexIndex",void 0),r()(this,"_vshader",void 0),r()(this,"_pshader",void 0),r()(this,"_program",void 0),r()(this,"_sceneUniformParamsMap",void 0),r()(this,"_cameraUniformParamsMap",void 0),r()(this,"_spriteUniformParamsMap",void 0),r()(this,"_materialUniformParamsMap",void 0),r()(this,"_customUniformParamsMap",void 0),r()(this,"_stateParamsMap",[]),r()(this,"_uploadMark",-1),r()(this,"_uploadMaterial",void 0),r()(this,"_uploadRender",void 0),r()(this,"_uploadRenderType",-1),r()(this,"_uploadCameraShaderValue",void 0),r()(this,"_uploadScene",void 0),this._vs=t,this._ps=e,this._attributeMap=i,this._uniformMap=a,this._shaderPass=s,this._globaluniformMap=[],this._create(),this.lock=!0}_create(){var t=s.a.instance;for(var e in this._program=t.createProgram(),this._vshader=this._createShader(t,this._vs,t.VERTEX_SHADER),this._pshader=this._createShader(t,this._ps,t.FRAGMENT_SHADER),t.attachShader(this._program,this._vshader),t.attachShader(this._program,this._pshader),this._attributeMap)t.bindAttribLocation(this._program,this._attributeMap[e],e);if(t.linkProgram(this._program),!o.a.isConchApp&&d.a.debugMode&&!t.getProgramParameter(this._program,t.LINK_STATUS))throw t.getProgramInfoLog(this._program);var i=[],a=[],r=[],n=[],l=[];this._customUniformParamsMap=[];var h,c,f,m=t.getProgramParameter(this._program,t.ACTIVE_UNIFORMS);for(_.a.useProgram(t,this._program),this._curActTexIndex=0,c=0;c<m;c++){var p=t.getActiveUniform(this._program,c),g=p.name;(h=new u.a).location=t.getUniformLocation(this._program,g),g.indexOf("[0]")>0?(h.name=g=g.substr(0,g.length-3),h.isArray=!0):(h.name=g,h.isArray=!1),h.type=p.type,this._addShaderUnifiormFun(h);var v=this._uniformMap[g];if(null!=v)switch(h.dataOffset=d.a.propertyNameToID(g),v){case d.a.PERIOD_CUSTOM:l.push(h);break;case d.a.PERIOD_MATERIAL:n.push(h);break;case d.a.PERIOD_SPRITE:r.push(h);break;case d.a.PERIOD_CAMERA:a.push(h);break;case d.a.PERIOD_SCENE:i.push(h);break;default:throw new Error("Shader3D: period is unkonw.")}else h.dataOffset=d.a.propertyNameToID(g),this._globaluniformMap[g]=d.a.PERIOD_SCENE,i.push(h)}for(this._sceneUniformParamsMap=s.a.instance.createCommandEncoder(4*i.length*5+4,64,!0),c=0,f=i.length;c<f;c++)this._sceneUniformParamsMap.addShaderUniform(i[c]);for(this._cameraUniformParamsMap=s.a.instance.createCommandEncoder(4*a.length*5+4,64,!0),c=0,f=a.length;c<f;c++)this._cameraUniformParamsMap.addShaderUniform(a[c]);for(this._spriteUniformParamsMap=s.a.instance.createCommandEncoder(4*r.length*5+4,64,!0),c=0,f=r.length;c<f;c++)this._spriteUniformParamsMap.addShaderUniform(r[c]);for(this._materialUniformParamsMap=s.a.instance.createCommandEncoder(4*n.length*5+4,64,!0),c=0,f=n.length;c<f;c++)this._materialUniformParamsMap.addShaderUniform(n[c]);for(this._customUniformParamsMap.length=l.length,c=0,f=l.length;c<f;c++){var T=l[c];this._customUniformParamsMap[T.dataOffset]=T}var E=this._shaderPass._stateMap;for(var S in E)this._stateParamsMap[E[S]]=d.a.propertyNameToID(S)}_getRenderState(t,e){var i=this._stateParamsMap[e];return null==i?null:t[i]}_disposeResource(){s.a.instance.deleteShader(this._vshader),s.a.instance.deleteShader(this._pshader),s.a.instance.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._setGPUMemory(0),this._curActTexIndex=0}_addShaderUnifiormFun(t){var e=s.a.instance;t.caller=this;var i=t.isArray;switch(t.type){case e.BOOL:t.fun=this._uniform1i,t.uploadedValue=new Array(1);break;case e.INT:t.fun=i?this._uniform1iv:this._uniform1i,t.uploadedValue=new Array(1);break;case e.FLOAT:t.fun=i?this._uniform1fv:this._uniform1f,t.uploadedValue=new Array(1);break;case e.FLOAT_VEC2:t.fun=i?this._uniform_vec2v:this._uniform_vec2,t.uploadedValue=new Array(2);break;case e.FLOAT_VEC3:t.fun=i?this._uniform_vec3v:this._uniform_vec3,t.uploadedValue=new Array(3);break;case e.FLOAT_VEC4:t.fun=i?this._uniform_vec4v:this._uniform_vec4,t.uploadedValue=new Array(4);break;case e.FLOAT_MAT2:t.fun=this._uniformMatrix2fv;break;case e.FLOAT_MAT3:t.fun=this._uniformMatrix3fv;break;case e.FLOAT_MAT4:t.fun=i?this._uniformMatrix4fv:this._uniformMatrix4f;break;case e.SAMPLER_2D:case e.SAMPLER_2D_SHADOW:e.uniform1i(t.location,this._curActTexIndex),t.textureID=_.a._glTextureIDs[this._curActTexIndex++],t.fun=this._uniform_sampler2D;break;case 35679:e.uniform1i(t.location,this._curActTexIndex),t.textureID=_.a._glTextureIDs[this._curActTexIndex++],t.fun=this._uniform_sampler3D;break;case e.SAMPLER_CUBE:e.uniform1i(t.location,this._curActTexIndex),t.textureID=_.a._glTextureIDs[this._curActTexIndex++],t.fun=this._uniform_samplerCube;break;default:throw new Error("compile shader err!")}}_createShader(t,e,i){var a=t.createShader(i);if(t.shaderSource(a,e),t.compileShader(a),d.a.debugMode&&!t.getShaderParameter(a,t.COMPILE_STATUS))throw t.getShaderInfoLog(a);return a}_uniform1f(t,e){var i=t.uploadedValue;return i[0]!==e?(s.a.instance.uniform1f(t.location,i[0]=e),1):0}_uniform1fv(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(s.a.instance.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return s.a.instance.uniform1fv(t.location,e),1}_uniform_vec2(t,e){var i=t.uploadedValue;return i[0]!==e.x||i[1]!==e.y?(s.a.instance.uniform2f(t.location,i[0]=e.x,i[1]=e.y),1):0}_uniform_vec2v(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(s.a.instance.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return s.a.instance.uniform2fv(t.location,e),1}_uniform_vec3(t,e){var i=t.uploadedValue;return i[0]!==e.x||i[1]!==e.y||i[2]!==e.z?(s.a.instance.uniform3f(t.location,i[0]=e.x,i[1]=e.y,i[2]=e.z),1):0}_uniform_vec3v(t,e){return s.a.instance.uniform3fv(t.location,e),1}_uniform_vec4(t,e){var i=t.uploadedValue;return i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w?(s.a.instance.uniform4f(t.location,i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w),1):0}_uniform_vec4v(t,e){return s.a.instance.uniform4fv(t.location,e),1}_uniformMatrix2fv(t,e){return s.a.instance.uniformMatrix2fv(t.location,!1,e),1}_uniformMatrix3fv(t,e){return s.a.instance.uniformMatrix3fv(t.location,!1,e),1}_uniformMatrix4f(t,e){var i=e.elements;return s.a.instance.uniformMatrix4fv(t.location,!1,i),1}_uniformMatrix4fv(t,e){return s.a.instance.uniformMatrix4fv(t.location,!1,e),1}_uniform1i(t,e){var i=t.uploadedValue;return i[0]!==e?(s.a.instance.uniform1i(t.location,i[0]=e),1):0}_uniform1iv(t,e){return s.a.instance.uniform1iv(t.location,e),1}_uniform_ivec2(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(s.a.instance.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0}_uniform_ivec2v(t,e){return s.a.instance.uniform2iv(t.location,e),1}_uniform_vec3i(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(s.a.instance.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0}_uniform_vec3vi(t,e){return s.a.instance.uniform3iv(t.location,e),1}_uniform_vec4i(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(s.a.instance.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0}_uniform_vec4vi(t,e){return s.a.instance.uniform4iv(t.location,e),1}_uniform_sampler2D(t,e){var i=e._getSource()||e.defaulteTexture._getSource(),a=s.a.instance;return _.a.activeTexture(a,t.textureID),_.a.bindTexture(a,a.TEXTURE_2D,i),0}_uniform_sampler3D(t,e){var i=e._getSource()||e.defaulteTexture._getSource(),a=s.a.instance;return _.a.activeTexture(a,t.textureID),_.a.bindTexture(a,WebGL2RenderingContext.TEXTURE_3D,i),0}_uniform_samplerCube(t,e){var i=e._getSource()||e.defaulteTexture._getSource(),a=s.a.instance;return _.a.activeTexture(a,t.textureID),_.a.bindTexture(a,a.TEXTURE_CUBE_MAP,i),0}bind(){return _.a.useProgram(s.a.instance,this._program)}uploadUniforms(t,e,i){h.a.shaderCall+=n.a.uploadShaderUniforms(s.a.instance,t,e,i)}uploadRenderStateBlendDepth(t){var e=s.a.instance,i=this._shaderPass.renderState,a=t.getData(),r=this._getRenderState(a,d.a.RENDER_STATE_DEPTH_WRITE),n=this._getRenderState(a,d.a.RENDER_STATE_DEPTH_TEST),o=this._getRenderState(a,d.a.RENDER_STATE_BLEND);switch(null==r&&(r=i.depthWrite),null==n&&(n=i.depthTest),null==o&&(o=i.blend),_.a.setDepthMask(e,r),n===c.a.DEPTHTEST_OFF?_.a.setDepthTest(e,!1):(_.a.setDepthTest(e,!0),_.a.setDepthFunc(e,n)),o){case c.a.BLEND_DISABLE:_.a.setBlend(e,!1);break;case c.a.BLEND_ENABLE_ALL:var l=this._getRenderState(a,d.a.RENDER_STATE_BLEND_EQUATION),h=this._getRenderState(a,d.a.RENDER_STATE_BLEND_SRC),u=this._getRenderState(a,d.a.RENDER_STATE_BLEND_DST);null==l&&(l=i.blendEquation),null==h&&(h=i.srcBlend),null==u&&(u=i.dstBlend),_.a.setBlend(e,!0),_.a.setBlendEquation(e,l),_.a.setBlendFunc(e,h,u);break;case c.a.BLEND_ENABLE_SEPERATE:var f=this._getRenderState(a,d.a.RENDER_STATE_BLEND_EQUATION_RGB),m=this._getRenderState(a,d.a.RENDER_STATE_BLEND_EQUATION_ALPHA),p=this._getRenderState(a,d.a.RENDER_STATE_BLEND_SRC_RGB),g=this._getRenderState(a,d.a.RENDER_STATE_BLEND_DST_RGB),v=this._getRenderState(a,d.a.RENDER_STATE_BLEND_SRC_ALPHA),T=this._getRenderState(a,d.a.RENDER_STATE_BLEND_DST_ALPHA);null==f&&(f=i.blendEquationRGB),null==m&&(m=i.blendEquationAlpha),null==p&&(p=i.srcBlendRGB),null==g&&(g=i.dstBlendRGB),null==v&&(v=i.srcBlendAlpha),null==T&&(T=i.dstBlendAlpha),_.a.setBlend(e,!0),_.a.setBlendEquationSeparate(e,f,m),_.a.setBlendFuncSeperate(e,p,g,v,T)}}uploadRenderStateFrontFace(t,e,i){var a,r=s.a.instance,n=this._shaderPass.renderState,o=t.getData(),l=this._getRenderState(o,d.a.RENDER_STATE_CULL);switch(null==l&&(l=n.cull),l){case c.a.CULL_NONE:_.a.setCullFace(r,!1);break;case c.a.CULL_FRONT:_.a.setCullFace(r,!0),a=e?i?r.CCW:r.CW:i?r.CW:r.CCW,_.a.setFrontFace(r,a);break;case c.a.CULL_BACK:_.a.setCullFace(r,!0),a=e?i?r.CW:r.CCW:i?r.CCW:r.CW,_.a.setFrontFace(r,a)}}uploadCustomUniform(t,e){h.a.shaderCall+=n.a.uploadCustomUniform(s.a.instance,this._customUniformParamsMap,t,e)}_uniformMatrix2fvForNative(t,e){return s.a.instance.uniformMatrix2fvEx(t.location,!1,e),1}_uniformMatrix3fvForNative(t,e){return s.a.instance.uniformMatrix3fvEx(t.location,!1,e),1}_uniformMatrix4fvForNative(t,e){return s.a.instance.uniformMatrix4fvEx(t.location,!1,e),1}}},function(t,e,i){"use strict";var a=i(2);e.a=class{static uploadShaderUniforms(t,e,i,a){for(var r=i._data,s=e.getArrayData(),n=0,o=0,l=s.length;o<l;o++){var h=s[o];if(a||-1!==h.textureID){var _=r[h.dataOffset];null!=_&&(n+=h.fun.call(h.caller,h,_))}}return n}static uploadCustomUniform(t,e,i,a){var r=0,s=e[i];return s&&null!=a&&(r+=s.fun.call(s.caller,s,a)),r}static uploadShaderUniformsForNative(t,e,i){var r=a.a.UPLOAD_SHADER_UNIFORM_TYPE_ID;i._runtimeCopyValues.length>0&&(r=a.a.UPLOAD_SHADER_UNIFORM_TYPE_DATA);var s=i._data;return a.a.instance.uploadShaderUniforms(e,s,r)}}},function(t,e,i){"use strict";var a=i(52);e.a=class extends a.a{constructor(){super()}add(t){if(-1!==t._getIndexInList())throw"SimpleSingletonList:"+t+" has  in  SingletonList.";this._add(t),t._setIndexInList(this.length++)}remove(t){var e=t._getIndexInList();if(this.length--,e!==this.length){var i=this.elements[this.length];this.elements[e]=i,i._setIndexInList(e)}t._setIndexInList(-1)}clear(){for(var t=this.elements,e=0,i=this.length;e<i;e++)t[e]._setIndexInList(-1);this.length=0}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){r()(this,"flags",0),r()(this,"maxSubSteps",1),r()(this,"fixedTimeStep",1/60)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(275),n=i(38),o=i(57),l=i(282),h=i(25),_=i(2),c=i(8),d=i(39);class u extends s.a{static __init__(){u.instance=new u}get stacks(){return this._stacks}get slices(){return this._slices}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:48,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:48;super(),r()(this,"_stacks",void 0),r()(this,"_slices",void 0);var i=_.a.instance;this._stacks=t,this._slices=e;for(var a=l.a.vertexDeclaration,s=a.vertexStride/4,c=(this._stacks+1)*(this._slices+1),f=3*this._stacks*(this._slices+1)*2,m=new Float32Array(c*s),p=new Uint16Array(f),g=Math.PI/this._stacks,v=2*Math.PI/this._slices,T=0,E=0,S=0,R=0;R<this._stacks+1;R++)for(var x=Math.sin(R*g),A=Math.cos(R*g),y=0;y<this._slices+1;y++){var I=x*Math.sin(y*v),C=x*Math.cos(y*v);m[E+0]=I*u._radius,m[E+1]=A*u._radius,m[E+2]=C*u._radius,m[E+3]=-y/this._slices+.75,m[E+4]=R/this._stacks,E+=s,R!=this._stacks-1&&(p[S++]=T+1,p[S++]=T,p[S++]=T+(this._slices+1),p[S++]=T+(this._slices+1),p[S++]=T,p[S++]=T+this._slices,T++)}this._vertexBuffer=new h.a(4*m.length,i.STATIC_DRAW,!1),this._vertexBuffer.vertexDeclaration=a,this._indexBuffer=new o.a(d.a.UInt16,p.length,i.STATIC_DRAW,!1),this._vertexBuffer.setData(m.buffer),this._indexBuffer.setData(p);var M=new n.a;M.bind(),M.applyVertexBuffer(this._vertexBuffer),M.applyIndexBuffer(this._indexBuffer),M.unBind(),this._bufferState=M}_render(t){var e=_.a.instance,i=this._indexBuffer.indexCount;e.drawElements(e.TRIANGLES,i,e.UNSIGNED_SHORT,0),c.a.trianglesFaces+=i/3,c.a.renderBatches++}}e.a=u,r()(u,"_radius",1),r()(u,"instance",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(14),n=i(55),o=i(56),l=i(31);class h{static get vertexDeclaration(){return h._vertexDeclaration}static __init__(){h._vertexDeclaration=new n.a(20,[new o.a(0,l.a.Vector3,s.a.MESH_POSITION0),new o.a(12,l.a.Vector2,s.a.MESH_TEXTURECOORDINATE0)])}get position(){return this._position}get textureCoordinate0(){return this._textureCoordinate0}get vertexDeclaration(){return h._vertexDeclaration}constructor(t,e){r()(this,"_position",void 0),r()(this,"_textureCoordinate0",void 0),this._position=t,this._textureCoordinate0=e}}e.a=h,r()(h,"_vertexDeclaration",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(14),n=i(55),o=i(56),l=i(31);class h{static get vertexDeclaration(){return h._vertexDeclaration}static __init__(){h._vertexDeclaration=new n.a(28,[new o.a(0,l.a.Vector3,s.a.MESH_POSITION0),new o.a(12,l.a.Vector4,s.a.MESH_COLOR0)])}get vertexDeclaration(){return h._vertexDeclaration}constructor(){}}e.a=h,r()(h,"_vertexDeclaration",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){r()(this,"updateMark",-1),r()(this,"indexInList",-1),r()(this,"batched",!1)}}},function(t,e,i){"use strict";i.d(e,"b",function(){return y});var a=i(0),r=i.n(a),s=i(2),n=i(47),o=i(273),l=i(87),h=i(180),_=i(128),c=i(179),d=i(178),u=i(131),f=i(49),m=i(9),p=i(99),g=i(1),v=i(5),T=i(86),E=i(7),S=i(32),R=i(463),x=i(100),A=i(174);let y;!function(t){t[t.DirectionLight=0]="DirectionLight",t[t.SpotLight=1]="SpotLight",t[t.PointLight=2]="PointLight"}(y||(y={}));class I{constructor(){r()(this,"_shadowBias",new v.a),r()(this,"_shadowParams",new v.a),r()(this,"_shadowMapSize",new v.a),r()(this,"_shadowMatrices",new Float32Array(16*I._maxCascades)),r()(this,"_shadowSpotMatrices",new m.a),r()(this,"_splitBoundSpheres",new Float32Array(4*I._maxCascades)),r()(this,"_cascadeCount",0),r()(this,"_shadowMapWidth",0),r()(this,"_shadowMapHeight",0),r()(this,"_shadowDirectLightMap",void 0),r()(this,"_shadowSpotLightMap",void 0),r()(this,"_shadowSliceDatas",[new R.a,new R.a,new R.a,new R.a]),r()(this,"_shadowSpotData",new R.b),r()(this,"_light",void 0),r()(this,"_lightUp",new g.a),r()(this,"_lightSide",new g.a),r()(this,"_lightForward",new g.a),this._shadowSpotData.cameraCullInfo.boundFrustum=new A.a(new m.a)}_setupShadowCasterShaderValues(t,e,i,a,r,s,n){switch(e.setVector(I.SHADOW_BIAS,s),n){case x.b.Directional:e.setVector3(I.SHADOW_LIGHT_DIRECTION,a);break;case x.b.Spot:e.setVector(I.SHADOW_PARAMS,r);break;case x.b.Point:}var l=i.cameraShaderValue;l.setMatrix4x4(o.a.VIEWMATRIX,i.viewMatrix),l.setMatrix4x4(o.a.PROJECTMATRIX,i.projectionMatrix),l.setMatrix4x4(o.a.VIEWPROJECTMATRIX,i.viewProjectMatrix),t.viewMatrix=i.viewMatrix,t.projectionMatrix=i.projectionMatrix,t.projectionViewMatrix=i.viewProjectMatrix}_setupShadowReceiverShaderValues(t){var e=this._light;switch(e.shadowCascadesMode!==h.a.NoCascades?t.addDefine(d.a.SHADERDEFINE_SHADOW_CASCADE):t.removeDefine(d.a.SHADERDEFINE_SHADOW_CASCADE),e.shadowMode){case _.a.Hard:t.removeDefine(d.a.SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW),t.removeDefine(d.a.SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH);break;case _.a.SoftLow:t.addDefine(d.a.SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW),t.removeDefine(d.a.SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH);break;case _.a.SoftHigh:t.addDefine(d.a.SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH),t.removeDefine(d.a.SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW)}t.setTexture(I.SHADOW_MAP,this._shadowDirectLightMap),t.setBuffer(I.SHADOW_MATRICES,this._shadowMatrices),t.setVector(I.SHADOW_MAP_SIZE,this._shadowMapSize),t.setVector(I.SHADOW_PARAMS,this._shadowParams),t.setBuffer(I.SHADOW_SPLIT_SPHERES,this._splitBoundSpheres)}_setupSpotShadowReceiverShaderValues(t){switch(this._light.shadowMode){case _.a.Hard:t.removeDefine(d.a.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH),t.removeDefine(d.a.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW);break;case _.a.SoftLow:t.addDefine(d.a.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW),t.removeDefine(d.a.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH);break;case _.a.SoftHigh:t.addDefine(d.a.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH),t.removeDefine(d.a.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW)}t.setTexture(I.SHADOW_SPOTMAP,this._shadowSpotLightMap),t.setMatrix4x4(I.SHADOW_SPOTMATRICES,this._shadowSpotMatrices),t.setVector(I.SHADOW_MAP_SIZE,this._shadowMapSize),t.setVector(I.SHADOW_PARAMS,this._shadowParams)}update(t,e,i){switch(i){case y.DirectionLight:this._light=e;var a=(D=I._tempMatrix0).elements,r=this._lightUp,s=this._lightSide,n=this._lightForward;m.a.createFromQuaternion(e._transform.rotation,D),s.setValue(a[0],a[1],a[2]),r.setValue(a[4],a[5],a[6]),n.setValue(-a[8],-a[9],-a[10]);var o,l,_,d,u=e._shadowResolution,p=e._shadowCascadesMode;p==h.a.NoCascades?(o=1,l=u,_=u,d=u):(o=p==h.a.TwoCascades?2:4,_=2*(l=c.a.getMaxTileResolutionInAtlas(u,u,o)),d=p==h.a.TwoCascades?l:2*l),this._cascadeCount=o,this._shadowMapWidth=_,this._shadowMapHeight=d;var v=I._cascadesSplitDistance,T=I._frustumPlanes,E=t.nearPlane,S=Math.min(t.farPlane,e._shadowDistance),R=this._shadowMatrices,x=this._splitBoundSpheres;c.a.getCascadesSplitDistance(e._shadowTwoCascadeSplits,e._shadowFourCascadeSplits,E,S,t.fieldOfView*f.a.Deg2Rad,t.aspectRatio,p,v),c.a.getCameraFrustumPlanes(t.projectionViewMatrix,T);var A=I._tempVector30;t._transform.getForward(A),g.a.normalize(A,A);for(var C=0;C<o;C++){var M=this._shadowSliceDatas[C];M.sphereCenterZ=c.a.getBoundSphereByFrustum(v[C],v[C+1],t.fieldOfView*f.a.Deg2Rad,t.aspectRatio,t._transform.position,A,M.splitBoundSphere),c.a.getDirectionLightShadowCullPlanes(T,C,v,E,n,M),c.a.getDirectionalLightMatrices(r,s,n,C,e._shadowNearPlane,l,M,R),o>1&&c.a.applySliceTransform(M,_,d,C,R)}c.a.prepareShadowReceiverShaderValues(e,_,d,this._shadowSliceDatas,o,this._shadowMapSize,this._shadowParams,R,x);break;case y.SpotLight:this._light=e;var D=I._tempMatrix0,b=(n=this._lightForward,this._light._shadowResolution);this._shadowMapWidth=b,this._shadowMapHeight=b;var L=this._shadowSpotData;c.a.getSpotLightShadowData(L,this._light,b,this._shadowParams,this._shadowSpotMatrices,this._shadowMapSize);break;case y.PointLight:break;default:throw"There is no shadow of this type"}}render(t,e,i){switch(i){case y.DirectionLight:var a=e._shaderValues;t.pipelineMode="ShadowCaster",S.a.setRuntimeValueMode(!1),(T=this._shadowDirectLightMap=c.a.getTemporaryShadowTexture(this._shadowMapWidth,this._shadowMapHeight,n.a.DEPTH_16))._start();for(var r=this._light,o=0,h=this._cascadeCount;o<h;o++){var _=this._shadowSliceDatas[o];c.a.getShadowBias(r,_.projectionMatrix,_.resolution,this._shadowBias),this._setupShadowCasterShaderValues(t,a,_,this._lightForward,this._shadowParams,this._shadowBias,x.b.Directional);var d=u.b._shadowCullInfo;d.position=_.position,d.cullPlanes=_.cullPlanes,d.cullPlaneCount=_.cullPlaneCount,d.cullSphere=_.splitBoundSphere,d.direction=this._lightForward;var f=u.b.cullingShadow(d,e,t);t.cameraShaderValue=_.cameraShaderValue,l.a._updateMark++;var m=s.a.instance,p=_.resolution,g=_.offsetX,v=_.offsetY;m.enable(m.SCISSOR_TEST),m.viewport(g,v,p,p),m.scissor(g,v,p,p),m.clear(m.DEPTH_BUFFER_BIT),f&&(m.scissor(g+1,v+1,p-2,p-2),e._opaqueQueue._render(t))}T._end(),this._setupShadowReceiverShaderValues(a),S.a.setRuntimeValueMode(!0),t.pipelineMode="Forward";break;case y.SpotLight:a=e._shaderValues;t.pipelineMode="ShadowCaster",S.a.setRuntimeValueMode(!1);var T,E=this._light;(T=this._shadowSpotLightMap=c.a.getTemporaryShadowTexture(this._shadowMapWidth,this._shadowMapHeight,n.a.DEPTH_16))._start();var R=this._shadowSpotData;c.a.getShadowBias(E,R.projectionMatrix,R.resolution,this._shadowBias),this._setupShadowCasterShaderValues(t,a,R,this._light.transform.position,this._shadowParams,this._shadowBias,x.b.Spot);f=u.b.cullingSpotShadow(R.cameraCullInfo,e,t);t.cameraShaderValue=R.cameraShaderValue,l.a._updateMark++,(m=s.a.instance).enable(m.SCISSOR_TEST),m.viewport(R.offsetX,R.offsetY,R.resolution,R.resolution),m.scissor(R.offsetX,R.offsetY,R.resolution,R.resolution),m.clear(m.DEPTH_BUFFER_BIT),f&&(m.scissor(R.offsetX,R.offsetY,R.resolution,R.resolution),e._opaqueQueue._render(t)),T._end(),this._setupSpotShadowReceiverShaderValues(a),S.a.setRuntimeValueMode(!0),t.pipelineMode="Forward";break;case y.PointLight:break;default:throw"There is no shadow of this type"}}cleanUp(){this._shadowDirectLightMap&&T.a.recoverToPool(this._shadowDirectLightMap),this._shadowSpotLightMap&&T.a.recoverToPool(this._shadowSpotLightMap),this._shadowDirectLightMap=null,this._shadowSpotLightMap=null,this._light=null}}e.a=I,r()(I,"_tempVector30",new g.a),r()(I,"_tempMatrix0",new m.a),r()(I,"SHADOW_BIAS",E.a.propertyNameToID("u_ShadowBias")),r()(I,"SHADOW_LIGHT_DIRECTION",E.a.propertyNameToID("u_ShadowLightDirection")),r()(I,"SHADOW_SPLIT_SPHERES",E.a.propertyNameToID("u_ShadowSplitSpheres")),r()(I,"SHADOW_MATRICES",E.a.propertyNameToID("u_ShadowMatrices")),r()(I,"SHADOW_MAP_SIZE",E.a.propertyNameToID("u_ShadowMapSize")),r()(I,"SHADOW_MAP",E.a.propertyNameToID("u_ShadowMap")),r()(I,"SHADOW_PARAMS",E.a.propertyNameToID("u_ShadowParams")),r()(I,"SHADOW_SPOTMAP",E.a.propertyNameToID("u_SpotShadowMap")),r()(I,"SHADOW_SPOTMATRICES",E.a.propertyNameToID("u_SpotViewProjectMatrix")),r()(I,"_maxCascades",4),r()(I,"_cascadesSplitDistance",new Array(I._maxCascades+1)),r()(I,"_frustumPlanes",new Array(new p.a(new g.a),new p.a(new g.a),new p.a(new g.a),new p.a(new g.a),new p.a(new g.a),new p.a(new g.a)))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1),n=i(175);class o{constructor(t,e){r()(this,"center",void 0),r()(this,"radius",void 0),this.center=t,this.radius=e}toDefault(){this.center.toDefault(),this.radius=0}static createFromSubPoints(t,e,i,a){if(null==t)throw new Error("points");if(e<0||e>=t.length)throw new Error("start"+e+"Must be in the range [0, "+(t.length-1)+"]");if(i<0||e+i>t.length)throw new Error("count"+i+"Must be in the range <= "+t.length+"}");var r=e+i,n=o._tempVector3;n.x=0,n.y=0,n.z=0;for(var l=e;l<r;++l)s.a.add(t[l],n,n);var h=a.center;s.a.scale(n,1/i,h);var _=0;for(l=e;l<r;++l){var c=s.a.distanceSquared(h,t[l]);c>_&&(_=c)}a.radius=Math.sqrt(_)}static createfromPoints(t,e){if(null==t)throw new Error("points");o.createFromSubPoints(t,0,t.length,e)}intersectsRayDistance(t){return n.a.intersectsRayAndSphereRD(t,this)}intersectsRayPoint(t,e){return n.a.intersectsRayAndSphereRP(t,this,e)}cloneTo(t){var e=t;this.center.cloneTo(e.center),e.radius=this.radius}clone(){var t=new o(new s.a,0);return this.cloneTo(t),t}}e.a=o,r()(o,"_tempVector3",new s.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(41),n=i(186),o=i(185),l=i(184),h=i(288),_=i(134),c=i(136),d=i(5),u=i(104),f=i(12),m=i(7);class p extends s.a{static __init__(){u.a.SHADERDEFINE_UV0=m.a.getDefineByName("UV"),u.a.SHADERDEFINE_COLOR=m.a.getDefineByName("COLOR"),u.a.SHADERDEFINE_UV1=m.a.getDefineByName("UV1"),u.a.SHADERDEFINE_GPU_INSTANCE=m.a.getDefineByName("GPU_INSTANCE"),u.a.SHADERDEFINE_SPECCUBE_BOX_PROJECTION=m.a.getDefineByName("SPECCUBE_BOX_PROJECTION"),c.a._registerManager(_.a.instance),l.a._registerManager(h.a.instance)}get meshFilter(){return this._meshFilter}get meshRenderer(){return this._render}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),r()(this,"_meshFilter",void 0),this._meshFilter=new n.a(this),this._render=new o.a(this),t&&(this._meshFilter.sharedMesh=t)}_parse(t,e){super._parse(t,e);var i=this.meshRenderer,a=t.lightmapIndex;null!=a&&(i.lightmapIndex=a);var r=t.lightmapScaleOffset;r&&(i.lightmapScaleOffset=new d.a(r[0],r[1],r[2],r[3])),void 0!=t.meshPath&&(this.meshFilter.sharedMesh=f.a.getRes(t.meshPath)),void 0!=t.enableRender&&(i.enable=t.enableRender),void 0!=t.receiveShadows&&(i.receiveShadow=t.receiveShadows),void 0!=t.castShadow&&(i.castShadow=t.castShadow);var s=t.materials;if(s){var n=i.sharedMaterials,o=s.length;n.length=o;for(var l=0;l<o;l++)n[l]=f.a.getRes(s[l].path);i.sharedMaterials=n}}_addToInitStaticBatchManager(){this.meshFilter.sharedMesh&&_.a.instance._addBatchSprite(this)}_cloneTo(t,e,i){var a=t;a._meshFilter.sharedMesh=this._meshFilter.sharedMesh;var r=this._render,s=a._render;s.enable=r.enable,s.sharedMaterials=r.sharedMaterials,s.castShadow=r.castShadow;var n=r.lightmapScaleOffset;n&&(s.lightmapScaleOffset=n.clone()),s.lightmapIndex=r.lightmapIndex,s.receiveShadow=r.receiveShadow,s.sortingFudge=r.sortingFudge,super._cloneTo(t,e,i)}destroy(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.destroyed||(super.destroy(t),this._meshFilter.destroy())}_create(){return new p}}e.a=p},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(184),n=i(289),o=i(38),l=i(284),h=i(135),_=i(52);class c extends s.a{constructor(){super(),r()(this,"_instanceBatchOpaqueMarks",[]),r()(this,"_vertexBatchOpaqueMarks",[]),r()(this,"_cacheBufferStates",[]),r()(this,"_updateCountMark",void 0),this._updateCountMark=0}getInstanceBatchOpaquaMark(t,e,i,a){var r=this._instanceBatchOpaqueMarks[t?0:1]||(this._instanceBatchOpaqueMarks[t?0:1]=[]),s=r[e]||(r[e]=[]),n=s[i]||(s[i]=[]);return n[a?1:0]||(n[a?1:0]=new l.a)}getVertexBatchOpaquaMark(t,e,i,a){var r=this._vertexBatchOpaqueMarks[t]||(this._vertexBatchOpaqueMarks[t]=[]),s=r[e?0:1]||(r[e?0:1]=[]),n=s[i]||(s[i]=[]);return n[a]||(n[a]=new l.a)}_getBufferState(t){var e=this._cacheBufferStates[t.id];if(!e){var i=n.a.instance;(e=new o.a).bind();var a=i._vertexBuffer;a.vertexDeclaration=t,e.applyVertexBuffer(a),e.applyIndexBuffer(i._indexBuffer),e.unBind(),this._cacheBufferStates[t.id]=e}return e}_getBatchRenderElementFromPool(){var t=this._batchRenderElementPool[this._batchRenderElementPoolIndex++];return t||(t=new h.a,this._batchRenderElementPool[this._batchRenderElementPoolIndex-1]=t,t.vertexBatchElementList=new _.a,t.instanceBatchElementList=new _.a),t}_clear(){super._clear(),this._updateCountMark++}}e.a=c,r()(c,"instance",new c)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(11),n=i(2),o=i(17),l=i(8),h=i(38),_=i(75),c=i(57),d=i(14),u=i(25),f=i(39);class m extends _.a{static __init__(){m.instance=new m}constructor(){super(),r()(this,"_vertices",void 0),r()(this,"_indices",void 0),r()(this,"_positionOffset",void 0),r()(this,"_normalOffset",void 0),r()(this,"_colorOffset",void 0),r()(this,"_uv0Offset",void 0),r()(this,"_uv1Offset",void 0),r()(this,"_sTangentOffset",void 0),r()(this,"_vertexBuffer",void 0),r()(this,"_indexBuffer",void 0),r()(this,"_bufferState",new h.a);var t=n.a.instance,e=d.a.getVertexDeclaration("POSITION,NORMAL,COLOR,UV,UV1,TANGENT").vertexStride*m.maxIndicesCount;this._vertices=new Float32Array(e/4),this._vertexBuffer=new u.a(e,t.DYNAMIC_DRAW),this._indices=new Int16Array(m.maxIndicesCount),this._indexBuffer=new c.a(f.a.UInt16,this._indices.length,t.DYNAMIC_DRAW);var i=this._vertexBuffer._byteLength+this._indexBuffer._byteLength;o.a._addMemory(i,i)}_getBatchVertices(t,e,i,a,r,s){var n=t.vertexStride/4,o=s._vertexBuffer.getFloat32Data(),l=(r.render.lightmapScaleOffset,r._dynamicMultiSubMesh),h=r._dynamicVertexCount;r._computeWorldPositionsAndNormals(this._positionOffset,this._normalOffset,l,h);for(var _=r._dynamicWorldPositions,c=r._dynamicWorldNormals,d=s._indices,u=0;u<h;u++){var f=(l?d[u]:u)*n,m=(u+i)*n,p=3*u,g=m+this._positionOffset;e[g]=_[p],e[g+1]=_[p+1],e[g+2]=_[p+2],-1!==this._normalOffset&&(e[g=m+this._normalOffset]=c[p],e[g+1]=c[p+1],e[g+2]=c[p+2]),-1!==this._colorOffset&&(g=m+this._colorOffset,p=f+this._colorOffset,e[g]=o[p],e[g+1]=o[p+1],e[g+2]=o[p+2],e[g+3]=o[p+3]),-1!==this._uv0Offset&&(g=m+this._uv0Offset,p=f+this._uv0Offset,e[g]=o[p],e[g+1]=o[p+1]),-1!==this._sTangentOffset&&(g=m+this._sTangentOffset,p=f+this._sTangentOffset,e[g]=o[p],e[g+1]=o[p+1],e[g+2]=o[p+2],e[g+3]=o[p+3],g=m+this._sTangentOffset,p=f+this._sTangentOffset,e[g]=o[p],e[g+1]=o[p+1],e[g+2]=o[p+2],e[g+3]=o[p+3])}}_getBatchIndices(t,e,i,a,r,s){var n,o,l,h=r._indices,_=a._isFrontFaceInvert;if(s)if(_)for(n=0,o=h.length;n<o;n+=3){var c=i+n;t[l=e+n]=c,t[l+1]=c+2,t[l+2]=c+1}else for(n=0,o=h.length;n<o;n+=3)c=i+n,t[l=e+n]=c,t[l+1]=c+1,t[l+2]=c+2;else if(_)for(n=0,o=h.length;n<o;n+=3)t[l=e+n]=i+h[n],t[l+1]=i+h[n+2],t[l+2]=i+h[n+1];else for(n=0,o=h.length;n<o;n+=3)t[l=e+n]=i+h[n],t[l+1]=i+h[n+1],t[l+2]=i+h[n+2]}_flush(t,e){var i=n.a.instance;this._vertexBuffer.setData(this._vertices.buffer,0,0,t*this._bufferState.vertexDeclaration.vertexStride),this._indexBuffer.setData(this._indices,0,0,e),i.drawElements(i.TRIANGLES,e,i.UNSIGNED_SHORT,0)}_prepareRender(t){var e=t.renderElement.vertexBatchVertexDeclaration;this._bufferState=s.a.MeshRenderDynamicBatchManager.instance._getBufferState(e),this._positionOffset=e.getVertexElementByUsage(d.a.MESH_POSITION0)._offset/4;var i=e.getVertexElementByUsage(d.a.MESH_NORMAL0);this._normalOffset=i?i._offset/4:-1;var a=e.getVertexElementByUsage(d.a.MESH_COLOR0);this._colorOffset=a?a._offset/4:-1;var r=e.getVertexElementByUsage(d.a.MESH_TEXTURECOORDINATE0);this._uv0Offset=r?r._offset/4:-1;var n=e.getVertexElementByUsage(d.a.MESH_TEXTURECOORDINATE1);this._uv1Offset=n?n._offset/4:-1;var o=e.getVertexElementByUsage(d.a.MESH_TANGENT0);return this._sTangentOffset=o?o._offset/4:-1,!0}_render(t){this._bufferState.bind();for(var e=t.renderElement,i=e.vertexBatchVertexDeclaration,a=e.vertexBatchElementList,r=0,s=0,n=(i.vertexStride,0),o=a.length,h=a.elements,_=0;_<o;_++){var c=h[_],d=c._geometry,u=d._indexCount;s+u>m.maxIndicesCount&&(this._flush(r,s),n++,l.a.trianglesFaces+=s/3,r=s=0);var f=c._transform;this._getBatchVertices(i,this._vertices,r,f,c,d),this._getBatchIndices(this._indices,s,r,f,d,c._dynamicMultiSubMesh),r+=c._dynamicVertexCount,s+=u}this._flush(r,s),n++,l.a.renderBatches+=n,l.a.savedRenderBatches+=o-n,l.a.trianglesFaces+=s/3}}e.a=m,r()(m,"maxAllowVertexCount",10),r()(m,"maxAllowAttribueCount",900),r()(m,"maxIndicesCount",32e3),r()(m,"instance",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(12),n=i(73),o=i(20),l=i(1),h=i(5),_=i(7),c=i(187),d=i(64),u=i(41),f=i(476),m=i(477),p=i(293),g=i(294),v=i(292),T=i(478),E=i(295),S=i(296),R=i(297),x=i(479),A=i(480),y=i(481),I=i(482),C=i(483),M=i(484),D=i(485),b=i(298),L=i(486),O=i(487),P=i(188),N=i(299),w=i(488),B=i(489);class F extends u.a{static __init__(){P.a.SHADERDEFINE_RENDERMODE_BILLBOARD=_.a.getDefineByName("SPHERHBILLBOARD"),P.a.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=_.a.getDefineByName("STRETCHEDBILLBOARD"),P.a.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=_.a.getDefineByName("HORIZONTALBILLBOARD"),P.a.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=_.a.getDefineByName("VERTICALBILLBOARD"),P.a.SHADERDEFINE_COLOROVERLIFETIME=_.a.getDefineByName("COLOROVERLIFETIME"),P.a.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=_.a.getDefineByName("RANDOMCOLOROVERLIFETIME"),P.a.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=_.a.getDefineByName("VELOCITYOVERLIFETIMECONSTANT"),P.a.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=_.a.getDefineByName("VELOCITYOVERLIFETIMECURVE"),P.a.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=_.a.getDefineByName("VELOCITYOVERLIFETIMERANDOMCONSTANT"),P.a.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=_.a.getDefineByName("VELOCITYOVERLIFETIMERANDOMCURVE"),P.a.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=_.a.getDefineByName("TEXTURESHEETANIMATIONCURVE"),P.a.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=_.a.getDefineByName("TEXTURESHEETANIMATIONRANDOMCURVE"),P.a.SHADERDEFINE_ROTATIONOVERLIFETIME=_.a.getDefineByName("ROTATIONOVERLIFETIME"),P.a.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=_.a.getDefineByName("ROTATIONOVERLIFETIMESEPERATE"),P.a.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=_.a.getDefineByName("ROTATIONOVERLIFETIMECONSTANT"),P.a.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=_.a.getDefineByName("ROTATIONOVERLIFETIMECURVE"),P.a.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=_.a.getDefineByName("ROTATIONOVERLIFETIMERANDOMCONSTANTS"),P.a.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=_.a.getDefineByName("ROTATIONOVERLIFETIMERANDOMCURVES"),P.a.SHADERDEFINE_SIZEOVERLIFETIMECURVE=_.a.getDefineByName("SIZEOVERLIFETIMECURVE"),P.a.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=_.a.getDefineByName("SIZEOVERLIFETIMECURVESEPERATE"),P.a.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=_.a.getDefineByName("SIZEOVERLIFETIMERANDOMCURVES"),P.a.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=_.a.getDefineByName("SIZEOVERLIFETIMERANDOMCURVESSEPERATE"),P.a.SHADERDEFINE_RENDERMODE_MESH=_.a.getDefineByName("RENDERMODE_MESH"),P.a.SHADERDEFINE_SHAPE=_.a.getDefineByName("SHAPE")}get particleSystem(){return this._particleSystem}get particleRenderer(){return this._render}constructor(){super(null),r()(this,"_particleSystem",void 0),this._render=new w.a(this),this._particleSystem=new B.a(this);var t=this._render._renderElements[0]=new d.a;t.setTransform(this._transform),t.render=this._render,t.setGeometry(this._particleSystem),t.material=N.a.defaultMaterial}_parseModule(t,e){for(var i in e)switch(i){case"bases":var a=e.bases;for(var r in a)t[r]=a[r];break;case"vector2s":var n=e.vector2s;for(var r in n){var o=t[r],l=n[r];o.setValue(l[0],l[1]),t[r]=o}break;case"vector3s":var h=e.vector3s;for(var r in h){var _=t[r],c=h[r];_.setValue(c[0],c[1],c[2]),t[r]=_}break;case"vector4s":var d=e.vector4s;for(var r in d){var u=t[r],m=d[r];u.setValue(m[0],m[1],m[2],m[3]),t[r]=u}break;case"gradientDataNumbers":var p=e.gradientDataNumbers;for(var r in p){for(var g=t[r],v=e[r],T=0,E=v.length;T<E;T++){var S=v[T];g.add(S.key,S.value)}t[r]=g}break;case"resources":var R=e.resources;for(var r in R)t[r]=s.a.getRes(R[r]);break;case"bursts":var x=e.bursts;for(T=0,E=x.length;T<E;T++){var A=x[T];t.addBurst(new f.a(A.time,A.min,A.max))}break;case"randomSeed":t.randomSeed[0]=e.randomSeed;break;case"shapeType":case"type":case"color":case"size":case"frame":case"startFrame":case"angularVelocity":case"velocity":break;default:throw"ShurikenParticle3D:unknown type."}}_parse(t,e){if(super._parse(t,e),t.main){var i=this.particleSystem,a=this.particleRenderer;this._parseModule(a,t.renderer),this._parseModule(i,t.main),this._parseModule(i.emission,t.emission);var r=t.shape;if(r){var s;switch(r.shapeType){case 0:s=new M.a;break;case 1:s=new C.a;break;case 2:s=new I.a;break;case 3:s=new A.a;break;case 7:s=new y.a;break;default:throw"ShuriKenParticle3D:unknown shape type."}this._parseModule(s,r),i.shape=s}var n=t.velocityOverLifetime;if(n){var o,_=n.velocity;switch(_.type){case 0:var c=_.constant;o=R.a.createByConstant(c?new l.a(c[0],c[1],c[2]):new l.a(0,0,0));break;case 1:o=R.a.createByGradient(this._initParticleVelocity(_.gradientX),this._initParticleVelocity(_.gradientY),this._initParticleVelocity(_.gradientZ));break;case 2:var d=_.constantMin,u=_.constantMax;o=R.a.createByRandomTwoConstant(d?new l.a(d[0],d[1],d[2]):new l.a(0,0,0),u?new l.a(u[0],u[1],u[2]):new l.a(0,0,0));break;case 3:o=R.a.createByRandomTwoGradient(this._initParticleVelocity(_.gradientXMin),this._initParticleVelocity(_.gradientXMax),this._initParticleVelocity(_.gradientYMin),this._initParticleVelocity(_.gradientYMax),this._initParticleVelocity(_.gradientZMin),this._initParticleVelocity(_.gradientZMax))}var f=new O.a(o);this._parseModule(f,n),i.velocityOverLifetime=f}var T=t.colorOverLifetime;if(T){var E,P=T.color;switch(P.type){case 0:var N=P.constant;E=v.a.createByConstant(N?new h.a(N[0],N[1],N[2],N[3]):new h.a(0,0,0,0));break;case 1:E=v.a.createByGradient(this._initParticleColor(P.gradient));break;case 2:var w=P.constantMin,B=P.constantMax;E=v.a.createByRandomTwoConstant(w?new h.a(w[0],w[1],w[2],w[3]):new h.a(0,0,0,0),w?new h.a(B[0],B[1],B[2],B[3]):new h.a(0,0,0,0));break;case 3:E=v.a.createByRandomTwoGradient(this._initParticleColor(P.gradientMin),this._initParticleColor(P.gradientMax))}var F=new m.a(E);this._parseModule(F,T),i.colorOverLifetime=F}var V=t.sizeOverLifetime;if(V){var U,G=V.size;switch(G.type){case 0:U=G.separateAxes?S.a.createByGradientSeparate(this._initParticleSize(G.gradientX),this._initParticleSize(G.gradientY),this._initParticleSize(G.gradientZ)):S.a.createByGradient(this._initParticleSize(G.gradient));break;case 1:if(G.separateAxes){var H=G.constantMinSeparate,z=G.constantMaxSeparate;U=S.a.createByRandomTwoConstantSeparate(H?new l.a(H[0],H[1],H[2]):new l.a(0,0,0),z?new l.a(z[0],z[1],z[2]):new l.a(0,0,0))}else U=S.a.createByRandomTwoConstant(G.constantMin||0,G.constantMax||0);break;case 2:U=G.separateAxes?S.a.createByRandomTwoGradientSeparate(this._initParticleSize(G.gradientXMin),this._initParticleSize(G.gradientYMin),this._initParticleSize(G.gradientZMin),this._initParticleSize(G.gradientXMax),this._initParticleSize(G.gradientYMax),this._initParticleSize(G.gradientZMax)):S.a.createByRandomTwoGradient(this._initParticleSize(G.gradientMin),this._initParticleSize(G.gradientMax))}var k=new D.a(U);this._parseModule(k,V),i.sizeOverLifetime=k}var W=t.rotationOverLifetime;if(W){var X,Y=W.angularVelocity;switch(Y.type){case 0:if(Y.separateAxes){var j=Y.constantSeparate;X=g.a.createByConstantSeparate(j?new l.a(j[0],j[1],j[2]):new l.a(0,0,Math.PI/4))}else X=g.a.createByConstant(Y.constant||Math.PI/4);break;case 1:X=Y.separateAxes?g.a.createByGradientSeparate(this._initParticleRotation(Y.gradientX),this._initParticleRotation(Y.gradientY),this._initParticleRotation(Y.gradientZ)):g.a.createByGradient(this._initParticleRotation(Y.gradient));break;case 2:if(Y.separateAxes){var Z=Y.constantMinSeparate,q=Y.constantMaxSeparate;X=g.a.createByRandomTwoConstantSeparate(Z?new l.a(Z[0],Z[1],Z[2]):new l.a(0,0,0),q?new l.a(q[0],q[1],q[2]):new l.a(0,0,Math.PI/4))}else X=g.a.createByRandomTwoConstant(Y.constantMin||0,Y.constantMax||Math.PI/4);break;case 3:Y.separateAxes||(X=g.a.createByRandomTwoGradient(this._initParticleRotation(Y.gradientMin),this._initParticleRotation(Y.gradientMax)))}var Q=new x.a(X);this._parseModule(Q,W),i.rotationOverLifetime=Q}var K=t.textureSheetAnimation;if(K){var J,$=K.frame;switch($.type){case 0:J=p.a.createByConstant($.constant);break;case 1:J=p.a.createByOverTime(this._initParticleFrame($.overTime));break;case 2:J=p.a.createByRandomTwoConstant($.constantMin,$.constantMax);break;case 3:J=p.a.createByRandomTwoOverTime(this._initParticleFrame($.overTimeMin),this._initParticleFrame($.overTimeMax))}var tt,et=K.startFrame;switch(et.type){case 0:tt=b.a.createByConstant(et.constant);break;case 1:tt=b.a.createByRandomTwoConstant(et.constantMin,et.constantMax)}var it=new L.a(J,tt);this._parseModule(it,K),i.textureSheetAnimation=it}}else this._parseOld(t)}_activeHierarchy(t){super._activeHierarchy(t),this.particleSystem.playOnAwake&&this.particleSystem.play()}_inActiveHierarchy(t){super._inActiveHierarchy(t),this.particleSystem.isAlive&&this.particleSystem.simulate(0,!0)}_cloneTo(t,e,i){var a=t,r=a._particleSystem;this._particleSystem.cloneTo(r);var s=a._render,n=this._render;s.sharedMaterials=n.sharedMaterials,s.enable=n.enable,s.renderMode=n.renderMode,s.mesh=n.mesh,s.stretchedBillboardCameraSpeedScale=n.stretchedBillboardCameraSpeedScale,s.stretchedBillboardSpeedScale=n.stretchedBillboardSpeedScale,s.stretchedBillboardLengthScale=n.stretchedBillboardLengthScale,s.sortingFudge=n.sortingFudge,super._cloneTo(t,e,i)}destroy(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.destroyed||(super.destroy(t),this._particleSystem.destroy(),this._particleSystem=null)}_create(){return new F}_parseOld(t){const e=Math.PI/180;var i,a,r,n=this.particleRenderer,_=t.material;_&&(r=s.a.getRes(_.path)),n.sharedMaterial=r;var c=t.meshPath;c&&(n.mesh=s.a.getRes(c)),n.renderMode=t.renderMode,n.stretchedBillboardCameraSpeedScale=t.stretchedBillboardCameraSpeedScale,n.stretchedBillboardSpeedScale=t.stretchedBillboardSpeedScale,n.stretchedBillboardLengthScale=t.stretchedBillboardLengthScale,n.sortingFudge=t.sortingFudge?t.sortingFudge:0;var d=this.particleSystem;d.isPerformanceMode=t.isPerformanceMode,d.duration=t.duration,d.looping=t.looping,d.prewarm=t.prewarm,d.startDelayType=t.startDelayType,d.startDelay=t.startDelay,d.startDelayMin=t.startDelayMin,d.startDelayMax=t.startDelayMax,d.startLifetimeType=t.startLifetimeType,d.startLifetimeConstant=t.startLifetimeConstant,d.startLifeTimeGradient=F._initStartLife(t.startLifetimeGradient),d.startLifetimeConstantMin=t.startLifetimeConstantMin,d.startLifetimeConstantMax=t.startLifetimeConstantMax,d.startLifeTimeGradientMin=F._initStartLife(t.startLifetimeGradientMin),d.startLifeTimeGradientMax=F._initStartLife(t.startLifetimeGradientMax),d.startSpeedType=t.startSpeedType,d.startSpeedConstant=t.startSpeedConstant,d.startSpeedConstantMin=t.startSpeedConstantMin,d.startSpeedConstantMax=t.startSpeedConstantMax,d.threeDStartSize=t.threeDStartSize,d.startSizeType=t.startSizeType,d.startSizeConstant=t.startSizeConstant;var u=t.startSizeConstantSeparate,T=d.startSizeConstantSeparate;T.x=u[0],T.y=u[1],T.z=u[2],d.startSizeConstantMin=t.startSizeConstantMin,d.startSizeConstantMax=t.startSizeConstantMax;var E=t.startSizeConstantMinSeparate,P=d.startSizeConstantMinSeparate;P.x=E[0],P.y=E[1],P.z=E[2];var N=t.startSizeConstantMaxSeparate,w=d.startSizeConstantMaxSeparate;w.x=N[0],w.y=N[1],w.z=N[2],d.threeDStartRotation=t.threeDStartRotation,d.startRotationType=t.startRotationType,d.startRotationConstant=t.startRotationConstant*e;var B=t.startRotationConstantSeparate,V=d.startRotationConstantSeparate;V.x=B[0]*e,V.y=B[1]*e,V.z=B[2]*e,d.startRotationConstantMin=t.startRotationConstantMin*e,d.startRotationConstantMax=t.startRotationConstantMax*e;var U=t.startRotationConstantMinSeparate,G=d.startRotationConstantMinSeparate;G.x=U[0]*e,G.y=U[1]*e,G.z=U[2]*e;var H=t.startRotationConstantMaxSeparate,z=d.startRotationConstantMaxSeparate;z.x=H[0]*e,z.y=H[1]*e,z.z=H[2]*e,d.randomizeRotationDirection=t.randomizeRotationDirection,d.startColorType=t.startColorType;var k=t.startColorConstant,W=d.startColorConstant;W.x=k[0],W.y=k[1],W.z=k[2],W.w=k[3];var X=t.startColorConstantMin,Y=d.startColorConstantMin;Y.x=X[0],Y.y=X[1],Y.z=X[2],Y.w=X[3];var j=t.startColorConstantMax,Z=d.startColorConstantMax;Z.x=j[0],Z.y=j[1],Z.z=j[2],Z.w=j[3],d.gravityModifier=t.gravityModifier,d.simulationSpace=t.simulationSpace,void 0!==t.simulationSpeed&&(d.simulationSpeed=t.simulationSpeed),d.scaleMode=t.scaleMode,d.playOnAwake=t.playOnAwake,d.maxParticles=t.maxParticles;var q=t.autoRandomSeed;null!=q&&(d.autoRandomSeed=q);var Q=t.randomSeed;null!=Q&&(d.randomSeed[0]=Q);var K=t.emission,J=d.emission;if(K){J.emissionRate=K.emissionRate;var $=K.bursts;if($)for(i=0,a=$.length;i<a;i++){var tt=$[i];J.addBurst(new f.a(tt.time,tt.min,tt.max))}J.enable=K.enable}else J.enable=!1;var et=t.shape;if(et){var it;switch(et.shapeType){case 0:var at;it=at=new M.a,at.radius=et.sphereRadius,at.emitFromShell=et.sphereEmitFromShell,at.randomDirection=et.sphereRandomDirection;break;case 1:var rt;it=rt=new C.a,rt.radius=et.hemiSphereRadius,rt.emitFromShell=et.hemiSphereEmitFromShell,rt.randomDirection=et.hemiSphereRandomDirection;break;case 2:var st;it=st=new I.a,st.angle=et.coneAngle*e,st.radius=et.coneRadius,st.length=et.coneLength,st.emitType=et.coneEmitType,st.randomDirection=et.coneRandomDirection;break;case 3:var nt;it=nt=new A.a,nt.x=et.boxX,nt.y=et.boxY,nt.z=et.boxZ,nt.randomDirection=et.boxRandomDirection;break;case 7:var ot;it=ot=new y.a,ot.radius=et.circleRadius,ot.arc=et.circleArc*e,ot.emitFromEdge=et.circleEmitFromEdge,ot.randomDirection=et.circleRandomDirection;break;default:var lt;it=lt=new y.a,lt.radius=et.circleRadius,lt.arc=et.circleArc*e,lt.emitFromEdge=et.circleEmitFromEdge,lt.randomDirection=et.circleRandomDirection}it.enable=et.enable,d.shape=it}var ht=t.velocityOverLifetime;if(ht){var _t,ct=ht.velocity;switch(ct.type){case 0:var dt=ct.constant;_t=R.a.createByConstant(new l.a(dt[0],dt[1],dt[2]));break;case 1:_t=R.a.createByGradient(this._initParticleVelocity(ct.gradientX),this._initParticleVelocity(ct.gradientY),this._initParticleVelocity(ct.gradientZ));break;case 2:var ut=ct.constantMin,ft=ct.constantMax;_t=R.a.createByRandomTwoConstant(new l.a(ut[0],ut[1],ut[2]),new l.a(ft[0],ft[1],ft[2]));break;case 3:_t=R.a.createByRandomTwoGradient(this._initParticleVelocity(ct.gradientXMin),this._initParticleVelocity(ct.gradientXMax),this._initParticleVelocity(ct.gradientYMin),this._initParticleVelocity(ct.gradientYMax),this._initParticleVelocity(ct.gradientZMin),this._initParticleVelocity(ct.gradientZMax))}var mt=new O.a(_t);mt.space=ht.space,mt.enable=ht.enable,d.velocityOverLifetime=mt}var pt=t.colorOverLifetime;if(pt){var gt,vt=pt.color;switch(vt.type){case 0:var Tt=vt.constant;gt=v.a.createByConstant(new h.a(Tt[0],Tt[1],Tt[2],Tt[3]));break;case 1:gt=v.a.createByGradient(this._initParticleColor(vt.gradient));break;case 2:var Et=vt.constantMin,St=vt.constantMax;gt=v.a.createByRandomTwoConstant(new h.a(Et[0],Et[1],Et[2],Et[3]),new h.a(St[0],St[1],St[2],St[3]));break;case 3:gt=v.a.createByRandomTwoGradient(this._initParticleColor(vt.gradientMin),this._initParticleColor(vt.gradientMax))}var Rt=new m.a(gt);Rt.enable=pt.enable,d.colorOverLifetime=Rt}var xt=t.sizeOverLifetime;if(xt){var At,yt=xt.size;switch(yt.type){case 0:At=yt.separateAxes?S.a.createByGradientSeparate(this._initParticleSize(yt.gradientX),this._initParticleSize(yt.gradientY),this._initParticleSize(yt.gradientZ)):S.a.createByGradient(this._initParticleSize(yt.gradient));break;case 1:if(yt.separateAxes){var It=yt.constantMinSeparate,Ct=yt.constantMaxSeparate;At=S.a.createByRandomTwoConstantSeparate(new l.a(It[0],It[1],It[2]),new l.a(Ct[0],Ct[1],Ct[2]))}else At=S.a.createByRandomTwoConstant(yt.constantMin,yt.constantMax);break;case 2:At=yt.separateAxes?S.a.createByRandomTwoGradientSeparate(this._initParticleSize(yt.gradientXMin),this._initParticleSize(yt.gradientYMin),this._initParticleSize(yt.gradientZMin),this._initParticleSize(yt.gradientXMax),this._initParticleSize(yt.gradientYMax),this._initParticleSize(yt.gradientZMax)):S.a.createByRandomTwoGradient(this._initParticleSize(yt.gradientMin),this._initParticleSize(yt.gradientMax))}var Mt=new D.a(At);Mt.enable=xt.enable,d.sizeOverLifetime=Mt}var Dt=t.rotationOverLifetime;if(Dt){var bt,Lt=Dt.angularVelocity;switch(Lt.type){case 0:if(Lt.separateAxes){var Ot=Lt.constantSeparate;bt=g.a.createByConstantSeparate(new l.a(Ot[0]*e,Ot[1]*e,Ot[2]*e))}else bt=g.a.createByConstant(Lt.constant*e);break;case 1:bt=Lt.separateAxes?g.a.createByGradientSeparate(this._initParticleRotation(Lt.gradientX),this._initParticleRotation(Lt.gradientY),this._initParticleRotation(Lt.gradientZ)):g.a.createByGradient(this._initParticleRotation(Lt.gradient));break;case 2:if(Lt.separateAxes){var Pt=Lt.constantMinSeparate,Nt=Lt.constantMaxSeparate;bt=g.a.createByRandomTwoConstantSeparate(new l.a(Pt[0]*e,Pt[1]*e,Pt[2]*e),new l.a(Nt[0]*e,Nt[1]*e,Nt[2]*e))}else bt=g.a.createByRandomTwoConstant(Lt.constantMin*e,Lt.constantMax*e);break;case 3:Lt.separateAxes||(bt=g.a.createByRandomTwoGradient(this._initParticleRotation(Lt.gradientMin),this._initParticleRotation(Lt.gradientMax)))}var wt=new x.a(bt);wt.enable=Dt.enable,d.rotationOverLifetime=wt}var Bt=t.textureSheetAnimation;if(Bt){var Ft,Vt=Bt.frame;switch(Vt.type){case 0:Ft=p.a.createByConstant(Vt.constant);break;case 1:Ft=p.a.createByOverTime(this._initParticleFrame(Vt.overTime));break;case 2:Ft=p.a.createByRandomTwoConstant(Vt.constantMin,Vt.constantMax);break;case 3:Ft=p.a.createByRandomTwoOverTime(this._initParticleFrame(Vt.overTimeMin),this._initParticleFrame(Vt.overTimeMax))}var Ut,Gt=Bt.startFrame;switch(Gt.type){case 0:Ut=b.a.createByConstant(Gt.constant);break;case 1:Ut=b.a.createByRandomTwoConstant(Gt.constantMin,Gt.constantMax)}var Ht=new L.a(Ft,Ut);Ht.enable=Bt.enable;var zt=Bt.tiles;Ht.tiles=new o.a(zt[0],zt[1]),Ht.type=Bt.type,Ht.randomRow=Bt.randomRow;var kt=Bt.rowIndex;void 0!==kt&&(Ht.rowIndex=kt),Ht.cycles=Bt.cycles,d.textureSheetAnimation=Ht}}_initParticleColor(t){var e=new c.a(4,4);if(t){var i,a,r=t.alphas;if(r)for(i=0,a=r.length;i<a;i++){3==i&&a>4&&(i=a-1,console.warn("GradientDataColor warning:alpha data length is large than 4, will ignore the middle data."));var s=r[i];e.addColorAlpha(s.key,s.value)}else e.addColorAlpha(0,1),e.addColorAlpha(1,1);var o=t.rgbs;if(o)for(i=0,a=o.length;i<a;i++){3==i&&a>4&&(i=a-1,console.warn("GradientDataColor warning:rgb data length is large than 4, will ignore the middle data."));var l=o[i],h=l.value;e.addColorRGB(l.key,new n.a(h[0],h[1],h[2],1))}else e.addColorRGB(0,new n.a(1,1,1,1)),e.addColorRGB(1,new n.a(1,1,1,1))}else e.addColorAlpha(0,1),e.addColorAlpha(1,1),e.addColorRGB(0,new n.a(1,1,1,1)),e.addColorRGB(1,new n.a(1,1,1,1));return e}_initParticleFrame(t){var e=new T.a;if(t)for(var i=t.frames,a=0,r=i.length;a<r;a++){var s=i[a];e.add(s.key,s.value)}else e.add(0,0),e.add(1,1);return e}static _initStartLife(t){for(var e=new E.a,i=t.startLifetimes,a=0,r=i.length;a<r;a++){var s=i[a];e.add(s.key,s.value)}return e}_initParticleVelocity(t){for(var e=new E.a,i=t.velocitys,a=0,r=i.length;a<r;a++){var s=i[a];e.add(s.key,s.value)}return e}_initParticleSize(t){var e=new E.a;if(t)for(var i=t.sizes,a=0,r=i.length;a<r;a++){var s=i[a];e.add(s.key,s.value)}else e.add(0,0),e.add(1,1);return e}_initParticleRotation(t){for(var e=new E.a,i=t.angularVelocitys,a=0,r=i.length;a<r;a++){var s=i[a];e.add(s.key,s.value/180*Math.PI)}return e}}e.a=F},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{}e.a=s,r()(s,"Blend",0),r()(s,"Fixed",1)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{static createByConstant(t){var e=new s;return e._type=0,e._constant=t,e}static createByGradient(t){var e=new s;return e._type=1,e._gradient=t,e}static createByRandomTwoConstant(t,e){var i=new s;return i._type=2,i._constantMin=t,i._constantMax=e,i}static createByRandomTwoGradient(t,e){var i=new s;return i._type=3,i._gradientMin=t,i._gradientMax=e,i}get type(){return this._type}get constant(){return this._constant}get constantMin(){return this._constantMin}get constantMax(){return this._constantMax}get gradient(){return this._gradient}get gradientMin(){return this._gradientMin}get gradientMax(){return this._gradientMax}constructor(){r()(this,"_type",0),r()(this,"_constant",null),r()(this,"_constantMin",null),r()(this,"_constantMax",null),r()(this,"_gradient",null),r()(this,"_gradientMin",null),r()(this,"_gradientMax",null)}cloneTo(t){var e=t;e._type=this._type,this._constant.cloneTo(e._constant),this._constantMin.cloneTo(e._constantMin),this._constantMax.cloneTo(e._constantMax),this._gradient.cloneTo(e._gradient),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax)}clone(){var t=new s;return this.cloneTo(t),t}}e.a=s},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{static createByConstant(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;var e=new s;return e._type=0,e._constant=t,e}static createByOverTime(t){var e=new s;return e._type=1,e._overTime=t,e}static createByRandomTwoConstant(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;var i=new s;return i._type=2,i._constantMin=t,i._constantMax=e,i}static createByRandomTwoOverTime(t,e){var i=new s;return i._type=3,i._overTimeMin=t,i._overTimeMax=e,i}get type(){return this._type}get constant(){return this._constant}get frameOverTimeData(){return this._overTime}get constantMin(){return this._constantMin}get constantMax(){return this._constantMax}get frameOverTimeDataMin(){return this._overTimeMin}get frameOverTimeDataMax(){return this._overTimeMax}constructor(){r()(this,"_type",0),r()(this,"_constant",0),r()(this,"_overTime",null),r()(this,"_constantMin",0),r()(this,"_constantMax",0),r()(this,"_overTimeMin",null),r()(this,"_overTimeMax",null)}cloneTo(t){var e=t;e._type=this._type,e._constant=this._constant,this._overTime&&this._overTime.cloneTo(e._overTime),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._overTimeMin&&this._overTimeMin.cloneTo(e._overTimeMin),this._overTimeMax&&this._overTimeMax.cloneTo(e._overTimeMax)}clone(){var t=new s;return this.cloneTo(t),t}}e.a=s},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{static createByConstant(t){var e=new s;return e._type=0,e._separateAxes=!1,e._constant=t,e}static createByConstantSeparate(t){var e=new s;return e._type=0,e._separateAxes=!0,e._constantSeparate=t,e}static createByGradient(t){var e=new s;return e._type=1,e._separateAxes=!1,e._gradient=t,e}static createByGradientSeparate(t,e,i){var a=new s;return a._type=1,a._separateAxes=!0,a._gradientX=t,a._gradientY=e,a._gradientZ=i,a}static createByRandomTwoConstant(t,e){var i=new s;return i._type=2,i._separateAxes=!1,i._constantMin=t,i._constantMax=e,i}static createByRandomTwoConstantSeparate(t,e){var i=new s;return i._type=2,i._separateAxes=!0,i._constantMinSeparate=t,i._constantMaxSeparate=e,i}static createByRandomTwoGradient(t,e){var i=new s;return i._type=3,i._separateAxes=!1,i._gradientMin=t,i._gradientMax=e,i}static createByRandomTwoGradientSeparate(t,e,i,a,r,n,o,l){var h=new s;return h._type=3,h._separateAxes=!0,h._gradientXMin=t,h._gradientXMax=e,h._gradientYMin=i,h._gradientYMax=a,h._gradientZMin=r,h._gradientZMax=n,h._gradientWMin=o,h._gradientWMax=l,h}get type(){return this._type}get separateAxes(){return this._separateAxes}get constant(){return this._constant}get constantSeparate(){return this._constantSeparate}get gradient(){return this._gradient}get gradientX(){return this._gradientX}get gradientY(){return this._gradientY}get gradientZ(){return this._gradientZ}get gradientW(){return this._gradientW}get constantMin(){return this._constantMin}get constantMax(){return this._constantMax}get constantMinSeparate(){return this._constantMinSeparate}get constantMaxSeparate(){return this._constantMaxSeparate}get gradientMin(){return this._gradientMin}get gradientMax(){return this._gradientMax}get gradientXMin(){return this._gradientXMin}get gradientXMax(){return this._gradientXMax}get gradientYMin(){return this._gradientYMin}get gradientYMax(){return this._gradientYMax}get gradientZMin(){return this._gradientZMin}get gradientZMax(){return this._gradientZMax}get gradientWMin(){return this._gradientWMin}get gradientWMax(){return this._gradientWMax}constructor(){r()(this,"_type",0),r()(this,"_separateAxes",!1),r()(this,"_constant",0),r()(this,"_constantSeparate",null),r()(this,"_gradient",null),r()(this,"_gradientX",null),r()(this,"_gradientY",null),r()(this,"_gradientZ",null),r()(this,"_gradientW",null),r()(this,"_constantMin",0),r()(this,"_constantMax",0),r()(this,"_constantMinSeparate",null),r()(this,"_constantMaxSeparate",null),r()(this,"_gradientMin",null),r()(this,"_gradientMax",null),r()(this,"_gradientXMin",null),r()(this,"_gradientXMax",null),r()(this,"_gradientYMin",null),r()(this,"_gradientYMax",null),r()(this,"_gradientZMin",null),r()(this,"_gradientZMax",null),r()(this,"_gradientWMin",null),r()(this,"_gradientWMax",null)}cloneTo(t){var e=t;e._type=this._type,e._separateAxes=this._separateAxes,e._constant=this._constant,this._constantSeparate.cloneTo(e._constantSeparate),this._gradient.cloneTo(e._gradient),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(e._constantMinSeparate),this._constantMaxSeparate.cloneTo(e._constantMaxSeparate),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)}clone(){var t=new s;return this.cloneTo(t),t}}e.a=s},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{get gradientCount(){return this._currentLength/2}constructor(){r()(this,"_currentLength",0),r()(this,"_elements",void 0),this._elements=new Float32Array(8)}add(t,e){this._currentLength<8?(6===this._currentLength&&1!==t&&(t=1,console.log("GradientDataNumber warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=t,this._elements[this._currentLength++]=e):console.log("GradientDataNumber warning:data count must lessEqual than 4")}getKeyByIndex(t){return this._elements[2*t]}getValueByIndex(t){return this._elements[2*t+1]}getAverageValue(){for(var t=0,e=0,i=0,a=this._currentLength-2;i<a;i+=2){var r=this._elements[i+1];r+=this._elements[i+3],t+=r*=this._elements[i+2]-this._elements[i],e++}return t/e}cloneTo(t){var e=t;e._currentLength=this._currentLength;for(var i=e._elements,a=0,r=this._elements.length;a<r;a++)i[a]=this._elements[a]}clone(){var t=new s;return this.cloneTo(t),t}}e.a=s},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{static createByGradient(t){var e=new s;return e._type=0,e._separateAxes=!1,e._gradient=t,e}static createByGradientSeparate(t,e,i){var a=new s;return a._type=0,a._separateAxes=!0,a._gradientX=t,a._gradientY=e,a._gradientZ=i,a}static createByRandomTwoConstant(t,e){var i=new s;return i._type=1,i._separateAxes=!1,i._constantMin=t,i._constantMax=e,i}static createByRandomTwoConstantSeparate(t,e){var i=new s;return i._type=1,i._separateAxes=!0,i._constantMinSeparate=t,i._constantMaxSeparate=e,i}static createByRandomTwoGradient(t,e){var i=new s;return i._type=2,i._separateAxes=!1,i._gradientMin=t,i._gradientMax=e,i}static createByRandomTwoGradientSeparate(t,e,i,a,r,n){var o=new s;return o._type=2,o._separateAxes=!0,o._gradientXMin=t,o._gradientXMax=e,o._gradientYMin=i,o._gradientYMax=a,o._gradientZMin=r,o._gradientZMax=n,o}get type(){return this._type}get separateAxes(){return this._separateAxes}get gradient(){return this._gradient}get gradientX(){return this._gradientX}get gradientY(){return this._gradientY}get gradientZ(){return this._gradientZ}get constantMin(){return this._constantMin}get constantMax(){return this._constantMax}get constantMinSeparate(){return this._constantMinSeparate}get constantMaxSeparate(){return this._constantMaxSeparate}get gradientMin(){return this._gradientMin}get gradientMax(){return this._gradientMax}get gradientXMin(){return this._gradientXMin}get gradientXMax(){return this._gradientXMax}get gradientYMin(){return this._gradientYMin}get gradientYMax(){return this._gradientYMax}get gradientZMin(){return this._gradientZMin}get gradientZMax(){return this._gradientZMax}constructor(){r()(this,"_type",0),r()(this,"_separateAxes",!1),r()(this,"_gradient",null),r()(this,"_gradientX",null),r()(this,"_gradientY",null),r()(this,"_gradientZ",null),r()(this,"_constantMin",0),r()(this,"_constantMax",0),r()(this,"_constantMinSeparate",null),r()(this,"_constantMaxSeparate",null),r()(this,"_gradientMin",null),r()(this,"_gradientMax",null),r()(this,"_gradientXMin",null),r()(this,"_gradientXMax",null),r()(this,"_gradientYMin",null),r()(this,"_gradientYMax",null),r()(this,"_gradientZMin",null),r()(this,"_gradientZMax",null)}getMaxSizeInGradient(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e,i,a=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(e=0,i=this._gradientX.gradientCount;e<i;e++)a=Math.max(a,this._gradientX.getValueByIndex(e));for(e=0,i=this._gradientY.gradientCount;e<i;e++)a=Math.max(a,this._gradientY.getValueByIndex(e));if(t)for(e=0,i=this._gradientZ.gradientCount;e<i;e++)a=Math.max(a,this._gradientZ.getValueByIndex(e))}else for(e=0,i=this._gradient.gradientCount;e<i;e++)a=Math.max(a,this._gradient.getValueByIndex(e));break;case 1:this._separateAxes?(a=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),a=Math.max(a,this._constantMinSeparate.y),t&&(a=a=Math.max(a,this._constantMaxSeparate.z))):a=Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for(e=0,i=this._gradientXMin.gradientCount;e<i;e++)a=Math.max(a,this._gradientXMin.getValueByIndex(e));for(e=0,i=this._gradientXMax.gradientCount;e<i;e++)a=Math.max(a,this._gradientXMax.getValueByIndex(e));for(e=0,i=this._gradientYMin.gradientCount;e<i;e++)a=Math.max(a,this._gradientYMin.getValueByIndex(e));for(e=0,i=this._gradientZMax.gradientCount;e<i;e++)a=Math.max(a,this._gradientZMax.getValueByIndex(e));if(t){for(e=0,i=this._gradientZMin.gradientCount;e<i;e++)a=Math.max(a,this._gradientZMin.getValueByIndex(e));for(e=0,i=this._gradientZMax.gradientCount;e<i;e++)a=Math.max(a,this._gradientZMax.getValueByIndex(e))}}else{for(e=0,i=this._gradientMin.gradientCount;e<i;e++)a=Math.max(a,this._gradientMin.getValueByIndex(e));for(e=0,i=this._gradientMax.gradientCount;e<i;e++)a=Math.max(a,this._gradientMax.getValueByIndex(e))}}return a}cloneTo(t){var e=t;e._type=this._type,e._separateAxes=this._separateAxes,this._gradient.cloneTo(e._gradient),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(e._constantMinSeparate),this._constantMaxSeparate.cloneTo(e._constantMaxSeparate),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)}clone(){var t=new s;return this.cloneTo(t),t}}e.a=s},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{static createByConstant(t){var e=new s;return e._type=0,e._constant=t,e}static createByGradient(t,e,i){var a=new s;return a._type=1,a._gradientX=t,a._gradientY=e,a._gradientZ=i,a}static createByRandomTwoConstant(t,e){var i=new s;return i._type=2,i._constantMin=t,i._constantMax=e,i}static createByRandomTwoGradient(t,e,i,a,r,n){var o=new s;return o._type=3,o._gradientXMin=t,o._gradientXMax=e,o._gradientYMin=i,o._gradientYMax=a,o._gradientZMin=r,o._gradientZMax=n,o}get type(){return this._type}get constant(){return this._constant}get gradientX(){return this._gradientX}get gradientY(){return this._gradientY}get gradientZ(){return this._gradientZ}get constantMin(){return this._constantMin}get constantMax(){return this._constantMax}get gradientXMin(){return this._gradientXMin}get gradientXMax(){return this._gradientXMax}get gradientYMin(){return this._gradientYMin}get gradientYMax(){return this._gradientYMax}get gradientZMin(){return this._gradientZMin}get gradientZMax(){return this._gradientZMax}constructor(){r()(this,"_type",0),r()(this,"_constant",null),r()(this,"_gradientX",null),r()(this,"_gradientY",null),r()(this,"_gradientZ",null),r()(this,"_constantMin",null),r()(this,"_constantMax",null),r()(this,"_gradientXMin",null),r()(this,"_gradientXMax",null),r()(this,"_gradientYMin",null),r()(this,"_gradientYMax",null),r()(this,"_gradientZMin",null),r()(this,"_gradientZMax",null)}cloneTo(t){var e=t;e._type=this._type,this._constant.cloneTo(e._constant),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),this._constantMin.cloneTo(e._constantMin),this._constantMax.cloneTo(e._constantMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)}clone(){var t=new s;return this.cloneTo(t),t}}e.a=s},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{static createByConstant(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;var e=new s;return e._type=0,e._constant=t,e}static createByRandomTwoConstant(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;var i=new s;return i._type=1,i._constantMin=t,i._constantMax=e,i}get type(){return this._type}get constant(){return this._constant}get constantMin(){return this._constantMin}get constantMax(){return this._constantMax}constructor(){r()(this,"_type",0),r()(this,"_constant",0),r()(this,"_constantMin",0),r()(this,"_constantMax",0)}cloneTo(t){var e=t;e._type=this._type,e._constant=this._constant,e._constantMin=this._constantMin,e._constantMax=this._constantMax}clone(){var t=new s;return this.cloneTo(t),t}}e.a=s},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(22),n=i(40),o=i(5),l=i(7);class h extends s.a{static __initDefine__(){h.SHADERDEFINE_DIFFUSEMAP=l.a.getDefineByName("DIFFUSEMAP"),h.SHADERDEFINE_TINTCOLOR=l.a.getDefineByName("TINTCOLOR"),h.SHADERDEFINE_ADDTIVEFOG=l.a.getDefineByName("ADDTIVEFOG"),h.SHADERDEFINE_TILINGOFFSET=l.a.getDefineByName("TILINGOFFSET")}get _TintColor(){return this.color}set _TintColor(t){this.color=t}get _TintColorR(){return this._color.x}set _TintColorR(t){this._color.x=t,this.color=this._color}get _TintColorG(){return this._color.y}set _TintColorG(t){this._color.y=t,this.color=this._color}get _TintColorB(){return this._color.z}set _TintColorB(t){this._color.z=t,this.color=this._color}get _TintColorA(){return this._color.w}set _TintColorA(t){this._color.w=t,this.color=this._color}get _MainTex_ST(){return this._shaderValues.getVector(h.TILINGOFFSET)}set _MainTex_ST(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.setValue(t.x,t.y,t.z,t.w),this.tilingOffset=e}get _MainTex_STX(){return this._shaderValues.getVector(h.TILINGOFFSET).x}set _MainTex_STX(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.x=t,this.tilingOffset=e}get _MainTex_STY(){return this._shaderValues.getVector(h.TILINGOFFSET).y}set _MainTex_STY(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.y=t,this.tilingOffset=e}get _MainTex_STZ(){return this._shaderValues.getVector(h.TILINGOFFSET).z}set _MainTex_STZ(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.z=t,this.tilingOffset=e}get _MainTex_STW(){return this._shaderValues.getVector(h.TILINGOFFSET).w}set _MainTex_STW(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.w=t,this.tilingOffset=e}set renderMode(t){switch(t){case h.RENDERMODE_ADDTIVE:this.renderQueue=s.a.RENDERQUEUE_TRANSPARENT,this.depthWrite=!1,this.cull=n.a.CULL_NONE,this.blend=n.a.BLEND_ENABLE_ALL,this.blendSrc=n.a.BLENDPARAM_SRC_ALPHA,this.blendDst=n.a.BLENDPARAM_ONE,this.alphaTest=!1,this._shaderValues.addDefine(h.SHADERDEFINE_ADDTIVEFOG);break;case h.RENDERMODE_ALPHABLENDED:this.renderQueue=s.a.RENDERQUEUE_TRANSPARENT,this.depthWrite=!1,this.cull=n.a.CULL_NONE,this.blend=n.a.BLEND_ENABLE_ALL,this.blendSrc=n.a.BLENDPARAM_SRC_ALPHA,this.blendDst=n.a.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.alphaTest=!1,this._shaderValues.removeDefine(h.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("ShurikenParticleMaterial : renderMode value error.")}}get colorR(){return this._TintColorR}set colorR(t){this._TintColorR=t}get colorG(){return this._TintColorG}set colorG(t){this._TintColorG=t}get colorB(){return this._TintColorB}set colorB(t){this._TintColorB=t}get colorA(){return this._TintColorA}set colorA(t){this._TintColorA=t}get color(){return this._shaderValues.getVector(h.TINTCOLOR)}set color(t){t?this._shaderValues.addDefine(h.SHADERDEFINE_TINTCOLOR):this._shaderValues.removeDefine(h.SHADERDEFINE_TINTCOLOR),this._shaderValues.setVector(h.TINTCOLOR,t)}get tilingOffsetX(){return this._MainTex_STX}set tilingOffsetX(t){this._MainTex_STX=t}get tilingOffsetY(){return this._MainTex_STY}set tilingOffsetY(t){this._MainTex_STY=t}get tilingOffsetZ(){return this._MainTex_STZ}set tilingOffsetZ(t){this._MainTex_STZ=t}get tilingOffsetW(){return this._MainTex_STW}set tilingOffsetW(t){this._MainTex_STW=t}get tilingOffset(){return this._shaderValues.getVector(h.TILINGOFFSET)}set tilingOffset(t){t&&(1!=t.x||1!=t.y||0!=t.z||0!=t.w)?this._shaderValues.addDefine(h.SHADERDEFINE_TILINGOFFSET):this._shaderValues.removeDefine(h.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(h.TILINGOFFSET,t)}get texture(){return this._shaderValues.getTexture(h.DIFFUSETEXTURE)}set texture(t){t?this._shaderValues.addDefine(h.SHADERDEFINE_DIFFUSEMAP):this._shaderValues.removeDefine(h.SHADERDEFINE_DIFFUSEMAP),this._shaderValues.setTexture(h.DIFFUSETEXTURE,t)}get depthWrite(){return this._shaderValues.getBool(h.DEPTH_WRITE)}set depthWrite(t){this._shaderValues.setBool(h.DEPTH_WRITE,t)}get cull(){return this._shaderValues.getInt(h.CULL)}set cull(t){this._shaderValues.setInt(h.CULL,t)}get blend(){return this._shaderValues.getInt(h.BLEND)}set blend(t){this._shaderValues.setInt(h.BLEND,t)}get blendSrc(){return this._shaderValues.getInt(h.BLEND_SRC)}set blendSrc(t){this._shaderValues.setInt(h.BLEND_SRC,t)}get blendDst(){return this._shaderValues.getInt(h.BLEND_DST)}set blendDst(t){this._shaderValues.setInt(h.BLEND_DST,t)}get depthTest(){return this._shaderValues.getInt(h.DEPTH_TEST)}set depthTest(t){this._shaderValues.setInt(h.DEPTH_TEST,t)}constructor(){super(),r()(this,"_color",void 0),this.setShaderName("PARTICLESHURIKEN"),this._color=new o.a(1,1,1,1),this.renderMode=h.RENDERMODE_ALPHABLENDED}clone(){var t=new h;return this.cloneTo(t),t}}e.a=h,r()(h,"RENDERMODE_ALPHABLENDED",0),r()(h,"RENDERMODE_ADDTIVE",1),r()(h,"SHADERDEFINE_DIFFUSEMAP",void 0),r()(h,"SHADERDEFINE_TINTCOLOR",void 0),r()(h,"SHADERDEFINE_TILINGOFFSET",void 0),r()(h,"SHADERDEFINE_ADDTIVEFOG",void 0),r()(h,"DIFFUSETEXTURE",l.a.propertyNameToID("u_texture")),r()(h,"TINTCOLOR",l.a.propertyNameToID("u_Tintcolor")),r()(h,"TILINGOFFSET",l.a.propertyNameToID("u_TilingOffset")),r()(h,"CULL",l.a.propertyNameToID("s_Cull")),r()(h,"BLEND",l.a.propertyNameToID("s_Blend")),r()(h,"BLEND_SRC",l.a.propertyNameToID("s_BlendSrc")),r()(h,"BLEND_DST",l.a.propertyNameToID("s_BlendDst")),r()(h,"DEPTH_TEST",l.a.propertyNameToID("s_DepthTest")),r()(h,"DEPTH_WRITE",l.a.propertyNameToID("s_DepthWrite")),r()(h,"defaultMaterial",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(189),n=i(55),o=i(56),l=i(31);class h extends s.a{static get vertexDeclaration(){return h._vertexDeclaration}static __init__(){h._vertexDeclaration=new n.a(152,[new o.a(0,l.a.Vector4,s.a.PARTICLE_CORNERTEXTURECOORDINATE0),new o.a(16,l.a.Vector4,s.a.PARTICLE_SHAPEPOSITIONSTARTLIFETIME),new o.a(32,l.a.Vector4,s.a.PARTICLE_DIRECTIONTIME),new o.a(48,l.a.Vector4,s.a.PARTICLE_STARTCOLOR0),new o.a(64,l.a.Vector3,s.a.PARTICLE_STARTSIZE),new o.a(76,l.a.Vector3,s.a.PARTICLE_STARTROTATION),new o.a(88,l.a.Single,s.a.PARTICLE_STARTSPEED),new o.a(92,l.a.Vector4,s.a.PARTICLE_RANDOM0),new o.a(108,l.a.Vector4,s.a.PARTICLE_RANDOM1),new o.a(124,l.a.Vector3,s.a.PARTICLE_SIMULATIONWORLDPOSTION),new o.a(136,l.a.Vector4,s.a.PARTICLE_SIMULATIONWORLDROTATION)])}get cornerTextureCoordinate(){return this._cornerTextureCoordinate}get positionStartLifeTime(){return this._positionStartLifeTime}get velocity(){return this._velocity}get startColor(){return this._startColor}get startSize(){return this._startSize}get startRotation0(){return this._startRotation0}get startRotation1(){return this._startRotation1}get startRotation2(){return this._startRotation2}get startLifeTime(){return this._startLifeTime}get time(){return this._time}get startSpeed(){return this._startSpeed}get random0(){return this._randoms0}get random1(){return this._randoms1}get simulationWorldPostion(){return this._simulationWorldPostion}constructor(t,e,i,a,s,n,o,l,h,_,c,d,u,f){super(),r()(this,"_cornerTextureCoordinate",void 0),r()(this,"_positionStartLifeTime",void 0),r()(this,"_velocity",void 0),r()(this,"_startColor",void 0),r()(this,"_startSize",void 0),r()(this,"_startRotation0",void 0),r()(this,"_startRotation1",void 0),r()(this,"_startRotation2",void 0),r()(this,"_startLifeTime",void 0),r()(this,"_time",void 0),r()(this,"_startSpeed",void 0),r()(this,"_randoms0",void 0),r()(this,"_randoms1",void 0),r()(this,"_simulationWorldPostion",void 0),this._cornerTextureCoordinate=t,this._positionStartLifeTime=e,this._velocity=i,this._startColor=a,this._startSize=s,this._startRotation0=n,this._startRotation1=o,this._startRotation2=l,this._startLifeTime=h,this._time=_,this._startSpeed=c,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=f}}e.a=h,r()(h,"_vertexDeclaration",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(189),n=i(55),o=i(56),l=i(31);class h extends s.a{static __init__(){h._vertexDeclaration=new n.a(172,[new o.a(0,l.a.Vector3,s.a.PARTICLE_POSITION0),new o.a(12,l.a.Vector4,s.a.PARTICLE_COLOR0),new o.a(28,l.a.Vector2,s.a.PARTICLE_TEXTURECOORDINATE0),new o.a(36,l.a.Vector4,s.a.PARTICLE_SHAPEPOSITIONSTARTLIFETIME),new o.a(52,l.a.Vector4,s.a.PARTICLE_DIRECTIONTIME),new o.a(68,l.a.Vector4,s.a.PARTICLE_STARTCOLOR0),new o.a(84,l.a.Vector3,s.a.PARTICLE_STARTSIZE),new o.a(96,l.a.Vector3,s.a.PARTICLE_STARTROTATION),new o.a(108,l.a.Single,s.a.PARTICLE_STARTSPEED),new o.a(112,l.a.Vector4,s.a.PARTICLE_RANDOM0),new o.a(128,l.a.Vector4,s.a.PARTICLE_RANDOM1),new o.a(144,l.a.Vector3,s.a.PARTICLE_SIMULATIONWORLDPOSTION),new o.a(156,l.a.Vector4,s.a.PARTICLE_SIMULATIONWORLDROTATION)])}static get vertexDeclaration(){return h._vertexDeclaration}get cornerTextureCoordinate(){return this._cornerTextureCoordinate}get position(){return this._positionStartLifeTime}get velocity(){return this._velocity}get startColor(){return this._startColor}get startSize(){return this._startSize}get startRotation0(){return this._startRotation0}get startRotation1(){return this._startRotation1}get startRotation2(){return this._startRotation2}get startLifeTime(){return this._startLifeTime}get time(){return this._time}get startSpeed(){return this._startSpeed}get random0(){return this._randoms0}get random1(){return this._randoms1}get simulationWorldPostion(){return this._simulationWorldPostion}constructor(t,e,i,a,s,n,o,l,h,_,c,d,u,f){super(),r()(this,"_cornerTextureCoordinate",void 0),r()(this,"_positionStartLifeTime",void 0),r()(this,"_velocity",void 0),r()(this,"_startColor",void 0),r()(this,"_startSize",void 0),r()(this,"_startRotation0",void 0),r()(this,"_startRotation1",void 0),r()(this,"_startRotation2",void 0),r()(this,"_startLifeTime",void 0),r()(this,"_time",void 0),r()(this,"_startSpeed",void 0),r()(this,"_randoms0",void 0),r()(this,"_randoms1",void 0),r()(this,"_simulationWorldPostion",void 0),this._cornerTextureCoordinate=t,this._positionStartLifeTime=e,this._velocity=i,this._startColor=a,this._startSize=s,this._startRotation0=n,this._startRotation1=o,this._startRotation2=l,this._startLifeTime=h,this._time=_,this._startSpeed=c,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=f}}e.a=h,r()(h,"_vertexDeclaration",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(5),n=i(7),o=i(22),l=i(40);class h extends o.a{static __initDefine__(){h.SHADERDEFINE_MAINTEXTURE=n.a.getDefineByName("MAINTEXTURE"),h.SHADERDEFINE_TILINGOFFSET=n.a.getDefineByName("TILINGOFFSET"),h.SHADERDEFINE_ADDTIVEFOG=n.a.getDefineByName("ADDTIVEFOG")}get _TintColorR(){return this._color.x}set _TintColorR(t){this._color.x=t,this.color=this._color}get _TintColorG(){return this._color.y}set _TintColorG(t){this._color.y=t,this.color=this._color}get _TintColorB(){return this._color.z}set _TintColorB(t){this._color.z=t,this.color=this._color}get _TintColorA(){return this._color.w}set _TintColorA(t){this._color.w=t,this.color=this._color}get _MainTex_STX(){return this._shaderValues.getVector(h.TILINGOFFSET).x}set _MainTex_STX(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.x=t,this.tilingOffset=e}get _MainTex_STY(){return this._shaderValues.getVector(h.TILINGOFFSET).y}set _MainTex_STY(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.y=t,this.tilingOffset=e}get _MainTex_STZ(){return this._shaderValues.getVector(h.TILINGOFFSET).z}set _MainTex_STZ(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.z=t,this.tilingOffset=e}get _MainTex_STW(){return this._shaderValues.getVector(h.TILINGOFFSET).w}set _MainTex_STW(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.w=t,this.tilingOffset=e}set renderMode(t){switch(t){case h.RENDERMODE_ADDTIVE:this.renderQueue=o.a.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=l.a.CULL_NONE,this.blend=l.a.BLEND_ENABLE_ALL,this.blendSrc=l.a.BLENDPARAM_SRC_ALPHA,this.blendDst=l.a.BLENDPARAM_ONE,this.depthTest=l.a.DEPTHTEST_LESS,this._shaderValues.addDefine(h.SHADERDEFINE_ADDTIVEFOG);break;case h.RENDERMODE_ALPHABLENDED:this.renderQueue=o.a.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=l.a.CULL_NONE,this.blend=l.a.BLEND_ENABLE_ALL,this.blendSrc=l.a.BLENDPARAM_SRC_ALPHA,this.blendDst=l.a.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=l.a.DEPTHTEST_LESS,this._shaderValues.removeDefine(h.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("TrailMaterial : renderMode value error.")}}get colorR(){return this._TintColorR}set colorR(t){this._TintColorR=t}get colorG(){return this._TintColorG}set colorG(t){this._TintColorG=t}get colorB(){return this._TintColorB}set colorB(t){this._TintColorB=t}get colorA(){return this._TintColorA}set colorA(t){this._TintColorA=t}get color(){return this._shaderValues.getVector(h.TINTCOLOR)}set color(t){this._shaderValues.setVector(h.TINTCOLOR,t)}get texture(){return this._shaderValues.getTexture(h.MAINTEXTURE)}set texture(t){t?this._shaderValues.addDefine(h.SHADERDEFINE_MAINTEXTURE):this._shaderValues.removeDefine(h.SHADERDEFINE_MAINTEXTURE),this._shaderValues.setTexture(h.MAINTEXTURE,t)}get tilingOffsetX(){return this._MainTex_STX}set tilingOffsetX(t){this._MainTex_STX=t}get tilingOffsetY(){return this._MainTex_STY}set tilingOffsetY(t){this._MainTex_STY=t}get tilingOffsetZ(){return this._MainTex_STZ}set tilingOffsetZ(t){this._MainTex_STZ=t}get tilingOffsetW(){return this._MainTex_STW}set tilingOffsetW(t){this._MainTex_STW=t}get tilingOffset(){return this._shaderValues.getVector(h.TILINGOFFSET)}set tilingOffset(t){t&&(1!=t.x||1!=t.y||0!=t.z||0!=t.w)?this._shaderValues.addDefine(h.SHADERDEFINE_TILINGOFFSET):this._shaderValues.removeDefine(h.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(h.TILINGOFFSET,t)}set depthWrite(t){this._shaderValues.setBool(h.DEPTH_WRITE,t)}get depthWrite(){return this._shaderValues.getBool(h.DEPTH_WRITE)}set cull(t){this._shaderValues.setInt(h.CULL,t)}get cull(){return this._shaderValues.getInt(h.CULL)}set blend(t){this._shaderValues.setInt(h.BLEND,t)}get blend(){return this._shaderValues.getInt(h.BLEND)}set blendSrc(t){this._shaderValues.setInt(h.BLEND_SRC,t)}get blendSrc(){return this._shaderValues.getInt(h.BLEND_SRC)}set blendDst(t){this._shaderValues.setInt(h.BLEND_DST,t)}get blendDst(){return this._shaderValues.getInt(h.BLEND_DST)}set depthTest(t){this._shaderValues.setInt(h.DEPTH_TEST,t)}get depthTest(){return this._shaderValues.getInt(h.DEPTH_TEST)}constructor(){super(),r()(this,"_color",void 0),this.setShaderName("Trail"),this._color=new s.a(1,1,1,1),this._shaderValues.setVector(h.TINTCOLOR,new s.a(1,1,1,1)),this.renderMode=h.RENDERMODE_ALPHABLENDED}clone(){var t=new h;return this.cloneTo(t),t}}e.a=h,r()(h,"RENDERMODE_ALPHABLENDED",0),r()(h,"RENDERMODE_ADDTIVE",1),r()(h,"defaultMaterial",void 0),r()(h,"SHADERDEFINE_MAINTEXTURE",void 0),r()(h,"SHADERDEFINE_TILINGOFFSET",void 0),r()(h,"SHADERDEFINE_ADDTIVEFOG",void 0),r()(h,"MAINTEXTURE",n.a.propertyNameToID("u_MainTexture")),r()(h,"TINTCOLOR",n.a.propertyNameToID("u_MainColor")),r()(h,"TILINGOFFSET",n.a.propertyNameToID("u_TilingOffset")),r()(h,"CULL",n.a.propertyNameToID("s_Cull")),r()(h,"BLEND",n.a.propertyNameToID("s_Blend")),r()(h,"BLEND_SRC",n.a.propertyNameToID("s_BlendSrc")),r()(h,"BLEND_DST",n.a.propertyNameToID("s_BlendDst")),r()(h,"DEPTH_TEST",n.a.propertyNameToID("s_DepthTest")),r()(h,"DEPTH_WRITE",n.a.propertyNameToID("s_DepthWrite"))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(493),n=i(496),o=i(126),l=i(187),h=i(41),_=i(73),c=i(12);class d extends h.a{static __init__(){}get trailFilter(){return this._geometryFilter}get trailRenderer(){return this._render}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),r()(this,"_geometryFilter",void 0),this._render=new n.a(this),this._geometryFilter=new s.a(this)}_parse(t,e){super._parse(t,e);var i,a,r=this._render,s=this._geometryFilter,n=t.materials;if(n){var h=r.sharedMaterials,d=n.length;for(h.length=d,i=0;i<d;i++)h[i]=c.a.getRes(n[i].path);r.sharedMaterials=h}s.time=t.time,s.minVertexDistance=t.minVertexDistance,s.widthMultiplier=t.widthMultiplier,s.textureMode=t.textureMode,null!=t.alignment&&(s.alignment=t.alignment);var u=[],f=t.widthCurve;for(i=0,a=f.length;i<a;i++){var m=new o.a;m.time=f[i].time,m.inTangent=f[i].inTangent,m.outTangent=f[i].outTangent,m.value=f[i].value,u.push(m)}s.widthCurve=u;var p=t.colorGradient,g=p.colorKeys,v=p.alphaKeys,T=new l.a(g.length,v.length);for(T.mode=p.mode,i=0,a=g.length;i<a;i++){var E=g[i];T.addColorRGB(E.time,new _.a(E.value[0],E.value[1],E.value[2],1))}for(i=0,a=v.length;i<a;i++){var S=v[i];T.addColorAlpha(S.time,S.value)}s.colorGradient=T}_onActive(){super._onActive(),this._transform.position.cloneTo(this._geometryFilter._lastPosition)}_cloneTo(t,e,i){var a,r;super._cloneTo(t,e,i);var s=t,n=s.trailFilter;n.time=this.trailFilter.time,n.minVertexDistance=this.trailFilter.minVertexDistance,n.widthMultiplier=this.trailFilter.widthMultiplier,n.textureMode=this.trailFilter.textureMode,n.alignment=this.trailFilter.alignment;var h=this.trailFilter.widthCurve,_=[];for(a=0,r=h.length;a<r;a++){var c=new o.a;h[a].cloneTo(c),_.push(c)}n.widthCurve=_;var d=new l.a(this.trailFilter.colorGradient.maxColorRGBKeysCount,this.trailFilter.colorGradient.maxColorAlphaKeysCount);this.trailFilter.colorGradient.cloneTo(d),n.colorGradient=d,s.trailRenderer.sharedMaterial=this.trailRenderer.sharedMaterial}destroy(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.destroyed||(super.destroy(t),this._geometryFilter.destroy(),this._geometryFilter=null)}clear(){this._geometryFilter.clear()}_create(){return new d}}e.a=d},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{}e.a=s,r()(s,"Stretch",0),r()(s,"Tile",1)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(12),n=i(1),o=i(5),l=i(7),h=i(13),_=i(186),c=i(41),d=i(554);class u extends c.a{static __init__(){d.a.SIMPLE_SIMPLEANIMATORPARAMS=u.SIMPLE_SIMPLEANIMATORPARAMS,d.a.SIMPLE_SIMPLEANIMATORTEXTURE=u.SIMPLE_SIMPLEANIMATORTEXTURE,d.a.SIMPLE_SIMPLEANIMATORTEXTURESIZE=u.SIMPLE_SIMPLEANIMATORTEXTURESIZE}get meshFilter(){return this._meshFilter}get simpleSkinnedMeshRenderer(){return this._render}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),r()(this,"_meshFilter",void 0),this._meshFilter=new _.a(this),this._render=new d.a(this),t&&(this._meshFilter.sharedMesh=t)}_parse(t,e){super._parse(t,e);var i=this.simpleSkinnedMeshRenderer,a=t.lightmapIndex;null!=a&&(i.lightmapIndex=a);var r,l=t.lightmapScaleOffset;if(l&&(i.lightmapScaleOffset=new o.a(l[0],l[1],l[2],l[3])),void 0!=t.enableRender&&(i.enable=t.enableRender),void 0!=t.receiveShadows&&(i.receiveShadow=t.receiveShadows),void 0!=t.castShadow&&(i.castShadow=t.castShadow),r=t.meshPath){var h=s.a.getRes(r);h&&(this.meshFilter.sharedMesh=h)}var _=t.materials;if(_){var c=i.sharedMaterials,d=_.length;c.length=d;for(var u=0;u<d;u++)c[u]=s.a.getRes(_[u].path);i.sharedMaterials=c}var f=t.boundBox,m=f.min,p=f.max;if(i.localBounds.setMin(new n.a(m[0],m[1],m[2])),i.localBounds.setMax(new n.a(p[0],p[1],p[2])),e){var g=t.rootBone;i.rootBone=e[g];var v,T=t.bones;for(u=0,v=T.length;u<v;u++)i.bones.push(e[T[u]]);i._bonesNums=t.bonesNums?t.bonesNums:i.bones.length}else t.rootBone&&i._setRootBone(t.rootBone);var E=t.animatorTexture;if(E){var S=s.a.getRes(E);i.simpleAnimatorTexture=S}}_changeHierarchyAnimator(t){super._changeHierarchyAnimator(t),this.simpleSkinnedMeshRenderer._setCacheAnimator(t)}_cloneTo(t,e,i){var a=t;a.meshFilter.sharedMesh=this.meshFilter.sharedMesh;var r=this._render,s=a._render;s.enable=r.enable,s.sharedMaterials=r.sharedMaterials,s.castShadow=r.castShadow;var n=r.lightmapScaleOffset;n&&(s.lightmapScaleOffset=n.clone()),s.receiveShadow=r.receiveShadow,s.sortingFudge=r.sortingFudge,s._rootBone=r._rootBone;var o=r.bones,l=s.bones,_=o.length;l.length=_;var c=r.rootBone;if(c){var d=h.a._getHierarchyPath(e,c,u._tempArray0);s.rootBone=d?h.a._getNodeByHierarchyPath(i,d):c}for(var f=0;f<o.length;f++)d=h.a._getHierarchyPath(e,o[f],u._tempArray0),l[f]=d?h.a._getNodeByHierarchyPath(i,d):o[f];var m=r.localBounds;m&&m.cloneTo(s.localBounds),s.simpleAnimatorOffset=r.simpleAnimatorOffset,s.simpleAnimatorTexture=r.simpleAnimatorTexture,s._bonesNums=r._bonesNums,super._cloneTo(t,e,i)}destroy(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.destroyed||(super.destroy(t),this._meshFilter.destroy())}_create(){return new u}}e.a=u,r()(u,"_tempArray0",[]),r()(u,"SIMPLE_SIMPLEANIMATORTEXTURE",l.a.propertyNameToID("u_SimpleAnimatorTexture")),r()(u,"SIMPLE_SIMPLEANIMATORPARAMS",l.a.propertyNameToID("u_SimpleAnimatorParams")),r()(u,"SIMPLE_SIMPLEANIMATORTEXTURESIZE",l.a.propertyNameToID("u_SimpleAnimatorTextureSize"))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(98),n=i(50),o=i(1);class l extends s.a{get enabled(){return super.enabled}set enabled(t){super.enabled=t}get appliedImpulse(){return this._feedbackEnabled||(this._btConstraint.EnableFeedback(!0),this._feedbackEnabled=!0),this._btConstraint.AppliedImpulse}set connectedBody(t){this._connectedBody=t,t.constaintRigidbodyB=this}get connectedBody(){return this._connectedBody}get ownBody(){return this._ownBody}set ownBody(t){this._ownBody=t,t.constaintRigidbodyA=this}get currentForce(){return this._getJointFeedBack||this._getFeedBackInfo(),this._currentForce}get currentTorque(){return this._getJointFeedBack||this._getFeedBackInfo(),this._currentTorque}get breakForce(){return this._breakForce}set breakForce(t){this._breakForce=t}get breakTorque(){return this._breakTorque}set breakTorque(t){this._breakTorque=t}set anchor(t){t.cloneTo(this._anchor),this.setFrames()}get anchor(){return this._anchor}set connectAnchor(t){t.cloneTo(this._connectAnchor),this.setFrames()}get connectAnchor(){return this._connectAnchor}constructor(t){super(),r()(this,"_btConstraint",void 0),r()(this,"_simulation",void 0),r()(this,"_btJointFeedBackObj",void 0),r()(this,"_anchor",new o.a),r()(this,"_connectAnchor",new o.a),r()(this,"_btframAPos",void 0),r()(this,"_btframBPos",void 0),r()(this,"_btframATrans",void 0),r()(this,"_btframBTrans",void 0),r()(this,"_constraintType",void 0),r()(this,"_connectedBody",void 0),r()(this,"_ownBody",void 0),r()(this,"_feedbackEnabled",!1),r()(this,"_getJointFeedBack",!1),r()(this,"_currentForce",new o.a),r()(this,"_currentTorque",new o.a),r()(this,"_breakForce",void 0),r()(this,"_breakTorque",void 0),this._constraintType=t;var e=n.a._bullet;this._btframATrans=e.btTransform_create(),this._btframBTrans=e.btTransform_create(),e.btTransform_setIdentity(this._btframATrans),e.btTransform_setIdentity(this._btframBTrans),this._btframAPos=e.btVector3_create(0,0,0),this._btframBPos=e.btVector3_create(0,0,0),e.btTransform_setOrigin(this._btframATrans,this._btframAPos),e.btTransform_setOrigin(this._btframBTrans,this._btframBPos),this._breakForce=-1,this._breakTorque=-1}setOverrideNumSolverIterations(t){n.a._bullet.btTypedConstraint_setOverrideNumSolverIterations(this._btConstraint,t)}setConstraintEnabled(t){n.a._bullet.btTypedConstraint_setEnabled(this._btConstraint,t)}_onEnable(){super._onEnable(),this.enabled=!0}_onDisable(){super._onDisable(),this.enabled=!1}setFrames(){var t=n.a._bullet;t.btVector3_setValue(this._btframAPos,-this._anchor.x,this.anchor.y,this.anchor.z),t.btVector3_setValue(this._btframBPos,-this._connectAnchor.x,this._connectAnchor.y,this._connectAnchor.z),t.btTransform_setOrigin(this._btframATrans,this._btframAPos),t.btTransform_setOrigin(this._btframBTrans,this._btframBPos)}_addToSimulation(){}_removeFromSimulation(){}_createConstraint(){}setConnectRigidBody(t,e){var i=t&&!!(t._simulation&&t._enabled&&t.colliderShape),a=e&&!!(e._simulation&&e._enabled&&e.colliderShape);if(!i||!a)throw"ownerRigid or connectRigidBody is not in Simulation";t==this._ownBody&&e==this._connectedBody||(!(!this.enabled||!this._simulation)&&this._removeFromSimulation(),this._ownBody=t,this._connectedBody=e,this._ownBody.constaintRigidbodyA=this,this._connectedBody.constaintRigidbodyB=this,this._createConstraint())}getcurrentForce(t){if(!this._btJointFeedBackObj)throw"this Constraint is not simulation";var e=n.a._bullet,i=e.btJointFeedback_getAppliedForceBodyA(this._btJointFeedBackObj);t.setValue(e.btVector3_x(i),e.btVector3_y(i),e.btVector3_z(i))}getcurrentTorque(t){if(!this._btJointFeedBackObj)throw"this Constraint is not simulation";var e=n.a._bullet,i=e.btJointFeedback_getAppliedTorqueBodyA(this._btJointFeedBackObj);t.setValue(e.btVector3_x(i),e.btVector3_y(i),e.btVector3_z(i))}_onDestroy(){var t=n.a._bullet;this._removeFromSimulation(),this._btConstraint&&this._btJointFeedBackObj&&this._simulation&&(t.btTypedConstraint_destroy(this._btConstraint),t.btJointFeedback_destroy(this._btJointFeedBackObj),this._btJointFeedBackObj=null,this._btConstraint=null),super._onDisable()}_isBreakConstrained(){if(this._getJointFeedBack=!1,-1==this.breakForce&&-1==this.breakTorque)return!1;this._getFeedBackInfo();var t=-1!=this._breakForce&&o.a.scalarLength(this._currentForce)>this._breakForce,e=-1!=this._breakTorque&&o.a.scalarLength(this._currentTorque)>this._breakTorque;return!(!t&&!e)&&(this._breakConstrained(),!0)}_parse(t){this._anchor.fromArray(t.anchor),this._connectAnchor.fromArray(t.connectAnchor),this.setFrames()}_getFeedBackInfo(){var t=n.a._bullet,e=t.btJointFeedback_getAppliedForceBodyA(this._btJointFeedBackObj),i=t.btJointFeedback_getAppliedTorqueBodyA(this._btJointFeedBackObj);this._currentTorque.setValue(t.btVector3_x(i),t.btVector3_y(i),t.btVector3_z(i)),this._currentForce.setValue(t.btVector3_x(e),t.btVector3_y(e),t.btVector3_z(e)),this._getJointFeedBack=!0}_breakConstrained(){this.ownBody.constaintRigidbodyA=null,this.connectedBody.constaintRigidbodyB=null,this.destroy()}}e.a=l,r()(l,"CONSTRAINT_POINT2POINT_CONSTRAINT_TYPE",3),r()(l,"CONSTRAINT_HINGE_CONSTRAINT_TYPE",4),r()(l,"CONSTRAINT_CONETWIST_CONSTRAINT_TYPE",5),r()(l,"CONSTRAINT_D6_CONSTRAINT_TYPE",6),r()(l,"CONSTRAINT_SLIDER_CONSTRAINT_TYPE",7),r()(l,"CONSTRAINT_CONTACT_CONSTRAINT_TYPE",8),r()(l,"CONSTRAINT_D6_SPRING_CONSTRAINT_TYPE",9),r()(l,"CONSTRAINT_GEAR_CONSTRAINT_TYPE",10),r()(l,"CONSTRAINT_FIXED_CONSTRAINT_TYPE",11),r()(l,"CONSTRAINT_MAX_CONSTRAINT_TYPE",12),r()(l,"CONSTRAINT_CONSTRAINT_ERP",1),r()(l,"CONSTRAINT_CONSTRAINT_STOP_ERP",2),r()(l,"CONSTRAINT_CONSTRAINT_CFM",3),r()(l,"CONSTRAINT_CONSTRAINT_STOP_CFM",4),r()(l,"tempForceV3",new o.a)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i(0),r=i.n(a),s=i(58),n=i(70),o=i(241),l=i(19),h=i(397);class _{constructor(){r()(this,"sp",void 0),h.a.init(l.a.clientWidth,l.a.clientHeight),s.a.stage.alignV=o.a.ALIGN_MIDDLE,s.a.stage.alignH=o.a.ALIGN_CENTER,s.a.stage.scaleMode="showall",s.a.stage.bgColor="#232628",this.drawSomething()}drawSomething(){this.sp=new n.a,s.a.stage.addChild(this.sp),this.sp.graphics.drawLine(10,58,146,58,"#ff0000",3),this.sp.graphics.drawLines(176,58,[0,0,39,-50,78,0,117,50,156,0],"#ff0000",5),this.sp.graphics.drawCurves(352,58,[0,0,19,-100,39,0,58,100,78,0,97,-100,117,0,136,100,156,0],"#ff0000",5),this.sp.graphics.drawRect(10,166,166,90,"#ffff00"),this.sp.graphics.drawPoly(264,166,[0,0,60,0,78.48,57,30,93.48,-18.48,57],"#ffff00"),this.sp.graphics.drawPoly(400,166,[0,100,50,0,100,100],"#ffff00"),this.sp.graphics.drawCircle(98,332,50,"#00ffff"),this.sp.graphics.drawPie(240,290,100,10,60,"#00ffff"),this.sp.graphics.drawPath(400,310,[["moveTo",5,0],["lineTo",105,0],["arcTo",110,0,110,5,5],["lineTo",110,55],["arcTo",110,60,105,60,5],["lineTo",5,60],["arcTo",0,60,0,55,5],["lineTo",0,5],["arcTo",0,0,5,0,5],["closePath"]],{fillStyle:"#00ffff"})}}e.Sprite_DrawShapes=_,new _},function(t,e,i){t.exports=i(143)("native-function-to-string",Function.toString)},function(t,e,i){"use strict";var a=i(59);t.exports=function(t,e){return!!t&&a(function(){e?t.call(null,function(){},1):t.call(null)})}},function(t,e,i){var a=i(110),r=i(107);t.exports=function(t){return function(e,i){var s,n,o=String(r(e)),l=a(i),h=o.length;return l<0||l>=h?t?"":void 0:(s=o.charCodeAt(l))<55296||s>56319||l+1===h||(n=o.charCodeAt(l+1))<56320||n>57343?t?o.charAt(l):s:t?o.slice(l,l+2):n-56320+(s-55296<<10)+65536}}},function(t,e,i){var a=i(151),r=i(35)("toStringTag"),s="Arguments"==a(function(){return arguments}());t.exports=function(t){var e,i,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),r))?i:s?a(e):"Object"==(n=a(e))&&"function"==typeof e.callee?"Arguments":n}},function(t,e,i){"use strict";var a=i(152);i(139)({target:"RegExp",proto:!0,forced:a!==/./.exec},{exec:a})},function(t,e,i){var a=i(34),r=i(144),s=i(35)("species");t.exports=function(t,e){var i,n=a(t).constructor;return void 0===n||void 0==(i=a(n)[s])?e:r(i)}},function(t,e,i){"use strict";var a=i(18),r=(i.n(a),i(0)),s=i.n(r);class n{constructor(t,e,i){s()(this,"_value",0),s()(this,"_name2int",void 0),s()(this,"_int2name",void 0),s()(this,"_int2nameMap",void 0),this._name2int=t,this._int2name=e,this._int2nameMap=i}add(t){return this._value|="string"==typeof t?this._name2int[t]:t,this._value}addInt(t){return this._value|=t,this._value}remove(t){return this._value&="string"==typeof t?~this._name2int[t]:~t,this._value}isDefine(t){return(this._value&t)===t}getValue(){return this._value}setValue(t){this._value=t}toNameDic(){var t=this._int2nameMap[this._value];return t||n._toText(this._value,this._int2name,this._int2nameMap)}static _reg(t,e,i,a){i[t]=e,a[e]=t}static _toText(t,e,i){var a=i[t];if(a)return a;for(var r={},s=1,n=0;n<32&&!((s=1<<n)>t);n++)if(t&s){var o=e[s];o&&(r[o]="")}return i[t]=r,r}static _toInt(t,e){for(var i=t.split("."),a=0,r=0,s=i.length;r<s;r++){var n=e[i[r]];if(!n)throw new Error("Defines to int err:"+t+"/"+i[r]);a|=n}return a}}e.a=n},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){r()(this,"_strsToID",{}),r()(this,"_idToStrs",[]),r()(this,"_length",0)}add(t){var e=this._strsToID[t];return null!=e?e:(this._idToStrs[this._length]=t,this._strsToID[t]=this._length++)}getID(t){var e=this._strsToID[t];return null==e?-1:e}getName(t){var e=this._idToStrs[t];return null==e?void 0:e}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(92);class n extends s.a{constructor(t,e){super(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]?arguments[4]:null),r()(this,"_params2dQuick2",null),r()(this,"_shaderValueWidth",0),r()(this,"_shaderValueHeight",0)}_disposeResource(){super._disposeResource(),this._params2dQuick2=null}upload2dQuick2(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())}_make2dQuick2(){if(!this._params2dQuick2){this._params2dQuick2=[];for(var t,e=this._params,i=0,a=e.length;i<a;i++)"size"!==(t=e[i]).name&&this._params2dQuick2.push(t)}return this._params2dQuick2}static create(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return new n(t,e,i,a,r)}}e.a=n},function(t,e,i){var a=i(77),r=i(318).set;t.exports=function(t,e,i){var s,n=e.constructor;return n!==i&&"function"==typeof n&&(s=n.prototype)!==i.prototype&&a(s)&&r&&r(t,s),t}},function(t,e,i){var a=i(77),r=i(34),s=function(t,e){if(r(t),!a(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,a){try{(a=i(198)(Function.call,i(319).f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,i){return s(t,i),e?t.__proto__=i:a(t,i),t}}({},!1):void 0),check:s}},function(t,e,i){var a=i(320),r=i(141),s=i(117),n=i(196),o=i(89),l=i(194),h=Object.getOwnPropertyDescriptor;e.f=i(45)?h:function(t,e){if(t=s(t),e=n(e,!0),l)try{return h(t,e)}catch(t){}if(o(t,e))return r(!a.f.call(t,e),t[e])}},function(t,e){e.f={}.propertyIsEnumerable},function(t,e,i){var a=i(151);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==a(t)?t.split(""):Object(t)}},function(t,e,i){var a=i(213),r=i(155).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return a(t,r)}},function(t,e,i){var a=i(117),r=i(109),s=i(324);t.exports=function(t){return function(e,i,n){var o,l=a(e),h=r(l.length),_=s(n,h);if(t&&i!=i){for(;h>_;)if((o=l[_++])!=o)return!0}else for(;h>_;_++)if((t||_ in l)&&l[_]===i)return t||_||0;return!t&&-1}}},function(t,e,i){var a=i(110),r=Math.max,s=Math.min;t.exports=function(t,e){return(t=a(t))<0?r(t+e,0):s(t,e)}},function(t,e,i){"use strict";var a=i(44),r=i(76),s=i(45),n=i(35)("species");t.exports=function(t){var e=a[t];s&&e&&!e[n]&&r.f(e,n,{configurable:!0,get:function(){return this}})}},function(t,e,i){"use strict";var a=i(34),r=i(327),s=i(111);i(112)("search",1,function(t,e,i,n){return[function(i){var a=t(this),r=void 0==i?void 0:i[e];return void 0!==r?r.call(i,a):new RegExp(i)[e](String(a))},function(t){var e=n(i,t,this);if(e.done)return e.value;var o=a(t),l=String(this),h=o.lastIndex;r(h,0)||(o.lastIndex=0);var _=s(o,l);return r(o.lastIndex,h)||(o.lastIndex=h),null===_?-1:_.index}]})},function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){r()(this,"_lastOriX",0),r()(this,"_lastOriY",0),r()(this,"paths",[]),r()(this,"_curPath",null)}beginPath(t){this.paths.length=1,this._curPath=this.paths[0]=new s,this._curPath.convex=t}closePath(){this._curPath.loop=!0}newPath(){this._curPath=new s,this.paths.push(this._curPath)}addPoint(t,e){this._curPath.path.push(t,e)}push(t,e){this._curPath?this._curPath.path.length>0&&(this._curPath=new s,this.paths.push(this._curPath)):(this._curPath=new s,this.paths.push(this._curPath));var i=this._curPath;i.path=t.slice(),i.convex=e}reset(){this.paths.length=0}};class s{constructor(){r()(this,"path",[]),r()(this,"loop",!1),r()(this,"convex",!1)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(94),n=i(15),o=i(26);class l{constructor(){r()(this,"_globalClipMatrix",new n.a),r()(this,"_clipInfoID",-1),r()(this,"_clipRect",new o.a),r()(this,"incache",!1)}isSaveMark(){return!1}restore(t){this._globalClipMatrix.copyTo(t._globalClipMatrix),this._clipRect.clone(t._clipRect),t._clipInfoID=this._clipInfoID,l.POOL[l.POOL._length++]=this,t._clipInCache=this.incache}static save(t){if((t._saveMark._saveuse&s.a.TYPE_CLIPRECT)!=s.a.TYPE_CLIPRECT){t._saveMark._saveuse|=s.a.TYPE_CLIPRECT;var e=l.POOL,i=e._length>0?e[--e._length]:new l;t._globalClipMatrix.copyTo(i._globalClipMatrix),t._clipRect.clone(i._clipRect),i._clipInfoID=t._clipInfoID,i.incache=t._clipInCache;var a=t._save;a[a._length++]=i}}}e.a=l,r()(l,"POOL",s.a._createArray())},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(94);class n{constructor(){r()(this,"_saveuse",0),r()(this,"_preSaveMark",void 0)}isSaveMark(){return!0}restore(t){t._saveMark=this._preSaveMark,n.POOL[n.POOL._length++]=this}static Create(t){var e=n.POOL,i=e._length>0?e[--e._length]:new n;return i._saveuse=0,i._preSaveMark=t._saveMark,t._saveMark=i,i}}e.a=n,r()(n,"POOL",s.a._createArray())},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(94),n=i(15);class o{constructor(){r()(this,"_savematrix",void 0),r()(this,"_matrix",new n.a)}isSaveMark(){return!1}restore(t){t._curMat=this._savematrix,o.POOL[o.POOL._length++]=this}static save(t){var e=t._saveMark;if((e._saveuse&s.a.TYPE_TRANSFORM)!==s.a.TYPE_TRANSFORM){e._saveuse|=s.a.TYPE_TRANSFORM;var i=o.POOL,a=i._length>0?i[--i._length]:new o;a._savematrix=t._curMat,t._curMat=t._curMat.copyTo(a._matrix);var r=t._save;r[r._length++]=a}}}e.a=o,r()(o,"POOL",s.a._createArray())},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(94),n=i(15);class o{constructor(){r()(this,"_mat",new n.a)}isSaveMark(){return!1}restore(t){this._mat.copyTo(t._curMat),o.POOL[o.POOL._length++]=this}static save(t){var e=o.POOL,i=e._length>0?e[--e._length]:new o;t._curMat.copyTo(i._mat);var a=t._save;a[a._length++]=i}}e.a=o,r()(o,"POOL",s.a._createArray())},function(t,e,i){"use strict";var a=i(157);e.a=class extends a.a{constructor(){super()}}},function(t,e,i){"use strict";e.a="/*\n\ttexture和fillrect使用的。\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\t\t// 这个是全局的，不用再应用矩阵了。\nvarying vec2 cliped;\nuniform vec2 size;\nuniform vec2 clipOff;\t\t\t// 使用要把clip偏移。cacheas normal用. 只用了[0]\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\n#ifdef MVP3D\n\tuniform mat4 u_MvpMatrix;\n#endif\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n\tvec4 pos = vec4(posuv.xy,0.,1.);\n#ifdef WORLDMAT\n\tpos=mmat*pos;\n#endif\n\tvec4 pos1  =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#ifdef MVP3D\n\tgl_Position=u_MvpMatrix*pos1;\n#else\n\tgl_Position=pos1;\n#endif\n\tv_texcoordAlpha.xy = posuv.zw;\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\n\tv_color = attribColor/255.0;\n\tv_color.xyz*=v_color.w;//反正后面也要预乘\n\t\n\tv_useTex = attribFlags.r/255.0;\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\t\n\tvec2 clpos = clipMatPos.xy;\n\t#ifdef WORLDMAT\n\t\t// 如果有mmat，需要修改clipMatPos,因为 这是cacheas normal （如果不是就错了）， clipMatPos被去掉了偏移\n\t\tif(clipOff[0]>0.0){\n\t\t\tclpos.x+=mmat[3].x;\t//tx\t最简单处理\n\t\t\tclpos.y+=mmat[3].y;\t//ty\n\t\t}\n\t#endif\n\tvec2 clippos = pos.xy - clpos;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}"},function(t,e,i){"use strict";e.a="/*\n\ttexture和fillrect使用的。\n*/\n#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\nuniform sampler2D texture;\nvarying vec2 cliped;\n\n#ifdef BLUR_FILTER\nuniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}\n#endif\n\n#ifdef COLOR_FILTER\nuniform vec4 colorAlpha;\nuniform mat4 colorMat;\n#endif\n\n#ifdef GLOW_FILTER\nuniform vec4 u_color;\nuniform vec4 u_blurInfo1;\nuniform vec4 u_blurInfo2;\n#endif\n\n#ifdef COLOR_ADD\nuniform vec4 colorAdd;\n#endif\n\n#ifdef FILLTEXTURE\t\nuniform vec4 u_TexRange;//startu,startv,urange, vrange\n#endif\nvoid main() {\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n\t\n#ifdef FILLTEXTURE\t\n   vec4 color= texture2D(texture, fract(v_texcoordAlpha.xy)*u_TexRange.zw + u_TexRange.xy);\n#else\n   vec4 color= texture2D(texture, v_texcoordAlpha.xy);\n#endif\n\n   if(v_useTex<=0.)color = vec4(1.,1.,1.,1.);\n   color.a*=v_color.w;\n   //color.rgb*=v_color.w;\n   color.rgb*=v_color.rgb;\n   gl_FragColor=color;\n   \n   #ifdef COLOR_ADD\n\tgl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n\tgl_FragColor.xyz *= colorAdd.a;\n   #endif\n   \n   #ifdef BLUR_FILTER\n\tgl_FragColor =   blur();\n\tgl_FragColor.w*=v_color.w;   \n   #endif\n   \n   #ifdef COLOR_FILTER\n\tmat4 alphaMat =colorMat;\n\n\talphaMat[0][3] *= gl_FragColor.a;\n\talphaMat[1][3] *= gl_FragColor.a;\n\talphaMat[2][3] *= gl_FragColor.a;\n\n\tgl_FragColor = gl_FragColor * alphaMat;\n\tgl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n   #endif\n   \n   #ifdef GLOW_FILTER\n\tconst float c_IterationTime = 10.0;\n\tfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\n\tvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n\tvec2 vec2FilterDir = vec2(-(u_blurInfo1.z)/u_blurInfo2.x,-(u_blurInfo1.w)/u_blurInfo2.y);\n\tvec2 vec2FilterOff = vec2(u_blurInfo1.x/u_blurInfo2.x/c_IterationTime * 2.0,u_blurInfo1.y/u_blurInfo2.y/c_IterationTime * 2.0);\n\tfloat maxNum = u_blurInfo1.x * u_blurInfo1.y;\n\tvec2 vec2Off = vec2(0.0,0.0);\n\tfloat floatOff = c_IterationTime/2.0;\n\tfor(float i = 0.0;i<=c_IterationTime; ++i){\n\t\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\t\tvec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t\t}\n\t}\n\tgl_FragColor = vec4(u_color.rgb,vec4Color.a * u_blurInfo2.z);\n\tgl_FragColor.rgb *= gl_FragColor.a;   \n   #endif\n   \n}"},function(t,e,i){"use strict";e.a="attribute vec4 position;\nattribute vec4 attribColor;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\nuniform mat4 u_mmat2;\n//uniform vec2 u_pos;\nuniform vec2 size;\nvarying vec4 color;\n//vec4 dirxy=vec4(0.9,0.1, -0.1,0.9);\n//vec4 clip=vec4(100.,30.,300.,600.);\nvarying vec2 cliped;\nvoid main(){\n\t\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(position.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n#else\n\tgl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n#endif\t\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = position.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//clipdir是带缩放的方向，由于上面clippos是在缩放后的空间计算的，所以需要把方向先normalize一下\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n  //pos2d.x = dot(clippos,dirx);\n  color=attribColor/255.;\n}"},function(t,e,i){"use strict";e.a="precision mediump float;\n//precision mediump float;\nvarying vec4 color;\n//uniform float alpha;\nvarying vec2 cliped;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor= color;// vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=color.a;\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n}"},function(t,e,i){"use strict";e.a="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}"},function(t,e,i){"use strict";e.a="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}"},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(225),n=i(226),o=i(2);class l{constructor(){r()(this,"ib",void 0),r()(this,"vb",void 0);var t=o.a.instance;this.ib=s.a.create(t.DYNAMIC_DRAW),this.vb=n.a.create(8)}static getInstance(){return l.instance=l.instance||new l}addSkinMesh(t){t.getData2(this.vb,this.ib,this.vb._byteLength/32)}reset(){this.vb.clear(),this.ib.clear()}}e.a=l,r()(l,"instance",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{static createLine2(t,e,i,a,r,n){if(t.length<4)return null;var o=s.tempData.length>t.length+2?s.tempData:new Array(t.length+2);o[0]=t[0],o[1]=t[1];var l=2,h=0,_=t.length;for(h=2;h<_;h+=2)Math.abs(t[h]-t[h-2])+Math.abs(t[h+1]-t[h-1])>.01&&(o[l++]=t[h],o[l++]=t[h+1]);n&&Math.abs(t[0]-o[l-2])+Math.abs(t[1]-o[l-1])>.01&&(o[l++]=t[0],o[l++]=t[1]);var c=r;_=l/2;var d,u,f,m,p,g,v,T,E,S,R,x,A,y,I,C,M,D,b,L,O=i/2;for(f=o[0],m=o[1],S=f-(p=o[2]),E=(E=-(m-(g=o[3])))/(L=Math.sqrt(E*E+S*S))*O,S=S/L*O,c.push(f-E,m-S,f+E,m+S),h=1;h<_-1;h++)f=o[2*(h-1)],m=o[2*(h-1)+1],p=o[2*h],g=o[2*h+1],v=o[2*(h+1)],T=o[2*(h+1)+1],S=f-p,x=p-v,I=(-(E=(E=-(m-g))/(L=Math.sqrt(E*E+S*S))*O)+f)*(-(S=S/L*O)+g)-(-E+p)*(-S+m),D=(-(R=(R=-(g-T))/(L=Math.sqrt(R*R+x*x))*O)+v)*(-(x=x/L*O)+g)-(-R+p)*(-x+T),b=(A=-S+m-(-S+g))*(M=-R+p-(-R+v))-(C=-x+T-(-x+g))*(y=-E+p-(-E+f)),Math.abs(b)<.1?(b+=10.1,c.push(p-E,g-S,p+E,g+S)):(((d=(y*D-M*I)/b)-p)*(d-p)+((u=(C*I-A*D)/b)-g)+(u-g),c.push(d,u,p-(d-p),g-(u-g)));for(f=o[l-4],m=o[l-3],S=f-(p=o[l-2]),E=(E=-(m-(g=o[l-1])))/(L=Math.sqrt(E*E+S*S))*O,S=S/L*O,c.push(p-E,g-S,p+E,g+S),h=1;h<_;h++)e.push(a+2*(h-1),a+2*(h-1)+1,a+2*h+1,a+2*h+1,a+2*h,a+2*(h-1));return c}static createLineTriangle(t,e,i,a,r,s,n){var o=t.slice(),l=o.length,h=o[0],_=o[1],c=o[2],d=(o[2],0),u=0,f=0,m=0,p=l/2;if(!(p<=1)&&2!=p){for(var g=new Array(4*p),v=0,T=0,E=0;E<p-1;E++)h=o[T++],_=o[T++],c=o[T++],m=o[T++]-_,0!=(f=c-h)&&0!=m&&(d=Math.sqrt(f*f+m*m))>.001&&(g[u=4*v]=h,g[u+1]=_,g[u+2]=f/d,g[u+3]=m/d,v++);for(a?(h=o[l-2],_=o[l-1],c=o[0],m=o[1]-_,0!=(f=c-h)&&0!=m&&(d=Math.sqrt(f*f+m*m))>.001&&(g[u=4*v]=h,g[u+1]=_,g[u+2]=f/d,g[u+3]=m/d,v++)):(g[u=4*v]=h,g[u+1]=_,g[u+2]=f/d,g[u+3]=m/d,v++),T=0,E=0;E<p;E++)h=o[T],_=o[T+1],c=o[T+2],o[T+3]}}}e.a=s,r()(s,"tempData",new Array(256))},function(t,e,i){"use strict";var a=i(138),r=(i.n(a),i(343));class s{static earcut(t,e,i){i=i||2;var a,r,n,o,l,h,_,c=e&&e.length,d=c?e[0]*i:t.length,u=s.linkedList(t,0,d,i,!0),f=[];if(!u)return f;if(c&&(u=s.eliminateHoles(t,e,u,i)),t.length>80*i){a=n=t[0],r=o=t[1];for(var m=i;m<d;m+=i)l=t[m],h=t[m+1],l<a&&(a=l),h<r&&(r=h),l>n&&(n=l),h>o&&(o=h);_=0!==(_=Math.max(n-a,o-r))?1/_:0}return s.earcutLinked(u,f,i,a,r,_),f}static linkedList(t,e,i,a,r){var n,o;if(r===s.signedArea(t,e,i,a)>0)for(n=e;n<i;n+=a)o=s.insertNode(n,t[n],t[n+1],o);else for(n=i-a;n>=e;n-=a)o=s.insertNode(n,t[n],t[n+1],o);return o&&s.equals(o,o.next)&&(s.removeNode(o),o=o.next),o}static filterPoints(t,e){if(!t)return t;e||(e=t);var i,a=t;do{if(i=!1,a.steiner||!s.equals(a,a.next)&&0!==s.area(a.prev,a,a.next))a=a.next;else{if(s.removeNode(a),(a=e=a.prev)===a.next)break;i=!0}}while(i||a!==e);return e}static earcutLinked(t,e,i,a,r,n){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(t){!o&&n&&s.indexCurve(t,a,r,n);for(var l,h,_=t;t.prev!==t.next;)if(l=t.prev,h=t.next,n?s.isEarHashed(t,a,r,n):s.isEar(t))e.push(l.i/i),e.push(t.i/i),e.push(h.i/i),s.removeNode(t),t=h.next,_=h.next;else if((t=h)===_){o?1===o?(t=s.cureLocalIntersections(t,e,i),s.earcutLinked(t,e,i,a,r,n,2)):2===o&&s.splitEarcut(t,e,i,a,r,n):s.earcutLinked(s.filterPoints(t,null),e,i,a,r,n,1);break}}}static isEar(t){var e=t.prev,i=t,a=t.next;if(s.area(e,i,a)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(s.pointInTriangle(e.x,e.y,i.x,i.y,a.x,a.y,r.x,r.y)&&s.area(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}static isEarHashed(t,e,i,a){var r=t.prev,n=t,o=t.next;if(s.area(r,n,o)>=0)return!1;for(var l=r.x<n.x?r.x<o.x?r.x:o.x:n.x<o.x?n.x:o.x,h=r.y<n.y?r.y<o.y?r.y:o.y:n.y<o.y?n.y:o.y,_=r.x>n.x?r.x>o.x?r.x:o.x:n.x>o.x?n.x:o.x,c=r.y>n.y?r.y>o.y?r.y:o.y:n.y>o.y?n.y:o.y,d=s.zOrder(l,h,e,i,a),u=s.zOrder(_,c,e,i,a),f=t.nextZ;f&&f.z<=u;){if(f!==t.prev&&f!==t.next&&s.pointInTriangle(r.x,r.y,n.x,n.y,o.x,o.y,f.x,f.y)&&s.area(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=t.prevZ;f&&f.z>=d;){if(f!==t.prev&&f!==t.next&&s.pointInTriangle(r.x,r.y,n.x,n.y,o.x,o.y,f.x,f.y)&&s.area(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0}static cureLocalIntersections(t,e,i){var a=t;do{var r=a.prev,n=a.next.next;!s.equals(r,n)&&s.intersects(r,a,a.next,n)&&s.locallyInside(r,n)&&s.locallyInside(n,r)&&(e.push(r.i/i),e.push(a.i/i),e.push(n.i/i),s.removeNode(a),s.removeNode(a.next),a=t=n),a=a.next}while(a!==t);return a}static splitEarcut(t,e,i,a,r,n){var o=t;do{for(var l=o.next.next;l!==o.prev;){if(o.i!==l.i&&s.isValidDiagonal(o,l)){var h=s.splitPolygon(o,l);return o=s.filterPoints(o,o.next),h=s.filterPoints(h,h.next),s.earcutLinked(o,e,i,a,r,n),void s.earcutLinked(h,e,i,a,r,n)}l=l.next}o=o.next}while(o!==t)}static eliminateHoles(t,e,i,a){var r,n,o,l,h,_=[];for(r=0,n=e.length;r<n;r++)o=e[r]*a,l=r<n-1?e[r+1]*a:t.length,(h=s.linkedList(t,o,l,a,!1))===h.next&&(h.steiner=!0),_.push(s.getLeftmost(h));for(_.sort(s.compareX),r=0;r<_.length;r++)s.eliminateHole(_[r],i),i=s.filterPoints(i,i.next);return i}static compareX(t,e){return t.x-e.x}static eliminateHole(t,e){if(e=s.findHoleBridge(t,e)){var i=s.splitPolygon(e,t);s.filterPoints(i,i.next)}}static findHoleBridge(t,e){var i,a=e,r=t.x,n=t.y,o=-1/0;do{if(n<=a.y&&n>=a.next.y&&a.next.y!==a.y){var l=a.x+(n-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(l<=r&&l>o){if(o=l,l===r){if(n===a.y)return a;if(n===a.next.y)return a.next}i=a.x<a.next.x?a:a.next}}a=a.next}while(a!==e);if(!i)return null;if(r===o)return i.prev;var h,_=i,c=i.x,d=i.y,u=1/0;for(a=i.next;a!==_;)r>=a.x&&a.x>=c&&r!==a.x&&s.pointInTriangle(n<d?r:o,n,c,d,n<d?o:r,n,a.x,a.y)&&((h=Math.abs(n-a.y)/(r-a.x))<u||h===u&&a.x>i.x)&&s.locallyInside(a,t)&&(i=a,u=h),a=a.next;return i}static indexCurve(t,e,i,a){var r=t;do{null===r.z&&(r.z=s.zOrder(r.x,r.y,e,i,a)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,s.sortLinked(r)}static sortLinked(t){var e,i,a,r,s,n,o,l,h=1;do{for(i=t,t=null,s=null,n=0;i;){for(n++,a=i,o=0,e=0;e<h&&(o++,a=a.nextZ);e++);for(l=h;o>0||l>0&&a;)0!==o&&(0===l||!a||i.z<=a.z)?(r=i,i=i.nextZ,o--):(r=a,a=a.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=a}s.nextZ=null,h*=2}while(n>1);return t}static zOrder(t,e,i,a,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-a)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}static getLeftmost(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}static pointInTriangle(t,e,i,a,r,s,n,o){return(r-n)*(e-o)-(t-n)*(s-o)>=0&&(t-n)*(a-o)-(i-n)*(e-o)>=0&&(i-n)*(s-o)-(r-n)*(a-o)>=0}static isValidDiagonal(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!s.intersectsPolygon(t,e)&&s.locallyInside(t,e)&&s.locallyInside(e,t)&&s.middleInside(t,e)}static area(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}static equals(t,e){return t.x===e.x&&t.y===e.y}static intersects(t,e,i,a){return!!(s.equals(t,e)&&s.equals(i,a)||s.equals(t,a)&&s.equals(i,e))||s.area(t,e,i)>0!=s.area(t,e,a)>0&&s.area(i,a,t)>0!=s.area(i,a,e)>0}static intersectsPolygon(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&s.intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}static locallyInside(t,e){return s.area(t.prev,t,t.next)<0?s.area(t,e,t.next)>=0&&s.area(t,t.prev,e)>=0:s.area(t,e,t.prev)<0||s.area(t,t.next,e)<0}static middleInside(t,e){var i=t,a=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(a=!a),i=i.next}while(i!==t);return a}static splitPolygon(t,e){var i=new r.a(t.i,t.x,t.y),a=new r.a(e.i,e.x,e.y),s=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,a.next=i,i.prev=a,n.next=a,a.prev=n,a}static insertNode(t,e,i,a){var s=new r.a(t,e,i);return a?(s.next=a.next,s.prev=a,a.next.prev=s,a.next=s):(s.prev=s,s.next=s),s}static removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}static signedArea(t,e,i,a){for(var r=0,s=e,n=i-a;s<i;s+=a)r+=(t[n]-t[s])*(t[s+1]+t[n+1]),n=s;return r}}e.a=s},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(t,e,i){r()(this,"i",void 0),r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"prev",void 0),r()(this,"next",void 0),r()(this,"z",void 0),r()(this,"prevZ",void 0),r()(this,"nextZ",void 0),r()(this,"steiner",void 0),this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(15),n=i(36),o=i(96),l=i(66),h=i(61);class _ extends h.a{static create(t,e,i){var a=_.POOL._length?_.POOL[--_.POOL._length]:new _;a.canv=t,a._ref=1,a._numEle=0;var r=a.shaderValue;return r.alpha=e,r.defines.setValue(0),i&&i.length&&r.setFilters(i),a}constructor(){super(h.a.TYPE_2D),r()(this,"_matrix",new s.a),r()(this,"canv",void 0),r()(this,"_matrix4",o.a.defaultMatrix4.concat()),this.shaderValue=new n.a(0,0)}renderSubmit(){var t=l.a.worldAlpha,e=l.a.worldMatrix4,i=l.a.worldMatrix,a=l.a.worldFilters,r=l.a.worldShaderDefines,n=this.shaderValue,o=this._matrix,h=this._matrix4,_=s.a.TEMP;return s.a.mul(o,i,_),h[0]=_.a,h[1]=_.b,h[4]=_.c,h[5]=_.d,h[12]=_.tx,h[13]=_.ty,l.a.worldMatrix=_.clone(),l.a.worldMatrix4=h,l.a.worldAlpha=l.a.worldAlpha*n.alpha,n.filters&&n.filters.length&&(l.a.worldFilters=n.filters,l.a.worldShaderDefines=n.defines),this.canv.flushsubmit(),l.a.worldAlpha=t,l.a.worldMatrix4=e,l.a.worldMatrix.destroy(),l.a.worldMatrix=i,l.a.worldFilters=a,l.a.worldShaderDefines=r,1}releaseRender(){if(--this._ref<1){var t=_.POOL;this._mesh=null,t[t._length++]=this}}getRenderType(){return h.a.TYPE_CANVAS}}e.a=_,r()(_,"POOL",[]),_.POOL._length=0},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(93),n=i(8),o=i(10),l=i(67),h=i(96);class _{constructor(){r()(this,"_mesh",void 0),r()(this,"_startIdx",void 0),r()(this,"_numEle",void 0),r()(this,"shaderValue",void 0),r()(this,"blendType",0),r()(this,"_ref",1),r()(this,"_key",new s.a),r()(this,"srcRT",void 0)}renderSubmit(){var t=o.a.mainContext;this._mesh.useMesh(t);var e=this.srcRT;return e&&(this.shaderValue.texture=e._getSource(),this.shaderValue.upload(),this.blend(),n.a.renderBatches++,n.a.trianglesFaces+=this._numEle/3,t.drawElements(t.TRIANGLES,this._numEle,t.UNSIGNED_SHORT,this._startIdx)),1}blend(){if(l.a.activeBlendFunction!==l.a.fns[this.blendType]){var t=o.a.mainContext;t.enable(t.BLEND),l.a.fns[this.blendType](t),l.a.activeBlendFunction=l.a.fns[this.blendType]}}getRenderType(){return 0}releaseRender(){if(--this._ref<1){var t=_.POOL;t[t._length++]=this}}static create(t,e,i,a){var r=_.POOL._length?_.POOL[--_.POOL._length]:new _;if(r._mesh=e,r.srcRT=a,r._startIdx=e.indexNum*h.a.BYTES_PIDX,r._ref=1,r._key.clear(),r._numEle=0,r.blendType=t._nBlendType,r._key.blendShader=r.blendType,r.shaderValue=i,r.shaderValue.setValue(t._shader2D),t._colorFiler){var s=t._colorFiler;i.defines.add(s.type),i.colorMat=s._mat,i.colorAlpha=s._alpha}return r}}e.a=_,r()(_,"POOL",[]),_.POOL._length=0},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(15),n=i(29),o=i(36),l=i(229),h=i(83);class _{constructor(){r()(this,"_data",[]),r()(this,"_ndata",0),r()(this,"_tex",void 0),r()(this,"_imgId",void 0),r()(this,"_clipid",-1),r()(this,"_clipMatrix",new s.a),r()(this,"_enable",!1),r()(this,"_colorFiler",void 0)}clear(){this._tex=null,this._imgId=-1,this._ndata=0,this._enable=!1,this._colorFiler=null}destroy(){this.clear(),this._data.length=0,this._data=null}add(t,e,i,a,r,s){this._ndata>0&&(this._tex!=e||this._imgId!=i||this._clipid>=0&&this._clipid!=t._clipInfoID)&&this.submit(t),this._clipid=t._clipInfoID,t._globalClipMatrix.copyTo(this._clipMatrix),this._tex=e,this._imgId=i,this._colorFiler=t._colorFiler,this._data[this._ndata]=a,this._data[this._ndata+1]=r,this._data[this._ndata+2]=s,this._ndata+=3}getPos(){return 0==_.__nPosPool?new Array(8):_.__posPool[--_.__nPosPool]}enable(t,e){t!==this._enable&&(this._enable=t,this._enable||this.submit(e))}submit(t){var e=this._ndata;if(e){var i=t._mesh,a=t._colorFiler;t._colorFiler=this._colorFiler;var r=l.a.create(t,i,o.a.create(n.a.TEXTURE2D,0));t._submits[t._submits._length++]=t._curSubmit=r,r.shaderValue.textureHost=this._tex,r._key.other=this._imgId,t._colorFiler=a,t._copyClipInfo(r,this._clipMatrix),r.clipInfoID=this._clipid;for(var s=0;s<e;s+=3)i.addQuad(this._data[s],this._data[s+1],this._data[s+2],!0),_.__posPool[_.__nPosPool++]=this._data[s];e/=3,r._numEle+=6*e,i.indexNum+=6*e,i.vertNum+=4*e,t._drawCount+=e,this._ndata=0,h.a.loopCount%100==0&&(this._data.length=0)}}}e.a=_,r()(_,"__posPool",[]),r()(_,"__nPosPool",0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(348),n=i(231),o=i(3);class l{constructor(){r()(this,"texWidth",1024),r()(this,"texHeight",1024),r()(this,"atlasgrid",void 0),r()(this,"texture",null),r()(this,"charMaps",{}),this.texHeight=this.texWidth=o.a.TextRender.atlasWidth,this.texture=n.a.getTextTexture(this.texWidth,this.texHeight),this.texWidth/l.atlasGridW>256&&(l.atlasGridW=Math.ceil(this.texWidth/256)),this.atlasgrid=new s.a(this.texWidth/l.atlasGridW,this.texHeight/l.atlasGridW,this.texture.id)}setProtecteDist(t){}getAEmpty(t,e,i){var a=this.atlasgrid.addRect(1,Math.ceil(t/l.atlasGridW),Math.ceil(e/l.atlasGridW),i);return a&&(i.x*=l.atlasGridW,i.y*=l.atlasGridW),a}get usedRate(){return this.atlasgrid._used}destroy(){for(var t in this.charMaps){this.charMaps[t].deleted=!0}this.texture.discard()}printDebugInfo(){}}e.a=l,r()(l,"atlasGridW",16)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;r()(this,"atlasID",0),r()(this,"_width",0),r()(this,"_height",0),r()(this,"_texCount",0),r()(this,"_rowInfo",null),r()(this,"_cells",null),r()(this,"_used",0),this._cells=null,this._rowInfo=null,this.atlasID=i,this._init(t,e)}addRect(t,e,i,a){return!!this._get(e,i,a)&&(this._fill(a.x,a.y,e,i,t),this._texCount++,!0)}_release(){this._cells=null,this._rowInfo=null}_init(t,e){return this._width=t,this._height=e,this._release(),0!=this._width&&(this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=new Uint8Array(this._height),this._used=0,this._clear(),!0)}_get(t,e,i){if(t>this._width||e>this._height)return!1;for(var a=-1,r=-1,s=this._width,n=this._height,o=this._cells,l=0;l<n;l++)if(!(this._rowInfo[l]<t))for(var h=0;h<s;){var _=3*(l*s+h);if(0!=o[_]||o[_+1]<t||o[_+2]<e)h+=o[_+1];else{a=h,r=l;for(var c=0;c<t;c++)if(o[3*c+_+2]<e){a=-1;break}if(!(a<0))return i.x=a,i.y=r,!0;h+=o[_+1]}}return!1}_fill(t,e,i,a,r){var s=this._width,n=this._height;this._check(t+i<=s&&e+a<=n);for(var o=e;o<a+e;++o){this._check(this._rowInfo[o]>=i),this._rowInfo[o]-=i;for(var l=0;l<i;l++){var h=3*(t+o*s+l);this._check(0==this._cells[h]),this._cells[h]=r,this._cells[h+1]=i,this._cells[h+2]=a}}if(t>0)for(o=0;o<a;++o){var _=0;for(l=t-1;l>=0&&0==this._cells[3*((e+o)*s+l)];--l,++_);for(l=_;l>0;--l)this._cells[3*((e+o)*s+t-l)+1]=l,this._check(l>0)}if(e>0)for(l=t;l<t+i;++l){for(_=0,o=e-1;o>=0&&0==this._cells[3*(l+o*s)];--o,_++);for(o=_;o>0;--o)this._cells[3*(l+(e-o)*s)+2]=o,this._check(o>0)}this._used+=i*a/(this._width*this._height)}_check(t){0==t&&console.log("xtexMerger 错误啦")}_clear(){this._texCount=0;for(var t=0;t<this._height;t++)this._rowInfo[t]=this._width;for(var e=0;e<this._height;e++)for(var i=0;i<this._width;i++){var a=3*(e*this._width+i);this._cells[a]=0,this._cells[a+1]=this._width-i,this._cells[a+2]=this._width-e}}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(83);e.a=class{constructor(){r()(this,"char",""),r()(this,"tex",void 0),r()(this,"deleted",!1),r()(this,"uv",new Array(8)),r()(this,"pos",0),r()(this,"width",void 0),r()(this,"height",void 0),r()(this,"bmpWidth",void 0),r()(this,"bmpHeight",void 0),r()(this,"orix",0),r()(this,"oriy",0),r()(this,"touchTick",0),r()(this,"isSpace",!1)}touch(){var t=s.a.loopCount;this.touchTick!=t&&this.tex.touchRect(this,t),this.touchTick=t}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(233),n=i(19);class o extends s.a{constructor(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),r()(this,"ctx",null),r()(this,"lastScaleX",1),r()(this,"lastScaleY",1),r()(this,"maxTexW",0),r()(this,"maxTexH",0),r()(this,"scaleFontSize",!0),r()(this,"showDbgInfo",!1),r()(this,"supportImageData",!0),this.maxTexW=t,this.maxTexH=e,this.scaleFontSize=i,this.supportImageData=a,this.showDbgInfo=s,o.canvas||(o.canvas=n.a.createElement("canvas"),o.canvas.width=1024,o.canvas.height=512,o.canvas.style.left="-10000px",o.canvas.style.position="absolute",document.body.appendChild(o.canvas),this.ctx=o.canvas.getContext("2d"))}get canvasWidth(){return o.canvas.width}set canvasWidth(t){o.canvas.width!=t&&(o.canvas.width=t,t>2048&&console.warn("画文字设置的宽度太大，超过2048了"),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(this.lastScaleX,this.lastScaleY))}getWidth(t,e){return this.ctx?(this.ctx._lastFont!=t&&(this.ctx.font=t,this.ctx._lastFont=t),this.ctx.measureText(e).width):0}scale(t,e){if(!this.supportImageData)return this.lastScaleX=t,void(this.lastScaleY=e);this.lastScaleX==t&&this.lastScaleY==e||(this.ctx.setTransform(t,0,0,e,0,0),this.lastScaleX=t,this.lastScaleY=e)}getCharBmp(t,e,i,a,r,s,n,l,h,_){let c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null;if(!this.supportImageData)return this.getCharCanvas(t,e,i,a,r,s,n,l,h,_);var d=this.ctx,u=this.fontsz;d.font!=e&&(d.font=e,d._lastFont=e),s.width=d.measureText(t).width;var f=s.width*this.lastScaleX,m=s.height*this.lastScaleY;f+=(n+h)*this.lastScaleX,m+=(l+_)*this.lastScaleY,f=Math.ceil(f),m=Math.ceil(m);var p=(f=Math.min(f,o.canvas.width))+2*i+1,g=(m=Math.min(m,o.canvas.height))+2*i+1;c&&(p=Math.max(p,c[0]+c[2]+1),g=Math.max(g,c[1]+c[3]+1)),d.clearRect(0,0,p/this.lastScaleX+1,g/this.lastScaleY+1),d.save(),d.textBaseline="middle",i>0&&(d.strokeStyle=r,d.lineWidth=i,d.strokeText(t,n,l+u/2)),a&&(d.fillStyle=a,d.fillText(t,n,l+u/2)),this.showDbgInfo&&(d.strokeStyle="#ff0000",d.strokeRect(1,1,f-2,m-2),d.strokeStyle="#00ff00",d.strokeRect(n,l,s.width,s.height)),c&&(-1==c[2]&&(c[2]=Math.ceil((s.width+2*i)*this.lastScaleX)),c[2]<=0&&(c[2]=1));var v=c?d.getImageData(c[0],c[1],c[2],c[3]+1):d.getImageData(0,0,f,m+1);return d.restore(),s.bmpWidth=v.width,s.bmpHeight=v.height,v}getCharCanvas(t,e,i,a,r,s,n,l,h,_){var c=this.ctx;c.font!=e&&(c.font=e,c._lastFont=e),s.width=c.measureText(t).width;var d=s.width*this.lastScaleX,u=s.height*this.lastScaleY;d+=(n+h)*this.lastScaleX,u+=(l+_)*this.lastScaleY+1,d=Math.min(d,this.maxTexW),u=Math.min(u,this.maxTexH),o.canvas.width=Math.min(d+1,this.maxTexW),o.canvas.height=Math.min(u+1,this.maxTexH),c.font=e,c.clearRect(0,0,d+1+i,u+1+i),c.setTransform(1,0,0,1,0,0),c.save(),this.scaleFontSize&&c.scale(this.lastScaleX,this.lastScaleY),c.translate(n,l),c.textAlign="left";var f=this.fontsz;return c.textBaseline="middle",i>0?(c.strokeStyle=r,c.fillStyle=a,c.lineWidth=i,c.fillAndStrokeText?c.fillAndStrokeText(t,0,f/2):(c.strokeText(t,0,f/2),c.fillText(t,0,f/2))):a&&(c.fillStyle=a,c.fillText(t,0,f/2)),this.showDbgInfo&&(c.strokeStyle="#ff0000",c.strokeRect(0,0,d,u),c.strokeStyle="#00ff00",c.strokeRect(0,0,s.width,s.height)),c.restore(),s.bmpWidth=o.canvas.width,s.bmpHeight=o.canvas.height,o.canvas}}e.a=o,r()(o,"canvas",null)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(233),n=i(68);e.a=class extends s.a{constructor(){super(),r()(this,"lastFont",""),r()(this,"lastScaleX",1),r()(this,"lastScaleY",1)}getWidth(t,e){return window.conchTextCanvas?(window.conchTextCanvas.font=t,this.lastFont=t,window.conchTextCanvas.measureText(e).width):0}scale(t,e){this.lastScaleX=t,this.lastScaleY=e}getCharBmp(t,e,i,a,r,s,o,l,h,_){if(arguments.length>10&&void 0!==arguments[10]&&arguments[10],!window.conchTextCanvas)return null;window.conchTextCanvas.font=e,this.lastFont=e,s.width=window.conchTextCanvas.measureText(t).width,s.height,window.conchTextCanvas.scale&&window.conchTextCanvas.scale(this.lastScaleX,this.lastScaleY);var c=n.a.create(r).numColor,d=n.a.create(a).numColor,u=window.conchTextCanvas.getTextBitmapData(t,d,i>2?2:i,c);return s.bmpWidth=u.width,s.bmpHeight=u.height,u}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(69),n=i(3),o=i(353),l=i(81);class h{constructor(t,e){r()(this,"_gl",null),r()(this,"_vaoExt",null),r()(this,"_angleInstancedArrays",null),r()(this,"_isWebGL2",!1),r()(this,"_oesTextureHalfFloat",null),r()(this,"_oes_element_index_uint",null),r()(this,"_oesTextureHalfFloatLinear",null),r()(this,"_oesTextureFloat",null),r()(this,"_extShaderTextureLod",null),r()(this,"_extTextureFilterAnisotropic",null),r()(this,"_compressedTextureS3tc",null),r()(this,"_compressedTexturePvrtc",null),r()(this,"_compressedTextureEtc1",null),r()(this,"_webgl_depth_texture",null),r()(this,"_extColorBufferFloat",null),this._gl=t,this._isWebGL2=e;var i=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),a=t.getParameter(t.MAX_TEXTURE_SIZE);e?(this._extColorBufferFloat=this._getExtension("EXT_color_buffer_float"),l.a._shaderCapailityLevel=35):(n.a.Render.isConchApp||(o.a,window._setupVertexArrayObject&&window._setupVertexArrayObject(t)),this._vaoExt=this._getExtension("OES_vertex_array_object"),this._angleInstancedArrays=this._getExtension("ANGLE_instanced_arrays"),this._oesTextureHalfFloat=this._getExtension("OES_texture_half_float"),this._oesTextureHalfFloatLinear=this._getExtension("OES_texture_half_float_linear"),this._oesTextureFloat=this._getExtension("OES_texture_float"),this._oes_element_index_uint=this._getExtension("OES_element_index_uint"),this._extShaderTextureLod=this._getExtension("EXT_shader_texture_lod"),this._webgl_depth_texture=this._getExtension("WEBGL_depth_texture"),l.a._shaderCapailityLevel=30),this._extTextureFilterAnisotropic=this._getExtension("EXT_texture_filter_anisotropic"),this._compressedTextureS3tc=this._getExtension("WEBGL_compressed_texture_s3tc"),this._compressedTexturePvrtc=this._getExtension("WEBGL_compressed_texture_pvrtc"),this._compressedTextureEtc1=this._getExtension("WEBGL_compressed_texture_etc1"),l.a._maxTextureCount=i,l.a._maxTextureSize=a}_getExtension(t){var e=h._extentionVendorPrefixes;for(var i in e){var a=this._gl.getExtension(e[i]+t);if(a)return a}return null}createVertexArray(){return this._isWebGL2?this._gl.createVertexArray():this._vaoExt.createVertexArrayOES()}bindVertexArray(t){this._isWebGL2?this._gl.bindVertexArray(t):this._vaoExt.bindVertexArrayOES(t)}deleteVertexArray(t){this._isWebGL2?this._gl.deleteVertexArray(t):this._vaoExt.deleteVertexArrayOES(t)}isVertexArray(t){this._isWebGL2?this._gl.isVertexArray(t):this._vaoExt.isVertexArrayOES(t)}drawElementsInstanced(t,e,i,a,r){this._isWebGL2?this._gl.drawElementsInstanced(t,e,i,a,r):this._angleInstancedArrays.drawElementsInstancedANGLE(t,e,i,a,r)}drawArraysInstanced(t,e,i,a){this._isWebGL2?this._gl.drawArraysInstanced(t,e,i,a):this._angleInstancedArrays.drawArraysInstancedANGLE(t,e,i,a)}vertexAttribDivisor(t,e){this._isWebGL2?this._gl.vertexAttribDivisor(t,e):this._angleInstancedArrays.vertexAttribDivisorANGLE(t,e)}supportInstance(){return!(!this._isWebGL2&&!this._angleInstancedArrays||!s.a.allowGPUInstanceDynamicBatch)}supportElementIndexUint32(){return!(!this._isWebGL2&&!this._oes_element_index_uint)}}e.a=h,r()(h,"_extentionVendorPrefixes",["","WEBKIT_","MOZ_"])},function(t,e,i){"use strict";e.a=class{constructor(){}},function(){var t={};function e(e,i){t[e]=!0,void 0!==i&&function(t){window.console&&window.console.error&&window.console.error(t)}(i)}var i=function t(e){var i=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(var a=0;a<this.attribs.length;a++){var r=new t.VertexAttrib(i);this.attribs[a]=r}this.maxAttrib=0};(i.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=t.FLOAT,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var a=function(e){var i=this;this.gl=e,function(e){var i=e.getError;e.getError=function(){var a;do{(a=i.apply(e))!=e.NO_ERROR&&(t[a]=!0)}while(a!=e.NO_ERROR);for(var r in t)if(t[r])return delete t[r],parseInt(r);return e.NO_ERROR}}(e);var a=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(t){return t==i.VERTEX_ARRAY_BINDING_OES?i.currentVertexArrayObject==i.defaultVertexArrayObject?null:i.currentVertexArrayObject:a.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(t){var e=i.currentVertexArrayObject;return e.maxAttrib=Math.max(e.maxAttrib,t),e.attribs[t].enabled=!0,a.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(t){var e=i.currentVertexArrayObject;return e.maxAttrib=Math.max(e.maxAttrib,t),e.attribs[t].enabled=!1,a.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(t,r){switch(t){case e.ARRAY_BUFFER:i.currentArrayBuffer=r;break;case e.ELEMENT_ARRAY_BUFFER:i.currentVertexArrayObject.elementArrayBuffer=r}return a.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(t,r){var s=i.currentVertexArrayObject.attribs[t];switch(r){case e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return s.buffer;case e.VERTEX_ATTRIB_ARRAY_ENABLED:return s.enabled;case e.VERTEX_ATTRIB_ARRAY_SIZE:return s.size;case e.VERTEX_ATTRIB_ARRAY_STRIDE:return s.stride;case e.VERTEX_ATTRIB_ARRAY_TYPE:return s.type;case e.VERTEX_ATTRIB_ARRAY_NORMALIZED:return s.normalized;default:return a.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(t,e,r,s,n,o){var l=i.currentVertexArrayObject;l.maxAttrib=Math.max(l.maxAttrib,t);var h=l.attribs[t];return h.buffer=i.currentArrayBuffer,h.size=e,h.type=r,h.normalized=s,h.stride=n,h.offset=o,h.recache(),a.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas.addEventListener("webglcontextrestored",function(){!function(t){window.console&&window.console.log&&window.console.log(t)}("OESVertexArrayObject emulation library context restored"),i.reset_()},!0),this.reset_()};a.prototype.VERTEX_ARRAY_BINDING_OES=34229,a.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(var t=0;t<this.vertexArrayObjects.length;++t)this.vertexArrayObjects.isAlive=!1;var e=this.gl;this.maxVertexAttribs=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.defaultVertexArrayObject=new i(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},a.prototype.createVertexArrayOES=function(){var t=new i(this);return this.vertexArrayObjects.push(t),t},a.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject==t&&this.bindVertexArrayOES(null)},a.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof i&&t.hasBeenBound&&t.ext==this)},a.prototype.bindVertexArrayOES=function(t){var i=this.gl;if(!t||t.isAlive){var a=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var s=this.currentVertexArrayObject;if(r!=s){r&&s.elementArrayBuffer==r.elementArrayBuffer||a.bindBuffer.call(i,i.ELEMENT_ARRAY_BUFFER,s.elementArrayBuffer);for(var n=this.currentArrayBuffer,o=Math.max(r?r.maxAttrib:0,s.maxAttrib),l=0;l<=o;l++){var h=s.attribs[l],_=r?r.attribs[l]:null;if(r&&h.enabled==_.enabled||(h.enabled?a.enableVertexAttribArray.call(i,l):a.disableVertexAttribArray.call(i,l)),h.enabled){var c=!1;r&&h.buffer==_.buffer||(n!=h.buffer&&(a.bindBuffer.call(i,i.ARRAY_BUFFER,h.buffer),n=h.buffer),c=!0),(c||h.cached!=_.cached)&&a.vertexAttribPointer.call(i,l,h.size,h.type,h.normalized,h.stride,h.offset)}}this.currentArrayBuffer!=n&&a.bindBuffer.call(i,i.ARRAY_BUFFER,this.currentArrayBuffer)}}else e(i.INVALID_OPERATION,"bindVertexArrayOES: attempt to bind deleted arrayObject")},window._setupVertexArrayObject=function(t){var e=t.getSupportedExtensions;t.getSupportedExtensions=function(){var t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};var i=t.getExtension;t.getExtension=function(t){var e=i.call(this,t);return e||("OES_vertex_array_object"!==t?null:(this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new a(this)),this.__OESVertexArrayObject))}}}()},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"width",void 0),r()(this,"height",void 0)}static create(t,e,i,a){var r=s.a.getItemByClass("ClipRectCmd",n);return r.x=t,r.y=e,r.width=i,r.height=a,r}recover(){s.a.recover("ClipRectCmd",this)}run(t,e,i){t.clipRect(this.x+e,this.y+i,this.width,this.height)}get cmdID(){return n.ID}}e.a=n,r()(n,"ID","ClipRect")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){r()(this,"texture",void 0),r()(this,"pos",void 0)}static create(t,e){var i=s.a.getItemByClass("DrawTexturesCmd",n);return i.texture=t,t._addReference(),i.pos=e,i}recover(){this.texture._removeReference(),this.texture=null,this.pos=null,s.a.recover("DrawTexturesCmd",this)}run(t,e,i){t.drawTextures(this.texture,this.pos,e,i)}get cmdID(){return n.ID}}e.a=n,r()(n,"ID","DrawTextures")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(82),n=i(68),o=i(232),l=i(4),h=i(161),_=i(3);class c{constructor(){r()(this,"_text",void 0),r()(this,"_textIsWorldText",!1),r()(this,"_words",void 0),r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"_font",void 0),r()(this,"_color",void 0),r()(this,"_borderColor",void 0),r()(this,"_lineWidth",void 0),r()(this,"_textAlign",void 0),r()(this,"_fontColor",4294967295),r()(this,"_strokeColor",0),r()(this,"_fontObj",c._defFontObj),r()(this,"_nTexAlign",0)}static create(t,e,i,a,r,s,n,o,_){var d=l.a.getItemByClass("FillTextCmd",c);return d.text=t,d._textIsWorldText=t instanceof h.a,d._words=e,d.x=i,d.y=a,d.font=r,d.color=s,d.textAlign=n,d._lineWidth=o,d._borderColor=_,d}recover(){l.a.recover("FillTextCmd",this)}run(t,e,i){_.a.stage.isGlobalRepaint()&&this._textIsWorldText&&this._text.cleanCache(),this._words?s.a._textRender.fillWords(t,this._words,this.x+e,this.y+i,this._fontObj,this._color,this._borderColor,this._lineWidth):this._textIsWorldText?t._fast_filltext(this._text,this.x+e,this.y+i,this._fontObj,this._color,this._borderColor,this._lineWidth,this._nTexAlign,0):s.a._textRender.filltext(t,this._text,this.x+e,this.y+i,this.font,this.color,this._borderColor,this._lineWidth,this._textAlign)}get cmdID(){return c.ID}get text(){return this._text}set text(t){this._text=t,this._textIsWorldText=t instanceof h.a,this._textIsWorldText&&this._text.cleanCache()}get font(){return this._font}set font(t){this._font=t,this._fontObj=o.a.Parse(t),this._textIsWorldText&&this._text.cleanCache()}get color(){return this._color}set color(t){this._color=t,this._fontColor=n.a.create(t).numColor,this._textIsWorldText&&this._text.cleanCache()}get textAlign(){return this._textAlign}set textAlign(t){switch(this._textAlign=t,t){case"center":this._nTexAlign=_.a.Context.ENUM_TEXTALIGN_CENTER;break;case"right":this._nTexAlign=_.a.Context.ENUM_TEXTALIGN_RIGHT;break;default:this._nTexAlign=_.a.Context.ENUM_TEXTALIGN_DEFAULT}this._textIsWorldText&&this._text.cleanCache()}}e.a=c,r()(c,"ID","FillText"),r()(c,"_defFontObj",new o.a(null))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(71),n=i(84),o=i(15);class l{static __init__(){l.map[n.a.ALPHA|n.a.TRANSFORM|n.a.GRAPHICS]=l.alpha_transform_drawLayaGL,l.map[n.a.ALPHA|n.a.GRAPHICS]=l.alpha_drawLayaGL,l.map[n.a.TRANSFORM|n.a.GRAPHICS]=l.transform_drawLayaGL,l.map[n.a.TRANSFORM|n.a.CHILDS]=l.transform_drawNodes,l.map[n.a.ALPHA|n.a.TRANSFORM|n.a.TEXTURE]=l.alpha_transform_drawTexture,l.map[n.a.ALPHA|n.a.TEXTURE]=l.alpha_drawTexture,l.map[n.a.TRANSFORM|n.a.TEXTURE]=l.transform_drawTexture,l.map[n.a.GRAPHICS|n.a.CHILDS]=l.drawLayaGL_drawNodes}static transform_drawTexture(t,e,i,a){t._style;var r=t.texture;e.saveTransform(l.curMat),e.transformByMatrix(t.transform,i,a);var s=t._width||r.sourceWidth,n=t._height||r.sourceHeight,o=s/r.sourceWidth,h=n/r.sourceHeight;if(s=r.width*o,n=r.height*h,s<=0||n<=0)return null;var _=-t.pivotX+r.offsetX*o,c=-t.pivotY+r.offsetY*h;e.drawTexture(r,_,c,s,n),e.restoreTransform(l.curMat)}static alpha_drawTexture(t,e,i,a){var r,s=t._style,n=t.texture;if((r=s.alpha)>.01||t._needRepaint()){var o=e.globalAlpha;e.globalAlpha*=r,e.drawTexture(n,i-s.pivotX+n.offsetX,a-s.pivotY+n.offsetY,t._width||n.width,t._height||n.height),e.globalAlpha=o}}static alpha_transform_drawTexture(t,e,i,a){var r,s=t._style,n=t.texture;if((r=s.alpha)>.01||t._needRepaint()){var o=e.globalAlpha;e.globalAlpha*=r,e.saveTransform(l.curMat),e.transformByMatrix(t.transform,i,a),e.drawTexture(n,-s.pivotX+n.offsetX,-s.pivotY+n.offsetY,t._width||n.width,t._height||n.height),e.restoreTransform(l.curMat),e.globalAlpha=o}}static alpha_transform_drawLayaGL(t,e,i,a){var r,s=t._style;if((r=s.alpha)>.01||t._needRepaint()){var n=e.globalAlpha;e.globalAlpha*=r,e.saveTransform(l.curMat),e.transformByMatrix(t.transform,i,a),t._graphics&&t._graphics._render(t,e,-s.pivotX,-s.pivotY),e.restoreTransform(l.curMat),e.globalAlpha=n}}static alpha_drawLayaGL(t,e,i,a){var r,s=t._style;if((r=s.alpha)>.01||t._needRepaint()){var n=e.globalAlpha;e.globalAlpha*=r,t._graphics&&t._graphics._render(t,e,i-s.pivotX,a-s.pivotY),e.globalAlpha=n}}static transform_drawLayaGL(t,e,i,a){var r=t._style;e.saveTransform(l.curMat),e.transformByMatrix(t.transform,i,a),t._graphics&&t._graphics._render(t,e,-r.pivotX,-r.pivotY),e.restoreTransform(l.curMat)}static transform_drawNodes(t,e,i,a){var r=t._getBit(s.a.DRAWCALL_OPTIMIZE)&&e.drawCallOptimize(!0),n=t._style;e.saveTransform(l.curMat),e.transformByMatrix(t.transform,i,a),i=-n.pivotX,a=-n.pivotY;var o,h=t._children,_=h.length;if(n.viewport){var c,d,u=n.viewport,f=u.x,m=u.y,p=u.right,g=u.bottom;for(v=0;v<_;++v)(o=h[v])._visible&&(c=o._x)<p&&c+o.width>f&&(d=o._y)<g&&d+o.height>m&&o.render(e,i,a)}else for(var v=0;v<_;++v)(o=h[v])._visible&&o.render(e,i,a);e.restoreTransform(l.curMat),r&&e.drawCallOptimize(!1)}static drawLayaGL_drawNodes(t,e,i,a){var r=t._getBit(s.a.DRAWCALL_OPTIMIZE)&&e.drawCallOptimize(!0),n=t._style;i-=n.pivotX,a-=n.pivotY,t._graphics&&t._graphics._render(t,e,i,a);var o,l=t._children,h=l.length;if(n.viewport){var _,c,d=n.viewport,u=d.x,f=d.y,m=d.right,p=d.bottom;for(g=0;g<h;++g)(o=l[g])._visible&&(_=o._x)<m&&_+o.width>u&&(c=o._y)<p&&c+o.height>f&&o.render(e,i,a)}else for(var g=0;g<h;++g)(o=l[g])._visible&&o.render(e,i,a);r&&e.drawCallOptimize(!1)}}e.a=l,r()(l,"map",[]),r()(l,"curMat",new o.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(16),n=i(26),o=i(3);class l{constructor(){r()(this,"_hit",void 0),r()(this,"_unHit",void 0)}contains(t,e){return!!l._isHitGraphic(t,e,this.hit)&&!l._isHitGraphic(t,e,this.unHit)}static _isHitGraphic(t,e,i){if(!i)return!1;var a,r,s,n=i.cmds;if(!n&&i._one&&((n=l._cmds).length=1,n[0]=i._one),!n)return!1;for(r=n.length,a=0;a<r;a++)if(s=n[a]){switch(s.cmdID){case"Translate":t-=s.tx,e-=s.ty}if(l._isHitCmd(t,e,s))return!0}return!1}static _isHitCmd(t,e,i){if(!i)return!1;var a=!1;switch(i.cmdID){case"DrawRect":l._rect.setTo(i.x,i.y,i.width,i.height),a=l._rect.contains(t,e);break;case"DrawCircle":a=(t-=i.x)*t+(e-=i.y)*e<i.radius*i.radius;break;case"DrawPoly":t-=i.x,e-=i.y,a=l._ptInPolygon(t,e,i.points)}return a}static _ptInPolygon(t,e,i){var a=l._ptPoint;a.setTo(t,e);var r,s,n,o,h,_=0;h=i.length;for(var c=0;c<h;c+=2){if(r=i[c],s=i[c+1],n=i[(c+2)%h],s!=(o=i[(c+3)%h]))if(!(a.y<Math.min(s,o)))if(!(a.y>=Math.max(s,o)))(a.y-s)*(n-r)/(o-s)+r>a.x&&_++}return _%2==1}get hit(){return this._hit||(this._hit=new o.a.Graphics),this._hit}set hit(t){this._hit=t}get unHit(){return this._unHit||(this._unHit=new o.a.Graphics),this._unHit}set unHit(t){this._unHit=t}}e.a=l,r()(l,"_cmds",[]),r()(l,"_rect",new n.a),r()(l,"_ptPoint",new s.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4);class n{constructor(){r()(this,"bounds",void 0),r()(this,"userBounds",void 0),r()(this,"temBM",void 0)}reset(){return this.bounds&&this.bounds.recover(),this.userBounds&&this.userBounds.recover(),this.bounds=null,this.userBounds=null,this.temBM=null,this}recover(){s.a.recover("BoundsStyle",this.reset())}static create(){return s.a.getItemByClass("BoundsStyle",n)}}e.a=n},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(16),n=i(26),o=i(121),l=i(4);class h{constructor(){r()(this,"cacheAs",void 0),r()(this,"enableCanvasRender",void 0),r()(this,"userSetCache",void 0),r()(this,"cacheForFilters",void 0),r()(this,"staticCache",void 0),r()(this,"reCache",void 0),r()(this,"mask",void 0),r()(this,"maskParent",void 0),r()(this,"filters",void 0),r()(this,"cacheRect",void 0),r()(this,"canvas",void 0),r()(this,"filterCache",void 0),r()(this,"hasGlowFilter",void 0),this.reset()}needBitmapCache(){return this.cacheForFilters||!!this.mask}needEnableCanvasRender(){return"none"!=this.userSetCache||this.cacheForFilters||!!this.mask}releaseContext(){if(this.canvas&&this.canvas.size){l.a.recover("CacheCanvas",this.canvas),this.canvas.size(0,0);try{this.canvas.width=0,this.canvas.height=0}catch(t){}}this.canvas=null}createContext(){if(!this.canvas){this.canvas=l.a.getItem("CacheCanvas")||new o.a(!1);var t=this.canvas.context;t||(t=this.canvas.getContext("2d"))}}releaseFilterCache(){var t=this.filterCache;t&&(t.destroy(),t.recycle(),this.filterCache=null)}recover(){this!==h.EMPTY&&l.a.recover("SpriteCache",this.reset())}reset(){return this.releaseContext(),this.releaseFilterCache(),this.cacheAs="none",this.enableCanvasRender=!1,this.userSetCache="none",this.cacheForFilters=!1,this.staticCache=!1,this.reCache=!0,this.mask=null,this.maskParent=null,this.filterCache=null,this.filters=null,this.hasGlowFilter=!1,this.cacheRect&&this.cacheRect.recover(),this.cacheRect=null,this}static create(){return l.a.getItemByClass("SpriteCache",h)}_calculateCacheRect(t,e,i,a){var r,s=t._cacheStyle;if(s.cacheRect||(s.cacheRect=n.a.create()),"bitmap"===e?((r=t.getSelfBounds()).width=r.width+2*h.CANVAS_EXTEND_EDGE,r.height=r.height+2*h.CANVAS_EXTEND_EDGE,r.x=r.x-t.pivotX,r.y=r.y-t.pivotY,r.x=r.x-h.CANVAS_EXTEND_EDGE,r.y=r.y-h.CANVAS_EXTEND_EDGE,r.x=Math.floor(r.x+i)-i,r.y=Math.floor(r.y+a)-a,r.width=Math.floor(r.width),r.height=Math.floor(r.height),s.cacheRect.copyFrom(r)):s.cacheRect.setTo(-t._style.pivotX,-t._style.pivotY,1,1),r=s.cacheRect,t._style.scrollRect){var o=t._style.scrollRect;r.x-=o.x,r.y-=o.y}return h._scaleInfo.setTo(1,1),h._scaleInfo}}e.a=h,r()(h,"EMPTY",new h),r()(h,"_scaleInfo",new s.a),r()(h,"CANVAS_EXTEND_EDGE",16)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(240),n=i(4);class o extends s.a{constructor(){super(...arguments),r()(this,"italic",!1),r()(this,"align",void 0),r()(this,"wordWrap",void 0),r()(this,"leading",void 0),r()(this,"padding",void 0),r()(this,"bgColor",void 0),r()(this,"borderColor",void 0),r()(this,"asPassword",void 0),r()(this,"stroke",void 0),r()(this,"strokeColor",void 0),r()(this,"bold",void 0),r()(this,"underline",void 0),r()(this,"underlineColor",void 0),r()(this,"currBitmapFont",void 0)}reset(){return super.reset(),this.italic=!1,this.align="left",this.wordWrap=!1,this.leading=0,this.padding=[0,0,0,0],this.bgColor=null,this.borderColor=null,this.asPassword=!1,this.stroke=0,this.strokeColor="#000000",this.bold=!1,this.underline=!1,this.underlineColor=null,this.currBitmapFont=null,this}recover(){this!==o.EMPTY&&n.a.recover("TextStyle",this.reset())}static create(){return n.a.getItemByClass("TextStyle",o)}render(t,e,i,a){(this.bgColor||this.borderColor)&&e.drawRect(i,a,t.width,t.height,this.bgColor,this.borderColor,1)}}e.a=o,r()(o,"EMPTY",new o)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(6),n=i(19),o=i(4),l=i(3);class h{constructor(){r()(this,"preOvers",[]),r()(this,"preDowns",[]),r()(this,"preRightDowns",[]),r()(this,"enable",!0),r()(this,"_event",new s.a),r()(this,"_lastClickTime",0)}_clearTempArrs(){h._oldArr.length=0,h._newArr.length=0,h._tEleArr.length=0}getTouchFromArr(t,e){var i,a,r;for(a=e.length,i=0;i<a;i++)if((r=e[i]).id==t)return r;return null}removeTouchFromArr(t,e){var i;for(i=e.length-1;i>=0;i--)e[i].id==t&&e.splice(i,1)}createTouchO(t,e){var i;return(i=o.a.getItem("TouchData")||{}).id=e,i.tar=t,i}onMouseDown(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var a,r,o,l;this.enable&&(a=this.getTouchFromArr(e,this.preOvers),o=this.getEles(t,null,h._tEleArr),a?a.tar=t:(r=this.createTouchO(t,e),this.preOvers.push(r)),n.a.onMobile&&this.sendEvents(o,s.a.MOUSE_OVER),l=i?this.preDowns:this.preRightDowns,(a=this.getTouchFromArr(e,l))?a.tar=t:(r=this.createTouchO(t,e),l.push(r)),this.sendEvents(o,i?s.a.MOUSE_DOWN:s.a.RIGHT_MOUSE_DOWN),this._clearTempArrs())}sendEvents(t,e){var i,a,r;for(a=t.length,this._event._stoped=!1,r=t[0],i=0;i<a;i++){var s=t[i];if(s.destroyed)return;if(s.event(e,this._event.setTo(e,s,r)),this._event._stoped)break}}getEles(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;for(i?i.length=0:i=[];t&&t!=e;)i.push(t),t=t.parent;return i}checkMouseOutAndOverOfMove(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var i,a,r,n;if(e!=t)if(e.contains(t))a=this.getEles(t,e,h._tEleArr),this.sendEvents(a,s.a.MOUSE_OVER);else if(t.contains(e))a=this.getEles(e,t,h._tEleArr),this.sendEvents(a,s.a.MOUSE_OUT);else{var o,l,_;for((a=h._tEleArr).length=0,o=this.getEles(e,null,h._oldArr),l=this.getEles(t,null,h._newArr),n=o.length,r=0;r<n;r++){if(i=o[r],(_=l.indexOf(i))>=0){l.splice(_,l.length-_);break}a.push(i)}a.length>0&&this.sendEvents(a,s.a.MOUSE_OUT),l.length>0&&this.sendEvents(l,s.a.MOUSE_OVER)}}onMouseMove(t,e){var i,a;this.enable&&((i=this.getTouchFromArr(e,this.preOvers))?(this.checkMouseOutAndOverOfMove(t,i.tar),i.tar=t,a=this.getEles(t,null,h._tEleArr)):(a=this.getEles(t,null,h._tEleArr),this.sendEvents(a,s.a.MOUSE_OVER),this.preOvers.push(this.createTouchO(t,e))),this.sendEvents(a,s.a.MOUSE_MOVE),this._clearTempArrs())}getLastOvers(){return h._tEleArr.length=0,this.preOvers.length>0&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,h._tEleArr):(h._tEleArr.push(l.a.stage),h._tEleArr)}stageMouseOut(){var t;t=this.getLastOvers(),this.preOvers.length=0,this.sendEvents(t,s.a.MOUSE_OUT)}onMouseUp(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.enable){var a,r,l,_,c,d,u,f,m=n.a.onMobile;if(r=this.getEles(t,null,h._tEleArr),this.sendEvents(r,i?s.a.MOUSE_UP:s.a.RIGHT_MOUSE_UP),f=i?this.preDowns:this.preRightDowns,a=this.getTouchFromArr(e,f)){var p,g=n.a.now();if(p=g-this._lastClickTime<300,this._lastClickTime=g,t==a.tar)u=r;else for(l=this.getEles(a.tar,null,h._oldArr),(u=h._newArr).length=0,c=l.length,_=0;_<c;_++)d=l[_],r.indexOf(d)>=0&&u.push(d);u.length>0&&this.sendEvents(u,i?s.a.CLICK:s.a.RIGHT_CLICK),i&&p&&this.sendEvents(u,s.a.DOUBLE_CLICK),this.removeTouchFromArr(e,f),a.tar=null,o.a.recover("TouchData",a)}else;(a=this.getTouchFromArr(e,this.preOvers))&&m&&((u=this.getEles(a.tar,null,u))&&u.length>0&&this.sendEvents(u,s.a.MOUSE_OUT),this.removeTouchFromArr(e,this.preOvers),a.tar=null,o.a.recover("TouchData",a)),this._clearTempArrs()}}}e.a=h,r()(h,"I",new h),r()(h,"_oldArr",[]),r()(h,"_newArr",[]),r()(h,"_tEleArr",[])},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(6),n=i(3);class o{static __init__(){o._addEvent("keydown"),o._addEvent("keypress"),o._addEvent("keyup")}static _addEvent(t){n.a.Browser.document.addEventListener(t,function(e){o._dispatch(e,t)},!0)}static _dispatch(t,e){if(o.enabled){o._event._stoped=!1,o._event.nativeEvent=t,o._event.keyCode=t.keyCode||t.which||t.charCode,"keydown"===e?o._pressKeys[o._event.keyCode]=!0:"keyup"===e&&(o._pressKeys[o._event.keyCode]=null);for(var i=n.a.stage.focus&&null!=n.a.stage.focus.event&&n.a.stage.focus.displayedInStage?n.a.stage.focus:n.a.stage,a=i;a;)a.event(e,o._event.setTo(e,a,i)),a=a.parent}}static hasKeyDown(t){return o._pressKeys[t]}}e.a=o,r()(o,"_pressKeys",{}),r()(o,"enabled",!0),r()(o,"_event",new s.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(6),n=i(165),o=i(19),l=i(3);e.a=class extends n.a{constructor(t){super(),r()(this,"_audio",null),r()(this,"_onEnd",void 0),r()(this,"_resumePlay",void 0),this._onEnd=this.__onEnd.bind(this),this._resumePlay=this.__resumePlay.bind(this),t.addEventListener("ended",this._onEnd),this._audio=t}__onEnd(t){if(1==this.loops)return this.completeHandler&&(l.a.systemTimer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event(s.a.COMPLETE);this.loops>0&&this.loops--,this.startTime=0,this.play()}__resumePlay(){if(this._audio&&this._audio.removeEventListener("canplay",this._resumePlay),!this.isStopped)try{this._audio.currentTime=this.startTime,o.a.container.appendChild(this._audio),this._audio.play()}catch(t){this.event(s.a.ERROR)}}play(){this.isStopped=!1;try{this._audio.playbackRate=l.a.SoundManager.playbackRate,this._audio.currentTime=this.startTime}catch(t){return void this._audio.addEventListener("canplay",this._resumePlay)}l.a.SoundManager.addChannel(this),o.a.container.appendChild(this._audio),"play"in this._audio&&this._audio.play()}get position(){return this._audio?this._audio.currentTime:0}get duration(){return this._audio?this._audio.duration:0}stop(){super.stop(),this.isStopped=!0,l.a.SoundManager.removeChannel(this),this.completeHandler=null,this._audio&&("pause"in this._audio&&l.a.Render.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),l.a.Browser.onIE||this._audio!=l.a.AudioSound._musicAudio&&l.a.Pool.recover("audio:"+this.url,this._audio),o.a.removeElement(this._audio),this._audio=null,l.a.SoundManager.autoReleaseSound&&l.a.SoundManager.disposeSoundLater(this.url))}pause(){this.isStopped=!0,l.a.SoundManager.removeChannel(this),"pause"in this._audio&&this._audio.pause(),l.a.SoundManager.autoReleaseSound&&l.a.SoundManager.disposeSoundLater(this.url)}resume(){var t=this._audio;t&&(this.isStopped=!1,0==t.readyState&&(t.src=this.url,t.addEventListener("canplay",this._resumePlay),t.load()),l.a.SoundManager.addChannel(this),"play"in t&&t.play())}set volume(t){this._audio&&(this._audio.volume=t)}get volume(){return this._audio?this._audio.volume:1}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(6),n=i(165),o=i(19),l=i(21),h=i(3);class _ extends n.a{constructor(){super(),r()(this,"audioBuffer",void 0),r()(this,"gain",void 0),r()(this,"bufferSource",null),r()(this,"_currentTime",0),r()(this,"_volume",1),r()(this,"_startTime",0),r()(this,"_pauseTime",0),r()(this,"context",h.a.WebAudioSound.ctx),r()(this,"_onPlayEnd",void 0),this._onPlayEnd=l.a.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}play(){if(h.a.SoundManager.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){if(this.startTime>=this.duration)return stop();var t=this.context,e=this.gain,i=t.createBufferSource();this.bufferSource=i,i.buffer=this.audioBuffer,i.connect(e),e&&e.disconnect(),e.connect(t.destination),i.onended=this._onPlayEnd,this._startTime=o.a.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,_.SetTargetDelay):this.gain.gain.value=this._volume,0==this.loops&&(i.loop=!0),i.playbackRate.setTargetAtTime?i.playbackRate.setTargetAtTime(h.a.SoundManager.playbackRate,this.context.currentTime,_.SetTargetDelay):i.playbackRate.value=h.a.SoundManager.playbackRate,i.start(0,this.startTime),this._currentTime=0}}__onPlayEnd(){if(1==this.loops)return this.completeHandler&&(h.a.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event(s.a.COMPLETE);this.loops>0&&this.loops--,this.startTime=0,this.play()}get position(){return this.bufferSource?(o.a.now()-this._startTime)/1e3+this.startTime:0}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}_clearBufferSource(){if(this.bufferSource){var t=this.bufferSource;t.stop?t.stop(0):t.noteOff(0),t.disconnect(0),t.onended=null,_._tryCleanFailed||this._tryClearBuffer(t),this.bufferSource=null}}_tryClearBuffer(t){try{t.buffer=null}catch(t){_._tryCleanFailed=!0}}stop(){super.stop(),this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,h.a.SoundManager.removeChannel(this),this.completeHandler=null,h.a.SoundManager.autoReleaseSound&&h.a.SoundManager.disposeSoundLater(this.url)}pause(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,h.a.SoundManager.removeChannel(this),h.a.SoundManager.autoReleaseSound&&h.a.SoundManager.disposeSoundLater(this.url)}resume(){this.startTime=this._pauseTime,this.play()}set volume(t){this._volume=t,this.isStopped||(this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(t,this.context.currentTime,_.SetTargetDelay):this.gain.gain.value=t)}get volume(){return this._volume}}e.a=_,r()(_,"_tryCleanFailed",!1),r()(_,"SetTargetDelay",.001)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(3);e.a=class{constructor(){r()(this,"json",void 0)}create(){return this.json?s.a.SceneUtils.createByData(null,this.json):null}}},function(t,e,i){"use strict";var a=i(18),r=(i.n(a),i(28)),s=(i.n(r),i(0)),n=i.n(s),o=i(26),l=i(48),h=i(43),_=i(3),c=i(30);class d{constructor(){n()(this,"_texture",void 0),n()(this,"_fontCharDic",{}),n()(this,"_fontWidthMap",{}),n()(this,"_complete",void 0),n()(this,"_path",void 0),n()(this,"_maxWidth",0),n()(this,"_spaceWidth",10),n()(this,"_padding",void 0),n()(this,"fontSize",12),n()(this,"autoScaleSize",!1),n()(this,"letterSpacing",0)}loadFont(t,e){this._path=t,this._complete=e,t&&-1!==t.indexOf(".fnt")?_.a.loader.load([{url:t,type:_.a.Loader.XML},{url:t.replace(".fnt",".png"),type:_.a.Loader.IMAGE}],h.a.create(this,this._onLoaded)):console.error('Bitmap font configuration information must be a ".fnt" file')}_onLoaded(){this.parseFont(_.a.Loader.getRes(this._path),_.a.Loader.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.run()}parseFont(t,e){if(null!=t&&null!=e){this._texture=e;var i=t.getElementsByTagName("info");if(!i[0].getAttributeNode)return this.parseFont2(t,e);this.fontSize=parseInt(i[0].getAttributeNode("size").nodeValue);var a=i[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt(a[0]),parseInt(a[1]),parseInt(a[2]),parseInt(a[3])];var r=t.getElementsByTagName("char"),s=0;for(s=0;s<r.length;s++){var n=r[s],h=parseInt(n.getAttributeNode("id").nodeValue),_=parseInt(n.getAttributeNode("xoffset").nodeValue)/1,c=parseInt(n.getAttributeNode("yoffset").nodeValue)/1,d=parseInt(n.getAttributeNode("xadvance").nodeValue)/1,u=new o.a;u.x=parseInt(n.getAttributeNode("x").nodeValue),u.y=parseInt(n.getAttributeNode("y").nodeValue),u.width=parseInt(n.getAttributeNode("width").nodeValue),u.height=parseInt(n.getAttributeNode("height").nodeValue);var f=l.a.create(e,u.x,u.y,u.width,u.height,_,c);this._maxWidth=Math.max(this._maxWidth,d+this.letterSpacing),this._fontCharDic[h]=f,this._fontWidthMap[h]=d}}}parseFont2(t,e){if(null!=t&&null!=e){this._texture=e;var i=t.getElementsByTagName("info");this.fontSize=parseInt(i[0].attributes.size.nodeValue);var a=i[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt(a[0]),parseInt(a[1]),parseInt(a[2]),parseInt(a[3])];var r=t.getElementsByTagName("char"),s=0;for(s=0;s<r.length;s++){var n=r[s].attributes,h=parseInt(n.id.nodeValue),_=parseInt(n.xoffset.nodeValue)/1,c=parseInt(n.yoffset.nodeValue)/1,d=parseInt(n.xadvance.nodeValue)/1,u=new o.a;u.x=parseInt(n.x.nodeValue),u.y=parseInt(n.y.nodeValue),u.width=parseInt(n.width.nodeValue),u.height=parseInt(n.height.nodeValue);var f=l.a.create(e,u.x,u.y,u.width,u.height,_,c);this._maxWidth=Math.max(this._maxWidth,d+this.letterSpacing),this._fontCharDic[h]=f,this._fontWidthMap[h]=d}}}getCharTexture(t){return this._fontCharDic[t.charCodeAt(0)]}destroy(){if(this._texture){for(var t in this._fontCharDic){var e=this._fontCharDic[t];e&&e.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null,this._complete=null,this._padding=null}}setSpaceWidth(t){this._spaceWidth=t}getCharWidth(t){var e=t.charCodeAt(0);return this._fontWidthMap[e]?this._fontWidthMap[e]+this.letterSpacing:" "===t?this._spaceWidth+this.letterSpacing:0}getTextWidth(t){for(var e=0,i=0,a=t.length;i<a;i++)e+=this.getCharWidth(t.charAt(i));return e}getMaxWidth(){return this._maxWidth}getMaxHeight(){return this.fontSize}_drawText(t,e,i,a,r,s){var n,o=this.getTextWidth(t),l=0;"center"===r&&(l=(s-o)/2),"right"===r&&(l=s-o);for(var h=0,_=0,c=t.length;_<c;_++)(n=this.getCharTexture(t.charAt(_)))&&(e.graphics.drawImage(n,i+h+l,a),h+=this.getCharWidth(t.charAt(_)))}}e.a=d,c.a.regClass("laya.display.BitmapFont",d),c.a.regClass("Laya.BitmapFont",d)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(43),n=i(3),o=i(12);class l{static enable(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;n.a.loader.load(t,s.a.create(null,l._onInfoLoaded,[e]),null,o.a.JSON)}static _onInfoLoaded(t,e){var i,a,r,s,n;for(i in e)for(a=(r=e[i])[0],n=(r=r[1]).length,s=0;s<n;s++)l._fileLoadDic[a+r[s]]=i;t&&t.run()}static getFileLoadPath(t){return l._fileLoadDic[t]||t}}e.a=l,r()(l,"_fileLoadDic",{})},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{static __init__(){return s._baseClass||(s._baseClass=n,n.init()),s.items=s._baseClass.items,s.support=s._baseClass.support,s.support}static setItem(t,e){s._baseClass.setItem(t,e)}static getItem(t){return s._baseClass.getItem(t)}static setJSON(t,e){s._baseClass.setJSON(t,e)}static getJSON(t){return s._baseClass.getJSON(t)}static removeItem(t){s._baseClass.removeItem(t)}static clear(){s._baseClass.clear()}}e.a=s,r()(s,"_baseClass",void 0),r()(s,"items",void 0),r()(s,"support",!1);class n{static init(){try{n.support=!0,n.items=window.localStorage,n.setItem("laya","1"),n.removeItem("laya")}catch(t){n.support=!1}n.support||console.log("LocalStorage is not supprot or browser is private mode.")}static setItem(t,e){try{n.support&&n.items.setItem(t,e)}catch(t){console.warn("set localStorage failed",t)}}static getItem(t){return n.support?n.items.getItem(t):null}static setJSON(t,e){try{n.support&&n.items.setItem(t,JSON.stringify(e))}catch(t){console.warn("set localStorage failed",t)}}static getJSON(t){try{return JSON.parse(n.support?n.items.getItem(t):null)}catch(e){return n.items.getItem(t)}}static removeItem(t){n.support&&n.items.removeItem(t)}static clear(){n.support&&n.items.clear()}}r()(n,"items",void 0),r()(n,"support",!1)},function(t,e,i){"use strict";var a=i(18),r=(i.n(a),i(0)),s=i.n(r),n=i(3),o=i(6),l=i(19),h=i(246),_=i(12);class c{constructor(){s()(this,"fontName",void 0),s()(this,"complete",void 0),s()(this,"err",void 0),s()(this,"_fontTxt",void 0),s()(this,"_url",void 0),s()(this,"_div",void 0),s()(this,"_txtWidth",void 0),s()(this,"_http",void 0)}load(t){this._url=t;var e=t.toLowerCase().split(".ttf")[0].split("/");this.fontName=e[e.length-1],n.a.Render.isConchApp?this._loadConch():window.FontFace?this._loadWithFontFace():this._loadWithCSS()}_loadConch(){this._http=new h.a,this._http.on(o.a.ERROR,this,this._onErr),this._http.on(o.a.COMPLETE,this,this._onHttpLoaded),this._http.send(this._url,null,"get",_.a.BUFFER)}_onHttpLoaded(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;window.conchTextCanvas.setFontFaceFromBuffer(this.fontName,t),this._clearHttp(),this._complete()}_clearHttp(){this._http&&(this._http.off(o.a.ERROR,this,this._onErr),this._http.off(o.a.COMPLETE,this,this._onHttpLoaded),this._http=null)}_onErr(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)}_complete(){n.a.systemTimer.clear(this,this._complete),n.a.systemTimer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)}_checkComplete(){n.a.Browser.measureText(c._testString,this._fontTxt).width!=this._txtWidth&&this._complete()}_loadWithFontFace(){var t=new window.FontFace(this.fontName,"url('"+this._url+"')");document.fonts.add(t);var e=this;t.loaded.then(function(){e._complete()}),t.load()}_createDiv(){this._div=l.a.createElement("div"),this._div.innerHTML="laya";var t=this._div.style;t.fontFamily=this.fontName,t.position="absolute",t.left="-100px",t.top="-100px",document.body.appendChild(this._div)}_loadWithCSS(){var t=l.a.createElement("style");t.type="text/css",document.body.appendChild(t),t.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=l.a.measureText(c._testString,this._fontTxt).width;var e=this;t.onload=function(){n.a.systemTimer.once(1e4,e,e._complete)},n.a.systemTimer.loop(20,this,this._checkComplete),this._createDiv()}}e.a=c,s()(c,"_testString","LayaTTFFont")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(6),n=i(163),o=i(3),l=i(248),h=i(43),_=i(372);e.a=class{constructor(){r()(this,"target",void 0),r()(this,"ratio",.92),r()(this,"maxOffset",60),r()(this,"area",void 0),r()(this,"hasInertia",void 0),r()(this,"elasticDistance",void 0),r()(this,"elasticBackTime",void 0),r()(this,"data",void 0),r()(this,"_dragging",!1),r()(this,"_clickOnly",!0),r()(this,"_elasticRateX",void 0),r()(this,"_elasticRateY",void 0),r()(this,"_lastX",void 0),r()(this,"_lastY",void 0),r()(this,"_offsetX",void 0),r()(this,"_offsetY",void 0),r()(this,"_offsets",void 0),r()(this,"_disableMouseEvent",void 0),r()(this,"_tween",void 0),r()(this,"_parent",void 0)}start(t,e,i,a,r,n,l){let h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:.92;this.clearTimer(),this.target=t,this.area=e,this.hasInertia=i,this.elasticDistance=e?a:0,this.elasticBackTime=r,this.data=n,this._disableMouseEvent=l,this.ratio=h,this._parent=t.parent,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,o.a.stage.on(s.a.MOUSE_UP,this,this.onStageMouseUp),o.a.stage.on(s.a.MOUSE_OUT,this,this.onStageMouseUp),o.a.systemTimer.frameLoop(1,this,this.loop)}clearTimer(){o.a.systemTimer.clear(this,this.loop),o.a.systemTimer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)}stop(){this._dragging&&(n.a.instance.disableMouseEvent=!1,o.a.stage.off(s.a.MOUSE_UP,this,this.onStageMouseUp),o.a.stage.off(s.a.MOUSE_OUT,this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())}loop(){var t=this._parent.getMousePoint(),e=t.x,i=t.y,a=e-this._lastX,r=i-this._lastY;if(this._clickOnly){if(!(Math.abs(a*o.a.stage._canvasTransform.getScaleX())>1||Math.abs(r*o.a.stage._canvasTransform.getScaleY())>1))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event(s.a.DRAG_START,this.data),n.a.instance.disableMouseEvent=this._disableMouseEvent}else this._offsets.push(a,r);0===a&&0===r||(this._lastX=e,this._lastY=i,this.target.x+=a*this._elasticRateX,this.target.y+=r*this._elasticRateY,this.area&&this.checkArea(),this.target.event(s.a.DRAG_MOVE,this.data))}checkArea(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target._x<this.area.x)var t=this.area.x-this.target._x;else t=this.target._x>this.area.x+this.area.width?this.target._x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-t/this.elasticDistance),this.target._y<this.area.y)var e=this.area.y-this.target.y;else e=this.target._y>this.area.y+this.area.height?this.target._y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-e/this.elasticDistance)}}backToArea(){this.target.x=Math.min(Math.max(this.target._x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target._y,this.area.y),this.area.y+this.area.height)}onStageMouseUp(t){if(n.a.instance.disableMouseEvent=!1,o.a.stage.off(s.a.MOUSE_UP,this,this.onStageMouseUp),o.a.stage.off(s.a.MOUSE_OUT,this,this.onStageMouseUp),o.a.systemTimer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var e=this._offsets.length,i=Math.min(e,6),a=this._offsets.length-i,r=e-1;r>a;r--)this._offsetY+=this._offsets[r--],this._offsetX+=this._offsets[r];this._offsetX=this._offsetX/i*2,this._offsetY=this._offsetY/i*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=this._offsetX>0?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=this._offsetY>0?this.maxOffset:-this.maxOffset),o.a.systemTimer.frameLoop(1,this,this.tweenMove)}else this.elasticDistance>0?this.checkElastic():this.clear()}checkElastic(){var t=NaN,e=NaN;if(this.target.x<this.area.x?t=this.area.x:this.target._x>this.area.x+this.area.width&&(t=this.area.x+this.area.width),this.target.y<this.area.y?e=this.area.y:this.target._y>this.area.y+this.area.height&&(e=this.area.y+this.area.height),isNaN(t)&&isNaN(e))this.clear();else{var i={};isNaN(t)||(i.x=t),isNaN(e)||(i.y=e),this._tween=_.a.to(this.target,i,this.elasticBackTime,l.a.sineOut,h.a.create(this,this.clear),0,!1,!1)}}tweenMove(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event(s.a.DRAG_MOVE,this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(o.a.systemTimer.clear(this,this.tweenMove),this.elasticDistance>0?this.checkElastic():this.clear())}clear(){if(this.target){this.clearTimer();var t=this.target;this.target=null,this._parent=null,t.event(s.a.DRAG_END,this.data)}}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(4),n=i(19),o=i(21),l=i(3);class h{constructor(){r()(this,"_complete",void 0),r()(this,"_target",void 0),r()(this,"_ease",void 0),r()(this,"_props",void 0),r()(this,"_duration",void 0),r()(this,"_delay",void 0),r()(this,"_startTimer",void 0),r()(this,"_usedTimer",void 0),r()(this,"_usedPool",void 0),r()(this,"_delayParam",void 0),r()(this,"gid",0),r()(this,"update",void 0),r()(this,"repeat",1),r()(this,"_count",0)}static to(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];return s.a.getItemByClass("tween",h)._create(t,e,i,a,r,n,o,!0,l,!0)}static from(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];return s.a.getItemByClass("tween",h)._create(t,e,i,a,r,n,o,!1,l,!0)}to(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return this._create(t,e,i,a,r,s,n,!0,!1,!0)}from(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return this._create(t,e,i,a,r,s,n,!1,!1,!0)}_create(t,e,i,a,r,s,_,c,d,u){if(!t)throw new Error("Tween:target is null");this._target=t,this._duration=i,this._ease=a||e.ease||h.easeNone,this._complete=r||e.complete,this._delay=s,this._props=[],this._usedTimer=0,this._startTimer=n.a.now(),this._usedPool=d,this._delayParam=null,this.update=e.update;var f=t.$_GID||(t.$_GID=o.a.getGID());return h.tweenMap[f]?(_&&h.clearTween(t),h.tweenMap[f].push(this)):h.tweenMap[f]=[this],u?s<=0?this.firstStart(t,e,c):(this._delayParam=[t,e,c],l.a.timer.once(s,this,this.firstStart,this._delayParam)):this._initProps(t,e,c),this}firstStart(t,e,i){this._delayParam=null,t.destroyed?this.clear():(this._initProps(t,e,i),this._beginLoop())}_initProps(t,e,i){for(var a in e)if("number"==typeof t[a]){var r=i?t[a]:e[a],s=i?e[a]:t[a];this._props.push([a,r,s-r]),i||(t[a]=r)}}_beginLoop(){l.a.timer.frameLoop(1,this,this._doEase)}_doEase(){this._updateEase(n.a.now())}_updateEase(t){var e=this._target;if(e){if(e.destroyed)return h.clearTween(e);var i=this._usedTimer=t-this._startTimer-this._delay;if(!(i<0)){if(i>=this._duration)return this.complete();for(var a=i>0?this._ease(i,0,1,this._duration):0,r=this._props,s=0,n=r.length;s<n;s++){var o=r[s];e[o[0]]=o[1]+a*o[2]}this.update&&this.update.run()}}}set progress(t){var e=t*this._duration;this._startTimer=n.a.now()-this._delay-e}complete(){if(this._target){l.a.timer.runTimer(this,this.firstStart);for(var t=this._target,e=this._props,i=this._complete,a=0,r=e.length;a<r;a++){var s=e[a];t[s[0]]=s[1]+s[2]}this.update&&this.update.run(),this._count++,0!=this.repeat&&this._count>=this.repeat?(this.clear(),i&&i.run()):this.restart()}}pause(){var t;l.a.timer.clear(this,this._beginLoop),l.a.timer.clear(this,this._doEase),l.a.timer.clear(this,this.firstStart),(t=n.a.now()-this._startTimer-this._delay)<0&&(this._usedTimer=t)}setStartTime(t){this._startTimer=t}static clearAll(t){if(t&&t.$_GID){var e=h.tweenMap[t.$_GID];if(e){for(var i=0,a=e.length;i<a;i++)e[i]._clear();e.length=0}}}static clear(t){t.clear()}static clearTween(t){h.clearAll(t)}clear(){this._target&&(this._remove(),this._clear())}_clear(){this.pause(),l.a.timer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this.repeat=1,this._usedPool&&(this.update=null,s.a.recover("tween",this))}recover(){this._usedPool=!0,this._clear()}_remove(){var t=h.tweenMap[this._target.$_GID];if(t)for(var e=0,i=t.length;e<i;e++)if(t[e]===this){t.splice(e,1);break}}restart(){if(this.pause(),this._usedTimer=0,this._startTimer=n.a.now(),this._delayParam)l.a.timer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var t=this._props,e=0,i=t.length;e<i;e++){var a=t[e];this._target[a[0]]=a[1]}l.a.timer.once(this._delay,this,this._beginLoop)}}resume(){this._usedTimer>=this._duration||(this._startTimer=n.a.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?l.a.timer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())}static easeNone(t,e,i,a){return i*t/a+e}}e.a=h,r()(h,"tweenMap",[])},function(t,e,i){"use strict";var a=i(18),r=(i.n(a),i(28)),s=(i.n(r),i(0)),n=i.n(s),o=i(4),l=i(71),h=i(98),_=i(374),c=i(122),d=i(251),u=i(12),f=i(43),m=i(3);class p{static __init(){p._funMap=new d.a}static getBindFun(t){var e=p._funMap.get(t);if(null==e){var i='"'+t+'"',a="(function(data){if(data==null)return;with(data){try{\nreturn "+(i=i.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";e=window.Laya._runScript(a),p._funMap.set(t,e)}return e}static createByData(t,e){var i=v.create();if((t=p.createComp(e,t,t,null,i))._setBit(l.a.NOT_READY,!0),"_idMap"in t&&(t._idMap=i._idMap),e.animations){var a,r,s,n=[],o=e.animations,h=o.length;for(a=0;a<h;a++){switch(r=new _.a,s=o[a],r._setUp(i._idMap,s),t[s.name]=r,r._setControlNode(t),s.action){case 1:r.play(0,!1);break;case 2:r.play(0,!0)}n.push(r)}t._aniList=n}return"Scene"===t._$componentType&&t._width>0&&null==e.props.hitTestPrior&&!t.mouseThrough&&(t.hitTestPrior=!0),i.beginLoad(t),t}static createInitTool(){return v.create()}static createComp(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if("Scene3D"==t.type||"Sprite3D"==t.type){var s=[],n=m.a.Laya.Utils3D._createSceneByJsonForMaker(t,s,r);return"Sprite3D"==t.type?m.a.Laya.StaticBatchManager.combine(n,s):m.a.Laya.StaticBatchManager.combine(null,s),n}if(!(e=e||p.getCompInstance(t)))return t.props&&t.props.runtime?console.warn("runtime not found:"+t.props.runtime):console.warn("can not create:"+t.type),null;var o=t.child;if(o)for(var l="List"==e._$componentType,_=0,d=o.length;_<d;_++){var u=o[_];if("itemRender"in e&&("render"==u.props.name||"render"===u.props.renderType))e.itemRender=u;else if("Graphic"==u.type)m.a.ClassUtils._addGraphicsToSprite(u,e);else if(m.a.ClassUtils._isDrawType(u.type))m.a.ClassUtils._addGraphicToSprite(u,e,!0);else{if(l){var f=[],g=p.createComp(u,null,i,f,r);f.length&&(g._$bindData=f)}else g=p.createComp(u,null,i,a,r);"Script"==u.type?g instanceof h.a?e._addComponentInstance(g):"owner"in g?g.owner=e:"target"in g&&(g.target=e):"mask"==u.props.renderType||"mask"==u.props.name?e.mask=g:g instanceof c.a&&e.addChild(g)}}var v=t.props;for(var T in v){var E=v[T];"string"==typeof E&&(E.indexOf("@node:")>=0||E.indexOf("@Prefab:")>=0)?r&&r.addNodeRef(e,T,E):p.setCompValue(e,T,E,i,a)}return e._afterInited&&e._afterInited(),t.compId&&r&&r._idMap&&(r._idMap[t.compId]=e),e}static setCompValue(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if("string"==typeof i&&i.indexOf("${")>-1){if(p._sheet||(p._sheet=m.a.ClassUtils.getClass("laya.data.Table")),!p._sheet)return void console.warn("Can not find class Sheet");if(r)r.push(t,e,i);else if(a){-1==i.indexOf("].")&&(i=i.replace(".","[0]."));var s,n,o=new g(t,e,i);o.exe(a);for(var l=i.replace(/\[.*?\]\./g,".");null!=(s=p._parseWatchData.exec(l));){for(var h=s[1];null!=(n=p._parseKeyWord.exec(h));){var _=n[0],c=a._watchMap[_]||(a._watchMap[_]=[]);c.push(o),p._sheet.I.notifer.on(_,a,a.changeData,[_])}(c=a._watchMap[h]||(a._watchMap[h]=[])).push(o),p._sheet.I.notifer.on(h,a,a.changeData,[h])}}}else"var"===e&&a?a[i]=t:t[e]="true"===i||"false"!==i&&i}static getCompInstance(t){if("UIView"==t.type&&t.props&&t.props.pageData)return p.createByData(null,t.props.pageData);var e=t.props&&t.props.runtime||t.type,i=m.a.ClassUtils.getClass(e);if(!i)throw"Can not find class "+e;if("Script"===t.type&&i.prototype._doAwake){var a=o.a.createByClass(i);return a._destroyed=!1,a}return t.props&&"renderType"in t.props&&"instance"==t.props.renderType?(i.instance||(i.instance=new i),i.instance):new i}}e.a=p,n()(p,"_funMap",void 0),n()(p,"_parseWatchData",/\${(.*?)}/g),n()(p,"_parseKeyWord",/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g),n()(p,"_sheet",void 0);class g{constructor(t,e,i){n()(this,"comp",void 0),n()(this,"prop",void 0),n()(this,"value",void 0),this.comp=t,this.prop=e,this.value=i}exe(t){var e=p.getBindFun(this.value);this.comp[this.prop]=e.call(this,t)}}class v{constructor(){n()(this,"_nodeRefList",void 0),n()(this,"_initList",void 0),n()(this,"_loadList",void 0),n()(this,"_idMap",void 0),n()(this,"_scene",void 0)}reset(){this._nodeRefList=null,this._initList=null,this._idMap=null,this._loadList=null,this._scene=null}recover(){this.reset(),o.a.recover("InitTool",this)}static create(){var t=o.a.getItemByClass("InitTool",v);return t._idMap=[],t}addLoadRes(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._loadList||(this._loadList=[]),m.a.loader.getRes(t)||(e?this._loadList.push({url:t,type:e}):this._loadList.push(t))}addNodeRef(t,e,i){this._nodeRefList||(this._nodeRefList=[]),this._nodeRefList.push([t,e,i]),i.indexOf("@Prefab:")>=0&&this.addLoadRes(i.replace("@Prefab:",""),u.a.PREFAB)}setNodeRef(){if(this._nodeRefList)if(this._idMap){var t,e,i;for(e=this._nodeRefList.length,t=0;t<e;t++)(i=this._nodeRefList[t])[0][i[1]]=this.getReferData(i[2]);this._nodeRefList=null}else this._nodeRefList=null}getReferData(t){if(t.indexOf("@Prefab:")>=0)return u.a.getRes(t.replace("@Prefab:",""));if(t.indexOf("@arr:")>=0){var e,i,a,r;for(a=(e=(t=t.replace("@arr:","")).split(",")).length,i=0;i<a;i++)r=e[i],e[i]=r?this._idMap[r.replace("@node:","")]:null;return e}return this._idMap[t.replace("@node:","")]}addInitItem(t){this._initList||(this._initList=[]),this._initList.push(t)}doInits(){this._initList&&(this._initList=null)}finish(){this.setNodeRef(),this.doInits(),this._scene._setBit(l.a.NOT_READY,!1),this._scene.parent&&this._scene.parent.activeInHierarchy&&this._scene.active&&this._scene._processActive(),this._scene.event("onViewCreated"),this.recover()}beginLoad(t){this._scene=t,!this._loadList||this._loadList.length<1?this.finish():m.a.loader.load(this._loadList,f.a.create(this,this.finish))}}},function(t,e,i){"use strict";var a=i(138),r=(i.n(a),i(375)),s=(i.n(r),i(0)),n=i.n(s),o=i(385),l=i(167),h=i(248),_=i(30);class c extends o.a{static _sortIndexFun(t,e){return t.index-e.index}constructor(){super(),n()(this,"_targetDic",void 0),n()(this,"_animationData",void 0),n()(this,"_usedFrames",void 0),void 0===c._sortIndexFun&&(c._sortIndexFun=l.a.sortByKey("index",!1,!0))}_setUp(t,e){this._targetDic=t,this._animationData=e,this.interval=1e3/e.frameRate,e.parsed?(this._count=e.count,this._labels=e.labels,this._usedFrames=e.animationNewFrames):(this._usedFrames=[],this._calculateDatas(),e.parsed=!0,e.labels=this._labels,e.count=this._count,e.animationNewFrames=this._usedFrames)}clear(){return super.clear(),this._targetDic=null,this._animationData=null,this}_displayToIndex(t){if(this._animationData){t<0&&(t=0),t>this._count&&(t=this._count);var e,i=this._animationData.nodes,a=i.length;for(e=0;e<a;e++)this._displayNodeToFrame(i[e],t)}}_displayNodeToFrame(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i||(i=this._targetDic);var a=i[t.target];if(a){var r,s,n,o,l=t.frames,h=t.keys,_=h.length;for(o=0;o<_;o++)n=(s=l[r=h[o]]).length>e?s[e]:s[s.length-1],a[r]=n;var c,d=t.funkeys;if(0!=(_=d.length))for(o=0;o<_;o++)void 0!==(c=l[r=d[o]])[e]&&a[r]&&a[r].apply(a,c[e])}}_calculateDatas(){if(this._animationData){var t,e,i=this._animationData.nodes,a=i.length;for(this._count=0,t=0;t<a;t++)e=i[t],this._calculateKeyFrames(e);this._count+=1}}_calculateKeyFrames(t){var e,i,a=t.keyframes,r=t.target;for(e in t.frames||(t.frames={}),t.keys?t.keys.length=0:t.keys=[],t.funkeys?t.funkeys.length=0:t.funkeys=[],t.initValues||(t.initValues={}),a){var s=-1!=e.indexOf("()");if(i=a[e],s&&(e=e.substr(0,e.length-2)),t.frames[e]||(t.frames[e]=[]),s){t.funkeys.push(e);for(var n=t.frames[e],o=0;o<i.length;o++){var l=i[o];n[l.index]=l.value,l.index>this._count&&(this._count=l.index)}}else this._targetDic&&this._targetDic[r]&&(t.initValues[e]=this._targetDic[r][e]),i.sort(c._sortIndexFun),t.keys.push(e),this._calculateNodePropFrames(i,t.frames[e],e,r)}}resetNodes(){if(this._targetDic&&this._animationData){var t,e,i,a=this._animationData.nodes,r=a.length;for(t=0;t<r;t++)if(i=(e=a[t]).initValues){var s,n=this._targetDic[e.target];if(n)for(s in i)n[s]=i[s]}}}_calculateNodePropFrames(t,e,i,a){var r,s=t.length-1;for(e.length=t[s].index+1,r=0;r<s;r++)this._dealKeyFrame(t[r]),this._calculateFrameValues(t[r],t[r+1],e);0==s&&(e[0]=t[0].value,this._usedFrames&&(this._usedFrames[t[0].index]=!0)),this._dealKeyFrame(t[r])}_dealKeyFrame(t){t.label&&""!=t.label&&this.addLabel(t.label,t.index)}_calculateFrameValues(t,e,i){var a,r,s=t.index,n=e.index,o=t.value,l=e.value-t.value,_=n-s,c=this._usedFrames;if(n>this._count&&(this._count=n),t.tween)for(null==(r=h.a[t.tweenMethod])&&(r=h.a.linearNone),a=s;a<n;a++)i[a]=r(a-s,o,l,_),c&&(c[a]=!0);else for(a=s;a<n;a++)i[a]=o;c&&(c[t.index]=!0,c[e.index]=!0),i[e.index]=e.value}}e.a=c,_.a.regClass("laya.display.FrameAnimation",c),_.a.regClass("Laya.FrameAnimation",c)},function(t,e,i){for(var a=i(376),r=i(249),s=i(78),n=i(44),o=i(65),l=i(166),h=i(35),_=h("iterator"),c=h("toStringTag"),d=l.Array,u={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},f=r(u),m=0;m<f.length;m++){var p,g=f[m],v=u[g],T=n[g],E=T&&T.prototype;if(E&&(E[_]||o(E,_,d),E[c]||o(E,c,g),l[g]=d,v))for(p in a)E[p]||s(E,p,a[p],!0)}},function(t,e,i){"use strict";var a=i(377),r=i(378),s=i(166),n=i(117);t.exports=i(379)(Array,"Array",function(t,e){this._t=n(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,r(1)):r(0,"keys"==e?i:"values"==e?t[i]:[i,t[i]])},"values"),s.Arguments=s.Array,a("keys"),a("values"),a("entries")},function(t,e,i){var a=i(35)("unscopables"),r=Array.prototype;void 0==r[a]&&i(65)(r,a,{}),t.exports=function(t){r[a][t]=!0}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,i){"use strict";var a=i(197),r=i(139),s=i(78),n=i(65),o=i(166),l=i(380),h=i(250),_=i(384),c=i(35)("iterator"),d=!([].keys&&"next"in[].keys()),u=function(){return this};t.exports=function(t,e,i,f,m,p,g){l(i,e,f);var v,T,E,S=function(t){if(!d&&t in y)return y[t];switch(t){case"keys":case"values":return function(){return new i(this,t)}}return function(){return new i(this,t)}},R=e+" Iterator",x="values"==m,A=!1,y=t.prototype,I=y[c]||y["@@iterator"]||m&&y[m],C=I||S(m),M=m?x?S("entries"):C:void 0,D="Array"==e&&y.entries||I;if(D&&(E=_(D.call(new t)))!==Object.prototype&&E.next&&(h(E,R,!0),a||"function"==typeof E[c]||n(E,c,u)),x&&I&&"values"!==I.name&&(A=!0,C=function(){return I.call(this)}),a&&!g||!d&&!A&&y[c]||n(y,c,C),o[e]=C,o[R]=u,m)if(v={values:x?C:S("values"),keys:p?C:S("keys"),entries:M},g)for(T in v)T in y||s(y,T,v[T]);else r(r.P+r.F*(d||A),e,v);return v}},function(t,e,i){"use strict";var a=i(381),r=i(141),s=i(250),n={};i(65)(n,i(35)("iterator"),function(){return this}),t.exports=function(t,e,i){t.prototype=a(n,{next:r(1,i)}),s(t,e+" Iterator")}},function(t,e,i){var a=i(34),r=i(382),s=i(155),n=i(154)("IE_PROTO"),o=function(){},l=function(){var t,e=i(195)("iframe"),a=s.length;for(e.style.display="none",i(383).appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),l=t.F;a--;)delete l.prototype[s[a]];return l()};t.exports=Object.create||function(t,e){var i;return null!==t?(o.prototype=a(t),i=new o,o.prototype=null,i[n]=t):i=l(),void 0===e?i:r(i,e)}},function(t,e,i){var a=i(76),r=i(34),s=i(249);t.exports=i(45)?Object.defineProperties:function(t,e){r(t);for(var i,n=s(e),o=n.length,l=0;o>l;)a.f(t,i=n[l++],e[i]);return t}},function(t,e,i){var a=i(44).document;t.exports=a&&a.documentElement},function(t,e,i){var a=i(89),r=i(145),s=i(154)("IE_PROTO"),n=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=r(t),a(t,s)?t[s]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?n:null}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(70),n=i(69),o=i(71),l=i(6),h=i(30);class _ extends s.a{constructor(){super(),r()(this,"loop",void 0),r()(this,"wrapMode",0),r()(this,"_interval",n.a.animationInterval),r()(this,"_index",void 0),r()(this,"_count",void 0),r()(this,"_isPlaying",void 0),r()(this,"_labels",void 0),r()(this,"_isReverse",!1),r()(this,"_frameRateChanged",!1),r()(this,"_actionName",void 0),r()(this,"_controlNode",void 0),this._setBitUp(o.a.DISPLAY)}play(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._isPlaying=!0,this._actionName=i,this.index="string"==typeof t?this._getFrameByLabel(t):t,this.loop=e,this._isReverse=this.wrapMode===_.WRAP_REVERSE,0==this.index&&this._isReverse&&(this.index=this.count-1),this.interval>0&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)}get interval(){return this._interval}set interval(t){this._interval!=t&&(this._frameRateChanged=!0,this._interval=t,this._isPlaying&&t>0&&this.timerLoop(t,this,this._frameLoop,null,!0,!0))}_getFrameByLabel(t){for(var e=0;e<this._count;e++){var i=this._labels[e];if(i&&i.indexOf(t)>-1)return e}return 0}_frameLoop(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event(l.a.COMPLETE);this.wrapMode==_.WRAP_PINGPONG?(this._index=this._count>0?1:0,this._isReverse=!1):this._index=this._count-1,this.event(l.a.COMPLETE)}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event(l.a.COMPLETE);this.wrapMode==_.WRAP_PINGPONG?(this._index=this._count-2>=0?this._count-2:0,this._isReverse=!0):this._index=0,this.event(l.a.COMPLETE)}this.index=this._index}_setControlNode(t){this._controlNode&&(this._controlNode.off(l.a.DISPLAY,this,this._resumePlay),this._controlNode.off(l.a.UNDISPLAY,this,this._resumePlay)),this._controlNode=t,t&&t!=this&&(t.on(l.a.DISPLAY,this,this._resumePlay),t.on(l.a.UNDISPLAY,this,this._resumePlay))}_setDisplay(t){super._setDisplay(t),this._resumePlay()}_resumePlay(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))}stop(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)}get isPlaying(){return this._isPlaying}addLabel(t,e){this._labels||(this._labels={}),this._labels[e]||(this._labels[e]=[]),this._labels[e].push(t)}removeLabel(t){if(t){if(this._labels)for(var e in this._labels)this._removeLabelFromList(this._labels[e],t)}else this._labels=null}_removeLabelFromList(t,e){if(t)for(var i=t.length-1;i>=0;i--)t[i]==e&&t.splice(i,1)}gotoAndStop(t){this.index="string"==typeof t?this._getFrameByLabel(t):t,this.stop()}get index(){return this._index}set index(t){if(this._index=t,this._displayToIndex(t),this._labels&&this._labels[t])for(var e=this._labels[t],i=0,a=e.length;i<a;i++)this.event(l.a.LABEL,e[i])}_displayToIndex(t){}get count(){return this._count}clear(){return this.stop(),this._labels=null,this}}e.a=_,r()(_,"WRAP_POSITIVE",0),r()(_,"WRAP_REVERSE",1),r()(_,"WRAP_PINGPONG",2),h.a.regClass("laya.display.AnimationBase",_),h.a.regClass("Laya.AnimationBase",_)},function(t,e,i){"use strict";var a=i(118),r=(i.n(a),i(0)),s=i.n(r),n=i(387),o=i(19),l=i(70),h=i(120),_=i(37),c=i(121),d=i(17),u=i(8),f=i(3);class m extends n.a{constructor(){super(...arguments),s()(this,"_txt",void 0),s()(this,"_leftText",void 0),s()(this,"_sp",void 0),s()(this,"_titleSp",void 0),s()(this,"_bgSp",void 0),s()(this,"_show",!1),s()(this,"_useCanvas",!1),s()(this,"_canvas",void 0),s()(this,"_ctx",void 0),s()(this,"_first",void 0),s()(this,"_vx",void 0),s()(this,"_width",void 0),s()(this,"_height",100),s()(this,"_view",[])}show(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;u.a;o.a.onMiniGame||f.a.Render.isConchApp||o.a.onBDMiniGame||o.a.onKGMiniGame||o.a.onQGMiniGame||o.a.onQQMiniGame||o.a.onAlipayMiniGame||o.a.onBLMiniGame||o.a.onTTMiniGame||o.a.onHWMiniGame||o.a.onTBMiniGame||(this._useCanvas=!0),this._show=!0,u.a._fpsData.length=60,this._view[0]={title:"FPS(WebGL)",value:"_fpsStr",color:"yellow",units:"int"},this._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},this._view[2]={title:"RenderBatches",value:"renderBatches",color:"white",units:"int"},this._view[3]={title:"SavedRenderBatches",value:"savedRenderBatches",color:"white",units:"int"},this._view[4]={title:"CPUMemory",value:"cpuMemory",color:"yellow",units:"M"},this._view[5]={title:"GPUMemory",value:"gpuMemory",color:"yellow",units:"M"},this._view[6]={title:"Shader",value:"shaderCall",color:"white",units:"int"},this._view[7]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"},_.a.is3DMode&&(this._view[0].title="FPS(3D)",this._view[8]={title:"TriFaces",value:"trianglesFaces",color:"white",units:"int"},this._view[9]={title:"FrustumCulling",value:"frustumCulling",color:"white",units:"int"},this._view[10]={title:"OctreeNodeCulling",value:"octreeNodeCulling",color:"white",units:"int"}),this._useCanvas?this.createUIPre(t,e):this.createUI(t,e),this.enable()}createUIPre(t,e){var i=o.a.pixelRatio;this._width=180*i,this._vx=120*i,this._height=i*(12*this._view.length+3*i)+4,m._fontSize=12*i;for(var a=0;a<this._view.length;a++)this._view[a].x=4,this._view[a].y=a*m._fontSize+2*i;this._canvas||(this._canvas=new c.a(!0),this._canvas.size(this._width,this._height),this._ctx=this._canvas.getContext("2d"),this._ctx.textBaseline="top",this._ctx.font=m._fontSize+"px Arial",this._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+t+"px;top:"+e+"px;width:"+this._width/i+"px;height:"+this._height/i+"px;"),o.a.onKGMiniGame||o.a.container.appendChild(this._canvas.source),this._first=!0,this.loop(),this._first=!1}createUI(t,e){var i=this._sp,a=o.a.pixelRatio;i||(i=new l.a,this._leftText=new h.a,this._leftText.pos(5,5),this._leftText.color="#ffffff",i.addChild(this._leftText),this._txt=new h.a,this._txt.pos(130*a,5),this._txt.color="#ffffff",i.addChild(this._txt),this._sp=i),i.pos(t,e);for(var r="",s=0;s<this._view.length;s++){r+=this._view[s].title+"\n"}this._leftText.text=r;var n=138*a,_=a*(12*this._view.length+3*a)+4;this._txt.fontSize=m._fontSize*a,this._leftText.fontSize=m._fontSize*a,i.size(n,_),i.graphics.clear(),i.graphics.alpha(.5),i.graphics.drawRect(0,0,n+110,_+30,"#999999"),i.graphics.alpha(2),this.loop()}enable(){f.a.systemTimer.frameLoop(1,this,this.loop)}hide(){this._show=!1,f.a.systemTimer.clear(this,this.loop),this._canvas&&o.a.removeElement(this._canvas.source)}set_onclick(t){this._sp&&this._sp.on("click",this._sp,t),this._canvas&&(this._canvas.source.onclick=t,this._canvas.source.style.pointerEvents="")}loop(){u.a._count++;var t=o.a.now();if(!(t-u.a._timer<1e3)){var e=u.a._count;if(u.a.FPS=Math.round(1e3*e/(t-u.a._timer)),this._show){u.a.trianglesFaces=Math.round(u.a.trianglesFaces/e),this._useCanvas?u.a.renderBatches=Math.round(u.a.renderBatches/e):u.a.renderBatches=Math.round(u.a.renderBatches/e)-1,u.a.savedRenderBatches=Math.round(u.a.savedRenderBatches/e),u.a.shaderCall=Math.round(u.a.shaderCall/e),u.a.spriteRenderUseCacheCount=Math.round(u.a.spriteRenderUseCacheCount/e),u.a.canvasNormal=Math.round(u.a.canvasNormal/e),u.a.canvasBitmap=Math.round(u.a.canvasBitmap/e),u.a.canvasReCache=Math.ceil(u.a.canvasReCache/e),u.a.frustumCulling=Math.round(u.a.frustumCulling/e),u.a.octreeNodeCulling=Math.round(u.a.octreeNodeCulling/e);var i=u.a.FPS>0?Math.floor(1e3/u.a.FPS).toString():" ";u.a._fpsStr=u.a.FPS+(u.a.renderSlow?" slow":"")+" "+i,u.a._spriteStr=u.a.spriteCount+(u.a.spriteRenderUseCacheCount?"/"+u.a.spriteRenderUseCacheCount:""),u.a._canvasStr=u.a.canvasReCache+"/"+u.a.canvasNormal+"/"+u.a.canvasBitmap,u.a.cpuMemory=d.a.cpuMemory,u.a.gpuMemory=d.a.gpuMemory,this._useCanvas?this.renderInfoPre():this.renderInfo(),u.a.clear()}u.a._count=0,u.a._timer=t}}renderInfoPre(){var t,e,i=0;if(this._canvas){var a=this._ctx;for(a.clearRect(this._first?0:this._vx,0,this._width,this._height),i=0;i<this._view.length;i++)t=this._view[i],this._first&&(a.fillStyle="white",a.fillText(t.title,t.x,t.y)),a.fillStyle=t.color,e=u.a[t.value],"M"==t.units&&(e=Math.floor(e/1048576*100)/100+" M"),a.fillText(e+"",t.x+this._vx,t.y)}}renderInfo(){for(var t="",e=0;e<this._view.length;e++){var i=this._view[e],a=u.a[i.value];"M"==i.units&&(a=Math.floor(a/1048576*100)/100+" M"),"K"==i.units&&(a=Math.floor(a/1024*100)/100+" K"),t+=a+"\n"}this._txt.text=t}isCanvasRender(){return this._useCanvas}renderNotCanvas(t,e,i){this._show&&this._sp&&this._sp.render(t,0,0)}}e.a=m,s()(m,"_fontSize",12)},function(t,e,i){"use strict";e.a=class{show(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1]}enable(){}hide(){}set_onclick(t){}isCanvasRender(){return!0}renderNotCanvas(t,e,i){}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(242),n=i(3);class o{constructor(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];r()(this,"scale",1),r()(this,"currTimer",Date.now()),r()(this,"currFrame",0),r()(this,"_delta",0),r()(this,"_lastTimer",Date.now()),r()(this,"_map",[]),r()(this,"_handlers",[]),r()(this,"_temp",[]),r()(this,"_count",0),t&&o.gSysTimer&&o.gSysTimer.frameLoop(1,this,this._update)}get delta(){return this._delta}_update(){if(this.scale<=0)return this._lastTimer=Date.now(),void(this._delta=0);var t=this.currFrame=this.currFrame+this.scale,e=Date.now(),i=e-this._lastTimer>3e4;this._delta=(e-this._lastTimer)*this.scale;var a=this.currTimer=this.currTimer+this._delta;this._lastTimer=e;var r=this._handlers;this._count=0;for(var s=0,n=r.length;s<n;s++){var o=r[s];if(null!==o.method){var l=o.userFrame?t:a;if(l>=o.exeTime)if(o.repeat)if(!o.jumpFrame||i)o.exeTime+=o.delay,o.run(!1),l>o.exeTime&&(o.exeTime+=Math.ceil((l-o.exeTime)/o.delay)*o.delay);else for(;l>=o.exeTime;)o.exeTime+=o.delay,o.run(!1);else o.run(!0)}else this._count++}(this._count>30||t%200==0)&&this._clearHandlers()}_clearHandlers(){for(var t=this._handlers,e=0,i=t.length;e<i;e++){var a=t[e];null!==a.method?this._temp.push(a):this._recoverHandler(a)}this._handlers=this._temp,t.length=0,this._temp=t}_recoverHandler(t){this._map[t.key]==t&&(this._map[t.key]=null),t.clear(),o._pool.push(t)}_create(t,e,i,a,r,s,n){if(!i)return r.apply(a,s),null;if(n){var h=this._getHandler(a,r);if(h)return h.repeat=e,h.userFrame=t,h.delay=i,h.caller=a,h.method=r,h.args=s,h.exeTime=i+(t?this.currFrame:this.currTimer+Date.now()-this._lastTimer),h}return(h=o._pool.length>0?o._pool.pop():new l).repeat=e,h.userFrame=t,h.delay=i,h.caller=a,h.method=r,h.args=s,h.exeTime=i+(t?this.currFrame:this.currTimer+Date.now()-this._lastTimer),this._indexHandler(h),this._handlers.push(h),h}_indexHandler(t){var e=t.caller,i=t.method,a=e?e.$_GID||(e.$_GID=n.a.Utils.getGID()):0,r=i.$_TID||(i.$_TID=1e5*o._mid++);t.key=a+r,this._map[t.key]=t}once(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this._create(!1,!1,t,e,i,a,r)}loop(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];var n=this._create(!1,!0,t,e,i,a,r);n&&(n.jumpFrame=s)}frameOnce(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this._create(!0,!1,t,e,i,a,r)}frameLoop(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this._create(!0,!0,t,e,i,a,r)}toString(){return" handlers:"+this._handlers.length+" pool:"+o._pool.length}clear(t,e){var i=this._getHandler(t,e);i&&(this._map[i.key]=null,i.key=0,i.clear())}clearAll(t){if(t)for(var e=0,i=this._handlers.length;e<i;e++){var a=this._handlers[e];a.caller===t&&(this._map[a.key]=null,a.key=0,a.clear())}}_getHandler(t,e){var i=t?t.$_GID||(t.$_GID=n.a.Utils.getGID()):0,a=e.$_TID||(e.$_TID=1e5*o._mid++);return this._map[i+a]}callLater(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;s.a.I.callLater(t,e,i)}runCallLater(t,e){s.a.I.runCallLater(t,e)}runTimer(t,e){var i=this._getHandler(t,e);i&&null!=i.method&&(this._map[i.key]=null,i.run(!0))}pause(){this.scale=0}resume(){this.scale=1}}e.a=o,r()(o,"gSysTimer",null),r()(o,"_pool",[]),r()(o,"_mid",1);class l{constructor(){r()(this,"key",void 0),r()(this,"repeat",void 0),r()(this,"delay",void 0),r()(this,"userFrame",void 0),r()(this,"exeTime",void 0),r()(this,"caller",void 0),r()(this,"method",void 0),r()(this,"args",void 0),r()(this,"jumpFrame",void 0)}clear(){this.caller=null,this.method=null,this.args=null}run(t){var e=this.caller;if(e&&e.destroyed)return this.clear();var i=this.method,a=this.args;t&&this.clear(),null!=i&&(a?i.apply(e,a):i.call(e))}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(29),n=i(36),o=i(96),l=i(10);e.a=class extends n.a{constructor(t){super(s.a.SKINMESH,0),r()(this,"texcoord",void 0),r()(this,"position",void 0),r()(this,"offsetX",300),r()(this,"offsetY",0);var e=l.a.mainContext,i=8*o.a.BYTES_PE;this.position=[2,e.FLOAT,!1,i,0],this.texcoord=[2,e.FLOAT,!1,i,2*o.a.BYTES_PE],this.color=[4,e.FLOAT,!1,i,4*o.a.BYTES_PE]}}},function(t,e,i){"use strict";var a=i(36),r=i(29);e.a=class extends a.a{constructor(t){super(r.a.PRIMITIVE,0),this._attribLocation=["position",0,"attribColor",1]}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(36),n=i(29);e.a=class extends s.a{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;super(n.a.TEXTURE2D,t),r()(this,"u_colorMatrix",void 0),r()(this,"strength",0),r()(this,"blurInfo",null),r()(this,"colorMat",null),r()(this,"colorAlpha",null),this._attribLocation=["posuv",0,"attribColor",1,"attribFlags",2]}clear(){this.texture=null,this.shader=null,this.defines._value=this.subID}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(3);e.a=class{constructor(t){r()(this,"script",void 0),r()(this,"codes",{}),r()(this,"funs",{}),r()(this,"curUseID",-1),r()(this,"funnames",""),this.script=t;for(var e,i,a=0;!((a=t.indexOf("#begin",a))<0);){for(i=a+5;!((i=t.indexOf("#end",i))<0)&&"i"===t.charAt(i+4);)i+=5;if(i<0)throw"add include err,no #end:"+t;e=t.indexOf("\n",a);var n=s.a.ShaderCompile.splitToWords(t.substr(a,e-a),null);"code"==n[1]?this.codes[n[2]]=t.substr(e+1,i-e-1):"function"==n[1]&&(e=t.indexOf("function",a),e+="function".length,this.funs[n[3]]=t.substr(e+1,i-e-1),this.funnames+=n[3]+";"),a=i+1}}getWith(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;var e=t?this.codes[t]:this.script;if(!e)throw"get with error:"+t;return e}getFunsScript(t){var e="";for(var i in this.funs)t.indexOf(i+";")>=0&&(e+=this.funs[i]);return e}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(12),n=i(27),o=i(23),l=i(42);class h extends o.a{constructor(){super(),r()(this,"worker",void 0),r()(this,"_useWorkerLoader",void 0),this.worker=new Worker(h.workerPath);let t=this;this.worker.onmessage=function(e){t.workerMessage(e.data)}}static __init__(){return null==h._preLoadFun&&(!!Worker&&(h._preLoadFun=s.a.prototype._loadImage,s.a.prototype._loadImage=h.prototype._loadImage,h.I||(h.I=new h),!0))}static workerSupported(){return!!Worker}static enableWorkerLoader(){h._tryEnabled||(h.enable=!0,h._tryEnabled=!0)}static set enable(t){h._enable!=t&&(h._enable=t,t&&null==h._preLoadFun&&(h._enable=h.__init__()))}static get enable(){return h._enable}workerMessage(t){if(t)switch(t.type){case"Image":this.imageLoaded(t);break;case"Disable":h.enable=!1}}imageLoaded(t){if(t.dataType&&"imageBitmap"==t.dataType){var e=t.imageBitmap;console.log("load:",t.url),this.event(t.url,e)}else this.event(t.url,null)}loadImage(t){this.worker.postMessage(t)}_loadImage(t){var e=this;let i=e.type;if(this._useWorkerLoader&&h._enable){t=n.a.formatURL(t);var a=function(a){if(r(),a){var s=a;"nativeimage"!==i&&(s=new l.a).loadImageSource(a),e.onLoaded(s)}else h._preLoadFun.call(e,t)};h.I.on(t,e,a),h.I.loadImage(t)}else h._preLoadFun.call(e,t);function r(){h.I.off(t,e,a)}}}e.a=h,r()(h,"I",void 0),r()(h,"workerPath","libs/workerloader.js"),r()(h,"_preLoadFun",void 0),r()(h,"_enable",!1),r()(h,"_tryEnabled",!1)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(19);class n{static set cursor(t){n._style.cursor=t}static get cursor(){return n._style.cursor}static __init__(){n._style=s.a.document.body.style}static hide(){"none"!=n.cursor&&(n._preCursor=n.cursor,n.cursor="none")}static show(){"none"==n.cursor&&(n._preCursor?n.cursor=n._preCursor:n.cursor="auto")}}e.a=n,r()(n,"_style",void 0),r()(n,"_preCursor",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(119),n=i(2);class o extends s.a{static __init__(){var t=n.a.instance;o._fixattriInfo=[t.FLOAT,4,0,t.FLOAT,3,16,t.FLOAT,3,28,t.FLOAT,4,40,t.FLOAT,4,56,t.FLOAT,3,72,t.FLOAT,2,84,t.FLOAT,4,92,t.FLOAT,1,108,t.FLOAT,1,112]}constructor(t){super(o.const_stride,4*t*o.const_stride,4),this.canReuse=!0,this.setAttributes(o._fixattriInfo),this.createQuadIB(t),this._quadNum=t}setMaxParticleNum(t){this._vb._resizeBuffer(4*t*o.const_stride,!1),this.createQuadIB(t)}static getAMesh(t){if(o._POOL.length){var e=o._POOL.pop();return e.setMaxParticleNum(t),e}return new o(t)}releaseMesh(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,o._POOL.push(this)}destroy(){this._ib.destroy(),this._vb.destroy(),this._vb.deleteBuffer()}}e.a=o,r()(o,"const_stride",116),r()(o,"_fixattriInfo",void 0),r()(o,"_POOL",[])},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(149),n=i(42),o=i(80);class l extends s.a{}e.a=l,r()(l,"create",function(t,e,i){var a=new n.a(t,e,i,!1,!1);return a.wrapModeU=o.a.Clamp,a.wrapModeV=o.a.Clamp,a})},function(t,e,i){"use strict";var a=i(18),r=(i.n(a),i(0)),s=i.n(r),n=i(69),o=i(72),l=i(11),h=i(58),_=i(417),c=i(172),d=i(425),u=i(436),f=i(439),m=i(276),p=i(440),g=i(441),v=i(22),T=i(129),E=i(442),S=i(467),R=i(472),x=i(473),A=i(474),y=i(475),I=i(185),C=i(287),M=i(290),D=i(299),b=i(183),L=i(283),O=i(63),P=i(127),N=i(268),w=i(269),B=i(41),F=i(181),V=i(190),U=i(192),G=i(33),H=i(302),z=i(303),k=i(193),W=i(131),X=i(288),Y=i(134),j=i(289),Z=i(102),q=i(14),Q=i(497),K=i(282),J=i(300),$=i(301),tt=i(31),et=i(9),it=i(498),at=i(260),rt=i(50),st=i(499),nt=i(280),ot=i(125),lt=i(106),ht=i(500),_t=i(177),ct=i(281),dt=i(132),ut=i(7),ft=i(32),mt=i(501),pt=i(277),gt=i(550),vt=i(13),Tt=i(6),Et=i(555),St=i(2),Rt=i(278),xt=i(12),At=i(247),yt=i(27),It=i(37),Ct=i(42),Mt=i(60),Dt=i(90),bt=i(30),Lt=i(43),Ot=i(164),Pt=i(81),Nt=i(97),wt=i(10),Bt=i(556),Ft=i(559),Vt=i(179),Ut=i(562),Gt=i(563),Ht=i(285),zt=i(305),kt=i(114);class Wt{static get enablePhysics(){return rt.a._enablePhysics}static _cancelLoadByUrl(t){h.a.loader.cancelLoadByUrl(t),Wt._innerFirstLevelLoaderManager.cancelLoadByUrl(t),Wt._innerSecondLevelLoaderManager.cancelLoadByUrl(t),Wt._innerThirdLevelLoaderManager.cancelLoadByUrl(t),Wt._innerFourthLevelLoaderManager.cancelLoadByUrl(t)}static _changeWebGLSize(t,e){Nt.a.onStageResize(t,e),P.a.clientWidth=t,P.a.clientHeight=e}static __init__(t,e,i){if(n.a.isAntialias=i.isAntialias,n.a.isAlpha=i.isAlpha,n.a.premultipliedAlpha=i.premultipliedAlpha,n.a.isStencil=i.isStencil,Nt.a.enable()){Ot.a.changeWebGLSize=Wt._changeWebGLSize,It.a.is3DMode=!0,h.a.init(t,e),It.a.supportWebGLPlusRendering||(St.a.instance=wt.a.mainContext,St.a.instance.createCommandEncoder=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Et.a(this,t,e,i)}),i._multiLighting=i.enableMultiLight&&Pt.a.supportTextureFormat(Mt.a.R32G32B32A32),l.a.Shader3D=ut.a,l.a.Scene3D=F.a,l.a.MeshRenderStaticBatchManager=Y.a,l.a.MeshRenderDynamicBatchManager=X.a,l.a.SubMeshDynamicBatch=j.a,l.a.Laya3D=Wt,l.a.Matrix4x4=et.a,l.a.Physics3D=rt.a,l.a.ShadowLightType=Ht.b,Wt.enableNative3D(),i.isUseCannonPhysicsEngine&&rt.a.__cannoninit__(),rt.a.__bulletinit__(),tt.a.__init__(),q.a.__init__(),J.a.__init__(),$.a.__init__(),K.a.__init__(),k.a.__init__(),Q.a.__init__(),L.a.__init__(),Z.a.__init__(),j.a.__init__(),mt.a.__init__(),Vt.a.init(),T.a.__init__(),S.a.__init__(),E.a.__init__(),Ft.a.__init__(),lt.a.__init__(),ht.a.__init__(),G.a.__init__(),B.a.__init__(),C.a.__init__(),U.a.__init__(),zt.a.__init__(),M.a.__init__(),z.a.__init__(),d.a.__init__(),F.a.__init__(),Y.a.__init__(),v.a.__initDefine__(),f.a.__initDefine__(),m.a.__initDefine__(),x.a.__initDefine__(),A.a.__initDefine__(),H.a.__initDefine__(),p.a.__initDefine__(),y.a.__initDefine__(),D.a.__initDefine__(),g.a.__initDefine__(),b.a.__initDefine__(),R.a.__initDefine__(),O.a.__init__(),bt.a.regClass("Laya.SkyPanoramicMaterial",Ft.a),bt.a.regClass("Laya.EffectMaterial",p.a),bt.a.regClass("Laya.UnlitMaterial",A.a),bt.a.regClass("Laya.BlinnPhongMaterial",m.a),bt.a.regClass("Laya.SkyProceduralMaterial",x.a),bt.a.regClass("Laya.PBRStandardMaterial",S.a),bt.a.regClass("Laya.PBRSpecularMaterial",E.a),bt.a.regClass("Laya.SkyBoxMaterial",R.a),bt.a.regClass("Laya.WaterPrimaryMaterial",y.a),bt.a.regClass("Laya.ExtendTerrainMaterial",g.a),bt.a.regClass("Laya.ShurikenParticleMaterial",D.a),bt.a.regClass("Laya.TrailMaterial",H.a),bt.a.regClass("Laya.PhysicsCollider",st.a),bt.a.regClass("Laya.Rigidbody3D",ot.a),bt.a.regClass("Laya.CharacterController",at.a),bt.a.regClass("Laya.Animator",c.a),bt.a.regClass("PhysicsCollider",st.a),bt.a.regClass("CharacterController",at.a),bt.a.regClass("Animator",c.a),bt.a.regClass("Rigidbody3D",ot.a),bt.a.regClass("FixedConstraint",Ut.a),bt.a.regClass("ConfigurableConstraint",Gt.a),b.a.defaultMaterial=new b.a,m.a.defaultMaterial=new m.a,p.a.defaultMaterial=new p.a,A.a.defaultMaterial=new A.a,D.a.defaultMaterial=new D.a,H.a.defaultMaterial=new H.a,x.a.defaultMaterial=new x.a,R.a.defaultMaterial=new R.a,y.a.defaultMaterial=new y.a,b.a.defaultMaterial.lock=!0,m.a.defaultMaterial.lock=!0,p.a.defaultMaterial.lock=!0,A.a.defaultMaterial.lock=!0,D.a.defaultMaterial.lock=!0,H.a.defaultMaterial.lock=!0,x.a.defaultMaterial.lock=!0,R.a.defaultMaterial.lock=!0,y.a.defaultMaterial.lock=!0,Ct.a.__init__(),dt.a.__init__(),_t.a.__init__(),ct.a.__init__(),N.a.__init__(),w.a.__init__(),W.b.__init__(),kt.a.__init__();var a=At.a.createMap;a.lh=[Wt.HIERARCHY,gt.a._parse],a.ls=[Wt.HIERARCHY,gt.a._parseScene],a.lm=[Wt.MESH,Bt.a._parse],a.lmat=[Wt.MATERIAL,v.a._parse],a.jpg=[Wt.TEXTURE2D,Ct.a._parse],a.jpeg=[Wt.TEXTURE2D,Ct.a._parse],a.bmp=[Wt.TEXTURE2D,Ct.a._parse],a.gif=[Wt.TEXTURE2D,Ct.a._parse],a.png=[Wt.TEXTURE2D,Ct.a._parse],a.dds=[Wt.TEXTURE2D,Ct.a._parse],a.ktx=[Wt.TEXTURE2D,Ct.a._parse],a.pvr=[Wt.TEXTURE2D,Ct.a._parse],a.lani=[Wt.ANIMATIONCLIP,_.a._parse],a.lav=[Wt.AVATAR,u.a._parse],a.ltc=[Wt.TEXTURECUBE,dt.a._parse],a.ltcb=[Wt.TEXTURECUBEBIN,dt.a._parseBin],a["ltcb.ls"]=[Wt.TEXTURECUBEBIN,dt.a._parseBin],a["lanit.ls"]=[Wt.TEXTURE2D,Ct.a._SimpleAnimatorTextureParse];var r=xt.a.parserMap;r[Wt.HIERARCHY]=Wt._loadHierarchy,r[Wt.MESH]=Wt._loadMesh,r[Wt.MATERIAL]=Wt._loadMaterial,r[Wt.TEXTURECUBE]=Wt._loadTextureCube,r[Wt.TEXTURECUBEBIN]=Wt._loadTextureCubeBin,r[Wt.TEXTURE2D]=Wt._loadTexture2D,r[Wt.ANIMATIONCLIP]=Wt._loadAnimationClip,r[Wt.AVATAR]=Wt._loadAvatar,r[Wt.SIMPLEANIMATORBIN]=Wt._loadSimpleAnimator,Wt._innerFirstLevelLoaderManager.on(Tt.a.ERROR,null,Wt._eventLoadManagerError),Wt._innerSecondLevelLoaderManager.on(Tt.a.ERROR,null,Wt._eventLoadManagerError),Wt._innerThirdLevelLoaderManager.on(Tt.a.ERROR,null,Wt._eventLoadManagerError),Wt._innerFourthLevelLoaderManager.on(Tt.a.ERROR,null,Wt._eventLoadManagerError)}else alert("Laya3D init error,must support webGL!")}static enableNative3D(){var t=ft.a,e=pt.a;V.a,u.a,W.b,I.a;It.a.supportWebGLPlusRendering&&(t.prototype._initData=t.prototype._initDataForNative,t.prototype.setBool=t.prototype.setBoolForNative,t.prototype.getBool=t.prototype.getBoolForNative,t.prototype.setInt=t.prototype.setIntForNative,t.prototype.getInt=t.prototype.getIntForNative,t.prototype.setNumber=t.prototype.setNumberForNative,t.prototype.getNumber=t.prototype.getNumberForNative,t.prototype.setVector=t.prototype.setVectorForNative,t.prototype.getVector=t.prototype.getVectorForNative,t.prototype.setVector2=t.prototype.setVector2ForNative,t.prototype.getVector2=t.prototype.getVector2ForNative,t.prototype.setVector3=t.prototype.setVector3ForNative,t.prototype.getVector3=t.prototype.getVector3ForNative,t.prototype.setQuaternion=t.prototype.setQuaternionForNative,t.prototype.getQuaternion=t.prototype.getQuaternionForNative,t.prototype.setMatrix4x4=t.prototype.setMatrix4x4ForNative,t.prototype.getMatrix4x4=t.prototype.getMatrix4x4ForNative,t.prototype.setBuffer=t.prototype.setBufferForNative,t.prototype.getBuffer=t.prototype.getBufferForNative,t.prototype.setTexture=t.prototype.setTextureForNative,t.prototype.getTexture=t.prototype.getTextureForNative,t.prototype.setAttribute=t.prototype.setAttributeForNative,t.prototype.getAttribute=t.prototype.getAttributeForNative,t.prototype.cloneTo=t.prototype.cloneToForNative,t.prototype.getData=t.prototype.getDataForNative,e.prototype._uniformMatrix2fv=e.prototype._uniformMatrix2fvForNative,e.prototype._uniformMatrix3fv=e.prototype._uniformMatrix3fvForNative,e.prototype._uniformMatrix4fv=e.prototype._uniformMatrix4fvForNative,Rt.a.uploadShaderUniforms=Rt.a.uploadShaderUniformsForNative)}static formatRelativePath(t,e){var i;if(i=t+e,"."===e.charAt(0)){for(var a=i.split("/"),r=0,s=a.length;r<s;r++)if(".."==a[r]){var n=r-1;n>0&&".."!==a[n]&&(a.splice(n,2),r-=2)}i=a.join("/")}return i}static _endLoad(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(i)for(var a=0,r=i.length;a<r;a++){var s=xt.a.getRes(i[a]);s&&s._removeReference()}t.endLoad(e)}static _eventLoadManagerError(t){h.a.loader.event(Tt.a.ERROR,t)}static _addHierarchyInnerUrls(t,e,i,a,r,s){let n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;var l=Wt.formatRelativePath(a,r);return i&&(l+=i),t.push({url:l,type:s,constructParams:n,propertyParams:o}),e.push(l),l}static _getSprite3DHierarchyInnerUrls(t,e,i,a,r,s,n,o){var l,h,_=t.props;switch(t.type){case"Scene3D":var c=_.lightmaps;for(l=0,h=c.length;l<h;l++){var d=c[l];if(d.path)d.path=Wt._addHierarchyInnerUrls(r,s,n,o,d.path,Wt.TEXTURE2D,d.constructParams,d.propertyParams);else{var u=d.color;u.path=Wt._addHierarchyInnerUrls(r,s,n,o,u.path,Wt.TEXTURE2D,u.constructParams,u.propertyParams);var f=d.direction;f&&(f.path=Wt._addHierarchyInnerUrls(r,s,n,o,f.path,Wt.TEXTURE2D,f.constructParams,f.propertyParams))}}var m=_.reflectionTexture;m&&(_.reflection=Wt._addHierarchyInnerUrls(a,s,n,o,m,Wt.TEXTURECUBE));var p=_.reflection;if(p&&(_.reflection=Wt._addHierarchyInnerUrls(r,s,n,o,p,Wt.TEXTURECUBEBIN)),_.sky){var g=_.sky.material;g&&(g.path=Wt._addHierarchyInnerUrls(i,s,n,o,g.path,Wt.MATERIAL))}break;case"Camera":var v=_.skyboxMaterial;v&&(v.path=Wt._addHierarchyInnerUrls(i,s,n,o,v.path,Wt.MATERIAL));break;case"TrailSprite3D":case"MeshSprite3D":case"SkinnedMeshSprite3D":case"SimpleSkinnedMeshSprite3D":var T=_.meshPath;T&&(_.meshPath=Wt._addHierarchyInnerUrls(e,s,n,o,T,Wt.MESH));var E=_.materials;if(E)for(l=0,h=E.length;l<h;l++)E[l].path=Wt._addHierarchyInnerUrls(i,s,n,o,E[l].path,Wt.MATERIAL);"SimpleSkinnedMeshSprite3D"==t.type&&_.animatorTexture&&(_.animatorTexture=Wt._addHierarchyInnerUrls(r,s,n,o,_.animatorTexture,Wt.SIMPLEANIMATORBIN));break;case"ShuriKenParticle3D":if(_.main){var S=_.renderer.resources,R=S.mesh,x=S.material;R&&(S.mesh=Wt._addHierarchyInnerUrls(e,s,n,o,R,Wt.MESH)),x&&(S.material=Wt._addHierarchyInnerUrls(i,s,n,o,x,Wt.MATERIAL))}else{var A=_.meshPath;A&&(_.meshPath=Wt._addHierarchyInnerUrls(e,s,n,o,A,Wt.MESH)),_.material.path=Wt._addHierarchyInnerUrls(i,s,n,o,_.material.path,Wt.MATERIAL)}break;case"Terrain":Wt._addHierarchyInnerUrls(r,s,n,o,_.dataPath,Wt.TERRAINRES);break;case"ReflectionProbe":var y=_.reflection;y&&(_.reflection=Wt._addHierarchyInnerUrls(e,s,n,o,y,Wt.TEXTURECUBEBIN))}var I=t.components;if(I)for(var C=0,M=I.length;C<M;C++){var D=I[C];switch(D.type){case"Animator":D.avatarPath;var b=D.avatar;b&&(b.path=Wt._addHierarchyInnerUrls(r,s,n,o,b.path,Wt.AVATAR));var L=D.clipPaths;if(L)for(l=0,h=L.length;l<h;l++)L[l]=Wt._addHierarchyInnerUrls(r,s,n,o,L[l],Wt.ANIMATIONCLIP);else{var O=D.layers;for(l=0;l<O.length;l++)for(var P=O[l].states,N=0,w=P.length;N<w;N++){var B=P[N].clipPath;B&&(P[N].clipPath=Wt._addHierarchyInnerUrls(r,s,n,o,B,Wt.ANIMATIONCLIP))}}break;case"PhysicsCollider":case"Rigidbody3D":case"CharacterController":var F=D.shapes;for(l=0;l<F.length;l++){var V=F[l];if("MeshColliderShape"===V.type)(R=V.mesh)&&(V.mesh=Wt._addHierarchyInnerUrls(e,s,n,o,R,Wt.MESH))}}}var U=t.child;for(l=0,h=U.length;l<h;l++)Wt._getSprite3DHierarchyInnerUrls(U[l],e,i,a,r,s,n,o)}static _loadHierarchy(t){t._originType=t.type,t.on(Tt.a.LOADED,null,Wt._onHierarchylhLoaded,[t]),t.load(t.url,xt.a.JSON,!1,null,!0)}static _onHierarchylhLoaded(t,e){var i=t.url,a=vt.a.getURLVerion(i),r=yt.a.getPath(i),s=[],n=[],o=[],l=[],h=[];Wt._getSprite3DHierarchyInnerUrls(e.data,s,n,o,l,h,a,r);var _=s.length+n.length+l.length,c=_+1,d=1/c;if(Wt._onProcessChange(t,0,d,1),l.length>0){var u=_/c,f=Lt.a.create(null,Wt._onProcessChange,[t,d,u],!1);Wt._innerFourthLevelLoaderManager._create(l,!1,Lt.a.create(null,Wt._onHierarchyInnerForthLevResouLoaded,[t,f,e,h,s,n,o,d+u*l.length,u]),f,null,null,null,1,!0)}else Wt._onHierarchyInnerForthLevResouLoaded(t,null,e,h,s,n,o,d,u)}static _onHierarchyInnerForthLevResouLoaded(t,e,i,a,r,s,n,o,l){if(e&&e.recover(),n.length>0){var h=Lt.a.create(null,Wt._onProcessChange,[t,o,l],!1);Wt._innerThirdLevelLoaderManager._create(n,!1,Lt.a.create(null,Wt._onHierarchyInnerThirdLevResouLoaded,[t,h,i,a,r,s,o+l*s.length,l]),e,null,null,null,1,!0)}else Wt._onHierarchyInnerThirdLevResouLoaded(t,null,i,a,r,s,o,l)}static _onHierarchyInnerThirdLevResouLoaded(t,e,i,a,r,s,n,o){if(e&&e.recover(),s.length>0){var l=Lt.a.create(null,Wt._onProcessChange,[t,n,o],!1);Wt._innerSecondLevelLoaderManager._create(s,!1,Lt.a.create(null,Wt._onHierarchyInnerSecondLevResouLoaded,[t,l,i,a,r,n+o*s.length,o]),e,null,null,null,1,!0)}else Wt._onHierarchyInnerSecondLevResouLoaded(t,null,i,a,r,n,o)}static _onHierarchyInnerSecondLevResouLoaded(t,e,i,a,r,s,n){if(e&&e.recover(),r.length>0){var o=Lt.a.create(null,Wt._onProcessChange,[t,s,n],!1);Wt._innerFirstLevelLoaderManager._create(r,!1,Lt.a.create(null,Wt._onHierarchyInnerFirstLevResouLoaded,[t,o,i,a]),e,null,null,null,1,!0)}else Wt._onHierarchyInnerFirstLevResouLoaded(t,null,i,a)}static _onHierarchyInnerFirstLevResouLoaded(t,e,i,a){e&&e.recover(),t._cache=t._createCache;var r="Scene3D"===i.data.type?gt.a._parseScene(i,t._propertyParams,t._constructParams):gt.a._parse(i,t._propertyParams,t._constructParams);Wt._endLoad(t,r,a)}static _loadMesh(t){t.on(Tt.a.LOADED,null,Wt._onMeshLmLoaded,[t]),t.load(t.url,xt.a.BUFFER,!1,null,!0)}static _onMeshLmLoaded(t,e){t._cache=t._createCache;var i=Bt.a._parse(e,t._propertyParams,t._constructParams);Wt._endLoad(t,i)}static _loadMaterial(t){t.on(Tt.a.LOADED,null,Wt._onMaterilLmatLoaded,[t]),t.load(t.url,xt.a.JSON,!1,null,!0)}static _onMaterilLmatLoaded(t,e){var i,a=t.url,r=vt.a.getURLVerion(a),s=yt.a.getPath(a),n=[],o=[];e.customProps;switch(e.version){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":var l,h,_=e.props.textures;if(_)for(l=0,h=_.length;l<h;l++){var c=_[l],d=c.path;d&&(i=Wt.formatRelativePath(s,d),r&&(i+=r),n.push({url:i,constructParams:c.constructParams,propertyParams:c.propertyParams}),o.push(i),c.path=i)}break;default:throw new Error("Laya3D:unkonwn version.")}var u=n.length,f=u+1,m=1/f;if(Wt._onProcessChange(t,0,m,1),u>0){var p=Lt.a.create(null,Wt._onProcessChange,[t,m,u/f],!1);Wt._innerFourthLevelLoaderManager._create(n,!1,Lt.a.create(null,Wt._onMateialTexturesLoaded,[t,p,e,o]),p,null,null,null,1,!0)}else Wt._onMateialTexturesLoaded(t,null,e,null)}static _onMateialTexturesLoaded(t,e,i,a){t._cache=t._createCache;var r=v.a._parse(i,t._propertyParams,t._constructParams);Wt._endLoad(t,r,a),e&&e.recover()}static _loadAvatar(t){t.on(Tt.a.LOADED,null,function(e){t._cache=t._createCache;var i=u.a._parse(e,t._propertyParams,t._constructParams);Wt._endLoad(t,i)}),t.load(t.url,xt.a.JSON,!1,null,!0)}static _loadSimpleAnimator(t){t.on(Tt.a.LOADED,null,function(e){t._cache=t._createCache;var i=Ct.a._SimpleAnimatorTextureParse(e,t._propertyParams,t._constructParams);Wt._endLoad(t,i)}),t.load(t.url,xt.a.BUFFER,!1,null,!0)}static _loadAnimationClip(t){t.on(Tt.a.LOADED,null,function(e){t._cache=t._createCache;var i=_.a._parse(e,t._propertyParams,t._constructParams);Wt._endLoad(t,i)}),t.load(t.url,xt.a.BUFFER,!1,null,!0)}static _loadTexture2D(t){var e,i=t.url,a=i.lastIndexOf(".")+1,r=i.indexOf("?"),s=-1==r?i.length:r;switch(i.substr(a,s-a)){case"jpg":case"jpeg":case"bmp":case"gif":case"png":e="nativeimage";break;case"dds":case"ktx":case"pvr":e=xt.a.BUFFER}t.on(Tt.a.LOADED,null,function(e){t._cache=t._createCache;var i=Ct.a._parse(e,t._propertyParams,t._constructParams);Wt._endLoad(t,i)}),t.load(t.url,e,!1,null,!0)}static _loadTextureCube(t){t.on(Tt.a.LOADED,null,Wt._onTextureCubeLtcLoaded,[t]),t.load(t.url,xt.a.JSON,!1,null,!0)}static _loadTextureCubeBin(t){t.on(Tt.a.LOADED,null,e=>{t._cache=t._createCache;var i=new Dt.a(e);if("LAYATEXTURECUBE:0000"!==i.readUTFString())throw"Laya3D:unknow version.";var a=i.readUint8(),r=i.getUint8(),s=i.readUint16(),n=i.getUint8(),o=i.getUint8(),l=i.getUint8(),h=i.getUint8(),_=new dt.a(s,a,r>1);_.filterMode=n,_.wrapModeU=o,_.wrapModeV=l,_.anisoLevel=h;for(var c=i.pos,d=s,u=0;u<r;u++){for(var f=new Array(6),m=d*d*_._getFormatByteCount(),p=0;p<6;p++)f[p]=new Uint8Array(e,c,m),c+=m;_.setSixSidePixels(f,u),d/=2}Wt._endLoad(t,_)}),t.load(t.url,xt.a.BUFFER,!1,null,!0)}static _onTextureCubeLtcLoaded(t,e){var i=yt.a.getPath(t.url),a=[Wt.formatRelativePath(i,e.front),Wt.formatRelativePath(i,e.back),Wt.formatRelativePath(i,e.left),Wt.formatRelativePath(i,e.right),Wt.formatRelativePath(i,e.up),Wt.formatRelativePath(i,e.down)];Wt._onProcessChange(t,0,1/7,1);var r=Lt.a.create(null,Wt._onProcessChange,[t,1/7,6/7],!1);Wt._innerFourthLevelLoaderManager.load(a,Lt.a.create(null,Wt._onTextureCubeImagesLoaded,[t,a,r]),r,"nativeimage")}static _onTextureCubeImagesLoaded(t,e,i){for(var a=new Array(6),r=0;r<6;r++)a[r]=xt.a.getRes(e[r]);t._cache=t._createCache;var s=dt.a._parse(a,t._propertyParams,t._constructParams);for(i.recover(),r=0;r<6;r++)xt.a.clearRes(e[r]);Wt._endLoad(t,s)}static _onProcessChange(t,e,i,a){(a=e+a*i)<1&&t.event(Tt.a.PROGRESS,2*a/3+1/3)}static init(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(Wt._isInit)a&&a.run();else{Wt._isInit=!0,i&&i.cloneTo(o.a._config),i=o.a._config,W.b.debugFrustumCulling=i.debugFrustumCulling,Wt._editerEnvironment=i._editerEnvironment,F.a.octreeCulling=i.octreeCulling,F.a.octreeInitialSize=i.octreeInitialSize,F.a.octreeInitialCenter=i.octreeInitialCenter,F.a.octreeMinNodeSize=i.octreeMinNodeSize,F.a.octreeLooseness=i.octreeLooseness;var r=window.Physics3D;null==r||i.isUseCannonPhysicsEngine?(rt.a._enablePhysics=!1,Wt.__init__(t,e,i),a&&a.run()):(rt.a._enablePhysics=!0,r(16*i.defaultPhysicsMemory,it.a._interactive).then(function(){Wt.__init__(t,e,i),a&&a.run()}))}}constructor(){}}e.a=Wt,s()(Wt,"HIERARCHY","HIERARCHY"),s()(Wt,"MESH","MESH"),s()(Wt,"MATERIAL","MATERIAL"),s()(Wt,"TEXTURE2D","TEXTURE2D"),s()(Wt,"TEXTURECUBE","TEXTURECUBE"),s()(Wt,"TEXTURECUBEBIN","TEXTURECUBEBIN"),s()(Wt,"ANIMATIONCLIP","ANIMATIONCLIP"),s()(Wt,"AVATAR","AVATAR"),s()(Wt,"TERRAINHEIGHTDATA","TERRAINHEIGHTDATA"),s()(Wt,"TERRAINRES","TERRAIN"),s()(Wt,"SIMPLEANIMATORBIN","SIMPLEANIMATOR"),s()(Wt,"_innerFirstLevelLoaderManager",new At.a),s()(Wt,"_innerSecondLevelLoaderManager",new At.a),s()(Wt,"_innerThirdLevelLoaderManager",new At.a),s()(Wt,"_innerFourthLevelLoaderManager",new At.a),s()(Wt,"_isInit",!1),s()(Wt,"_editerEnvironment",!1),s()(Wt,"physicsSettings",new nt.a),window.Laya3D=Wt},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(123);class n extends s.a{get radius(){return this._radius}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;super(),r()(this,"_radius",void 0),this._radius=t,this._type=s.a.SHAPETYPES_SPHERE,this._btShape=new CANNON.Sphere(t)}_setScale(t){var e=Math.max(t.x,t.y,t.z);this._scale.setValue(e,e,e),this._btShape.radius=e*this.radius,this._btShape.updateBoundingSphereRadius()}clone(){var t=new n(this._radius);return this.cloneTo(t),t}}e.a=n},function(t,e,i){"use strict";var a=i(52);e.a=class extends a.a{constructor(){super()}add(t){if(-1!==t._inPhysicUpdateListIndex)throw"PhysicsUpdateList:element has  in  PhysicsUpdateList.";this._add(t),t._inPhysicUpdateListIndex=this.length++}remove(t){var e=t._inPhysicUpdateListIndex;if(this.length--,e!==this.length){var i=this.elements[this.length];this.elements[e]=i,i._inPhysicUpdateListIndex=e}t._inPhysicUpdateListIndex=-1}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(401),n=i(402),o=i(403);e.a=class{constructor(){r()(this,"_hitResultsPoolIndex",0),r()(this,"_hitResultsPool",[]),r()(this,"_contactPonintsPoolIndex",0),r()(this,"_contactPointsPool",[]),r()(this,"_collisionsPool",[]),r()(this,"_collisions",{})}getHitResult(){var t=this._hitResultsPool[this._hitResultsPoolIndex++];return t||(t=new n.a,this._hitResultsPool.push(t)),t}recoverAllHitResultsPool(){this._hitResultsPoolIndex=0}getContactPoints(){var t=this._contactPointsPool[this._contactPonintsPoolIndex++];return t||(t=new s.a,this._contactPointsPool.push(t)),t}recoverAllContactPointsPool(){this._contactPonintsPoolIndex=0}getCollision(t,e){var i,a=t.id,r=e.id,s=this._collisions[a];return s&&(i=s[r]),i||(s||(s={},this._collisions[a]=s),(i=0===this._collisionsPool.length?new o.a:this._collisionsPool.pop())._colliderA=t,i._colliderB=e,s[r]=i),i}recoverCollision(t){var e=t._colliderA.id,i=t._colliderB.id;this._collisions[e][i]=null,this._collisionsPool.push(t)}garbageCollection(){for(var t in this._hitResultsPoolIndex=0,this._hitResultsPool.length=0,this._contactPonintsPoolIndex=0,this._contactPointsPool.length=0,this._collisionsPool.length=0,this._collisionsPool){var e=this._collisionsPool[t],i=!0;for(var a in e)e[a]?i=!1:delete e[a];i&&delete this._collisionsPool[t]}}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1);e.a=class{constructor(){r()(this,"_idCounter",0),r()(this,"_id",void 0),r()(this,"colliderA",null),r()(this,"colliderB",null),r()(this,"distance",0),r()(this,"normal",new s.a),r()(this,"positionOnA",new s.a),r()(this,"positionOnB",new s.a),this._id=++this._idCounter}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1);e.a=class{constructor(){r()(this,"succeeded",!1),r()(this,"collider",null),r()(this,"point",new s.a),r()(this,"normal",new s.a),r()(this,"hitFraction",0)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){r()(this,"_lastUpdateFrame",-2147483648),r()(this,"_updateFrame",-2147483648),r()(this,"_isTrigger",!1),r()(this,"_colliderA",void 0),r()(this,"_colliderB",void 0),r()(this,"contacts",[]),r()(this,"other",void 0)}_setUpdateFrame(t){this._lastUpdateFrame=this._updateFrame,this._updateFrame=t}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1),n=i(51),o=i(405);class l extends o.a{static __init__(){l._btTempVector30=new CANNON.Vec3,l._btTempVector31=new CANNON.Vec3}get mass(){return this._mass}set mass(t){t=Math.max(t,1e-7),this._mass=t,this._isKinematic||this._updateMass(t)}get isKinematic(){return this._isKinematic}set isKinematic(t){this._isKinematic=t,this._controlBySimulation=!t;var e=!!(this._simulation&&this._enabled&&this._colliderShape);e&&this._removeFromSimulation();var i=this._btColliderObject,a=i.type;t?(a|=CANNON.Body.KINEMATIC,i.type=a,this._enableProcessCollisions=!1,this._updateMass(0)):((a&CANNON.Body.KINEMATIC)>0&&(a^=CANNON.Body.KINEMATIC),i.allowSleep=!0,i.type=a,this._enableProcessCollisions=!0,this._updateMass(this._mass)),i.velocity.set(0,0,0),i.angularVelocity.set(0,0,0),e&&this._addToSimulation()}get linearDamping(){return this._linearDamping}set linearDamping(t){this._linearDamping=t,this._btColliderObject&&(this._btColliderObject.linearDamping=t)}get angularDamping(){return this._angularDamping}set angularDamping(t){this._angularDamping=t,this._btColliderObject&&(this._btColliderObject.angularDamping=t)}get totalForce(){if(this._btColliderObject){var t=this.btColliderObject.force;return this.totalForce.setValue(t.x,t.y,t.z),this._totalForce}return null}get linearVelocity(){if(this._btColliderObject){var t=this.btColliderObject.velocity;this._linearVelocity.setValue(t.x,t.y,t.z)}return this._linearVelocity}set linearVelocity(t){if(this._linearVelocity=t,this._btColliderObject){var e=this.btColliderObject.velocity;this.isSleeping&&this.wakeUp(),e.set(t.x,t.y,t.z),this.btColliderObject.velocity=e}}get angularVelocity(){if(this._btColliderObject){var t=this._btColliderObject.angularVelocity;this.angularVelocity.setValue(t.x,t.y,t.z)}return this._angularVelocity}set angularVelocity(t){if(this._angularVelocity=t,this._btColliderObject){var e=this.btColliderObject.angularVelocity;this.isSleeping&&this.wakeUp(),e.set(t.x,t.y,t.z),this.btColliderObject.velocity=e}}get totalTorque(){if(this._btColliderObject){var t=this._btColliderObject.torque;return this._totalTorque.setValue(t.x,t.y,t.z),this._totalTorque}return null}get isSleeping(){return!!this._btColliderObject&&this._btColliderObject.sleepState!=CANNON.Body.AWAKE}get sleepLinearVelocity(){return this._btColliderObject.sleepSpeedLimit}set sleepLinearVelocity(t){this._btColliderObject.sleepSpeedLimit=t}get btColliderObject(){return this._btColliderObject}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.a.COLLISIONFILTERGROUP_ALLFILTER),r()(this,"_isKinematic",!1),r()(this,"_mass",1),r()(this,"_gravity",new s.a(0,-10,0)),r()(this,"_angularDamping",0),r()(this,"_linearDamping",0),r()(this,"_totalTorque",new s.a(0,0,0)),r()(this,"_totalForce",new s.a(0,0,0)),r()(this,"_linearVelocity",new s.a),r()(this,"_angularVelocity",new s.a),this._controlBySimulation=!0}_updateMass(t){this._btColliderObject&&this._colliderShape&&(this._btColliderObject.mass=t,this._btColliderObject.updateMassProperties(),this._btColliderObject.updateSolveMassProperties())}_onScaleChange(t){super._onScaleChange(t),this._updateMass(this._isKinematic?0:this._mass)}_derivePhysicsTransformation(t){this._innerDerivePhysicsTransformation(this.btColliderObject,t)}_onAdded(){var t=new CANNON.Body;t.material=new CANNON.Material,t.layaID=this.id,t.collisionFilterGroup=this.collisionGroup,t.collisionFilterMask=this._canCollideWith,this._btColliderObject=t,super._onAdded(),this.mass=this._mass,this.linearDamping=this._linearDamping,this.angularDamping=this._angularDamping,this.isKinematic=this._isKinematic,this.isKinematic?this._btColliderObject.type=CANNON.Body.KINEMATIC:this._btColliderObject.type=CANNON.Body.DYNAMIC}_onShapeChange(t){super._onShapeChange(t),this._isKinematic?this._updateMass(0):this._updateMass(this._mass)}_parse(t){null!=t.friction&&(this.friction=t.friction),null!=t.restitution&&(this.restitution=t.restitution),null!=t.isTrigger&&(this.isTrigger=t.isTrigger),null!=t.mass&&(this.mass=t.mass),null!=t.isKinematic&&(this.isKinematic=t.isKinematic),null!=t.linearDamping&&(this.linearDamping=t.linearDamping),null!=t.angularDamping&&(this.angularDamping=t.angularDamping),super._parse(t),this._parseShape(t.shapes)}_onDestroy(){super._onDestroy(),this._gravity=null,this._totalTorque=null,this._linearVelocity=null,this._angularVelocity=null}_addToSimulation(){this._simulation._addRigidBody(this)}_removeFromSimulation(){this._simulation._removeRigidBody(this)}_cloneTo(t){super._cloneTo(t);var e=t;e.isKinematic=this._isKinematic,e.mass=this._mass,e.angularDamping=this._angularDamping,e.linearDamping=this._linearDamping,e.linearVelocity=this._linearVelocity,e.angularVelocity=this._angularVelocity}applyForce(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var i=l._btTempVector30;i.set(t.x,t.y,t.z);var a=l._btTempVector31;e?a.set(e.x,e.y,e.z):a.set(0,0,0),this.btColliderObject.applyLocalForce(i,a)}applyTorque(t){if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var e=l._btTempVector30;e.set(t.x,t.y,t.z);var i=this.btColliderObject.torque;i.set(i.x+e.x,i.y+e.y,i.z+e.z),this.btColliderObject.torque=i}applyImpulse(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var i=l._btTempVector30;i.set(t.x,t.y,t.z);var a=l._btTempVector31;e?a.set(e.x,e.y,e.z):a.set(0,0,0),this.btColliderObject.applyImpulse(i,a)}wakeUp(){this._btColliderObject&&this._btColliderObject.wakeUp()}clearForces(){var t=this._btColliderObject;if(null==t)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";t.velocity.set(0,0,0),t.velocity=t.velocity,t.angularVelocity.set(0,0,0),t.angularVelocity=t.angularVelocity}}e.a=l,r()(l,"TYPE_STATIC",0),r()(l,"TYPE_DYNAMIC",1),r()(l,"TYPE_KINEMATIC",2),r()(l,"_BT_DISABLE_WORLD_GRAVITY",1),r()(l,"_BT_ENABLE_GYROPSCOPIC_FORCE",2),r()(l,"_btTempVector30",void 0),r()(l,"_btTempVector31",void 0)},function(t,e,i){"use strict";var a=i(406);e.a=class extends a.a{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1),this._enableProcessCollisions=!1}_addToSimulation(){this._simulation._addPhysicsCollider(this)}_removeFromSimulation(){this._simulation._removePhysicsCollider(this)}_parse(t){null!=t.friction&&(this.friction=t.friction),null!=t.restitution&&(this.restitution=t.restitution),null!=t.isTrigger&&(this.isTrigger=t.isTrigger),super._parse(t),this._parseShape(t.shapes)}_onAdded(){this._btColliderObject=new CANNON.Body,this._btColliderObject.material=new CANNON.Material,this._btColliderObject.layaID=this._id,this._btColliderObject.type=CANNON.Body.STATIC,this._btColliderObject.collisionFilterGroup=this._collisionGroup,this._btColliderObject.collisionFilterMask=this._canCollideWith,super._onAdded()}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(124);e.a=class extends s.a{get isTrigger(){return this._isTrigger}set isTrigger(t){if(this._isTrigger=t,this._btColliderObject)if(this._btColliderObject.isTrigger=t,t){var e=this._btColliderObject.type;this._btColliderObject.collisionResponse=!1,0==(e&CANNON.Body.STATIC)&&(this._btColliderObject.type|=CANNON.Body.STATIC)}else this._btColliderObject.collisionResponse=!0,0!=(e&CANNON.Body.STATIC)&&(this._btColliderObject.type^=CANNON.Body.STATIC)}constructor(t,e){super(t,e),r()(this,"_isTrigger",!1)}_onAdded(){super._onAdded(),this.isTrigger=this._isTrigger}_cloneTo(t){super._cloneTo(t),t.isTrigger=this._isTrigger}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(53),n=i(11);class o extends s.a{static __init__(){o._btNormal=n.a.Physics3D._bullet.btVector3_create(0,0,0)}constructor(t,e){super(),r()(this,"_offset",void 0),r()(this,"_normal",void 0),this._normal=t,this._offset=e,this._type=s.a.SHAPETYPES_STATICPLANE;var i=n.a.Physics3D._bullet;i.btVector3_setValue(o._btNormal,-t.x,t.y,t.z),this._btShape=i.btStaticPlaneShape_create(o._btNormal,e)}clone(){var t=new o(this._normal,this._offset);return this.cloneTo(t),t}}e.a=o,r()(o,"_btNormal",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1),n=i(53),o=i(11);class l extends n.a{get radius(){return this._radius}get length(){return this._length}get orientation(){return this._orientation}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.25,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.a.SHAPEORIENTATION_UPY;super(),r()(this,"_radius",void 0),r()(this,"_length",void 0),r()(this,"_orientation",void 0),this._radius=t,this._length=e,this._orientation=i,this._type=n.a.SHAPETYPES_CAPSULE;var a=o.a.Physics3D._bullet;switch(i){case n.a.SHAPEORIENTATION_UPX:this._btShape=a.btCapsuleShapeX_create(t,e-2*t);break;case n.a.SHAPEORIENTATION_UPY:this._btShape=a.btCapsuleShape_create(t,e-2*t);break;case n.a.SHAPEORIENTATION_UPZ:this._btShape=a.btCapsuleShapeZ_create(t,e-2*t);break;default:throw"CapsuleColliderShape:unknown orientation."}}_setScale(t){var e=l._tempVector30;switch(this.orientation){case n.a.SHAPEORIENTATION_UPX:e.x=t.x,e.y=e.z=Math.max(t.y,t.z);break;case n.a.SHAPEORIENTATION_UPY:e.y=t.y,e.x=e.z=Math.max(t.x,t.z);break;case n.a.SHAPEORIENTATION_UPZ:e.z=t.z,e.x=e.y=Math.max(t.x,t.y);break;default:throw"CapsuleColliderShape:unknown orientation."}super._setScale(e)}clone(){var t=new l(this._radius,this._length,this._orientation);return this.cloneTo(t),t}}e.a=l,r()(l,"_tempVector30",new s.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(53),n=i(11);class o extends s.a{get radius(){return this._radius}get height(){return this._height}get orientation(){return this._orientation}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.a.SHAPEORIENTATION_UPY;super(),r()(this,"_orientation",void 0),r()(this,"_radius",1),r()(this,"_height",.5),this._radius=t,this._height=e,this._orientation=i,this._type=s.a.SHAPETYPES_CYLINDER;var a=n.a.Physics3D._bullet;switch(i){case s.a.SHAPEORIENTATION_UPX:this._btShape=a.btConeShapeX_create(t,e);break;case s.a.SHAPEORIENTATION_UPY:this._btShape=a.btConeShape_create(t,e);break;case s.a.SHAPEORIENTATION_UPZ:this._btShape=a.btConeShapeZ_create(t,e);break;default:throw"ConeColliderShape:unknown orientation."}}clone(){var t=new o(this._radius,this._height,this._orientation);return this.cloneTo(t),t}}e.a=o},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(53),n=i(11);class o extends s.a{get mesh(){return this._mesh}set mesh(t){if(this._mesh!==t){var e=n.a.Physics3D._bullet;this._mesh&&e.btCollisionShape_destroy(this._btShape),t&&(this._btShape=e.btGImpactMeshShape_create(t._getPhysicMesh()),e.btGImpactShapeInterface_updateBound(this._btShape)),this._mesh=t}}get convex(){return this._convex}set convex(t){this._convex=t}constructor(){super(),r()(this,"_mesh",null),r()(this,"_convex",!1)}_setScale(t){if(this._compoundParent)this.updateLocalTransformations();else{var e=n.a.Physics3D._bullet;e.btVector3_setValue(s.a._btScale,t.x,t.y,t.z),e.btCollisionShape_setLocalScaling(this._btShape,s.a._btScale),e.btGImpactShapeInterface_updateBound(this._btShape)}}cloneTo(t){var e=t;e.convex=this._convex,e.mesh=this._mesh,super.cloneTo(t)}clone(){var t=new o;return this.cloneTo(t),t}destroy(){this._btShape&&(n.a.Physics3D._bullet.btCollisionShape_destroy(this._btShape),this._btShape=null)}}e.a=o},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(53),n=i(11);class o extends s.a{get radius(){return this._radius}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;super(),r()(this,"_radius",void 0),this._radius=t,this._type=s.a.SHAPETYPES_SPHERE,this._btShape=n.a.Physics3D._bullet.btSphereShape_create(t)}clone(){var t=new o(this._radius);return this.cloneTo(t),t}}e.a=o},function(t,e,i){"use strict";var a=i(52);e.a=class extends a.a{constructor(){super()}add(t){if(-1!==t._inPhysicUpdateListIndex)throw"PhysicsUpdateList:element has  in  PhysicsUpdateList.";this._add(t),t._inPhysicUpdateListIndex=this.length++}remove(t){var e=t._inPhysicUpdateListIndex;if(this.length--,e!==this.length){var i=this.elements[this.length];this.elements[e]=i,i._inPhysicUpdateListIndex=e}t._inPhysicUpdateListIndex=-1}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(414),n=i(259),o=i(415);e.a=class{constructor(){r()(this,"_hitResultsPoolIndex",0),r()(this,"_hitResultsPool",[]),r()(this,"_contactPonintsPoolIndex",0),r()(this,"_contactPointsPool",[]),r()(this,"_collisionsPool",[]),r()(this,"_collisions",{})}getHitResult(){var t=this._hitResultsPool[this._hitResultsPoolIndex++];return t||(t=new n.a,this._hitResultsPool.push(t)),t}recoverAllHitResultsPool(){this._hitResultsPoolIndex=0}getContactPoints(){var t=this._contactPointsPool[this._contactPonintsPoolIndex++];return t||(t=new s.a,this._contactPointsPool.push(t)),t}recoverAllContactPointsPool(){this._contactPonintsPoolIndex=0}getCollision(t,e){var i,a=t.id,r=e.id,s=this._collisions[a];return s&&(i=s[r]),i||(s||(s={},this._collisions[a]=s),(i=0===this._collisionsPool.length?new o.a:this._collisionsPool.pop())._colliderA=t,i._colliderB=e,s[r]=i),i}recoverCollision(t){var e=t._colliderA.id,i=t._colliderB.id;this._collisions[e][i]=null,this._collisionsPool.push(t)}garbageCollection(){for(var t in this._hitResultsPoolIndex=0,this._hitResultsPool.length=0,this._contactPonintsPoolIndex=0,this._contactPointsPool.length=0,this._collisionsPool.length=0,this._collisionsPool){var e=this._collisionsPool[t],i=!0;for(var a in e)e[a]?i=!1:delete e[a];i&&delete this._collisionsPool[t]}}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1);e.a=class{constructor(){r()(this,"_idCounter",0),r()(this,"_id",void 0),r()(this,"colliderA",null),r()(this,"colliderB",null),r()(this,"distance",0),r()(this,"normal",new s.a),r()(this,"positionOnA",new s.a),r()(this,"positionOnB",new s.a),this._id=++this._idCounter}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){r()(this,"_lastUpdateFrame",-2147483648),r()(this,"_updateFrame",-2147483648),r()(this,"_isTrigger",!1),r()(this,"_colliderA",void 0),r()(this,"_colliderB",void 0),r()(this,"contacts",[]),r()(this,"other",void 0)}_setUpdateFrame(t){this._lastUpdateFrame=this._updateFrame,this._updateFrame=t}}},function(t,e,i){"use strict";var a=i(60);e.a=class{constructor(){}static lightAttenTexture(t,e,i,a,r,s){var n=t/i,o=1/(1+25*n);n>=.64&&(n>1?o=0:o*=1-(n-.64)/.36),s[r]=Math.floor(255*o+.5)}static haloTexture(t,e,i,a,r,s){var n=(t-(i>>=1))/i,o=(e-(a>>=1))/a,l=n*n+o*o;l>1&&(l=1),s[r]=Math.floor(255*(1-l)+.5)}static _generateTexture2D(t,e,i,r){var s=0,n=0;switch(t.format){case a.a.R8G8B8:n=3;break;case a.a.R8G8B8A8:n=4;break;case a.a.Alpha8:n=1;break;default:throw"GeneratedTexture._generateTexture: unkonw texture format."}for(var o=new Uint8Array(e*i*n),l=0;l<i;l++)for(var h=0;h<e;h++)r(h,l,e,i,s,o),s+=n;t.setPixels(o)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(418),n=i(419),o=i(420),l=i(24),h=i(13),_=i(2),c=i(17),d=i(90),u=i(3);class f extends c.a{static _parse(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];var e=new f,i=new d.a(t),a=i.readUTFString();switch(a){case"LAYAANIMATION:03":s.a.parse(e,i);break;case"LAYAANIMATION:04":case"LAYAANIMATION:COMPRESSION_04":n.a.parse(e,i,a);break;default:throw"unknown animationClip version."}return e}static load(t,e){u.a.loader.create(t,e,null,f.ANIMATIONCLIP)}duration(){return this._duration}constructor(){super(),r()(this,"_duration",void 0),r()(this,"_frameRate",void 0),r()(this,"_nodes",new o.a),r()(this,"_nodesDic",void 0),r()(this,"_nodesMap",void 0),r()(this,"_animationEvents",void 0),r()(this,"islooping",void 0),this._animationEvents=[]}_hermiteInterpolate(t,e,i,a){var r=t.outTangent,s=e.inTangent;if(Number.isFinite(r)&&Number.isFinite(s)){var n=i*i,o=n*i,l=o-2*n+i,h=o-n,_=-2*o+3*n;return(2*o-3*n+1)*t.value+l*r*a+h*s*a+_*e.value}return t.value}_hermiteInterpolateVector3(t,e,i,a,r){var s=t.value,n=t.outTangent,o=e.value,l=e.inTangent,h=i*i,_=h*i,c=2*_-3*h+1,d=_-2*h+i,u=_-h,f=-2*_+3*h,m=n.x,p=l.x;Number.isFinite(m)&&Number.isFinite(p)?r.x=c*s.x+d*m*a+u*p*a+f*o.x:r.x=s.x,m=n.y,p=l.y,Number.isFinite(m)&&Number.isFinite(p)?r.y=c*s.y+d*m*a+u*p*a+f*o.y:r.y=s.y,m=n.z,p=l.z,Number.isFinite(m)&&Number.isFinite(p)?r.z=c*s.z+d*m*a+u*p*a+f*o.z:r.z=s.z}_hermiteInterpolateQuaternion(t,e,i,a,r){var s=t.value,n=t.outTangent,o=e.value,l=e.inTangent,h=i*i,_=h*i,c=2*_-3*h+1,d=_-2*h+i,u=_-h,f=-2*_+3*h,m=n.x,p=l.x;Number.isFinite(m)&&Number.isFinite(p)?r.x=c*s.x+d*m*a+u*p*a+f*o.x:r.x=s.x,m=n.y,p=l.y,Number.isFinite(m)&&Number.isFinite(p)?r.y=c*s.y+d*m*a+u*p*a+f*o.y:r.y=s.y,m=n.z,p=l.z,Number.isFinite(m)&&Number.isFinite(p)?r.z=c*s.z+d*m*a+u*p*a+f*o.z:r.z=s.z,m=n.w,p=l.w,Number.isFinite(m)&&Number.isFinite(p)?r.w=c*s.w+d*m*a+u*p*a+f*o.w:r.w=s.w}_evaluateClipDatasRealTime(t,e,i,a,r,s){for(var n=0,o=t.count;n<o;n++){var _,c=t.getNodeByIndex(n),d=c.type,u=c._keyFrames,m=u.length,p=i[n];if(r)for(-1!==p&&e<u[p].time&&(p=-1,i[n]=p),_=p+1;_<m&&!(u[_].time>e);)p++,_++,i[n]=p;else for((_=p+1)!==m&&e>u[_].time&&(p=m-1,i[n]=p),_=p+1;p>-1&&!(u[p].time<e);)p--,_--,i[n]=p;var g=_===m;switch(d){case 0:if(-1!==p){var v=u[p];if(g)s[n]=v.value;else{var T,E=u[_],S=E.time-v.time;T=0!==S?(e-v.time)/S:0,s[n]=this._hermiteInterpolate(v,E,T,S)}}else s[n]=u[0].value;a&&(s[n]=s[n]-u[0].value);break;case 1:case 4:var R=s[n];if(this._evaluateFrameNodeVector3DatasRealTime(u,p,g,e,R),a){var x=u[0].value;R.x-=x.x,R.y-=x.y,R.z-=x.z}break;case 2:var A=s[n];if(this._evaluateFrameNodeQuaternionDatasRealTime(u,p,g,e,A),a){var y=f._tempQuaternion0,I=u[0].value;h.a.quaternionConjugate(I,y),l.a.multiply(y,A,A)}break;case 3:R=s[n],this._evaluateFrameNodeVector3DatasRealTime(u,p,g,e,R),a&&(x=u[0].value,R.x/=x.x,R.y/=x.y,R.z/=x.z);break;default:throw"AnimationClip:unknown node type."}}}_evaluateClipDatasRealTimeForNative(t,e,i,a){_.a.instance.evaluateClipDatasRealTime(t._nativeObj,e,i,a)}_evaluateFrameNodeVector3DatasRealTime(t,e,i,a,r){if(-1!==e){var s=t[e];if(i){var n=s.value;r.x=n.x,r.y=n.y,r.z=n.z}else{var o,l=t[e+1],h=s.time,_=l.time-h;o=0!==_?(a-h)/_:0,this._hermiteInterpolateVector3(s,l,o,_,r)}}else{var c=t[0].value;r.x=c.x,r.y=c.y,r.z=c.z}}_evaluateFrameNodeQuaternionDatasRealTime(t,e,i,a,r){if(-1!==e){var s=t[e];if(i){var n=s.value;r.x=n.x,r.y=n.y,r.z=n.z,r.w=n.w}else{var o,l=t[e+1],h=s.time,_=l.time-h;o=0!==_?(a-h)/_:0,this._hermiteInterpolateQuaternion(s,l,o,_,r)}}else{var c=t[0].value;r.x=c.x,r.y=c.y,r.z=c.z,r.w=c.w}}_binarySearchEventIndex(t){for(var e,i=0,a=this._animationEvents.length-1;i<=a;){e=Math.floor((i+a)/2);var r=this._animationEvents[e].time;if(r==t)return e;r>t?a=e-1:i=e+1}return i}addEvent(t){var e=this._binarySearchEventIndex(t.time);this._animationEvents.splice(e,0,t)}_disposeResource(){this._nodes=null,this._nodesMap=null}}e.a=f,r()(f,"ANIMATIONCLIP","ANIMATIONCLIP"),r()(f,"_tempQuaternion0",new l.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(263),n=i(264),o=i(126),l=i(265),h=i(266);class _{static READ_DATA(){_._DATA.offset=_._reader.getUint32(),_._DATA.size=_._reader.getUint32()}static READ_BLOCK(){for(var t=_._BLOCK.count=_._reader.getUint16(),e=_._BLOCK.blockStarts=[],i=_._BLOCK.blockLengths=[],a=0;a<t;a++)e.push(_._reader.getUint32()),i.push(_._reader.getUint32())}static READ_STRINGS(){var t=_._reader.getUint32(),e=_._reader.getUint16(),i=_._reader.pos;_._reader.pos=t+_._DATA.offset;for(var a=0;a<e;a++)_._strings[a]=_._reader.readUTFString();_._reader.pos=i}static parse(t,e){_._animationClip=t,_._reader=e;e.__getBuffer();_.READ_DATA(),_.READ_BLOCK(),_.READ_STRINGS();for(var i=0,a=_._BLOCK.count;i<a;i++){var r=e.getUint16(),s=_._strings[r],n=_["READ_"+s];if(null==n)throw new Error("model file err,no this function:"+r+" "+s);n.call(null)}}static READ_ANIMATIONS(){var t,e,i,a=_._reader,r=(a.__getBuffer(),[]),c=a.getUint16();for(r.length=c,t=0;t<c;t++)r[t]=a.getFloat32();var d=_._animationClip;d.name=_._strings[a.getUint16()];var u=d._duration=a.getFloat32();d.islooping=!!a.getByte(),d._frameRate=a.getInt16();var f=a.getInt16(),m=d._nodes;m.count=f;var p=d._nodesMap={},g=d._nodesDic={};for(t=0;t<f;t++){i=new s.a,m.setNodeByIndex(t,i),i._indexInList=t;var v=i.type=a.getUint8(),T=a.getUint16();for(i._setOwnerPathCount(T),e=0;e<T;e++)i._setOwnerPathByIndex(e,_._strings[a.getUint16()]);var E=i._joinOwnerPath("/"),S=p[E];S||(p[E]=S=[]),S.push(i),i.propertyOwner=_._strings[a.getUint16()];var R=a.getUint16();for(i._setPropertyCount(R),e=0;e<R;e++)i._setPropertyByIndex(e,_._strings[a.getUint16()]);var x=E+"."+i.propertyOwner+"."+i._joinProperty(".");g[x]=i,i.fullPath=x;var A=a.getUint16();for(i._setKeyframeCount(A),e=0;e<A;e++)switch(v){case 0:var y=new o.a;i._setKeyframeByIndex(e,y),y.time=r[a.getUint16()],y.inTangent=a.getFloat32(),y.outTangent=a.getFloat32(),y.value=a.getFloat32();break;case 1:case 3:case 4:var I=new h.a;i._setKeyframeByIndex(e,I),I.time=r[a.getUint16()];var C=I.inTangent,M=I.outTangent,D=I.value;C.x=a.getFloat32(),C.y=a.getFloat32(),C.z=a.getFloat32(),M.x=a.getFloat32(),M.y=a.getFloat32(),M.z=a.getFloat32(),D.x=a.getFloat32(),D.y=a.getFloat32(),D.z=a.getFloat32();break;case 2:var b=new l.a;i._setKeyframeByIndex(e,b),b.time=r[a.getUint16()];var L=b.inTangent,O=b.outTangent,P=b.value;L.x=a.getFloat32(),L.y=a.getFloat32(),L.z=a.getFloat32(),L.w=a.getFloat32(),O.x=a.getFloat32(),O.y=a.getFloat32(),O.z=a.getFloat32(),O.w=a.getFloat32(),P.x=a.getFloat32(),P.y=a.getFloat32(),P.z=a.getFloat32(),P.w=a.getFloat32();break;default:throw"AnimationClipParser03:unknown type."}}var N=a.getUint16();for(t=0;t<N;t++){var w,B=new n.a;B.time=Math.min(u,a.getFloat32()),B.eventName=_._strings[a.getUint16()];var F=a.getUint16();for(F>0&&(B.params=w=[]),e=0;e<F;e++){switch(a.getByte()){case 0:w.push(!!a.getByte());break;case 1:w.push(a.getInt32());break;case 2:w.push(a.getFloat32());break;case 3:w.push(_._strings[a.getUint16()]);break;default:throw new Error("unknown type.")}}d.addEvent(B)}}}e.a=_,r()(_,"_animationClip",void 0),r()(_,"_reader",void 0),r()(_,"_strings",[]),r()(_,"_BLOCK",{count:0}),r()(_,"_DATA",{offset:0,size:0})},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(263),n=i(264),o=i(126),l=i(265),h=i(266),_=i(114);class c{static READ_DATA(){c._DATA.offset=c._reader.getUint32(),c._DATA.size=c._reader.getUint32()}static READ_BLOCK(){for(var t=c._BLOCK.count=c._reader.getUint16(),e=c._BLOCK.blockStarts=[],i=c._BLOCK.blockLengths=[],a=0;a<t;a++)e.push(c._reader.getUint32()),i.push(c._reader.getUint32())}static READ_STRINGS(){var t=c._reader.getUint32(),e=c._reader.getUint16(),i=c._reader.pos;c._reader.pos=t+c._DATA.offset;for(var a=0;a<e;a++)c._strings[a]=c._reader.readUTFString();c._reader.pos=i}static parse(t,e,i){c._animationClip=t,c._reader=e,c._version=i,c.READ_DATA(),c.READ_BLOCK(),c.READ_STRINGS();for(var a=0,r=c._BLOCK.count;a<r;a++){var s=e.getUint16(),n=c._strings[s],o=c["READ_"+n];if(null==o)throw new Error("model file err,no this function:"+s+" "+n);o.call(null)}c._version=null,c._reader=null,c._animationClip=null}static READ_ANIMATIONS(){var t,e,i,a=c._reader,r=(a.__getBuffer(),[]),d=a.getUint16();for(r.length=d,t=0;t<d;t++)r[t]=a.getFloat32();var u=c._animationClip;u.name=c._strings[a.getUint16()];var f=u._duration=a.getFloat32();u.islooping=!!a.getByte(),u._frameRate=a.getInt16();var m=a.getInt16(),p=u._nodes;p.count=m;var g=u._nodesMap={},v=u._nodesDic={};for(t=0;t<m;t++){i=new s.a,p.setNodeByIndex(t,i),i._indexInList=t;var T=i.type=a.getUint8(),E=a.getUint16();for(i._setOwnerPathCount(E),e=0;e<E;e++)i._setOwnerPathByIndex(e,c._strings[a.getUint16()]);var S=i._joinOwnerPath("/"),R=g[S];R||(g[S]=R=[]),R.push(i),i.propertyOwner=c._strings[a.getUint16()];var x=a.getUint16();for(i._setPropertyCount(x),e=0;e<x;e++)i._setPropertyByIndex(e,c._strings[a.getUint16()]);var A=S+"."+i.propertyOwner+"."+i._joinProperty(".");v[A]=i,i.fullPath=A;var y=a.getUint16();switch(i._setKeyframeCount(y),c._version){case"LAYAANIMATION:04":for(e=0;e<y;e++)switch(T){case 0:var I=new o.a;i._setKeyframeByIndex(e,I),I.time=r[a.getUint16()],I.inTangent=a.getFloat32(),I.outTangent=a.getFloat32(),I.value=a.getFloat32();break;case 1:case 3:case 4:var C=new h.a;i._setKeyframeByIndex(e,C),C.time=r[a.getUint16()];var M=C.inTangent,D=C.outTangent,b=C.value;M.x=a.getFloat32(),M.y=a.getFloat32(),M.z=a.getFloat32(),D.x=a.getFloat32(),D.y=a.getFloat32(),D.z=a.getFloat32(),b.x=a.getFloat32(),b.y=a.getFloat32(),b.z=a.getFloat32();break;case 2:var L=new l.a;i._setKeyframeByIndex(e,L),L.time=r[a.getUint16()];var O=L.inTangent,P=L.outTangent,N=L.value;O.x=a.getFloat32(),O.y=a.getFloat32(),O.z=a.getFloat32(),O.w=a.getFloat32(),P.x=a.getFloat32(),P.y=a.getFloat32(),P.z=a.getFloat32(),P.w=a.getFloat32(),N.x=a.getFloat32(),N.y=a.getFloat32(),N.z=a.getFloat32(),N.w=a.getFloat32();break;default:throw"AnimationClipParser04:unknown type."}break;case"LAYAANIMATION:COMPRESSION_04":for(e=0;e<y;e++)switch(T){case 0:I=new o.a,i._setKeyframeByIndex(e,I),I.time=r[a.getUint16()],I.inTangent=_.a.convertToNumber(a.getUint16()),I.outTangent=_.a.convertToNumber(a.getUint16()),I.value=_.a.convertToNumber(a.getUint16());break;case 1:case 3:case 4:C=new h.a,i._setKeyframeByIndex(e,C),C.time=r[a.getUint16()],M=C.inTangent,D=C.outTangent,b=C.value,M.x=_.a.convertToNumber(a.getUint16()),M.y=_.a.convertToNumber(a.getUint16()),M.z=_.a.convertToNumber(a.getUint16()),D.x=_.a.convertToNumber(a.getUint16()),D.y=_.a.convertToNumber(a.getUint16()),D.z=_.a.convertToNumber(a.getUint16()),b.x=_.a.convertToNumber(a.getUint16()),b.y=_.a.convertToNumber(a.getUint16()),b.z=_.a.convertToNumber(a.getUint16());break;case 2:L=new l.a,i._setKeyframeByIndex(e,L),L.time=r[a.getUint16()],O=L.inTangent,P=L.outTangent,N=L.value,O.x=_.a.convertToNumber(a.getUint16()),O.y=_.a.convertToNumber(a.getUint16()),O.z=_.a.convertToNumber(a.getUint16()),O.w=_.a.convertToNumber(a.getUint16()),P.x=_.a.convertToNumber(a.getUint16()),P.y=_.a.convertToNumber(a.getUint16()),P.z=_.a.convertToNumber(a.getUint16()),P.w=_.a.convertToNumber(a.getUint16()),N.x=_.a.convertToNumber(a.getUint16()),N.y=_.a.convertToNumber(a.getUint16()),N.z=_.a.convertToNumber(a.getUint16()),N.w=_.a.convertToNumber(a.getUint16());break;default:throw"AnimationClipParser04:unknown type."}}}var w=a.getUint16();for(t=0;t<w;t++){var B,F=new n.a;F.time=Math.min(f,a.getFloat32()),F.eventName=c._strings[a.getUint16()];var V=a.getUint16();for(V>0&&(F.params=B=[]),e=0;e<V;e++){switch(a.getByte()){case 0:B.push(!!a.getByte());break;case 1:B.push(a.getInt32());break;case 2:B.push(a.getFloat32());break;case 3:B.push(c._strings[a.getUint16()]);break;default:throw new Error("unknown type.")}}u.addEvent(F)}}}e.a=c,r()(c,"_animationClip",void 0),r()(c,"_reader",void 0),r()(c,"_strings",[]),r()(c,"_BLOCK",{count:0}),r()(c,"_DATA",{offset:0,size:0}),r()(c,"_version",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{get count(){return this._nodes.length}set count(t){this._nodes.length=t}constructor(){r()(this,"_nodes",[])}getNodeByIndex(t){return this._nodes[t]}setNodeByIndex(t,e){this._nodes[t]=e}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(422);class n{get defaultState(){return this._defaultState}set defaultState(t){this._defaultState=t,this._statesMap[t.name]=t}constructor(t){r()(this,"_defaultState",null),r()(this,"_referenceCount",0),r()(this,"_playType",-1),r()(this,"_crossDuration",-1),r()(this,"_crossPlayState",void 0),r()(this,"_crossMark",0),r()(this,"_crossNodesOwnersCount",0),r()(this,"_crossNodesOwners",[]),r()(this,"_crossNodesOwnersIndicesMap",{}),r()(this,"_srcCrossClipNodeIndices",[]),r()(this,"_destCrossClipNodeIndices",[]),r()(this,"_animator",void 0),r()(this,"_statesMap",{}),r()(this,"_states",[]),r()(this,"_playStateInfo",new s.a),r()(this,"_crossPlayStateInfo",new s.a),r()(this,"name",void 0),r()(this,"blendingMode",n.BLENDINGMODE_OVERRIDE),r()(this,"defaultWeight",1),r()(this,"playOnWake",!0),this.name=t}_removeClip(t,e,i,a){var r=a._clip,s=t[i];if(t.splice(i,1),delete e[a.name],this._animator){var n=r._nodes,o=s._nodeOwners;r._removeReference();for(var l=0,h=n.count;l<h;l++)this._animator._removeKeyframeNodeOwner(o,n.getNodeByIndex(l))}}_getReferenceCount(){return this._referenceCount}_addReference(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;for(var e=0,i=this._states.length;e<i;e++)this._states[e]._addReference(t);this._referenceCount+=t}_removeReference(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;for(var e=0,i=this._states.length;e<i;e++)this._states[e]._removeReference(t);this._referenceCount-=t}_clearReference(){this._removeReference(-this._referenceCount)}getCurrentPlayState(){return this._playStateInfo}getAnimatorState(t){var e=this._statesMap[t];return e||null}addState(t){var e=t.name;if(this._statesMap[e])throw"AnimatorControllerLayer:this stat's name has exist.";this._statesMap[e]=t,this._states.push(t),this._animator&&(t._clip._addReference(),this._animator._getOwnersByClip(t))}removeState(t){for(var e=this._states,i=-1,a=0,r=e.length;a<r;a++)if(e[a]===t){i=a;break}-1!==i&&this._removeClip(e,this._statesMap,i,t)}destroy(){this._clearReference(),this._statesMap=null,this._states=null,this._playStateInfo=null,this._crossPlayStateInfo=null,this._defaultState=null}cloneTo(t){var e=t;e.name=this.name,e.blendingMode=this.blendingMode,e.defaultWeight=this.defaultWeight,e.playOnWake=this.playOnWake}clone(){var t=new n(this.name);return this.cloneTo(t),t}}e.a=n,r()(n,"BLENDINGMODE_OVERRIDE",0),r()(n,"BLENDINGMODE_ADDTIVE",1)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{get normalizedTime(){return this._normalizedTime}get duration(){return this._duration}get animatorState(){return this._currentState}constructor(){r()(this,"_finish",void 0),r()(this,"_startPlayTime",void 0),r()(this,"_lastElapsedTime",void 0),r()(this,"_elapsedTime",void 0),r()(this,"_normalizedTime",void 0),r()(this,"_normalizedPlayTime",void 0),r()(this,"_duration",void 0),r()(this,"_playEventIndex",void 0),r()(this,"_lastIsFront",void 0),r()(this,"_currentState",null)}_resetPlayState(t){this._finish=!1,this._startPlayTime=t,this._elapsedTime=t,this._playEventIndex=0,this._lastIsFront=!0}_cloneTo(t){t._finish=this._finish,t._startPlayTime=this._startPlayTime,t._elapsedTime=this._elapsedTime,t._normalizedTime=this._normalizedTime,t._normalizedPlayTime=this._normalizedPlayTime,t._playEventIndex=this._playEventIndex,t._lastIsFront=this._lastIsFront}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(24),n=i(1);class o{get clip(){return this._clip}set clip(t){if(this._clip!==t){if(this._clip&&this._referenceCount>0&&this._clip._removeReference(this._referenceCount),t){var e=this._realtimeDatas,i=t._nodes,a=i.count;this._currentFrameIndices=new Int16Array(a),this._resetFrameIndices(),this._referenceCount>0&&t._addReference(this._referenceCount),this._realtimeDatas.length=a;for(var r=0;r<a;r++)switch(i.getNodeByIndex(r).type){case 0:break;case 1:case 3:case 4:e[r]=new n.a;break;case 2:e[r]=new s.a;break;default:throw"AnimationClipParser04:unknown type."}}this._clip=t}}constructor(){r()(this,"_referenceCount",0),r()(this,"_clip",null),r()(this,"_nodeOwners",[]),r()(this,"_currentFrameIndices",null),r()(this,"_realtimeDatas",[]),r()(this,"_scripts",null),r()(this,"name",void 0),r()(this,"speed",1),r()(this,"clipStart",0),r()(this,"clipEnd",1)}_getReferenceCount(){return this._referenceCount}_addReference(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._clip&&this._clip._addReference(t),this._referenceCount+=t}_removeReference(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._clip&&this._clip._removeReference(t),this._referenceCount-=t}_clearReference(){this._removeReference(-this._referenceCount)}_resetFrameIndices(){for(var t=0,e=this._currentFrameIndices.length;t<e;t++)this._currentFrameIndices[t]=-1}addScript(t){var e=new t;return this._scripts=this._scripts||[],this._scripts.push(e),e}getScript(t){if(this._scripts)for(var e=0,i=this._scripts.length;e<i;e++){var a=this._scripts[e];if(a instanceof t)return a}return null}getScripts(t){var e;if(this._scripts)for(var i=0,a=this._scripts.length;i<a;i++){var r=this._scripts[i];r instanceof t&&(e=e||[]).push(r)}return e}cloneTo(t){var e=t;e.name=this.name,e.speed=this.speed,e.clipStart=this.clipStart,e.clipEnd=this.clipEnd,e.clip=this._clip}clone(){var t=new o;return this.cloneTo(t),t}}e.a=o},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){r()(this,"indexInList",-1),r()(this,"referenceCount",0),r()(this,"updateMark",-1),r()(this,"type",-1),r()(this,"fullPath",null),r()(this,"propertyOwner",null),r()(this,"property",null),r()(this,"defaultValue",null),r()(this,"value",null),r()(this,"crossFixedValue",null)}saveCrossFixedValue(){if(this.propertyOwner)switch(this.type){case 0:this.crossFixedValue=this.value;break;case 1:case 3:case 4:case 2:this.value.cloneTo(this.crossFixedValue);break;default:throw"Animator:unknown type."}}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(3),n=i(42),o=i(426),l=i(435),h=i(86),_=i(7),c=i(32);class d{static __init__(){d.SHADERDEFINE_BLOOM_LOW=_.a.getDefineByName("BLOOM_LOW"),d.SHADERDEFINE_BLOOM=_.a.getDefineByName("BLOOM"),d.SHADERDEFINE_FINALPASS=_.a.getDefineByName("FINALPASS")}constructor(){r()(this,"_compositeShader",_.a.find("PostProcessComposite")),r()(this,"_compositeShaderData",new c.a),r()(this,"_effects",[]),r()(this,"_context",null),this._context=new l.a,this._context.compositeShaderData=this._compositeShaderData,this._context.command=new o.a}_init(t){this._context.camera=t,this._context.command._camera=t}_render(){var t=c.a._SET_RUNTIME_VALUE_MODE_REFERENCE_;s.a.Render.supportWebGLPlusRendering&&c.a.setRuntimeValueMode(!1);var e=this._context.camera,i=e.viewport,a=e._internalRenderTexture,r=a;this._context.command.clear(),this._context.source=r,this._context.destination=a,this._context.compositeShaderData.clearDefine(),this._context.compositeShaderData.setTexture(d.SHADERVALUE_AUTOEXPOSURETEX,n.a.whiteTexture);for(var o=0,l=this._effects.length;o<l;o++)this._effects[o].render(this._context);this._compositeShaderData.addDefine(d.SHADERDEFINE_FINALPASS);var _=e._offScreenRenderTexture,u=_||null;this._context.destination=u;var f=e._getCanvasWidth(),m=e._getCanvasHeight();e._screenOffsetScale.setValue(i.x/f,i.y/m,i.width/f,i.height/m),this._context.command.blitScreenTriangle(this._context.source,u,e._screenOffsetScale,this._compositeShader,this._compositeShaderData,0,!0),h.a.recoverToPool(r);var p=this._context.deferredReleaseTextures;for(o=0,l=p.length;o<l;o++)h.a.recoverToPool(p[o]);p.length=0,s.a.Render.supportWebGLPlusRendering&&c.a.setRuntimeValueMode(t)}addEffect(t){this._effects.push(t)}removeEffect(t){var e=this._effects.indexOf(t);-1!==e&&this._effects.splice(e,1)}_applyPostProcessCommandBuffers(){this._context.command._apply()}}e.a=d,r()(d,"SHADERDEFINE_BLOOM_LOW",void 0),r()(d,"SHADERDEFINE_BLOOM",void 0),r()(d,"SHADERDEFINE_FINALPASS",void 0),r()(d,"SHADERVALUE_MAINTEX",_.a.propertyNameToID("u_MainTex")),r()(d,"SHADERVALUE_BLOOMTEX",_.a.propertyNameToID("u_BloomTex")),r()(d,"SHADERVALUE_AUTOEXPOSURETEX",_.a.propertyNameToID("u_AutoExposureTex")),r()(d,"SHADERVALUE_BLOOM_DIRTTEX",_.a.propertyNameToID("u_Bloom_DirtTex")),r()(d,"SHADERVALUE_BLOOMTEX_TEXELSIZE",_.a.propertyNameToID("u_BloomTex_TexelSize")),r()(d,"SHADERVALUE_BLOOM_DIRTTILEOFFSET",_.a.propertyNameToID("u_Bloom_DirtTileOffset")),r()(d,"SHADERVALUE_BLOOM_SETTINGS",_.a.propertyNameToID("u_Bloom_Settings")),r()(d,"SHADERVALUE_BLOOM_COLOR",_.a.propertyNameToID("u_Bloom_Color"))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(267),n=i(428),o=i(173),l=i(429),h=i(430),_=i(431),c=i(434);e.a=class{constructor(){r()(this,"_camera",null),r()(this,"_context",void 0),r()(this,"_commands",[])}_apply(){for(var t=0,e=this._commands.length;t<e;t++)this._commands[t].run()}setShaderDataTexture(t,e,i){this._commands.push(o.a.create(t,e,i,o.b.Texture,this))}setGlobalTexture(t,e){this._commands.push(c.a.create(t,e,o.b.Texture,this))}setShaderDataVector(t,e,i){this._commands.push(o.a.create(t,e,i,o.b.Vector,this))}setGlobalVector(t,e){this._commands.push(c.a.create(t,e,o.b.Vector,this))}setShaderDataVector3(t,e,i){this._commands.push(o.a.create(t,e,i,o.b.Vector3,this))}setGlobalVector3(t,e){this._commands.push(c.a.create(t,e,o.b.Vector3,this))}setShaderDataVector2(t,e,i){this._commands.push(o.a.create(t,e,i,o.b.Vector2,this))}setGlobalVector2(t,e){this._commands.push(c.a.create(t,e,o.b.Vector2,this))}setShaderDataNumber(t,e,i){this._commands.push(o.a.create(t,e,i,o.b.Number,this))}setGlobalNumber(t,e){this._commands.push(c.a.create(t,e,o.b.Number,this))}setShaderDataInt(t,e,i){this._commands.push(o.a.create(t,e,i,o.b.Int,this))}setGlobalInt(t,e){this._commands.push(c.a.create(t,e,o.b.Int,this))}setShaderDataMatrix(t,e,i){this._commands.push(o.a.create(t,e,i,o.b.Matrix4x4,this))}setGlobalMatrix(t,e){this._commands.push(c.a.create(t,e,o.b.Matrix4x4,this))}blitScreenQuad(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this._commands.push(s.a.create(t,e,i,a,r,n,s.a._SCREENTYPE_QUAD,this))}blitScreenQuadByMaterial(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;var n,o;a&&(n=a._shader,o=a.shaderData),this._commands.push(s.a.create(t,e,i,n,o,r,s.a._SCREENTYPE_QUAD,this))}blitScreenTriangle(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._commands.push(s.a.create(t,e,i,a,r,n,s.a._SCREENTYPE_TRIANGLE,this,o))}setRenderTarget(t){this._commands.push(n.a.create(t))}clearRenderTarget(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._commands.push(h.a.create(t,e,i,a,this))}drawMesh(t,e,i,a,r){this._commands.push(l.a.create(t,e,i,a,r,this))}drawRender(t,e,i){this._commands.push(_.a.create(t,e,i,this))}clear(){for(var t=0,e=this._commands.length;t<e;t++)this._commands[t].recover();this._commands.length=0}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(t,e){r()(this,"_index",void 0),r()(this,"_value",void 0),this._index=t,this._value=e}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(63),n=i(86),o=i(2);class l extends s.a{constructor(){super(...arguments),r()(this,"_renderTexture",null)}static create(t){var e;return(e=l._pool.length>0?l._pool.pop():new l)._renderTexture=t,e}run(){n.a.currentActive&&n.a.currentActive._end(),o.a.instance.viewport(0,0,this._renderTexture.width,this._renderTexture.height),this._renderTexture._start()}recover(){l._pool.push(this),this._renderTexture=null}}e.a=l,r()(l,"_pool",[])},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(63),n=i(9),o=i(32),l=i(54),h=i(33);class _ extends s.a{static create(t,e,i,a,r,s){var n;return(n=_._pool.length>0?_._pool.pop():new _)._mesh=t,n._matrix=e,n._material=i,n._subMeshIndex=a,n._subShaderIndex=r,n._commandBuffer=s,n}constructor(){super(),r()(this,"_material",void 0),r()(this,"_matrix",void 0),r()(this,"_subMeshIndex",void 0),r()(this,"_subShaderIndex",void 0),r()(this,"_mesh",void 0),r()(this,"_projectionViewWorldMatrix",new n.a),r()(this,"_renderShaderValue",new o.a),this._renderShaderValue=new o.a(null)}run(){var t=this._material._shader.getSubShaderAt(this._subShaderIndex);this.setContext(this._commandBuffer._context);var e=this._context,i=e.invertY,a=e.scene,r=e.cameraShaderValue,s=e.projectionViewMatrix;n.a.multiply(s,this._matrix,this._projectionViewWorldMatrix),this._renderShaderValue.setMatrix4x4(h.a.WORLDMATRIX,this._matrix),this._renderShaderValue.setMatrix4x4(h.a.MVPMATRIX,this._projectionViewWorldMatrix);for(var o=e.pipelineMode,l=t._passes,c=0,d=l.length;c<d;c++){var u=l[c];if(u._pipelineMode===o){var f=_._compileDefine;a._shaderValues._defineDatas.cloneTo(f),f.addDefineDatas(this._renderShaderValue._defineDatas),f.addDefineDatas(this._material._shaderValues._defineDatas);var m=e.shader=u.withCompile(f);m.bind();m.uploadUniforms(m._sceneUniformParamsMap,a._shaderValues,!0),m.uploadUniforms(m._spriteUniformParamsMap,this._renderShaderValue,!0),m.uploadUniforms(m._cameraUniformParamsMap,r,!0);var p=this._material._shaderValues;m.uploadUniforms(m._materialUniformParamsMap,p,!0),m.uploadRenderStateBlendDepth(p),m.uploadRenderStateFrontFace(p,i,this._matrix.getInvertFront())}}var g,v=this._mesh._subMeshes;if(-1==this._subMeshIndex)for(var T=0,E=v.length;T<E;T++)(g=v[T])._prepareRender(e)&&g._render(e);else(g=(v=this._mesh._subMeshes)[this._subMeshIndex])._prepareRender(e)&&g._render(e)}recover(){_._pool.push(this),this._renderShaderValue.clearDefine(),this._renderShaderValue._initData()}}e.a=_,r()(_,"_pool",[]),r()(_,"_compileDefine",new l.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(5),o=i(63);class l extends o.a{constructor(){super(...arguments),r()(this,"_clearColor",!1),r()(this,"_clearDepth",!1),r()(this,"_backgroundColor",new n.a),r()(this,"_depth",1)}static create(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4?arguments[4]:void 0;var s;return(s=l._pool.length>0?l._pool.pop():new l)._clearColor=t,s._clearDepth=e,i.cloneTo(s._backgroundColor),s._depth=a,s._commandBuffer=r,s}run(){var t,e=s.a.instance,i=this._backgroundColor;this._clearColor&&(e.clearColor(i.x,i.y,i.z,i.w),t|=e.COLOR_BUFFER_BIT),this._clearDepth&&(e.clearDepth(this._depth),t|=e.DEPTH_BUFFER_BIT),(this._clearColor||this._clearDepth)&&e.clear(t)}recover(){}}e.a=l,r()(l,"_pool",[])},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(63),n=i(64),o=i(87),l=i(54);class h extends s.a{constructor(){super(...arguments),r()(this,"_material",void 0),r()(this,"_render",void 0),r()(this,"_subShaderIndex",void 0)}static create(t,e,i,a){var r;return(r=h._pool.length>0?h._pool.pop():new h)._render=t,r._material=e,r._subShaderIndex=i,r._commandBuffer=a,r}_elementRender(t,e){var i,a,r,s=e.invertY,l=o.a._updateMark,_=e.scene,c=e.cameraShaderValue,d=t._transform,u=t._geometry;e.renderElement=t,l!==t.render._updateMark||t.renderType!==t.render._updateRenderType?(t.render._renderUpdate(e,d),t.render._renderUpdateWithCamera(e,d),t.render._updateMark=l,t.render._updateRenderType=t.renderType):t.renderType==n.a.RENDERTYPE_INSTANCEBATCH&&(t.render._renderUpdate(e,d),t.render._renderUpdateWithCamera(e,d));var f=e.pipelineMode;if(u._prepareRender(e))for(var m=t.renderSubShader._passes,p=0,g=m.length;p<g;p++){var v=m[p];if(v._pipelineMode===f){var T=h._compileDefine;_._shaderValues._defineDatas.cloneTo(T),T.addDefineDatas(t.render._shaderValues._defineDatas),T.addDefineDatas(this._material._shaderValues._defineDatas);var E=e.shader=v.withCompile(T),S=E.bind(),R=l!==E._uploadMark,x=E._uploadScene!==_||R;(x||S)&&(E.uploadUniforms(E._sceneUniformParamsMap,_._shaderValues,x),E._uploadScene=_);var A=E._uploadRender!==t.render||E._uploadRenderType!==t.renderType||R;(A||S)&&(E.uploadUniforms(E._spriteUniformParamsMap,t.render._shaderValues,A),E._uploadRender=t.render,E._uploadRenderType=t.renderType);var y=E._uploadCameraShaderValue!==c||R;(y||S)&&(E.uploadUniforms(E._cameraUniformParamsMap,c,y),E._uploadCameraShaderValue=c);var I=E._uploadMaterial!==this._material||R;(I||S)&&(E.uploadUniforms(E._materialUniformParamsMap,this._material._shaderValues,I),E._uploadMaterial=this._material);var C=this._material._shaderValues;i!==this._material||a!==E?(E.uploadRenderStateBlendDepth(C),E.uploadRenderStateFrontFace(C,s,t.getInvertFront()),i=this._material,a=E,r=t.render):r!==t.render&&(E.uploadRenderStateFrontFace(C,s,t.getInvertFront()),r=t.render),u._render(e),E._uploadMark=l}}t.renderType!==n.a.RENDERTYPE_NORMAL&&t.render._revertBatchRenderUpdate(e)}run(){if(!this._material)throw"This render command material cannot be empty";this.setContext(this._commandBuffer._context);for(var t=this._context,e=t.scene,i=this._render._renderElements,a=0,r=i.length;a<r;a++){var s=i[a];s._update(e,t,this._material._shader,null,this._subShaderIndex),this._elementRender(s,t)}}recover(){h._pool.push(this)}}e.a=h,r()(h,"_pool",[]),r()(h,"_compileDefine",new l.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(9),n=i(1);class o{constructor(t,e,i,a){r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"width",void 0),r()(this,"height",void 0),r()(this,"minDepth",void 0),r()(this,"maxDepth",void 0),this.minDepth=0,this.maxDepth=1,this.x=t,this.y=e,this.width=i,this.height=a}project(t,e,i){n.a.transformV3ToV4(t,e,i);var a=i.x,r=i.y,s=i.z,o=i.w;1!==o&&(a/=o,r/=o,s/=o),i.x=.5*(a+1)*this.width+this.x,i.y=.5*(1-r)*this.height+this.y,i.z=s*(this.maxDepth-this.minDepth)+this.minDepth}unprojectFromMat(t,e,i){var a=e.elements;i.x=(t.x-this.x)/this.width*2-1,i.y=-((t.y-this.y)/this.height*2-1),i.z=(t.z-this.minDepth)/(this.maxDepth-this.minDepth);var r=i.x*a[3]+i.y*a[7]+i.z*a[11]+a[15];n.a.transformV3ToV3(i,e,i),1!==r&&(i.x=i.x/r,i.y=i.y/r,i.z=i.z/r)}unprojectFromWVP(t,e,i,a,r){s.a.multiply(e,i,o._tempMatrix4x4),a&&s.a.multiply(o._tempMatrix4x4,a,o._tempMatrix4x4),o._tempMatrix4x4.invert(o._tempMatrix4x4),this.unprojectFromMat(t,o._tempMatrix4x4,r)}cloneTo(t){t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t.minDepth=this.minDepth,t.maxDepth=this.maxDepth}}e.a=o,r()(o,"_tempMatrix4x4",new s.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1);class n{constructor(){}static calculateCursorRay(t,e,i,a,r,o){var l=t.x,h=t.y,_=n._tempVector30,c=_;c.x=l,c.y=h,c.z=e.minDepth;var d=n._tempVector31,u=d;u.x=l,u.y=h,u.z=e.maxDepth;var f=o.origin,m=n._tempVector32;e.unprojectFromWVP(_,i,a,r,f),e.unprojectFromWVP(d,i,a,r,m);var p=o.direction;p.x=m.x-f.x,p.y=m.y-f.y,p.z=m.z-f.z,s.a.normalize(o.direction,o.direction)}static rayIntersectsTriangle(t,e,i,a){var r=n._tempVector30,o=n._tempVector31;s.a.subtract(i,e,r),s.a.subtract(a,e,o);var l,h=n._tempVector32;if(s.a.cross(t.direction,o,h),(l=s.a.dot(r,h))>-Number.MIN_VALUE&&l<Number.MIN_VALUE)return Number.NaN;var _,c=1/l,d=n._tempVector33;if(s.a.subtract(t.origin,e,d),_=s.a.dot(d,h),(_*=c)<0||_>1)return Number.NaN;var u,f,m=n._tempVector34;return s.a.cross(d,r,m),u=s.a.dot(t.direction,m),(u*=c)<0||_+u>1?Number.NaN:(f=s.a.dot(o,m),(f*=c)<0?Number.NaN:f)}}e.a=n,r()(n,"_tempVector30",new s.a),r()(n,"_tempVector31",new s.a),r()(n,"_tempVector32",new s.a),r()(n,"_tempVector33",new s.a),r()(n,"_tempVector34",new s.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(63),n=i(173);class o extends s.a{constructor(){super(...arguments),r()(this,"_nameID",0),r()(this,"_value",null),r()(this,"_dataType",-1)}static create(t,e,i,a){var r;return(r=o._pool.length>0?o._pool.pop():new o)._nameID=t,r._value=e,r._dataType=i,r._commandBuffer=a,r}run(){var t=this._commandBuffer._camera.scene._shaderValues;switch(this._dataType){case n.b.Int:t.setInt(this._nameID,this._value);break;case n.b.Number:t.setNumber(this._nameID,this._value);break;case n.b.Bool:t.setBool(this._nameID,this._value);break;case n.b.Matrix4x4:t.setMatrix4x4(this._nameID,this._value);break;case n.b.Quaternion:t.setQuaternion(this._nameID,this._value);break;case n.b.Texture:t.setTexture(this._nameID,this._value);break;case n.b.Vector:t.setVector(this._nameID,this._value);break;case n.b.Vector2:t.setVector2(this._nameID,this._value);break;case n.b.Vector3:t.setVector3(this._nameID,this._value);break;case n.b.Buffer:t.setBuffer(this._nameID,this._value);break;default:throw"no type shaderValue on this CommendBuffer"}}recover(){o._pool.push(this),this._nameID=0,this._value=null,this._dataType=-1}}e.a=o,r()(o,"_pool",[])},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){r()(this,"source",null),r()(this,"destination",null),r()(this,"camera",null),r()(this,"compositeShaderData",null),r()(this,"command",null),r()(this,"deferredReleaseTextures",[])}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(437),n=i(17),o=i(3);class l extends n.a{static _parse(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];var e=new l;if(e._rootNode=new s.a(new Float32Array(3),new Float32Array(4),new Float32Array(3),new Float32Array(16)),t.version){var i=t.rootNode;i&&e._parseNode(i,e._rootNode)}return e}static load(t,e){o.a.loader.create(t,e,null,l.AVATAR)}constructor(){super(),r()(this,"_rootNode",void 0),r()(this,"_nativeNodeCount",0),r()(this,"_nativeCurCloneCount",0)}_initCloneToAnimator(t,e){e._avatarNodeMap[t.name]=t;for(var i=0,a=t.getChildCount();i<a;i++)this._initCloneToAnimator(t.getChildByIndex(i),e)}_parseNode(t,e){var i=t.props.name;e.name=i;var a=t.props,r=e.transform,n=r.localPosition,o=r.localRotation,l=r.localScale;n.fromArray(a.translate),o.fromArray(a.rotation),l.fromArray(a.scale),r.localPosition=n,r.localRotation=o,r.localScale=l;for(var h=t.child,_=0,c=h.length;_<c;_++){var d=h[_],u=new s.a(new Float32Array(3),new Float32Array(4),new Float32Array(3),new Float32Array(16));e.addChild(u),this._parseNode(d,u)}}_cloneDatasToAnimator(t){var e;e=this._rootNode.clone();var i=this._rootNode.transform,a=e.transform,r=a.localPosition,s=a.localRotation,n=a.localScale;i.localPosition.cloneTo(r),i.localRotation.cloneTo(s),i.localScale.cloneTo(n),a.localPosition=r,a.localRotation=s,a.localScale=n,t._avatarNodeMap={},this._initCloneToAnimator(e,t)}cloneTo(t){var e=t,i=this._rootNode.clone();e._rootNode=i}clone(){var t=new l;return this.cloneTo(t),t}_cloneDatasToAnimatorNative(t){var e=new Float32Array(3*this._nativeNodeCount),i=new Float32Array(4*this._nativeNodeCount),a=new Float32Array(3*this._nativeNodeCount),r=new Float32Array(16*this._nativeNodeCount),s=new Int16Array(this._nativeNodeCount);t._animationNodeLocalPositions=e,t._animationNodeLocalRotations=i,t._animationNodeLocalScales=a,t._animationNodeWorldMatrixs=r,t._animationNodeParentIndices=s,this._nativeCurCloneCount=0;var n=this._rootNode._cloneNative(e,i,a,r,s,-1,this),o=this._rootNode.transform,l=n.transform,h=l.localPosition,_=l.localRotation,c=l.localScale;o.localPosition.cloneTo(h),o.localRotation.cloneTo(_),o.localScale.cloneTo(c),l.localPosition=h,l.localRotation=_,l.localScale=c,t._avatarNodeMap={},this._initCloneToAnimator(n,t)}}e.a=l,r()(l,"AVATAR","AVATAR")},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(438);class n{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;r()(this,"_children",void 0),r()(this,"_parent",void 0),r()(this,"transform",void 0),r()(this,"name",void 0),r()(this,"_worldMatrixIndex",void 0),this._children=[],this.transform=new s.a(this,t,e,i,a)}addChild(t){t._parent=this,t.transform.setParent(this.transform),this._children.push(t)}removeChild(t){var e=this._children.indexOf(t);-1!==e&&this._children.splice(e,1)}getChildByName(t){for(var e=0,i=this._children.length;e<i;e++){var a=this._children[e];if(a.name===t)return a}return null}getChildByIndex(t){return this._children[t]}getChildCount(){return this._children.length}cloneTo(t){var e=t;e.name=this.name;for(var i=0,a=this._children.length;i<a;i++){var r=this._children[i],s=r.clone();e.addChild(s);var n=r.transform,o=s.transform,l=o.localPosition,h=o.localRotation,_=o.localScale;n.localPosition.cloneTo(l),n.localRotation.cloneTo(h),n.localScale.cloneTo(_),o.localPosition=l,o.localRotation=h,o.localScale=_}}clone(){var t=new n;return this.cloneTo(t),t}_cloneNative(t,e,i,a,r,s,o){var l=o._nativeCurCloneCount;r[l]=s;var h=new Float32Array(t.buffer,3*l*4,3),_=new Float32Array(e.buffer,4*l*4,4),c=new Float32Array(i.buffer,3*l*4,3),d=new Float32Array(a.buffer,16*l*4,16),u=new n(h,_,c,d);return u._worldMatrixIndex=l,this._cloneToNative(u,t,e,i,a,r,l,o),u}_cloneToNative(t,e,i,a,r,s,n,o){var l=t;l.name=this.name;for(var h=0,_=this._children.length;h<_;h++){var c=this._children[h];o._nativeCurCloneCount++;var d=c._cloneNative(e,i,a,r,s,n,o);l.addChild(d);var u=c.transform,f=d.transform,m=f.localPosition,p=f.localRotation,g=f.localScale;u.localPosition.cloneTo(m),u.localRotation.cloneTo(p),u.localScale.cloneTo(g),f.localPosition=m,f.localRotation=p,f.localScale=g}}}e.a=n},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(24),n=i(1),o=i(13),l=i(6),h=i(23);class _ extends h.a{constructor(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),r()(this,"_localMatrix",void 0),r()(this,"_worldMatrix",void 0),r()(this,"_localPosition",void 0),r()(this,"_localRotation",void 0),r()(this,"_localScale",void 0),r()(this,"_localQuaternionUpdate",void 0),r()(this,"_locaEulerlUpdate",void 0),r()(this,"_localUpdate",void 0),r()(this,"_parent",void 0),r()(this,"_children",void 0),r()(this,"_localRotationEuler",void 0),r()(this,"_owner",void 0),r()(this,"_worldUpdate",void 0),this._owner=t,this._children=[],this._localMatrix=new Float32Array(16),this._localPosition=new n.a,this._localRotation=new s.a,this._localScale=new n.a,this._worldMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}_getlocalMatrix(){return this._localUpdate&&(o.a._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix}_onWorldTransform(){if(!this._worldUpdate){this._worldUpdate=!0,this.event(l.a.TRANSFORM_CHANGED);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldTransform()}}get localPosition(){return this._localPosition}set localPosition(t){this._localPosition=t,this._localUpdate=!0,this._onWorldTransform()}get localRotation(){if(this._localQuaternionUpdate){var t=this._localRotationEuler;s.a.createFromYawPitchRoll(t.y/_._angleToRandin,t.x/_._angleToRandin,t.z/_._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation}set localRotation(t){this._localRotation=t,this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform()}get localScale(){return this._localScale}set localScale(t){this._localScale=t,this._localUpdate=!0,this._onWorldTransform()}get localRotationEuler(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll(_._tempVector3);var t=_._tempVector3,e=this._localRotationEuler;e.x=t.y*_._angleToRandin,e.y=t.x*_._angleToRandin,e.z=t.z*_._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler}set localRotationEuler(t){this._localRotationEuler=t,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,this._onWorldTransform()}getWorldMatrix(){if(this._worldUpdate){if(null!=this._parent)o.a.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else{var t=this._worldMatrix;t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1}this._worldUpdate=!1}return this._worldMatrix}setParent(t){if(this._parent!==t){if(this._parent){var e=this._parent._children,i=e.indexOf(this);e.splice(i,1)}t&&(t._children.push(this),t&&this._onWorldTransform()),this._parent=t}}}e.a=_,r()(_,"_tempVector3",new n.a),r()(_,"_angleToRandin",180/Math.PI)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(58),n=i(7),o=i(22);class l{static load(t,e){s.a.loader.create(t,e,null,o.a.MATERIAL)}static __initDefine__(){l.SHADERDEFINE_ALPHATEST=o.a.SHADERDEFINE_ALPHATEST}}e.a=l,r()(l,"MATERIAL","MATERIAL"),r()(l,"RENDERQUEUE_OPAQUE",2e3),r()(l,"RENDERQUEUE_ALPHATEST",2450),r()(l,"RENDERQUEUE_TRANSPARENT",3e3),r()(l,"ALPHATESTVALUE",n.a.propertyNameToID("u_AlphaTestValue")),r()(l,"SHADERDEFINE_ALPHATEST",null)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(5),n=i(7),o=i(22),l=i(40);class h extends o.a{static __initDefine__(){h.SHADERDEFINE_MAINTEXTURE=n.a.getDefineByName("MAINTEXTURE"),h.SHADERDEFINE_TILINGOFFSET=n.a.getDefineByName("TILINGOFFSET"),h.SHADERDEFINE_ADDTIVEFOG=n.a.getDefineByName("ADDTIVEFOG")}get _TintColorR(){return this._color.x}set _TintColorR(t){this._color.x=t,this.color=this._color}get _TintColorG(){return this._color.y}set _TintColorG(t){this._color.y=t,this.color=this._color}get _TintColorB(){return this._color.z}set _TintColorB(t){this._color.z=t,this.color=this._color}get _TintColorA(){return this._color.w}set _TintColorA(t){this._color.w=t,this.color=this._color}get _TintColor(){return this._shaderValues.getVector(h.TINTCOLOR)}set _TintColor(t){this.color=t}get _MainTex_STX(){return this._shaderValues.getVector(h.TILINGOFFSET).x}set _MainTex_STX(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.x=t,this.tilingOffset=e}get _MainTex_STY(){return this._shaderValues.getVector(h.TILINGOFFSET).y}set _MainTex_STY(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.y=t,this.tilingOffset=e}get _MainTex_STZ(){return this._shaderValues.getVector(h.TILINGOFFSET).z}set _MainTex_STZ(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.z=t,this.tilingOffset=e}get _MainTex_STW(){return this._shaderValues.getVector(h.TILINGOFFSET).w}set _MainTex_STW(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.w=t,this.tilingOffset=e}get _MainTex_ST(){return this._shaderValues.getVector(h.TILINGOFFSET)}set _MainTex_ST(t){this.tilingOffset=t}set renderMode(t){switch(t){case h.RENDERMODE_ADDTIVE:this.renderQueue=o.a.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=l.a.CULL_NONE,this.blend=l.a.BLEND_ENABLE_ALL,this.blendSrc=l.a.BLENDPARAM_SRC_ALPHA,this.blendDst=l.a.BLENDPARAM_ONE,this.depthTest=l.a.DEPTHTEST_LESS,this._shaderValues.addDefine(h.SHADERDEFINE_ADDTIVEFOG);break;case h.RENDERMODE_ALPHABLENDED:this.renderQueue=o.a.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=l.a.CULL_NONE,this.blend=l.a.BLEND_ENABLE_ALL,this.blendSrc=l.a.BLENDPARAM_SRC_ALPHA,this.blendDst=l.a.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=l.a.DEPTHTEST_LESS,this._shaderValues.removeDefine(h.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("MeshEffectMaterial : renderMode value error.")}}get colorR(){return this._TintColorR}set colorR(t){this._TintColorR=t}get colorG(){return this._TintColorG}set colorG(t){this._TintColorG=t}get colorB(){return this._TintColorB}set colorB(t){this._TintColorB=t}get colorA(){return this._TintColorA}set colorA(t){this._TintColorA=t}get color(){return this._shaderValues.getVector(h.TINTCOLOR)}set color(t){this._shaderValues.setVector(h.TINTCOLOR,t)}get texture(){return this._shaderValues.getTexture(h.MAINTEXTURE)}set texture(t){t?this._shaderValues.addDefine(h.SHADERDEFINE_MAINTEXTURE):this._shaderValues.removeDefine(h.SHADERDEFINE_MAINTEXTURE),this._shaderValues.setTexture(h.MAINTEXTURE,t)}get tilingOffsetX(){return this._MainTex_STX}set tilingOffsetX(t){this._MainTex_STX=t}get tilingOffsetY(){return this._MainTex_STY}set tilingOffsetY(t){this._MainTex_STY=t}get tilingOffsetZ(){return this._MainTex_STZ}set tilingOffsetZ(t){this._MainTex_STZ=t}get tilingOffsetW(){return this._MainTex_STW}set tilingOffsetW(t){this._MainTex_STW=t}get tilingOffset(){return this._shaderValues.getVector(h.TILINGOFFSET)}set tilingOffset(t){t&&(1!=t.x||1!=t.y||0!=t.z||0!=t.w)?this._shaderValues.addDefine(h.SHADERDEFINE_TILINGOFFSET):this._shaderValues.removeDefine(h.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(h.TILINGOFFSET,t)}get depthWrite(){return this._shaderValues.getBool(h.DEPTH_WRITE)}set depthWrite(t){this._shaderValues.setBool(h.DEPTH_WRITE,t)}get cull(){return this._shaderValues.getInt(h.CULL)}set cull(t){this._shaderValues.setInt(h.CULL,t)}get blend(){return this._shaderValues.getInt(h.BLEND)}set blend(t){this._shaderValues.setInt(h.BLEND,t)}get blendSrc(){return this._shaderValues.getInt(h.BLEND_SRC)}set blendSrc(t){this._shaderValues.setInt(h.BLEND_SRC,t)}get blendDst(){return this._shaderValues.getInt(h.BLEND_DST)}set blendDst(t){this._shaderValues.setInt(h.BLEND_DST,t)}get depthTest(){return this._shaderValues.getInt(h.DEPTH_TEST)}set depthTest(t){this._shaderValues.setInt(h.DEPTH_TEST,t)}constructor(){super(),r()(this,"_color",void 0),this.setShaderName("Effect"),this._color=new s.a(1,1,1,1),this._shaderValues.setVector(h.TINTCOLOR,new s.a(1,1,1,1)),this.renderMode=h.RENDERMODE_ADDTIVE}clone(){var t=new h;return this.cloneTo(t),t}}e.a=h,r()(h,"RENDERMODE_ADDTIVE",0),r()(h,"RENDERMODE_ALPHABLENDED",1),r()(h,"defaultMaterial",void 0),r()(h,"SHADERDEFINE_MAINTEXTURE",void 0),r()(h,"SHADERDEFINE_TILINGOFFSET",void 0),r()(h,"SHADERDEFINE_ADDTIVEFOG",void 0),r()(h,"MAINTEXTURE",n.a.propertyNameToID("u_AlbedoTexture")),r()(h,"TINTCOLOR",n.a.propertyNameToID("u_AlbedoColor")),r()(h,"TILINGOFFSET",n.a.propertyNameToID("u_TilingOffset")),r()(h,"CULL",n.a.propertyNameToID("s_Cull")),r()(h,"BLEND",n.a.propertyNameToID("s_Blend")),r()(h,"BLEND_SRC",n.a.propertyNameToID("s_BlendSrc")),r()(h,"BLEND_DST",n.a.propertyNameToID("s_BlendDst")),r()(h,"DEPTH_TEST",n.a.propertyNameToID("s_DepthTest")),r()(h,"DEPTH_WRITE",n.a.propertyNameToID("s_DepthWrite"))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(7),n=i(22),o=i(40);class l extends n.a{static __initDefine__(){l.SHADERDEFINE_DETAIL_NUM1=s.a.getDefineByName("ExtendTerrain_DETAIL_NUM1"),l.SHADERDEFINE_DETAIL_NUM2=s.a.getDefineByName("ExtendTerrain_DETAIL_NUM2"),l.SHADERDEFINE_DETAIL_NUM3=s.a.getDefineByName("ExtendTerrain_DETAIL_NUM3"),l.SHADERDEFINE_DETAIL_NUM4=s.a.getDefineByName("ExtendTerrain_DETAIL_NUM4"),l.SHADERDEFINE_DETAIL_NUM5=s.a.getDefineByName("ExtendTerrain_DETAIL_NUM5")}get splatAlphaTexture(){return this._shaderValues.getTexture(l.SPLATALPHATEXTURE)}set splatAlphaTexture(t){this._shaderValues.setTexture(l.SPLATALPHATEXTURE,t)}get diffuseTexture1(){return this._shaderValues.getTexture(l.DIFFUSETEXTURE1)}set diffuseTexture1(t){this._shaderValues.setTexture(l.DIFFUSETEXTURE1,t),this._setDetailNum(1)}get diffuseTexture2(){return this._shaderValues.getTexture(l.DIFFUSETEXTURE2)}set diffuseTexture2(t){this._shaderValues.setTexture(l.DIFFUSETEXTURE2,t),this._setDetailNum(2)}get diffuseTexture3(){return this._shaderValues.getTexture(l.DIFFUSETEXTURE3)}set diffuseTexture3(t){this._shaderValues.setTexture(l.DIFFUSETEXTURE3,t),this._setDetailNum(3)}get diffuseTexture4(){return this._shaderValues.getTexture(l.DIFFUSETEXTURE4)}set diffuseTexture4(t){this._shaderValues.setTexture(l.DIFFUSETEXTURE4,t),this._setDetailNum(4)}get diffuseTexture5(){return this._shaderValues.getTexture(l.DIFFUSETEXTURE5)}set diffuseTexture5(t){this._shaderValues.setTexture(l.DIFFUSETEXTURE5,t),this._setDetailNum(5)}set diffuseScaleOffset1(t){this._shaderValues.setVector(l.DIFFUSESCALEOFFSET1,t)}set diffuseScaleOffset2(t){this._shaderValues.setVector(l.DIFFUSESCALEOFFSET2,t)}set diffuseScaleOffset3(t){this._shaderValues.setVector(l.DIFFUSESCALEOFFSET3,t)}set diffuseScaleOffset4(t){this._shaderValues.setVector(l.DIFFUSESCALEOFFSET4,t)}set diffuseScaleOffset5(t){this._shaderValues.setVector(l.DIFFUSESCALEOFFSET5,t)}set renderMode(t){switch(t){case l.RENDERMODE_OPAQUE:this.renderQueue=n.a.RENDERQUEUE_OPAQUE,this.depthWrite=!0,this.cull=o.a.CULL_BACK,this.blend=o.a.BLEND_DISABLE,this.depthTest=o.a.DEPTHTEST_LESS;break;case l.RENDERMODE_TRANSPARENT:this.renderQueue=n.a.RENDERQUEUE_OPAQUE,this.depthWrite=!1,this.cull=o.a.CULL_BACK,this.blend=o.a.BLEND_ENABLE_ALL,this.blendSrc=o.a.BLENDPARAM_SRC_ALPHA,this.blendDst=o.a.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=o.a.DEPTHTEST_LEQUAL;break;default:throw new Error("ExtendTerrainMaterial:renderMode value error.")}}get depthWrite(){return this._shaderValues.getBool(l.DEPTH_WRITE)}set depthWrite(t){this._shaderValues.setBool(l.DEPTH_WRITE,t)}get cull(){return this._shaderValues.getInt(l.CULL)}set cull(t){this._shaderValues.setInt(l.CULL,t)}get blend(){return this._shaderValues.getInt(l.BLEND)}set blend(t){this._shaderValues.setInt(l.BLEND,t)}get blendSrc(){return this._shaderValues.getInt(l.BLEND_SRC)}set blendSrc(t){this._shaderValues.setInt(l.BLEND_SRC,t)}get blendDst(){return this._shaderValues.getInt(l.BLEND_DST)}set blendDst(t){this._shaderValues.setInt(l.BLEND_DST,t)}get depthTest(){return this._shaderValues.getInt(l.DEPTH_TEST)}set depthTest(t){this._shaderValues.setInt(l.DEPTH_TEST,t)}constructor(){super(),r()(this,"_enableLighting",!0),this.setShaderName("ExtendTerrain"),this.renderMode=l.RENDERMODE_OPAQUE}_setDetailNum(t){switch(t){case 1:this._shaderValues.addDefine(l.SHADERDEFINE_DETAIL_NUM1),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM2),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM3),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM4),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM5);break;case 2:this._shaderValues.addDefine(l.SHADERDEFINE_DETAIL_NUM2),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM1),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM3),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM4),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM5);break;case 3:this._shaderValues.addDefine(l.SHADERDEFINE_DETAIL_NUM3),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM1),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM2),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM4),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM5);break;case 4:this._shaderValues.addDefine(l.SHADERDEFINE_DETAIL_NUM4),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM1),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM2),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM3),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM5);break;case 5:this._shaderValues.addDefine(l.SHADERDEFINE_DETAIL_NUM5),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM1),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM2),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM3),this._shaderValues.removeDefine(l.SHADERDEFINE_DETAIL_NUM4)}}clone(){var t=new l;return this.cloneTo(t),t}}e.a=l,r()(l,"RENDERMODE_OPAQUE",1),r()(l,"RENDERMODE_TRANSPARENT",2),r()(l,"SPLATALPHATEXTURE",s.a.propertyNameToID("u_SplatAlphaTexture")),r()(l,"DIFFUSETEXTURE1",s.a.propertyNameToID("u_DiffuseTexture1")),r()(l,"DIFFUSETEXTURE2",s.a.propertyNameToID("u_DiffuseTexture2")),r()(l,"DIFFUSETEXTURE3",s.a.propertyNameToID("u_DiffuseTexture3")),r()(l,"DIFFUSETEXTURE4",s.a.propertyNameToID("u_DiffuseTexture4")),r()(l,"DIFFUSETEXTURE5",s.a.propertyNameToID("u_DiffuseTexture5")),r()(l,"DIFFUSESCALEOFFSET1",s.a.propertyNameToID("u_DiffuseScaleOffset1")),r()(l,"DIFFUSESCALEOFFSET2",s.a.propertyNameToID("u_DiffuseScaleOffset2")),r()(l,"DIFFUSESCALEOFFSET3",s.a.propertyNameToID("u_DiffuseScaleOffset3")),r()(l,"DIFFUSESCALEOFFSET4",s.a.propertyNameToID("u_DiffuseScaleOffset4")),r()(l,"DIFFUSESCALEOFFSET5",s.a.propertyNameToID("u_DiffuseScaleOffset5")),r()(l,"CULL",s.a.propertyNameToID("s_Cull")),r()(l,"BLEND",s.a.propertyNameToID("s_Blend")),r()(l,"BLEND_SRC",s.a.propertyNameToID("s_BlendSrc")),r()(l,"BLEND_DST",s.a.propertyNameToID("s_BlendDst")),r()(l,"DEPTH_TEST",s.a.propertyNameToID("s_DepthTest")),r()(l,"DEPTH_WRITE",s.a.propertyNameToID("s_DepthWrite")),r()(l,"SHADERDEFINE_DETAIL_NUM1",void 0),r()(l,"SHADERDEFINE_DETAIL_NUM2",void 0),r()(l,"SHADERDEFINE_DETAIL_NUM3",void 0),r()(l,"SHADERDEFINE_DETAIL_NUM4",void 0),r()(l,"SHADERDEFINE_DETAIL_NUM5",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(5),n=i(443),o=i(444),l=i(445),h=i(446),_=i(7),c=i(130),d=i(129),u=i(14);let f;!function(t){t[t.SpecularTextureAlpha=0]="SpecularTextureAlpha",t[t.AlbedoTextureAlpha=1]="AlbedoTextureAlpha"}(f||(f={}));class m extends d.a{static __init__(){m.SHADERDEFINE_SPECULARGLOSSTEXTURE=_.a.getDefineByName("SPECULARGLOSSTEXTURE"),m.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA=_.a.getDefineByName("SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA");var t={a_Position:u.a.MESH_POSITION0,a_Normal:u.a.MESH_NORMAL0,a_Tangent0:u.a.MESH_TANGENT0,a_Texcoord0:u.a.MESH_TEXTURECOORDINATE0,a_Texcoord1:u.a.MESH_TEXTURECOORDINATE1,a_BoneWeights:u.a.MESH_BLENDWEIGHT0,a_BoneIndices:u.a.MESH_BLENDINDICES0,a_MvpMatrix:u.a.MESH_MVPMATRIX_ROW0,a_WorldMat:u.a.MESH_WORLDMATRIX_ROW0},e={u_Bones:_.a.PERIOD_CUSTOM,u_MvpMatrix:_.a.PERIOD_SPRITE,u_WorldMat:_.a.PERIOD_SPRITE,u_LightmapScaleOffset:_.a.PERIOD_SPRITE,u_LightMap:_.a.PERIOD_SPRITE,u_LightMapDirection:_.a.PERIOD_SPRITE,u_SimpleAnimatorTexture:_.a.PERIOD_SPRITE,u_SimpleAnimatorParams:_.a.PERIOD_SPRITE,u_SimpleAnimatorTextureSize:_.a.PERIOD_SPRITE,u_ReflectCubeHDRParams:_.a.PERIOD_SPRITE,u_ReflectTexture:_.a.PERIOD_SPRITE,u_SpecCubeProbePosition:_.a.PERIOD_SPRITE,u_SpecCubeBoxMax:_.a.PERIOD_SPRITE,u_SpecCubeBoxMin:_.a.PERIOD_SPRITE,u_CameraPos:_.a.PERIOD_CAMERA,u_View:_.a.PERIOD_CAMERA,u_ProjectionParams:_.a.PERIOD_CAMERA,u_Viewport:_.a.PERIOD_CAMERA,u_ViewProjection:_.a.PERIOD_CAMERA,u_AlphaTestValue:_.a.PERIOD_MATERIAL,u_AlbedoColor:_.a.PERIOD_MATERIAL,u_EmissionColor:_.a.PERIOD_MATERIAL,u_AlbedoTexture:_.a.PERIOD_MATERIAL,u_NormalTexture:_.a.PERIOD_MATERIAL,u_ParallaxTexture:_.a.PERIOD_MATERIAL,u_OcclusionTexture:_.a.PERIOD_MATERIAL,u_EmissionTexture:_.a.PERIOD_MATERIAL,u_Smoothness:_.a.PERIOD_MATERIAL,u_SmoothnessScale:_.a.PERIOD_MATERIAL,u_occlusionStrength:_.a.PERIOD_MATERIAL,u_NormalScale:_.a.PERIOD_MATERIAL,u_ParallaxScale:_.a.PERIOD_MATERIAL,u_TilingOffset:_.a.PERIOD_MATERIAL,u_SpecGlossTexture:_.a.PERIOD_MATERIAL,u_SpecularColor:_.a.PERIOD_MATERIAL,u_AmbientColor:_.a.PERIOD_SCENE,u_FogStart:_.a.PERIOD_SCENE,u_FogRange:_.a.PERIOD_SCENE,u_FogColor:_.a.PERIOD_SCENE,u_DirationLightCount:_.a.PERIOD_SCENE,u_LightBuffer:_.a.PERIOD_SCENE,u_LightClusterBuffer:_.a.PERIOD_SCENE,u_ShadowBias:_.a.PERIOD_SCENE,u_ShadowLightDirection:_.a.PERIOD_SCENE,u_ShadowMap:_.a.PERIOD_SCENE,u_ShadowParams:_.a.PERIOD_SCENE,u_ShadowSplitSpheres:_.a.PERIOD_SCENE,u_ShadowMatrices:_.a.PERIOD_SCENE,u_ShadowMapSize:_.a.PERIOD_SCENE,u_SpotShadowMap:_.a.PERIOD_SCENE,u_SpotViewProjectMatrix:_.a.PERIOD_SCENE,u_ShadowLightPosition:_.a.PERIOD_SCENE,u_AmbientSHAr:_.a.PERIOD_SCENE,u_AmbientSHAg:_.a.PERIOD_SCENE,u_AmbientSHAb:_.a.PERIOD_SCENE,u_AmbientSHBr:_.a.PERIOD_SCENE,u_AmbientSHBg:_.a.PERIOD_SCENE,u_AmbientSHBb:_.a.PERIOD_SCENE,u_AmbientSHC:_.a.PERIOD_SCENE,"u_DirectionLight.direction":_.a.PERIOD_SCENE,"u_DirectionLight.color":_.a.PERIOD_SCENE,"u_PointLight.position":_.a.PERIOD_SCENE,"u_PointLight.range":_.a.PERIOD_SCENE,"u_PointLight.color":_.a.PERIOD_SCENE,"u_SpotLight.position":_.a.PERIOD_SCENE,"u_SpotLight.direction":_.a.PERIOD_SCENE,"u_SpotLight.range":_.a.PERIOD_SCENE,"u_SpotLight.spot":_.a.PERIOD_SCENE,"u_SpotLight.color":_.a.PERIOD_SCENE},i={s_Cull:_.a.RENDER_STATE_CULL,s_Blend:_.a.RENDER_STATE_BLEND,s_BlendSrc:_.a.RENDER_STATE_BLEND_SRC,s_BlendDst:_.a.RENDER_STATE_BLEND_DST,s_DepthTest:_.a.RENDER_STATE_DEPTH_TEST,s_DepthWrite:_.a.RENDER_STATE_DEPTH_WRITE},a=_.a.add("PBRSpecular",t,e,!0,!0),r=new c.a(t,e);a.addSubShader(r),r.addShaderPass(o.a,n.a,i,"Forward"),r.addShaderPass(h.a,l.a,i,"ShadowCaster")}get specularTexture(){return this._shaderValues.getTexture(m.SPECULARTEXTURE)}set specularTexture(t){t?this._shaderValues.addDefine(m.SHADERDEFINE_SPECULARGLOSSTEXTURE):this._shaderValues.removeDefine(m.SHADERDEFINE_SPECULARGLOSSTEXTURE),this._shaderValues.setTexture(m.SPECULARTEXTURE,t)}get specularColor(){return this._shaderValues.getVector(m.SPECULARCOLOR)}set specularColor(t){this._shaderValues.setVector(m.SPECULARCOLOR,t)}constructor(){super(),this.setShaderName("PBRSpecular"),this._shaderValues.setVector(m.SPECULARCOLOR,new s.a(.2,.2,.2,1))}clone(){var t=new m;return this.cloneTo(t),t}}e.a=m,r()(m,"SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA",void 0),r()(m,"SHADERDEFINE_SPECULARGLOSSTEXTURE",void 0),r()(m,"SPECULARTEXTURE",_.a.propertyNameToID("u_SpecGlossTexture")),r()(m,"SPECULARCOLOR",_.a.propertyNameToID("u_SpecularColor")),r()(m,"defaultMaterial",void 0)},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n\tprecision highp int;\n#else\n\tprecision mediump float;\n\tprecision mediump int;\n#endif\n\n#define SETUP_BRDF_INPUT specularSetup\n\n#include "Lighting.glsl";\n#include "PBRFSInput.glsl";\n#include "LayaPBRBRDF.glsl";\n#include "GlobalIllumination.glsl";\n#include "Shadow.glsl"\n#include "PBRCore.glsl";\n\nvoid main()\n{\n\tfragmentForward();\n}'},function(t,e,i){"use strict";e.a='#include "PBRVSInput.glsl";\n#include "Lighting.glsl";\n#include "PBRVertex.glsl";\n\nvoid main()\n{\n\tvertexForward();\n\tgl_Position=remapGLPositionZ(gl_Position);\n}'},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n\tprecision highp int;\n#else\n\tprecision mediump float;\n\tprecision mediump int;\n#endif\n\n#include "ShadowCasterFS.glsl"\n\nvoid main()\n{\n\tgl_FragColor=shadowCasterFragment();\n}'},function(t,e,i){"use strict";e.a='#include "ShadowCasterVS.glsl"\n\nvoid main()\n{\n\tvec4 positionCS =  shadowCasterVertex();\n\tgl_Position=remapGLPositionZ(positionCS);\n}'},function(t,e,i){"use strict";var a=i(28),r=(i.n(a),i(18)),s=(i.n(r),i(115)),n=(i.n(s),i(0)),o=i.n(n),l=i(72),h=i(81),_=i(168),c=i(252),d=i(97),u=i(40),f=i(54),m=i(7),p=i(277),g=i(270),v=i(181);class T extends _.a{get renderState(){return this._renderState}constructor(t,e,i,a){for(var r in super(e,i,null),o()(this,"_owner",void 0),o()(this,"_stateMap",void 0),o()(this,"_cacheSharders",{}),o()(this,"_cacheShaderHierarchy",1),o()(this,"_renderState",new u.a),o()(this,"_validDefine",new f.a),o()(this,"_tags",{}),o()(this,"_pipelineMode",void 0),this._owner=t,this._stateMap=a,this.defs)this._validDefine.add(m.a.getDefineByName(r))}_compileToTree(t,e,i,a,r){var s,n,o,l,h,d,u,f,m,p,g;for(m=i;m<e.length;m++)if(!((o=e[m]).length<1)&&0!==(d=o.indexOf("//"))){if(d>=0&&(o=o.substr(0,d)),s=f||new c.a(a),f=null,s.text=o,s.noCompile=!0,(d=o.indexOf("#"))>=0){for(l="#",g=d+1,p=o.length;g<p;g++){var v=o.charAt(g);if(" "===v||"\t"===v||"?"===v)break;l+=v}switch(s.name=l,l){case"#ifdef":case"#ifndef":if(s.src=o,s.noCompile=null!=o.match(/[!&|()=<>]/),s.noCompile?console.log("function():Boolean{return "+o.substr(d+s.name.length)+"}"):(u=o.replace(/^\s*/,"").split(/\s+/),s.setCondition(u[1],"#ifdef"===l?_.a.IFDEF_YES:_.a.IFDEF_ELSE),s.text="//"+s.text),s.setParent(t),t=s,r)for(u=o.substr(g).split(_.a._splitToWordExps3),g=0;g<u.length;g++)(o=u[g]).length&&(r[o]=!0);continue;case"#if":case"#elif":if(s.src=o,s.noCompile=!0,"#elif"==l&&((n=(t=t.parent).childs[t.childs.length-1]).text=n.src,n.noCompile=!0,n.condition=null),s.setParent(t),t=s,r)for(u=o.substr(g).split(_.a._splitToWordExps3),g=0;g<u.length;g++)(o=u[g]).length&&"defined"!=o&&(r[o]=!0);continue;case"#else":s.src=o,n=(t=t.parent).childs[t.childs.length-1],s.noCompile=n.noCompile,s.noCompile||(s.condition=n.condition,s.conditionType=n.conditionType==_.a.IFDEF_YES?_.a.IFDEF_ELSE:_.a.IFDEF_YES,s.text="//"+s.text+" "+n.text+" "+s.conditionType),s.setParent(t),t=s;continue;case"#endif":n=(t=t.parent).childs[t.childs.length-1],s.noCompile=n.noCompile,s.noCompile||(s.text="//"+s.text),s.setParent(t);continue;case"#include":u=_.a.splitToWords(o,null);var T=_.a.includes[u[1]];if(!T)throw"ShaderCompile error no this include file:"+u[1];if((d=u[0].indexOf("?"))<0){s.setParent(t),o=T.getWith("with"==u[2]?u[3]:null),this._compileToTree(s,o.split("\n"),0,a,r),s.text="";continue}s.setCondition(u[0].substr(d+1),_.a.IFDEF_YES),s.text=T.getWith("with"==u[2]?u[3]:null);break;case"#import":h=(u=_.a.splitToWords(o,null))[1],a.push({node:s,file:_.a.includes[h],ofs:s.text.length});continue}}else{if((n=t.childs[t.childs.length-1])&&!n.name){a.length>0&&_.a.splitToWords(o,n),f=s,n.text+="\n"+o;continue}a.length>0&&_.a.splitToWords(o,s)}s.setParent(t)}}_resizeCacheShaderMap(t,e,i){var a=this._cacheShaderHierarchy-1;if(e==a){for(var r in t)for(var s=t[r],n=0,o=i-a;n<o;n++)n==o-1?t[0]=s:t=t[0==n?r:0]={};this._cacheShaderHierarchy=i}else for(var r in t)this._resizeCacheShaderMap(t[r],++e,i)}_addDebugShaderVariantCollection(t,e,i){var a=m.a._debugShaderVariantInfo,r=this._owner,s=r._owner,n=t._mask;m.a._getNamesByDefineData(t,e),i.length=n.length;for(var o=0,l=n.length;o<l;o++)i[o]=n[o];a?a.setValue(s,s._subShaders.indexOf(r),r._passes.indexOf(this),e):m.a._debugShaderVariantInfo=a=new g.a(s,s._subShaders.indexOf(r),r._passes.indexOf(this),e),m.a.debugShaderVariantCollection.add(a)}withCompile(t){var e,i=T._debugDefineString,a=T._debugDefineMask;t._intersectionDefineDatas(this._validDefine),m.a.debugMode&&(e=t._length,this._addDebugShaderVariantCollection(t,i,a)),t.addDefineDatas(v.a._configDefineValues);var r=this._cacheSharders,s=t._length;s>this._cacheShaderHierarchy&&(this._resizeCacheShaderMap(r,0,s),this._cacheShaderHierarchy=s);for(var n=t._mask,o=t._length-1,_=this._cacheShaderHierarchy-1,c=0;c<_;c++){var u=o<c?0:n[c],f=r[u];f||(r[u]=f={}),r=f}var g=o<_?0:n[_],E=r[g];if(E)return E;var S=T._defineString;m.a._getNamesByDefineData(t,S);var R,x,A=l.a._config,y=A.lightClusterCount,I={},C="";d.a._isWebGL2?(R="#version 300 es\n\n\t\t\t\t#define attribute in\n\t\t\t\t#define varying out\n\t\t\t\t#define texture2D texture\n",x="#version 300 es\n\n\t\t\t\t#define varying in\n\t\t\t\tout highp vec4 pc_fragColor;\n\t\t\t\t#define gl_FragColor pc_fragColor\n\t\t\t\t#define gl_FragDepthEXT gl_FragDepth\n\t\t\t\t#define texture2D texture\n\t\t\t\t#define textureCube texture\n\t\t\t\t#define texture2DProj textureProj\n\t\t\t\t#define texture2DLodEXT textureLod\n\t\t\t\t#define texture2DProjLodEXT textureProjLod\n\t\t\t\t#define textureCubeLodEXT textureLod\n\t\t\t\t#define texture2DGradEXT textureGrad\n\t\t\t\t#define texture2DProjGradEXT textureProjGrad\n\t\t\t\t#define textureCubeGradEXT textureGrad\n"):(R="",x="#ifdef GL_EXT_shader_texture_lod\n\t\t\t\t\t#extension GL_EXT_shader_texture_lod : enable\n\t\t\t\t#endif\n\t\t\t\t#if !defined(GL_EXT_shader_texture_lod)\n\t\t\t\t\t#define texture1DLodEXT texture1D\n\t\t\t\t\t#define texture2DLodEXT texture2D\n\t\t\t\t\t#define texture2DProjLodEXT texture2DProj\n\t\t\t\t\t#define texture3DLodEXT texture3D\n\t\t\t\t\t#define textureCubeLodEXT textureCube\n\t\t\t\t#endif\n"),C+="#define MAX_LIGHT_COUNT "+A.maxLightCount+"\n",C+="#define MAX_LIGHT_COUNT_PER_CLUSTER "+A._maxAreaLightCountPerClusterAverage+"\n",C+="#define CLUSTER_X_COUNT "+y.x+"\n",C+="#define CLUSTER_Y_COUNT "+y.y+"\n",C+="#define CLUSTER_Z_COUNT "+y.z+"\n",C+="#define SHADER_CAPAILITY_LEVEL "+h.a._shaderCapailityLevel+"\n";c=0;for(var M=S.length;c<M;c++){var D=S[c];C+="#define "+D+"\n",I[D]=!0}var b=this._VS.toscript(I,[]),L="";0==b[0].indexOf("#version")&&(L=b[0]+"\n",b.shift());var O=this._PS.toscript(I,[]),P="";0==O[0].indexOf("#version")&&(P=O[0]+"\n",O.shift());var N=m.a.getAttributeMapByDefine(S,this._owner._attributeMap);if(E=new p.a(L+R+C+b.join("\n"),P+x+C+O.join("\n"),N,this._owner._uniformMap||this._owner._owner._uniformMap,this),r[g]=E,m.a.debugMode){var w="",B="";for(c=0,M=e;c<M;c++)B+=c==M-1?a[c]:a[c]+",";for(c=0,M=i.length;c<M;c++)w+=c==M-1?i[c]:i[c]+",";console.log("%cLayaAir: Shader Compile Information---ShaderName:"+this._owner._owner._name+" SubShaderIndex:"+this._owner._owner._subShaders.indexOf(this._owner)+" PassIndex:"+this._owner._passes.indexOf(this)+" DefineMask:["+B+"] DefineNames:["+w+"]","color:green")}return E}setTag(t,e){e?this._tags[t]=e:delete this._tags[t]}getTag(t){return this._tags[t]}}e.a=T,o()(T,"_defineString",[]),o()(T,"_debugDefineString",[]),o()(T,"_debugDefineMask",[])},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){r()(this,"name",void 0),r()(this,"type",void 0),r()(this,"location",void 0),r()(this,"isArray",void 0),r()(this,"textureID",void 0),r()(this,"dataOffset",void 0),r()(this,"caller",void 0),r()(this,"fun",void 0),r()(this,"uploadedValue",void 0),this.textureID=-1}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{constructor(){r()(this,"_coefficients",new Float32Array(27))}getCoefficient(t,e){return this._coefficients[9*t+e]}setCoefficient(t,e,i){this._coefficients[9*t+e]=i}setCoefficients(t,e,i,a,r,s,n,o,l,h){var _=9*t;this._coefficients[_]=e,this._coefficients[++_]=i,this._coefficients[++_]=a,this._coefficients[++_]=r,this._coefficients[++_]=s,this._coefficients[++_]=n,this._coefficients[++_]=o,this._coefficients[++_]=l,this._coefficients[++_]=h}cloneTo(t){if(this!==t)for(var e=this._coefficients,i=t._coefficients,a=0;a<27;a++)i[a]=e[a]}}e.a=s,r()(s,"_default",new s)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(16),n=i(8),o=i(451),l=i(452),h=i(279),_=i(87),c=i(272),d=i(20),u=i(1),f=i(259),m=i(170),p=i(50),g=i(3),v=i(72);class T{__init__(t,e){this._scene=e,t.oncontextmenu=function(t){return!1}}_onCanvasEvent(t){t.addEventListener("mousedown",this._pushEventList),t.addEventListener("mouseup",this._pushEventList,!0),t.addEventListener("mousemove",this._pushEventList,!0),t.addEventListener("touchstart",this._pushEventList),t.addEventListener("touchend",this._pushEventList,!0),t.addEventListener("touchmove",this._pushEventList,!0),t.addEventListener("touchcancel",this._pushEventList,!0)}_offCanvasEvent(t){t.removeEventListener("mousedown",this._pushEventList),t.removeEventListener("mouseup",this._pushEventList,!0),t.removeEventListener("mousemove",this._pushEventList,!0),t.removeEventListener("touchstart",this._pushEventList),t.removeEventListener("touchend",this._pushEventList,!0),t.removeEventListener("touchmove",this._pushEventList,!0),t.removeEventListener("touchcancel",this._pushEventList,!0),this._eventList.length=0,this._touches.clear()}touchCount(){return this._touches.length}get multiTouchEnabled(){return this._multiTouchEnabled}set multiTouchEnabled(t){this._multiTouchEnabled=t}constructor(){r()(this,"_scene",void 0),r()(this,"_eventList",[]),r()(this,"_mouseTouch",new o.a),r()(this,"_touchPool",[]),r()(this,"_touches",new h.a),r()(this,"_multiTouchEnabled",!0),r()(this,"_pushEventList",(t=>{t.cancelable&&t.preventDefault(),this._eventList.push(t)}).bind(this))}_getTouch(t,e){var i=this._touchPool[t];return 0==e&&i&&-1!=i._getIndexInList()?null:1==e&&i&&-1==i._getIndexInList()?null:(i||(i=new l.a,this._touchPool[t]=i,i._identifier=t),i)}_mouseTouchDown(){var t=this._mouseTouch,e=t.sprite;if(t._pressedSprite=e,t._pressedLoopCount=n.a.loopCount,e){var i=e._scripts;if(i)for(var a=0,r=i.length;a<r;a++)i[a].onMouseDown()}}_mouseTouchUp(){var t,e,i=this._mouseTouch,a=i._pressedSprite;i._pressedSprite=null,i._pressedLoopCount=-1;var r=i.sprite;if(r&&r===a){var s=r._scripts;if(s)for(t=0,e=s.length;t<e;t++)s[t].onMouseClick()}if(a){var n=a._scripts;if(n)for(t=0,e=n.length;t<e;t++)n[t].onMouseUp()}}_mouseTouchRayCast(t){var e=T._tempHitResult0,i=T._tempVector20,a=T._tempRay0;e.succeeded=!1;var r=this._mouseTouch.mousePositionX,s=this._mouseTouch.mousePositionY;i.x=r,i.y=s;for(var n=t.length-1;n>=0;n--){var o=t[n],l=o.viewport;if(i.x>=l.x&&i.y>=l.y&&i.x<=l.width&&i.y<=l.height)if(o.viewportPointToRay(i,a),this._scene._physicsSimulation.rayCast(a,e)||o.clearFlag===_.b.SolidColor||o.clearFlag===_.b.Sky)break}var h=this._mouseTouch,c=h.sprite;if(e.succeeded){var d=e.collider.owner;h.sprite=d;var u=d._scripts;if(c!==d&&u)for(var f=0,m=u.length;f<m;f++)u[f].onMouseEnter()}else h.sprite=null;if(c&&c!==d){var p=c._scripts;if(p)for(f=0,m=p.length;f<m;f++)p[f].onMouseOut()}}_changeTouches(t,e){for(var i=0,a=0,r=this._touches.length,s=0,n=t.length;s<n;s++){var o=t[s],l=o.identifier;if(this._multiTouchEnabled||0===l){var h=this._getTouch(l,e),_=this._touchPool[l]._position,c=T._tempPoint;c.setTo(o.pageX,o.pageY),g.a.stage._canvasTransform.invertTransformPoint(c);var d=c.x,u=c.y;switch(e){case 0:h&&this._touches.add(h),i+=d,a+=u;break;case 1:h&&this._touches.remove(h),i-=d,a-=u;break;case 2:i=d-_.x,a=u-_.y}_.x=d,_.y=u}}var f=this._touches.length;0===f?(this._mouseTouch.mousePositionX=0,this._mouseTouch.mousePositionY=0):(this._mouseTouch.mousePositionX=(this._mouseTouch.mousePositionX*r+i)/f,this._mouseTouch.mousePositionY=(this._mouseTouch.mousePositionY*r+a)/f)}_update(){var t,e,i,a,r=p.a._enablePhysics&&!m.a.disableSimulation;e=this._eventList.length;var s=this._scene._cameraPool;if(e>0){var o=!1;for(t=0;t<e;t++){var l=this._eventList[t];switch(l.type){case"mousedown":r&&this._mouseTouchDown();break;case"mouseup":r&&this._mouseTouchUp();break;case"mousemove":var h=T._tempPoint;h.setTo(l.pageX,l.pageY),g.a.stage._canvasTransform.invertTransformPoint(h),this._mouseTouch.mousePositionX=h.x,this._mouseTouch.mousePositionY=h.y,r&&(o=!0);break;case"touchstart":var _=this._touches.length;this._changeTouches(l.changedTouches,0),r&&(!v.a._config.isUseCannonPhysicsEngine&&this._mouseTouchRayCast(s),0===_&&this._mouseTouchDown());break;case"touchend":case"touchcancel":this._changeTouches(l.changedTouches,1),r&&0===this._touches.length&&this._mouseTouchUp();break;case"touchmove":this._changeTouches(l.changedTouches,2),r&&(o=!0);break;default:throw"Input3D:unkonwn event type."}}o&&!v.a._config.isUseCannonPhysicsEngine&&this._mouseTouchRayCast(s),this._eventList.length=0}if(r){var c=this._mouseTouch,d=c._pressedSprite;if(d&&n.a.loopCount>c._pressedLoopCount){var u=d._scripts;if(u)for(i=0,a=u.length;i<a;i++)u[i].onMouseDrag()}var f=c.sprite;if(f){var E=f._scripts;if(E)for(i=0,a=E.length;i<a;i++)E[i].onMouseOver()}}}getTouch(t){return t<this._touches.length?this._touches.elements[t]:null}}e.a=T,r()(T,"_tempPoint",new s.a),r()(T,"_tempVector20",new d.a),r()(T,"_tempRay0",new c.a(new u.a,new u.a)),r()(T,"_tempHitResult0",new f.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){r()(this,"_pressedSprite",null),r()(this,"_pressedLoopCount",-1),r()(this,"sprite",null),r()(this,"mousePositionX",0),r()(this,"mousePositionY",0)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(20);e.a=class{get identifier(){return this._identifier}get position(){return this._position}constructor(){r()(this,"_indexInList",-1),r()(this,"_identifier",-1),r()(this,"_position",new s.a)}_getIndexInList(){return this._indexInList}_setIndexInList(t){this._indexInList=t}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{constructor(){r()(this,"_length",0),r()(this,"_elements",[])}add(t){this._length===this._elements.length?this._elements.push(t):this._elements[this._length]=t,this._length++}remove(t){var e=this._elements.indexOf(t);if(this._length--,e!==this._length){var i=this._elements[this._length];this._elements[e]=i}}shift(){return this._length--,this._elements.shift()}getBrightestLight(){for(var t,e=-1,i=this._elements,a=0;a<this._length;a++){var r=i[a]._intensity;e<r&&(e=r,t=a)}return t}normalLightOrdering(t){this._elements;var e=this._elements[0];this._elements[0]=this._elements[t],this._elements[t]=e}}e.b=s;e.a=class extends s{remove(t){var e=this._elements.indexOf(t);this._elements.splice(e,1),this._length--}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(455),n=i(456),o=i(183),l=i(41),h=i(64);class _ extends l.a{get maxLineCount(){return this._geometryFilter._maxLineCount}set maxLineCount(t){this._geometryFilter._resizeLineData(t),this._geometryFilter._lineCount=Math.min(this._geometryFilter._lineCount,t)}get lineCount(){return this._geometryFilter._lineCount}set lineCount(t){if(t>this.maxLineCount)throw"PixelLineSprite3D: lineCount can't large than maxLineCount";this._geometryFilter._lineCount=t}get pixelLineRenderer(){return this._render}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),r()(this,"_geometryFilter",void 0),this._geometryFilter=new s.a(this,t),this._render=new n.a(this),this._changeRenderObjects(this._render,0,o.a.defaultMaterial)}_changeRenderObjects(t,e,i){var a=this._render._renderElements;i||(i=o.a.defaultMaterial);var r=a[e];r||(r=a[e]=new h.a),r.setTransform(this._transform),r.setGeometry(this._geometryFilter),r.render=this._render,r.material=i}addLine(t,e,i,a){if(this._geometryFilter._lineCount===this._geometryFilter._maxLineCount)throw"PixelLineSprite3D: lineCount has equal with maxLineCount.";this._geometryFilter._updateLineData(this._geometryFilter._lineCount++,t,e,i,a)}addLines(t){var e=this._geometryFilter._lineCount,i=t.length;if(e+i>this._geometryFilter._maxLineCount)throw"PixelLineSprite3D: lineCount plus lines count must less than maxLineCount.";this._geometryFilter._updateLineDatas(e,t),this._geometryFilter._lineCount+=i}removeLine(t){if(!(t<this._geometryFilter._lineCount))throw"PixelLineSprite3D: index must less than lineCount.";this._geometryFilter._removeLineData(t)}setLine(t,e,i,a,r){if(!(t<this._geometryFilter._lineCount))throw"PixelLineSprite3D: index must less than lineCount.";this._geometryFilter._updateLineData(t,e,i,a,r)}getLine(t,e){if(!(t<this.lineCount))throw"PixelLineSprite3D: index must less than lineCount.";this._geometryFilter._getLineData(t,e)}clear(){this._geometryFilter._lineCount=0}_create(){return new _}}e.a=_},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(8),o=i(25),l=i(1),h=i(74),_=i(38),c=i(75),d=i(283);class u extends c.a{constructor(t,e){super(),r()(this,"_floatCountPerVertices",7),r()(this,"_owner",void 0),r()(this,"_vertexBuffer",void 0),r()(this,"_vertices",void 0),r()(this,"_minUpdate",Number.MAX_VALUE),r()(this,"_maxUpdate",Number.MIN_VALUE),r()(this,"_bufferState",new _.a),r()(this,"_floatBound",new Float32Array(6)),r()(this,"_calculateBound",!1),r()(this,"_bounds",void 0),r()(this,"_maxLineCount",0),r()(this,"_lineCount",0);var i=2*e;this._owner=t,this._maxLineCount=e,this._vertices=new Float32Array(i*this._floatCountPerVertices),this._vertexBuffer=new o.a(d.a.vertexDeclaration.vertexStride*i,s.a.instance.STATIC_DRAW,!1),this._vertexBuffer.vertexDeclaration=d.a.vertexDeclaration,this._bufferState.bind(),this._bufferState.applyVertexBuffer(this._vertexBuffer),this._bufferState.unBind();var a=u._tempVector0,n=u._tempVector1;a.setValue(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n.setValue(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._bounds=new h.a(a,n)}_getType(){return u._type}_resizeLineData(t){var e=2*t,i=this._vertices;this._vertexBuffer.destroy(),this._maxLineCount=t;var a=e*this._floatCountPerVertices;this._vertices=new Float32Array(a),this._vertexBuffer=new o.a(d.a.vertexDeclaration.vertexStride*e,s.a.instance.STATIC_DRAW,!1),this._vertexBuffer.vertexDeclaration=d.a.vertexDeclaration,a<i.length?(this._vertices.set(new Float32Array(i.buffer,0,a)),this._vertexBuffer.setData(this._vertices.buffer,0,0,4*a)):(this._vertices.set(i),this._vertexBuffer.setData(this._vertices.buffer,0,0,4*i.length)),this._bufferState.bind(),this._bufferState.applyVertexBuffer(this._vertexBuffer),this._bufferState.unBind()}_updateLineVertices(t,e,i,a,r){e&&(this._vertices[t+0]=e.x,this._vertices[t+1]=e.y,this._vertices[t+2]=e.z),a&&(this._vertices[t+3]=a.r,this._vertices[t+4]=a.g,this._vertices[t+5]=a.b,this._vertices[t+6]=a.a),i&&(this._vertices[t+7]=i.x,this._vertices[t+8]=i.y,this._vertices[t+9]=i.z),r&&(this._vertices[t+10]=r.r,this._vertices[t+11]=r.g,this._vertices[t+12]=r.b,this._vertices[t+13]=r.a),this._minUpdate=Math.min(this._minUpdate,t),this._maxUpdate=Math.max(this._maxUpdate,t+2*this._floatCountPerVertices);var s=this._bounds,n=this._floatBound,o=s.getMin(),h=s.getMax();l.a.min(o,e,o),l.a.min(o,i,o),l.a.max(h,e,h),l.a.max(h,i,h),s.setMin(o),s.setMax(h),n[0]=o.x,n[1]=o.y,n[2]=o.z,n[3]=h.x,n[4]=h.y,n[5]=h.z}_reCalculateBound(){if(this._calculateBound){var t=this._vertices,e=u._tempVector0,i=u._tempVector1;e.setValue(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i.setValue(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var a=0;a<2*this._lineCount;++a){var r=this._floatCountPerVertices*a,s=t[r+0],n=t[r+1],o=t[r+2];e.x=Math.min(s,e.x),e.y=Math.min(n,e.y),e.z=Math.min(o,e.z),i.x=Math.max(s,i.x),i.y=Math.max(n,i.y),i.z=Math.max(o,i.z)}this._bounds.setMin(e),this._bounds.setMax(i);var l=this._floatBound;l[0]=e.x,l[1]=e.y,l[2]=e.z,l[3]=i.x,l[4]=i.y,l[5]=i.z,this._calculateBound=!1}}_removeLineData(t){var e=2*this._floatCountPerVertices,i=t+1,a=t*e,r=this._vertices,s=new Float32Array(r.buffer,i*e*4,(this._lineCount-i)*e);r.set(s,a),this._minUpdate=Math.min(this._minUpdate,a),this._maxUpdate=Math.max(this._maxUpdate,a+s.length),this._lineCount--;var n=this._floatBound,o=r[a],l=r[a+1],h=r[a+2],_=r[a+7],c=r[a+8],d=r[a+9],u=n[0],f=n[1],m=n[2],p=n[3],g=n[4],v=n[5];o!==u&&o!==p&&l!==f&&l!==g&&h!==m&&h!==v&&_!==u&&_!==p&&c!==f&&c!==g&&d!==m&&d!==v||(this._calculateBound=!0)}_updateLineData(t,e,i,a,r){var s=2*this._floatCountPerVertices;this._updateLineVertices(t*s,e,i,a,r)}_updateLineDatas(t,e){for(var i=2*this._floatCountPerVertices,a=e.length,r=0;r<a;r++){var s=e[r];this._updateLineVertices((t+r)*i,s.startPosition,s.endPosition,s.startColor,s.endColor)}}_getLineData(t,e){var i=e.startPosition,a=e.startColor,r=e.endPosition,s=e.endColor,n=this._vertices,o=t*this._floatCountPerVertices*2;i.x=n[o+0],i.y=n[o+1],i.z=n[o+2],a.r=n[o+3],a.g=n[o+4],a.b=n[o+5],a.a=n[o+6],r.x=n[o+7],r.y=n[o+8],r.z=n[o+9],s.r=n[o+10],s.g=n[o+11],s.b=n[o+12],s.a=n[o+13]}_prepareRender(t){return!0}_render(t){if(this._minUpdate!==Number.MAX_VALUE&&this._maxUpdate!==Number.MIN_VALUE&&(this._vertexBuffer.setData(this._vertices.buffer,4*this._minUpdate,4*this._minUpdate,4*(this._maxUpdate-this._minUpdate)),this._minUpdate=Number.MAX_VALUE,this._maxUpdate=Number.MIN_VALUE),this._lineCount>0){this._bufferState.bind();var e=s.a.instance;e.drawArrays(e.LINES,0,2*this._lineCount),n.a.renderBatches++}}destroy(){this._destroyed||(super.destroy(),this._bufferState.destroy(),this._vertexBuffer.destroy(),this._bufferState=null,this._vertexBuffer=null,this._vertices=null)}}e.a=u,r()(u,"_tempVector0",new l.a),r()(u,"_tempVector1",new l.a),r()(u,"_type",c.a._typeCounter++)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(9),n=i(133),o=i(33);e.a=class extends n.a{constructor(t){super(t),r()(this,"_projectionViewWorldMatrix",void 0),this._projectionViewWorldMatrix=new s.a}_calculateBoundingBox(){var t=this._owner.transform.worldMatrix,e=this._owner._geometryFilter;e._reCalculateBound(),e._bounds._tranform(t,this._bounds)}_renderUpdateWithCamera(t,e){var i=t.projectionViewMatrix,a=this._shaderValues;if(e){var r=e.worldMatrix;a.setMatrix4x4(o.a.WORLDMATRIX,r),s.a.multiply(i,r,this._projectionViewWorldMatrix),a.setMatrix4x4(o.a.MVPMATRIX,this._projectionViewWorldMatrix)}else a.setMatrix4x4(o.a.WORLDMATRIX,s.a.DEFAULT),a.setMatrix4x4(o.a.MVPMATRIX,i)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(17),o=i(8),l=i(38),h=i(75),_=i(9),c=i(24),d=i(1),u=i(13),f=i(57),m=i(14),p=i(25),g=i(39);class v extends h.a{constructor(t,e){super(),r()(this,"_currentBatchVertexCount",void 0),r()(this,"_currentBatchIndexCount",void 0),r()(this,"_vertexDeclaration",void 0),r()(this,"_vertexBuffer",void 0),r()(this,"_indexBuffer",void 0),r()(this,"_bufferState",new l.a),r()(this,"_batchElements",void 0),r()(this,"_batchID",void 0),r()(this,"batchOwner",void 0),this._batchID=v._batchIDCounter++,this._batchElements=[],this._currentBatchVertexCount=0,this._currentBatchIndexCount=0,this._vertexDeclaration=e,this.batchOwner=t}_getStaticBatchBakedVertexs(t,e,i,a,r,s){var n,o=s._vertexBuffer,l=o.vertexDeclaration,h=l.getVertexElementByUsage(m.a.MESH_POSITION0)._offset/4,c=l.getVertexElementByUsage(m.a.MESH_NORMAL0),d=c?c._offset/4:-1,f=l.getVertexElementByUsage(m.a.MESH_COLOR0),p=f?f._offset/4:-1,g=l.getVertexElementByUsage(m.a.MESH_TEXTURECOORDINATE0),T=g?g._offset/4:-1,E=l.getVertexElementByUsage(m.a.MESH_TEXTURECOORDINATE1),S=E?E._offset/4:-1,R=l.getVertexElementByUsage(m.a.MESH_TANGENT0),x=R?R._offset/4:-1,A=l.vertexStride/4,y=o.getFloat32Data();i?(i.worldMatrix.invert(v._tempMatrix4x40),n=v._tempMatrix4x41,_.a.multiply(v._tempMatrix4x40,a.worldMatrix,n)):n=a.worldMatrix;var I=v._tempMatrix4x42;n.invert(I),I.transpose();var C=v._tempQuaternion0;n.decomposeTransRotScale(v._tempVector30,C,v._tempVector31);for(var M=r.lightmapScaleOffset,D=s.vertexCount,b=0;b<D;b++){var L,O,P=b*A,N=18*(b+e);u.a.transformVector3ArrayToVector3ArrayCoordinate(y,P+h,n,t,N+0),-1!==d&&u.a.transformVector3ArrayToVector3ArrayNormal(y,P+d,I,t,N+3);var w=N+6;if(-1!==p){var B=P+p;for(L=0,O=4;L<O;L++)t[w+L]=y[B+L]}else for(L=0,O=4;L<O;L++)t[w+L]=1;if(-1!==T){var F=P+T;t[N+10]=y[F],t[N+11]=y[F+1]}if(M&&(-1!==S?u.a.transformLightingMapTexcoordArray(y,P+S,M,t,N+12):u.a.transformLightingMapTexcoordArray(y,P+T,M,t,N+12)),-1!==x){var V=P+x;t[N+14]=y[V],t[N+15]=y[V+1],t[N+16]=y[V+2],t[N+17]=y[V+3]}}return D}addTest(t){var e=t.meshFilter.sharedMesh.vertexCount;return!(this._currentBatchVertexCount+e>v.maxBatchVertexCount)}add(t){var e=t.meshFilter.sharedMesh,i=e.vertexCount;this._batchElements.push(t);var a=t._render;a._isPartOfStaticBatch=!0,a._staticBatch=this;for(var r=a._renderElements,s=0,n=r.length;s<n;s++)r[s].staticBatch=this;this._currentBatchIndexCount+=e._indexBuffer.indexCount,this._currentBatchVertexCount+=i}remove(t){var e=t.meshFilter.sharedMesh,i=this._batchElements.indexOf(t);if(-1!==i){this._batchElements.splice(i,1);for(var a=t._render._renderElements,r=0,s=a.length;r<s;r++)a[r].staticBatch=null;this._currentBatchIndexCount=this._currentBatchIndexCount-e._indexBuffer.indexCount,this._currentBatchVertexCount=this._currentBatchVertexCount-e.vertexCount,t._render._isPartOfStaticBatch=!1}}finishInit(){this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy(),n.a._addGPUMemory(-(this._vertexBuffer._byteLength+this._indexBuffer._byteLength)));var t=s.a.instance,e=0,i=0,a=this.batchOwner,r=this._vertexDeclaration.vertexStride/4,o=new Float32Array(r*this._currentBatchVertexCount),l=new Uint16Array(this._currentBatchIndexCount);this._vertexBuffer=new p.a(this._vertexDeclaration.vertexStride*this._currentBatchVertexCount,t.STATIC_DRAW),this._vertexBuffer.vertexDeclaration=this._vertexDeclaration,this._indexBuffer=new f.a(g.a.UInt16,this._currentBatchIndexCount,t.STATIC_DRAW);for(var h=0,_=this._batchElements.length;h<_;h++){for(var c,d=this._batchElements[h],u=d.meshFilter.sharedMesh,m=this._getStaticBatchBakedVertexs(o,e,a?a._transform:null,d._transform,d._render,u),v=u._indexBuffer.getData(),T=e,E=i+v.length,S=d._render._renderElements,R=0,x=u.subMeshCount;R<x;R++){var A=u._subMeshes[R],y=i+A._indexStart,I=S[R];I.staticBatchIndexStart=y,I.staticBatchIndexEnd=y+A._indexCount}if(l.set(v,i),a?d._transform._isFrontFaceInvert!==a.transform._isFrontFaceInvert:d._transform._isFrontFaceInvert)for(c=i;c<E;c+=3){l[c]=T+l[c];var C=l[c+1],M=l[c+2];l[c+1]=T+M,l[c+2]=T+C}else for(c=i;c<E;c+=3)l[c]=T+l[c],l[c+1]=T+l[c+1],l[c+2]=T+l[c+2];i+=v.length,e+=m}this._vertexBuffer.setData(o.buffer),this._indexBuffer.setData(l);var D=this._vertexBuffer._byteLength+this._indexBuffer._byteLength;n.a._addGPUMemory(D),this._bufferState.bind(),this._bufferState.applyVertexBuffer(this._vertexBuffer),this._bufferState.applyIndexBuffer(this._indexBuffer),this._bufferState.unBind()}_render(t){this._bufferState.bind();for(var e=s.a.instance,i=t.renderElement.staticBatchElementList,a=i.elements,r=0,n=0,l=i.length,h=1;h<l;h++){if(a[h-1].staticBatchIndexEnd!==a[h].staticBatchIndexStart){var _=a[r].staticBatchIndexStart,c=a[n].staticBatchIndexEnd-_;e.drawElements(e.TRIANGLES,c,e.UNSIGNED_SHORT,2*_),r=++n,o.a.trianglesFaces+=c/3}else n++}_=a[r].staticBatchIndexStart,c=a[n].staticBatchIndexEnd-_,e.drawElements(e.TRIANGLES,c,e.UNSIGNED_SHORT,2*_),o.a.renderBatches++,o.a.savedRenderBatches+=l-1,o.a.trianglesFaces+=c/3}dispose(){var t=this._vertexBuffer._byteLength+this._indexBuffer._byteLength;n.a._addGPUMemory(-t),this._batchElements=null,this.batchOwner=null,this._vertexDeclaration=null,this._bufferState.destroy(),this._vertexBuffer.destroy(),this._indexBuffer.destroy(),this._vertexBuffer=null,this._indexBuffer=null,this._bufferState=null}}e.a=v,r()(v,"_tempVector30",new d.a),r()(v,"_tempVector31",new d.a),r()(v,"_tempQuaternion0",new c.a),r()(v,"_tempMatrix4x40",new _.a),r()(v,"_tempMatrix4x41",new _.a),r()(v,"_tempMatrix4x42",new _.a),r()(v,"maxBatchVertexCount",65535),r()(v,"_batchIDCounter",0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(52);e.a=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];r()(this,"isTransparent",!1),r()(this,"elements",new s.a),r()(this,"lastTransparentRenderElement",null),r()(this,"lastTransparentBatched",!1),this.isTransparent=t}_compare(t,e){var i=t.material.renderQueue-e.material.renderQueue;return 0===i?(this.isTransparent?e.render._distanceForSort-t.render._distanceForSort:t.render._distanceForSort-e.render._distanceForSort)+e.render.sortingFudge-t.render.sortingFudge:i}_partitionRenderObject(t,e){for(var i=this.elements.elements,a=i[Math.floor((e+t)/2)];t<=e;){for(;this._compare(i[t],a)<0;)t++;for(;this._compare(i[e],a)>0;)e--;if(t<e){var r=i[t];i[t]=i[e],i[e]=r,t++,e--}else if(t===e){t++;break}}return t}_quickSort(t,e){if(this.elements.length>1){var i=this._partitionRenderObject(t,e),a=i-1;t<a&&this._quickSort(t,a),i<e&&this._quickSort(i,e)}}_render(t){for(var e=this.elements.elements,i=0,a=this.elements.length;i<a;i++)e[i]._render(t)}clear(){this.elements.length=0,this.lastTransparentRenderElement=null,this.lastTransparentBatched=!1}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(460),n=i(461),o=i(1);class l{constructor(t,e,i,a){r()(this,"_initialSize",void 0),r()(this,"_rootNode",void 0),r()(this,"_motionObjects",new n.a),r()(this,"_looseness",void 0),r()(this,"_minSize",void 0),r()(this,"count",0),i>t&&(console.warn("Minimum node size must be at least as big as the initial world size. Was: "+i+" Adjusted to: "+t),i=t),this._initialSize=t,this._minSize=i,this._looseness=Math.min(Math.max(a,1),2),this._rootNode=new s.a(this,null,t,e)}_getMaxDepth(t,e){e++;var i=t._children;if(null!=i)for(var a=e,r=0,s=i.length;r<s;r++){var n=i[r];n&&(e=Math.max(this._getMaxDepth(n,a),e))}return e}_grow(t){var e=t.x>=0?1:-1,i=t.y>=0?1:-1,a=t.z>=0?1:-1,r=this._rootNode,n=this._rootNode.baseLength/2,l=2*this._rootNode.baseLength,h=this._rootNode.center,_=new o.a(h.x+e*n,h.y+i*n,h.z+a*n);if(this._rootNode=new s.a(this,null,l,_),r.hasAnyObjects()){for(var c=this._rootNode._bestFitChild(r.center),d=[],u=0;u<8;u++)u==c&&(r._parent=this._rootNode,d[u]=r);this._rootNode._children=d}}add(t){for(var e=0;!this._rootNode.add(t);){var i=l._tempVector30;if(o.a.subtract(t.bounds.getCenter(),this._rootNode.center,i),this._grow(i),++e>20)throw"Aborted Add operation as it seemed to be going on forever ("+(e-1)+") attempts at growing the octree."}this.count++}remove(t){var e=t._getOctreeNode().remove(t);return e&&this.count--,e}update(t){var e=0,i=t._getOctreeNode();if(i){for(;!i._update(t);){var a=l._tempVector30;if(o.a.subtract(t.bounds.getCenter(),this._rootNode.center,a),this._grow(a),++e>20)throw"Aborted Add operation as it seemed to be going on forever ("+(e-1)+") attempts at growing the octree."}return!0}return!1}shrinkRootIfPossible(){this._rootNode=this._rootNode.shrinkIfPossible(this._initialSize)}addMotionObject(t){this._motionObjects.add(t)}removeMotionObject(t){this._motionObjects.remove(t)}updateMotionObjects(){for(var t=this._motionObjects.elements,e=0,i=this._motionObjects.length;e<i;e++){var a=t[e];this.update(a),a._setIndexInMotionList(-1)}this._motionObjects.length=0}isCollidingWithBoundBox(t){return this._rootNode.isCollidingWithBoundBox(t)}isCollidingWithRay(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;return this._rootNode.isCollidingWithRay(t,e)}getCollidingWithBoundBox(t,e){this._rootNode.getCollidingWithBoundBox(t,e)}getCollidingWithRay(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE;this._rootNode.getCollidingWithRay(t,e,i)}getCollidingWithFrustum(t,e,i,a,r){this._rootNode.getCollidingWithFrustum(t,e,i,a,r)}getMaxBounds(){return this._rootNode.getBound()}drawAllBounds(t){var e=this._getMaxDepth(this._rootNode,-1);this._rootNode.drawAllBounds(t,-1,e)}drawAllObjects(t){var e=this._getMaxDepth(this._rootNode,-1);this._rootNode.drawAllObjects(t,-1,e)}}e.a=l,r()(l,"_tempVector30",new o.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(8),n=i(101),o=i(175),l=i(73),h=i(176),_=i(1),c=i(13);class d{static _encapsulates(t,e){return o.a.boxContainsBox(t,e)==h.a.Contains}constructor(t,e,i,a){r()(this,"_octree",void 0),r()(this,"_parent",void 0),r()(this,"_bounds",new n.a(new _.a,new _.a)),r()(this,"_objects",[]),r()(this,"_children",void 0),r()(this,"_isContaion",!1),r()(this,"center",new _.a),r()(this,"baseLength",0),this._setValues(t,e,i,a)}_setValues(t,e,i,a){this._octree=t,this._parent=e,this.baseLength=i,a.cloneTo(this.center);var r=this._bounds.min,s=this._bounds.max,n=t._looseness*i/2;r.setValue(a.x-n,a.y-n,a.z-n),s.setValue(a.x+n,a.y+n,a.z+n)}_getChildBound(t){if(null!=this._children&&this._children[t])return this._children[t]._bounds;var e=this.baseLength/4,i=this.baseLength/2*this._octree._looseness/2,a=d._tempBoundBox,r=a.min,s=a.max;switch(t){case 0:r.x=this.center.x-e-i,r.y=this.center.y+e-i,r.z=this.center.z-e-i,s.x=this.center.x-e+i,s.y=this.center.y+e+i,s.z=this.center.z-e+i;break;case 1:r.x=this.center.x+e-i,r.y=this.center.y+e-i,r.z=this.center.z-e-i,s.x=this.center.x+e+i,s.y=this.center.y+e+i,s.z=this.center.z-e+i;break;case 2:r.x=this.center.x-e-i,r.y=this.center.y+e-i,r.z=this.center.z+e-i,s.x=this.center.x-e+i,s.y=this.center.y+e+i,s.z=this.center.z+e+i;break;case 3:r.x=this.center.x+e-i,r.y=this.center.y+e-i,r.z=this.center.z+e-i,s.x=this.center.x+e+i,s.y=this.center.y+e+i,s.z=this.center.z+e+i;break;case 4:r.x=this.center.x-e-i,r.y=this.center.y-e-i,r.z=this.center.z-e-i,s.x=this.center.x-e+i,s.y=this.center.y-e+i,s.z=this.center.z-e+i;break;case 5:r.x=this.center.x+e-i,r.y=this.center.y-e-i,r.z=this.center.z-e-i,s.x=this.center.x+e+i,s.y=this.center.y-e+i,s.z=this.center.z-e+i;break;case 6:r.x=this.center.x-e-i,r.y=this.center.y-e-i,r.z=this.center.z+e-i,s.x=this.center.x-e+i,s.y=this.center.y-e+i,s.z=this.center.z+e+i;break;case 7:r.x=this.center.x+e-i,r.y=this.center.y-e-i,r.z=this.center.z+e-i,s.x=this.center.x+e+i,s.y=this.center.y-e+i,s.z=this.center.z+e+i}return a}_getChildCenter(t){if(null!=this._children)return this._children[t].center;var e=this.baseLength/4,i=d._tempVector30;switch(t){case 0:i.x=this.center.x-e,i.y=this.center.y+e,i.z=this.center.z-e;break;case 1:i.x=this.center.x+e,i.y=this.center.y+e,i.z=this.center.z-e;break;case 2:i.x=this.center.x-e,i.y=this.center.y+e,i.z=this.center.z+e;break;case 3:i.x=this.center.x+e,i.y=this.center.y+e,i.z=this.center.z+e;break;case 4:i.x=this.center.x-e,i.y=this.center.y-e,i.z=this.center.z-e;break;case 5:i.x=this.center.x+e,i.y=this.center.y-e,i.z=this.center.z-e;break;case 6:i.x=this.center.x-e,i.y=this.center.y-e,i.z=this.center.z+e;break;case 7:i.x=this.center.x+e,i.y=this.center.y-e,i.z=this.center.z+e}return i}_getChild(t){var e=this.baseLength/4;switch(this._children||(this._children=[]),t){case 0:return this._children[0]||(this._children[0]=new d(this._octree,this,this.baseLength/2,new _.a(this.center.x+-e,this.center.y+e,this.center.z-e)));case 1:return this._children[1]||(this._children[1]=new d(this._octree,this,this.baseLength/2,new _.a(this.center.x+e,this.center.y+e,this.center.z-e)));case 2:return this._children[2]||(this._children[2]=new d(this._octree,this,this.baseLength/2,new _.a(this.center.x-e,this.center.y+e,this.center.z+e)));case 3:return this._children[3]||(this._children[3]=new d(this._octree,this,this.baseLength/2,new _.a(this.center.x+e,this.center.y+e,this.center.z+e)));case 4:return this._children[4]||(this._children[4]=new d(this._octree,this,this.baseLength/2,new _.a(this.center.x-e,this.center.y-e,this.center.z-e)));case 5:return this._children[5]||(this._children[5]=new d(this._octree,this,this.baseLength/2,new _.a(this.center.x+e,this.center.y-e,this.center.z-e)));case 6:return this._children[6]||(this._children[6]=new d(this._octree,this,this.baseLength/2,new _.a(this.center.x-e,this.center.y-e,this.center.z+e)));case 7:return this._children[7]||(this._children[7]=new d(this._octree,this,this.baseLength/2,new _.a(this.center.x+e,this.center.y-e,this.center.z+e)));default:throw"BoundsOctreeNode: unknown index."}}_shouldMerge(){for(var t=this._objects.length,e=0;e<8;e++){var i=this._children[e];if(i){if(null!=i._children)return!1;t+=i._objects.length}}return t<=d._NUM_OBJECTS_ALLOWED}_mergeChildren(){for(var t=0;t<8;t++){var e=this._children[t];if(e){e._parent=null;for(var i=e._objects,a=i.length-1;a>=0;a--){var r=i[a];this._objects.push(r),r._setOctreeNode(this)}}}this._children=null}_merge(){if(null===this._children){var t=this._parent;t&&t._shouldMerge()&&(t._mergeChildren(),t._merge())}}_checkAddNode(t){if(null==this._children){if(this._objects.length<d._NUM_OBJECTS_ALLOWED||this.baseLength/2<this._octree._minSize)return this;for(var e=this._objects.length-1;e>=0;e--){var i=this._objects[e],a=this._bestFitChild(i.bounds.getCenter());d._encapsulates(this._getChildBound(a),i.bounds._getBoundBox())&&(this._objects.splice(this._objects.indexOf(i),1),this._getChild(a)._add(i))}}var r=this._bestFitChild(t.bounds.getCenter());return d._encapsulates(this._getChildBound(r),t.bounds._getBoundBox())?this._getChild(r)._checkAddNode(t):this}_add(t){var e=this._checkAddNode(t);e._objects.push(t),t._setOctreeNode(e)}_remove(t){var e=this._objects.indexOf(t);this._objects.splice(e,1),t._setOctreeNode(null),this._merge()}_addUp(t){return o.a.boxContainsBox(this._bounds,t.bounds._getBoundBox())===h.a.Contains?(this._add(t),!0):!!this._parent&&this._parent._addUp(t)}_getCollidingWithFrustum(t,e,i,a,r,n){var o=t.boundFrustum,l=t.position,c=t.cullingMask;if(i){var d=o.containsBoundBox(this._bounds);if(s.a.octreeNodeCulling++,d===h.a.Disjoint)return;i=d===h.a.Intersects}this._isContaion=!i;for(var u=e.scene,f=s.a.loopCount,m=0,p=this._objects.length;m<p;m++){var g=this._objects[m];if(n?g._castShadow&&g._enable:0!=(Math.pow(2,g._owner._layer)&c)&&g._enable){if(i&&(s.a.frustumCulling++,!g._needRender(o,e)))continue;g._renderMark=f,g._distanceForSort=_.a.distance(g.bounds.getCenter(),l);for(var v=g._renderElements,T=0,E=v.length;T<E;T++){v[T]._update(u,e,a,r)}}}if(null!=this._children)for(m=0;m<8;m++){var S=this._children[m];S&&S._getCollidingWithFrustum(t,e,i,a,r,n)}}_getCollidingWithBoundBox(t,e,i){if(e){var a=o.a.boxContainsBox(this._bounds,t);if(a===h.a.Disjoint)return;e=a===h.a.Intersects}if(e)for(var r=0,s=this._objects.length;r<s;r++){var n=this._objects[r];o.a.intersectsBoxAndBox(n.bounds._getBoundBox(),t)&&i.push(n)}if(null!=this._children)for(r=0;r<8;r++){this._children[r]._getCollidingWithBoundBox(t,e,i)}}_bestFitChild(t){return(t.x<=this.center.x?0:1)+(t.y>=this.center.y?0:4)+(t.z<=this.center.z?0:2)}_update(t){if(o.a.boxContainsBox(this._bounds,t.bounds._getBoundBox())===h.a.Contains){var e=this._checkAddNode(t);if(e!==t._getOctreeNode()){e._objects.push(t),t._setOctreeNode(e);var i=this._objects.indexOf(t);this._objects.splice(i,1),this._merge()}return!0}if(this._parent){var a=this._parent._addUp(t);return a&&(i=this._objects.indexOf(t),this._objects.splice(i,1),this._merge()),a}return!1}add(t){return!!d._encapsulates(this._bounds,t.bounds._getBoundBox())&&(this._add(t),!0)}remove(t){return t._getOctreeNode()===this&&(this._remove(t),!0)}update(t){return t._getOctreeNode()===this&&this._update(t)}shrinkIfPossible(t){if(this.baseLength<2*t)return this;for(var e=-1,i=0,a=this._objects.length;i<a;i++){var r=this._objects[i],s=this._bestFitChild(r.bounds.getCenter());if(0!=i&&s!=e)return this;var n=this._getChildBound(s);if(!d._encapsulates(n,r.bounds._getBoundBox()))return this;0==i&&(e=s)}if(null==this._children){if(-1!=e){var o=this._getChildCenter(e);this._setValues(this._octree,null,this.baseLength/2,o)}return this}var l=!1;for(i=0,a=this._children.length;i<a;i++){var h=this._children[i];if(h&&h.hasAnyObjects()){if(l)return this;if(e>=0&&e!=i)return this;l=!0,e=i}}if(-1!=e){var _=this._children[e];return _._parent=null,_}return this}hasAnyObjects(){if(this._objects.length>0)return!0;if(null!=this._children)for(var t=0;t<8;t++){var e=this._children[t];if(e&&e.hasAnyObjects())return!0}return!1}getCollidingWithBoundBox(t,e){this._getCollidingWithBoundBox(t,!0,e)}getCollidingWithRay(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE;var a=o.a.intersectsRayAndBoxRD(t,this._bounds);if(!(-1==a||a>i)){for(var r=0,s=this._objects.length;r<s;r++){var n=this._objects[r];-1!==(a=o.a.intersectsRayAndBoxRD(t,n.bounds._getBoundBox()))&&a<=i&&e.push(n)}if(null!=this._children)for(r=0;r<8;r++){this._children[r].getCollidingWithRay(t,e,i)}}}getCollidingWithFrustum(t,e,i,a,r){this._getCollidingWithFrustum(t,e,!0,i,a,r)}isCollidingWithBoundBox(t){if(!o.a.intersectsBoxAndBox(this._bounds,t))return!1;for(var e=0,i=this._objects.length;e<i;e++){var a=this._objects[e];if(o.a.intersectsBoxAndBox(a.bounds._getBoundBox(),t))return!0}if(null!=this._children)for(e=0;e<8;e++){if(this._children[e].isCollidingWithBoundBox(t))return!0}return!1}isCollidingWithRay(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;var i=o.a.intersectsRayAndBoxRD(t,this._bounds);if(-1==i||i>e)return!1;for(var a=0,r=this._objects.length;a<r;a++){var s=this._objects[a];if(-1!==(i=o.a.intersectsRayAndBoxRD(t,s.bounds._getBoundBox()))&&i<=e)return!0}if(null!=this._children)for(a=0;a<8;a++){if(this._children[a].isCollidingWithRay(t,e))return!0}return!1}getBound(){return this._bounds}drawAllBounds(t,e,i){if(null!==this._children||0!=this._objects.length){e++;var a=d._tempColor0;if(this._isContaion)a.r=0,a.g=0,a.b=1;else{var r=i?e/i:0;a.r=1-r,a.g=r,a.b=0}if(a.a=.3,c.a._drawBound(t,this._bounds,a),null!=this._children)for(var s=0;s<8;s++){var n=this._children[s];n&&n.drawAllBounds(t,e,i)}}}drawAllObjects(t,e,i){e++;var a=d._tempColor0;if(this._isContaion)a.r=0,a.g=0,a.b=1;else{var r=i?e/i:0;a.r=1-r,a.g=r,a.b=0}a.a=1;for(var s=0,n=this._objects.length;s<n;s++)c.a._drawBound(t,this._objects[s].bounds._getBoundBox(),a);if(null!=this._children)for(s=0;s<8;s++){var o=this._children[s];o&&o.drawAllObjects(t,e,i)}}}e.a=d,r()(d,"_tempVector3",new _.a),r()(d,"_tempVector30",new _.a),r()(d,"_tempVector31",new _.a),r()(d,"_tempColor0",new l.a),r()(d,"_tempBoundBox",new n.a(new _.a,new _.a)),r()(d,"_NUM_OBJECTS_ALLOWED",8)},function(t,e,i){"use strict";var a=i(52);e.a=class extends a.a{constructor(){super()}add(t){if(-1!==t._getIndexInMotionList())throw"OctreeMotionList:element has  in  PhysicsUpdateList.";this._add(t),t._setIndexInMotionList(this.length++)}remove(t){var e=t._getIndexInMotionList();if(this.length--,e!==this.length){var i=this.elements[this.length];this.elements[e]=i,i._setIndexInMotionList(e)}t._setIndexInMotionList(-1)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(){r()(this,"lightmapColor",void 0),r()(this,"lightmapDirection",void 0)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(286),n=i(9),o=i(99),l=i(1),h=i(32),_=i(131);e.a=class{constructor(){r()(this,"cameraShaderValue",new h.a),r()(this,"position",new l.a),r()(this,"offsetX",void 0),r()(this,"offsetY",void 0),r()(this,"resolution",void 0),r()(this,"viewMatrix",new n.a),r()(this,"projectionMatrix",new n.a),r()(this,"viewProjectMatrix",new n.a),r()(this,"cullPlanes",[new o.a(new l.a),new o.a(new l.a),new o.a(new l.a),new o.a(new l.a),new o.a(new l.a),new o.a(new l.a),new o.a(new l.a),new o.a(new l.a),new o.a(new l.a),new o.a(new l.a)]),r()(this,"cullPlaneCount",void 0),r()(this,"splitBoundSphere",new s.a(new l.a,0)),r()(this,"sphereCenterZ",void 0)}};e.b=class{constructor(){r()(this,"cameraShaderValue",new h.a),r()(this,"position",new l.a),r()(this,"offsetX",void 0),r()(this,"offsetY",void 0),r()(this,"resolution",void 0),r()(this,"viewMatrix",new n.a),r()(this,"projectionMatrix",new n.a),r()(this,"viewProjectMatrix",new n.a),r()(this,"cameraCullInfo",new _.a)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(46),n=i(2),o=i(80),l=i(79),h=i(10),_=i(58);class c extends s.a{static _update(){for(var t=c._videoTexturePool,e=0,i=t.length;e<i;e++){var a=t[e];a&&a._updateVideoData()}}constructor(){var t=n.a.instance;super(t.RGB,!1),r()(this,"_video",void 0),r()(this,"_needUpdate",void 0),this._glTextureType=t.TEXTURE_2D,this._width=1,this._height=1,this._wrapModeU=this._wrapModeV=o.a.Clamp,this._filterMode=l.a.Bilinear,this._setWarpMode(t.TEXTURE_WRAP_S,this._wrapModeU),this._setWarpMode(t.TEXTURE_WRAP_T,this._wrapModeV),this._setFilterMode(this._filterMode),this._needUpdate=!1,this._readyed=!0,c._videoTexturePool.push(this)}get video(){return this._video}set video(t){t&&t instanceof HTMLVideoElement&&(this._video=t,_.a.Browser.onMobile&&(this._video["x5-playsInline"]=!0,this._video["x5-playsinline"]=!0,this._video.x5PlaysInline=!0,this._video.playsInline=!0,this._video["webkit-playsInline"]=!0,this._video["webkit-playsinline"]=!0,this._video.webkitPlaysInline=!0,this._video.playsinline=!0,this._video.style.playsInline=!0,this._video.crossOrigin="anonymous",this._video.setAttribute("crossorigin","anonymous"),this._video.setAttribute("playsinline","true"),this._video.setAttribute("x5-playsinline","true"),this._video.setAttribute("webkit-playsinline","true"),this._video.autoplay=!0))}_updateVideoData(){if(this._video&&this._needUpdate){var t=n.a.instance;h.a.bindTexture(t,this._glTextureType,this._glTexture),t.texImage2D(this._glTextureType,0,t.RGB,t.RGB,t.UNSIGNED_BYTE,this._video)}}videoPlay(){this._video.play(),this._needUpdate=!0}videoPause(){this._video.pause(),this._needUpdate=!1}destroy(){super.destroy(),this._video=null}}e.a=c,r()(c,"_videoTexturePool",new Array)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(103),n=i(466),o=i(52),l=i(74),h=i(1);e.a=class{constructor(){r()(this,"_reflectionProbes",new n.a),r()(this,"_sceneReflectionProbe",void 0),r()(this,"_motionObjects",new o.a),r()(this,"_needUpdateAllRender",!1),this._sceneReflectionProbe=new s.a,this._sceneReflectionProbe.bounds=new l.a(new h.a(0,0,0),new h.a(0,0,0)),this._sceneReflectionProbe.boxProjection=!1,this._sceneReflectionProbe._isScene=!0}set sceneReflectionProbe(t){this._sceneReflectionProbe.reflectionTexture=t}set sceneReflectionCubeHDRParam(t){this._sceneReflectionProbe.reflectionHDRParams=t}_updateMotionObjects(t){for(var e,i,a=this._reflectionProbes.elements,r=0,s=t.bounds,n=0,o=this._reflectionProbes.length;n<o;n++){var l=a[n];if(e){if(e.importance>l.importance)continue;if((i=s.calculateBoundsintersection(l.bounds))<r&&e.importance==l.importance)continue}else if((i=s.calculateBoundsintersection(l.bounds))<r)continue;e=l,r=i}!e&&this._sceneReflectionProbe&&(e=this._sceneReflectionProbe),t._probReflection=e}add(t){this._reflectionProbes.add(t),this._needUpdateAllRender=!0}remove(t){this._reflectionProbes.remove(t),this._needUpdateAllRender=!0}addMotionObject(t){this._motionObjects.add(t)}update(){if(0!=this._reflectionProbes.length){for(var t=this._motionObjects.elements,e=0,i=this._motionObjects.length;e<i;e++)this._updateMotionObjects(t[e]);this.clearMotionObjects()}}updateAllRenderObjects(t){for(var e=t.elements,i=0,a=t.length;i<a;i++)this._updateMotionObjects(e[i]);this._needUpdateAllRender=!1}clearMotionObjects(){this._motionObjects.length=0}destroy(){}}},function(t,e,i){"use strict";var a=i(52);e.a=class extends a.a{constructor(){super()}add(t){this._add(t),t._setIndexInReflectionList(this.length++)}remove(t){var e=t._getIndexInReflectionList();if(this.length--,e!==this.length){var i=this.elements[this.length];this.elements[e]=i,i._setIndexInReflectionList(e)}t._setIndexInReflectionList(-1)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(14),n=i(468),o=i(469),l=i(470),h=i(471),_=i(7),c=i(130),d=i(129);let u;!function(t){t[t.MetallicGlossTextureAlpha=0]="MetallicGlossTextureAlpha",t[t.AlbedoTextureAlpha=1]="AlbedoTextureAlpha"}(u||(u={}));class f extends d.a{static __init__(){f.SHADERDEFINE_METALLICGLOSSTEXTURE=_.a.getDefineByName("METALLICGLOSSTEXTURE"),f.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA=_.a.getDefineByName("SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA");var t={a_Position:s.a.MESH_POSITION0,a_Normal:s.a.MESH_NORMAL0,a_Tangent0:s.a.MESH_TANGENT0,a_Texcoord0:s.a.MESH_TEXTURECOORDINATE0,a_Texcoord1:s.a.MESH_TEXTURECOORDINATE1,a_BoneWeights:s.a.MESH_BLENDWEIGHT0,a_BoneIndices:s.a.MESH_BLENDINDICES0,a_MvpMatrix:s.a.MESH_MVPMATRIX_ROW0,a_WorldMat:s.a.MESH_WORLDMATRIX_ROW0},e={u_Bones:_.a.PERIOD_CUSTOM,u_MvpMatrix:_.a.PERIOD_SPRITE,u_WorldMat:_.a.PERIOD_SPRITE,u_LightmapScaleOffset:_.a.PERIOD_SPRITE,u_LightMap:_.a.PERIOD_SPRITE,u_LightMapDirection:_.a.PERIOD_SPRITE,u_SimpleAnimatorTexture:_.a.PERIOD_SPRITE,u_SimpleAnimatorParams:_.a.PERIOD_SPRITE,u_SimpleAnimatorTextureSize:_.a.PERIOD_SPRITE,u_ReflectCubeHDRParams:_.a.PERIOD_SPRITE,u_ReflectTexture:_.a.PERIOD_SPRITE,u_SpecCubeProbePosition:_.a.PERIOD_SPRITE,u_SpecCubeBoxMax:_.a.PERIOD_SPRITE,u_SpecCubeBoxMin:_.a.PERIOD_SPRITE,u_CameraPos:_.a.PERIOD_CAMERA,u_View:_.a.PERIOD_CAMERA,u_ProjectionParams:_.a.PERIOD_CAMERA,u_Viewport:_.a.PERIOD_CAMERA,u_ViewProjection:_.a.PERIOD_CAMERA,u_AlphaTestValue:_.a.PERIOD_MATERIAL,u_AlbedoColor:_.a.PERIOD_MATERIAL,u_EmissionColor:_.a.PERIOD_MATERIAL,u_AlbedoTexture:_.a.PERIOD_MATERIAL,u_NormalTexture:_.a.PERIOD_MATERIAL,u_ParallaxTexture:_.a.PERIOD_MATERIAL,u_OcclusionTexture:_.a.PERIOD_MATERIAL,u_EmissionTexture:_.a.PERIOD_MATERIAL,u_Smoothness:_.a.PERIOD_MATERIAL,u_SmoothnessScale:_.a.PERIOD_MATERIAL,u_occlusionStrength:_.a.PERIOD_MATERIAL,u_NormalScale:_.a.PERIOD_MATERIAL,u_ParallaxScale:_.a.PERIOD_MATERIAL,u_TilingOffset:_.a.PERIOD_MATERIAL,u_MetallicGlossTexture:_.a.PERIOD_MATERIAL,u_Metallic:_.a.PERIOD_MATERIAL,u_AmbientColor:_.a.PERIOD_SCENE,u_FogStart:_.a.PERIOD_SCENE,u_FogRange:_.a.PERIOD_SCENE,u_FogColor:_.a.PERIOD_SCENE,u_DirationLightCount:_.a.PERIOD_SCENE,u_LightBuffer:_.a.PERIOD_SCENE,u_LightClusterBuffer:_.a.PERIOD_SCENE,u_ShadowBias:_.a.PERIOD_SCENE,u_ShadowLightDirection:_.a.PERIOD_SCENE,u_ShadowMap:_.a.PERIOD_SCENE,u_ShadowParams:_.a.PERIOD_SCENE,u_ShadowSplitSpheres:_.a.PERIOD_SCENE,u_ShadowMatrices:_.a.PERIOD_SCENE,u_ShadowMapSize:_.a.PERIOD_SCENE,u_SpotShadowMap:_.a.PERIOD_SCENE,u_SpotViewProjectMatrix:_.a.PERIOD_SCENE,u_ShadowLightPosition:_.a.PERIOD_SCENE,u_AmbientSHAr:_.a.PERIOD_SCENE,u_AmbientSHAg:_.a.PERIOD_SCENE,u_AmbientSHAb:_.a.PERIOD_SCENE,u_AmbientSHBr:_.a.PERIOD_SCENE,u_AmbientSHBg:_.a.PERIOD_SCENE,u_AmbientSHBb:_.a.PERIOD_SCENE,u_AmbientSHC:_.a.PERIOD_SCENE,"u_DirectionLight.direction":_.a.PERIOD_SCENE,"u_DirectionLight.color":_.a.PERIOD_SCENE,"u_PointLight.position":_.a.PERIOD_SCENE,"u_PointLight.range":_.a.PERIOD_SCENE,"u_PointLight.color":_.a.PERIOD_SCENE,"u_SpotLight.position":_.a.PERIOD_SCENE,"u_SpotLight.direction":_.a.PERIOD_SCENE,"u_SpotLight.range":_.a.PERIOD_SCENE,"u_SpotLight.spot":_.a.PERIOD_SCENE,"u_SpotLight.color":_.a.PERIOD_SCENE},i={s_Cull:_.a.RENDER_STATE_CULL,s_Blend:_.a.RENDER_STATE_BLEND,s_BlendSrc:_.a.RENDER_STATE_BLEND_SRC,s_BlendDst:_.a.RENDER_STATE_BLEND_DST,s_DepthTest:_.a.RENDER_STATE_DEPTH_TEST,s_DepthWrite:_.a.RENDER_STATE_DEPTH_WRITE},a=_.a.add("PBR",t,e,!0,!0),r=new c.a(t,e);a.addSubShader(r),r.addShaderPass(o.a,n.a,i,"Forward"),r.addShaderPass(h.a,l.a,i,"ShadowCaster")}get metallicGlossTexture(){return this._shaderValues.getTexture(f.METALLICGLOSSTEXTURE)}set metallicGlossTexture(t){t?this._shaderValues.addDefine(f.SHADERDEFINE_METALLICGLOSSTEXTURE):this._shaderValues.removeDefine(f.SHADERDEFINE_METALLICGLOSSTEXTURE),this._shaderValues.setTexture(f.METALLICGLOSSTEXTURE,t)}get metallic(){return this._shaderValues.getNumber(f.METALLIC)}set metallic(t){this._shaderValues.setNumber(f.METALLIC,Math.max(0,Math.min(1,t)))}get smoothnessSource(){return this._smoothnessSource}set smoothnessSource(t){t?this._shaderValues.addDefine(f.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA):this._shaderValues.removeDefine(f.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA),this._smoothnessSource=t}constructor(){super(),r()(this,"_smoothnessSource",0),this.setShaderName("PBR"),this._shaderValues.setNumber(f.METALLIC,0)}clone(){var t=new f;return this.cloneTo(t),t}}e.a=f,r()(f,"SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA",void 0),r()(f,"SHADERDEFINE_METALLICGLOSSTEXTURE",void 0),r()(f,"METALLICGLOSSTEXTURE",_.a.propertyNameToID("u_MetallicGlossTexture")),r()(f,"METALLIC",_.a.propertyNameToID("u_Metallic")),r()(f,"defaultMaterial",void 0)},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n\tprecision highp int;\n#else\n\tprecision mediump float;\n\tprecision mediump int;\n#endif\n\n#include "Lighting.glsl";\n#include "Shadow.glsl"\n#include "PBRFSInput.glsl";\n#include "LayaPBRBRDF.glsl";\n#include "GlobalIllumination.glsl";\n#include "PBRCore.glsl";\n\nvoid main()\n{\n\tfragmentForward();\n}'},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n\tprecision highp int;\n#else\n\tprecision mediump float;\n\tprecision mediump int;\n#endif\n#include "Lighting.glsl";\n#include "LayaUtile.glsl"\n#include "Shadow.glsl"\n#include "PBRVSInput.glsl";\n#include "PBRVertex.glsl";\n\nvoid main()\n{\n\tvertexForward();\n\tgl_Position=remapGLPositionZ(gl_Position);\n}'},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n\tprecision highp int;\n#else\n\tprecision mediump float;\n\tprecision mediump int;\n#endif\n\n#include "ShadowCasterFS.glsl"\n\nvoid main()\n{\n\tgl_FragColor=shadowCasterFragment();\n}'},function(t,e,i){"use strict";e.a='#include "ShadowCasterVS.glsl"\n\nvoid main()\n{\n\tvec4 positionCS =  shadowCasterVertex();\n\tgl_Position=remapGLPositionZ(positionCS);\n}'},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(5),n=i(7),o=i(22);class l extends o.a{static __initDefine__(){}get tintColor(){return this._shaderValues.getVector(l.TINTCOLOR)}set tintColor(t){this._shaderValues.setVector(l.TINTCOLOR,t)}get exposure(){return this._shaderValues.getNumber(l.EXPOSURE)}set exposure(t){this._shaderValues.setNumber(l.EXPOSURE,t)}get rotation(){return this._shaderValues.getNumber(l.ROTATION)}set rotation(t){this._shaderValues.setNumber(l.ROTATION,t)}get textureCube(){return this._shaderValues.getTexture(l.TEXTURECUBE)}set textureCube(t){this._shaderValues.setTexture(l.TEXTURECUBE,t)}clone(){var t=new l;return this.cloneTo(t),t}constructor(){super(),this.setShaderName("SkyBox"),this.tintColor=new s.a(.5,.5,.5,.5),this.exposure=1,this.rotation=0}}e.a=l,r()(l,"TINTCOLOR",n.a.propertyNameToID("u_TintColor")),r()(l,"EXPOSURE",n.a.propertyNameToID("u_Exposure")),r()(l,"ROTATION",n.a.propertyNameToID("u_Rotation")),r()(l,"TEXTURECUBE",n.a.propertyNameToID("u_CubeTexture")),r()(l,"defaultMaterial",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(5),n=i(7),o=i(22);class l extends o.a{static __initDefine__(){l.SHADERDEFINE_SUN_HIGH_QUALITY=n.a.getDefineByName("SUN_HIGH_QUALITY"),l.SHADERDEFINE_SUN_SIMPLE=n.a.getDefineByName("SUN_SIMPLE")}get sunDisk(){return this._sunDisk}set sunDisk(t){switch(t){case l.SUN_HIGH_QUALITY:this._shaderValues.removeDefine(l.SHADERDEFINE_SUN_SIMPLE),this._shaderValues.addDefine(l.SHADERDEFINE_SUN_HIGH_QUALITY);break;case l.SUN_SIMPLE:this._shaderValues.removeDefine(l.SHADERDEFINE_SUN_HIGH_QUALITY),this._shaderValues.addDefine(l.SHADERDEFINE_SUN_SIMPLE);break;case l.SUN_NODE:this._shaderValues.removeDefine(l.SHADERDEFINE_SUN_HIGH_QUALITY),this._shaderValues.removeDefine(l.SHADERDEFINE_SUN_SIMPLE);break;default:throw"SkyBoxProceduralMaterial: unknown sun value."}this._sunDisk=t}get sunSize(){return this._shaderValues.getNumber(l.SUNSIZE)}set sunSize(t){t=Math.min(Math.max(0,t),1),this._shaderValues.setNumber(l.SUNSIZE,t)}get sunSizeConvergence(){return this._shaderValues.getNumber(l.SUNSIZECONVERGENCE)}set sunSizeConvergence(t){t=Math.min(Math.max(0,t),20),this._shaderValues.setNumber(l.SUNSIZECONVERGENCE,t)}get atmosphereThickness(){return this._shaderValues.getNumber(l.ATMOSPHERETHICKNESS)}set atmosphereThickness(t){t=Math.min(Math.max(0,t),5),this._shaderValues.setNumber(l.ATMOSPHERETHICKNESS,t)}get skyTint(){return this._shaderValues.getVector(l.SKYTINT)}set skyTint(t){this._shaderValues.setVector(l.SKYTINT,t)}get groundTint(){return this._shaderValues.getVector(l.GROUNDTINT)}set groundTint(t){this._shaderValues.setVector(l.GROUNDTINT,t)}get exposure(){return this._shaderValues.getNumber(l.EXPOSURE)}set exposure(t){t=Math.min(Math.max(0,t),8),this._shaderValues.setNumber(l.EXPOSURE,t)}constructor(){super(),r()(this,"_sunDisk",void 0),this.setShaderName("SkyBoxProcedural"),this.sunDisk=l.SUN_HIGH_QUALITY,this.sunSize=.04,this.sunSizeConvergence=5,this.atmosphereThickness=1,this.skyTint=new s.a(.5,.5,.5,1),this.groundTint=new s.a(.369,.349,.341,1),this.exposure=1.3}clone(){var t=new l;return this.cloneTo(t),t}}e.a=l,r()(l,"SUN_NODE",0),r()(l,"SUN_SIMPLE",1),r()(l,"SUN_HIGH_QUALITY",2),r()(l,"SUNSIZE",n.a.propertyNameToID("u_SunSize")),r()(l,"SUNSIZECONVERGENCE",n.a.propertyNameToID("u_SunSizeConvergence")),r()(l,"ATMOSPHERETHICKNESS",n.a.propertyNameToID("u_AtmosphereThickness")),r()(l,"SKYTINT",n.a.propertyNameToID("u_SkyTint")),r()(l,"GROUNDTINT",n.a.propertyNameToID("u_GroundTint")),r()(l,"EXPOSURE",n.a.propertyNameToID("u_Exposure")),r()(l,"SHADERDEFINE_SUN_HIGH_QUALITY",void 0),r()(l,"SHADERDEFINE_SUN_SIMPLE",void 0),r()(l,"defaultMaterial",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(5),n=i(7),o=i(22),l=i(40);class h extends o.a{static __initDefine__(){h.SHADERDEFINE_ALBEDOTEXTURE=n.a.getDefineByName("ALBEDOTEXTURE"),h.SHADERDEFINE_TILINGOFFSET=n.a.getDefineByName("TILINGOFFSET"),h.SHADERDEFINE_ENABLEVERTEXCOLOR=n.a.getDefineByName("ENABLEVERTEXCOLOR")}get _ColorR(){return this._albedoColor.x}set _ColorR(t){this._albedoColor.x=t,this.albedoColor=this._albedoColor}get _ColorG(){return this._albedoColor.y}set _ColorG(t){this._albedoColor.y=t,this.albedoColor=this._albedoColor}get _ColorB(){return this._albedoColor.z}set _ColorB(t){this._albedoColor.z=t,this.albedoColor=this._albedoColor}get _ColorA(){return this._albedoColor.w}set _ColorA(t){this._albedoColor.w=t,this.albedoColor=this._albedoColor}get _Color(){return this._shaderValues.getVector(h.ALBEDOCOLOR)}set _Color(t){this.albedoColor=t}get _AlbedoIntensity(){return this._albedoIntensity}set _AlbedoIntensity(t){if(this._albedoIntensity!==t){var e=this._shaderValues.getVector(h.ALBEDOCOLOR);s.a.scale(this._albedoColor,t,e),this._albedoIntensity=t,this._shaderValues.setVector(h.ALBEDOCOLOR,e)}}get _MainTex_STX(){return this._shaderValues.getVector(h.TILINGOFFSET).x}set _MainTex_STX(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.x=t,this.tilingOffset=e}get _MainTex_STY(){return this._shaderValues.getVector(h.TILINGOFFSET).y}set _MainTex_STY(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.y=t,this.tilingOffset=e}get _MainTex_STZ(){return this._shaderValues.getVector(h.TILINGOFFSET).z}set _MainTex_STZ(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.z=t,this.tilingOffset=e}get _MainTex_STW(){return this._shaderValues.getVector(h.TILINGOFFSET).w}set _MainTex_STW(t){var e=this._shaderValues.getVector(h.TILINGOFFSET);e.w=t,this.tilingOffset=e}get _MainTex_ST(){return this._shaderValues.getVector(h.TILINGOFFSET)}set _MainTex_ST(t){this.tilingOffset=t}get _Cutoff(){return this.alphaTestValue}set _Cutoff(t){this.alphaTestValue=t}get albedoColorR(){return this._ColorR}set albedoColorR(t){this._ColorR=t}get albedoColorG(){return this._ColorG}set albedoColorG(t){this._ColorG=t}get albedoColorB(){return this._ColorB}set albedoColorB(t){this._ColorB=t}get albedoColorA(){return this._ColorA}set albedoColorA(t){this._ColorA=t}get albedoColor(){return this._albedoColor}set albedoColor(t){var e=this._shaderValues.getVector(h.ALBEDOCOLOR);s.a.scale(t,this._albedoIntensity,e),this._albedoColor=t,this._shaderValues.setVector(h.ALBEDOCOLOR,e)}get albedoIntensity(){return this._albedoIntensity}set albedoIntensity(t){this._AlbedoIntensity=t}get albedoTexture(){return this._shaderValues.getTexture(h.ALBEDOTEXTURE)}set albedoTexture(t){t?this._shaderValues.addDefine(h.SHADERDEFINE_ALBEDOTEXTURE):this._shaderValues.removeDefine(h.SHADERDEFINE_ALBEDOTEXTURE),this._shaderValues.setTexture(h.ALBEDOTEXTURE,t)}get tilingOffsetX(){return this._MainTex_STX}set tilingOffsetX(t){this._MainTex_STX=t}get tilingOffsetY(){return this._MainTex_STY}set tilingOffsetY(t){this._MainTex_STY=t}get tilingOffsetZ(){return this._MainTex_STZ}set tilingOffsetZ(t){this._MainTex_STZ=t}get tilingOffsetW(){return this._MainTex_STW}set tilingOffsetW(t){this._MainTex_STW=t}get tilingOffset(){return this._shaderValues.getVector(h.TILINGOFFSET)}set tilingOffset(t){t&&(1!=t.x||1!=t.y||0!=t.z||0!=t.w)?this._shaderValues.addDefine(h.SHADERDEFINE_TILINGOFFSET):this._shaderValues.removeDefine(h.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(h.TILINGOFFSET,t)}get enableVertexColor(){return this._enableVertexColor}set enableVertexColor(t){this._enableVertexColor=t,t?this._shaderValues.addDefine(h.SHADERDEFINE_ENABLEVERTEXCOLOR):this._shaderValues.removeDefine(h.SHADERDEFINE_ENABLEVERTEXCOLOR)}set renderMode(t){switch(t){case h.RENDERMODE_OPAQUE:this.alphaTest=!1,this.renderQueue=o.a.RENDERQUEUE_OPAQUE,this.depthWrite=!0,this.cull=l.a.CULL_BACK,this.blend=l.a.BLEND_DISABLE,this.depthTest=l.a.DEPTHTEST_LESS;break;case h.RENDERMODE_CUTOUT:this.renderQueue=o.a.RENDERQUEUE_ALPHATEST,this.alphaTest=!0,this.depthWrite=!0,this.cull=l.a.CULL_BACK,this.blend=l.a.BLEND_DISABLE,this.depthTest=l.a.DEPTHTEST_LESS;break;case h.RENDERMODE_TRANSPARENT:this.renderQueue=o.a.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=l.a.CULL_BACK,this.blend=l.a.BLEND_ENABLE_ALL,this.blendSrc=l.a.BLENDPARAM_SRC_ALPHA,this.blendDst=l.a.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=l.a.DEPTHTEST_LESS;break;default:throw new Error("UnlitMaterial : renderMode value error.")}}get depthWrite(){return this._shaderValues.getBool(h.DEPTH_WRITE)}set depthWrite(t){this._shaderValues.setBool(h.DEPTH_WRITE,t)}get cull(){return this._shaderValues.getInt(h.CULL)}set cull(t){this._shaderValues.setInt(h.CULL,t)}get blend(){return this._shaderValues.getInt(h.BLEND)}set blend(t){this._shaderValues.setInt(h.BLEND,t)}get blendSrc(){return this._shaderValues.getInt(h.BLEND_SRC)}set blendSrc(t){this._shaderValues.setInt(h.BLEND_SRC,t)}get blendDst(){return this._shaderValues.getInt(h.BLEND_DST)}set blendDst(t){this._shaderValues.setInt(h.BLEND_DST,t)}get depthTest(){return this._shaderValues.getInt(h.DEPTH_TEST)}set depthTest(t){this._shaderValues.setInt(h.DEPTH_TEST,t)}constructor(){super(),r()(this,"_albedoColor",new s.a(1,1,1,1)),r()(this,"_albedoIntensity",1),r()(this,"_enableVertexColor",!1),this.setShaderName("Unlit"),this._shaderValues.setVector(h.ALBEDOCOLOR,new s.a(1,1,1,1)),this.renderMode=h.RENDERMODE_OPAQUE}clone(){var t=new h;return this.cloneTo(t),t}}e.a=h,r()(h,"RENDERMODE_OPAQUE",0),r()(h,"RENDERMODE_CUTOUT",1),r()(h,"RENDERMODE_TRANSPARENT",2),r()(h,"RENDERMODE_ADDTIVE",3),r()(h,"SHADERDEFINE_ALBEDOTEXTURE",void 0),r()(h,"SHADERDEFINE_TILINGOFFSET",void 0),r()(h,"SHADERDEFINE_ENABLEVERTEXCOLOR",void 0),r()(h,"ALBEDOTEXTURE",n.a.propertyNameToID("u_AlbedoTexture")),r()(h,"ALBEDOCOLOR",n.a.propertyNameToID("u_AlbedoColor")),r()(h,"TILINGOFFSET",n.a.propertyNameToID("u_TilingOffset")),r()(h,"CULL",n.a.propertyNameToID("s_Cull")),r()(h,"BLEND",n.a.propertyNameToID("s_Blend")),r()(h,"BLEND_SRC",n.a.propertyNameToID("s_BlendSrc")),r()(h,"BLEND_DST",n.a.propertyNameToID("s_BlendDst")),r()(h,"DEPTH_TEST",n.a.propertyNameToID("s_DepthTest")),r()(h,"DEPTH_WRITE",n.a.propertyNameToID("s_DepthWrite")),r()(h,"defaultMaterial",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(5),n=i(7),o=i(22);class l extends o.a{static __initDefine__(){l.SHADERDEFINE_MAINTEXTURE=n.a.getDefineByName("MAINTEXTURE"),l.SHADERDEFINE_NORMALTEXTURE=n.a.getDefineByName("NORMALTEXTURE")}get horizonColor(){return this._shaderValues.getVector(l.HORIZONCOLOR)}set horizonColor(t){this._shaderValues.setVector(l.HORIZONCOLOR,t)}get mainTexture(){return this._shaderValues.getTexture(l.MAINTEXTURE)}set mainTexture(t){t?this._shaderValues.addDefine(l.SHADERDEFINE_MAINTEXTURE):this._shaderValues.removeDefine(l.SHADERDEFINE_MAINTEXTURE),this._shaderValues.setTexture(l.MAINTEXTURE,t)}get normalTexture(){return this._shaderValues.getTexture(l.NORMALTEXTURE)}set normalTexture(t){t?this._shaderValues.addDefine(l.SHADERDEFINE_NORMALTEXTURE):this._shaderValues.removeDefine(l.SHADERDEFINE_NORMALTEXTURE),this._shaderValues.setTexture(l.NORMALTEXTURE,t)}get waveScale(){return this._shaderValues.getNumber(l.WAVESCALE)}set waveScale(t){this._shaderValues.setNumber(l.WAVESCALE,t)}get waveSpeed(){return this._shaderValues.getVector(l.WAVESPEED)}set waveSpeed(t){this._shaderValues.setVector(l.WAVESPEED,t)}constructor(){super(),this.setShaderName("WaterPrimary"),this._shaderValues.setVector(l.HORIZONCOLOR,new s.a(.172,.463,.435,0)),this._shaderValues.setNumber(l.WAVESCALE,.15),this._shaderValues.setVector(l.WAVESPEED,new s.a(19,9,-16,-7))}clone(){var t=new l;return this.cloneTo(t),t}}e.a=l,r()(l,"HORIZONCOLOR",n.a.propertyNameToID("u_HorizonColor")),r()(l,"MAINTEXTURE",n.a.propertyNameToID("u_MainTexture")),r()(l,"NORMALTEXTURE",n.a.propertyNameToID("u_NormalTexture")),r()(l,"WAVESCALE",n.a.propertyNameToID("u_WaveScale")),r()(l,"WAVESPEED",n.a.propertyNameToID("u_WaveSpeed")),r()(l,"SHADERDEFINE_MAINTEXTURE",void 0),r()(l,"SHADERDEFINE_NORMALTEXTURE",void 0),r()(l,"defaultMaterial",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{get time(){return this._time}get minCount(){return this._minCount}get maxCount(){return this._maxCount}constructor(t,e,i){r()(this,"_time",void 0),r()(this,"_minCount",void 0),r()(this,"_maxCount",void 0),this._time=t,this._minCount=e,this._maxCount=i}cloneTo(t){var e=t;e._time=this._time,e._minCount=this._minCount,e._maxCount=this._maxCount}clone(){var t=new s(this._time,this._minCount,this._maxCount);return this.cloneTo(t),t}}e.a=s},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(292);class n{get color(){return this._color}constructor(t){r()(this,"_color",void 0),r()(this,"enable",void 0),this._color=t}cloneTo(t){var e=t;this._color.cloneTo(e._color),e.enable=this.enable}clone(){var t;switch(this._color.type){case 0:t=s.a.createByConstant(this._color.constant.clone());break;case 1:t=s.a.createByGradient(this._color.gradient.clone());break;case 2:t=s.a.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:t=s.a.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var e=new n(t);return e.enable=this.enable,e}}e.a=n},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{get gradientCount(){return this._currentLength/2}constructor(){r()(this,"_currentLength",0),r()(this,"_elements",void 0),this._elements=new Float32Array(8)}add(t,e){this._currentLength<8?(6===this._currentLength&&1!==t&&(t=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=t,this._elements[this._currentLength++]=e):console.log("Warning:data count must lessEqual than 4")}cloneTo(t){var e=t;e._currentLength=this._currentLength;for(var i=e._elements,a=0,r=this._elements.length;a<r;a++)i[a]=this._elements[a]}clone(){var t=new s;return this.cloneTo(t),t}}e.a=s},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(294);class n{get angularVelocity(){return this._angularVelocity}constructor(t){r()(this,"_angularVelocity",void 0),r()(this,"enable",void 0),this._angularVelocity=t}cloneTo(t){var e=t;this._angularVelocity.cloneTo(e._angularVelocity),e.enable=this.enable}clone(){var t;switch(this._angularVelocity.type){case 0:t=this._angularVelocity.separateAxes?s.a.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):s.a.createByConstant(this._angularVelocity.constant);break;case 1:t=this._angularVelocity.separateAxes?s.a.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone()):s.a.createByGradient(this._angularVelocity.gradient.clone());break;case 2:t=this._angularVelocity.separateAxes?s.a.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):s.a.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:t=this._angularVelocity.separateAxes?s.a.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):s.a.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var e=new n(t);return e.enable=this.enable,e}}e.a=n},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(88),n=i(105);class o extends s.a{constructor(){super(),r()(this,"x",void 0),r()(this,"y",void 0),r()(this,"z",void 0),this.shapeType=s.b.Box,this.x=1,this.y=1,this.z=1}_getShapeBoundBox(t){var e=t.min;e.x=.5*-this.x,e.y=.5*-this.y,e.z=.5*-this.z;var i=t.max;i.x=.5*this.x,i.y=.5*this.y,i.z=.5*this.z}_getSpeedBoundBox(t){var e=t.min;e.x=0,e.y=0,e.z=0;var i=t.max;i.x=0,i.y=1,i.z=0}generatePositionAndDirection(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;i?(i.seed=a[16],n.a._randomPointInsideHalfUnitBox(t,i),a[16]=i.seed):n.a._randomPointInsideHalfUnitBox(t),t.x=this.x*t.x,t.y=this.y*t.y,t.z=this.z*t.z,this.randomDirection?i?(i.seed=a[17],n.a._randomPointUnitSphere(e,i),a[17]=i.seed):n.a._randomPointUnitSphere(e):(e.x=0,e.y=0,e.z=1)}cloneTo(t){super.cloneTo(t);var e=t;e.x=this.x,e.y=this.y,e.z=this.z,e.randomDirection=this.randomDirection}clone(){var t=new o;return this.cloneTo(t),t}}e.a=o},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(88),n=i(105),o=i(20),l=i(1);class h extends s.a{constructor(){super(),r()(this,"radius",void 0),r()(this,"arc",void 0),r()(this,"emitFromEdge",void 0),this.shapeType=s.b.Circle,this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1}_getShapeBoundBox(t){var e=t.min;e.x=e.z=-this.radius,e.y=0;var i=t.max;i.x=i.z=this.radius,i.y=0}_getSpeedBoundBox(t){var e=t.min;e.x=e.y=-1,e.z=0;var i=t.max;i.x=i.y=1,i.z=0}generatePositionAndDirection(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;var r=h._tempPositionPoint;i?(i.seed=a[16],this.emitFromEdge?n.a._randomPointUnitArcCircle(this.arc,h._tempPositionPoint,i):n.a._randomPointInsideUnitArcCircle(this.arc,h._tempPositionPoint,i),a[16]=i.seed):this.emitFromEdge?n.a._randomPointUnitArcCircle(this.arc,h._tempPositionPoint):n.a._randomPointInsideUnitArcCircle(this.arc,h._tempPositionPoint),t.x=-r.x,t.y=r.y,t.z=0,l.a.scale(t,this.radius,t),this.randomDirection?i?(i.seed=a[17],n.a._randomPointUnitSphere(e,i),a[17]=i.seed):n.a._randomPointUnitSphere(e):t.cloneTo(e)}cloneTo(t){super.cloneTo(t);var e=t;e.radius=this.radius,e.arc=this.arc,e.emitFromEdge=this.emitFromEdge,e.randomDirection=this.randomDirection}clone(){var t=new h;return this.cloneTo(t),t}}e.a=h,r()(h,"_tempPositionPoint",new o.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(88),n=i(105),o=i(20),l=i(1);class h extends s.a{constructor(){super(),r()(this,"angle",void 0),r()(this,"radius",void 0),r()(this,"length",void 0),r()(this,"emitType",void 0),this.shapeType=s.b.Cone,this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0}_getShapeBoundBox(t){const e=this.radius+this.length*Math.sin(this.angle),i=this.length*Math.cos(this.angle);var a=t.min;a.x=a.y=-e,a.z=0;var r=t.max;r.x=r.y=e,r.z=i}_getSpeedBoundBox(t){const e=Math.sin(this.angle);var i=t.min;i.x=i.y=-e,i.z=0;var a=t.max;a.x=a.y=e,a.z=1}generatePositionAndDirection(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;var r,s,o,_=h._tempPositionPoint,c=Math.cos(this.angle),d=Math.sin(this.angle);switch(this.emitType){case 0:i?(i.seed=a[16],n.a._randomPointInsideUnitCircle(h._tempPositionPoint,i),a[16]=i.seed):n.a._randomPointInsideUnitCircle(h._tempPositionPoint),r=_.x,s=_.y,t.x=r*this.radius,t.y=s*this.radius,t.z=0,this.randomDirection?(i?(i.seed=a[17],n.a._randomPointInsideUnitCircle(h._tempDirectionPoint,i),a[17]=i.seed):n.a._randomPointInsideUnitCircle(h._tempDirectionPoint),o=h._tempDirectionPoint,e.x=o.x*d,e.y=o.y*d):(e.x=r*d,e.y=s*d),e.z=c;break;case 1:i?(i.seed=a[16],n.a._randomPointUnitCircle(h._tempPositionPoint,i),a[16]=i.seed):n.a._randomPointUnitCircle(h._tempPositionPoint),r=_.x,s=_.y,t.x=r*this.radius,t.y=s*this.radius,t.z=0,this.randomDirection?(i?(i.seed=a[17],n.a._randomPointInsideUnitCircle(h._tempDirectionPoint,i),a[17]=i.seed):n.a._randomPointInsideUnitCircle(h._tempDirectionPoint),o=h._tempDirectionPoint,e.x=o.x*d,e.y=o.y*d):(e.x=r*d,e.y=s*d),e.z=c;break;case 2:i?(i.seed=a[16],n.a._randomPointInsideUnitCircle(h._tempPositionPoint,i)):n.a._randomPointInsideUnitCircle(h._tempPositionPoint),r=_.x,s=_.y,t.x=r*this.radius,t.y=s*this.radius,t.z=0,e.x=r*d,e.y=s*d,e.z=c,l.a.normalize(e,e),i?(l.a.scale(e,this.length*i.getFloat(),e),a[16]=i.seed):l.a.scale(e,this.length*Math.random(),e),l.a.add(t,e,t),this.randomDirection&&(i?(i.seed=a[17],n.a._randomPointUnitSphere(e,i),a[17]=i.seed):n.a._randomPointUnitSphere(e));break;case 3:i?(i.seed=a[16],n.a._randomPointUnitCircle(h._tempPositionPoint,i)):n.a._randomPointUnitCircle(h._tempPositionPoint),r=_.x,s=_.y,t.x=r*this.radius,t.y=s*this.radius,t.z=0,e.x=r*d,e.y=s*d,e.z=c,l.a.normalize(e,e),i?(l.a.scale(e,this.length*i.getFloat(),e),a[16]=i.seed):l.a.scale(e,this.length*Math.random(),e),l.a.add(t,e,t),this.randomDirection&&(i?(i.seed=a[17],n.a._randomPointUnitSphere(e,i),a[17]=i.seed):n.a._randomPointUnitSphere(e));break;default:throw new Error("ConeShape:emitType is invalid.")}}cloneTo(t){super.cloneTo(t);var e=t;e.angle=this.angle,e.radius=this.radius,e.length=this.length,e.emitType=this.emitType,e.randomDirection=this.randomDirection}clone(){var t=new h;return this.cloneTo(t),t}}e.a=h,r()(h,"_tempPositionPoint",new o.a),r()(h,"_tempDirectionPoint",new o.a)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(88),n=i(105),o=i(1);class l extends s.a{constructor(){super(),r()(this,"radius",void 0),r()(this,"emitFromShell",void 0),this.shapeType=s.b.Hemisphere,this.radius=1,this.emitFromShell=!1}_getShapeBoundBox(t){var e=t.min;e.x=e.y=e.z=-this.radius;var i=t.max;i.x=i.y=this.radius,i.z=0}_getSpeedBoundBox(t){var e=t.min;e.x=e.y=-1,e.z=0;var i=t.max;i.x=i.y=i.z=1}generatePositionAndDirection(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;i?(i.seed=a[16],this.emitFromShell?n.a._randomPointUnitSphere(t,i):n.a._randomPointInsideUnitSphere(t,i),a[16]=i.seed):this.emitFromShell?n.a._randomPointUnitSphere(t):n.a._randomPointInsideUnitSphere(t),o.a.scale(t,this.radius,t);var r=t.z;r<0&&(t.z=-1*r),this.randomDirection?i?(i.seed=a[17],n.a._randomPointUnitSphere(e,i),a[17]=i.seed):n.a._randomPointUnitSphere(e):t.cloneTo(e)}cloneTo(t){super.cloneTo(t);var e=t;e.radius=this.radius,e.emitFromShell=this.emitFromShell,e.randomDirection=this.randomDirection}clone(){var t=new l;return this.cloneTo(t),t}}e.a=l},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(88),n=i(105),o=i(1);class l extends s.a{constructor(){super(),r()(this,"radius",void 0),r()(this,"emitFromShell",void 0),this.shapeType=s.b.Sphere,this.radius=1,this.emitFromShell=!1}_getShapeBoundBox(t){var e=t.min;e.x=e.y=e.z=-this.radius;var i=t.max;i.x=i.y=i.z=this.radius}_getSpeedBoundBox(t){var e=t.min;e.x=e.y=e.z=-1;var i=t.max;i.x=i.y=i.z=1}generatePositionAndDirection(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;i?(i.seed=a[16],this.emitFromShell?n.a._randomPointUnitSphere(t,i):n.a._randomPointInsideUnitSphere(t,i),a[16]=i.seed):this.emitFromShell?n.a._randomPointUnitSphere(t):n.a._randomPointInsideUnitSphere(t),o.a.scale(t,this.radius,t),this.randomDirection?i?(i.seed=a[17],n.a._randomPointUnitSphere(e,i),a[17]=i.seed):n.a._randomPointUnitSphere(e):t.cloneTo(e)}cloneTo(t){super.cloneTo(t);var e=t;e.radius=this.radius,e.emitFromShell=this.emitFromShell,e.randomDirection=this.randomDirection}clone(){var t=new l;return this.cloneTo(t),t}}e.a=l},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(296);class n{get size(){return this._size}constructor(t){r()(this,"_size",void 0),r()(this,"enable",void 0),this._size=t}cloneTo(t){var e=t;this._size.cloneTo(e._size),e.enable=this.enable}clone(){var t;switch(this._size.type){case 0:t=this._size.separateAxes?s.a.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):s.a.createByGradient(this._size.gradient.clone());break;case 1:t=this._size.separateAxes?s.a.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):s.a.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:t=this._size.separateAxes?s.a.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):s.a.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var e=new n(t);return e.enable=this.enable,e}}e.a=n},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(293),n=i(298),o=i(20);class l{get frame(){return this._frame}get startFrame(){return this._startFrame}constructor(t,e){r()(this,"_frame",void 0),r()(this,"_startFrame",void 0),r()(this,"tiles",void 0),r()(this,"type",0),r()(this,"randomRow",!1),r()(this,"rowIndex",0),r()(this,"cycles",0),r()(this,"enableUVChannels",0),r()(this,"enable",!1),this.tiles=new o.a(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=t,this._startFrame=e}cloneTo(t){var e=t;this.tiles.cloneTo(e.tiles),e.type=this.type,e.randomRow=this.randomRow,e.rowIndex=this.rowIndex,e.cycles=this.cycles,e.enableUVChannels=this.enableUVChannels,e.enable=this.enable,this._frame.cloneTo(e._frame),this._startFrame.cloneTo(e._startFrame)}clone(){var t,e;switch(this._frame.type){case 0:t=s.a.createByConstant(this._frame.constant);break;case 1:t=s.a.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:t=s.a.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:t=s.a.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:e=n.a.createByConstant(this._startFrame.constant);break;case 1:e=n.a.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var i=new l(t,e);return this.cloneTo(i),i}}e.a=l},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(297);class n{get velocity(){return this._velocity}constructor(t){r()(this,"_velocity",void 0),r()(this,"enable",!1),r()(this,"space",0),this._velocity=t}cloneTo(t){var e=t;this._velocity.cloneTo(e._velocity),e.enable=this.enable,e.space=this.space}clone(){var t;switch(this._velocity.type){case 0:t=s.a.createByConstant(this._velocity.constant.clone());break;case 1:t=s.a.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:t=s.a.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:t=s.a.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var e=new n(t);return e.enable=this.enable,e.space=this.space,e}}e.a=n},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(101),n=i(9),o=i(1),l=i(51),h=i(133),_=i(188);e.a=class extends h.a{get renderMode(){return this._renderMode}set renderMode(t){if(this._renderMode!==t){var e=this._shaderValues;switch(this._renderMode){case 0:e.removeDefine(_.a.SHADERDEFINE_RENDERMODE_BILLBOARD);break;case 1:e.removeDefine(_.a.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);break;case 2:e.removeDefine(_.a.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);break;case 3:e.removeDefine(_.a.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);break;case 4:e.removeDefine(_.a.SHADERDEFINE_RENDERMODE_MESH)}switch(this._renderMode=t,t){case 0:e.addDefine(_.a.SHADERDEFINE_RENDERMODE_BILLBOARD);break;case 1:e.addDefine(_.a.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);break;case 2:e.addDefine(_.a.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);break;case 3:e.addDefine(_.a.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);break;case 4:e.addDefine(_.a.SHADERDEFINE_RENDERMODE_MESH);break;default:throw new Error("ShurikenParticleRender: unknown renderMode Value.")}var i=this._owner.particleSystem;i&&i._initBufferDatas()}}get mesh(){return this._mesh}set mesh(t){this._mesh!==t&&(this._mesh&&this._mesh._removeReference(),this._mesh=t,t&&t._addReference(),this._owner.particleSystem._initBufferDatas())}constructor(t){super(t),r()(this,"_finalGravity",new o.a),r()(this,"_tempRotationMatrix",new n.a),r()(this,"_defaultBoundBox",void 0),r()(this,"_renderMode",void 0),r()(this,"_mesh",null),r()(this,"stretchedBillboardCameraSpeedScale",0),r()(this,"stretchedBillboardSpeedScale",0),r()(this,"stretchedBillboardLengthScale",2),this._defaultBoundBox=new s.a(new o.a,new o.a),this.renderMode=0,this._supportOctree=!1}_calculateBoundingBox(){var t=this._owner.particleSystem;if(t._useCustomBounds)t.customBounds._tranform(this._owner.transform.worldMatrix,this._bounds);else if(t._simulationSupported()){if(t._generateBounds(),t._bounds._tranform(this._owner.transform.worldMatrix,this._bounds),0!=t.gravityModifier){var e=this._bounds.getMax(),i=this._bounds.getMin(),a=t._gravityOffset;e.y-=a.x,i.y-=a.y,this._bounds.setMax(e),this._bounds.setMin(i)}}else(i=this._bounds.getMin()).setValue(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._bounds.setMin(i),(e=this._bounds.getMax()).setValue(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._bounds.setMax(e)}_needRender(t,e){return!t||!!t.intersects(this.bounds._getBoundBox())&&!!this._owner.particleSystem.isAlive}_renderUpdate(t,e){var i=this._owner.particleSystem,a=this._shaderValues,r=this._owner.transform;switch(i.simulationSpace){case 0:break;case 1:a.setVector3(_.a.WORLDPOSITION,r.position),a.setQuaternion(_.a.WORLDROTATION,r.rotation);break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}switch(i.scaleMode){case 0:var s=r.getWorldLossyScale();a.setVector3(_.a.POSITIONSCALE,s),a.setVector3(_.a.SIZESCALE,s);break;case 1:var n=r.localScale;a.setVector3(_.a.POSITIONSCALE,n),a.setVector3(_.a.SIZESCALE,n);break;case 2:a.setVector3(_.a.POSITIONSCALE,r.getWorldLossyScale()),a.setVector3(_.a.SIZESCALE,o.a._ONE)}o.a.scale(l.a.gravity,i.gravityModifier,this._finalGravity),a.setVector3(_.a.GRAVITY,this._finalGravity),a.setInt(_.a.SIMULATIONSPACE,i.simulationSpace),a.setBool(_.a.THREEDSTARTROTATION,i.threeDStartRotation),a.setInt(_.a.SCALINGMODE,i.scaleMode),a.setNumber(_.a.STRETCHEDBILLBOARDLENGTHSCALE,this.stretchedBillboardLengthScale),a.setNumber(_.a.STRETCHEDBILLBOARDSPEEDSCALE,this.stretchedBillboardSpeedScale),a.setNumber(_.a.CURRENTTIME,i._currentTime)}get bounds(){return this._boundsChange&&(this._calculateBoundingBox(),this._boundsChange=!1),this._bounds}_destroy(){super._destroy(),this._mesh&&(this._mesh._removeReference(),this._mesh=null)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(167),o=i(17),l=i(8),h=i(57),_=i(14),c=i(300),d=i(301),u=i(25),f=i(101),m=i(286),p=i(490),g=i(20),v=i(1),T=i(5),E=i(38),S=i(75),R=i(491),x=i(295),A=i(88),y=i(188),I=i(492),C=i(39),M=i(74);class D extends S.a{get maxParticles(){return this._bufferMaxParticles-1}set maxParticles(t){var e=t+1;e!==this._bufferMaxParticles&&(this._bufferMaxParticles=e,this._initBufferDatas())}get emission(){return this._emission}get aliveParticleCount(){return this._firstNewElement>=this._firstRetiredElement?this._firstNewElement-this._firstRetiredElement:this._bufferMaxParticles-this._firstRetiredElement+this._firstNewElement}get emissionTime(){return this._emissionTime>this.duration?this.duration:this._emissionTime}get shape(){return this._shape}set shape(t){this._shape!==t&&(t&&t.enable?this._owner._render._shaderValues.addDefine(y.a.SHADERDEFINE_SHAPE):this._owner._render._shaderValues.removeDefine(y.a.SHADERDEFINE_SHAPE),this._shape=t)}get isAlive(){return!!(this._isPlaying||this.aliveParticleCount>0)}get isEmitting(){return this._isEmitting}get isPlaying(){return this._isPlaying}get isPaused(){return this._isPaused}get startLifetimeType(){return this._startLifetimeType}set startLifetimeType(t){var e,i;switch(this.startLifetimeType){case 0:this._maxStartLifetime=this.startLifetimeConstant;break;case 1:this._maxStartLifetime=-Number.MAX_VALUE;var a=a;for(e=0,i=a.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,a.getValueByIndex(e));break;case 2:this._maxStartLifetime=Math.max(this.startLifetimeConstantMin,this.startLifetimeConstantMax);break;case 3:this._maxStartLifetime=-Number.MAX_VALUE;var r=r;for(e=0,i=r.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,r.getValueByIndex(e));var s=s;for(e=0,i=s.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,s.getValueByIndex(e))}this._startLifetimeType=t}get startLifetimeConstant(){return this._startLifetimeConstant}set startLifetimeConstant(t){0===this._startLifetimeType&&(this._maxStartLifetime=t),this._startLifetimeConstant=t}get startLifeTimeGradient(){return this._startLifeTimeGradient}set startLifeTimeGradient(t){if(1===this._startLifetimeType){this._maxStartLifetime=-Number.MAX_VALUE;for(var e=0,i=t.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e))}this._startLifeTimeGradient=t}get startLifetimeConstantMin(){return this._startLifetimeConstantMin}set startLifetimeConstantMin(t){2===this._startLifetimeType&&(this._maxStartLifetime=Math.max(t,this._startLifetimeConstantMax)),this._startLifetimeConstantMin=t}get startLifetimeConstantMax(){return this._startLifetimeConstantMax}set startLifetimeConstantMax(t){2===this._startLifetimeType&&(this._maxStartLifetime=Math.max(this._startLifetimeConstantMin,t)),this._startLifetimeConstantMax=t}get startLifeTimeGradientMin(){return this._startLifeTimeGradientMin}set startLifeTimeGradientMin(t){if(3===this._startLifetimeType){var e,i;for(this._maxStartLifetime=-Number.MAX_VALUE,e=0,i=t.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e));for(e=0,i=this._startLifeTimeGradientMax.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,this._startLifeTimeGradientMax.getValueByIndex(e))}this._startLifeTimeGradientMin=t}get startLifeTimeGradientMax(){return this._startLifeTimeGradientMax}set startLifeTimeGradientMax(t){if(3===this._startLifetimeType){var e,i;for(this._maxStartLifetime=-Number.MAX_VALUE,e=0,i=this._startLifeTimeGradientMin.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,this._startLifeTimeGradientMin.getValueByIndex(e));for(e=0,i=t.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e))}this._startLifeTimeGradientMax=t}get velocityOverLifetime(){return this._velocityOverLifetime}set velocityOverLifetime(t){var e=this._owner._render._shaderValues;if(t){var i=t.velocity,a=i.type;if(t.enable)switch(a){case 0:e.addDefine(y.a.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT);break;case 1:e.addDefine(y.a.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE);break;case 2:e.addDefine(y.a.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT);break;case 3:e.addDefine(y.a.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE)}else e.removeDefine(y.a.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT),e.removeDefine(y.a.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE),e.removeDefine(y.a.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT),e.removeDefine(y.a.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE);switch(a){case 0:e.setVector3(y.a.VOLVELOCITYCONST,i.constant);break;case 1:e.setBuffer(y.a.VOLVELOCITYGRADIENTX,i.gradientX._elements),e.setBuffer(y.a.VOLVELOCITYGRADIENTY,i.gradientY._elements),e.setBuffer(y.a.VOLVELOCITYGRADIENTZ,i.gradientZ._elements);break;case 2:e.setVector3(y.a.VOLVELOCITYCONST,i.constantMin),e.setVector3(y.a.VOLVELOCITYCONSTMAX,i.constantMax);break;case 3:e.setBuffer(y.a.VOLVELOCITYGRADIENTX,i.gradientXMin._elements),e.setBuffer(y.a.VOLVELOCITYGRADIENTXMAX,i.gradientXMax._elements),e.setBuffer(y.a.VOLVELOCITYGRADIENTY,i.gradientYMin._elements),e.setBuffer(y.a.VOLVELOCITYGRADIENTYMAX,i.gradientYMax._elements),e.setBuffer(y.a.VOLVELOCITYGRADIENTZ,i.gradientZMin._elements),e.setBuffer(y.a.VOLVELOCITYGRADIENTZMAX,i.gradientZMax._elements)}e.setInt(y.a.VOLSPACETYPE,t.space)}else e.removeDefine(y.a.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT),e.removeDefine(y.a.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE),e.removeDefine(y.a.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT),e.removeDefine(y.a.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE);this._velocityOverLifetime=t}get colorOverLifetime(){return this._colorOverLifetime}set colorOverLifetime(t){var e=this._owner._render._shaderValues;if(t){var i=t.color;if(t.enable)switch(i.type){case 1:e.addDefine(y.a.SHADERDEFINE_COLOROVERLIFETIME);break;case 3:e.addDefine(y.a.SHADERDEFINE_RANDOMCOLOROVERLIFETIME)}else e.removeDefine(y.a.SHADERDEFINE_COLOROVERLIFETIME),e.removeDefine(y.a.SHADERDEFINE_RANDOMCOLOROVERLIFETIME);switch(i.type){case 1:var a=i.gradient;e.setBuffer(y.a.COLOROVERLIFEGRADIENTALPHAS,a._alphaElements),e.setBuffer(y.a.COLOROVERLIFEGRADIENTCOLORS,a._rgbElements);break;case 3:var r=i.gradientMin,s=i.gradientMax;e.setBuffer(y.a.COLOROVERLIFEGRADIENTALPHAS,r._alphaElements),e.setBuffer(y.a.COLOROVERLIFEGRADIENTCOLORS,r._rgbElements),e.setBuffer(y.a.MAXCOLOROVERLIFEGRADIENTALPHAS,s._alphaElements),e.setBuffer(y.a.MAXCOLOROVERLIFEGRADIENTCOLORS,s._rgbElements)}}else e.removeDefine(y.a.SHADERDEFINE_COLOROVERLIFETIME),e.removeDefine(y.a.SHADERDEFINE_RANDOMCOLOROVERLIFETIME),e.setBuffer(y.a.COLOROVERLIFEGRADIENTALPHAS,a._alphaElements),e.setBuffer(y.a.COLOROVERLIFEGRADIENTCOLORS,a._rgbElements),e.setBuffer(y.a.COLOROVERLIFEGRADIENTALPHAS,r._alphaElements),e.setBuffer(y.a.COLOROVERLIFEGRADIENTCOLORS,r._rgbElements),e.setBuffer(y.a.MAXCOLOROVERLIFEGRADIENTALPHAS,s._alphaElements),e.setBuffer(y.a.MAXCOLOROVERLIFEGRADIENTCOLORS,s._rgbElements);this._colorOverLifetime=t}get sizeOverLifetime(){return this._sizeOverLifetime}set sizeOverLifetime(t){var e=this._owner._render._shaderValues;if(t){var i=t.size,a=i.separateAxes,r=i.type;if(t.enable)switch(r){case 0:a?e.addDefine(y.a.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE):e.addDefine(y.a.SHADERDEFINE_SIZEOVERLIFETIMECURVE);break;case 2:a?e.addDefine(y.a.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE):e.addDefine(y.a.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES)}else e.removeDefine(y.a.SHADERDEFINE_SIZEOVERLIFETIMECURVE),e.removeDefine(y.a.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE),e.removeDefine(y.a.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES),e.removeDefine(y.a.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE);switch(r){case 0:a?(e.setBuffer(y.a.SOLSIZEGRADIENTX,i.gradientX._elements),e.setBuffer(y.a.SOLSIZEGRADIENTY,i.gradientY._elements),e.setBuffer(y.a.SOLSizeGradientZ,i.gradientZ._elements)):e.setBuffer(y.a.SOLSIZEGRADIENT,i.gradient._elements);break;case 2:a?(e.setBuffer(y.a.SOLSIZEGRADIENTX,i.gradientXMin._elements),e.setBuffer(y.a.SOLSIZEGRADIENTXMAX,i.gradientXMax._elements),e.setBuffer(y.a.SOLSIZEGRADIENTY,i.gradientYMin._elements),e.setBuffer(y.a.SOLSIZEGRADIENTYMAX,i.gradientYMax._elements),e.setBuffer(y.a.SOLSizeGradientZ,i.gradientZMin._elements),e.setBuffer(y.a.SOLSizeGradientZMAX,i.gradientZMax._elements)):(e.setBuffer(y.a.SOLSIZEGRADIENT,i.gradientMin._elements),e.setBuffer(y.a.SOLSizeGradientMax,i.gradientMax._elements))}}else e.removeDefine(y.a.SHADERDEFINE_SIZEOVERLIFETIMECURVE),e.removeDefine(y.a.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE),e.removeDefine(y.a.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES),e.removeDefine(y.a.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE);this._sizeOverLifetime=t}get rotationOverLifetime(){return this._rotationOverLifetime}set rotationOverLifetime(t){var e=this._owner._render._shaderValues;if(t){var i=t.angularVelocity;if(!i)return;var a=i.separateAxes,r=i.type;if(t.enable)switch(a?e.addDefine(y.a.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE):e.addDefine(y.a.SHADERDEFINE_ROTATIONOVERLIFETIME),r){case 0:e.addDefine(y.a.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT);break;case 1:e.addDefine(y.a.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE);break;case 2:e.addDefine(y.a.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS);break;case 3:e.addDefine(y.a.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES)}else e.removeDefine(y.a.SHADERDEFINE_ROTATIONOVERLIFETIME),e.removeDefine(y.a.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE),e.removeDefine(y.a.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT),e.removeDefine(y.a.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE),e.removeDefine(y.a.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS),e.removeDefine(y.a.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES);switch(r){case 0:a?e.setVector3(y.a.ROLANGULARVELOCITYCONSTSEPRARATE,i.constantSeparate):e.setNumber(y.a.ROLANGULARVELOCITYCONST,i.constant);break;case 1:a?(e.setBuffer(y.a.ROLANGULARVELOCITYGRADIENTX,i.gradientX._elements),e.setBuffer(y.a.ROLANGULARVELOCITYGRADIENTY,i.gradientY._elements),e.setBuffer(y.a.ROLANGULARVELOCITYGRADIENTZ,i.gradientZ._elements)):e.setBuffer(y.a.ROLANGULARVELOCITYGRADIENT,i.gradient._elements);break;case 2:a?(e.setVector3(y.a.ROLANGULARVELOCITYCONSTSEPRARATE,i.constantMinSeparate),e.setVector3(y.a.ROLANGULARVELOCITYCONSTMAXSEPRARATE,i.constantMaxSeparate)):(e.setNumber(y.a.ROLANGULARVELOCITYCONST,i.constantMin),e.setNumber(y.a.ROLANGULARVELOCITYCONSTMAX,i.constantMax));break;case 3:a?(e.setBuffer(y.a.ROLANGULARVELOCITYGRADIENTX,i.gradientXMin._elements),e.setBuffer(y.a.ROLANGULARVELOCITYGRADIENTXMAX,i.gradientXMax._elements),e.setBuffer(y.a.ROLANGULARVELOCITYGRADIENTY,i.gradientYMin._elements),e.setBuffer(y.a.ROLANGULARVELOCITYGRADIENTYMAX,i.gradientYMax._elements),e.setBuffer(y.a.ROLANGULARVELOCITYGRADIENTZ,i.gradientZMin._elements),e.setBuffer(y.a.ROLANGULARVELOCITYGRADIENTZMAX,i.gradientZMax._elements)):(e.setBuffer(y.a.ROLANGULARVELOCITYGRADIENT,i.gradientMin._elements),e.setBuffer(y.a.ROLANGULARVELOCITYGRADIENTMAX,i.gradientMax._elements))}}else e.removeDefine(y.a.SHADERDEFINE_ROTATIONOVERLIFETIME),e.removeDefine(y.a.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE),e.removeDefine(y.a.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT),e.removeDefine(y.a.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE),e.removeDefine(y.a.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS),e.removeDefine(y.a.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES);this._rotationOverLifetime=t}get textureSheetAnimation(){return this._textureSheetAnimation}set textureSheetAnimation(t){var e=this._owner._render._shaderValues;if(t){var i=t.frame,a=i.type;if(t.enable)switch(a){case 1:e.addDefine(y.a.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE);break;case 3:e.addDefine(y.a.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE)}else e.removeDefine(y.a.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE),e.removeDefine(y.a.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE);if(1===a||3===a){e.setNumber(y.a.TEXTURESHEETANIMATIONCYCLES,t.cycles);var r=t.tiles,s=this._uvLength;s.x=1/r.x,s.y=1/r.y,e.setVector2(y.a.TEXTURESHEETANIMATIONSUBUVLENGTH,this._uvLength)}switch(a){case 1:e.setBuffer(y.a.TEXTURESHEETANIMATIONGRADIENTUVS,i.frameOverTimeData._elements);break;case 3:e.setBuffer(y.a.TEXTURESHEETANIMATIONGRADIENTUVS,i.frameOverTimeDataMin._elements),e.setBuffer(y.a.TEXTURESHEETANIMATIONGRADIENTMAXUVS,i.frameOverTimeDataMax._elements)}}else e.removeDefine(y.a.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE),e.removeDefine(y.a.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE);this._textureSheetAnimation=t}constructor(t){super(),r()(this,"_boundingSphere",null),r()(this,"_boundingBox",null),r()(this,"_boundingBoxCorners",null),r()(this,"_bounds",null),r()(this,"_gravityOffset",new g.a),r()(this,"_customBounds",null),r()(this,"_useCustomBounds",!1),r()(this,"_owner",null),r()(this,"_ownerRender",null),r()(this,"_vertices",null),r()(this,"_floatCountPerVertex",0),r()(this,"_startLifeTimeIndex",0),r()(this,"_timeIndex",0),r()(this,"_simulateUpdate",!1),r()(this,"_firstActiveElement",0),r()(this,"_firstNewElement",0),r()(this,"_firstFreeElement",0),r()(this,"_firstRetiredElement",0),r()(this,"_drawCounter",0),r()(this,"_bufferMaxParticles",0),r()(this,"_emission",null),r()(this,"_shape",null),r()(this,"_isEmitting",!1),r()(this,"_isPlaying",!1),r()(this,"_isPaused",!1),r()(this,"_playStartDelay",0),r()(this,"_frameRateTime",0),r()(this,"_emissionTime",0),r()(this,"_totalDelayTime",0),r()(this,"_burstsIndex",0),r()(this,"_velocityOverLifetime",null),r()(this,"_colorOverLifetime",null),r()(this,"_sizeOverLifetime",null),r()(this,"_rotationOverLifetime",null),r()(this,"_textureSheetAnimation",null),r()(this,"_startLifetimeType",0),r()(this,"_startLifetimeConstant",0),r()(this,"_startLifeTimeGradient",null),r()(this,"_startLifetimeConstantMin",0),r()(this,"_startLifetimeConstantMax",0),r()(this,"_startLifeTimeGradientMin",null),r()(this,"_startLifeTimeGradientMax",null),r()(this,"_maxStartLifetime",0),r()(this,"_uvLength",new g.a),r()(this,"_vertexStride",0),r()(this,"_indexStride",0),r()(this,"_vertexBuffer",null),r()(this,"_indexBuffer",null),r()(this,"_bufferState",new E.a),r()(this,"_updateMask",0),r()(this,"_currentTime",0),r()(this,"_startUpdateLoopCount",0),r()(this,"_rand",null),r()(this,"_randomSeeds",null),r()(this,"duration",0),r()(this,"looping",!1),r()(this,"prewarm",!1),r()(this,"startDelayType",0),r()(this,"startDelay",0),r()(this,"startDelayMin",0),r()(this,"startDelayMax",0),r()(this,"startSpeedType",0),r()(this,"startSpeedConstant",0),r()(this,"startSpeedConstantMin",0),r()(this,"startSpeedConstantMax",0),r()(this,"threeDStartSize",!1),r()(this,"startSizeType",0),r()(this,"startSizeConstant",0),r()(this,"startSizeConstantSeparate",null),r()(this,"startSizeConstantMin",0),r()(this,"startSizeConstantMax",0),r()(this,"startSizeConstantMinSeparate",null),r()(this,"startSizeConstantMaxSeparate",null),r()(this,"threeDStartRotation",!1),r()(this,"startRotationType",0),r()(this,"startRotationConstant",0),r()(this,"startRotationConstantSeparate",null),r()(this,"startRotationConstantMin",0),r()(this,"startRotationConstantMax",0),r()(this,"startRotationConstantMinSeparate",null),r()(this,"startRotationConstantMaxSeparate",null),r()(this,"randomizeRotationDirection",0),r()(this,"startColorType",0),r()(this,"startColorConstant",new T.a(1,1,1,1)),r()(this,"startColorConstantMin",new T.a(0,0,0,0)),r()(this,"startColorConstantMax",new T.a(1,1,1,1)),r()(this,"gravityModifier",0),r()(this,"simulationSpace",0),r()(this,"simulationSpeed",1),r()(this,"scaleMode",1),r()(this,"playOnAwake",!1),r()(this,"randomSeed",null),r()(this,"autoRandomSeed",!1),r()(this,"isPerformanceMode",!1),this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._owner=t,this._ownerRender=t.particleRenderer,this._boundingBoxCorners=[],this._boundingSphere=new m.a(new v.a,Number.MAX_VALUE),this._boundingBox=new f.a(new v.a(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),new v.a(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)),this._bounds=new M.a(this._boundingBox.min,this._boundingBox.max),this._useCustomBounds=!1,this._currentTime=0,this._isEmitting=!1,this._isPlaying=!1,this._isPaused=!1,this._burstsIndex=0,this._frameRateTime=0,this._emissionTime=0,this._totalDelayTime=0,this._simulateUpdate=!1,this._bufferMaxParticles=1,this.duration=5,this.looping=!0,this.prewarm=!1,this.startDelayType=0,this.startDelay=0,this.startDelayMin=0,this.startDelayMax=0,this._startLifetimeType=0,this._startLifetimeConstant=5,this._startLifeTimeGradient=new x.a,this._startLifetimeConstantMin=0,this._startLifetimeConstantMax=5,this._startLifeTimeGradientMin=new x.a,this._startLifeTimeGradientMax=new x.a,this._maxStartLifetime=5,this.startSpeedType=0,this.startSpeedConstant=5,this.startSpeedConstantMin=0,this.startSpeedConstantMax=5,this.threeDStartSize=!1,this.startSizeType=0,this.startSizeConstant=1,this.startSizeConstantSeparate=new v.a(1,1,1),this.startSizeConstantMin=0,this.startSizeConstantMax=1,this.startSizeConstantMinSeparate=new v.a(0,0,0),this.startSizeConstantMaxSeparate=new v.a(1,1,1),this.threeDStartRotation=!1,this.startRotationType=0,this.startRotationConstant=0,this.startRotationConstantSeparate=new v.a(0,0,0),this.startRotationConstantMin=0,this.startRotationConstantMax=0,this.startRotationConstantMinSeparate=new v.a(0,0,0),this.startRotationConstantMaxSeparate=new v.a(0,0,0),this.gravityModifier=0,this.simulationSpace=1,this.scaleMode=1,this.playOnAwake=!0,this._rand=new p.a(0),this.autoRandomSeed=!0,this.randomSeed=new Uint32Array(1),this._randomSeeds=new Uint32Array(D._RANDOMOFFSET.length),this.isPerformanceMode=!0,this._emission=new R.a,this._emission.enable=!0}_getVertexBuffer(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?this._vertexBuffer:null}_getIndexBuffer(){return this._indexBuffer}_generateBoundingSphere(){var t=this._boundingSphere.center;t.x=0,t.y=0,t.z=0,this._boundingSphere.radius=Number.MAX_VALUE}_generateBoundingBox(){var t,e,i,a,r,s,n,o,l,h=this._owner.particleRenderer,_=this._boundingBox.min,c=this._boundingBox.max;switch(this.startLifetimeType){case 0:i=this.startLifetimeConstant;break;case 1:i=-Number.MAX_VALUE;var d=d;for(t=0,e=d.gradientCount;t<e;t++)i=Math.max(i,d.getValueByIndex(t));break;case 2:i=Math.max(this.startLifetimeConstantMin,this.startLifetimeConstantMax);break;case 3:i=-Number.MAX_VALUE;var u=u;for(t=0,e=u.gradientCount;t<e;t++)i=Math.max(i,u.getValueByIndex(t));var f=f;for(t=0,e=f.gradientCount;t<e;t++)i=Math.max(i,f.getValueByIndex(t))}switch(this.startSpeedType){case 0:a=r=this.startSpeedConstant;break;case 1:break;case 2:a=this.startLifetimeConstantMin,r=this.startLifetimeConstantMax}this._shape&&this._shape.enable||(s=n=v.a._ZERO,o=v.a._ZERO,l=v.a._UnitZ);var m,p,g=new v.a(o.x*a,o.y*a,o.z*a),T=new v.a(l.x*r,l.y*r,l.z*r);if(this._velocityOverLifetime&&this._velocityOverLifetime.enable){var E=this._velocityOverLifetime.velocity;switch(E.type){case 0:E.constant;break;case 1:new v.a(E.gradientX.getAverageValue(),E.gradientY.getAverageValue(),E.gradientZ.getAverageValue());break;case 2:E.constantMin,E.constantMax;break;case 3:new v.a(E.gradientXMin.getAverageValue(),E.gradientYMin.getAverageValue(),E.gradientZMin.getAverageValue()),new v.a(E.gradientXMax.getAverageValue(),E.gradientYMax.getAverageValue(),E.gradientZMax.getAverageValue())}}var S,R,x,A,y=this._owner.transform,I=y.position,C=D._tempVector39,M=h.renderMode;switch(this.scaleMode){case 0:var b=y.getWorldLossyScale();m=b,C.x=b.x,C.y=b.z,C.z=b.y,1===M&&(p=b);break;case 1:var L=y.localScale;m=L,C.x=L.x,C.y=L.z,C.z=L.y,1===M&&(p=L);break;case 2:m=y.getWorldLossyScale(),C.x=C.y=C.z=1,1===M&&(p=v.a._ONE)}switch(this._velocityOverLifetime&&this._velocityOverLifetime.enable||(S=new v.a(g.x*i,g.y*i,g.z*i),R=new v.a(T.x*i,T.y*i,T.z*i),2!=this.scaleMode?(v.a.add(s,S,_),v.a.multiply(m,_,_),v.a.add(n,R,c),v.a.multiply(m,c,c)):(v.a.multiply(m,s,_),v.a.add(_,S,_),v.a.multiply(m,n,c),v.a.add(c,R,c))),this.simulationSpace){case 0:break;case 1:v.a.add(_,I,_),v.a.add(c,I,c)}switch(this.startSizeType){case 0:if(this.threeDStartSize){var O=O;x=Math.max(O.x,O.y),1===M&&(A=O.y)}else x=this.startSizeConstant,1===M&&(A=this.startSizeConstant);break;case 1:break;case 2:if(this.threeDStartSize){var P=P;x=Math.max(P.x,P.y),1===M&&(A=P.y)}else x=this.startSizeConstantMax,1===M&&(A=this.startSizeConstantMax)}if(this._sizeOverLifetime&&this._sizeOverLifetime.enable){this._sizeOverLifetime.size;x*=this._sizeOverLifetime.size.getMaxSizeInGradient()}var N,w,B=D._tempVector30;switch(M){case 0:N=x*D.halfKSqrtOf2,v.a.scale(C,x,B),v.a.subtract(_,B,_),v.a.add(c,B,c);break;case 1:var F=D._tempVector31,V=D._tempVector32,U=D._tempVector33,G=D._tempVector34;this._velocityOverLifetime&&this._velocityOverLifetime.enable||(v.a.multiply(p,T,V),v.a.multiply(p,g,U));var H=A*h.stretchedBillboardLengthScale,z=v.a.scalarLength(V)*h.stretchedBillboardSpeedScale+H,k=v.a.scalarLength(U)*h.stretchedBillboardSpeedScale+H,W=D._tempVector35,X=D._tempVector36;v.a.normalize(V,W),v.a.scale(W,z,G),v.a.subtract(R,G,G),v.a.normalize(U,X),v.a.scale(X,k,F),v.a.add(S,F,F),N=x*D.halfKSqrtOf2,v.a.scale(C,N,B);var Y=D._tempVector37,j=D._tempVector38;v.a.scale(W,.5,Y),v.a.scale(X,.5,j),v.a.multiply(Y,C,Y),v.a.multiply(j,C,j),v.a.add(_,j,_),v.a.min(_,G,_),v.a.subtract(_,B,_),v.a.subtract(c,Y,c),v.a.max(c,F,c),v.a.add(c,B,c);break;case 2:w=.5*(x*=Math.cos(.7853981633974483)),B.x=C.x*w,B.y=C.z*w,v.a.subtract(_,B,_),v.a.add(c,B,c);break;case 3:w=.5*(x*=Math.cos(.7853981633974483)),v.a.scale(C,w,B),v.a.subtract(_,B,_),v.a.add(c,B,c)}this._boundingBox.getCorners(this._boundingBoxCorners)}_generateBounds(){var t=this._owner.particleRenderer,e=this._bounds.getMin(),i=this._bounds.getMax(),a=0;switch(this.startLifetimeType){case 0:a=this._startLifetimeConstant;break;case 2:a=this._startLifetimeConstantMax}var r=0;switch(this.startSpeedType){case 0:r=this.startSpeedConstant;break;case 2:r=this.startSpeedConstantMax}var s=0;if(this.threeDStartSize)switch(this.startSizeType){case 0:s=Math.max(this.startSizeConstantSeparate.x,this.startSizeConstantSeparate.y,this.startSizeConstantSeparate.z);break;case 2:s=Math.max(this.startSizeConstantMaxSeparate.x,this.startSizeConstantMaxSeparate.y,this.startSizeConstantMaxSeparate.z)}else switch(this.startSizeType){case 0:s=this.startSizeConstant;break;case 2:s=this.startSizeConstantMax}var n=D._tempVector30,o=D._tempVector31,l=D._tempVector32,h=D._tempVector33;if(n.setValue(0,0,1),o.setValue(0,0,0),l.setValue(0,0,0),h.setValue(0,0,0),this.shape&&this.shape.enable)switch(this.shape.shapeType){case A.b.Sphere:var _=this.shape;n.setValue(1,1,1),o.setValue(1,1,1),l.setValue(_.radius,_.radius,_.radius),h.setValue(_.radius,_.radius,_.radius);break;case A.b.Hemisphere:var c=this.shape;n.setValue(1,1,1),o.setValue(1,1,1),l.setValue(c.radius,c.radius,c.radius),h.setValue(c.radius,c.radius,0);break;case A.b.Cone:var d=this.shape;if(0==d.emitType||1==d.emitType){var u=d.angle,f=Math.sin(u);n.setValue(f,f,1),o.setValue(f,f,0),l.setValue(d.radius,d.radius,0),h.setValue(d.radius,d.radius,0);break}if(2==d.emitType||3==d.emitType){u=d.angle,f=Math.sin(u);var m=d.length;n.setValue(f,f,1),o.setValue(f,f,0);var p=Math.tan(u),g=d.radius+m*p;l.setValue(g,g,m),h.setValue(g,g,0)}break;case A.b.Box:var T=this.shape;0!=this.shape.randomDirection&&(n.setValue(1,1,1),o.setValue(1,1,1)),l.setValue(T.x/2,T.y/2,T.z/2),h.setValue(T.x/2,T.y/2,T.z/2);break;case A.b.Circle:var E=this.shape;n.setValue(1,1,1),o.setValue(1,1,1),l.setValue(E.radius,E.radius,0),h.setValue(E.radius,E.radius,0)}var S=0,R=4==t.renderMode;switch(t.renderMode){case 0:case 1:case 2:case 3:S=D.halfKSqrtOf2;break;case 4:var x=t.mesh.bounds;S=Math.sqrt(Math.pow(x.getExtent().x,2)+Math.pow(x.getExtent().y,2)+Math.pow(x.getExtent().z,2))}var y=D._tempVector36;if(y.setValue(1,1,1),this.sizeOverLifetime&&this.sizeOverLifetime.enable){var I=this.sizeOverLifetime.size.getMaxSizeInGradient(R);y.setValue(I,I,I)}var C=S*s;v.a.scale(y,C,y);var M=D._tempVector34,b=D._tempVector35;if(r>0?(v.a.scale(n,r,M),v.a.scale(o,r,b)):(v.a.scale(n,-r,b),v.a.scale(o,-r,M)),this.velocityOverLifetime&&this.velocityOverLifetime.enable){var L=this.velocityOverLifetime.velocity,O=D._tempVector37;switch(O.setValue(0,0,0),L.type){case 0:L.constant.cloneTo(O);break;case 2:L.constantMax.cloneTo(O);break;case 1:var P=L.gradientX.getAverageValue(),N=L.gradientY.getAverageValue(),w=L.gradientZ.getAverageValue();O.setValue(P,N,w);break;case 3:var B=L.gradientXMax.getAverageValue(),F=L.gradientYMax.getAverageValue(),V=L.gradientZMax.getAverageValue();O.setValue(B,F,V)}1==this.velocityOverLifetime.space&&v.a.transformV3ToV3(O,this._owner.transform.worldMatrix,O),v.a.add(M,O,M),v.a.subtract(b,O,b),v.a.max(M,v.a._ZERO,M),v.a.max(b,v.a._ZERO,b)}v.a.scale(M,a,M),v.a.scale(b,a,b);var U=this.gravityModifier;if(0!=U){var G=.5*D.g*U*a*a,H=M.y-G,z=b.y+G;H=H>0?H:0,z=z>0?z:0,this._gravityOffset.setValue(M.y-H,z-b.y)}v.a.add(M,y,i),v.a.add(i,l,i),v.a.add(b,y,e),v.a.add(e,h,e),v.a.scale(e,-1,e),this._bounds.setMin(e),this._bounds.setMax(i)}get customBounds(){return this._customBounds}set customBounds(t){this._useCustomBounds=!!t,this._customBounds=t}_simulationSupported(){return 0!=this.simulationSpace}_updateEmission(){if(this.isAlive)if(this._simulateUpdate)this._simulateUpdate=!1;else{var t=this._startUpdateLoopCount===l.a.loopCount||this._isPaused?0:this._owner._scene.timer._delta/1e3;t=Math.min(D._maxElapsedTime,t*this.simulationSpeed),this._updateParticles(t)}}_updateParticles(t){(4!==this._ownerRender.renderMode||this._ownerRender.mesh)&&(this._currentTime+=t,this._retireActiveParticles(),this._freeRetiredParticles(),this._totalDelayTime+=t,this._totalDelayTime<this._playStartDelay||this._emission.enable&&this._isEmitting&&!this._isPaused&&this._advanceTime(t,this._currentTime))}_updateParticlesSimulationRestart(t){this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._burstsIndex=0,this._frameRateTime=t,this._emissionTime=0,this._totalDelayTime=0,this._currentTime=t;var e=t;e<this._playStartDelay?this._totalDelayTime=e:this._emission.enable&&this._advanceTime(t,t)}_retireActiveParticles(){for(;this._firstActiveElement!=this._firstNewElement;){var t=this._firstActiveElement*this._floatCountPerVertex*this._vertexStride,e=t+this._timeIndex;if(this._currentTime-this._vertices[e]+1e-4<this._vertices[t+this._startLifeTimeIndex])break;this._vertices[e]=this._drawCounter,this._firstActiveElement++,this._firstActiveElement>=this._bufferMaxParticles&&(this._firstActiveElement=0)}}_freeRetiredParticles(){for(;this._firstRetiredElement!=this._firstActiveElement;){var t=this._drawCounter-this._vertices[this._firstRetiredElement*this._floatCountPerVertex*this._vertexStride+this._timeIndex];if(this.isPerformanceMode&&t<3)break;this._firstRetiredElement++,this._firstRetiredElement>=this._bufferMaxParticles&&(this._firstRetiredElement=0)}}_burst(t,e){for(var i=0,a=this._emission._bursts,r=a.length;this._burstsIndex<r;this._burstsIndex++){var s,o=a[this._burstsIndex],l=o.time;if(!(t<=l&&l<e))break;this.autoRandomSeed?s=n.a.lerp(o.minCount,o.maxCount,Math.random()):(this._rand.seed=this._randomSeeds[0],s=n.a.lerp(o.minCount,o.maxCount,this._rand.getFloat()),this._randomSeeds[0]=this._rand.seed),i+=s}return i}_advanceTime(t,e){var i,a=this._emissionTime;this._emissionTime+=t;var r=0;if(this._emissionTime>this.duration){if(!this.looping){for(r=Math.min(this.maxParticles-this.aliveParticleCount,r),i=0;i<r;i++)this.emit(e);return this._isPlaying=!1,void this.stop()}r+=this._burst(a,this._emissionTime),this._emissionTime-=this.duration,this._burstsIndex=0,r+=this._burst(0,this._emissionTime)}else r+=this._burst(a,this._emissionTime);for(r=Math.min(this.maxParticles-this.aliveParticleCount,r),i=0;i<r;i++)this.emit(e);var s=this.emission.emissionRate;if(s>0){var n=1/s;for(this._frameRateTime+=n,this._frameRateTime=this._currentTime-(this._currentTime-this._frameRateTime)%this._maxStartLifetime;this._frameRateTime<=e&&this.emit(this._frameRateTime);)this._frameRateTime+=n;this._frameRateTime=Math.floor(e/n)*n}}_initBufferDatas(){if(this._vertexBuffer){var t=this._vertexBuffer._byteLength+2*this._indexBuffer.indexCount;this._vertexBuffer.destroy(),this._indexBuffer.destroy(),o.a._addMemory(-t,-t)}var e=s.a.instance,i=this._ownerRender,a=i.renderMode;if(-1!==a&&this.maxParticles>0){var r,n,l,_,f,m,p,g=0,v=(t=0,i.mesh);if(4===a){if(v){p=d.a.vertexDeclaration,this._floatCountPerVertex=p.vertexStride/4,this._startLifeTimeIndex=12,this._timeIndex=16,this._vertexStride=v._vertexCount;var T=this._bufferMaxParticles*this._vertexStride,E=T%65535;if(Math.floor(T/65535)+1>1)throw new Error("ShurikenParticleSystem:the maxParticleCount multiply mesh vertexCount is large than 65535.");g=p.vertexStride*E,this._vertexBuffer=new u.a(g,e.DYNAMIC_DRAW),this._vertexBuffer.vertexDeclaration=p,this._vertices=new Float32Array(this._floatCountPerVertex*E),this._indexStride=v._indexBuffer.indexCount;var S=v._indexBuffer.getData(),R=this._bufferMaxParticles*this._indexStride;for(this._indexBuffer=new h.a(C.a.UInt16,R,e.STATIC_DRAW),r=new Uint16Array(R),t=g+2*R,f=0,n=0;n<this._bufferMaxParticles;n++){var x=n*this._vertexStride;for(l=0,_=S.length;l<_;l++)r[f++]=x+S[l]}this._indexBuffer.setData(r),this._bufferState.bind(),this._bufferState.applyVertexBuffer(this._vertexBuffer),this._bufferState.applyIndexBuffer(this._indexBuffer),this._bufferState.unBind()}}else{for(p=c.a.vertexDeclaration,this._floatCountPerVertex=p.vertexStride/4,this._startLifeTimeIndex=7,this._timeIndex=11,this._vertexStride=4,g=p.vertexStride*this._bufferMaxParticles*this._vertexStride,this._vertexBuffer=new u.a(g,e.DYNAMIC_DRAW),this._vertexBuffer.vertexDeclaration=p,this._vertices=new Float32Array(this._floatCountPerVertex*this._bufferMaxParticles*this._vertexStride),n=0;n<this._bufferMaxParticles;n++)m=n*this._floatCountPerVertex*this._vertexStride,this._vertices[m]=-.5,this._vertices[m+1]=-.5,this._vertices[m+2]=0,this._vertices[m+3]=1,m+=this._floatCountPerVertex,this._vertices[m]=.5,this._vertices[m+1]=-.5,this._vertices[m+2]=1,this._vertices[m+3]=1,m+=this._floatCountPerVertex,this._vertices[m]=.5,this._vertices[m+1]=.5,this._vertices[m+2]=1,this._vertices[m+3]=0,m+=this._floatCountPerVertex,this._vertices[m]=-.5,this._vertices[m+1]=.5,this._vertices[m+2]=0,this._vertices[m+3]=0;for(this._indexStride=6,this._indexBuffer=new h.a(C.a.UInt16,6*this._bufferMaxParticles,e.STATIC_DRAW),r=new Uint16Array(6*this._bufferMaxParticles),n=0;n<this._bufferMaxParticles;n++){f=6*n;var A=n*this._vertexStride,y=A+2;r[f++]=A,r[f++]=y,r[f++]=A+1,r[f++]=A,r[f++]=A+3,r[f++]=y}this._indexBuffer.setData(r),t=g+6*this._bufferMaxParticles*2,this._bufferState.bind(),this._bufferState.applyVertexBuffer(this._vertexBuffer),this._bufferState.applyIndexBuffer(this._indexBuffer),this._bufferState.unBind()}o.a._addMemory(t,t)}}destroy(){super.destroy();var t=this._vertexBuffer._byteLength+2*this._indexBuffer.indexCount;o.a._addMemory(-t,-t),this._bufferState.destroy(),this._vertexBuffer.destroy(),this._indexBuffer.destroy(),this._emission.destroy(),this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._bounds=null,this._customBounds=null,this._bufferState=null,this._vertexBuffer=null,this._indexBuffer=null,this._owner=null,this._vertices=null,this._indexBuffer=null,this._emission=null,this._shape=null,this.startLifeTimeGradient=null,this.startLifeTimeGradientMin=null,this.startLifeTimeGradientMax=null,this.startSizeConstantSeparate=null,this.startSizeConstantMinSeparate=null,this.startSizeConstantMaxSeparate=null,this.startRotationConstantSeparate=null,this.startRotationConstantMinSeparate=null,this.startRotationConstantMaxSeparate=null,this.startColorConstant=null,this.startColorConstantMin=null,this.startColorConstantMax=null,this._velocityOverLifetime=null,this._colorOverLifetime=null,this._sizeOverLifetime=null,this._rotationOverLifetime=null,this._textureSheetAnimation=null}emit(t){var e=D._tempPosition,i=D._tempDirection;return this._shape&&this._shape.enable?this.autoRandomSeed?this._shape.generatePositionAndDirection(e,i):this._shape.generatePositionAndDirection(e,i,this._rand,this._randomSeeds):(e.x=e.y=e.z=0,i.x=i.y=0,i.z=1),this.addParticle(e,i,t)}addParticle(t,e,i){v.a.normalize(e,e);var a=this._firstFreeElement+1;if(a>=this._bufferMaxParticles&&(a=0),a===this._firstRetiredElement)return!1;var r,s,o,l,h,c,d,u,f,m,p=this._owner.transform;if(I.a.create(this,this._ownerRender,p),this._currentTime-i>=I.a.startLifeTime)return!0;switch(0==this.simulationSpace&&(r=p.position,s=p.rotation),this.startSpeedType){case 0:o=this.startSpeedConstant;break;case 2:this.autoRandomSeed?o=n.a.lerp(this.startSpeedConstantMin,this.startSpeedConstantMax,Math.random()):(this._rand.seed=this._randomSeeds[8],o=n.a.lerp(this.startSpeedConstantMin,this.startSpeedConstantMax,this._rand.getFloat()),this._randomSeeds[8]=this._rand.seed)}var g=this._velocityOverLifetime&&this._velocityOverLifetime.enable;if(g){var T=this._velocityOverLifetime.velocity.type;2===T||3===T?this.autoRandomSeed?(l=Math.random(),h=Math.random(),c=Math.random()):(this._rand.seed=this._randomSeeds[9],l=this._rand.getFloat(),h=this._rand.getFloat(),c=this._rand.getFloat(),this._randomSeeds[9]=this._rand.seed):g=!1}else g=!1;var E=this._colorOverLifetime&&this._colorOverLifetime.enable;E?3===this._colorOverLifetime.color.type?this.autoRandomSeed?d=Math.random():(this._rand.seed=this._randomSeeds[10],d=this._rand.getFloat(),this._randomSeeds[10]=this._rand.seed):E=!1:E=!1;var S=this._sizeOverLifetime&&this._sizeOverLifetime.enable;S?3===this._sizeOverLifetime.size.type?this.autoRandomSeed?u=Math.random():(this._rand.seed=this._randomSeeds[11],u=this._rand.getFloat(),this._randomSeeds[11]=this._rand.seed):S=!1:S=!1;var R=this._rotationOverLifetime&&this._rotationOverLifetime.enable;if(R){var x=this._rotationOverLifetime.angularVelocity.type;2===x||3===x?this.autoRandomSeed?f=Math.random():(this._rand.seed=this._randomSeeds[12],f=this._rand.getFloat(),this._randomSeeds[12]=this._rand.seed):R=!1}else R=!1;var A=this._textureSheetAnimation&&this._textureSheetAnimation.enable;A?3===this._textureSheetAnimation.frame.type?this.autoRandomSeed?m=Math.random():(this._rand.seed=this._randomSeeds[15],m=this._rand.getFloat(),this._randomSeeds[15]=this._rand.seed):A=!1:A=!1;var y,C,M,D,b,L,O=this._firstFreeElement*this._floatCountPerVertex*this._vertexStride,P=I.a.startUVInfo[0],N=I.a.startUVInfo[1],w=I.a.startUVInfo[2],B=I.a.startUVInfo[3],F=this._ownerRender;if(4===F.renderMode){var V=F.mesh._vertexBuffer;y=V.getFloat32Data();var U=V.vertexDeclaration;M=U.getVertexElementByUsage(_.a.MESH_POSITION0)._offset/4;var G=U.getVertexElementByUsage(_.a.MESH_COLOR0);D=G?G._offset/4:-1;var H=U.getVertexElementByUsage(_.a.MESH_TEXTURECOORDINATE0);b=H?H._offset/4:-1,C=U.vertexStride/4,L=0}else{this._vertices[O+2]=w,this._vertices[O+3]=B+N;var z=O+this._floatCountPerVertex;this._vertices[z+2]=w+P,this._vertices[z+3]=B+N;var k=z+this._floatCountPerVertex;this._vertices[k+2]=w+P,this._vertices[k+3]=B;var W=k+this._floatCountPerVertex;this._vertices[W+2]=w,this._vertices[W+3]=B}for(var X=O,Y=O+this._floatCountPerVertex*this._vertexStride;X<Y;X+=this._floatCountPerVertex){var j;if(4===F.renderMode){j=X;var Z=C*L++,q=Z+M;this._vertices[j++]=y[q++],this._vertices[j++]=y[q++],this._vertices[j++]=y[q],-1===D?(this._vertices[j++]=1,this._vertices[j++]=1,this._vertices[j++]=1,this._vertices[j++]=1):(q=Z+D,this._vertices[j++]=y[q++],this._vertices[j++]=y[q++],this._vertices[j++]=y[q++],this._vertices[j++]=y[q]),-1===b?(this._vertices[j++]=0,this._vertices[j++]=0):(q=Z+b,this._vertices[j++]=w+y[q++]*P,this._vertices[j++]=B+y[q]*N)}else j=X+4;switch(this._vertices[j++]=t.x,this._vertices[j++]=t.y,this._vertices[j++]=t.z,this._vertices[j++]=I.a.startLifeTime,this._vertices[j++]=e.x,this._vertices[j++]=e.y,this._vertices[j++]=e.z,this._vertices[j++]=i,this._vertices[j++]=I.a.startColor.x,this._vertices[j++]=I.a.startColor.y,this._vertices[j++]=I.a.startColor.z,this._vertices[j++]=I.a.startColor.w,this._vertices[j++]=I.a.startSize[0],this._vertices[j++]=I.a.startSize[1],this._vertices[j++]=I.a.startSize[2],this._vertices[j++]=I.a.startRotation[0],this._vertices[j++]=I.a.startRotation[1],this._vertices[j++]=I.a.startRotation[2],this._vertices[j++]=o,E&&(this._vertices[j+1]=d),S&&(this._vertices[j+2]=u),R&&(this._vertices[j+3]=f),A&&(this._vertices[j+4]=m),g&&(this._vertices[j+5]=l,this._vertices[j+6]=h,this._vertices[j+7]=c),this.simulationSpace){case 0:j+=8,this._vertices[j++]=r.x,this._vertices[j++]=r.y,this._vertices[j++]=r.z,this._vertices[j++]=s.x,this._vertices[j++]=s.y,this._vertices[j++]=s.z,this._vertices[j++]=s.w;break;case 1:break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}}return this._firstFreeElement=a,!0}addNewParticlesToVertexBuffer(){var t,e=this._vertexStride*this._floatCountPerVertex*4;this._firstNewElement<this._firstFreeElement?(t=this._firstNewElement*e,this._vertexBuffer.setData(this._vertices.buffer,t,t,(this._firstFreeElement-this._firstNewElement)*e)):(t=this._firstNewElement*e,this._vertexBuffer.setData(this._vertices.buffer,t,t,(this._bufferMaxParticles-this._firstNewElement)*e),this._firstFreeElement>0&&this._vertexBuffer.setData(this._vertices.buffer,0,0,this._firstFreeElement*e)),this._firstNewElement=this._firstFreeElement}_getType(){return D._type}_prepareRender(t){return this._updateMask!=l.a.loopCount&&(this._updateMask=l.a.loopCount,this._updateEmission(),this._firstNewElement!=this._firstFreeElement&&this.addNewParticlesToVertexBuffer(),this._drawCounter++),this._firstActiveElement!=this._firstFreeElement}_render(t){var e;this._bufferState.bind();var i=s.a.instance;this._firstActiveElement<this._firstFreeElement?(e=(this._firstFreeElement-this._firstActiveElement)*this._indexStride,i.drawElements(i.TRIANGLES,e,i.UNSIGNED_SHORT,2*this._firstActiveElement*this._indexStride),l.a.trianglesFaces+=e/3,l.a.renderBatches++):(e=(this._bufferMaxParticles-this._firstActiveElement)*this._indexStride,i.drawElements(i.TRIANGLES,e,i.UNSIGNED_SHORT,2*this._firstActiveElement*this._indexStride),l.a.trianglesFaces+=e/3,l.a.renderBatches++,this._firstFreeElement>0&&(e=this._firstFreeElement*this._indexStride,i.drawElements(i.TRIANGLES,e,i.UNSIGNED_SHORT,0),l.a.trianglesFaces+=e/3,l.a.renderBatches++))}play(){if(this._burstsIndex=0,this._isEmitting=!0,this._isPlaying=!0,this._isPaused=!1,this._emissionTime=0,this._totalDelayTime=0,!this.autoRandomSeed)for(var t=0,e=this._randomSeeds.length;t<e;t++)this._randomSeeds[t]=this.randomSeed[0]+D._RANDOMOFFSET[t];switch(this.startDelayType){case 0:this._playStartDelay=this.startDelay;break;case 1:this.autoRandomSeed?this._playStartDelay=n.a.lerp(this.startDelayMin,this.startDelayMax,Math.random()):(this._rand.seed=this._randomSeeds[2],this._playStartDelay=n.a.lerp(this.startDelayMin,this.startDelayMax,this._rand.getFloat()),this._randomSeeds[2]=this._rand.seed);break;default:throw new Error("Utils3D: startDelayType is invalid.")}this._frameRateTime=this._currentTime+this._playStartDelay,this._startUpdateLoopCount=l.a.loopCount}pause(){this._isPaused=!0}simulate(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._simulateUpdate=!0,e?this._updateParticlesSimulationRestart(t):(this._isPaused=!1,this._updateParticles(t)),this.pause()}stop(){this._burstsIndex=0,this._isEmitting=!1,this._emissionTime=0}cloneTo(t){var e=t;e._useCustomBounds=this._useCustomBounds,this._customBounds&&this._customBounds.cloneTo(e._customBounds),e.duration=this.duration,e.looping=this.looping,e.prewarm=this.prewarm,e.startDelayType=this.startDelayType,e.startDelay=this.startDelay,e.startDelayMin=this.startDelayMin,e.startDelayMax=this.startDelayMax,e._maxStartLifetime=this._maxStartLifetime,e.startLifetimeType=this.startLifetimeType,e.startLifetimeConstant=this.startLifetimeConstant,this.startLifeTimeGradient.cloneTo(e.startLifeTimeGradient),e.startLifetimeConstantMin=this.startLifetimeConstantMin,e.startLifetimeConstantMax=this.startLifetimeConstantMax,this.startLifeTimeGradientMin.cloneTo(e.startLifeTimeGradientMin),this.startLifeTimeGradientMax.cloneTo(e.startLifeTimeGradientMax),e.startSpeedType=this.startSpeedType,e.startSpeedConstant=this.startSpeedConstant,e.startSpeedConstantMin=this.startSpeedConstantMin,e.startSpeedConstantMax=this.startSpeedConstantMax,e.threeDStartSize=this.threeDStartSize,e.startSizeType=this.startSizeType,e.startSizeConstant=this.startSizeConstant,this.startSizeConstantSeparate.cloneTo(e.startSizeConstantSeparate),e.startSizeConstantMin=this.startSizeConstantMin,e.startSizeConstantMax=this.startSizeConstantMax,this.startSizeConstantMinSeparate.cloneTo(e.startSizeConstantMinSeparate),this.startSizeConstantMaxSeparate.cloneTo(e.startSizeConstantMaxSeparate),e.threeDStartRotation=this.threeDStartRotation,e.startRotationType=this.startRotationType,e.startRotationConstant=this.startRotationConstant,this.startRotationConstantSeparate.cloneTo(e.startRotationConstantSeparate),e.startRotationConstantMin=this.startRotationConstantMin,e.startRotationConstantMax=this.startRotationConstantMax,this.startRotationConstantMinSeparate.cloneTo(e.startRotationConstantMinSeparate),this.startRotationConstantMaxSeparate.cloneTo(e.startRotationConstantMaxSeparate),e.randomizeRotationDirection=this.randomizeRotationDirection,e.startColorType=this.startColorType,this.startColorConstant.cloneTo(e.startColorConstant),this.startColorConstantMin.cloneTo(e.startColorConstantMin),this.startColorConstantMax.cloneTo(e.startColorConstantMax),e.gravityModifier=this.gravityModifier,e.simulationSpace=this.simulationSpace,e.scaleMode=this.scaleMode,e.playOnAwake=this.playOnAwake,e.autoRandomSeed=this.autoRandomSeed,e.randomSeed[0]=this.randomSeed[0],e.maxParticles=this.maxParticles,this._emission&&(e._emission=this._emission.clone()),this.shape&&(e.shape=this.shape.clone()),this.velocityOverLifetime&&(e.velocityOverLifetime=this.velocityOverLifetime.clone()),this.colorOverLifetime&&(e.colorOverLifetime=this.colorOverLifetime.clone()),this.sizeOverLifetime&&(e.sizeOverLifetime=this.sizeOverLifetime.clone()),this.rotationOverLifetime&&(e.rotationOverLifetime=this.rotationOverLifetime.clone()),this.textureSheetAnimation&&(e.textureSheetAnimation=this.textureSheetAnimation.clone()),e.isPerformanceMode=this.isPerformanceMode,e._isEmitting=this._isEmitting,e._isPlaying=this._isPlaying,e._isPaused=this._isPaused,e._playStartDelay=this._playStartDelay,e._frameRateTime=this._frameRateTime,e._emissionTime=this._emissionTime,e._totalDelayTime=this._totalDelayTime,e._burstsIndex=this._burstsIndex}clone(){var t=new D(null);return this.cloneTo(t),t}}e.a=D,r()(D,"_RANDOMOFFSET",new Uint32Array([592910910,3276756734,322376503,306581307,1793934638,3737431713,2527743459,2368504881,4085612399,3774601268,326370691,1494990940,1089181156,3159510623,2941263940,2786374529,271901988,4233252447])),r()(D,"halfKSqrtOf2",.71),r()(D,"g",9.8),r()(D,"_maxElapsedTime",1/3),r()(D,"_tempVector30",new v.a),r()(D,"_tempVector31",new v.a),r()(D,"_tempVector32",new v.a),r()(D,"_tempVector33",new v.a),r()(D,"_tempVector34",new v.a),r()(D,"_tempVector35",new v.a),r()(D,"_tempVector36",new v.a),r()(D,"_tempVector37",new v.a),r()(D,"_tempVector38",new v.a),r()(D,"_tempVector39",new v.a),r()(D,"_tempPosition",new v.a),r()(D,"_tempDirection",new v.a),r()(D,"_type",S.a._typeCounter++)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{static getFloatFromInt(t){return 1/8388607*(8388607&t)}static getByteFromInt(t){return(8388607&t)>>>15}get seed(){return this.seeds[0]}set seed(t){this.seeds[0]=t,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}constructor(t){r()(this,"_temp",new Uint32Array(1)),r()(this,"seeds",new Uint32Array(4)),this.seeds[0]=t,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}getUint(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]}getFloat(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)}getSignedFloat(){return 2*this.getFloat()-1}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a);class s{set emissionRate(t){if(t<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=t}get emissionRate(){return this._emissionRate}get destroyed(){return this._destroyed}constructor(){r()(this,"_destroyed",void 0),r()(this,"_emissionRate",10),r()(this,"_bursts",void 0),r()(this,"enable",void 0),this._destroyed=!1,this._bursts=[]}destroy(){this._bursts=null,this._destroyed=!0}getBurstsCount(){return this._bursts.length}getBurstByIndex(t){return this._bursts[t]}addBurst(t){var e=this._bursts.length;if(e>0)for(var i=0;i<e;i++)this._bursts[i].time>t.time&&this._bursts.splice(i,0,t);this._bursts.push(t)}removeBurst(t){var e=this._bursts.indexOf(t);-1!==e&&this._bursts.splice(e,1)}removeBurstByIndex(t){this._bursts.splice(t,1)}clearBurst(){this._bursts.length=0}cloneTo(t){var e=t,i=e._bursts;i.length=this._bursts.length;for(var a=0,r=this._bursts.length;a<r;a++){var s=i[a];s?this._bursts[a].cloneTo(s):i[a]=this._bursts[a].clone()}e._emissionRate=this._emissionRate,e.enable=this.enable}clone(){var t=new s;return this.cloneTo(t),t}}e.a=s},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(167),n=i(1),o=i(5);class l{constructor(){}static _getStartLifetimeFromGradient(t,e){for(var i=1,a=t.gradientCount;i<a;i++){var r=t.getKeyByIndex(i);if(r>=e){var n=t.getKeyByIndex(i-1),o=(e-n)/(r-n);return s.a.lerp(t.getValueByIndex(i-1),t.getValueByIndex(i),o)}}throw new Error("ShurikenParticleData: can't get value foam startLifeTimeGradient.")}static _randomInvertRoationArray(t,e,i,a,r){var s;a?(a.seed=r[6],s=a.getFloat(),r[6]=a.seed):s=Math.random(),s<i?(e.x=-t.x,e.y=-t.y,e.z=-t.z):(e.x=t.x,e.y=t.y,e.z=t.z)}static _randomInvertRoation(t,e,i,a){var r;return i?(i.seed=a[6],r=i.getFloat(),a[6]=i.seed):r=Math.random(),r<e&&(t=-t),t}static create(t,e,i){var a=t.autoRandomSeed,r=t._rand,n=t._randomSeeds;switch(t.startColorType){case 0:var h=t.startColorConstant;l.startColor.x=h.x,l.startColor.y=h.y,l.startColor.z=h.z,l.startColor.w=h.w;break;case 2:a?o.a.lerp(t.startColorConstantMin,t.startColorConstantMax,Math.random(),l.startColor):(r.seed=n[3],o.a.lerp(t.startColorConstantMin,t.startColorConstantMax,r.getFloat(),l.startColor),n[3]=r.seed)}var _=t.colorOverLifetime;if(_&&_.enable){var c=_.color;switch(c.type){case 0:l.startColor.x=l.startColor.x*c.constant.x,l.startColor.y=l.startColor.y*c.constant.y,l.startColor.z=l.startColor.z*c.constant.z,l.startColor.w=l.startColor.w*c.constant.w;break;case 2:var d;a?d=Math.random():(r.seed=n[10],d=r.getFloat(),n[10]=r.seed);var u=c.constantMin,f=c.constantMax;l.startColor.x=l.startColor.x*s.a.lerp(u.x,f.x,d),l.startColor.y=l.startColor.y*s.a.lerp(u.y,f.y,d),l.startColor.z=l.startColor.z*s.a.lerp(u.z,f.z,d),l.startColor.w=l.startColor.w*s.a.lerp(u.w,f.w,d)}}var m=l.startSize;switch(t.startSizeType){case 0:if(t.threeDStartSize){var p=t.startSizeConstantSeparate;m[0]=p.x,m[1]=p.y,m[2]=p.z}else m[0]=m[1]=m[2]=t.startSizeConstant;break;case 2:if(t.threeDStartSize){var g=t.startSizeConstantMinSeparate,v=t.startSizeConstantMaxSeparate;a?(m[0]=s.a.lerp(g.x,v.x,Math.random()),m[1]=s.a.lerp(g.y,v.y,Math.random()),m[2]=s.a.lerp(g.z,v.z,Math.random())):(r.seed=n[4],m[0]=s.a.lerp(g.x,v.x,r.getFloat()),m[1]=s.a.lerp(g.y,v.y,r.getFloat()),m[2]=s.a.lerp(g.z,v.z,r.getFloat()),n[4]=r.seed)}else a?m[0]=m[1]=m[2]=s.a.lerp(t.startSizeConstantMin,t.startSizeConstantMax,Math.random()):(r.seed=n[4],m[0]=m[1]=m[2]=s.a.lerp(t.startSizeConstantMin,t.startSizeConstantMax,r.getFloat()),n[4]=r.seed)}var T=t.sizeOverLifetime;if(T&&T.enable&&1===T.size.type){var E,S=T.size;if(S.separateAxes)a?(m[0]=m[0]*s.a.lerp(S.constantMinSeparate.x,S.constantMaxSeparate.x,Math.random()),m[1]=m[1]*s.a.lerp(S.constantMinSeparate.y,S.constantMaxSeparate.y,Math.random()),m[2]=m[2]*s.a.lerp(S.constantMinSeparate.z,S.constantMaxSeparate.z,Math.random())):(r.seed=n[11],m[0]=m[0]*s.a.lerp(S.constantMinSeparate.x,S.constantMaxSeparate.x,r.getFloat()),m[1]=m[1]*s.a.lerp(S.constantMinSeparate.y,S.constantMaxSeparate.y,r.getFloat()),m[2]=m[2]*s.a.lerp(S.constantMinSeparate.z,S.constantMaxSeparate.z,r.getFloat()),n[11]=r.seed);else a?E=s.a.lerp(S.constantMin,S.constantMax,Math.random()):(r.seed=n[11],E=s.a.lerp(S.constantMin,S.constantMax,r.getFloat()),n[11]=r.seed),m[0]=m[0]*E,m[1]=m[1]*E,m[2]=m[2]*E}var R=e.renderMode;if(1!==R)switch(t.startRotationType){case 0:if(t.threeDStartRotation){var x=t.startRotationConstantSeparate,A=l._tempVector30;l._randomInvertRoationArray(x,A,t.randomizeRotationDirection,a?null:r,n),l.startRotation[0]=A.x,l.startRotation[1]=A.y,l.startRotation[2]=4!==R?-A.z:A.z}else l.startRotation[0]=l._randomInvertRoation(t.startRotationConstant,t.randomizeRotationDirection,a?null:r,n),l.startRotation[1]=0,l.startRotation[2]=0;break;case 2:if(t.threeDStartRotation){var y=t.startRotationConstantMinSeparate,I=t.startRotationConstantMaxSeparate,C=l._tempVector30;a?(C.x=s.a.lerp(y.x,I.x,Math.random()),C.y=s.a.lerp(y.y,I.y,Math.random()),C.z=s.a.lerp(y.z,I.z,Math.random())):(r.seed=n[5],C.x=s.a.lerp(y.x,I.x,r.getFloat()),C.y=s.a.lerp(y.y,I.y,r.getFloat()),C.z=s.a.lerp(y.z,I.z,r.getFloat()),n[5]=r.seed),l._randomInvertRoationArray(C,C,t.randomizeRotationDirection,a?null:r,n),l.startRotation[0]=C.x,l.startRotation[1]=C.y,l.startRotation[2]=4!==R?-C.z:C.z}else a?l.startRotation[0]=l._randomInvertRoation(s.a.lerp(t.startRotationConstantMin,t.startRotationConstantMax,Math.random()),t.randomizeRotationDirection,a?null:r,n):(r.seed=n[5],l.startRotation[0]=l._randomInvertRoation(s.a.lerp(t.startRotationConstantMin,t.startRotationConstantMax,r.getFloat()),t.randomizeRotationDirection,a?null:r,n),n[5]=r.seed)}switch(t.startLifetimeType){case 0:l.startLifeTime=t.startLifetimeConstant;break;case 1:l.startLifeTime=l._getStartLifetimeFromGradient(t.startLifeTimeGradient,t.emissionTime);break;case 2:a?l.startLifeTime=s.a.lerp(t.startLifetimeConstantMin,t.startLifetimeConstantMax,Math.random()):(r.seed=n[7],l.startLifeTime=s.a.lerp(t.startLifetimeConstantMin,t.startLifetimeConstantMax,r.getFloat()),n[7]=r.seed);break;case 3:var M=t.emissionTime;a?l.startLifeTime=s.a.lerp(l._getStartLifetimeFromGradient(t.startLifeTimeGradientMin,M),l._getStartLifetimeFromGradient(t.startLifeTimeGradientMax,M),Math.random()):(r.seed=n[7],l.startLifeTime=s.a.lerp(l._getStartLifetimeFromGradient(t.startLifeTimeGradientMin,M),l._getStartLifetimeFromGradient(t.startLifeTimeGradientMax,M),r.getFloat()),n[7]=r.seed)}var D=t.textureSheetAnimation;if(D&&D.enable){var b,L=D.tiles,O=L.x,P=L.y,N=1/O,w=1/P,B=D.startFrame;switch(B.type){case 0:b=B.constant;break;case 1:a?b=s.a.lerp(B.constantMin,B.constantMax,Math.random()):(r.seed=n[14],b=s.a.lerp(B.constantMin,B.constantMax,r.getFloat()),n[14]=r.seed)}var F=D.frame,V=D.cycles;switch(F.type){case 0:b+=F.constant*V;break;case 2:a?b+=s.a.lerp(F.constantMin,F.constantMax,Math.random())*V:(r.seed=n[15],b+=s.a.lerp(F.constantMin,F.constantMax,r.getFloat())*V,n[15]=r.seed)}var U=0;switch(D.type){case 0:U=Math.floor(b/O);break;case 1:D.randomRow?a?U=Math.floor(Math.random()*P):(r.seed=n[13],U=Math.floor(r.getFloat()*P),n[13]=r.seed):U=D.rowIndex}var G=Math.floor(b%O);l.startUVInfo=l.startUVInfo,l.startUVInfo[0]=N,l.startUVInfo[1]=w,l.startUVInfo[2]=G*N,l.startUVInfo[3]=U*w}else l.startUVInfo=l.startUVInfo,l.startUVInfo[0]=1,l.startUVInfo[1]=1,l.startUVInfo[2]=0,l.startUVInfo[3]=0}}e.a=l,r()(l,"_tempVector30",new n.a),r()(l,"startLifeTime",void 0),r()(l,"startColor",new o.a),r()(l,"startSize",new Float32Array(3)),r()(l,"startRotation",new Float32Array(3)),r()(l,"startUVInfo",new Float32Array(4))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(73),n=i(1),o=i(126),l=i(187),h=i(291),_=i(64),c=i(304),d=i(494),u=i(302),f=i(7);class m{get time(){return this._time}set time(t){this._time=t,this._owner._render._shaderValues.setNumber(m.LIFETIME,t)}get minVertexDistance(){return this._minVertexDistance}set minVertexDistance(t){this._minVertexDistance=t}get widthMultiplier(){return this._widthMultiplier}set widthMultiplier(t){this._widthMultiplier=t}get widthCurve(){return this._widthCurve}set widthCurve(t){this._widthCurve=t;var e,i,a=new Float32Array(4*t.length),r=0;for(e=0,i=t.length;e<i;e++)a[r++]=t[e].time,a[r++]=t[e].inTangent,a[r++]=t[e].outTangent,a[r++]=t[e].value;this._owner._render._shaderValues.setBuffer(m.WIDTHCURVE,a),this._owner._render._shaderValues.setInt(m.WIDTHCURVEKEYLENGTH,t.length)}get colorGradient(){return this._colorGradient}set colorGradient(t){this._colorGradient=t}get textureMode(){return this._textureMode}set textureMode(t){this._textureMode=t}constructor(t){r()(this,"_minVertexDistance",void 0),r()(this,"_widthMultiplier",void 0),r()(this,"_time",void 0),r()(this,"_widthCurve",void 0),r()(this,"_colorGradient",void 0),r()(this,"_textureMode",void 0),r()(this,"_trialGeometry",void 0),r()(this,"_totalLength",0),r()(this,"_owner",void 0),r()(this,"_lastPosition",new n.a),r()(this,"_curtime",0),r()(this,"alignment",m.ALIGNMENT_VIEW),this._owner=t,this._initDefaultData(),this.addRenderElement()}addRenderElement(){var t=this._owner._render,e=t._renderElements,i=t.sharedMaterials[0];i||(i=u.a.defaultMaterial);var a=new _.a;a.setTransform(this._owner._transform),a.render=t,a.material=i,this._trialGeometry=new d.a(this),a.setGeometry(this._trialGeometry),e.push(a)}_update(t){var e=this._owner._render;this._curtime+=t.scene.timer._delta/1e3,e._shaderValues.setNumber(m.CURTIME,this._curtime);var i=this._owner.transform.position,a=e._renderElements[0]._geometry;a._updateDisappear(),a._updateTrail(t.camera,this._lastPosition,i),a._updateVertexBufferUV(),i.cloneTo(this._lastPosition)}_initDefaultData(){this.time=5,this.minVertexDistance=.1,this.widthMultiplier=1,this.textureMode=c.a.Stretch;var t=[],e=new o.a;e.time=0,e.inTangent=0,e.outTangent=0,e.value=1,t.push(e);var i=new o.a;i.time=1,i.inTangent=0,i.outTangent=0,i.value=1,t.push(i),this.widthCurve=t;var a=new l.a(2,2);a.mode=h.a.Blend,a.addColorRGB(0,s.a.WHITE),a.addColorRGB(1,s.a.WHITE),a.addColorAlpha(0,1),a.addColorAlpha(1,1),this.colorGradient=a}destroy(){this._trialGeometry.destroy(),this._trialGeometry=null,this._widthCurve=null,this._colorGradient=null}clear(){this._trialGeometry.clear(),this._lastPosition.setValue(0,0,0),this._curtime=0,this._totalLength=0}}e.a=m,r()(m,"CURTIME",f.a.propertyNameToID("u_CurTime")),r()(m,"LIFETIME",f.a.propertyNameToID("u_LifeTime")),r()(m,"WIDTHCURVE",f.a.propertyNameToID("u_WidthCurve")),r()(m,"WIDTHCURVEKEYLENGTH",f.a.propertyNameToID("u_WidthCurveKeyLength")),r()(m,"ALIGNMENT_VIEW",0),r()(m,"ALIGNMENT_TRANSFORM_Z",1)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(2),n=i(17),o=i(8),l=i(25),h=i(73),_=i(49),c=i(1),d=i(38),u=i(75),f=i(304),m=i(495),p=i(193);class g extends u.a{constructor(t){super(),r()(this,"_floatCountPerVertices1",8),r()(this,"_floatCountPerVertices2",5),r()(this,"_increaseSegementCount",16),r()(this,"_activeIndex",0),r()(this,"_endIndex",0),r()(this,"_needAddFirstVertex",!1),r()(this,"_isTempEndVertex",!1),r()(this,"_subBirthTime",void 0),r()(this,"_subDistance",void 0),r()(this,"_segementCount",void 0),r()(this,"_vertices1",null),r()(this,"_vertices2",null),r()(this,"_vertexBuffer1",void 0),r()(this,"_vertexBuffer2",void 0),r()(this,"_lastFixedVertexPosition",new c.a),r()(this,"_owner",void 0),r()(this,"_bufferState",new d.a),r()(this,"tmpColor",new h.a),r()(this,"_disappearBoundsMode",!1),this._owner=t,this._segementCount=this._increaseSegementCount,this._resizeData(this._segementCount,this._bufferState);var e=this._owner._owner.trailRenderer.bounds,i=this._owner._owner.transform.position;e.setMin(i),e.setMax(i)}_resizeData(t,e){this._subBirthTime=new Float32Array(t),this._subDistance=new Float64Array(t);var i=s.a.instance,a=2*t,r=p.a.vertexDeclaration1,o=p.a.vertexDeclaration2,h=[],_=a*r.vertexStride,c=a*o.vertexStride,d=_+c;this._vertices1=new Float32Array(a*this._floatCountPerVertices1),this._vertices2=new Float32Array(a*this._floatCountPerVertices2),this._vertexBuffer1=new l.a(_,i.STATIC_DRAW,!1),this._vertexBuffer1.vertexDeclaration=r,this._vertexBuffer2=new l.a(c,i.DYNAMIC_DRAW,!1),this._vertexBuffer2.vertexDeclaration=o,h.push(this._vertexBuffer1),h.push(this._vertexBuffer2),e.bind(),e.applyVertexBuffers(h),e.unBind(),n.a._addMemory(d,d)}_resetData(){var t=this._endIndex-this._activeIndex,e=new Float32Array(this._vertices1.buffer,2*this._floatCountPerVertices1*this._activeIndex*4,2*this._floatCountPerVertices1*t),i=new Float32Array(this._vertices2.buffer,2*this._floatCountPerVertices2*this._activeIndex*4,2*this._floatCountPerVertices2*t),a=new Float64Array(this._subDistance.buffer,8*this._activeIndex,t),r=new Float32Array(this._subBirthTime.buffer,4*this._activeIndex,t);if(t===this._segementCount){this._vertexBuffer1.destroy(),this._vertexBuffer2.destroy();var s=this._vertexBuffer1._byteLength+this._vertexBuffer2._byteLength;n.a._addMemory(-s,-s),this._segementCount+=this._increaseSegementCount,this._resizeData(this._segementCount,this._bufferState)}this._vertices1.set(e,0),this._vertices2.set(i,0),this._subDistance.set(a,0),this._subBirthTime.set(r,0),this._endIndex=t,this._activeIndex=0,this._vertexBuffer1.setData(this._vertices1.buffer,0,2*this._floatCountPerVertices1*this._activeIndex*4,2*this._floatCountPerVertices1*t*4),this._vertexBuffer2.setData(this._vertices2.buffer,0,2*this._floatCountPerVertices2*this._activeIndex*4,2*this._floatCountPerVertices2*t*4)}_updateTrail(t,e,i){c.a.equals(e,i)||(this._endIndex-this._activeIndex==0?this._addTrailByFirstPosition(t,i):this._addTrailByNextPosition(t,i))}_addTrailByFirstPosition(t,e){this._endIndex===this._segementCount&&this._resetData(),this._subDistance[this._endIndex]=0,this._subBirthTime[this._endIndex]=this._owner._curtime,this._endIndex++,e.cloneTo(this._lastFixedVertexPosition),this._needAddFirstVertex=!0}_addTrailByNextPosition(t,e){var i=g._tempVector30,a=g._tempVector31;switch(this._owner.alignment){case m.a.View:var r=t.viewMatrix;c.a.transformCoordinate(e,r,g._tempVector33),c.a.transformCoordinate(this._lastFixedVertexPosition,r,g._tempVector34),c.a.subtract(g._tempVector33,g._tempVector34,i),c.a.cross(g._tempVector33,i,a);break;case m.a.TransformZ:c.a.subtract(e,this._lastFixedVertexPosition,i);var s=g._tempVector32;this._owner._owner.transform.getForward(s),c.a.cross(i,s,a)}c.a.normalize(a,a),c.a.scale(a,this._owner.widthMultiplier/2,a);var n,o,l=c.a.scalarLength(i);this._needAddFirstVertex&&(this._updateVerticesByPositionData(e,a,this._endIndex-1),this._needAddFirstVertex=!1),l-this._owner.minVertexDistance>=_.a.zeroTolerance?(this._isTempEndVertex?(n=this._endIndex-1,o=l-this._subDistance[n],this._updateVerticesByPosition(e,a,l,n),this._owner._totalLength+=o):(this._endIndex===this._segementCount&&this._resetData(),this._updateVerticesByPosition(e,a,l,this._endIndex),this._owner._totalLength+=l,this._endIndex++),e.cloneTo(this._lastFixedVertexPosition),this._isTempEndVertex=!1):(this._isTempEndVertex?(n=this._endIndex-1,o=l-this._subDistance[n],this._updateVerticesByPosition(e,a,l,n),this._owner._totalLength+=o):(this._endIndex===this._segementCount&&this._resetData(),this._updateVerticesByPosition(e,a,l,this._endIndex),this._owner._totalLength+=l,this._endIndex++),this._isTempEndVertex=!0)}_updateVerticesByPositionData(t,e,i){var a=2*this._floatCountPerVertices1*i,r=this._owner._curtime;this._vertices1[a]=t.x,this._vertices1[a+1]=t.y,this._vertices1[a+2]=t.z,this._vertices1[a+3]=-e.x,this._vertices1[a+4]=-e.y,this._vertices1[a+5]=-e.z,this._vertices1[a+6]=r,this._vertices1[a+7]=1,this._vertices1[a+8]=t.x,this._vertices1[a+9]=t.y,this._vertices1[a+10]=t.z,this._vertices1[a+11]=e.x,this._vertices1[a+12]=e.y,this._vertices1[a+13]=e.z,this._vertices1[a+14]=r,this._vertices1[a+15]=0;var s=this._owner._owner.trailRenderer.bounds,n=s.getMin(),o=s.getMax(),l=g._tempVector35,h=g._tempVector36,_=g._tempVector32;c.a.add(t,e,l),c.a.subtract(t,e,h),c.a.min(h,l,_),c.a.min(n,_,n),s.setMin(n),c.a.max(l,h,_),c.a.max(o,_,o),s.setMax(o);var d=2*this._floatCountPerVertices1;this._vertexBuffer1.setData(this._vertices1.buffer,4*a,4*a,4*d)}_updateVerticesByPosition(t,e,i,a){this._updateVerticesByPositionData(t,e,a),this._subDistance[a]=i,this._subBirthTime[a]=this._owner._curtime}_updateVertexBufferUV(){var t,e,i;if(this._disappearBoundsMode){t=this._owner._owner.trailRenderer.bounds;var a=this._owner._owner.transform.position;t.setMin(a),t.setMax(a),e=t.getMin(),i=t.getMax()}for(var r=this._endIndex,s=0,n=this._owner.colorGradient,o=n.colorAlphaKeysCount-1,l=n.colorRGBKeysCount-1,h=this._owner._totalLength,_=2*this._floatCountPerVertices2,d=this._activeIndex;d<r;d++){var u,m;d!==this._activeIndex&&(s+=this._subDistance[d]),this._owner.textureMode==f.a.Stretch?m=u=1-s/h:(m=1-s/h,u=1-(h-s)),l=n.evaluateColorRGB(m,this.tmpColor,l,!0),o=n.evaluateColorAlpha(m,this.tmpColor,o,!0);var p=d*_;if(this._vertices2[p+0]=u,this._vertices2[p+1]=this.tmpColor.r,this._vertices2[p+2]=this.tmpColor.g,this._vertices2[p+3]=this.tmpColor.b,this._vertices2[p+4]=this.tmpColor.a,this._vertices2[p+5]=u,this._vertices2[p+6]=this.tmpColor.r,this._vertices2[p+7]=this.tmpColor.g,this._vertices2[p+8]=this.tmpColor.b,this._vertices2[p+9]=this.tmpColor.a,this._disappearBoundsMode){var v=2*this._floatCountPerVertices1*d,T=g._tempVector32,E=g._tempVector33,S=g._tempVector34;T.setValue(this._vertices1[v+0],this._vertices1[v+1],this._vertices1[v+2]),E.setValue(this._vertices1[v+3],this._vertices1[v+4],this._vertices1[v+5]),c.a.add(T,E,S),c.a.min(S,e,e),c.a.max(S,i,i),c.a.subtract(T,E,S),c.a.min(S,e,e),c.a.max(S,i,i)}}this._disappearBoundsMode&&(t.setMin(e),t.setMax(i),this._disappearBoundsMode=!1);var R=this._activeIndex*_;this._vertexBuffer2.setData(this._vertices2.buffer,4*R,4*R,4*(r*_-R))}_updateDisappear(){for(var t=this._endIndex,e=this._activeIndex;e<t&&this._owner._curtime-this._subBirthTime[e]>=this._owner.time+_.a.zeroTolerance;e++){var i=e+1;if(i!==t&&(this._owner._totalLength-=this._subDistance[i]),this._isTempEndVertex&&i===t-1){this._floatCountPerVertices1;var a=this._lastFixedVertexPosition;a.x=this._vertices1[0],a.y=this._vertices1[1],a.z=this._vertices1[2],this._isTempEndVertex=!1}this._activeIndex++,this._disappearBoundsMode=!0}}_getType(){return g._type}_prepareRender(t){return this._endIndex-this._activeIndex>1}_render(t){this._bufferState.bind();var e=s.a.instance,i=2*this._activeIndex,a=2*this._endIndex-i;e.drawArrays(e.TRIANGLE_STRIP,i,a),o.a.renderBatches++,o.a.trianglesFaces+=a-2}destroy(){super.destroy();var t=this._vertexBuffer1._byteLength+this._vertexBuffer2._byteLength;n.a._addMemory(-t,-t),this._bufferState.destroy(),this._vertexBuffer1.destroy(),this._vertexBuffer2.destroy(),this._bufferState=null,this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._subBirthTime=null,this._subDistance=null,this._lastFixedVertexPosition=null,this._disappearBoundsMode=!1}clear(){this._activeIndex=0,this._endIndex=0,this._disappearBoundsMode=!1,this._subBirthTime.fill(0),this._subDistance.fill(0),this._segementCount=0,this._isTempEndVertex=!1,this._needAddFirstVertex=!1,this._lastFixedVertexPosition.setValue(0,0,0)}}e.a=g,r()(g,"ALIGNMENT_VIEW",0),r()(g,"ALIGNMENT_TRANSFORM_Z",1),r()(g,"_tempVector30",new c.a),r()(g,"_tempVector31",new c.a),r()(g,"_tempVector32",new c.a),r()(g,"_tempVector33",new c.a),r()(g,"_tempVector34",new c.a),r()(g,"_tempVector35",new c.a),r()(g,"_tempVector36",new c.a),r()(g,"_type",u.a._typeCounter++)},function(t,e,i){"use strict";let a;i.d(e,"a",function(){return a}),function(t){t[t.View=0]="View",t[t.TransformZ=1]="TransformZ"}(a||(a={}))},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(33),n=i(133),o=i(9);e.a=class extends n.a{constructor(t){super(t),r()(this,"_projectionViewWorldMatrix",new o.a)}_calculateBoundingBox(){}_needRender(t,e){return this._owner.trailFilter._update(e),!t||t.intersects(this.bounds._getBoundBox())}_updateForNative(t){this._owner.trailFilter._update(t)}_renderUpdate(t,e){super._renderUpdate(t,e)}_renderUpdateWithCamera(t,e){var i=t.projectionViewMatrix;e?(o.a.multiply(i,e.worldMatrix,this._projectionViewWorldMatrix),this._shaderValues.setMatrix4x4(s.a.MVPMATRIX,this._projectionViewWorldMatrix)):this._shaderValues.setMatrix4x4(s.a.MVPMATRIX,i)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(55),n=i(56),o=i(31);class l{static __init__(){l._vertexDeclaration=new s.a(40,[new n.a(0,o.a.Vector3,l.TERRAIN_POSITION0),new n.a(12,o.a.Vector3,l.TERRAIN_NORMAL0),new n.a(24,o.a.Vector2,l.TERRAIN_TEXTURECOORDINATE0),new n.a(32,o.a.Vector2,l.TERRAIN_TEXTURECOORDINATE1)])}static get vertexDeclaration(){return l._vertexDeclaration}get position(){return this._position}get normal(){return this._normal}get textureCoord0(){return this._textureCoord0}get textureCoord1(){return this._textureCoord1}get vertexDeclaration(){return l._vertexDeclaration}constructor(t,e,i,a){r()(this,"_position",void 0),r()(this,"_normal",void 0),r()(this,"_textureCoord0",void 0),r()(this,"_textureCoord1",void 0),this._position=t,this._normal=e,this._textureCoord0=i,this._textureCoord1=a}}e.a=l,r()(l,"TERRAIN_POSITION0",0),r()(l,"TERRAIN_NORMAL0",1),r()(l,"TERRAIN_TEXTURECOORDINATE0",2),r()(l,"TERRAIN_TEXTURECOORDINATE1",3),r()(l,"_vertexDeclaration",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(62);class n{}e.a=n,r()(n,"_interactive",{getWorldTransform:(t,e)=>{},setWorldTransform:(t,e)=>{var i=s.a._physicObjectsMap[t];i._simulation._updatedRigidbodies++,i._updateTransformComponent(e)}})},function(t,e,i){"use strict";var a=i(51),r=i(62),s=i(261),n=i(50);e.a=class extends s.a{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.a.COLLISIONFILTERGROUP_DEFAULTFILTER,arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.a.COLLISIONFILTERGROUP_ALLFILTER),this._enableProcessCollisions=!1}_addToSimulation(){this._simulation._addPhysicsCollider(this,this._collisionGroup,this._canCollideWith)}_removeFromSimulation(){this._simulation._removePhysicsCollider(this)}_parse(t){null!=t.friction&&(this.friction=t.friction),null!=t.rollingFriction&&(this.rollingFriction=t.rollingFriction),null!=t.restitution&&(this.restitution=t.restitution),null!=t.isTrigger&&(this.isTrigger=t.isTrigger),super._parse(t),this._parseShape(t.shapes)}_onAdded(){var t=n.a._bullet,e=t.btCollisionObject_create();t.btCollisionObject_setUserIndex(e,this.id),t.btCollisionObject_forceActivationState(e,r.a.ACTIVATIONSTATE_DISABLE_SIMULATION);var i=t.btCollisionObject_getCollisionFlags(e);this.owner.isStatic?((i&r.a.COLLISIONFLAGS_KINEMATIC_OBJECT)>0&&(i^=r.a.COLLISIONFLAGS_KINEMATIC_OBJECT),i|=r.a.COLLISIONFLAGS_STATIC_OBJECT):((i&r.a.COLLISIONFLAGS_STATIC_OBJECT)>0&&(i^=r.a.COLLISIONFLAGS_STATIC_OBJECT),i|=r.a.COLLISIONFLAGS_KINEMATIC_OBJECT),t.btCollisionObject_setCollisionFlags(e,i),this._btColliderObject=e,super._onAdded()}}},function(t,e,i){"use strict";var a=i(57),r=i(14),s=i(25),n=i(24),o=i(1),l=i(106),h=i(137),_=i(2),c=i(39);class d{static __init__(){}static _createMesh(t,e,i){var r=_.a.instance,n=new l.a,o=new h.a(n),d=new s.a(4*e.length,r.STATIC_DRAW,!0);d.vertexDeclaration=t,d.setData(e.buffer),n._vertexBuffer=d,n._vertexCount=d._byteLength/t.vertexStride;var u=new a.a(c.a.UInt16,i.length,r.STATIC_DRAW,!0);u.setData(i),n._indexBuffer=u,n._setBuffer(d,u),n._setInstanceBuffer(n._instanceBufferStateType),o._vertexBuffer=d,o._indexBuffer=u,o._setIndexRange(0,u.indexCount);var f=o._subIndexBufferStart,m=o._subIndexBufferCount,p=o._boneIndicesList;f.length=1,m.length=1,p.length=1,f[0]=0,m[0]=u.indexCount;var g=[];g.push(o),n._setSubMeshes(g),n.calculateBounds();var v=d._byteLength+u._byteLength;return n._setCPUMemory(v),n._setGPUMemory(v),n}static createBox(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;var a=r.a.getVertexDeclaration("POSITION,NORMAL,UV"),s=t/2,n=e/2,o=i/2,l=new Float32Array([-s,n,-o,0,1,0,0,0,s,n,-o,0,1,0,1,0,s,n,o,0,1,0,1,1,-s,n,o,0,1,0,0,1,-s,-n,-o,0,-1,0,0,1,s,-n,-o,0,-1,0,1,1,s,-n,o,0,-1,0,1,0,-s,-n,o,0,-1,0,0,0,-s,n,-o,-1,0,0,0,0,-s,n,o,-1,0,0,1,0,-s,-n,o,-1,0,0,1,1,-s,-n,-o,-1,0,0,0,1,s,n,-o,1,0,0,1,0,s,n,o,1,0,0,0,0,s,-n,o,1,0,0,0,1,s,-n,-o,1,0,0,1,1,-s,n,o,0,0,1,0,0,s,n,o,0,0,1,1,0,s,-n,o,0,0,1,1,1,-s,-n,o,0,0,1,0,1,-s,n,-o,0,0,-1,1,0,s,n,-o,0,0,-1,0,0,s,-n,-o,0,0,-1,0,1,-s,-n,-o,0,0,-1,1,1]),h=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);return d._createMesh(a,l,h)}static createCapsule(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32;var s,n,o=(i+1)*(a+1)*2+2*(a+1),l=3*i*(a+1)*2*2+2*a*3,h=r.a.getVertexDeclaration("POSITION,NORMAL,UV"),_=h.vertexStride/4,c=new Float32Array(o*_),u=new Uint16Array(l),f=Math.PI/2/i,m=2*Math.PI/a,p=e/2-t,g=0,v=0,T=0,E=0,S=0,R=0;for(s=0;s<=i;s++)for(n=0;n<=a;n++)g=t*Math.cos(s*f)*Math.cos(n*m+Math.PI),v=t*Math.sin(s*f),T=t*Math.cos(s*f)*Math.sin(n*m+Math.PI),c[E++]=g,c[E++]=v+p,c[E++]=T,c[E++]=g,c[E++]=v,c[E++]=T,c[E++]=1-n/a,c[E++]=(1-s/i)*(Math.PI*t/2/(e+Math.PI*t)),s<i&&(u[S++]=s*(a+1)+n+(a+1),u[S++]=s*(a+1)+n,u[S++]=s*(a+1)+n+1,u[S++]=s*(a+1)+n+a,u[S++]=s*(a+1)+n,u[S++]=s*(a+1)+n+(a+1));for(R+=(i+1)*(a+1),s=0;s<=i;s++)for(n=0;n<=a;n++)g=t*Math.cos(s*f)*Math.cos(n*m+Math.PI),v=t*Math.sin(-s*f),T=t*Math.cos(s*f)*Math.sin(n*m+Math.PI),c[E++]=g,c[E++]=v-p,c[E++]=T,c[E++]=g,c[E++]=v,c[E++]=T,c[E++]=1-n/a,c[E++]=(s/i*(Math.PI*t/2)+(e+Math.PI*t/2))/(e+Math.PI*t),s<i&&(u[S++]=R+s*(a+1)+n,u[S++]=R+s*(a+1)+n+(a+1),u[S++]=R+s*(a+1)+n+1,u[S++]=R+s*(a+1)+n,u[S++]=R+s*(a+1)+n+a,u[S++]=R+s*(a+1)+n+(a+1));for(R+=(i+1)*(a+1),n=0;n<=a;n++)g=t*Math.cos(n*m+Math.PI),v=p,T=t*Math.sin(n*m+Math.PI),c[E++]=g,c[E+8*(a+1)-1]=g,c[E++]=v,c[E+8*(a+1)-1]=-v,c[E++]=T,c[E+8*(a+1)-1]=T,c[E++]=g,c[E+8*(a+1)-1]=g,c[E++]=0,c[E+8*(a+1)-1]=0,c[E++]=T,c[E+8*(a+1)-1]=T,c[E++]=1-1*n/a,c[E+8*(a+1)-1]=1-1*n/a,c[E++]=Math.PI*t/2/(e+Math.PI*t),c[E+8*(a+1)-1]=(Math.PI*t/2+e)/(e+Math.PI*t);for(n=0;n<a;n++)u[S++]=n+R+(a+1),u[S++]=n+R+1,u[S++]=n+R,u[S++]=n+R+(a+1),u[S++]=n+R+(a+1)+1,u[S++]=n+R+1;return R+=2*(a+1),d._createMesh(h,c,u)}static createCone(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32;for(var a,s=i+1+1+2*(i+1),l=6*i+3*i,h=r.a.getVertexDeclaration("POSITION,NORMAL,UV"),_=h.vertexStride/4,c=new Float32Array(s*_),u=new Uint16Array(l),f=2*Math.PI/i,m=e/2,p=0,g=0,v=0,T=0,E=0,S=new o.a,R=new o.a(0,-1,0),x=new o.a(0,m,0),A=new o.a,y=new o.a,I=new n.a,C=new o.a,M=0,D=0,b=0;b<=i;b++)p=b*f,v=Math.cos(p+Math.PI)*t,T=m,E=Math.sin(p+Math.PI)*t,c[M++]=0,c[M+8*(i+1)-1]=v,c[M++]=T,c[M+8*(i+1)-1]=-T,c[M++]=0,c[M+8*(i+1)-1]=E,S.x=v,S.y=0,S.z=E,A.x=v,A.y=-T,A.z=E,o.a.subtract(A,x,y),o.a.normalize(y,y),a=Math.acos(o.a.dot(R,y)),o.a.cross(R,y,C),o.a.normalize(C,C),n.a.createFromAxisAngle(C,a,I),o.a.normalize(S,S),o.a.transformQuat(S,I,S),o.a.normalize(S,S),c[M++]=S.x,c[M+8*(i+1)-1]=S.x,c[M++]=S.y,c[M+8*(i+1)-1]=S.y,c[M++]=S.z,c[M+8*(i+1)-1]=S.z,c[M++]=1-1*b/i,c[M+8*(i+1)-1]=1-1*b/i,c[M++]=0,c[M+8*(i+1)-1]=1;M+=8*(i+1);for(var L=0;L<i;L++)u[D++]=L+g+(i+1),u[D++]=L+g+1,u[D++]=L+g,u[D++]=L+g+(i+1),u[D++]=L+g+(i+1)+1,u[D++]=L+g+1;g+=2*(i+1);for(var O=0;O<=i;O++)0===O&&(c[M++]=0,c[M++]=-m,c[M++]=0,c[M++]=0,c[M++]=-1,c[M++]=0,c[M++]=.5,c[M++]=.5),p=O*f,v=Math.cos(p+Math.PI)*t,T=-m,E=Math.sin(p+Math.PI)*t,c[M++]=v,c[M++]=T,c[M++]=E,c[M++]=0,c[M++]=-1,c[M++]=0,c[M++]=.5+.5*Math.cos(p),c[M++]=.5+.5*Math.sin(p);for(var P=0;P<i;P++)u[D++]=0+g,u[D++]=P+2+g,u[D++]=P+1+g;return g+=i+1+1,d._createMesh(h,c,u)}static createCylinder(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32;for(var a=i+1+1+2*(i+1)+(i+1+1),s=3*i+6*i+3*i,n=r.a.getVertexDeclaration("POSITION,NORMAL,UV"),o=n.vertexStride/4,l=new Float32Array(a*o),h=new Uint16Array(s),_=2*Math.PI/i,c=e/2,u=0,f=0,m=0,p=0,g=0,v=0,T=0,E=0;E<=i;E++)0===E&&(l[v++]=0,l[v++]=c,l[v++]=0,l[v++]=0,l[v++]=1,l[v++]=0,l[v++]=.5,l[v++]=.5),u=E*_,m=Math.cos(u)*t,p=c,g=Math.sin(u)*t,l[v++]=m,l[v++]=p,l[v++]=g,l[v++]=0,l[v++]=1,l[v++]=0,l[v++]=.5+.5*Math.cos(u),l[v++]=.5+.5*Math.sin(u);for(var S=0;S<i;S++)h[T++]=0,h[T++]=S+1,h[T++]=S+2;f+=i+1+1;for(var R=0;R<=i;R++)u=R*_,m=Math.cos(u+Math.PI)*t,p=c,g=Math.sin(u+Math.PI)*t,l[v++]=m,l[v+8*(i+1)-1]=m,l[v++]=p,l[v+8*(i+1)-1]=-p,l[v++]=g,l[v+8*(i+1)-1]=g,l[v++]=m,l[v+8*(i+1)-1]=m,l[v++]=0,l[v+8*(i+1)-1]=0,l[v++]=g,l[v+8*(i+1)-1]=g,l[v++]=1-1*R/i,l[v+8*(i+1)-1]=1-1*R/i,l[v++]=0,l[v+8*(i+1)-1]=1;v+=8*(i+1);for(var x=0;x<i;x++)h[T++]=x+f+(i+1),h[T++]=x+f+1,h[T++]=x+f,h[T++]=x+f+(i+1),h[T++]=x+f+(i+1)+1,h[T++]=x+f+1;f+=2*(i+1);for(var A=0;A<=i;A++)0===A&&(l[v++]=0,l[v++]=-c,l[v++]=0,l[v++]=0,l[v++]=-1,l[v++]=0,l[v++]=.5,l[v++]=.5),u=A*_,m=Math.cos(u+Math.PI)*t,p=-c,g=Math.sin(u+Math.PI)*t,l[v++]=m,l[v++]=p,l[v++]=g,l[v++]=0,l[v++]=-1,l[v++]=0,l[v++]=.5+.5*Math.cos(u),l[v++]=.5+.5*Math.sin(u);for(var y=0;y<i;y++)h[T++]=0+f,h[T++]=y+2+f,h[T++]=y+1+f;return f+=i+1+1,d._createMesh(n,l,h)}static createPlane(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;for(var s=(i+1)*(a+1),n=new Uint16Array(i*a*2*3),o=r.a.getVertexDeclaration("POSITION,NORMAL,UV"),l=o.vertexStride/4,h=new Float32Array(s*l),_=t/2,c=e/2,u=t/i,f=e/a,m=0,p=0;p<=a;p++)for(var g=0;g<=i;g++)h[m++]=g*u-_,h[m++]=0,h[m++]=p*f-c,h[m++]=0,h[m++]=1,h[m++]=0,h[m++]=1*g/i,h[m++]=1*p/a;var v=0;for(p=0;p<a;p++)for(g=0;g<i;g++)n[v++]=(p+1)*(i+1)+g,n[v++]=p*(i+1)+g,n[v++]=(p+1)*(i+1)+g+1,n[v++]=p*(i+1)+g,n[v++]=p*(i+1)+g+1,n[v++]=(p+1)*(i+1)+g+1;return d._createMesh(o,h,n)}static createQuad(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;var i=r.a.getVertexDeclaration("POSITION,NORMAL,UV"),a=t/2,s=e/2,n=new Float32Array([-a,s,0,0,0,1,0,0,a,s,0,0,0,1,1,0,-a,-s,0,0,0,1,0,1,a,-s,0,0,0,1,1,1]),o=new Uint16Array([0,1,2,3,2,1]);return d._createMesh(i,n,o)}static createSphere(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32;var a=(e+1)*(i+1),s=3*e*(i+1)*2,n=new Uint16Array(s),o=r.a.getVertexDeclaration("POSITION,NORMAL,UV"),l=o.vertexStride/4,h=new Float32Array(a*l),_=Math.PI/e,c=2*Math.PI/i,u=0;a=0,s=0;for(var f=0;f<e+1;f++)for(var m=Math.sin(f*_),p=Math.cos(f*_),g=0;g<i+1;g++){var v=m*Math.sin(g*c+1*Math.PI/2),T=m*Math.cos(g*c+1*Math.PI/2);h[a+0]=v*t,h[a+1]=p*t,h[a+2]=T*t,h[a+3]=v,h[a+4]=p,h[a+5]=T,h[a+6]=g/i,h[a+7]=f/e,a+=l,f!=e-1&&(n[s++]=u+(i+1),n[s++]=u,n[s++]=u+1,n[s++]=u+i,n[s++]=u,n[s++]=u+(i+1),u++)}return d._createMesh(o,h,n)}}e.a=d},function(t,e,i){"use strict";var a=i(40),r=i(193),s=i(14),n=i(189),o=i(502),l=i(503),h=i(504),_=i(505),c=i(506),d=i(507),u=i(508),f=i(509),m=i(510),p=i(511),g=i(512),v=i(513),T=i(514),E=i(515),S=i(516),R=i(517),x=i(518),A=i(519),y=i(520),I=i(521),C=i(522),M=i(523),D=i(524),b=i(525),L=i(526),O=i(527),P=i(528),N=i(529),w=i(530),B=i(531),F=i(532),V=i(533),U=i(534),G=i(535),H=i(536),z=i(537),k=i(538),W=i(539),X=i(540),Y=i(541),j=i(542),Z=i(543),q=i(544),Q=i(545),K=i(546),J=i(547),$=i(548),tt=i(549),et=i(7),it=i(130);e.a=class{constructor(){}static __init__(){et.a.SHADERDEFINE_LEGACYSINGALLIGHTING=et.a.getDefineByName("LEGACYSINGLELIGHTING"),et.a.SHADERDEFINE_GRAPHICS_API_GLES2=et.a.getDefineByName("GRAPHICS_API_GLES2"),et.a.SHADERDEFINE_GRAPHICS_API_GLES3=et.a.getDefineByName("GRAPHICS_API_GLES3"),et.a.addInclude("Lighting.glsl",f.a),et.a.addInclude("ShadowSampleTent.glsl",m.a),et.a.addInclude("GlobalIllumination.glsl",u.a),et.a.addInclude("Shadow.glsl",z.a),et.a.addInclude("ShadowCasterVS.glsl",k.a),et.a.addInclude("ShadowCasterFS.glsl",W.a),et.a.addInclude("Colors.glsl",F.a),et.a.addInclude("Sampling.glsl",G.a),et.a.addInclude("StdLib.glsl",H.a),et.a.addInclude("PBRVSInput.glsl",C.a),et.a.addInclude("PBRFSInput.glsl",M.a),et.a.addInclude("LayaPBRBRDF.glsl",y.a),et.a.addInclude("PBRCore.glsl",I.a),et.a.addInclude("PBRVertex.glsl",D.a),et.a.addInclude("LayaUtile.glsl",p.a);var t={a_Position:s.a.MESH_POSITION0,a_Color:s.a.MESH_COLOR0,a_Normal:s.a.MESH_NORMAL0,a_Texcoord0:s.a.MESH_TEXTURECOORDINATE0,a_Texcoord1:s.a.MESH_TEXTURECOORDINATE1,a_BoneWeights:s.a.MESH_BLENDWEIGHT0,a_BoneIndices:s.a.MESH_BLENDINDICES0,a_Tangent0:s.a.MESH_TANGENT0,a_MvpMatrix:s.a.MESH_MVPMATRIX_ROW0,a_WorldMat:s.a.MESH_WORLDMATRIX_ROW0},e={u_Bones:et.a.PERIOD_CUSTOM,u_DiffuseTexture:et.a.PERIOD_MATERIAL,u_SpecularTexture:et.a.PERIOD_MATERIAL,u_NormalTexture:et.a.PERIOD_MATERIAL,u_AlphaTestValue:et.a.PERIOD_MATERIAL,u_DiffuseColor:et.a.PERIOD_MATERIAL,u_MaterialSpecular:et.a.PERIOD_MATERIAL,u_Shininess:et.a.PERIOD_MATERIAL,u_TilingOffset:et.a.PERIOD_MATERIAL,u_WorldMat:et.a.PERIOD_SPRITE,u_MvpMatrix:et.a.PERIOD_SPRITE,u_LightmapScaleOffset:et.a.PERIOD_SPRITE,u_LightMap:et.a.PERIOD_SPRITE,u_LightMapDirection:et.a.PERIOD_SPRITE,u_SimpleAnimatorTexture:et.a.PERIOD_SPRITE,u_SimpleAnimatorParams:et.a.PERIOD_SPRITE,u_SimpleAnimatorTextureSize:et.a.PERIOD_SPRITE,u_CameraPos:et.a.PERIOD_CAMERA,u_Viewport:et.a.PERIOD_CAMERA,u_ProjectionParams:et.a.PERIOD_CAMERA,u_View:et.a.PERIOD_CAMERA,u_ViewProjection:et.a.PERIOD_CAMERA,u_ReflectTexture:et.a.PERIOD_SCENE,u_FogStart:et.a.PERIOD_SCENE,u_FogRange:et.a.PERIOD_SCENE,u_FogColor:et.a.PERIOD_SCENE,u_DirationLightCount:et.a.PERIOD_SCENE,u_LightBuffer:et.a.PERIOD_SCENE,u_LightClusterBuffer:et.a.PERIOD_SCENE,u_AmbientColor:et.a.PERIOD_SCENE,u_ShadowBias:et.a.PERIOD_SCENE,u_ShadowLightDirection:et.a.PERIOD_SCENE,u_ShadowMap:et.a.PERIOD_SCENE,u_ShadowParams:et.a.PERIOD_SCENE,u_ShadowSplitSpheres:et.a.PERIOD_SCENE,u_ShadowMatrices:et.a.PERIOD_SCENE,u_ShadowMapSize:et.a.PERIOD_SCENE,u_SpotShadowMap:et.a.PERIOD_SCENE,u_SpotViewProjectMatrix:et.a.PERIOD_SCENE,u_ShadowLightPosition:et.a.PERIOD_SCENE,u_AmbientSHAr:et.a.PERIOD_SCENE,u_AmbientSHAg:et.a.PERIOD_SCENE,u_AmbientSHAb:et.a.PERIOD_SCENE,u_AmbientSHBr:et.a.PERIOD_SCENE,u_AmbientSHBg:et.a.PERIOD_SCENE,u_AmbientSHBb:et.a.PERIOD_SCENE,u_AmbientSHC:et.a.PERIOD_SCENE,"u_DirectionLight.color":et.a.PERIOD_SCENE,"u_DirectionLight.direction":et.a.PERIOD_SCENE,"u_PointLight.position":et.a.PERIOD_SCENE,"u_PointLight.range":et.a.PERIOD_SCENE,"u_PointLight.color":et.a.PERIOD_SCENE,"u_SpotLight.position":et.a.PERIOD_SCENE,"u_SpotLight.direction":et.a.PERIOD_SCENE,"u_SpotLight.range":et.a.PERIOD_SCENE,"u_SpotLight.spot":et.a.PERIOD_SCENE,"u_SpotLight.color":et.a.PERIOD_SCENE},i={s_Cull:et.a.RENDER_STATE_CULL,s_Blend:et.a.RENDER_STATE_BLEND,s_BlendSrc:et.a.RENDER_STATE_BLEND_SRC,s_BlendDst:et.a.RENDER_STATE_BLEND_DST,s_DepthTest:et.a.RENDER_STATE_DEPTH_TEST,s_DepthWrite:et.a.RENDER_STATE_DEPTH_WRITE},at=et.a.add("BLINNPHONG",null,null,!0),rt=new it.a(t,e);at.addSubShader(rt),rt.addShaderPass(E.a,T.a,i,"Forward"),rt.addShaderPass(R.a,S.a,i,"ShadowCaster"),t={a_Position:s.a.MESH_POSITION0,a_Color:s.a.MESH_COLOR0},e={u_MvpMatrix:et.a.PERIOD_SPRITE,u_Color:et.a.PERIOD_MATERIAL},i={s_Cull:et.a.RENDER_STATE_CULL,s_Blend:et.a.RENDER_STATE_BLEND,s_BlendSrc:et.a.RENDER_STATE_BLEND_SRC,s_BlendDst:et.a.RENDER_STATE_BLEND_DST,s_DepthTest:et.a.RENDER_STATE_DEPTH_TEST,s_DepthWrite:et.a.RENDER_STATE_DEPTH_WRITE},at=et.a.add("LineShader"),rt=new it.a(t,e),at.addSubShader(rt),rt.addShaderPass(v.a,g.a,i),t={a_Position:s.a.MESH_POSITION0,a_Color:s.a.MESH_COLOR0,a_Texcoord0:s.a.MESH_TEXTURECOORDINATE0,a_BoneWeights:s.a.MESH_BLENDWEIGHT0,a_BoneIndices:s.a.MESH_BLENDINDICES0,a_MvpMatrix:s.a.MESH_MVPMATRIX_ROW0},e={u_Bones:et.a.PERIOD_CUSTOM,u_AlbedoTexture:et.a.PERIOD_MATERIAL,u_AlbedoColor:et.a.PERIOD_MATERIAL,u_TilingOffset:et.a.PERIOD_MATERIAL,u_AlphaTestValue:et.a.PERIOD_MATERIAL,u_MvpMatrix:et.a.PERIOD_SPRITE,u_SimpleAnimatorTexture:et.a.PERIOD_SPRITE,u_SimpleAnimatorParams:et.a.PERIOD_SPRITE,u_SimpleAnimatorTextureSize:et.a.PERIOD_SPRITE,u_FogStart:et.a.PERIOD_SCENE,u_FogRange:et.a.PERIOD_SCENE,u_FogColor:et.a.PERIOD_SCENE},i={s_Cull:et.a.RENDER_STATE_CULL,s_Blend:et.a.RENDER_STATE_BLEND,s_BlendSrc:et.a.RENDER_STATE_BLEND_SRC,s_BlendDst:et.a.RENDER_STATE_BLEND_DST,s_DepthTest:et.a.RENDER_STATE_DEPTH_TEST,s_DepthWrite:et.a.RENDER_STATE_DEPTH_WRITE},at=et.a.add("Unlit",null,null,!0),rt=new it.a(t,e),at.addSubShader(rt),rt.addShaderPass(J.a,K.a,i),t={a_Position:s.a.MESH_POSITION0,a_Texcoord0:s.a.MESH_TEXTURECOORDINATE0,a_BoneWeights:s.a.MESH_BLENDWEIGHT0,a_BoneIndices:s.a.MESH_BLENDINDICES0,a_MvpMatrix:s.a.MESH_MVPMATRIX_ROW0},e={u_Bones:et.a.PERIOD_CUSTOM,u_AlbedoTexture:et.a.PERIOD_MATERIAL,u_AlbedoColor:et.a.PERIOD_MATERIAL,u_TilingOffset:et.a.PERIOD_MATERIAL,u_AlphaTestValue:et.a.PERIOD_MATERIAL,u_MvpMatrix:et.a.PERIOD_SPRITE,u_SimpleAnimatorTexture:et.a.PERIOD_SPRITE,u_SimpleAnimatorParams:et.a.PERIOD_SPRITE,u_SimpleAnimatorTextureSize:et.a.PERIOD_SPRITE,u_FogStart:et.a.PERIOD_SCENE,u_FogRange:et.a.PERIOD_SCENE,u_FogColor:et.a.PERIOD_SCENE},i={s_Cull:et.a.RENDER_STATE_CULL,s_Blend:et.a.RENDER_STATE_BLEND,s_BlendSrc:et.a.RENDER_STATE_BLEND_SRC,s_BlendDst:et.a.RENDER_STATE_BLEND_DST,s_DepthTest:et.a.RENDER_STATE_DEPTH_TEST,s_DepthWrite:et.a.RENDER_STATE_DEPTH_WRITE},at=et.a.add("Effect",null,null,!0),rt=new it.a(t,e),at.addSubShader(rt),rt.addShaderPass(_.a,h.a,i),t={a_CornerTextureCoordinate:n.a.PARTICLE_CORNERTEXTURECOORDINATE0,a_MeshPosition:n.a.PARTICLE_POSITION0,a_MeshColor:n.a.PARTICLE_COLOR0,a_MeshTextureCoordinate:n.a.PARTICLE_TEXTURECOORDINATE0,a_ShapePositionStartLifeTime:n.a.PARTICLE_SHAPEPOSITIONSTARTLIFETIME,a_DirectionTime:n.a.PARTICLE_DIRECTIONTIME,a_StartColor:n.a.PARTICLE_STARTCOLOR0,a_EndColor:n.a.PARTICLE_ENDCOLOR0,a_StartSize:n.a.PARTICLE_STARTSIZE,a_StartRotation0:n.a.PARTICLE_STARTROTATION,a_StartSpeed:n.a.PARTICLE_STARTSPEED,a_Random0:n.a.PARTICLE_RANDOM0,a_Random1:n.a.PARTICLE_RANDOM1,a_SimulationWorldPostion:n.a.PARTICLE_SIMULATIONWORLDPOSTION,a_SimulationWorldRotation:n.a.PARTICLE_SIMULATIONWORLDROTATION},e={u_Tintcolor:et.a.PERIOD_MATERIAL,u_TilingOffset:et.a.PERIOD_MATERIAL,u_texture:et.a.PERIOD_MATERIAL,u_WorldPosition:et.a.PERIOD_SPRITE,u_WorldRotation:et.a.PERIOD_SPRITE,u_PositionScale:et.a.PERIOD_SPRITE,u_SizeScale:et.a.PERIOD_SPRITE,u_ScalingMode:et.a.PERIOD_SPRITE,u_Gravity:et.a.PERIOD_SPRITE,u_ThreeDStartRotation:et.a.PERIOD_SPRITE,u_StretchedBillboardLengthScale:et.a.PERIOD_SPRITE,u_StretchedBillboardSpeedScale:et.a.PERIOD_SPRITE,u_SimulationSpace:et.a.PERIOD_SPRITE,u_CurrentTime:et.a.PERIOD_SPRITE,u_ColorOverLifeGradientAlphas:et.a.PERIOD_SPRITE,u_ColorOverLifeGradientColors:et.a.PERIOD_SPRITE,u_MaxColorOverLifeGradientAlphas:et.a.PERIOD_SPRITE,u_MaxColorOverLifeGradientColors:et.a.PERIOD_SPRITE,u_VOLVelocityConst:et.a.PERIOD_SPRITE,u_VOLVelocityGradientX:et.a.PERIOD_SPRITE,u_VOLVelocityGradientY:et.a.PERIOD_SPRITE,u_VOLVelocityGradientZ:et.a.PERIOD_SPRITE,u_VOLVelocityConstMax:et.a.PERIOD_SPRITE,u_VOLVelocityGradientMaxX:et.a.PERIOD_SPRITE,u_VOLVelocityGradientMaxY:et.a.PERIOD_SPRITE,u_VOLVelocityGradientMaxZ:et.a.PERIOD_SPRITE,u_VOLSpaceType:et.a.PERIOD_SPRITE,u_SOLSizeGradient:et.a.PERIOD_SPRITE,u_SOLSizeGradientX:et.a.PERIOD_SPRITE,u_SOLSizeGradientY:et.a.PERIOD_SPRITE,u_SOLSizeGradientZ:et.a.PERIOD_SPRITE,u_SOLSizeGradientMax:et.a.PERIOD_SPRITE,u_SOLSizeGradientMaxX:et.a.PERIOD_SPRITE,u_SOLSizeGradientMaxY:et.a.PERIOD_SPRITE,u_SOLSizeGradientMaxZ:et.a.PERIOD_SPRITE,u_ROLAngularVelocityConst:et.a.PERIOD_SPRITE,u_ROLAngularVelocityConstSeprarate:et.a.PERIOD_SPRITE,u_ROLAngularVelocityGradient:et.a.PERIOD_SPRITE,u_ROLAngularVelocityGradientX:et.a.PERIOD_SPRITE,u_ROLAngularVelocityGradientY:et.a.PERIOD_SPRITE,u_ROLAngularVelocityGradientZ:et.a.PERIOD_SPRITE,u_ROLAngularVelocityConstMax:et.a.PERIOD_SPRITE,u_ROLAngularVelocityConstMaxSeprarate:et.a.PERIOD_SPRITE,u_ROLAngularVelocityGradientMax:et.a.PERIOD_SPRITE,u_ROLAngularVelocityGradientMaxX:et.a.PERIOD_SPRITE,u_ROLAngularVelocityGradientMaxY:et.a.PERIOD_SPRITE,u_ROLAngularVelocityGradientMaxZ:et.a.PERIOD_SPRITE,u_ROLAngularVelocityGradientMaxW:et.a.PERIOD_SPRITE,u_TSACycles:et.a.PERIOD_SPRITE,u_TSASubUVLength:et.a.PERIOD_SPRITE,u_TSAGradientUVs:et.a.PERIOD_SPRITE,u_TSAMaxGradientUVs:et.a.PERIOD_SPRITE,u_CameraPos:et.a.PERIOD_CAMERA,u_CameraDirection:et.a.PERIOD_CAMERA,u_CameraUp:et.a.PERIOD_CAMERA,u_View:et.a.PERIOD_CAMERA,u_Projection:et.a.PERIOD_CAMERA,u_FogStart:et.a.PERIOD_SCENE,u_FogRange:et.a.PERIOD_SCENE,u_FogColor:et.a.PERIOD_SCENE},i={s_Cull:et.a.RENDER_STATE_CULL,s_Blend:et.a.RENDER_STATE_BLEND,s_BlendSrc:et.a.RENDER_STATE_BLEND_SRC,s_BlendDst:et.a.RENDER_STATE_BLEND_DST,s_DepthTest:et.a.RENDER_STATE_DEPTH_TEST,s_DepthWrite:et.a.RENDER_STATE_DEPTH_WRITE},at=et.a.add("PARTICLESHURIKEN"),rt=new it.a(t,e),at.addSubShader(rt),rt.addShaderPass(A.a,x.a,i),t={a_Position:s.a.MESH_POSITION0},e={u_TintColor:et.a.PERIOD_MATERIAL,u_Exposure:et.a.PERIOD_MATERIAL,u_Rotation:et.a.PERIOD_MATERIAL,u_CubeTexture:et.a.PERIOD_MATERIAL,u_ViewProjection:et.a.PERIOD_CAMERA},at=et.a.add("SkyBox"),rt=new it.a(t,e),at.addSubShader(rt),rt.addShaderPass(Y.a,X.a),t={a_Position:s.a.MESH_POSITION0},e={u_SunSize:et.a.PERIOD_MATERIAL,u_SunSizeConvergence:et.a.PERIOD_MATERIAL,u_AtmosphereThickness:et.a.PERIOD_MATERIAL,u_SkyTint:et.a.PERIOD_MATERIAL,u_GroundTint:et.a.PERIOD_MATERIAL,u_Exposure:et.a.PERIOD_MATERIAL,u_ViewProjection:et.a.PERIOD_CAMERA,"u_SunLight.direction":et.a.PERIOD_SCENE,"u_SunLight.color":et.a.PERIOD_SCENE},at=et.a.add("SkyBoxProcedural"),rt=new it.a(t,e),at.addSubShader(rt),rt.addShaderPass(Z.a,j.a),t={a_Position:s.a.MESH_POSITION0,a_Normal:s.a.MESH_NORMAL0,a_Texcoord0:s.a.MESH_TEXTURECOORDINATE0},e={u_MvpMatrix:et.a.PERIOD_SPRITE,u_WorldMat:et.a.PERIOD_SPRITE,u_CameraPos:et.a.PERIOD_CAMERA,u_Viewport:et.a.PERIOD_CAMERA,u_ProjectionParams:et.a.PERIOD_CAMERA,u_View:et.a.PERIOD_CAMERA,u_LightmapScaleOffset:et.a.PERIOD_SPRITE,u_LightMap:et.a.PERIOD_SPRITE,u_SplatAlphaTexture:et.a.PERIOD_MATERIAL,u_DiffuseTexture1:et.a.PERIOD_MATERIAL,u_DiffuseTexture2:et.a.PERIOD_MATERIAL,u_DiffuseTexture3:et.a.PERIOD_MATERIAL,u_DiffuseTexture4:et.a.PERIOD_MATERIAL,u_DiffuseTexture5:et.a.PERIOD_MATERIAL,u_DiffuseScaleOffset1:et.a.PERIOD_MATERIAL,u_DiffuseScaleOffset2:et.a.PERIOD_MATERIAL,u_DiffuseScaleOffset3:et.a.PERIOD_MATERIAL,u_DiffuseScaleOffset4:et.a.PERIOD_MATERIAL,u_DiffuseScaleOffset5:et.a.PERIOD_MATERIAL,u_FogStart:et.a.PERIOD_SCENE,u_FogRange:et.a.PERIOD_SCENE,u_FogColor:et.a.PERIOD_SCENE,u_DirationLightCount:et.a.PERIOD_SCENE,u_LightBuffer:et.a.PERIOD_SCENE,u_LightClusterBuffer:et.a.PERIOD_SCENE,u_AmbientColor:et.a.PERIOD_SCENE,u_ShadowMap:et.a.PERIOD_SCENE,u_shadowMap2:et.a.PERIOD_SCENE,u_shadowMap3:et.a.PERIOD_SCENE,u_ShadowSplitSpheres:et.a.PERIOD_SCENE,u_ShadowMatrices:et.a.PERIOD_SCENE,u_ShadowMapSize:et.a.PERIOD_SCENE,"u_DirectionLight.color":et.a.PERIOD_SCENE,"u_DirectionLight.direction":et.a.PERIOD_SCENE,"u_PointLight.position":et.a.PERIOD_SCENE,"u_PointLight.range":et.a.PERIOD_SCENE,"u_PointLight.color":et.a.PERIOD_SCENE,"u_SpotLight.position":et.a.PERIOD_SCENE,"u_SpotLight.direction":et.a.PERIOD_SCENE,"u_SpotLight.range":et.a.PERIOD_SCENE,"u_SpotLight.spot":et.a.PERIOD_SCENE,"u_SpotLight.color":et.a.PERIOD_SCENE},i={s_Cull:et.a.RENDER_STATE_CULL,s_Blend:et.a.RENDER_STATE_BLEND,s_BlendSrc:et.a.RENDER_STATE_BLEND_SRC,s_BlendDst:et.a.RENDER_STATE_BLEND_DST,s_DepthTest:et.a.RENDER_STATE_DEPTH_TEST,s_DepthWrite:et.a.RENDER_STATE_DEPTH_WRITE},at=et.a.add("ExtendTerrain"),rt=new it.a(t,e),at.addSubShader(rt),rt.addShaderPass(d.a,c.a,i),t={a_Position:r.a.TRAIL_POSITION0,a_OffsetVector:r.a.TRAIL_OFFSETVECTOR,a_Texcoord0X:r.a.TRAIL_TEXTURECOORDINATE0X,a_Texcoord0Y:r.a.TRAIL_TEXTURECOORDINATE0Y,a_BirthTime:r.a.TRAIL_TIME0,a_Color:r.a.TRAIL_COLOR},e={u_MvpMatrix:et.a.PERIOD_SPRITE,u_View:et.a.PERIOD_CAMERA,u_Projection:et.a.PERIOD_CAMERA,u_TilingOffset:et.a.PERIOD_MATERIAL,u_MainTexture:et.a.PERIOD_MATERIAL,u_MainColor:et.a.PERIOD_MATERIAL,u_CurTime:et.a.PERIOD_SPRITE,u_LifeTime:et.a.PERIOD_SPRITE,u_WidthCurve:et.a.PERIOD_SPRITE,u_WidthCurveKeyLength:et.a.PERIOD_SPRITE,u_GradientColorkey:et.a.PERIOD_SPRITE,u_GradientAlphakey:et.a.PERIOD_SPRITE},i={s_Cull:et.a.RENDER_STATE_CULL,s_Blend:et.a.RENDER_STATE_BLEND,s_BlendSrc:et.a.RENDER_STATE_BLEND_SRC,s_BlendDst:et.a.RENDER_STATE_BLEND_DST,s_DepthTest:et.a.RENDER_STATE_DEPTH_TEST,s_DepthWrite:et.a.RENDER_STATE_DEPTH_WRITE},at=et.a.add("Trail"),rt=new it.a(t,e),at.addSubShader(rt),rt.addShaderPass(Q.a,q.a,i),t={a_Position:s.a.MESH_POSITION0,a_Normal:s.a.MESH_NORMAL0,a_Tangent0:s.a.MESH_TANGENT0},e={u_MvpMatrix:et.a.PERIOD_SPRITE,u_WorldMat:et.a.PERIOD_SPRITE,u_CameraPos:et.a.PERIOD_CAMERA,u_Time:et.a.PERIOD_SCENE,u_MainTexture:et.a.PERIOD_MATERIAL,u_NormalTexture:et.a.PERIOD_MATERIAL,u_HorizonColor:et.a.PERIOD_MATERIAL,u_WaveScale:et.a.PERIOD_MATERIAL,u_WaveSpeed:et.a.PERIOD_MATERIAL},at=et.a.add("WaterPrimary"),rt=new it.a(t,e),at.addSubShader(rt),rt.addShaderPass(tt.a,$.a),t={a_PositionTexcoord:s.a.MESH_POSITION0},e={u_MainTex:et.a.PERIOD_MATERIAL,u_OffsetScale:et.a.PERIOD_MATERIAL},at=et.a.add("BlitScreen"),rt=new it.a(t,e),at.addSubShader(rt);var st=rt.addShaderPass(l.a,o.a).renderState;st.depthTest=a.a.DEPTHTEST_ALWAYS,st.depthWrite=!1,st.cull=a.a.CULL_NONE,st.blend=a.a.BLEND_DISABLE,t={a_PositionTexcoord:s.a.MESH_POSITION0},e={u_MainTex:et.a.PERIOD_MATERIAL,u_BloomTex:et.a.PERIOD_MATERIAL,u_AutoExposureTex:et.a.PERIOD_MATERIAL,u_MainTex_TexelSize:et.a.PERIOD_MATERIAL,u_SampleScale:et.a.PERIOD_MATERIAL,u_Threshold:et.a.PERIOD_MATERIAL,u_Params:et.a.PERIOD_MATERIAL},at=et.a.add("PostProcessBloom"),rt=new it.a(t,e),at.addSubShader(rt),(st=rt.addShaderPass(b.a,P.a).renderState).depthTest=a.a.DEPTHTEST_ALWAYS,st.depthWrite=!1,st.cull=a.a.CULL_NONE,st.blend=a.a.BLEND_DISABLE,rt=new it.a(t,e),at.addSubShader(rt),(st=rt.addShaderPass(b.a,N.a).renderState).depthTest=a.a.DEPTHTEST_ALWAYS,st.depthWrite=!1,st.cull=a.a.CULL_NONE,st.blend=a.a.BLEND_DISABLE,rt=new it.a(t,e),at.addSubShader(rt),(st=rt.addShaderPass(b.a,L.a).renderState).depthTest=a.a.DEPTHTEST_ALWAYS,st.depthWrite=!1,st.cull=a.a.CULL_NONE,st.blend=a.a.BLEND_DISABLE,rt=new it.a(t,e),at.addSubShader(rt),(st=rt.addShaderPass(b.a,O.a).renderState).depthTest=a.a.DEPTHTEST_ALWAYS,st.depthWrite=!1,st.cull=a.a.CULL_NONE,st.blend=a.a.BLEND_DISABLE,rt=new it.a(t,e),at.addSubShader(rt),(st=rt.addShaderPass(b.a,B.a).renderState).depthTest=a.a.DEPTHTEST_ALWAYS,st.depthWrite=!1,st.cull=a.a.CULL_NONE,st.blend=a.a.BLEND_DISABLE,rt=new it.a(t,e),at.addSubShader(rt),(st=rt.addShaderPass(b.a,w.a).renderState).depthTest=a.a.DEPTHTEST_ALWAYS,st.depthWrite=!1,st.cull=a.a.CULL_NONE,st.blend=a.a.BLEND_DISABLE,t={a_PositionTexcoord:s.a.MESH_POSITION0},e={u_MainTex:et.a.PERIOD_MATERIAL,u_BloomTex:et.a.PERIOD_MATERIAL,u_AutoExposureTex:et.a.PERIOD_MATERIAL,u_Bloom_DirtTileOffset:et.a.PERIOD_MATERIAL,u_Bloom_DirtTex:et.a.PERIOD_MATERIAL,u_BloomTex_TexelSize:et.a.PERIOD_MATERIAL,u_Bloom_Settings:et.a.PERIOD_MATERIAL,u_Bloom_Color:et.a.PERIOD_MATERIAL},at=et.a.add("PostProcessComposite"),rt=new it.a(t,e),at.addSubShader(rt),(st=rt.addShaderPass(U.a,V.a).renderState).depthTest=a.a.DEPTHTEST_ALWAYS,st.depthWrite=!1,st.cull=a.a.CULL_NONE,st.blend=a.a.BLEND_DISABLE}}},function(t,e,i){"use strict";e.a="#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nuniform sampler2D u_MainTex;\nvarying vec2 v_Texcoord0;\n\nvoid main() {\n\tgl_FragColor = texture2D(u_MainTex, v_Texcoord0);\n}\n\n"},function(t,e,i){"use strict";e.a='#include "Lighting.glsl";\n#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\nattribute vec4 a_PositionTexcoord;\nuniform vec4 u_OffsetScale;\nvarying vec2 v_Texcoord0;\n\nvoid main() {\t\n\tgl_Position = vec4(u_OffsetScale.x*2.0-1.0+(a_PositionTexcoord.x+1.0)*u_OffsetScale.z,(1.0-((u_OffsetScale.y*2.0-1.0+(-a_PositionTexcoord.y+1.0)*u_OffsetScale.w)+1.0)/2.0)*2.0-1.0, 0.0, 1.0);\t\n\tv_Texcoord0 = a_PositionTexcoord.zw;\n\tgl_Position = remapGLPositionZ(gl_Position);\n}'},function(t,e,i){"use strict";e.a="#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#ifdef COLOR\n\tvarying vec4 v_Color;\n#endif\nvarying vec2 v_Texcoord0;\n\n#ifdef MAINTEXTURE\n\tuniform sampler2D u_AlbedoTexture;\n#endif\n\nuniform vec4 u_AlbedoColor;\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\nvoid main()\n{\n\tvec4 color =  2.0 * u_AlbedoColor;\n\t#ifdef COLOR\n\t\tcolor *= v_Color;\n\t#endif\n\t#ifdef MAINTEXTURE\n\t\tcolor *= texture2D(u_AlbedoTexture, v_Texcoord0);\n\t#endif\n\t\n\tgl_FragColor = color;\n\t\n\t#ifdef FOG\n\t\tfloat lerpFact = clamp((1.0 / gl_FragCoord.w - u_FogStart) / u_FogRange, 0.0, 1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.0), lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, u_FogColor, lerpFact);\n\t\t#endif\n\t#endif\n}\n\n"},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n#include "Lighting.glsl";\n#include "LayaUtile.glsl";\n\nattribute vec4 a_Position;\nattribute vec4 a_Color;\nattribute vec2 a_Texcoord0;\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_MvpMatrix;\n#else\n\tuniform mat4 u_MvpMatrix;\n#endif\n\n#ifdef COLOR\n\tvarying vec4 v_Color;\n#endif\nvarying vec2 v_Texcoord0;\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n\nvoid main()\n{\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform;\n\t \t#ifdef SIMPLEBONE\n\t\t\tfloat currentPixelPos;\n\t\t\t#ifdef GPU_INSTANCE\n\t\t\t\tcurrentPixelPos = a_SimpleTextureParams.x+a_SimpleTextureParams.y;\n\t\t\t#else\n\t\t\t\tcurrentPixelPos = u_SimpleAnimatorParams.x+u_SimpleAnimatorParams.y;\n\t\t\t#endif\n\t\t\tfloat offset = 1.0/u_SimpleAnimatorTextureSize;\n\t\t\tskinTransform =  loadMatFromTexture(currentPixelPos,int(a_BoneIndices.x),offset) * a_BoneWeights.x;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.y),offset) * a_BoneWeights.y;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.z),offset) * a_BoneWeights.z;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.w),offset) * a_BoneWeights.w;\n\t\t#else\n\t\t\tskinTransform =  u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\t#endif\n\t\tposition=skinTransform*a_Position;\n\t #else\n\t\tposition=a_Position;\n\t#endif\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\t\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\n\t#else\n\t\tv_Texcoord0=a_Texcoord0;\n\t#endif\n\t\t\n\t#ifdef COLOR\n\t\tv_Color = a_Color;\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n}'},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Lighting.glsl";\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_Normal;\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#ifdef LEGACYSINGLELIGHTING\n\t\t#ifdef DIRECTIONLIGHT\n\t\t\tuniform DirectionLight u_DirectionLight;\n\t\t#endif\n\t\t#ifdef POINTLIGHT\n\t\t\tuniform PointLight u_PointLight;\n\t\t#endif\n\t\t#ifdef SPOTLIGHT\n\t\t\tuniform SpotLight u_SpotLight;\n\t\t#endif\n\t#else\n\t\tuniform mat4 u_View;\n\t\tuniform vec4 u_ProjectionParams;\n\t\tuniform vec4 u_Viewport;\n\t\tuniform int u_DirationLightCount;\n\t\tuniform sampler2D u_LightBuffer;\n\t\tuniform sampler2D u_LightClusterBuffer;\n\t#endif\n#endif\n\n#include "Shadow.glsl"\n#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\tvarying vec4 v_ShadowCoord;\n#endif\nvarying float v_posViewZ;\n\nuniform vec3 u_AmbientColor;\n\nuniform sampler2D u_SplatAlphaTexture;\n\nuniform sampler2D u_DiffuseTexture1;\nuniform sampler2D u_DiffuseTexture2;\nuniform sampler2D u_DiffuseTexture3;\nuniform sampler2D u_DiffuseTexture4;\nuniform sampler2D u_DiffuseTexture5;\n\nuniform vec4 u_DiffuseScaleOffset1;\nuniform vec4 u_DiffuseScaleOffset2;\nuniform vec4 u_DiffuseScaleOffset3;\nuniform vec4 u_DiffuseScaleOffset4;\nuniform vec4 u_DiffuseScaleOffset5;\n\nvarying vec2 v_Texcoord0;\n\n#ifdef LIGHTMAP\n\tuniform sampler2D u_LightMap;\n\tvarying vec2 v_LightMapUV;\n#endif\n\nvoid main()\n{\n\tvec4 splatAlpha = vec4(1.0);\n\t#ifdef ExtendTerrain_DETAIL_NUM1\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r;\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM2\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r + color2.xyz * (1.0 - splatAlpha.r);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM3\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * (1.0 - splatAlpha.r - splatAlpha.g);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM4\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord0 * u_DiffuseScaleOffset4.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * splatAlpha.b + color4.xyz * (1.0 - splatAlpha.r - splatAlpha.g - splatAlpha.b);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM5\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord0 * u_DiffuseScaleOffset4.xy);\n\t\tvec4 color5 = texture2D(u_DiffuseTexture5, v_Texcoord0 * u_DiffuseScaleOffset5.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * splatAlpha.b + color4.xyz * splatAlpha.a + color5.xyz * (1.0 - splatAlpha.r - splatAlpha.g - splatAlpha.b - splatAlpha.a);\n\t#endif\n\t\tgl_FragColor.w = splatAlpha.a;\n\t\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tvec3 normal = v_Normal;\n\t\tvec3 dif, spe;\n\t#endif\n\n\tvec3 diffuse = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n\t\tvec3 toEye;\n\t\t#ifdef FOG\n\t\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\t\tfloat toEyeLength=length(toEye);\n\t\t\ttoEye/=toEyeLength;\n\t\t#else\n\t\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t\t#endif\n\t#endif\n\n\t#ifdef LEGACYSINGLELIGHTING\n\t\t#ifdef DIRECTIONLIGHT\n\t\t\tLayaAirBlinnPhongDiectionLight(vec3(0.0),1.0,normal,vec3(1.0),toEye,u_DirectionLight,dif,spe);\n\t\t\tdiffuse+=dif;\n\t\t\tspecular+=spe;\n\t\t#endif\n\t\n\t\t#ifdef POINTLIGHT\n\t\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,vec3(0.0),1.0,normal,vec3(1.0),toEye,u_PointLight,dif,spe);\n\t\t\tdiffuse+=dif;\n\t\t\tspecular+=spe;\n\t\t#endif\n\n\t\t#ifdef SPOTLIGHT\n\t\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,vec3(0.0),1.0,normal,vec3(1.0),toEye,u_SpotLight,dif,spe);\n\t\t\tdiffuse+=dif;\n\t\t\tspecular+=spe;\n\t\t#endif\n\t#else\n\t\t#ifdef DIRECTIONLIGHT\n\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t{\n\t\t\t\tif(i >= u_DirationLightCount)\n\t\t\t\t\tbreak;\n\t\t\t\tDirectionLight directionLight = getDirectionLight(u_LightBuffer,i);\n\t\t\t\tLayaAirBlinnPhongDiectionLight(vec3(0.0),1.0,normal,vec3(1.0),toEye,directionLight,dif,spe);\n\t\t\t\tdiffuse+=dif;\n\t\t\t\tspecular+=spe;\n\t\t\t}\n\t\t#endif\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\t\tivec4 clusterInfo =getClusterInfo(u_LightClusterBuffer,u_View,u_Viewport, v_PositionWorld,gl_FragCoord,u_ProjectionParams);\n\t\t\t#ifdef POINTLIGHT\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t\t{\n\t\t\t\t\tif(i >= clusterInfo.x)//PointLightCount\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tPointLight pointLight = getPointLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\n\t\t\t\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,vec3(0.0),1.0,normal,vec3(1.0),toEye,pointLight,dif,spe);\n\t\t\t\t\tdiffuse+=dif;\n\t\t\t\t\tspecular+=spe;\n\t\t\t\t}\n\t\t\t#endif\n\t\t\t#ifdef SPOTLIGHT\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t\t{\n\t\t\t\t\tif(i >= clusterInfo.y)//SpotLightCount\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tSpotLight spotLight = getSpotLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\n\t\t\t\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,vec3(0.0),1.0,normal,vec3(1.0),toEye\t,spotLight,dif,spe);\n\t\t\t\t\tdiffuse+=dif;\n\t\t\t\t\tspecular+=spe;\n\t\t\t\t}\n\t\t\t#endif\n\t\t#endif\n\t#endif\n\nvec3 globalDiffuse = u_AmbientColor;\n#ifdef LIGHTMAP\n\tglobalDiffuse += decodeHDR(texture2D(u_LightMap, v_LightMapUV),5.0);\n#endif\n\n#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\tfloat shadowValue = shadowValue = sampleShadowmap(v_ShadowCoord);\n\tgl_FragColor = vec4(gl_FragColor.rgb * (globalDiffuse + diffuse) * shadowValue, gl_FragColor.a);\n#else\n\tgl_FragColor = vec4(gl_FragColor.rgb * (globalDiffuse + diffuse), gl_FragColor.a);\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\t\tgl_FragColor.rgb += specular * shadowValue;\n\t#else\n\t\tgl_FragColor.rgb += specular;\n\t#endif\n#endif\n\n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\n\n\n\n\n'},function(t,e,i){"use strict";e.a='#include "Lighting.glsl";\n\nattribute vec4 a_Position;\nattribute vec2 a_Texcoord0;\n\nuniform mat4 u_MvpMatrix;\n\nvarying vec2 v_Texcoord0;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(LIGHTMAP)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||(defined(CALCULATE_SHADOWS)&&defined(SHADOWMAP_PSSM1))\n\tuniform mat4 u_WorldMat;\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform vec4 u_LightmapScaleOffset;\n#endif\n\n#if defined(CALCULATE_SHADOWS)//shader���Զ���ĺ겻����ifdef ����ĳ�if defined\n\tvarying vec4 v_ShadowCoord;\n#endif\n\nvoid main()\n{\n\tgl_Position = u_MvpMatrix * a_Position;\n  \n\tv_Texcoord0 = a_Texcoord0;\n  \n\t#ifdef LIGHTMAP\n\t\tv_LightMapUV = vec2(a_Texcoord0.x, 1.0 - a_Texcoord0.y) * u_LightmapScaleOffset.xy + u_LightmapScaleOffset.zw;\n\t\tv_LightMapUV.y = 1.0 - v_LightMapUV.y;\n\t#endif\n  \n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tv_Normal = a_Normal;\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||(defined(CALCULATE_SHADOWS)&&defined(SHADOWMAP_PSSM1))\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n\n\t#if defined(CALCULATE_SHADOWS)//shader���Զ���ĺ겻����ifdef ����ĳ�if defined\n\t\tv_ShadowCoord = getShadowCoord(vec4(v_PositionWorld));\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n}'},function(t,e,i){"use strict";e.a='struct LayaGIInput\n{\n\tvec2 lightmapUV;\n\tvec3 worldPos;\n};\n\n#define LAYA_SPECCUBE_LOD_STEPS 6.0\n\nuniform vec3 u_AmbientColor;\n\n#if defined(GI_AMBIENT_SH)\n\tuniform vec4 u_AmbientSHAr;\n\tuniform vec4 u_AmbientSHAg;\n\tuniform vec4 u_AmbientSHAb;\n\tuniform vec4 u_AmbientSHBr;\n\tuniform vec4 u_AmbientSHBg;\n\tuniform vec4 u_AmbientSHBb;\n\tuniform vec4 u_AmbientSHC;\n#endif\n\nuniform samplerCube u_ReflectTexture;\nuniform vec4 u_ReflectCubeHDRParams;\n\n#ifdef SPECCUBE_BOX_PROJECTION\n\tuniform vec3 u_SpecCubeProbePosition;\n\tuniform vec3 u_SpecCubeBoxMax;\n\tuniform vec3 u_SpecCubeBoxMin;\n#endif\n\n\n#ifdef GI_AMBIENT_SH\n\tmediump vec3 shEvalLinearL0L1(mediump vec4 normal)\n\t{\n\t\tmediump vec3 x;\n\t\t// Linear (L1) + constant (L0) polynomial terms\n\t\tx.r = dot(u_AmbientSHAr, normal);\n\t\tx.g = dot(u_AmbientSHAg, normal);\n\t\tx.b = dot(u_AmbientSHAb, normal);\n\t\treturn x;\n\t}\n\n\tmediump vec3 shEvalLinearL2(mediump vec4 normal)\n\t{\n\t\tmediump vec3 x1,x2;\n\t\t// 4 of the quadratic (L2) polynomials\n\t\tmediump vec4 vB = normal.xyzz * normal.yzzx;\n\t\tx1.r = dot(u_AmbientSHBr, vB);\n\t\tx1.g = dot(u_AmbientSHBg, vB);\n\t\tx1.b = dot(u_AmbientSHBb, vB);\n\n\t\t// Final (5th) quadratic (L2) polynomial\n\t\tmediump float vC = normal.x*normal.x - normal.y*normal.y;\n\t\tx2 = u_AmbientSHC.rgb * vC;\n\n\t\treturn x1 + x2;\n\t}\n\t\n\tmediump vec3 shadeSHPerPixel(mediump vec3 normal)\n\t{\n\t\tmediump vec3 ambientContrib;\n\t\tmediump vec4 normalV4=vec4(-normal.x,normal.yz, 1.0);//Note:SH Data is left-hand,so x need inverse\n\t\tambientContrib = shEvalLinearL0L1(normalV4);\n\t\tambientContrib += shEvalLinearL2(normalV4);\n\t\tmediump vec3 ambient = max(vec3(0.0), ambientContrib);\n\t\tambient = layaLinearToGammaSpace(ambient);\n\t\treturn ambient;\n\t}\n#endif\n\n\n\n mediump vec3 BoxProjectedCubemapDirection(mediump vec3 worldRefl,mediump vec3 worldPos,mediump vec3 cubemapCenter,mediump vec3 boxMin,mediump vec3 boxMax){\n\t mediump vec3 nrdir = normalize(worldRefl);\n\t mediump vec3 rbmax = (boxMax - worldPos);\n\t mediump vec3 rbmin = (boxMin - worldPos);\n\t mediump vec3 select = step(vec3(0.0), worldRefl);\n\t mediump vec3 rbminmax = mix(rbmin, rbmax, select);\n\trbminmax = rbminmax / nrdir;\n\tmediump float scalar = min(min(rbminmax.x, rbminmax.y), rbminmax.z);\n\t mediump vec3 worldChangeRefl = nrdir * scalar + (worldPos - cubemapCenter);\n\treturn worldChangeRefl;\n}\n\n\nmediump vec3 layaDecodeDirectionalLightmap (mediump vec3 color, lowp vec4 dirTex, mediump vec3 normalWorld)\n{\n    // In directional (non-specular) mode Enlighten bakes dominant light direction\n    // in a way, that using it for half Lambert and then dividing by a "rebalancing coefficient"\n    // gives a result close to plain diffuse response lightmaps, but normalmapped.\n\n    // Note that dir is not unit length on purpose. Its length is "directionality", like\n    // for the directional specular lightmaps.\n\tlowp vec3 directional=dirTex.xyz - 0.5;\n\tdirectional.x=-directional.x;//NOTE:because coord System\n    mediump float halfLambert = dot(normalWorld,directional) + 0.5;\n\n    return color * halfLambert / max(1e-4, dirTex.w);\n}\n\nvec3 layaGIBase(LayaGIInput giInput,mediump float occlusion, mediump vec3 normalWorld)\n{\n\tvec3 indirectDiffuse;\n\t#ifdef LIGHTMAP\t\n\t\tmediump vec3 bakedColor =decodeHDR(texture2D(u_LightMap, giInput.lightmapUV),5.0);\n\t\t#ifdef LIGHTMAP_DIRECTIONAL\n\t\t\tlowp vec4 bakedDirTex = texture2D (u_LightMapDirection, giInput.lightmapUV);\n            indirectDiffuse = layaDecodeDirectionalLightmap (bakedColor, bakedDirTex, normalWorld);\n\t\t#else //unDirectional lightmap\n\t\t\tindirectDiffuse = bakedColor;\n\t\t#endif\n\t#else\n\t\t#ifdef GI_AMBIENT_SH\n\t\t\tindirectDiffuse = shadeSHPerPixel(normalWorld);\n\t\t#else\n\t\t\tindirectDiffuse = u_AmbientColor; //already in gamma space\n\t\t#endif\n\t#endif\n\n\tindirectDiffuse*=occlusion;\n\treturn indirectDiffuse;\n}\n\nmediump vec3 layaGlossyEnvironment(mediump vec4 glossIn)\n{\n\tmediump float perceptualRoughness = glossIn.a;\n\n\t// use approximation to solve,below is more reasonable,but maybe slow. \n\t// float m = perceptualRoughnessToRoughness(perceptualRoughness); // m is the real roughness parameter\n    // const float fEps = 1.192092896e-07F;        // smallest such that 1.0+FLT_EPSILON != 1.0  (+1e-4h is NOT good here. is visibly very wrong)\n    // float n =  (2.0/max(fEps, m*m))-2.0;        // remap to spec power. See eq. 21 in --\x3e https://dl.dropboxusercontent.com/u/55891920/papers/mm_brdf.pdf\n    // n /= 4;                                     // remap from n_dot_h formulatino to n_dot_r. See section "Pre-convolved Cube Maps vs Path Tracers" --\x3e https://s3.amazonaws.com/docs.knaldtech.com/knald/1.0.0/lys_power_drops.html\n    // perceptualRoughness = pow( 2/(n+2), 0.25);  // remap back to square root of real roughness (0.25 include both the sqrt root of the conversion and sqrt for going from roughness to perceptualRoughness)\n\tperceptualRoughness = perceptualRoughness * (1.7 - 0.7*perceptualRoughness);//just a approximation,but fast.\n \n\tmediump float mip = perceptualRoughness * LAYA_SPECCUBE_LOD_STEPS;\n\tmediump vec3 uvw = glossIn.rgb;\n\tuvw.x=-uvw.x;//Note:reflectCube is left-hand,so x need inverse\n\tmediump vec4 rgbm=textureCubeLodEXT(u_ReflectTexture,uvw,mip);\n\treturn decodeHDR(rgbm,u_ReflectCubeHDRParams.x);\n}\n\nmediump vec3 layaGIIndirectSpecular(LayaGIInput giInput,mediump float occlusion, vec4 glossIn)\n{\n\t#ifdef SPECCUBE_BOX_PROJECTION\n\t\tvec3 originalReflUVW = glossIn.xyz;\n\t\tglossIn.xyz =BoxProjectedCubemapDirection(originalReflUVW,giInput.worldPos,u_SpecCubeProbePosition,u_SpecCubeBoxMin,u_SpecCubeBoxMax);\n\t#endif\n\tmediump vec3 specular = layaGlossyEnvironment(glossIn);\n\treturn specular * occlusion;\n}\n\n\nLayaGI layaGlobalIllumination(LayaGIInput giInput,mediump float occlusion, mediump vec3 normalWorld,mediump vec4 uvwRoughness)\n{\n\tLayaGI gi;\n\tgi.diffuse = layaGIBase(giInput,occlusion, normalWorld);\n\tgi.specular = layaGIIndirectSpecular(giInput,occlusion, uvwRoughness);\n\treturn gi;\n}\n\n\n'},function(t,e,i){"use strict";e.a="#ifdef GRAPHICS_API_GLES3\n\t#define INVERSE_MAT(mat) inverse(mat)\n#else\n\t#define INVERSE_MAT(mat) inverseMat(mat)\n#endif\n\nstruct DirectionLight {\n\tvec3 color;\n\tvec3 direction;\n};\n\nstruct PointLight {\n\tvec3 color;\n\tvec3 position;\n\tfloat range;\n};\n\nstruct SpotLight {\n\tvec3 color;\n\tvec3 position;\n\tfloat range;\n\tvec3 direction;\n\tfloat spot;\n};\n\nstruct LayaGI{\n\tvec3 diffuse;\n\tvec3 specular;\n};\n\nstruct LayaLight{\n\tvec3 color;\n\tvec3 dir;\n};\n\nconst int c_ClusterBufferWidth = CLUSTER_X_COUNT*CLUSTER_Y_COUNT;\nconst int c_ClusterBufferHeight = CLUSTER_Z_COUNT*(1+int(ceil(float(MAX_LIGHT_COUNT_PER_CLUSTER)/4.0)));\nconst int c_ClusterBufferFloatWidth = c_ClusterBufferWidth*4;\n\n#ifndef GRAPHICS_API_GLES3\n\tmat3 inverseMat(mat3 m) {\n\t\tfloat a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n\t\tfloat a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n\t\tfloat a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n\t\tfloat b01 = a22 * a11 - a12 * a21;\n\t\tfloat b11 = -a22 * a10 + a12 * a20;\n\t\tfloat b21 = a21 * a10 - a11 * a20;\n\n\t\tfloat det = a00 * b01 + a01 * b11 + a02 * b21;\n\n\t\treturn mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n\t\t\t\t\tb11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n\t\t\t\t\tb21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n\t}\n#endif\n\nivec4 getClusterInfo(sampler2D clusterBuffer,mat4 viewMatrix,vec4 viewport,vec3 position,vec4 fragCoord,vec4 projectParams)\n{\n\tvec3 viewPos = vec3(viewMatrix*vec4(position, 1.0)); //position in viewspace\n\n\tint clusterXIndex = int(floor(fragCoord.x/ (float(viewport.z)/float(CLUSTER_X_COUNT))));\n    int clusterYIndex = int(floor((viewport.w * (projectParams.z <0.0? 0.0 : 1.0) - fragCoord.y * projectParams.z)/ (float(viewport.w)/float(CLUSTER_Y_COUNT))));//Maybe Flipped ProjectMatrix\n\tfloat zSliceParam =float(CLUSTER_Z_COUNT)/log2(projectParams.y / projectParams.x);\n \tint clusterZIndex = int(floor(log2(-viewPos.z) * zSliceParam- log2(projectParams.x) * zSliceParam));//projectParams x:cameraNear y:cameraFar\n\n\tvec2 uv= vec2((float(clusterXIndex + clusterYIndex * CLUSTER_X_COUNT)+0.5)/float(c_ClusterBufferWidth),\n\t\t\t\t(float(clusterZIndex)+0.5)/float(c_ClusterBufferHeight));\n\tvec4 clusterPixel=texture2D(clusterBuffer, uv);\n\treturn ivec4(clusterPixel);//X:Point Count Y:Spot Count Z、W:Light Offset\n}\n\n\nint getLightIndex(sampler2D clusterBuffer,int offset,int index) \n{\n\tint totalOffset=offset+index;\n\tint row=totalOffset/c_ClusterBufferFloatWidth;\n\tint lastRowFloat=totalOffset-row*c_ClusterBufferFloatWidth;\n\tint col=lastRowFloat/4;\n\tvec2 uv=vec2((float(col)+0.5)/float(c_ClusterBufferWidth),\n\t\t\t\t(float(row)+0.5)/float(c_ClusterBufferHeight));\n\tvec4 texel = texture2D(clusterBuffer, uv);\n    int pixelComponent = lastRowFloat-col*4;\n    if (pixelComponent == 0) \n      return int(texel.x);\n    else if (pixelComponent == 1) \n      return int(texel.y);\n    else if (pixelComponent == 2) \n      return int(texel.z);\n    else //pixelComponent==3\n      return int(texel.w);\n}\n\nDirectionLight getDirectionLight(sampler2D lightBuffer,int index) \n{\n    DirectionLight light;\n    float v = (float(index)+0.5)/ float(MAX_LIGHT_COUNT);\n    vec4 p1 = texture2D(lightBuffer, vec2(0.125,v));\n    vec4 p2 = texture2D(lightBuffer, vec2(0.375,v));\n\tlight.color=p1.rgb;\n    light.direction = p2.rgb;\n    return light;\n}\n\nPointLight getPointLight(sampler2D lightBuffer,sampler2D clusterBuffer,ivec4 clusterInfo,int index) \n{\n    PointLight light;\n\tint pointIndex=getLightIndex(clusterBuffer,clusterInfo.z*c_ClusterBufferFloatWidth+clusterInfo.w,index);\n    float v = (float(pointIndex)+0.5)/ float(MAX_LIGHT_COUNT);\n    vec4 p1 = texture2D(lightBuffer, vec2(0.125,v));\n    vec4 p2 = texture2D(lightBuffer, vec2(0.375,v));\n\tlight.color=p1.rgb;\n\tlight.range = p1.a;\n    light.position = p2.rgb;\n    return light;\n}\n\nSpotLight getSpotLight(sampler2D lightBuffer,sampler2D clusterBuffer,ivec4 clusterInfo,int index) \n{\n    SpotLight light;\n\tint spoIndex=getLightIndex(clusterBuffer,clusterInfo.z*c_ClusterBufferFloatWidth+clusterInfo.w,clusterInfo.x+index);\n    float v = (float(spoIndex)+0.5)/ float(MAX_LIGHT_COUNT);\n    vec4 p1 = texture2D(lightBuffer, vec2(0.125,v));\n    vec4 p2 = texture2D(lightBuffer, vec2(0.375,v));\n\tvec4 p3 = texture2D(lightBuffer, vec2(0.625,v));\n    light.color = p1.rgb;\n\tlight.range=p1.a;\n    light.position = p2.rgb;\n\tlight.spot = p2.a;\n\tlight.direction = p3.rgb;\n    return light;\n}\n\n// Laya中使用衰减纹理\nfloat LayaAttenuation(in vec3 L,in float invLightRadius) {\n\tfloat fRatio = clamp(length(L) * invLightRadius,0.0,1.0);\n\tfRatio *= fRatio;\n\treturn 1.0 / (1.0 + 25.0 * fRatio)* clamp(4.0*(1.0 - fRatio),0.0,1.0); //fade to black as if 4 pixel texture\n}\n\n// Same as Just Cause 2 and Crysis 2 (you can read GPU Pro 1 book for more information)\nfloat BasicAttenuation(in vec3 L,in float invLightRadius) {\n\tvec3 distance = L * invLightRadius;\n\tfloat attenuation = clamp(1.0 - dot(distance, distance),0.0,1.0); // Equals float attenuation = saturate(1.0f - dot(L, L) / (lightRadius *  lightRadius));\n\treturn attenuation * attenuation;\n}\n\n// Inspired on http://fools.slindev.com/viewtopic.php?f=11&t=21&view=unread#unread\nfloat NaturalAttenuation(in vec3 L,in float invLightRadius) {\n\tfloat attenuationFactor = 30.0;\n\tvec3 distance = L * invLightRadius;\n\tfloat attenuation = dot(distance, distance); // Equals float attenuation = dot(L, L) / (lightRadius *  lightRadius);\n\tattenuation = 1.0 / (attenuation * attenuationFactor + 1.0);\n\t// Second we move down the function therewith it reaches zero at abscissa 1:\n\tattenuationFactor = 1.0 / (attenuationFactor + 1.0); //attenuationFactor contains now the value we have to subtract\n\tattenuation = max(attenuation - attenuationFactor, 0.0); // The max fixes a bug.\n\t// Finally we expand the equation along the y-axis so that it starts with a function value of 1 again.\n\tattenuation /= 1.0 - attenuationFactor;\n\treturn attenuation;\n}\n\nvoid LayaAirBlinnPhongLight (in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir,in vec3 lightColor, in vec3 lightVec,out vec3 diffuseColor,out vec3 specularColor) {\n\tmediump vec3 h = normalize(viewDir-lightVec);\n\tlowp float ln = max (0.0, dot (-lightVec,normal));\n\tfloat nh = max (0.0, dot (h,normal));\n\tdiffuseColor=lightColor * ln;\n\tspecularColor=lightColor *specColor*pow (nh, specColorIntensity*128.0) * gloss;\n}\n\nvoid LayaAirBlinnPhongDiectionLight (in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in DirectionLight light,out vec3 diffuseColor,out vec3 specularColor) {\n\tvec3 lightVec=normalize(light.direction);\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.color,lightVec,diffuseColor,specularColor);\n}\n\nvoid LayaAirBlinnPhongPointLight (in vec3 pos,in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in PointLight light,out vec3 diffuseColor,out vec3 specularColor) {\n\tvec3 lightVec =  pos-light.position;\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.color,lightVec/length(lightVec),diffuseColor,specularColor);\n\tfloat attenuate = LayaAttenuation(lightVec, 1.0/light.range);\n\tdiffuseColor *= attenuate;\n\tspecularColor*= attenuate;\n}\n\nvoid LayaAirBlinnPhongSpotLight (in vec3 pos,in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in SpotLight light,out vec3 diffuseColor,out vec3 specularColor) {\n\tvec3 lightVec =  pos-light.position;\n\tvec3 normalLightVec=lightVec/length(lightVec);\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.color,normalLightVec,diffuseColor,specularColor);\n\tvec2 cosAngles=cos(vec2(light.spot,light.spot*0.5)*0.5);//ConeAttenuation\n\tfloat dl=dot(normalize(light.direction),normalLightVec);\n\tdl*=smoothstep(cosAngles[0],cosAngles[1],dl);\n\tfloat attenuate = LayaAttenuation(lightVec, 1.0/light.range)*dl;\n\tdiffuseColor *=attenuate;\n\tspecularColor *=attenuate;\n}\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent,vec3 binormal) {\n\tvec3 normalT =vec3(2.0*normalMapSample.x - 1.0,1.0-2.0*normalMapSample.y,2.0*normalMapSample.z - 1.0);\n\tmediump vec3 N = unitNormal;\n\tmediump vec3 T = tangent;\n\tmediump vec3 B = binormal;\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal =normalize(TBN*normalT);\n\treturn bumpedNormal;\n}\n\nvec3 NormalSampleToWorldSpace1(vec4 normalMapSample, vec3 tangent, vec3 binormal, vec3 unitNormal) {\n\tvec3 normalT;\n\tnormalT.x = 2.0 * normalMapSample.x - 1.0;\n\tnormalT.y = 1.0 - 2.0 * normalMapSample.y;\n\tnormalT.z = sqrt(1.0 - clamp(dot(normalT.xy, normalT.xy), 0.0, 1.0));\n\n\tvec3 T = normalize(tangent);\n\tvec3 B = normalize(binormal);\n\tvec3 N = normalize(unitNormal);\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN * normalize(normalT);\n\n\treturn bumpedNormal;\n}\n\nvec3 DecodeLightmap(vec4 color) {\n\treturn color.rgb*color.a*5.0;\n}\n\nvec3 decodeHDR(vec4 color,float range) {\n\treturn color.rgb*color.a*range;\n}\n\nvec2 TransformUV(vec2 texcoord,vec4 tilingOffset) {\n\tvec2 transTexcoord=vec2(texcoord.x,texcoord.y-1.0)*tilingOffset.xy+vec2(tilingOffset.z,-tilingOffset.w);\n\ttransTexcoord.y+=1.0;\n\treturn transTexcoord;\n}\n\nvec4 remapGLPositionZ(vec4 position) {\n\tposition.z=position.z * 2.0 - position.w;\n\treturn position;\n}\n\nmediump vec3 layaLinearToGammaSpace (mediump vec3 linRGB)\n{\n    linRGB = max(linRGB, vec3(0.0));\n    // An almost-perfect approximation from http://chilliant.blogspot.com.au/2012/08/srgb-approximations-for-hlsl.html?m=1\n    return max(1.055 * pow(linRGB,vec3(0.416666667)) - 0.055, 0.0);   \n}\n\nLayaLight layaDirectionLightToLight(in DirectionLight light,in float attenuate)\n{\n\tLayaLight relight;\n\trelight.color = light.color*attenuate;\n\trelight.dir = light.direction;\n\treturn relight;\n}\n\nLayaLight layaPointLightToLight(in vec3 pos,in vec3 normal, in PointLight light,in float attenuate)\n{\n\tLayaLight relight;\n\tvec3 lightVec =  pos-light.position;\n\tattenuate *= LayaAttenuation(lightVec, 1.0/light.range);\n\trelight.color = light.color*attenuate;\n\trelight.dir = normalize(lightVec);\n\treturn relight;\n}\n\nLayaLight layaSpotLightToLight(in vec3 pos,in vec3 normal, in SpotLight light,in float attenuate)\n{\n\tLayaLight relight;\n\tvec3 lightVec =  pos-light.position;\n\tvec3 normalLightVec=lightVec/length(lightVec);\n\tvec2 cosAngles=cos(vec2(light.spot,light.spot*0.5)*0.5);//ConeAttenuation\n\tfloat dl=dot(normalize(light.direction),normalLightVec);\n\tdl*=smoothstep(cosAngles[0],cosAngles[1],dl);\n\tattenuate *= LayaAttenuation(lightVec, 1.0/light.range)*dl;\n\trelight.dir = normalLightVec;\n\trelight.color = light.color*attenuate;\n\treturn relight;\n}\n\n\n\n\n"},function(t,e,i){"use strict";e.a='// ------------------------------------------------------------------\n//  PCF Filtering Tent Functions\n// ------------------------------------------------------------------\n\n// Assuming a isoceles right angled triangle of height "triangleHeight" (as drawn below).\n// This function return the area of the triangle above the first texel(in Y the first texel).\n//\n// |\\      <-- 45 degree slop isosceles right angled triangle\n// | \\\n// ----    <-- length of this side is "triangleHeight"\n// _ _ _ _ <-- texels\nfloat sampleShadowGetIRTriangleTexelArea(float triangleHeight)\n{\n    return triangleHeight - 0.5;\n}\n\n// Assuming a isoceles triangle of 1.5 texels height and 3 texels wide lying on 4 texels.\n// This function return the area of the triangle above each of those texels.\n//    |    <-- offset from -0.5 to 0.5, 0 meaning triangle is exactly in the center\n//   / \\   <-- 45 degree slop isosceles triangle (ie tent projected in 2D)\n//  /   \\\n// _ _ _ _ <-- texels\n// X Y Z W <-- result indices (in computedArea.xyzw and computedAreaUncut.xyzw)\n// Top point at (right,top) in a texel,left bottom point at (middle,middle) in a texel,right bottom point at (middle,middle) in a texel.\nvoid sampleShadowGetTexelAreasTent3x3(float offset, out vec4 computedArea, out vec4 computedAreaUncut)\n{\n    // Compute the exterior areas,a and h is same.\n    float a = offset + 0.5;\n    float offsetSquaredHalved = a * a * 0.5;\n    computedAreaUncut.x = computedArea.x = offsetSquaredHalved - offset;\n    computedAreaUncut.w = computedArea.w = offsetSquaredHalved;\n\n    // Compute the middle areas\n    // For Y : We find the area in Y of as if the left section of the isoceles triangle would\n    // intersect the axis between Y and Z (ie where offset = 0).\n    computedAreaUncut.y = sampleShadowGetIRTriangleTexelArea(1.5 - offset);\n    // This area is superior to the one we are looking for if (offset < 0) thus we need to\n    // subtract the area of the triangle defined by (0,1.5-offset), (0,1.5+offset), (-offset,1.5).\n    float clampedOffsetLeft = min(offset,0.0);\n    float areaOfSmallLeftTriangle = clampedOffsetLeft * clampedOffsetLeft;\n    computedArea.y = computedAreaUncut.y - areaOfSmallLeftTriangle;\n\n    // We do the same for the Z but with the right part of the isoceles triangle\n    computedAreaUncut.z = sampleShadowGetIRTriangleTexelArea(1.5 + offset);\n    float clampedOffsetRight = max(offset,0.0);\n    float areaOfSmallRightTriangle = clampedOffsetRight * clampedOffsetRight;\n    computedArea.z = computedAreaUncut.z - areaOfSmallRightTriangle;\n}\n\n// Assuming a isoceles triangle of 2.5 texel height and 5 texels wide lying on 6 texels.\n// This function return the weight of each texels area relative to the full triangle area.\n//  /       \\\n// _ _ _ _ _ _ <-- texels\n// 0 1 2 3 4 5 <-- computed area indices (in texelsWeights[])\n// Top point at (right,top) in a texel,left bottom point at (middle,middle) in a texel,right bottom point at (middle,middle) in a texel.\nvoid sampleShadowGetTexelWeightsTent5x5(float offset, out vec3 texelsWeightsA, out vec3 texelsWeightsB)\n{\n    vec4 areaFrom3texelTriangle;\n    vec4 areaUncutFrom3texelTriangle;\n    sampleShadowGetTexelAreasTent3x3(offset, areaFrom3texelTriangle, areaUncutFrom3texelTriangle);\n\n    // Triangle slope is 45 degree thus we can almost reuse the result of the 3 texel wide computation.\n    // the 5 texel wide triangle can be seen as the 3 texel wide one but shifted up by one unit/texel.\n    // 0.16 is 1/(the triangle area)\n    texelsWeightsA.x = 0.16 * (areaFrom3texelTriangle.x);\n    texelsWeightsA.y = 0.16 * (areaUncutFrom3texelTriangle.y);\n    texelsWeightsA.z = 0.16 * (areaFrom3texelTriangle.y + 1.0);\n    texelsWeightsB.x = 0.16 * (areaFrom3texelTriangle.z + 1.0);\n    texelsWeightsB.y = 0.16 * (areaUncutFrom3texelTriangle.z);\n    texelsWeightsB.z = 0.16 * (areaFrom3texelTriangle.w);\n}\n\n// 5x5 Tent filter (45 degree sloped triangles in U and V)\nvoid sampleShadowComputeSamplesTent5x5(vec4 shadowMapTextureTexelSize, vec2 coord, out float fetchesWeights[9], out vec2 fetchesUV[9])\n{\n    // tent base is 5x5 base thus covering from 25 to 36 texels, thus we need 9 bilinear PCF fetches\n    vec2 tentCenterInTexelSpace = coord.xy * shadowMapTextureTexelSize.zw;\n    vec2 centerOfFetchesInTexelSpace = floor(tentCenterInTexelSpace + 0.5);\n    vec2 offsetFromTentCenterToCenterOfFetches = tentCenterInTexelSpace - centerOfFetchesInTexelSpace;\n\n    // find the weight of each texel based on the area of a 45 degree slop tent above each of them.\n    vec3 texelsWeightsUA, texelsWeightsUB;\n    vec3 texelsWeightsVA, texelsWeightsVB;\n    sampleShadowGetTexelWeightsTent5x5(offsetFromTentCenterToCenterOfFetches.x, texelsWeightsUA, texelsWeightsUB);\n    sampleShadowGetTexelWeightsTent5x5(offsetFromTentCenterToCenterOfFetches.y, texelsWeightsVA, texelsWeightsVB);\n\n    // each fetch will cover a group of 2x2 texels, the weight of each group is the sum of the weights of the texels\n    vec3 fetchesWeightsU = vec3(texelsWeightsUA.xz, texelsWeightsUB.y) + vec3(texelsWeightsUA.y, texelsWeightsUB.xz);\n    vec3 fetchesWeightsV = vec3(texelsWeightsVA.xz, texelsWeightsVB.y) + vec3(texelsWeightsVA.y, texelsWeightsVB.xz);\n\n    // move the PCF bilinear fetches to respect texels weights\n    vec3 fetchesOffsetsU = vec3(texelsWeightsUA.y, texelsWeightsUB.xz) / fetchesWeightsU.xyz + vec3(-2.5,-0.5,1.5);\n    vec3 fetchesOffsetsV = vec3(texelsWeightsVA.y, texelsWeightsVB.xz) / fetchesWeightsV.xyz + vec3(-2.5,-0.5,1.5);\n    fetchesOffsetsU *= shadowMapTextureTexelSize.xxx;\n    fetchesOffsetsV *= shadowMapTextureTexelSize.yyy;\n\n    vec2 bilinearFetchOrigin = centerOfFetchesInTexelSpace * shadowMapTextureTexelSize.xy;\n    fetchesUV[0] = bilinearFetchOrigin + vec2(fetchesOffsetsU.x, fetchesOffsetsV.x);\n    fetchesUV[1] = bilinearFetchOrigin + vec2(fetchesOffsetsU.y, fetchesOffsetsV.x);\n    fetchesUV[2] = bilinearFetchOrigin + vec2(fetchesOffsetsU.z, fetchesOffsetsV.x);\n    fetchesUV[3] = bilinearFetchOrigin + vec2(fetchesOffsetsU.x, fetchesOffsetsV.y);\n    fetchesUV[4] = bilinearFetchOrigin + vec2(fetchesOffsetsU.y, fetchesOffsetsV.y);\n    fetchesUV[5] = bilinearFetchOrigin + vec2(fetchesOffsetsU.z, fetchesOffsetsV.y);\n    fetchesUV[6] = bilinearFetchOrigin + vec2(fetchesOffsetsU.x, fetchesOffsetsV.z);\n    fetchesUV[7] = bilinearFetchOrigin + vec2(fetchesOffsetsU.y, fetchesOffsetsV.z);\n    fetchesUV[8] = bilinearFetchOrigin + vec2(fetchesOffsetsU.z, fetchesOffsetsV.z);\n\n    fetchesWeights[0] = fetchesWeightsU.x * fetchesWeightsV.x;\n    fetchesWeights[1] = fetchesWeightsU.y * fetchesWeightsV.x;\n    fetchesWeights[2] = fetchesWeightsU.z * fetchesWeightsV.x;\n    fetchesWeights[3] = fetchesWeightsU.x * fetchesWeightsV.y;\n    fetchesWeights[4] = fetchesWeightsU.y * fetchesWeightsV.y;\n    fetchesWeights[5] = fetchesWeightsU.z * fetchesWeightsV.y;\n    fetchesWeights[6] = fetchesWeightsU.x * fetchesWeightsV.z;\n    fetchesWeights[7] = fetchesWeightsU.y * fetchesWeightsV.z;\n    fetchesWeights[8] = fetchesWeightsU.z * fetchesWeightsV.z;\n}'},function(t,e,i){"use strict";e.a="\n\n//SimpleSkinnedMesh\n#ifdef SIMPLEBONE\n\t#ifdef GPU_INSTANCE\n\t\tattribute vec4 a_SimpleTextureParams;\n\t#else\n\t\tuniform vec4 u_SimpleAnimatorParams;\n\t#endif\n\tuniform sampler2D u_SimpleAnimatorTexture;\n\n\tuniform float u_SimpleAnimatorTextureSize; \n#endif\n\n\n#ifdef SIMPLEBONE\n\tmat4 loadMatFromTexture(float FramePos,int boneIndices,float offset)\n\t{\n\t\tvec2 uv;\n\t\tfloat PixelPos = FramePos+float(boneIndices)*4.0;\n\t\tfloat halfOffset = offset * 0.5;\n\t\tfloat uvoffset = PixelPos/u_SimpleAnimatorTextureSize;\n\t\tuv.y = floor(uvoffset)*offset+halfOffset;\n\t\tuv.x = mod(float(PixelPos),u_SimpleAnimatorTextureSize)*offset+halfOffset;\n\t\tvec4 mat0row = texture2D(u_SimpleAnimatorTexture,uv);\n\t\tuv.x+=offset;\n\t\tvec4 mat1row = texture2D(u_SimpleAnimatorTexture,uv);\n\t\tuv.x+=offset;\n\t\tvec4 mat2row = texture2D(u_SimpleAnimatorTexture,uv);\n\t\tuv.x+=offset;\n\t\tvec4 mat3row = texture2D(u_SimpleAnimatorTexture,uv);\n\t\tmat4 m =mat4(mat0row.x,mat0row.y,mat0row.z,mat0row.w,\n\t\t\t\tmat1row.x,mat1row.y,mat1row.z,mat1row.w,\n\t\t\t\tmat2row.x,mat2row.y,mat2row.z,mat2row.w,\n\t\t\t\tmat3row.x,mat3row.y,mat3row.z,mat3row.w);\n\t\treturn m;\n\t}\n#endif\n\n"},function(t,e,i){"use strict";e.a="#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_Color;\nuniform vec4 u_Color;\n\nvoid main()\n{\n  gl_FragColor = v_Color * u_Color; \n}\n\n"},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "Lighting.glsl";\n\nattribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\nuniform vec4 u_Color;\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n\n\nvoid main()\n{\n\tgl_Position = u_MvpMatrix * a_Position;\n\tv_Color=a_Color*u_Color;\n\tgl_Position=remapGLPositionZ(gl_Position);\n}'},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n\tprecision highp int;\n#else\n\tprecision mediump float;\n\tprecision mediump int;\n#endif\n\n#include "Lighting.glsl";\n#include "Shadow.glsl"\n\nuniform vec4 u_DiffuseColor;\n\n#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\tvarying vec4 v_Color;\n#endif\n\n#ifdef ALPHATEST\n\tuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform sampler2D u_LightMap;\n#endif\n\nvarying vec3 v_Normal;\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvarying vec3 v_ViewDir; \n\n\tuniform vec3 u_MaterialSpecular;\n\tuniform float u_Shininess;\n\n\t#ifdef LEGACYSINGLELIGHTING\n\t\t#ifdef DIRECTIONLIGHT\n\t\t\tuniform DirectionLight u_DirectionLight;\n\t\t#endif\n\t\t#ifdef POINTLIGHT\n\t\t\tuniform PointLight u_PointLight;\n\t\t#endif\n\t\t#ifdef SPOTLIGHT\n\t\t\tuniform SpotLight u_SpotLight;\n\t\t#endif\n\t#else\n\t\tuniform mat4 u_View;\n\t\tuniform vec4 u_ProjectionParams;\n\t\tuniform vec4 u_Viewport;\n\t\tuniform int u_DirationLightCount;\n\t\tuniform sampler2D u_LightBuffer;\n\t\tuniform sampler2D u_LightClusterBuffer;\n\t#endif\n\n\t#ifdef SPECULARMAP \n\t\tuniform sampler2D u_SpecularTexture;\n\t#endif\n#endif\n\n#ifdef NORMALMAP \n\tuniform sampler2D u_NormalTexture;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\n\tvarying vec3 v_PositionWorld;\n#endif\n\n\n#include "GlobalIllumination.glsl";//"GlobalIllumination.glsl use uniform should at front of this\n\n#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\n\tvarying vec4 v_ShadowCoord;\n#endif\n\n#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\tvarying vec4 v_SpotShadowCoord;\n#endif\n\n\nvoid main()\n{\n\tvec3 normal;//light and SH maybe use normal\n\t#if defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent,v_Binormal));\n\t#else\n\t\tnormal = normalize(v_Normal);\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tvec3 viewDir= normalize(v_ViewDir);\n\t#endif\n\n\tLayaGIInput giInput;\n\t#ifdef LIGHTMAP\t\n\t\tgiInput.lightmapUV=v_LightMapUV;\n\t#endif\n\tvec3 globalDiffuse=layaGIBase(giInput,1.0,normal);\n\t\n\tvec4 mainColor=u_DiffuseColor;\n\t#ifdef DIFFUSEMAP\n\t\tvec4 difTexColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\t\tmainColor=mainColor*difTexColor;\n\t#endif \n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\t\tmainColor=mainColor*v_Color;\n\t#endif \n    \n\t#ifdef ALPHATEST\n\t\tif(mainColor.a<u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n  \n\t\n\tvec3 diffuse = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tvec3 dif,spe;\n\t\t#ifdef SPECULARMAP\n\t\t\tvec3 gloss=texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n\t\t#else\n\t\t\t#ifdef DIFFUSEMAP\n\t\t\t\tvec3 gloss=vec3(difTexColor.a);\n\t\t\t#else\n\t\t\t\tvec3 gloss=vec3(1.0);\n\t\t\t#endif\n\t\t#endif\n\t#endif\n\n\t\n\t\n\t#ifdef LEGACYSINGLELIGHTING\n\t\t#ifdef DIRECTIONLIGHT\n\t\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_DirectionLight,dif,spe);\n\t\t\t#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\t\t\t\t#ifdef SHADOW_CASCADE\n\t\t\t\t\tvec4 shadowCoord = getShadowCoord(vec4(v_PositionWorld,1.0));\n\t\t\t\t#else\n\t\t\t\t\tvec4 shadowCoord = v_ShadowCoord;\n\t\t\t\t#endif\n\t\t\t\tfloat shadowAttenuation=sampleShadowmap(shadowCoord);\n\t\t\t\tdif *= shadowAttenuation;\n\t\t\t\tspe *= shadowAttenuation;\n\t\t\t#endif\n\t\t\tdiffuse+=dif;\n\t\t\tspecular+=spe;\n\t\t#endif\n\t\n\t\t#ifdef POINTLIGHT\n\t\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_PointLight,dif,spe);\n\t\t\tdiffuse+=dif;\n\t\t\tspecular+=spe;\n\t\t#endif\n\n\t\t#ifdef SPOTLIGHT\n\t\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_SpotLight,dif,spe);\n\t\t\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\t\t\t\tvec4 spotShadowcoord = v_SpotShadowCoord;\n\t\t\t\tfloat spotShadowAttenuation = sampleSpotShadowmap(spotShadowcoord);\n\t\t\t\tdif *= spotShadowAttenuation;\n\t\t\t\tspe *= spotShadowAttenuation;\n\t\t\t#endif\n\t\t\tdiffuse+=dif;\n\t\t\tspecular+=spe;\n\t\t#endif\n\t#else\n\t\t#ifdef DIRECTIONLIGHT\n\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t{\n\t\t\t\tif(i >= u_DirationLightCount)\n\t\t\t\t\tbreak;\n\t\t\t\tDirectionLight directionLight = getDirectionLight(u_LightBuffer,i);\n\t\t\t\t#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\t\t\t\t\tif(i == 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t#ifdef SHADOW_CASCADE\n\t\t\t\t\t\t\tvec4 shadowCoord = getShadowCoord(vec4(v_PositionWorld,1.0));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tvec4 shadowCoord = v_ShadowCoord;\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\tdirectionLight.color *= sampleShadowmap(shadowCoord);\n\t\t\t\t\t}\n\t\t\t\t#endif\n\t\t\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,directionLight,dif,spe);\n\t\t\t\tdiffuse+=dif;\n\t\t\t\tspecular+=spe;\n\t\t\t}\n\t\t#endif\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\t\tivec4 clusterInfo =getClusterInfo(u_LightClusterBuffer,u_View,u_Viewport, v_PositionWorld,gl_FragCoord,u_ProjectionParams);\n\t\t\t#ifdef POINTLIGHT\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t\t{\n\t\t\t\t\tif(i >= clusterInfo.x)//PointLightCount\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tPointLight pointLight = getPointLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\n\t\t\t\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,pointLight,dif,spe);\n\t\t\t\t\tdiffuse+=dif;\n\t\t\t\t\tspecular+=spe;\n\t\t\t\t}\n\t\t\t#endif\n\t\t\t#ifdef SPOTLIGHT\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t\t{\n\t\t\t\t\tif(i >= clusterInfo.y)//SpotLightCount\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tSpotLight spotLight = getSpotLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\n\t\t\t\t\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\t\t\t\t\t\tif(i == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvec4 spotShadowcoord = v_SpotShadowCoord;\n\t\t\t\t\t\t\tspotLight.color *= sampleSpotShadowmap(spotShadowcoord);\n\t\t\t\t\t\t}\n\t\t\t\t\t#endif\n\t\t\t\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,spotLight,dif,spe);\n\t\t\t\t\tdiffuse+=dif;\n\t\t\t\t\tspecular+=spe;\n\t\t\t\t}\n\t\t\t#endif\n\t\t#endif\n\t#endif\n\n\tgl_FragColor =vec4(mainColor.rgb*(globalDiffuse + diffuse),mainColor.a);\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb+=specular;\n\t#endif\n\t  \n\t#ifdef FOG\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n}\n\n'},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n\tprecision highp int;\n#else\n\tprecision mediump float;\n\tprecision mediump int;\n#endif\n#include "Lighting.glsl";\n#include "LayaUtile.glsl"\n#include "Shadow.glsl";\n\n\nattribute vec4 a_Position;\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_MvpMatrix;\n#else\n\tuniform mat4 u_MvpMatrix;\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\n\tattribute vec2 a_Texcoord0;\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(LIGHTMAP)&&defined(UV1)\n\tattribute vec2 a_Texcoord1;\n#endif\n\n#ifdef LIGHTMAP\n\tuniform vec4 u_LightmapScaleOffset;\n\tvarying vec2 v_LightMapUV;\n#endif\n\n#ifdef COLOR\n\tattribute vec4 a_Color;\n\tvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nattribute vec3 a_Normal;\nvarying vec3 v_Normal; \n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_ViewDir; \n#endif\n\n#if defined(NORMALMAP)\n\tattribute vec4 a_Tangent0;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_WorldMat;\n#else\n\tuniform mat4 u_WorldMat;\n#endif\n\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\n\tvarying vec4 v_ShadowCoord;\n#endif\n\n#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\tvarying vec4 v_SpotShadowCoord;\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\n\n\nvoid main()\n{\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform;\n\t \t#ifdef SIMPLEBONE\n\t\t\tfloat currentPixelPos;\n\t\t\t#ifdef GPU_INSTANCE\n\t\t\t\tcurrentPixelPos = a_SimpleTextureParams.x+a_SimpleTextureParams.y;\n\t\t\t#else\n\t\t\t\tcurrentPixelPos = u_SimpleAnimatorParams.x+u_SimpleAnimatorParams.y;\n\t\t\t#endif\n\t\t\tfloat offset = 1.0/u_SimpleAnimatorTextureSize;\n\t\t\tskinTransform =  loadMatFromTexture(currentPixelPos,int(a_BoneIndices.x),offset) * a_BoneWeights.x;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.y),offset) * a_BoneWeights.y;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.z),offset) * a_BoneWeights.z;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.w),offset) * a_BoneWeights.w;\n\t\t#else\n\t\t\tskinTransform =  u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\t#endif\n\t\tposition=skinTransform*a_Position;\n\t #else\n\t\tposition=a_Position;\n\t#endif\n\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\t\n\tmat4 worldMat;\n\t#ifdef GPU_INSTANCE\n\t\tworldMat = a_WorldMat;\n\t#else\n\t\tworldMat = u_WorldMat;\n\t#endif\n\n\tmat3 worldInvMat;\n\t#ifdef BONE\n\t\tworldInvMat=INVERSE_MAT(mat3(worldMat*skinTransform));\n\t#else\n\t\tworldInvMat=INVERSE_MAT(mat3(worldMat));\n\t#endif  \n\tv_Normal=normalize(a_Normal*worldInvMat);\n\t#if defined(NORMALMAP)\n\t\tv_Tangent=normalize(a_Tangent0.xyz*worldInvMat);\n\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\n\t\tvec3 positionWS=(worldMat*position).xyz;\n\t\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\t\tv_ViewDir = u_CameraPos-positionWS;\n\t\t#endif\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\n\t\t\tv_PositionWorld = positionWS;\n\t\t#endif\n\t#endif\n\n\t#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\t\t#ifdef TILINGOFFSET\n\t\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\n\t\t#else\n\t\t\tv_Texcoord0=a_Texcoord0;\n\t\t#endif\n\t#endif\n\n\t#ifdef LIGHTMAP\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x,1.0-a_Texcoord1.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,1.0-a_Texcoord0.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t\tv_LightMapUV.y=1.0-v_LightMapUV.y;\n\t#endif\n\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\t\tv_Color=a_Color;\n\t#endif\n\n\t#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\n\t\tv_ShadowCoord =getShadowCoord(vec4(positionWS,1.0));\n\t#endif\n\n\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\t\tv_SpotShadowCoord = u_SpotViewProjectMatrix*vec4(positionWS,1.0);\n\t#endif\n\n\tgl_Position=remapGLPositionZ(gl_Position);\n}'},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n\tprecision highp int;\n#else\n\tprecision mediump float;\n\tprecision mediump int;\n#endif\n\n#include "ShadowCasterFS.glsl"\n\nvoid main()\n{\n\tgl_FragColor=shadowCasterFragment();\n}'},function(t,e,i){"use strict";e.a='#include "ShadowCasterVS.glsl"\n\nvoid main()\n{\n\tvec4 positionCS =  shadowCasterVertex();\n\tgl_Position=remapGLPositionZ(positionCS);\n}'},function(t,e,i){"use strict";e.a="#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\nuniform sampler2D u_texture;\nuniform vec4 u_Tintcolor;\n\n#ifdef RENDERMODE_MESH\n\tvarying vec4 v_MeshColor;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\nvoid main()\n{\t\n\t#ifdef RENDERMODE_MESH\n\t\tgl_FragColor=v_MeshColor;\n\t#else\n\t\tgl_FragColor=vec4(1.0);\t\n\t#endif\n\t\t\n\t#ifdef DIFFUSEMAP\n\t\t#ifdef TINTCOLOR\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*u_Tintcolor*2.0*v_Color;\n\t\t#else\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*v_Color;\n\t\t#endif\n\t#else\n\t\t#ifdef TINTCOLOR\n\t\t\tgl_FragColor*=u_Tintcolor*2.0*v_Color;\n\t\t#else\n\t\t\tgl_FragColor*=v_Color;\n\t\t#endif\n\t#endif\n\t\n\t#ifdef FOG\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t\t#endif\n\t#endif\n}"},function(t,e,i){"use strict";e.a='// #include "Lighting.glsl";\n\n//修改这里剔除没有用到的光照函数，增加粒子的编译速度\nvec2 TransformUV(vec2 texcoord,vec4 tilingOffset) {\n\tvec2 transTexcoord=vec2(texcoord.x,texcoord.y-1.0)*tilingOffset.xy+vec2(tilingOffset.z,-tilingOffset.w);\n\ttransTexcoord.y+=1.0;\n\treturn transTexcoord;\n}\n\nvec4 remapGLPositionZ(vec4 position) {\n\tposition.z=position.z * 2.0 - position.w;\n\treturn position;\n}\n\n#if defined(GL_FRAGMENT_PRECISION_HIGH)\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\n#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n\tattribute vec4 a_CornerTextureCoordinate;\n#endif\n#ifdef RENDERMODE_MESH\n\tattribute vec3 a_MeshPosition;\n\tattribute vec4 a_MeshColor;\n\tattribute vec2 a_MeshTextureCoordinate;\n\tvarying vec4 v_MeshColor;\n#endif\n\nattribute vec4 a_ShapePositionStartLifeTime;\nattribute vec4 a_DirectionTime;\nattribute vec4 a_StartColor;\nattribute vec3 a_StartSize;\nattribute vec3 a_StartRotation0;\nattribute float a_StartSpeed;\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n  attribute vec4 a_Random0;\n#endif\n#if defined(TEXTURESHEETANIMATIONRANDOMCURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  attribute vec4 a_Random1;\n#endif\nattribute vec3 a_SimulationWorldPostion;\nattribute vec4 a_SimulationWorldRotation;\n\nvarying vec4 v_Color;\n#ifdef DIFFUSEMAP\n\tvarying vec2 v_TextureCoordinate;\n#endif\n\nuniform float u_CurrentTime;\nuniform vec3 u_Gravity;\n\nuniform vec3 u_WorldPosition;\nuniform vec4 u_WorldRotation;\nuniform bool u_ThreeDStartRotation;\nuniform int u_ScalingMode;\nuniform vec3 u_PositionScale;\nuniform vec3 u_SizeScale;\nuniform mat4 u_View;\nuniform mat4 u_Projection;\n\n#ifdef STRETCHEDBILLBOARD\n\tuniform vec3 u_CameraPos;\n#endif\nuniform vec3 u_CameraDirection;//TODO:只有几种广告牌模式需要用\nuniform vec3 u_CameraUp;\n\nuniform  float u_StretchedBillboardLengthScale;\nuniform  float u_StretchedBillboardSpeedScale;\nuniform int u_SimulationSpace;\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  int  u_VOLSpaceType;\n#endif\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)\n  uniform  vec3 u_VOLVelocityConst;\n#endif\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  vec2 u_VOLVelocityGradientX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientZ[4];//x为key,y为速度\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n  uniform  vec3 u_VOLVelocityConstMax;\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n  uniform  vec2 u_VOLVelocityGradientMaxX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxZ[4];//x为key,y为速度\n#endif\n\n#ifdef COLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n#ifdef RANDOMCOLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n  uniform  vec4 u_MaxColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_MaxColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n\n\n#if defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMERANDOMCURVES)\n  uniform  vec2 u_SOLSizeGradient[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVES\n  uniform  vec2 u_SOLSizeGradientMax[4];//x为key,y为尺寸\n#endif\n#if defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\n  uniform  vec2 u_SOLSizeGradientX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientZ[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n  uniform  vec2 u_SOLSizeGradientMaxX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxZ[4];//x为key,y为尺寸\n#endif\n\n\n#ifdef ROTATIONOVERLIFETIME\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  float u_ROLAngularVelocityConst;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  float u_ROLAngularVelocityConstMax;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradient[4];//x为key,y为旋转\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMax[4];//x为key,y为旋转\n  #endif\n#endif\n#ifdef ROTATIONOVERLIFETIMESEPERATE\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  vec3 u_ROLAngularVelocityConstSeprarate;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  vec3 u_ROLAngularVelocityConstMaxSeprarate;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradientX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientZ[4];\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMaxX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxZ[4];\n\tuniform  vec2 u_ROLAngularVelocityGradientMaxW[4];\n  #endif\n#endif\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\n  uniform  float u_TSACycles;\n  uniform  vec2 u_TSASubUVLength;\n  uniform  vec2 u_TSAGradientUVs[4];//x为key,y为frame\n#endif\n#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n  uniform  vec2 u_TSAMaxGradientUVs[4];//x为key,y为frame\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvec3 rotationByEuler(in vec3 vector,in vec3 rot)\n{\n\tfloat halfRoll = rot.z * 0.5;\n    float halfPitch = rot.x * 0.5;\n\tfloat halfYaw = rot.y * 0.5;\n\n\tfloat sinRoll = sin(halfRoll);\n\tfloat cosRoll = cos(halfRoll);\n\tfloat sinPitch = sin(halfPitch);\n\tfloat cosPitch = cos(halfPitch);\n\tfloat sinYaw = sin(halfYaw);\n\tfloat cosYaw = cos(halfYaw);\n\n\tfloat quaX = (cosYaw * sinPitch * cosRoll) + (sinYaw * cosPitch * sinRoll);\n\tfloat quaY = (sinYaw * cosPitch * cosRoll) - (cosYaw * sinPitch * sinRoll);\n\tfloat quaZ = (cosYaw * cosPitch * sinRoll) - (sinYaw * sinPitch * cosRoll);\n\tfloat quaW = (cosYaw * cosPitch * cosRoll) + (sinYaw * sinPitch * sinRoll);\n\t\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n\t\n\tfloat x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n\tfloat xx = quaX * x;\n    float xy = quaX * y;\n\tfloat xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n\t\n}\n\n//假定axis已经归一化\nvec3 rotationByAxis(in vec3 vector,in vec3 axis, in float angle)\n{\n\tfloat halfAngle = angle * 0.5;\n\tfloat sin = sin(halfAngle);\n\t\n\tfloat quaX = axis.x * sin;\n\tfloat quaY = axis.y * sin;\n\tfloat quaZ = axis.z * sin;\n\tfloat quaW = cos(halfAngle);\n\t\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n\t\n\tfloat x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n\tfloat xx = quaX * x;\n    float xy = quaX * y;\n\tfloat xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n\t\n}\n\nvec3 rotationByQuaternions(in vec3 v,in vec4 q) \n{\n\treturn v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n}\n\n \n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\nfloat getCurValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n\tfloat curValue;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientNumber=gradientNumbers[i];\n\t\tfloat key=gradientNumber.x;\n\t\tif(key>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\n\t\t\tfloat lastKey=lastGradientNumber.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\tcurValue=mix(lastGradientNumber.y,gradientNumber.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn curValue;\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\nfloat getTotalValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n\tfloat totalValue=0.0;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientNumber=gradientNumbers[i];\n\t\tfloat key=gradientNumber.x;\n\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\n\t\tfloat lastValue=lastGradientNumber.y;\n\t\t\n\t\tif(key>=normalizedAge){\n\t\t\tfloat lastKey=lastGradientNumber.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\ttotalValue+=(lastValue+mix(lastValue,gradientNumber.y,age))/2.0*a_ShapePositionStartLifeTime.w*(normalizedAge-lastKey);\n\t\t\tbreak;\n\t\t}\n\t\telse{\n\t\t\ttotalValue+=(lastValue+gradientNumber.y)/2.0*a_ShapePositionStartLifeTime.w*(key-lastGradientNumber.x);\n\t\t}\n\t}\n\treturn totalValue;\n}\n#endif\n\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)\nvec4 getColorFromGradient(in vec2 gradientAlphas[4],in vec4 gradientColors[4],in float normalizedAge)\n{\n\tvec4 overTimeColor;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientAlpha=gradientAlphas[i];\n\t\tfloat alphaKey=gradientAlpha.x;\n\t\tif(alphaKey>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientAlpha=gradientAlphas[i-1];\n\t\t\tfloat lastAlphaKey=lastGradientAlpha.x;\n\t\t\tfloat age=(normalizedAge-lastAlphaKey)/(alphaKey-lastAlphaKey);\n\t\t\toverTimeColor.a=mix(lastGradientAlpha.y,gradientAlpha.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\t\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec4 gradientColor=gradientColors[i];\n\t\tfloat colorKey=gradientColor.x;\n\t\tif(colorKey>=normalizedAge)\n\t\t{\n\t\t\tvec4 lastGradientColor=gradientColors[i-1];\n\t\t\tfloat lastColorKey=lastGradientColor.x;\n\t\t\tfloat age=(normalizedAge-lastColorKey)/(colorKey-lastColorKey);\n\t\t\toverTimeColor.rgb=mix(gradientColors[i-1].yzw,gradientColor.yzw,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn overTimeColor;\n}\n#endif\n\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\nfloat getFrameFromGradient(in vec2 gradientFrames[4],in float normalizedAge)\n{\n\tfloat overTimeFrame;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientFrame=gradientFrames[i];\n\t\tfloat key=gradientFrame.x;\n\t\tif(key>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientFrame=gradientFrames[i-1];\n\t\t\tfloat lastKey=lastGradientFrame.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\toverTimeFrame=mix(lastGradientFrame.y,gradientFrame.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn floor(overTimeFrame);\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\nvec3 computeParticleLifeVelocity(in float normalizedAge)\n{\n  vec3 outLifeVelocity;\n  #ifdef VELOCITYOVERLIFETIMECONSTANT\n\t outLifeVelocity=u_VOLVelocityConst; \n  #endif\n  #ifdef VELOCITYOVERLIFETIMECURVE\n     outLifeVelocity= vec3(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n\t outLifeVelocity=mix(u_VOLVelocityConst,u_VOLVelocityConstMax,vec3(a_Random1.y,a_Random1.z,a_Random1.w)); \n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n     outLifeVelocity=vec3(mix(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y),\n\t                 mix(getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z),\n\t\t\t\t\t mix(getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n  #endif\n\t\t\t\t\t\n  return outLifeVelocity;\n} \n#endif\n\nvec3 computeParticlePosition(in vec3 startVelocity, in vec3 lifeVelocity,in float age,in float normalizedAge,vec3 gravityVelocity,vec4 worldRotation)\n{\n   vec3 startPosition;\n   vec3 lifePosition;\n   #if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t#ifdef VELOCITYOVERLIFETIMECONSTANT\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=lifeVelocity*age;\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMECURVE\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=vec3(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=lifeVelocity*age;\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=vec3(mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y)\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z)\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n\t#endif\n\t\n\tvec3 finalPosition;\n\tif(u_VOLSpaceType==0){\n\t  if(u_ScalingMode!=2)\n\t   finalPosition =rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition),worldRotation);\n\t  else\n\t   finalPosition =rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition,worldRotation);\n\t}\n\telse{\n\t  if(u_ScalingMode!=2)\n\t    finalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation)+lifePosition;\n\t  else\n\t    finalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation)+lifePosition;\n\t}\n  #else\n\t startPosition=startVelocity*age;\n\t vec3 finalPosition;\n\t if(u_ScalingMode!=2)\n\t\t\tfinalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation);\n\t else\n\t   \tfinalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation);\n  #endif\n  \n  if(u_SimulationSpace==0)\n    finalPosition=finalPosition+a_SimulationWorldPostion;\n  else if(u_SimulationSpace==1) \n    finalPosition=finalPosition+u_WorldPosition;\n  \n  finalPosition+=0.5*gravityVelocity*age;\n \n  return  finalPosition;\n}\n\n\nvec4 computeParticleColor(in vec4 color,in float normalizedAge)\n{\n\t#ifdef COLOROVERLIFETIME\n\t  color*=getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge);\n\t#endif\n\t\n\t#ifdef RANDOMCOLOROVERLIFETIME\n\t  color*=mix(getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge),getColorFromGradient(u_MaxColorOverLifeGradientAlphas,u_MaxColorOverLifeGradientColors,normalizedAge),a_Random0.y);\n\t#endif\n\n    return color;\n}\n\nvec2 computeParticleSizeBillbard(in vec2 size,in float normalizedAge)\n{\n\t#ifdef SIZEOVERLIFETIMECURVE\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n\t#endif\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\n\t\tsize*=vec2(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge));\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n\t    size*=vec2(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z));\n\t#endif\n\treturn size;\n}\n\n#ifdef RENDERMODE_MESH\nvec3 computeParticleSizeMesh(in vec3 size,in float normalizedAge)\n{\n\t#ifdef SIZEOVERLIFETIMECURVE\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n\t#endif\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\n\t\tsize*=vec3(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge));\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n\t    size*=vec3(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z)\n\t\t,mix(getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxZ,normalizedAge),a_Random0.z));\n\t#endif\n\treturn size;\n}\n#endif\n\nfloat computeParticleRotationFloat(in float rotation,in float age,in float normalizedAge)\n{ \n\t#ifdef ROTATIONOVERLIFETIME\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n\t\t#endif\n\t#endif\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConstSeprarate.z*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConstSeprarate.z,u_ROLAngularVelocityConstMaxSeprarate.z,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n\t\t#endif\n\t#endif\n\treturn rotation;\n}\n\n#if defined(RENDERMODE_MESH)&&(defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE))\nvec3 computeParticleRotationVec3(in vec3 rotation,in float age,in float normalizedAge)\n{ \n\t#ifdef ROTATIONOVERLIFETIME\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n\t\t#endif\n\t#endif\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tvec3 ageRot=u_ROLAngularVelocityConstSeprarate*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=vec3(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge));\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tvec3 ageRot=mix(u_ROLAngularVelocityConstSeprarate,u_ROLAngularVelocityConstMaxSeprarate,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=vec3(mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxX,normalizedAge),a_Random0.w)\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxY,normalizedAge),a_Random0.w)\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n\t\t#endif\n\t#endif\n\treturn rotation;\n}\n#endif\n\nvec2 computeParticleUV(in vec2 uv,in float normalizedAge)\n{ \n\t#ifdef TEXTURESHEETANIMATIONCURVE\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\n\t\tfloat frame=getFrameFromGradient(u_TSAGradientUVs,cycleNormalizedAge-floor(cycleNormalizedAge));\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\n\t\tfloat floorTotalULength=floor(totalULength);\n\t    uv.x+=totalULength-floorTotalULength;\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n\t#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\n\t\tfloat uvNormalizedAge=cycleNormalizedAge-floor(cycleNormalizedAge);\n\t    float frame=floor(mix(getFrameFromGradient(u_TSAGradientUVs,uvNormalizedAge),getFrameFromGradient(u_TSAMaxGradientUVs,uvNormalizedAge),a_Random1.x));\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\n\t\tfloat floorTotalULength=floor(totalULength);\n\t    uv.x+=totalULength-floorTotalULength;\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n\treturn uv;\n}\n\nvoid main()\n{\n\tfloat age = u_CurrentTime - a_DirectionTime.w;\n\tfloat normalizedAge = age/a_ShapePositionStartLifeTime.w;\n\tvec3 lifeVelocity;\n\tif(normalizedAge<1.0)\n\t{ \n\t\tvec3 startVelocity=a_DirectionTime.xyz*a_StartSpeed;\n\t\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t\t\tlifeVelocity= computeParticleLifeVelocity(normalizedAge);//计算粒子生命周期速度\n\t\t#endif \n\t\tvec3 gravityVelocity=u_Gravity*age;\n\t\t\n\t\tvec4 worldRotation;\n\t\tif(u_SimulationSpace==0)\n\t\t\tworldRotation=a_SimulationWorldRotation;\n\t\telse\n\t\t\tworldRotation=u_WorldRotation;\n\t\t\n\t\tvec3 center=computeParticlePosition(startVelocity, lifeVelocity, age, normalizedAge,gravityVelocity,worldRotation);//计算粒子位置\n\t\n\t\n\t\t#ifdef SPHERHBILLBOARD\n\t\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n\t\t\tvec3 cameraUpVector =normalize(u_CameraUp);//TODO:是否外面归一化\n\t\t\tvec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n\t\t\tvec3 upVector = normalize(cross(sideVector,u_CameraDirection));\n\t\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n\t\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,computeParticleRotationFloat(a_StartRotation0.z,age,normalizedAge));\n\t\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,rotation);\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\t\t\tfloat c = cos(rot);\n\t\t\t\t\tfloat s = sin(rot);\n\t\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\t\t\tcorner=rotation*corner;\n\t\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n\t\t\t\t}\n\t\t\t#else\n\t\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,a_StartRotation0);\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tfloat c = cos(a_StartRotation0.x);\n\t\t\t\t\tfloat s = sin(a_StartRotation0.x);\n\t\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\t\t\tcorner=rotation*corner;\n\t\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n\t\t\t\t}\n\t\t\t#endif\n\t\t#endif\n\t\n\t\t#ifdef STRETCHEDBILLBOARD\n\t\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n\t\t\tvec3 velocity;\n\t\t\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t\t\t\tif(u_VOLSpaceType==0)\n\t\t\t\tvelocity=rotationByQuaternions(u_SizeScale*(startVelocity+lifeVelocity),worldRotation)+gravityVelocity;\n\t\t\t\telse\n\t\t\t\tvelocity=rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+lifeVelocity+gravityVelocity;\n\t\t\t#else\n\t\t\t\tvelocity= rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+gravityVelocity;\n\t\t\t#endif\t\n\t\t\tvec3 cameraUpVector = normalize(velocity);\n\t\t\tvec3 direction = normalize(center-u_CameraPos);\n\t\t\tvec3 sideVector = normalize(cross(direction,normalize(velocity)));\n\t\t\t\n\t\t\tsideVector=u_SizeScale.xzy*sideVector;\n\t\t\tcameraUpVector=length(vec3(u_SizeScale.x,0.0,0.0))*cameraUpVector;\n\t\t\t\n\t\t\tvec2 size=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t\t\n\t\t\tconst mat2 rotaionZHalfPI=mat2(0.0, -1.0, 1.0, 0.0);\n\t\t\tcorner=rotaionZHalfPI*corner;\n\t\t\tcorner.y=corner.y-abs(corner.y);\n\t\t\t\n\t\t\tfloat speed=length(velocity);//TODO:\n\t\t\tcenter +=sign(u_SizeScale.x)*(sign(u_StretchedBillboardLengthScale)*size.x*corner.x*sideVector+(speed*u_StretchedBillboardSpeedScale+size.y*u_StretchedBillboardLengthScale)*corner.y*cameraUpVector);\n\t\t#endif\n\t\n\t\t#ifdef HORIZONTALBILLBOARD\n\t\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n\t\t\tconst vec3 cameraUpVector=vec3(0.0,0.0,1.0);\n\t\t\tconst vec3 sideVector = vec3(-1.0,0.0,0.0);\n\t\t\t\n\t\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\tfloat c = cos(rot);\n\t\t\tfloat s = sin(rot);\n\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\tcorner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n\t\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t\tcenter +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n\t\t#endif\n\t\n\t\t#ifdef VERTICALBILLBOARD\n\t\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n\t\t\tconst vec3 cameraUpVector =vec3(0.0,1.0,0.0);\n\t\t\tvec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n\t\t\t\n\t\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\tfloat c = cos(rot);\n\t\t\tfloat s = sin(rot);\n\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\tcorner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n\t\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t\tcenter +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n\t\t#endif\n\t\n\t\t#ifdef RENDERMODE_MESH\n\t\t\tvec3 size=computeParticleSizeMesh(a_StartSize,normalizedAge);\n\t\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n\t\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,computeParticleRotationFloat(a_StartRotation0.z, age,normalizedAge));\n\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,rotation),worldRotation);\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\t#ifdef ROTATIONOVERLIFETIME\n\t\t\t\t\t\tfloat angle=computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n\t\t\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),angle),worldRotation));//已验证\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse{\n\t\t\t\t\t\t\t#ifdef SHAPE\n\t\t\t\t\t\t\t\tcenter+= u_SizeScale.xzy*(rotationByQuaternions(rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),angle),worldRotation));\n\t\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\t\t\tcenter+=rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle);//已验证\n\t\t\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\t\t\tcenter+=rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle),worldRotation);//已验证\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t#endif\n\t\t\t\t\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t\t\t\t\t//TODO:是否应合并if(u_ThreeDStartRotation)分支代码,待测试\n\t\t\t\t\t\tvec3 angle=computeParticleRotationVec3(vec3(0.0,0.0,-a_StartRotation0.x), age,normalizedAge);\n\t\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByEuler(u_SizeScale*a_MeshPosition*size,vec3(angle.x,angle.y,angle.z)),worldRotation));//已验证\n\t\t\t\t\t#endif\t\t\n\t\t\t\t}\n\t\t\t#else\n\t\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,a_StartRotation0),worldRotation);//已验证\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x);\n\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\tcenter+= (rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x),worldRotation));//已验证\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\t#ifdef SHAPE\n\t\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\t\tcenter+= u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x);\n\t\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x),worldRotation);\t\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x);\n\t\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x),worldRotation);//已验证\n\t\t\t\t\t\t#endif\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t#endif\n\t\t\tv_MeshColor=a_MeshColor;\n\t\t#endif\n\t\n\t\tgl_Position=u_Projection*u_View*vec4(center,1.0);\n\t\tv_Color = computeParticleColor(a_StartColor, normalizedAge);\n\t\t#ifdef DIFFUSEMAP\n\t\t\t#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n\t\t\t\tv_TextureCoordinate =computeParticleUV(a_CornerTextureCoordinate.zw, normalizedAge);\n\t\t\t#endif\n\t\t\t#ifdef RENDERMODE_MESH\n\t\t\t\tv_TextureCoordinate =computeParticleUV(a_MeshTextureCoordinate, normalizedAge);\n\t\t\t#endif\n\t\t\t\n\t\t\t#ifdef TILINGOFFSET\n\t\t\t\tv_TextureCoordinate=TransformUV(v_TextureCoordinate,u_TilingOffset);\n\t\t\t#endif\n\t\t#endif\n   \t}\n   \telse\n\t{\n\t\tgl_Position=vec4(2.0,2.0,2.0,1.0);//Discard use out of X(-1,1),Y(-1,1),Z(0,1)\n\t}\n\tgl_Position=remapGLPositionZ(gl_Position);\n}\n\n'},function(t,e,i){"use strict";e.a='// allow to explicitly override LAYA_BRDF_GI and LAYA_BRDF_LIGHT in custom shader,default is layaBRDFHighGI and layaBRDFHighLight\n#if !defined (LAYA_BRDF_GI) \n\t#if defined(LAYA_PBR_BRDF_LOW)\n\t\t#define LAYA_BRDF_GI layaBRDFLowGI\n\t#elif defined(LAYA_PBR_BRDF_HIGH)\n\t\t#define LAYA_BRDF_GI layaBRDFHighGI\n\t#endif\n#endif\n#if !defined (LAYA_BRDF_LIGHT)\n\t#if defined(LAYA_PBR_BRDF_LOW)\n\t\t#define LAYA_BRDF_LIGHT layaBRDFLowLight\n\t#elif defined(LAYA_PBR_BRDF_HIGH)\n\t\t#define LAYA_BRDF_LIGHT layaBRDFHighLight\n\t#endif\n#endif\n\n#define PI 3.14159265359\n#define INV_PI 0.31830988618\n\nmediump float pow4(mediump float x)\n{\n\treturn x * x * x * x;\n}\n\nmediump float pow5(mediump float x)\n{\n\treturn x * x * x * x * x;\n}\n\nmediump vec3 fresnelLerp(mediump vec3 F0,mediump vec3 F90,mediump float cosA)\n{\n\tfloat t = pow5(1.0 - cosA);   // ala Schlick interpoliation\n\treturn mix(F0, F90, t);\n}\n\nmediump vec3 fresnelTerm(mediump vec3 F0,mediump float cosA)\n{\n\tfloat t = pow5(1.0 - cosA);   // ala Schlick interpoliation\n\treturn F0 + (vec3(1.0) - F0) * t;\n}\n\n// approximage Schlick with ^4 instead of ^5\nmediump vec3 fresnelLerpFast (mediump vec3 F0, mediump vec3 F90,mediump float cosA)\n{\n    mediump float t = pow4 (1.0 - cosA);\n    return mix (F0, F90, t);\n}\n\nfloat smoothnessToPerceptualRoughness(float smoothness)\n{\n    return 1.0 - smoothness;\n}\n\nfloat perceptualRoughnessToRoughness(float perceptualRoughness)\n{\n    return perceptualRoughness * perceptualRoughness;\n}\n\nvec3 safeNormalize(vec3 inVec)\n{\n\tfloat dp3 = max(0.001,dot(inVec,inVec));\n\treturn inVec * inversesqrt(dp3);\n}\n\n// Note: Disney diffuse must be multiply by diffuseAlbedo / PI. This is done outside of this function.\nmediump float disneyDiffuse(mediump float NdotV,mediump float NdotL,mediump float LdotH,mediump float perceptualRoughness)\n{\n\t//https://www.cnblogs.com/herenzhiming/articles/5790389.html\n\tmediump float fd90 = 0.5 + 2.0 * LdotH * LdotH * perceptualRoughness;\n\t// Two schlick fresnel term\n\tmediump float lightScatter = (1.0 + (fd90 - 1.0) * pow5(1.0 - NdotL));\n\tmediump float viewScatter = (1.0 + (fd90 - 1.0) * pow5(1.0 - NdotV));\n\n\treturn lightScatter * viewScatter;\n}\n\n// Ref: http://jcgt.org/published/0003/02/03/paper.pdf\nfloat smithJointGGXVisibilityTerm(float NdotL, float NdotV, float roughness)\n{\n\t// Original formulation:\n    // lambda_v    = (-1 + sqrt(a2 * (1 - NdotL2) / NdotL2 + 1)) * 0.5f;\n    // lambda_l    = (-1 + sqrt(a2 * (1 - NdotV2) / NdotV2 + 1)) * 0.5f;\n    // G           = 1 / (1 + lambda_v + lambda_l);\n\n\t// scientific code implement:\n\t// Reorder code to be more optimal\n    // half a          = roughness;\n    // half a2         = a * a;\n\n    // half lambdaV    = NdotL * sqrt((-NdotV * a2 + NdotV) * NdotV + a2);\n    // half lambdaL    = NdotV * sqrt((-NdotL * a2 + NdotL) * NdotL + a2);\n\n    // Simplify visibility term: (2.0f * NdotL * NdotV) /  ((4.0f * NdotL * NdotV) * (lambda_v + lambda_l + 1e-5f));\n    // return 0.5f / (lambdaV + lambdaL + 1e-5f);  \n\t// This function is not intended to be running on Mobile,therefore epsilon is smaller than can be represented by half\n\n\t// Approximation of the above formulation (simplify the sqrt, not mathematically correct but close enough)\n\tfloat a = roughness;\n\tfloat lambdaV = NdotL * (NdotV * (1.0 - a) + a);\n\tfloat lambdaL = NdotV * (NdotL * (1.0 - a) + a);\n\treturn 0.5 / (lambdaV + lambdaL + 1e-5);\n}\n\nfloat ggxTerm(float NdotH, float roughness)\n{\n\tfloat a2 = roughness * roughness;\n\tfloat d = (NdotH * a2 - NdotH) * NdotH + 1.0; // 2 mad\n\treturn INV_PI * a2 / (d * d + 1e-7); // This function is not intended to be running on Mobile,therefore epsilon is smaller than what can be represented by half//返回值小用half来返回\n}\n\n// BRDF1-------------------------------------------------------------------------------------\n\n// Note: BRDF entry points use smoothness and oneMinusReflectivity for optimization purposes,\n// mostly for DX9 SM2.0 level. Most of the math is being done on these (1-x) values, and that saves a few precious ALU slots.\n\n// Main Physically Based BRDF\n// Derived from Disney work and based on Torrance-Sparrow micro-facet model\n//\n// BRDF = kD / pi + kS * (D * V * F) / 4\n// I = BRDF * NdotL\n//\n// *NDF GGX:\n// *Smith for Visiblity term\n// *Schlick approximation for Fresnel\nmediump vec4 layaBRDFHighLight(mediump vec3 diffColor, mediump vec3 specColor, mediump float oneMinusReflectivity, float perceptualRoughness,float roughness,mediump float nv,vec3 normal, vec3 viewDir,LayaLight light)\n{\n\tvec3 halfDir = safeNormalize(viewDir-light.dir);\n\n\tfloat nl = clamp(dot(normal, -light.dir),0.0,1.0);\n\tfloat nh = clamp(dot(normal, halfDir),0.0,1.0);\n\tmediump float lv = clamp(dot(light.dir, viewDir),0.0,1.0);\n\tmediump float lh = clamp(dot(light.dir, -halfDir),0.0,1.0);\n\n\t// Diffuse term\n\tmediump float diffuseTerm = disneyDiffuse(nv, nl, lh, perceptualRoughness) * nl;\n\n\t// Specular term\n    // HACK: theoretically we should divide diffuseTerm by Pi and not multiply specularTerm!\n    // BUT that will make shader look significantly darker than Legacy ones\n\n\t// GGX with roughtness to 0 would mean no specular at all, using max(roughness, 0.002) here to match HDrenderloop roughtness remapping.\n\troughness = max(roughness, 0.002);\n\tfloat V = smithJointGGXVisibilityTerm(nl, nv, roughness);\n\tfloat D = ggxTerm(nh, roughness);\n\n\tfloat specularTerm = V * D * PI; // Torrance-Sparrow model, Fresnel is applied later\n\n\t//#ifdef LAYA_COLORSPACE_GAMMA\n\tspecularTerm = sqrt(max(1e-4, specularTerm));\n\t//#endif\n\tspecularTerm = max(0.0, specularTerm * nl);\n\t\t\n\tmediump vec3 color = diffColor * light.color * diffuseTerm + specularTerm * light.color * fresnelTerm(specColor, lh);\n\treturn vec4(color, 1.0);\n}\n\nvec4 layaBRDFHighGI(mediump vec3 diffColor,mediump vec3 specColor,mediump float oneMinusReflectivity,float smoothness ,float perceptualRoughness,float roughness,mediump float nv,vec3 normal, vec3 viewDir,LayaGI gi)\n{\n\t// surfaceReduction = Int D(NdotH) * NdotH * Id(NdotL>0) dH = 1/(roughness^2+1)\n\tfloat surfaceReduction;\n\tsurfaceReduction = 1.0 - 0.28*roughness*perceptualRoughness;// 1-0.28*x^3 as approximation for (1/(x^4+1))^(1/2.2) on the domain [0;1]\n\tfloat grazingTerm = clamp(smoothness + (1.0 - oneMinusReflectivity),0.0,1.0);\n\tmediump vec3 color =diffColor * gi.diffuse + surfaceReduction * gi.specular * fresnelLerp(specColor,vec3(grazingTerm), nv);\n\treturn vec4(color,1.0);\n}\n// BRDF1-------------------------------------------------------------------------------------\n\n\n// BRDF2-------------------------------------------------------------------------------------\n// Based on Minimalist CookTorrance BRDF\n// Implementation is slightly different from original derivation: http://www.thetenthplanet.de/archives/255\n//\n// *NDF [Modified] GGX:\n// *Modified Kelemen and Szirmay-​Kalos for Visibility term\n// *Fresnel approximated with 1/LdotH\nmediump vec4 layaBRDFLowLight (mediump vec3 diffColor, mediump vec3 specColor,mediump float oneMinusReflectivity,float perceptualRoughness,float roughness,mediump float nv,vec3 normal,vec3 viewDir,LayaLight light)\n{\n    vec3 halfDir = safeNormalize (viewDir-light.dir);\n    mediump float nl = clamp(dot(normal, -light.dir),0.0,1.0);\n    float nh = clamp(dot(normal, halfDir),0.0,1.0);\n    float lh = clamp(dot(-light.dir, halfDir),0.0,1.0);\n\n    // GGX Distribution multiplied by combined approximation of Visibility and Fresnel\n    // See "Optimizing PBR for Mobile" from Siggraph 2015 moving mobile graphics course\n    // https://community.arm.com/events/1155\n    mediump float a = roughness;\n    float a2 = a*a;\n\n    float d = nh * nh * (a2 - 1.0) + 1.00001;\n\t// #ifdef LAYA_COLORSPACE_GAMMA\n\t\t// Tighter approximation for Gamma only rendering mode!\n\t\t// DVF = sqrt(DVF);\n\t\t// DVF = (a * sqrt(.25)) / (max(sqrt(0.1), lh)*sqrt(roughness + .5) * d);\n\t\tfloat specularTerm = a / (max(0.32, lh) * (1.5 + roughness) * d);\n\t// #else\n\t// \tfloat specularTerm = a2 / (max(0.1f, lh*lh) * (roughness + 0.5f) * (d * d) * 4);\n\t// #endif\n\n    // on mobiles (where half actually means something) denominator have risk of overflow\n    // clamp below was added specifically to "fix" that, but dx compiler (we convert bytecode to metal/gles)\n    // sees that specularTerm have only non-negative terms, so it skips max(0,..) in clamp (leaving only min(100,...))\n\n\t//#if defined (SHADER_API_MOBILE)\n    specularTerm = specularTerm - 1e-4;\n\t//#endif\n\n\t// #else\n\t\t// // Legacy\n\t\t// half specularPower = PerceptualRoughnessToSpecPower(perceptualRoughness);\n\t\t// // Modified with approximate Visibility function that takes roughness into account\n\t\t// // Original ((n+1)*N.H^n) / (8*Pi * L.H^3) didn\'t take into account roughness\n\t\t// // and produced extremely bright specular at grazing angles\n\n\t\t// half invV = lh * lh * smoothness + perceptualRoughness * perceptualRoughness; // approx ModifiedKelemenVisibilityTerm(lh, perceptualRoughness);\n\t\t// half invF = lh;\n\n\t\t// half specularTerm = ((specularPower + 1) * pow (nh, specularPower)) / (8 * invV * invF + 1e-4h);\n\n\t\t// #ifdef LAYA_COLORSPACE_GAMMA\n\t\t// \tspecularTerm = sqrt(max(1e-4f, specularTerm));\n\t\t// #endif\n\t// #endif\n\n\t// #if defined (SHADER_API_MOBILE)\n\t\tspecularTerm = clamp(specularTerm, 0.0, 100.0); // Prevent FP16 overflow on mobiles\n\t// #endif\n    \n    mediump vec3 color = (diffColor + specularTerm * specColor) * light.color * nl;\n\n    return vec4(color, 1.0);\n}\n\nmediump vec4 layaBRDFLowGI (mediump vec3 diffColor, mediump vec3 specColor,mediump float oneMinusReflectivity,mediump float smoothness,float perceptualRoughness,float roughness,mediump float nv,vec3 normal,vec3 viewDir,LayaGI gi)\n{\n\t// surfaceReduction = Int D(NdotH) * NdotH * Id(NdotL>0) dH = 1/(realRoughness^2+1)\n\n    // 1-0.28*x^3 as approximation for (1/(x^4+1))^(1/2.2) on the domain [0;1]\n    // 1-x^3*(0.6-0.08*x)   approximation for 1/(x^4+1)\n\t// #ifdef LAYA_COLORSPACE_GAMMA\n\t\tmediump float surfaceReduction = 0.28;\n\t// #else\n\t\t// mediump float surfaceReduction = (0.6-0.08*perceptualRoughness);\n\t// #endif\n\n    surfaceReduction = 1.0 - roughness*perceptualRoughness*surfaceReduction;\n\n\tmediump float grazingTerm = clamp(smoothness + (1.0-oneMinusReflectivity),0.0,1.0);\n\tmediump vec3 color =gi.diffuse * diffColor+ surfaceReduction * gi.specular * fresnelLerpFast (specColor, vec3(grazingTerm), nv);\n\n    return vec4(color, 1.0);\n}\n// BRDF2-------------------------------------------------------------------------------------'},function(t,e,i){"use strict";e.a="struct FragmentCommonData{\n\tvec3 diffColor;\n\tvec3 specColor;\n\tfloat oneMinusReflectivity;\n\tfloat smoothness;\n\t//vec3 eyeVec;TODO:maybe can remove\n\t//float alpha;\n\t//vec3 reflUVW;\n};\n\n#if !defined(SETUP_BRDF_INPUT)//shader内部的宏需要将改成#ifdef改成#if类型 不然会被Laya的shader分析器优化掉\n    #define SETUP_BRDF_INPUT metallicSetup//default is metallicSetup,also can be other. \n#endif\n\nconst mediump vec4 dielectricSpecularColor = vec4(0.220916301, 0.220916301, 0.220916301, 1.0 - 0.220916301);\n\nmediump vec3 diffuseAndSpecularFromMetallic(mediump vec3 albedo,mediump float metallic, out mediump vec3 specColor, out mediump float oneMinusReflectivity)\n{\n\tspecColor = mix(dielectricSpecularColor.rgb, albedo, metallic);\n\toneMinusReflectivity= dielectricSpecularColor.a*(1.0-metallic);//diffuse proportion\n\treturn albedo * oneMinusReflectivity;\n}\n\nmediump float specularStrength(mediump vec3 specular)\n{\n    return max (max (specular.r, specular.g), specular.b);\n}\n\n// Diffuse/Spec Energy conservation\nmediump vec3 energyConservationBetweenDiffuseAndSpecular (mediump vec3 albedo, mediump vec3 specColor, out mediump float oneMinusReflectivity)\n{\n\toneMinusReflectivity = 1.0 - specularStrength(specColor);\n    return albedo * (vec3(1.0) - specColor);\n}\n\n#ifdef TRANSPARENTBLEND\n\tmediump vec3 preMultiplyAlpha (mediump vec3 diffColor, mediump float alpha, mediump float oneMinusReflectivity,out mediump float modifiedAlpha)\n\t{\n\t\t// Transparency 'removes' from Diffuse component\n\t\tdiffColor *= alpha;\n\t\t// Reflectivity 'removes' from the rest of components, including Transparency\n\t\t// modifiedAlpha = 1.0-(1.0-alpha)*(1.0-reflectivity) = 1.0-(oneMinusReflectivity - alpha*oneMinusReflectivity) = 1.0-oneMinusReflectivity + alpha*oneMinusReflectivity\n\t\tmodifiedAlpha = 1.0 - oneMinusReflectivity + alpha*oneMinusReflectivity;\n\t\treturn diffColor;\n\t}\n#endif\n\nFragmentCommonData metallicSetup(vec2 uv)\n{\n\tmediump vec2 metallicGloss = getMetallicGloss(uv);\n\tmediump float metallic = metallicGloss.x;\n\tmediump float smoothness = metallicGloss.y; // this is 1 minus the square root of real roughness m.\n\tmediump float oneMinusReflectivity;\n\tmediump vec3 specColor;\n\tmediump vec3 diffColor = diffuseAndSpecularFromMetallic(albedo(uv), metallic,/*out*/specColor,/*out*/oneMinusReflectivity);\n\n\tFragmentCommonData o;\n\to.diffColor = diffColor;\n\to.specColor = specColor;\n\to.oneMinusReflectivity = oneMinusReflectivity;\n\to.smoothness = smoothness;\n\treturn o;\n}\n\nFragmentCommonData specularSetup(vec2 uv)\n{\n    mediump vec4 specGloss = specularGloss(uv);\n    mediump vec3 specColor = specGloss.rgb;\n    mediump float smoothness = specGloss.a;\n\n    mediump float oneMinusReflectivity;\n    mediump vec3 diffColor = energyConservationBetweenDiffuseAndSpecular (albedo(uv), specColor, /*out*/ oneMinusReflectivity);\n\n    FragmentCommonData o;\n    o.diffColor = diffColor;\n    o.specColor = specColor;\n    o.oneMinusReflectivity = oneMinusReflectivity;\n    o.smoothness = smoothness;\n    return o;\n}\n\nLayaGI fragmentGI(float smoothness,vec3 eyeVec,mediump float occlusion,mediump vec2 lightmapUV,vec3 worldnormal,vec3 worldPos)\n{\n\tLayaGIInput giInput;\n\t#ifdef LIGHTMAP\n\t\tgiInput.lightmapUV=lightmapUV;\n\t#endif\n\tgiInput.worldPos = worldPos;\n\n\tvec3 worldViewDir = -eyeVec;\n\tmediump vec4 uvwRoughness;\n\tuvwRoughness.rgb = reflect(worldViewDir, worldnormal);//reflectUVW\n\tuvwRoughness.a= smoothnessToPerceptualRoughness(smoothness);//perceptualRoughness\n\n\treturn layaGlobalIllumination(giInput,occlusion, worldnormal, uvwRoughness);\n}\n\n\nvec3 perPixelWorldNormal(vec2 uv,vec3 normal,vec3 binormal,vec3 tangent)\n{\n\t#ifdef NORMALTEXTURE\n\t\tmediump vec3 normalTangent=normalInTangentSpace(uv);\n\t\tvec3 normalWorld = normalize(tangent * normalTangent.x + binormal * normalTangent.y + normal * normalTangent.z);\n\t#else\n\t\tvec3 normalWorld = normalize(normal);\n\t#endif\n\t\treturn normalWorld;\n}\n\nvoid fragmentForward()\n{\n\tvec2 uv;\n\t#if defined(ALBEDOTEXTURE)||defined(METALLICGLOSSTEXTURE)||defined(NORMALTEXTURE)||defined(EMISSIONTEXTURE)||defined(OCCLUSIONTEXTURE)||defined(PARALLAXTEXTURE)\n\t\t#ifdef PARALLAXTEXTURE\n\t\t\tuv = parallax(v_Texcoord0,normalize(v_ViewDirForParallax));\n\t\t#else\n\t\t\tuv = v_Texcoord0;\n\t\t#endif\n\t#endif\n\n\tmediump float alpha = getAlpha(uv);\n\t#ifdef ALPHATEST\n\t\tif(alpha<u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n\n\tFragmentCommonData o = SETUP_BRDF_INPUT(uv);\n\t\n\tvec3 binormal;\n\tvec3 tangent;\n\t#ifdef NORMALTEXTURE\n\t\ttangent = v_Tangent;\n\t\tbinormal = v_Binormal;\n\t#endif\n\n\tvec3 normal = v_Normal;\n\tvec3 normalWorld = perPixelWorldNormal(uv,normal,binormal,tangent);//In FS if the normal use mediump before normalize will cause precision prolem in mobile device.\n\tvec3 eyeVec = normalize(v_EyeVec);\n\tvec3 posworld = v_PositionWorld;\n\n\t#ifdef TRANSPARENTBLEND\n\t\to.diffColor=preMultiplyAlpha(o.diffColor,alpha,o.oneMinusReflectivity,/*out*/alpha);// shader relies on pre-multiply alpha-blend (srcBlend = One, dstBlend = OneMinusSrcAlpha)\n\t#endif\n\n\tmediump float occlusion = getOcclusion(uv);\n\tmediump vec2 lightMapUV;\n\t#ifdef LIGHTMAP\n\t\tlightMapUV=v_LightMapUV;\n\t#endif\n\tfloat perceptualRoughness = smoothnessToPerceptualRoughness(o.smoothness);\n\tfloat roughness = perceptualRoughnessToRoughness(perceptualRoughness);\n\tfloat nv = abs(dot(normalWorld, eyeVec));\n\tLayaGI gi =fragmentGI(o.smoothness,eyeVec,occlusion,lightMapUV,normalWorld,posworld);\n\tvec4 color = LAYA_BRDF_GI(o.diffColor,o.specColor,o.oneMinusReflectivity,o.smoothness,perceptualRoughness,roughness,nv,normalWorld,eyeVec,gi);\n\t\n\tfloat shadowAttenuation = 1.0;\n\t#ifdef LEGACYSINGLELIGHTING\n\t\t#ifdef DIRECTIONLIGHT\n\t\t\t#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\t\t\t\t#ifdef SHADOW_CASCADE\n\t\t\t\t\tvec4 shadowCoord = getShadowCoord(vec4(v_PositionWorld,1.0));\n\t\t\t\t#else\n\t\t\t\t\tvec4 shadowCoord = v_ShadowCoord;\n\t\t\t\t#endif\n\t\t\t\tshadowAttenuation=sampleShadowmap(shadowCoord);\n\t\t\t#endif\n\t\t\tLayaLight dirLight = layaDirectionLightToLight(u_DirectionLight,shadowAttenuation);\n\t\t\tcolor+= LAYA_BRDF_LIGHT(o.diffColor,o.specColor,o.oneMinusReflectivity,perceptualRoughness,roughness,nv,normalWorld,eyeVec,dirLight);\n\t\t#endif\n\t\n\t\t#ifdef POINTLIGHT\n\t\t\tshadowAttenuation = 1.0;\n\t\t\tLayaLight poiLight = layaPointLightToLight(posworld,normalWorld,u_PointLight,shadowAttenuation);\n\t\t\tcolor+= LAYA_BRDF_LIGHT(o.diffColor,o.specColor,o.oneMinusReflectivity,perceptualRoughness,roughness,nv,normalWorld,eyeVec,poiLight);\n\t\t#endif\n\t\t\n\t\t#ifdef SPOTLIGHT\n\t\t\tshadowAttenuation = 1.0;\n\t\t\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\t\t\t\tvec4 spotShadowcoord = v_SpotShadowCoord;\n\t\t\t\tshadowAttenuation = sampleSpotShadowmap(spotShadowcoord);\n\t\t\t#endif\n\t\t    LayaLight spoLight = layaSpotLightToLight(posworld,normalWorld,u_SpotLight,shadowAttenuation);\n\t\t\tcolor+= LAYA_BRDF_LIGHT(o.diffColor,o.specColor,o.oneMinusReflectivity,perceptualRoughness,roughness,nv,normalWorld,eyeVec,spoLight);\n\t\t#endif\n\t#else\n\t \t#ifdef DIRECTIONLIGHT\n\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t{\n\t\t\t\tshadowAttenuation = 1.0;\n\t\t\t\tif(i >= u_DirationLightCount)\n\t\t\t\t\tbreak;\n\t\t\t\t#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\t\t\t\t\tif(i == 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t#ifdef SHADOW_CASCADE\n\t\t\t\t\t\t\tvec4 shadowCoord = getShadowCoord(vec4(v_PositionWorld,1.0));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tvec4 shadowCoord = v_ShadowCoord;\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\tshadowAttenuation *= sampleShadowmap(shadowCoord);\n\t\t\t\t\t}\n\t\t\t\t#endif\n\t\t\t\tDirectionLight directionLight = getDirectionLight(u_LightBuffer,i);\n\t\t\t\tLayaLight dirLight = layaDirectionLightToLight(directionLight,shadowAttenuation);\n\t\t\t \tcolor+=LAYA_BRDF_LIGHT(o.diffColor,o.specColor,o.oneMinusReflectivity,perceptualRoughness,roughness,nv,normalWorld,eyeVec,dirLight);\n\t\t\t}\n\t \t#endif\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\t\tivec4 clusterInfo =getClusterInfo(u_LightClusterBuffer,u_View,u_Viewport, v_PositionWorld,gl_FragCoord,u_ProjectionParams);\n\t\t\t#ifdef POINTLIGHT\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t\t{\n\t\t\t\t\tshadowAttenuation = 1.0;\n\t\t\t\t\tif(i >= clusterInfo.x)//PointLightCount\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tPointLight pointLight = getPointLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\n\t\t\t\t\tLayaLight poiLight = layaPointLightToLight(posworld,normalWorld,pointLight,shadowAttenuation);\n\t\t\t\t\tcolor+= LAYA_BRDF_LIGHT(o.diffColor,o.specColor,o.oneMinusReflectivity,perceptualRoughness,roughness,nv,normalWorld,eyeVec,poiLight);\n\t\t\t\t}\n\t\t\t#endif\n\t\t\t#ifdef SPOTLIGHT\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t\t{\n\t\t\t\t\tshadowAttenuation = 1.0;\n\t\t\t\t\tif(i >= clusterInfo.y)//SpotLightCount\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\t\t\t\t\t\tif(i == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvec4 spotShadowcoord = v_SpotShadowCoord;\n\t\t\t\t\t\t\tshadowAttenuation= sampleSpotShadowmap(spotShadowcoord);\n\t\t\t\t\t\t}\n\t\t\t\t\t#endif\n\t\t\t\t\tSpotLight spotLight = getSpotLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\n\t\t\t\t\tLayaLight spoLight = layaSpotLightToLight(posworld,normalWorld,spotLight,shadowAttenuation);\n\t\t\t\t\tcolor+= LAYA_BRDF_LIGHT(o.diffColor,o.specColor,o.oneMinusReflectivity,perceptualRoughness,roughness,nv,normalWorld,eyeVec,spoLight);\n\t\t\t\t}\n\t\t\t#endif\n\t\t#endif\n\t #endif\n\n\t#ifdef EMISSION\n\t\tcolor.rgb += emission(uv);\n\t#endif\n\n\t#ifdef FOG\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\n\t\tcolor.rgb=mix(color.rgb,u_FogColor,lerpFact);\n\t#endif\n\t\n\tgl_FragColor=vec4(color.rgb,alpha);\n}\n\n\n\n"},function(t,e,i){"use strict";e.a="attribute vec4 a_Position;\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_MvpMatrix;\n\tattribute mat4 a_WorldMat;\n#else\n\tuniform mat4 u_MvpMatrix;\n\tuniform mat4 u_WorldMat;\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nattribute vec3 a_Normal;\nvarying vec3 v_Normal; \n\n#if defined(NORMALTEXTURE)||defined(PARALLAXTEXTURE)\n\tattribute vec4 a_Tangent0;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n    #ifdef PARALLAXTEXTURE\n\t    varying vec3 v_ViewDirForParallax;\n    #endif\n#endif\n\n#if defined(ALBEDOTEXTURE)||defined(METALLICGLOSSTEXTURE)||defined(NORMALTEXTURE)||defined(EMISSIONTEXTURE)||defined(OCCLUSIONTEXTURE)||defined(PARALLAXTEXTURE)||(defined(LIGHTMAP)&&defined(UV))\n\tattribute vec2 a_Texcoord0;\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(LIGHTMAP)&&defined(UV1)\n\tattribute vec2 a_Texcoord1;\n#endif\n\n#ifdef LIGHTMAP\n\tuniform vec4 u_LightmapScaleOffset;\n\tvarying vec2 v_LightMapUV;\n#endif\n\nuniform vec3 u_CameraPos;\nvarying vec3 v_EyeVec;\nvarying vec3 v_PositionWorld;\nvarying float v_posViewZ;\n\n#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\n\tvarying vec4 v_ShadowCoord;\n#endif\n\n#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\tvarying vec4 v_SpotShadowCoord;\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif"},function(t,e,i){"use strict";e.a="#ifdef ALPHATEST\n\tuniform float u_AlphaTestValue;\n#endif\n\nuniform vec4 u_AlbedoColor;\n\n#ifdef NORMALTEXTURE\n\tuniform sampler2D u_NormalTexture;\n\tuniform float u_NormalScale;\n#endif\n\n#ifdef ALBEDOTEXTURE\n\tuniform sampler2D u_AlbedoTexture;\n#endif\n\n#ifdef METALLICGLOSSTEXTURE\n\tuniform sampler2D u_MetallicGlossTexture;\n#endif\nuniform float u_Metallic;\n\n#ifdef SPECULARGLOSSTEXTURE\n\tuniform sampler2D u_SpecGlossTexture;\n#endif\nuniform vec3 u_SpecularColor;\n\nuniform float u_Smoothness;\nuniform float u_SmoothnessScale;\n\n#ifdef PARALLAXTEXTURE\n\tuniform sampler2D u_ParallaxTexture;\n\tuniform float u_ParallaxScale;\n\tvarying vec3 v_ViewDirForParallax;\n#endif\n\n#ifdef OCCLUSIONTEXTURE\n\tuniform sampler2D u_OcclusionTexture;\n\tuniform float u_occlusionStrength;\n#endif\n\n#ifdef EMISSION \n\t#ifdef EMISSIONTEXTURE\n\t\tuniform sampler2D u_EmissionTexture;\n\t#endif\n\tuniform vec4 u_EmissionColor;\n#endif\n\n#if defined(ALBEDOTEXTURE)||defined(METALLICGLOSSTEXTURE)||defined(NORMALTEXTURE)||defined(EMISSIONTEXTURE)||defined(OCCLUSIONTEXTURE)||defined(PARALLAXTEXTURE)\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform sampler2D u_LightMap;\n\t#ifdef LIGHTMAP_DIRECTIONAL\n\t\tuniform sampler2D u_LightMapDirection;\n\t#endif\n#endif\n\nvarying vec3 v_Normal; \n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#ifdef LEGACYSINGLELIGHTING\n\t\t#ifdef DIRECTIONLIGHT\n\t\t\tuniform DirectionLight u_DirectionLight;\n\t\t#endif\n\t\t#ifdef POINTLIGHT\n\t\t\tuniform PointLight u_PointLight;\n\t\t#endif\n\t\t#ifdef SPOTLIGHT\n\t\t\tuniform SpotLight u_SpotLight;\n\t\t#endif\n\t#else\n\t\tuniform mat4 u_View;\n\t\tuniform vec4 u_ProjectionParams;\n\t\tuniform vec4 u_Viewport;\n\t\tuniform int u_DirationLightCount;\n\t\tuniform sampler2D u_LightBuffer;\n\t\tuniform sampler2D u_LightClusterBuffer;\n\t#endif\n#endif\n\nvarying vec3 v_EyeVec;\n\n#ifdef NORMALTEXTURE\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\n\n//后面考虑宏TODO\nvarying vec3 v_PositionWorld;\n\n#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\n\tvarying vec4 v_ShadowCoord;\n#endif\n\n#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\tvarying vec4 v_SpotShadowCoord;\n#endif\n\nmediump float lerpOneTo(mediump float b, mediump float t)\n{\n    mediump float oneMinusT = 1.0 - t;\n    return oneMinusT + b * t;\n}\n\n#ifdef EMISSION \n\tvec3 emission(vec2 uv)\n\t{\n\t\t#ifdef EMISSIONTEXTURE\n\t\t\treturn texture2D(u_EmissionTexture, uv).rgb * u_EmissionColor.rgb;\n\t\t#else\n\t\t\treturn u_EmissionColor.rgb;\n\t\t#endif\n\t}\n#endif\n\nmediump float getAlpha(vec2 uv)\n{\n\t#ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\n\t\treturn u_AlbedoColor.a;\n\t#else\n\t\t#ifdef ALBEDOTEXTURE\n\t\t\treturn texture2D(u_AlbedoTexture, uv).a * u_AlbedoColor.a;\n\t\t#else\n\t\t\treturn u_AlbedoColor.a;\n\t\t#endif\n\t#endif\n}\n\nmediump float getOcclusion(vec2 uv)\n{\n\t#ifdef OCCLUSIONTEXTURE\n\t\tmediump float occ = texture2D(u_OcclusionTexture, uv).g;\n\t\treturn lerpOneTo(occ, u_occlusionStrength);\n\t#else\n\t\treturn 1.0;\n\t#endif\n}\n\nmediump vec3 albedo(vec2 uv)\n{\n\t#ifdef ALBEDOTEXTURE\n\t\treturn u_AlbedoColor.rgb * texture2D(u_AlbedoTexture, uv).rgb;\n\t#else\n\t\treturn u_AlbedoColor.rgb;\n\t#endif\n\t//TODO:Detail Texture\n}\n\nmediump vec2 getMetallicGloss(vec2 uv)\n{\n\tmediump vec2 ms;//x is metallic,y is smoothness\n\t#ifdef METALLICGLOSSTEXTURE\n\t\t#ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\n\t\t\tms.x = texture2D(u_MetallicGlossTexture, uv).r;\n\t\t\t#ifdef ALBEDOTEXTURE\n\t\t\t\tms.y = texture2D(u_AlbedoTexture, uv).a*u_SmoothnessScale;\n\t\t\t#else\n\t\t\t\tms.y = u_SmoothnessScale;\n\t\t\t#endif\n\t\t#else\n\t\t\tms = texture2D(u_MetallicGlossTexture, uv).ra;\n\t\t\tms.y *= u_SmoothnessScale;\n\t\t#endif\n\t#else\n\t\tms.x = u_Metallic;\n\t\t#ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\n\t\t\t#ifdef ALBEDOTEXTURE\n\t\t\t\tms.y = texture2D(u_AlbedoTexture, uv).a * u_SmoothnessScale;\n\t\t\t#else\n\t\t\t\tms.y = u_SmoothnessScale;\n\t\t\t#endif\n\t\t#else\n\t\t\tms.y = u_Smoothness;\n\t\t#endif\n\t#endif\n\treturn ms;\n}\n\nmediump vec4 specularGloss(vec2 uv)\n{\n\tmediump vec4 sg;\n\t#ifdef SPECULARGLOSSTEXTURE\n\t\t#ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\n\t\t\tsg.rgb = texture2D(u_SpecGlossTexture, uv).rgb;\n\t\t\t#ifdef ALBEDOTEXTURE\n\t\t\t\tsg.a = texture2D(u_AlbedoTexture, uv).a*u_SmoothnessScale;\n\t\t\t#else\n\t\t\t\tsg.a = u_SmoothnessScale;\n\t\t\t#endif\n\t\t#else\n\t\t\tsg = texture2D(u_SpecGlossTexture, uv);\n\t\t\tsg.a *= u_SmoothnessScale;\n\t\t#endif\n\t#else\n\t\tsg.rgb = u_SpecularColor.rgb;\n\t\t#ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\n\t\t\t#ifdef ALBEDOTEXTURE\n\t\t\t\tsg.a = texture2D(u_AlbedoTexture, uv).a * u_SmoothnessScale;\n\t\t\t#else\n\t\t\t\tsg.a = u_SmoothnessScale;\n\t\t\t#endif\n\t\t#else\n\t\t\tsg.a = u_Smoothness;\n\t\t#endif\n\t#endif\n\t\treturn sg;\n}\n\n\n#ifdef NORMALTEXTURE\n\tmediump vec3 unpackScaleNormal(mediump vec3 packednormal, mediump float bumpScale)\n\t{\n\t\tmediump vec3 normal = packednormal.xyz * 2.0 - 1.0;\n\t\tnormal.y=-normal.y;//NOTE:because unity to LayaAir coordSystem.\n\t\tnormal.xy *= bumpScale;\n\t\treturn normal;\n\t}\n\t\n\tmediump vec3 normalInTangentSpace(vec2 texcoords)\n\t{\n\t\tmediump vec3 normalTangent = unpackScaleNormal(texture2D(u_NormalTexture, texcoords).rgb,u_NormalScale);\n\t\treturn normalTangent;\n\t}\n#endif\n\n#ifdef PARALLAXTEXTURE\n\tmediump vec2 parallaxOffset1Step(mediump float h, mediump float height, mediump vec3 viewDir)\n\t{\n\t\th = h * height - height / 2.0;\n\t\tviewDir.z += 0.42;\n\t\treturn h * (viewDir.xy / viewDir.z);\n\t}\n\n\tvec2 parallax(vec2 texcoords, mediump vec3 viewDir)\n\t{\n\t\tmediump float h = texture2D(u_ParallaxTexture, texcoords.xy).g;\n\t\tvec2 offset = parallaxOffset1Step(h, u_ParallaxScale, viewDir);\n\t\treturn texcoords+offset;\n\t}\n#endif\n\n\n\n\n\n\n\n\n"},function(t,e,i){"use strict";e.a="vec2 transformLightMapUV(in vec2 texcoord,in vec4 lightmapScaleOffset)\n{\n\tvec2 lightMapUV=vec2(texcoord.x,1.0-texcoord.y)*lightmapScaleOffset.xy+lightmapScaleOffset.zw;\n\tlightMapUV.y=1.0-lightMapUV.y;\n\treturn lightMapUV; \n}\n\nvoid vertexForward()\n{\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform;\n\t \t#ifdef SIMPLEBONE\n\t\t\tfloat currentPixelPos;\n\t\t\t#ifdef GPU_INSTANCE\n\t\t\t\tcurrentPixelPos = a_SimpleTextureParams.x+a_SimpleTextureParams.y;\n\t\t\t#else\n\t\t\t\tcurrentPixelPos = u_SimpleAnimatorParams.x+u_SimpleAnimatorParams.y;\n\t\t\t#endif\n\t\t\tfloat offset = 1.0/u_SimpleAnimatorTextureSize;\n\t\t\tskinTransform =  loadMatFromTexture(currentPixelPos,int(a_BoneIndices.x),offset) * a_BoneWeights.x;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.y),offset) * a_BoneWeights.y;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.z),offset) * a_BoneWeights.z;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.w),offset) * a_BoneWeights.w;\n\t\t#else\n\t\t\tskinTransform =  u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\t#endif\n\t\tposition=skinTransform*a_Position;\n\t #else\n\t\tposition=a_Position;\n\t#endif\n\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\n\tmat4 worldMat;\n\t#ifdef GPU_INSTANCE\n\t\tworldMat = a_WorldMat;\n\t#else\n\t\tworldMat = u_WorldMat;\n\t#endif\n\n\tv_PositionWorld=(worldMat*position).xyz;\n\n\t#if defined(ALBEDOTEXTURE)||defined(METALLICGLOSSTEXTURE)||defined(NORMALTEXTURE)||defined(EMISSIONTEXTURE)||defined(OCCLUSIONTEXTURE)||defined(PARALLAXTEXTURE)\n\t\t#ifdef TILINGOFFSET\n\t\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\n\t\t#else\n\t\t\tv_Texcoord0=a_Texcoord0;\n\t\t#endif\n\t#endif\n\n\tv_EyeVec =u_CameraPos-v_PositionWorld;//will normalize per-pixel\n\n\t#ifdef LIGHTMAP\n\t\tvec2 texcoord;\n\t\t#ifdef UV1\n\t\t\ttexcoord=a_Texcoord1;\n\t\t#else\n\t\t\ttexcoord=a_Texcoord0;\n\t\t#endif\n\t\tv_LightMapUV=transformLightMapUV(texcoord,u_LightmapScaleOffset);\n\t#endif\n\n\tmat3 worldInvMat;\n\t#ifdef BONE\n\t\tworldInvMat=INVERSE_MAT(mat3(worldMat*skinTransform));\n\t#else\n\t\tworldInvMat=INVERSE_MAT(mat3(worldMat));\n\t#endif\n\n\tv_Normal=normalize(a_Normal*worldInvMat);//if no normalize will cause precision problem.\n\n\t#ifdef NORMALTEXTURE\n\t\tv_Tangent=normalize(a_Tangent0.xyz*worldInvMat);\n\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\n\t#endif\n\n\t#ifdef PARALLAXTEXTURE\n\t\tvec3 binormal = cross(a_Normal, a_Tangent0.xyz)*a_Tangent0.w;\n\t\tmat3 objectTBN = mat3(a_Tangent0.xyz, binormal, a_Normal);\n\t\tv_ViewDirForParallax=(worldInvMat*u_CameraPos-position.xyz)*objectTBN;\n\t#endif\n\n\t#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\n\t\tv_ShadowCoord = getShadowCoord(vec4(v_PositionWorld,1.0));\n\t#endif\n\n\t#if defined(CALCULATE_SPOTSHADOWS)//shader���Զ���ĺ겻����ifdef ����ĳ�if defined\n\t\tv_SpotShadowCoord = u_SpotViewProjectMatrix*vec4(v_PositionWorld,1.0);\n\t#endif\n}"},function(t,e,i){"use strict";e.a='#include "Lighting.glsl";\n#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\nattribute vec4 a_PositionTexcoord;\nvarying vec2 v_Texcoord0;\n\nvoid main() {\n\tgl_Position = vec4(a_PositionTexcoord.xy, 0.0, 1.0);\n\tv_Texcoord0 = a_PositionTexcoord.zw;\n\tgl_Position = remapGLPositionZ(gl_Position);\n}'},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform vec4 u_MainTex_TexelSize;\n\nvoid fragDownsample13() {\n\tmediump vec4 color = downsampleBox13Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\n\tgl_FragColor = color;\n}\n\nvoid main() {\n\tfragDownsample13();\n}'},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform vec4 u_MainTex_TexelSize;\n\nvoid fragDownsample4() {\n\tmediump vec4 color = downsampleBox4Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\n\tgl_FragColor = color;\n}\n\nvoid main() {\n\tfragDownsample4();\n}'},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform sampler2D u_AutoExposureTex;\nuniform vec4 u_MainTex_TexelSize;\nuniform vec4 u_Threshold; // x: threshold value (linear), y: threshold - knee, z: knee * 2, w: 0.25 / knee\nuniform vec4 u_Params; // x: clamp, yzw: unused\n\nmediump vec4 prefilter(mediump vec4 color, vec2 uv) {\n\tmediump float autoExposure = texture2D(u_AutoExposureTex, uv).r;\n\tcolor *= autoExposure;\n\tcolor = min(vec4(u_Params.x), color); // clamp to max\n\tcolor = quadraticThreshold(color, u_Threshold.x, u_Threshold.yzw);\n\treturn color;\n}\n\nvoid fragPrefilter13() {\n\tmediump vec4 color = downsampleBox13Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\n\tgl_FragColor = prefilter(safeHDR(color), v_Texcoord0);\n}\n\nvoid main() {\n\tfragPrefilter13();\n}'},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform sampler2D u_AutoExposureTex;\nuniform vec4 u_MainTex_TexelSize;\nuniform vec4 u_Threshold; // x: threshold value (linear), y: threshold - knee, z: knee * 2, w: 0.25 / knee\nuniform vec4 u_Params; // x: clamp, yzw: unused\n\nmediump vec4 prefilter(mediump vec4 color, vec2 uv) {\n\tmediump float autoExposure = texture2D(u_AutoExposureTex, uv).r;\n\tcolor *= autoExposure;\n\tcolor = min(vec4(u_Params.x), color); // clamp to max\n\tcolor = quadraticThreshold(color, u_Threshold.x, u_Threshold.yzw);\n\treturn color;\n}\n\nvoid fragPrefilter4() {\n\tmediump vec4 color = downsampleBox4Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\n\tgl_FragColor = prefilter(safeHDR(color), v_Texcoord0);\n}\n\nvoid main() {\n\tfragPrefilter4();\n}'},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform sampler2D u_BloomTex;\n\nuniform vec4 u_MainTex_TexelSize;\nuniform float u_SampleScale;\n\nmediump vec4 combine(mediump vec4 bloom, vec2 uv) {\n\tmediump vec4 color = texture2D(u_BloomTex, uv);\n\treturn bloom + color;\n}\n\nvoid fragUpsampleBox() {\n\tmediump vec4 bloom = upsampleBox(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy, vec4(u_SampleScale));\n\tgl_FragColor = combine(bloom, v_Texcoord0);\n}\n\nvoid main() {\n\tfragUpsampleBox();\n}'},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform sampler2D u_BloomTex;\n\nuniform vec4 u_MainTex_TexelSize;\nuniform float u_SampleScale;\n\nmediump vec4 combine(mediump vec4 bloom, vec2 uv) {\n\tmediump vec4 color = texture2D(u_BloomTex, uv);\n\treturn bloom + color;\n}\n\nvoid fragUpsampleTent() {\n\tmediump vec4 bloom = upsampleTent(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy, vec4(u_SampleScale));\n\tgl_FragColor = combine(bloom, v_Texcoord0);\n}\n\nvoid main() {\n\tfragUpsampleTent();\n}'},function(t,e,i){"use strict";e.a='#include "StdLib.glsl";\n\n#define EPSILON 1.0e-4\n\n// Quadratic color thresholding\n// curve = (threshold - knee, knee * 2, 0.25 / knee)\nmediump vec4 quadraticThreshold(mediump vec4 color, mediump float threshold, mediump vec3 curve) {\n\t// Pixel brightness\n\tmediump float br = max3(color.r, color.g, color.b);\n\n\t// Under-threshold part: quadratic curve\n\tmediump float rq = clamp(br - curve.x, 0.0, curve.y);\n\trq = curve.z * rq * rq;\n\n\t// Combine and apply the brightness response curve.\n\tcolor *= max(rq, br - threshold) / max(br, EPSILON);\n\n\treturn color;\n}\n\n\n\n//\n// sRGB transfer functions\n// Fast path ref: http://chilliant.blogspot.com.au/2012/08/srgb-approximations-for-hlsl.html?m=1\n//\nmediump vec3 sRGBToLinear(mediump vec3 c) {\n\t#ifdef USE_VERY_FAST_SRGB\n\t\treturn c * c;\n\t#elif defined(USE_FAST_SRGB)\n\t\treturn c * (c * (c * 0.305306011 + 0.682171111) + 0.012522878);\n\t#else\n\t\tmediump vec3 linearRGBLo = c / 12.92;\n\t\tmediump vec3 power=vec3(2.4, 2.4, 2.4);\n\t\tmediump vec3 linearRGBHi = positivePow((c + 0.055) / 1.055, power);\n\t\tmediump vec3 linearRGB =vec3((c.r<=0.04045) ? linearRGBLo.r : linearRGBHi.r,(c.g<=0.04045) ? linearRGBLo.g : linearRGBHi.g,(c.b<=0.04045) ? linearRGBLo.b : linearRGBHi.b);\n\t\treturn linearRGB;\n\t#endif\n}\n\nmediump vec4 sRGBToLinear(mediump vec4 c){\n    return vec4(sRGBToLinear(c.rgb), c.a);\n}\n\n\n\nmediump vec3 linearToSRGB(mediump vec3 c) {\n\t#ifdef USE_VERY_FAST_SRGB\n\t\treturn sqrt(c);\n\t#elif defined(USE_FAST_SRGB)\n\t\treturn max(1.055 * PositivePow(c, 0.416666667) - 0.055, 0.0);\n\t#else\n\t\tmediump vec3 sRGBLo = c * 12.92;\n\t\tmediump vec3 power=vec3(1.0 / 2.4, 1.0 / 2.4, 1.0 / 2.4);\n\t\tmediump vec3 sRGBHi = (positivePow(c, power) * 1.055) - 0.055;\n\t\tmediump vec3 sRGB =vec3((c.r<=0.0031308) ? sRGBLo.r : sRGBHi.r,(c.g<=0.0031308) ? sRGBLo.g : sRGBHi.g,(c.b<=0.0031308) ? sRGBLo.b : sRGBHi.b);\n\t\treturn sRGB;\n\t#endif\n}\n\nmediump vec4 linearToSRGB(mediump vec4 c){\n    return vec4(linearToSRGB(c.rgb), c.a);\n}'},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform sampler2D u_BloomTex;\n\nuniform sampler2D u_AutoExposureTex;\nuniform sampler2D u_Bloom_DirtTex;\nuniform vec4 u_BloomTex_TexelSize;\nuniform vec4 u_Bloom_DirtTileOffset; // xy: tiling, zw: offset\nuniform mediump vec3 u_Bloom_Settings;// x: sampleScale, y: intensity, z: dirt intensity\nuniform mediump vec3 u_Bloom_Color;\n\nvoid main() {\n\tmediump float autoExposure = texture2D(u_AutoExposureTex, v_Texcoord0).r;\n\tmediump vec4 color=vec4(0.0);\n\tcolor = texture2D(u_MainTex, v_Texcoord0);\n\t\n\tcolor = sRGBToLinear(color);\n\tcolor.rgb *= autoExposure;\n\t\n\t#if defined(BLOOM)||defined(BLOOM_LOW)\n\t\t#ifdef BLOOM\n\t\t\tmediump vec4 bloom = upsampleTent(u_BloomTex, v_Texcoord0, u_BloomTex_TexelSize.xy, vec4(u_Bloom_Settings.x));\n\t\t#else\n\t\t\tmediump vec4 bloom = upsampleBox(u_BloomTex, v_Texcoord0, u_BloomTex_TexelSize.xy, vec4(u_Bloom_Settings.x));\n\t\t#endif\n\n\t\t// UVs should be Distort(uv * u_Bloom_DirtTileOffset.xy + u_Bloom_DirtTileOffset.zw)\n\t\t// but considering we use a cover-style scale on the dirt texture the difference\n\t\t// isn\'t massive so we chose to save a few ALUs here instead in case lens distortion\n\t\t// is active\n\t\tmediump vec4 dirt =vec4(texture2D(u_Bloom_DirtTex, v_Texcoord0 * u_Bloom_DirtTileOffset.xy + u_Bloom_DirtTileOffset.zw).rgb, 0.0);\n\n\t\t// Additive bloom (artist friendly)\n\t\tbloom *= u_Bloom_Settings.y;\n\t\tdirt *= u_Bloom_Settings.z;\n\t\tmediump vec4 bloomColor=vec4(u_Bloom_Color, 1.0);\n\t\tcolor += bloom * bloomColor;\n\t\tcolor += dirt * bloom;\n\t#endif\n\t\n\tmediump vec4 finalColor = color;\n\tfinalColor = linearToSRGB(finalColor);\n\t//finalColor.rgb = Dither(finalColor.rgb, v_Texcoord0);//TODO:抖动\n\tgl_FragColor = finalColor;\n}'},function(t,e,i){"use strict";e.a='#include "Lighting.glsl";\n\nattribute vec4 a_PositionTexcoord;\nvarying vec2 v_Texcoord0;\n\nvoid main() {\n\tgl_Position = vec4(a_PositionTexcoord.xy, 0.0, 1.0);\n\tv_Texcoord0 = a_PositionTexcoord.zw;\n\tgl_Position = remapGLPositionZ(gl_Position);\n}'},function(t,e,i){"use strict";e.a="// Better, temporally stable box filtering\n// [Jimenez14] http://goo.gl/eomGso\n// . . . . . . .\n// . A . B . C .\n// . . D . E . .\n// . F . G . H .\n// . . I . J . .\n// . K . L . M .\n// . . . . . . .\nmediump vec4 downsampleBox13Tap(sampler2D tex, vec2 uv, vec2 texelSize)\n{\n    mediump vec4 A = texture2D(tex, uv + texelSize * vec2(-1.0, -1.0));\n    mediump vec4 B = texture2D(tex, uv + texelSize * vec2( 0.0, -1.0));\n    mediump vec4 C = texture2D(tex, uv + texelSize * vec2( 1.0, -1.0));\n    mediump vec4 D = texture2D(tex, uv + texelSize * vec2(-0.5, -0.5));\n    mediump vec4 E = texture2D(tex, uv + texelSize * vec2( 0.5, -0.5));\n    mediump vec4 F = texture2D(tex, uv + texelSize * vec2(-1.0,  0.0));\n    mediump vec4 G = texture2D(tex, uv);\n    mediump vec4 H = texture2D(tex, uv + texelSize * vec2( 1.0,  0.0));\n    mediump vec4 I = texture2D(tex, uv + texelSize * vec2(-0.5,  0.5));\n    mediump vec4 J = texture2D(tex, uv + texelSize * vec2( 0.5,  0.5));\n    mediump vec4 K = texture2D(tex, uv + texelSize * vec2(-1.0,  1.0));\n    mediump vec4 L = texture2D(tex, uv + texelSize * vec2( 0.0,  1.0));\n    mediump vec4 M = texture2D(tex, uv + texelSize * vec2( 1.0,  1.0));\n\n\tmediump vec2 scale= vec2(0.5, 0.125);\n    mediump vec2 div = (1.0 / 4.0) * scale;\n\n    mediump vec4 o = (D + E + I + J) * div.x;\n    o += (A + B + G + F) * div.y;\n    o += (B + C + H + G) * div.y;\n    o += (F + G + L + K) * div.y;\n    o += (G + H + M + L) * div.y;\n\n    return o;\n}\n\n// Standard box filtering\nmediump vec4 downsampleBox4Tap(sampler2D tex, vec2 uv, vec2 texelSize)\n{\n    vec4 d = texelSize.xyxy * vec4(-1.0, -1.0, 1.0, 1.0);\n\n    mediump vec4 s =  texture2D(tex, uv + d.xy);\n    s += texture2D(tex, uv + d.zy);\n    s += texture2D(tex, uv + d.xw);\n    s += texture2D(tex, uv + d.zw);\n\n    return s * (1.0 / 4.0);\n}\n\n// 9-tap bilinear upsampler (tent filter)\n// . . . . . . .\n// . 1 . 2 . 1 .\n// . . . . . . .\n// . 2 . 4 . 2 .\n// . . . . . . .\n// . 1 . 2 . 1 .\n// . . . . . . .\nmediump vec4 upsampleTent(sampler2D tex, vec2 uv, vec2 texelSize, vec4 sampleScale)\n{\n    vec4 d = texelSize.xyxy * vec4(1.0, 1.0, -1.0, 0.0) * sampleScale;\n\n    mediump vec4 s =  texture2D(tex, uv - d.xy);\n    s += texture2D(tex, uv - d.wy) * 2.0;\n    s += texture2D(tex, uv - d.zy);\n\n    s += texture2D(tex, uv + d.zw) * 2.0;\n    s += texture2D(tex, uv) * 4.0;\n    s += texture2D(tex,\tuv + d.xw) * 2.0;\n\n    s += texture2D(tex, uv + d.zy);\n    s += texture2D(tex, uv + d.wy) * 2.0;\n    s += texture2D(tex, uv + d.xy);\n\n    return s * (1.0 / 16.0);\n}\n\n// Standard box filtering\nmediump vec4 upsampleBox(sampler2D tex, vec2 uv, vec2 texelSize, vec4 sampleScale)\n{\n    vec4 d = texelSize.xyxy * vec4(-1.0, -1.0, 1.0, 1.0) * 0.5 * sampleScale;\n\n    mediump vec4 s =  texture2D(tex, uv + d.xy);\n    s += texture2D(tex, uv + d.zy);\n    s += texture2D(tex, uv + d.xw);\n    s += texture2D(tex, uv + d.zw);\n\n    return s * (1.0 / 4.0);\n}"},function(t,e,i){"use strict";e.a="#define HALF_MAX       65504.0 // (2 - 2^-10) * 2^15\n\n#define FLT_EPSILON    1.192092896e-07 // Smallest positive number, such that 1.0 + FLT_EPSILON != 1.0\n\nmediump vec4 safeHDR(mediump vec4 c)\n{\n    return min(c, HALF_MAX);\n}\n\nfloat max3(float a, float b, float c)\n{\n    return max(max(a, b), c);\n}\n\nvec3 positivePow(vec3 base, vec3 power)\n{\n    return pow(max(abs(base), vec3(FLT_EPSILON, FLT_EPSILON, FLT_EPSILON)), power);\n}"},function(t,e,i){"use strict";e.a='#ifndef GRAPHICS_API_GLES3\n\t#define NO_NATIVE_SHADOWMAP\n#endif\n\n#if defined(NO_NATIVE_SHADOWMAP)\n\t#define TEXTURE2D_SHADOW(textureName) uniform mediump sampler2D textureName\n\t#define SAMPLE_TEXTURE2D_SHADOW(textureName, coord3) (texture2D(textureName,coord3.xy).r<coord3.z?0.0:1.0)\n\t#define TEXTURE2D_SHADOW_PARAM(shadowMap) mediump sampler2D shadowMap\n#else\n\t#define TEXTURE2D_SHADOW(textureName) uniform mediump sampler2DShadow textureName\n\t#define SAMPLE_TEXTURE2D_SHADOW(textureName, coord3) textureLod(textureName,coord3,0.0)\n\t#define TEXTURE2D_SHADOW_PARAM(shadowMap) mediump sampler2DShadow shadowMap\n#endif\n\n#if defined(RECEIVESHADOW)&&defined(SHADOW)\n    #define CALCULATE_SHADOWS\n#endif\n\n#if defined(RECEIVESHADOW)&&defined(SHADOW_SPOT)\n\t#define CALCULATE_SPOTSHADOWS\n#endif\n\nuniform vec4 u_ShadowBias; // x: depth bias, y: normal bias\n\n#if defined(CALCULATE_SHADOWS)||defined(CALCULATE_SPOTSHADOWS)\n\t#include "ShadowSampleTent.glsl"\n\tuniform vec4 u_ShadowMapSize;\n\tuniform vec4 u_ShadowParams; // x: shadowStrength y: ShadowSpotLightStrength\n\n\t\n\tfloat sampleShdowMapFiltered4(TEXTURE2D_SHADOW_PARAM(shadowMap),vec3 shadowCoord,vec4 shadowMapSize)\n\t{\n\t\tfloat attenuation;\n\t\tvec4 attenuation4;\n\t\tvec2 offset=shadowMapSize.xy/2.0;\n\t\tvec3 shadowCoord0=shadowCoord + vec3(-offset,0.0);\n\t\tvec3 shadowCoord1=shadowCoord + vec3(offset.x,-offset.y,0.0);\n\t\tvec3 shadowCoord2=shadowCoord + vec3(-offset.x,offset.y,0.0);\n\t\tvec3 shadowCoord3=shadowCoord + vec3(offset,0.0);\n\t\tattenuation4.x = SAMPLE_TEXTURE2D_SHADOW(shadowMap, shadowCoord0);\n\t\tattenuation4.y = SAMPLE_TEXTURE2D_SHADOW(shadowMap, shadowCoord1);\n\t\tattenuation4.z = SAMPLE_TEXTURE2D_SHADOW(shadowMap, shadowCoord2);\n\t\tattenuation4.w = SAMPLE_TEXTURE2D_SHADOW(shadowMap, shadowCoord3);\n\t\tattenuation = dot(attenuation4, vec4(0.25));\n\t\treturn attenuation;\n\t}\n\n\tfloat sampleShdowMapFiltered9(TEXTURE2D_SHADOW_PARAM(shadowMap),vec3 shadowCoord,vec4 shadowmapSize)\n\t{\n\t\tfloat attenuation;\n\t\tfloat fetchesWeights[9];\n\t\tvec2 fetchesUV[9];\n\t\tsampleShadowComputeSamplesTent5x5(shadowmapSize, shadowCoord.xy, fetchesWeights, fetchesUV);\n\t\tattenuation = fetchesWeights[0] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[0].xy, shadowCoord.z));\n\t\tattenuation += fetchesWeights[1] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[1].xy, shadowCoord.z));\n\t\tattenuation += fetchesWeights[2] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[2].xy, shadowCoord.z));\n\t\tattenuation += fetchesWeights[3] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[3].xy, shadowCoord.z));\n\t\tattenuation += fetchesWeights[4] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[4].xy, shadowCoord.z));\n\t\tattenuation += fetchesWeights[5] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[5].xy, shadowCoord.z));\n\t\tattenuation += fetchesWeights[6] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[6].xy, shadowCoord.z));\n\t\tattenuation += fetchesWeights[7] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[7].xy, shadowCoord.z));\n\t\tattenuation += fetchesWeights[8] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[8].xy, shadowCoord.z));\n\t\treturn attenuation;\n\t}\n\n#endif\n\n\n\n\n#if defined(CALCULATE_SHADOWS)\n\n\tTEXTURE2D_SHADOW(u_ShadowMap);\n\n\tuniform mat4 u_ShadowMatrices[4];\n\tuniform vec4 u_ShadowSplitSpheres[4];// max cascade is 4\n\n\tmediump int computeCascadeIndex(vec3 positionWS)\n\t{\n\t\tvec3 fromCenter0 = positionWS - u_ShadowSplitSpheres[0].xyz;\n\t\tvec3 fromCenter1 = positionWS - u_ShadowSplitSpheres[1].xyz;\n\t\tvec3 fromCenter2 = positionWS - u_ShadowSplitSpheres[2].xyz;\n\t\tvec3 fromCenter3 = positionWS - u_ShadowSplitSpheres[3].xyz;\n\n\t\tmediump vec4 comparison = vec4(\n\t\t\tdot(fromCenter0, fromCenter0)<u_ShadowSplitSpheres[0].w,\n\t\t\tdot(fromCenter1, fromCenter1)<u_ShadowSplitSpheres[1].w,\n\t\t\tdot(fromCenter2, fromCenter2)<u_ShadowSplitSpheres[2].w,\n\t\t\tdot(fromCenter3, fromCenter3)<u_ShadowSplitSpheres[3].w);\n\t\tcomparison.yzw = clamp(comparison.yzw - comparison.xyz,0.0,1.0);//keep the nearest\n\t\tmediump vec4 indexCoefficient = vec4(4.0,3.0,2.0,1.0);\n\t\tmediump int index = 4 - int(dot(comparison, indexCoefficient));\n\t\treturn index;\n\t}\n\n\tvec4 getShadowCoord(vec4 positionWS)\n\t{\n\t\t#ifdef SHADOW_CASCADE\n\t\t\tmediump int cascadeIndex = computeCascadeIndex(positionWS.xyz);\n\t\t\tif(cascadeIndex > 3)// out of shadow range cascadeIndex is 4.\n\t\t\t\treturn vec4(0.0);\n\t\t\t\n\t\t\t#ifdef GRAPHICS_API_GLES3\n\t\t\t\treturn u_ShadowMatrices[cascadeIndex] * positionWS;\n\t\t\t#else\n\t\t\t\tmat4 shadowMat;\n\t\t\t\tif(cascadeIndex == 0)\n\t\t\t\t\tshadowMat = u_ShadowMatrices[0];\n\t\t\t\telse if(cascadeIndex == 1)\n\t\t\t\t\tshadowMat = u_ShadowMatrices[1];\n\t\t\t\telse if(cascadeIndex == 2)\n\t\t\t\t\tshadowMat = u_ShadowMatrices[2];\n\t\t\t\telse\n\t\t\t\t\tshadowMat = u_ShadowMatrices[3];\n\t\t\t\treturn shadowMat * positionWS;\n\t\t\t#endif\n\t\t#else\n\t\t\treturn u_ShadowMatrices[0] * positionWS;\n\t\t#endif\n\t}\n\n\tfloat sampleShadowmap(vec4 shadowCoord)\n\t{\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tfloat attenuation = 1.0;\n\t\tif(shadowCoord.z > 0.0 && shadowCoord.z < 1.0)\n\t\t{\n\t\t\t#if defined(SHADOW_SOFT_SHADOW_HIGH)\n\t\t\t\tattenuation = sampleShdowMapFiltered9(u_ShadowMap,shadowCoord.xyz,u_ShadowMapSize);\n\t\t\t#elif defined(SHADOW_SOFT_SHADOW_LOW)\n\t\t\t\tattenuation = sampleShdowMapFiltered4(u_ShadowMap,shadowCoord.xyz,u_ShadowMapSize);\n\t\t\t#else\n\t\t\t\tattenuation = SAMPLE_TEXTURE2D_SHADOW(u_ShadowMap,shadowCoord.xyz);\n\t\t\t#endif\n\t\t\tattenuation = mix(1.0,attenuation,u_ShadowParams.x);//shadowParams.x:shadow strength\n\t\t}\n\t\treturn attenuation;\n\t}\n#endif\n\n#if defined(CALCULATE_SPOTSHADOWS)//shader���Զ���ĺ겻����ifdef ����ĳ�if defined\n\tTEXTURE2D_SHADOW(u_SpotShadowMap);\n\tuniform mat4 u_SpotViewProjectMatrix;\n\tfloat sampleSpotShadowmap(vec4 shadowCoord)\n\t{\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tfloat attenuation = 1.0;\n\t\tshadowCoord.xy +=1.0;\n\t\tshadowCoord.xy/=2.0; \n\t\tif(shadowCoord.z > 0.0 && shadowCoord.z < 1.0)\n\t\t{\n\t\t\t#if defined(SHADOW_SPOT_SOFT_SHADOW_HIGH)\n\t\t\t\tattenuation = sampleShdowMapFiltered9(u_SpotShadowMap,shadowCoord.xyz,u_ShadowMapSize);\n\t\t\t#elif defined(SHADOW_SPOT_SOFT_SHADOW_LOW)\n\t\t\t\tattenuation = sampleShdowMapFiltered4(u_SpotShadowMap,shadowCoord.xyz,u_ShadowMapSize);\n\t\t\t#else\n\t\t\t\tattenuation = SAMPLE_TEXTURE2D_SHADOW(u_SpotShadowMap,shadowCoord.xyz);\n\t\t\t#endif\n\t\t\tattenuation = mix(1.0,attenuation,u_ShadowParams.y);//shadowParams.y:shadow strength\n\t\t}\n\t\treturn attenuation;\n\t}\n#endif\n\nvec3 applyShadowBias(vec3 positionWS, vec3 normalWS, vec3 lightDirection)\n{\n    float invNdotL = 1.0 - clamp(dot(-lightDirection, normalWS),0.0,1.0);\n    float scale = invNdotL * u_ShadowBias.y;\n\n    // normal bias is negative since we want to apply an inset normal offset\n    positionWS += -lightDirection * u_ShadowBias.xxx;\n    positionWS += normalWS * vec3(scale);\n    return positionWS;\n}\n'},function(t,e,i){"use strict";e.a='#include "Lighting.glsl";\n#include "Shadow.glsl"\n\nattribute vec4 a_Position;\nattribute vec3 a_Normal;\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_WorldMat;\n#else\n\tuniform mat4 u_WorldMat;\n#endif\n\nuniform mat4 u_ViewProjection;\n\n#ifdef SHADOW\n\tuniform vec3 u_ShadowLightDirection;\n#endif\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\n\tattribute vec2 a_Texcoord0;\n\tvarying vec2 v_Texcoord0;\n#endif\n\nvec4 shadowCasterVertex()\n{\n\tmat4 worldMat;\n\t#ifdef GPU_INSTANCE\n\t\tworldMat = a_WorldMat;\n\t#else\n\t\tworldMat = u_WorldMat;\n\t#endif\n\t\n\t#ifdef BONE\n\t\tmat4 skinTransform;\n\t \t#ifdef SIMPLEBONE\n\t\t\tfloat currentPixelPos;\n\t\t\t#ifdef GPU_INSTANCE\n\t\t\t\tcurrentPixelPos = a_SimpleTextureParams.x+a_SimpleTextureParams.y;\n\t\t\t#else\n\t\t\t\tcurrentPixelPos = u_SimpleAnimatorParams.x+u_SimpleAnimatorParams.y;\n\t\t\t#endif\n\t\t\tfloat offset = 1.0/u_SimpleAnimatorTextureSize;\n\t\t\tskinTransform =  loadMatFromTexture(currentPixelPos,int(a_BoneIndices.x),offset) * a_BoneWeights.x;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.y),offset) * a_BoneWeights.y;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.z),offset) * a_BoneWeights.z;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.w),offset) * a_BoneWeights.w;\n\t\t#else\n\t\t\tskinTransform =  u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\t#endif\n\t\tworldMat = worldMat * skinTransform;\n\t#endif\n\n\tvec4 positionWS = worldMat * a_Position;\n\tvec3 normalWS = normalize(a_Normal*INVERSE_MAT(mat3(worldMat)));//if no normalize will cause precision problem\n\n\t#ifdef SHADOW\n\t\tpositionWS.xyz = applyShadowBias(positionWS.xyz,normalWS,u_ShadowLightDirection);\n\t#endif\n\n\tvec4 positionCS = u_ViewProjection * positionWS;\n\t#ifdef SHADOW_SPOT\n\t\tpositionCS.z = positionCS.z-u_ShadowBias.x/positionCS.w;\n\t#endif\n\tpositionCS.z = max(positionCS.z, 0.0);//min ndc z is 0.0\n\t\n\t// //TODO没考虑UV动画呢\n\t// #if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t// \tv_Texcoord0=a_Texcoord0;\n\t// #endif\n    return positionCS;\n}\n'},function(t,e,i){"use strict";e.a="// #ifdef ALPHATEST\n// \tuniform float u_AlphaTestValue;\n// #endif\n\n// #ifdef DIFFUSEMAP\n// \tuniform sampler2D u_DiffuseTexture;\n// #endif\n\n// #if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n// \tvarying vec2 v_Texcoord0;\n// #endif\n\nvec4 shadowCasterFragment()\n{\n    return vec4(0.0);\n    // #if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t// \tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t// \tif( alpha < u_AlphaTestValue )\n\t// \t{\n\t// \t\tdiscard;\n\t// \t}\n\t// #endif\n}\n"},function(t,e,i){"use strict";e.a="#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec3 v_Texcoord;\n\nuniform samplerCube u_CubeTexture;\nuniform float u_Exposure;\nuniform vec4 u_TintColor;\n\n\nvoid main()\n{\t\n\tvec3 color=textureCube(u_CubeTexture, v_Texcoord).rgb*u_TintColor.rgb*u_Exposure*2.0;\n\tgl_FragColor=vec4(color,1.0);\n}\n\n"},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#include "Lighting.glsl";\n\nattribute vec4 a_Position;\nuniform mat4 u_ViewProjection;\nuniform float u_Rotation;\nvarying vec3 v_Texcoord;\n\n\nvec4 rotateAroundYInDegrees (vec4 vertex, float degrees)\n{\n\tfloat angle = degrees * 3.141593 / 180.0;\n\tfloat sina=sin(angle);\n\tfloat cosa=cos(angle);\n\tmat2 m = mat2(cosa, -sina, sina, cosa);\n\treturn vec4(m*vertex.xz, vertex.yw).xzyw;\n}\n\t\t\nvoid main()\n{\n\tvec4 position=rotateAroundYInDegrees(a_Position,u_Rotation);\n\tgl_Position = u_ViewProjection*position;\n\tv_Texcoord=vec3(-a_Position.x,a_Position.yz);//转换坐标系\n\tgl_Position=remapGLPositionZ(gl_Position);\n}\n'},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Lighting.glsl";\n\nconst float MIE_G = -0.990;\nconst float MIE_G2 = 0.9801;\nconst float SKY_GROUND_THRESHOLD = 0.02;\n\nuniform float u_SunSize;\nuniform float u_SunSizeConvergence;\nuniform DirectionLight u_SunLight;\n\n\nvarying vec3 v_GroundColor;\nvarying vec3 v_SkyColor;\n\n\n#ifdef SUN_HIGH_QUALITY\n\tvarying vec3 v_Vertex;\n#elif defined(SUN_SIMPLE)\n\tvarying vec3 v_RayDir;\n#else\n\tvarying float v_SkyGroundFactor;\n#endif\n\n#if defined(SUN_HIGH_QUALITY)||defined(SUN_SIMPLE)\n\tvarying vec3 v_SunColor;\n#endif\n\n// Calculates the Mie phase function\nfloat getMiePhase(float eyeCos, float eyeCos2) {\n\tfloat temp = 1.0 + MIE_G2 - 2.0 * MIE_G * eyeCos;\n\ttemp = pow(temp, pow(u_SunSize,0.65) * 10.0);\n\ttemp = max(temp,1.0e-4); // prevent division by zero, esp. in half precision\n\ttemp = 1.5 * ((1.0 - MIE_G2) / (2.0 + MIE_G2)) * (1.0 + eyeCos2) / temp;\n\treturn temp;\n}\n\n// Calculates the sun shape\nfloat calcSunAttenuation(vec3 lightPos, vec3 ray) {\n\t#ifdef SUN_HIGH_QUALITY\n\t\tfloat focusedEyeCos = pow(clamp(dot(lightPos, ray),0.0,1.0), u_SunSizeConvergence);\n\t\treturn getMiePhase(-focusedEyeCos, focusedEyeCos * focusedEyeCos);\n\t#else //SUN_SIMPLE\n\t\tvec3 delta = lightPos - ray;\n\t\tfloat dist = length(delta);\n\t\tfloat spot = 1.0 - smoothstep(0.0, u_SunSize, dist);\n\t\treturn spot * spot;\n\t#endif\n}\n\nvoid main() {\n\t// if y > 1 [eyeRay.y < -SKY_GROUND_THRESHOLD] - ground\n\t// if y >= 0 and < 1 [eyeRay.y <= 0 and > -SKY_GROUND_THRESHOLD] - horizon\n\t// if y < 0 [eyeRay.y > 0] - sky\n\tvec3 col = vec3(0.0, 0.0, 0.0);\n\n\t#ifdef SUN_HIGH_QUALITY\n\t\tvec3 ray = normalize(v_Vertex);\n\t\tfloat y = ray.y / SKY_GROUND_THRESHOLD;\n\t#elif defined(SUN_SIMPLE) \n\t\tvec3 ray = v_RayDir;\n\t\tfloat y = ray.y / SKY_GROUND_THRESHOLD;\t\n\t#else\n\t\tfloat y = v_SkyGroundFactor;\n\t#endif\n\n\t// if we did precalculate color in vprog: just do lerp between them\n\tcol = mix(v_SkyColor, v_GroundColor, clamp(y,0.0,1.0));\n\n\t#if defined(SUN_HIGH_QUALITY)||defined(SUN_SIMPLE)\n\t\tif (y < 0.0)\n\t\t\tcol += v_SunColor * calcSunAttenuation(-u_SunLight.direction, -ray);\n\t#endif\n\n\tcol = sqrt(col);//linear space convert to gamma space\n\tgl_FragColor=vec4(col,1.0);\n}\n\n'},function(t,e,i){"use strict";e.a="#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include \"Lighting.glsl\";\n\n#define OUTER_RADIUS 1.025\n#define RAYLEIGH (mix(0.0, 0.0025, pow(u_AtmosphereThickness,2.5)))// Rayleigh constant Rayleigh为夜空光和极光亮度单位\n#define MIE 0.0010             // Mie constant 米氏散射\n#define SUN_BRIGHTNESS 20.0    // Sun brightness\n#define MAX_SCATTER 50.0 // Maximum scattering value, to prevent math overflows on Adrenos\n\nconst float SKY_GROUND_THRESHOLD = 0.02;\nconst float outerRadius = OUTER_RADIUS;\nconst float outerRadius2 = OUTER_RADIUS*OUTER_RADIUS;\nconst float innerRadius = 1.0;\nconst float innerRadius2 = 1.0;\nconst float cameraHeight = 0.0001;\n\nconst float HDSundiskIntensityFactor = 15.0;\nconst float simpleSundiskIntensityFactor = 27.0;\n\nconst float sunScale = 400.0 * SUN_BRIGHTNESS;\nconst float kmESun = MIE * SUN_BRIGHTNESS;\nconst float km4PI = MIE * 4.0 * 3.14159265;\nconst float scale = 1.0 / (OUTER_RADIUS - 1.0);\nconst float scaleDepth = 0.25;\nconst float scaleOverScaleDepth = (1.0 / (OUTER_RADIUS - 1.0)) / 0.25;\nconst float samples = 2.0; // THIS IS UNROLLED MANUALLY, DON'T TOUCH\n\n// RGB wavelengths        .35 (.62=158), .43 (.68=174), .525 (.75=190)\nconst vec3 c_DefaultScatteringWavelength = vec3(0.65, 0.57, 0.475);//默认散射波长\nconst vec3 c_VariableRangeForScatteringWavelength = vec3(0.15, 0.15, 0.15);//散射播放的可变范围\n\nattribute vec4 a_Position;\n\nuniform mat4 u_ViewProjection;\nuniform vec3 u_SkyTint;\nuniform vec3 u_GroundTint;\nuniform float u_Exposure;\nuniform float u_AtmosphereThickness;\nuniform DirectionLight u_SunLight;\n\nvarying vec3 v_GroundColor;\nvarying vec3 v_SkyColor;\n\n#ifdef SUN_HIGH_QUALITY\n\tvarying vec3 v_Vertex;\n#elif defined(SUN_SIMPLE)\n\tvarying vec3 v_RayDir;\n#else\n\tvarying float v_SkyGroundFactor;\n#endif\n\n#if defined(SUN_HIGH_QUALITY)||defined(SUN_SIMPLE)\n\tvarying vec3 v_SunColor;\n#endif\n\n// Calculates the Rayleigh phase function\nfloat getRayleighPhase(vec3 light, vec3 ray) \n{\n\tfloat eyeCos = dot(light, ray);\n\treturn 0.75 + 0.75*eyeCos*eyeCos;\n}\n\nfloat scaleAngle(float inCos)\n{\n\tfloat x = 1.0 - inCos;\n\treturn 0.25 * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\n\nvoid main () {\n\tgl_Position = u_ViewProjection*a_Position;\n\n\tvec3 skyTintInGammaSpace = u_SkyTint;//支持非GAMMA空间后要调整\n\tvec3 scatteringWavelength = mix(c_DefaultScatteringWavelength-c_VariableRangeForScatteringWavelength,c_DefaultScatteringWavelength+c_VariableRangeForScatteringWavelength,vec3(1.0) - skyTintInGammaSpace); // using Tint in sRGB+ gamma allows for more visually linear interpolation and to keep (0.5) at (128, gray in sRGB) point\n\tvec3 invWavelength = 1.0 / pow(scatteringWavelength, vec3(4.0));\n\n\tfloat krESun = RAYLEIGH * SUN_BRIGHTNESS;\n\tfloat kr4PI = RAYLEIGH * 4.0 * 3.14159265;\n\n\tvec3 cameraPos = vec3(0.0,innerRadius + cameraHeight,0.0); // The camera's current position\n\n\t// Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n\tvec3 eyeRay = normalize(a_Position.xyz);\n\n\tfloat far = 0.0;\n\tvec3 cIn, cOut;\n\tif (eyeRay.y >= 0.0) {// Sky\n\t\t// Calculate the length of the \"atmosphere\"\n\t\tfar = sqrt(outerRadius2 + innerRadius2 * eyeRay.y * eyeRay.y - innerRadius2) - innerRadius * eyeRay.y;\n\n\t\t// Calculate the ray's starting position, then calculate its scattering offset\n\t\tfloat height = innerRadius + cameraHeight;\n\t\tfloat depth = exp(scaleOverScaleDepth * -cameraHeight);\n\t\tfloat startAngle = dot(eyeRay, cameraPos) / height;\n\t\tfloat startOffset = depth*scaleAngle(startAngle);\n\n\t\t// Initialize the scattering loop variables\n\t\tfloat sampleLength = far / samples;\n\t\tfloat scaledLength = sampleLength * scale;\n\t\tvec3 sampleRay = eyeRay * sampleLength;\n\t\tvec3 samplePoint = cameraPos + sampleRay * 0.5;\n\n\t\tvec3 frontColor = vec3(0.0);\n\t\t//unrolling this manually to avoid some platform for loop slow\n\t\t{\n\t\t\tfloat height = length(samplePoint);\n\t\t\tfloat depth = exp(scaleOverScaleDepth * (innerRadius - height));\n\t\t\tfloat lightAngle = dot(-u_SunLight.direction, samplePoint) / height;\n\t\t\tfloat cameraAngle = dot(eyeRay, samplePoint) / height;\n\t\t\tfloat scatter = (startOffset + depth*(scaleAngle(lightAngle) - scaleAngle(cameraAngle)));\n\t\t\tvec3 attenuate = exp(-clamp(scatter, 0.0, MAX_SCATTER) * (invWavelength * kr4PI + km4PI));\n\n\t\t\tfrontColor += attenuate * (depth * scaledLength);\n\t\t\tsamplePoint += sampleRay;\n\t\t}\n\t\t{\n\t\t\tfloat height = length(samplePoint);\n\t\t\tfloat depth = exp(scaleOverScaleDepth * (innerRadius - height));\n\t\t\tfloat lightAngle = dot(-u_SunLight.direction, samplePoint) / height;\n\t\t\tfloat cameraAngle = dot(eyeRay, samplePoint) / height;\n\t\t\tfloat scatter = (startOffset + depth*(scaleAngle(lightAngle) - scaleAngle(cameraAngle)));\n\t\t\tvec3 attenuate = exp(-clamp(scatter, 0.0, MAX_SCATTER) * (invWavelength * kr4PI + km4PI));\n\n\t\t\tfrontColor += attenuate * (depth * scaledLength);\n\t\t\tsamplePoint += sampleRay;\n\t\t}\n\n\t\t// Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\n\t\tcIn = frontColor * (invWavelength * krESun);\n\t\tcOut = frontColor * kmESun;\n\t} else {// Ground\n\t\tfar = (-cameraHeight) / (min(-0.001, eyeRay.y));\n\t\tvec3 pos = cameraPos + far * eyeRay;\n\n\t\t// Calculate the ray's starting position, then calculate its scattering offset\n\t\tfloat depth = exp((-cameraHeight) * (1.0/scaleDepth));\n\t\tfloat cameraAngle = dot(-eyeRay, pos);\n\t\tfloat lightAngle = dot(-u_SunLight.direction, pos);\n\t\tfloat cameraScale = scaleAngle(cameraAngle);\n\t\tfloat lightScale = scaleAngle(lightAngle);\n\t\tfloat cameraOffset = depth*cameraScale;\n\t\tfloat temp = lightScale + cameraScale;\n\n\t\t// Initialize the scattering loop variables\n\t\tfloat sampleLength = far / samples;\n\t\tfloat scaledLength = sampleLength * scale;\n\t\tvec3 sampleRay = eyeRay * sampleLength;\n\t\tvec3 samplePoint = cameraPos + sampleRay * 0.5;\n\n\t\t// Now loop through the sample rays\n\t\tvec3 frontColor = vec3(0.0, 0.0, 0.0);\n\t\tvec3 attenuate;\n\n\t\t// Loop removed because we kept hitting SM2.0 temp variable limits. Doesn't affect the image too much.\n\t\t{\n\t\t\tfloat height = length(samplePoint);\n\t\t\tfloat depth = exp(scaleOverScaleDepth * (innerRadius - height));\n\t\t\tfloat scatter = depth*temp - cameraOffset;\n\t\t\tattenuate = exp(-clamp(scatter, 0.0, MAX_SCATTER) * (invWavelength * kr4PI + km4PI));\n\t\t\tfrontColor += attenuate * (depth * scaledLength);\n\t\t\tsamplePoint += sampleRay;\n\t\t}\n\n\t\tcIn = frontColor * (invWavelength * krESun + kmESun);\n\t\tcOut = clamp(attenuate, 0.0, 1.0);\n\t}\n\n\t#ifdef SUN_HIGH_QUALITY\n\t\tv_Vertex = -a_Position.xyz;\n\t#elif defined(SUN_SIMPLE) \n\t\tv_RayDir = -eyeRay;\n\t#else\n\t\tv_SkyGroundFactor = -eyeRay.y / SKY_GROUND_THRESHOLD;\n\t#endif\n\n\t// if we want to calculate color in vprog:\n\t// in case of linear: multiply by _Exposure in here (even in case of lerp it will be common multiplier, so we can skip mul in fshader)\n\tv_GroundColor = u_Exposure * (cIn + u_GroundTint*u_GroundTint * cOut);//u_GroundColor*u_GroundColor is gamma space convert to linear space\n\tv_SkyColor    = u_Exposure * (cIn * getRayleighPhase(-u_SunLight.direction, -eyeRay));\n\n\t\n\t// The sun should have a stable intensity in its course in the sky. Moreover it should match the highlight of a purely specular material.\n\t// This matching was done using the Unity3D standard shader BRDF1 on the 5/31/2017\n\t// Finally we want the sun to be always bright even in LDR thus the normalization of the lightColor for low intensity.\n\tfloat lightColorIntensity = clamp(length(u_SunLight.color), 0.25, 1.0);\n\n\t#ifdef SUN_HIGH_QUALITY \n\t\tv_SunColor = HDSundiskIntensityFactor * clamp(cOut,0.0,1.0) * u_SunLight.color / lightColorIntensity;\n\t#elif defined(SUN_SIMPLE) \n\t\tv_SunColor = simpleSundiskIntensityFactor * clamp(cOut * sunScale,0.0,1.0) * u_SunLight.color / lightColorIntensity;\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n}\n"},function(t,e,i){"use strict";e.a="#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nuniform sampler2D u_MainTexture;\nuniform vec4 u_MainColor;\n\nvarying vec2 v_Texcoord0;\nvarying vec4 v_Color;\n\nvoid main()\n{\n\tvec4 color = 2.0 * u_MainColor * v_Color;\n\t#ifdef MAINTEXTURE\n\t\tvec4 mainTextureColor = texture2D(u_MainTexture, v_Texcoord0);\n\t\tcolor *= mainTextureColor;\n\t#endif\n\tgl_FragColor = color;\n}\n\n     "},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n#include "Lighting.glsl";\n\nattribute vec3 a_Position;\nattribute vec3 a_OffsetVector;\nattribute vec4 a_Color;\nattribute float a_Texcoord0X;\nattribute float a_Texcoord0Y;\nattribute float a_BirthTime;\n\nuniform mat4 u_View;\nuniform mat4 u_Projection;\n\nuniform vec4 u_TilingOffset;\n\nuniform float u_CurTime;\nuniform float u_LifeTime;\nuniform vec4 u_WidthCurve[10];\nuniform int u_WidthCurveKeyLength;\n\nvarying vec2 v_Texcoord0;\nvarying vec4 v_Color;\n\nfloat hermiteInterpolate(float t, float outTangent, float inTangent, float duration, float value1, float value2)\n{\n\tfloat t2 = t * t;\n\tfloat t3 = t2 * t;\n\tfloat a = 2.0 * t3 - 3.0 * t2 + 1.0;\n\tfloat b = t3 - 2.0 * t2 + t;\n\tfloat c = t3 - t2;\n\tfloat d = -2.0 * t3 + 3.0 * t2;\n\treturn a * value1 + b * outTangent * duration + c * inTangent * duration + d * value2;\n}\n\nfloat getCurWidth(in float normalizeTime)\n{\n\tfloat width;\n\tif(normalizeTime == 0.0){\n\t\twidth=u_WidthCurve[0].w;\n\t}\n\telse if(normalizeTime >= 1.0){\n\t\twidth=u_WidthCurve[u_WidthCurveKeyLength - 1].w;\n\t}\n\telse{\n\t\tfor(int i = 0; i < 10; i ++ )\n\t\t{\n\t\t\tif(normalizeTime == u_WidthCurve[i].x){\n\t\t\t\twidth=u_WidthCurve[i].w;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\tvec4 lastFrame = u_WidthCurve[i];\n\t\t\tvec4 nextFrame = u_WidthCurve[i + 1];\n\t\t\tif(normalizeTime > lastFrame.x && normalizeTime < nextFrame.x)\n\t\t\t{\n\t\t\t\tfloat duration = nextFrame.x - lastFrame.x;\n\t\t\t\tfloat t = (normalizeTime - lastFrame.x) / duration;\n\t\t\t\tfloat outTangent = lastFrame.z;\n\t\t\t\tfloat inTangent = nextFrame.y;\n\t\t\t\tfloat value1 = lastFrame.w;\n\t\t\t\tfloat value2 = nextFrame.w;\n\t\t\t\twidth=hermiteInterpolate(t, outTangent, inTangent, duration, value1, value2);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\treturn width;\n}\t\n\nvoid main()\n{\n\tfloat normalizeTime = (u_CurTime - a_BirthTime) / u_LifeTime;\n\t\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0 = vec2(a_Texcoord0X, 1.0 - a_Texcoord0Y) * u_TilingOffset.xy + u_TilingOffset.zw;\n\t#else\n\t\tv_Texcoord0 = vec2(a_Texcoord0X, a_Texcoord0Y);\n\t#endif\n\t\n\tv_Color = a_Color;\n\t\n\tgl_Position = u_Projection * u_View * vec4(a_Position + a_OffsetVector * getCurWidth(normalizeTime),1.0);\n\tgl_Position=remapGLPositionZ(gl_Position);\n}\n'},function(t,e,i){"use strict";e.a="#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\tvarying vec4 v_Color;\n#endif\n\n#ifdef ALBEDOTEXTURE\n\tuniform sampler2D u_AlbedoTexture;\n\tvarying vec2 v_Texcoord0;\n#endif\n\nuniform vec4 u_AlbedoColor;\n\n#ifdef ALPHATEST\n\tuniform float u_AlphaTestValue;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\nvoid main()\n{\n\tvec4 color =  u_AlbedoColor;\n\t#ifdef ALBEDOTEXTURE\n\t\tcolor *= texture2D(u_AlbedoTexture, v_Texcoord0);\n\t#endif\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\t\tcolor *= v_Color;\n\t#endif\n\t\n\t#ifdef ALPHATEST\n\t\tif(color.a < u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n\t\n\tgl_FragColor = color;\n\t\n\t#ifdef FOG\n\t\tfloat lerpFact = clamp((1.0 / gl_FragCoord.w - u_FogStart) / u_FogRange, 0.0, 1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.0), lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, u_FogColor, lerpFact);\n\t\t#endif\n\t#endif\n\t\n}\n\n"},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n#include "Lighting.glsl";\n#include "LayaUtile.glsl";\n\nattribute vec4 a_Position;\n\nattribute vec2 a_Texcoord0;\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_MvpMatrix;\n#else\n\tuniform mat4 u_MvpMatrix;\n#endif\n\nattribute vec4 a_Color;\nvarying vec4 v_Color;\nvarying vec2 v_Texcoord0;\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvoid main() {\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform;\n\t \t#ifdef SIMPLEBONE\n\t\t\tfloat currentPixelPos;\n\t\t\t#ifdef GPU_INSTANCE\n\t\t\t\tcurrentPixelPos = a_SimpleTextureParams.x+a_SimpleTextureParams.y;\n\t\t\t#else\n\t\t\t\tcurrentPixelPos = u_SimpleAnimatorParams.x+u_SimpleAnimatorParams.y;\n\t\t\t#endif\n\t\t\tfloat offset = 1.0/u_SimpleAnimatorTextureSize;\n\t\t\tskinTransform =  loadMatFromTexture(currentPixelPos,int(a_BoneIndices.x),offset) * a_BoneWeights.x;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.y),offset) * a_BoneWeights.y;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.z),offset) * a_BoneWeights.z;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.w),offset) * a_BoneWeights.w;\n\t\t#else\n\t\t\tskinTransform =  u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\t#endif\n\t\tposition=skinTransform*a_Position;\n\t #else\n\t\tposition=a_Position;\n\t#endif\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\n\t#else\n\t\tv_Texcoord0=a_Texcoord0;\n\t#endif\n\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\t\tv_Color = a_Color;\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n}'},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#ifdef MAINTEXTURE\n\tuniform sampler2D u_MainTexture;\n#endif\n\n#ifdef NORMALTEXTURE\n\tuniform sampler2D u_NormalTexture;\n#endif\n\nuniform vec4 u_HorizonColor;\n\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\n\n\n#include "Lighting.glsl"\n\n\n\nvec3 NormalSampleToWorldSpace(vec4 normalMapSample) {\n\tvec3 normalT;\n\tnormalT.x = 2.0 * normalMapSample.x - 1.0;\n\tnormalT.y = 1.0 - 2.0 * normalMapSample.y;\n\tnormalT.z = sqrt(1.0 - clamp(dot(normalT.xy, normalT.xy), 0.0, 1.0));\n\n\tvec3 bumpedNormal = normalize(normalT);\n\n\treturn bumpedNormal;\n}\n\n\nvoid main()\n{\n\tvec4 bumpColor1 = texture2D(u_NormalTexture, v_Texcoord0);\n\tvec4 bumpColor2 = texture2D(u_NormalTexture, v_Texcoord1);\n\n\tvec3 normal1 = NormalSampleToWorldSpace(bumpColor1);\n\tvec3 normal2 = NormalSampleToWorldSpace(bumpColor2);\n\t\n\tvec3 normal = normalize((normal1 + normal2) * 0.5);\n\tvec3 viewDir = normalize(v_ViewDir);\n\tfloat fresnel = dot(viewDir, normal);\n\t\n\tvec4 waterColor = texture2D(u_MainTexture, vec2(fresnel, fresnel));\n\t\n\tvec4 color;\n\tcolor.rgb = mix(waterColor.rgb, u_HorizonColor.rgb, vec3(waterColor.a));\n\tcolor.a = u_HorizonColor.a;\n\t\n\tgl_FragColor = color;\n}\n\n\n'},function(t,e,i){"use strict";e.a='#include "Lighting.glsl";\n\nattribute vec4 a_Position;\nattribute vec3 a_Normal;\nattribute vec4 a_Tangent0;\n\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_WorldMat;\nuniform vec3 u_CameraPos;\nuniform float u_WaveScale;\nuniform vec4 u_WaveSpeed;\nuniform float u_Time;\n\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\n\nvoid main()\n{\n\tvec4 positionWorld = u_WorldMat * a_Position;\n\tvec4 position = u_MvpMatrix * a_Position;\n\t\n\tvec4 temp = vec4(positionWorld.x, positionWorld.z, positionWorld.x, positionWorld.z) * u_WaveScale + u_WaveSpeed * u_WaveScale * u_Time;\n\t\n\tv_Texcoord0 = temp.xy * vec2(0.4, 0.45);\n\tv_Texcoord1 = temp.wz;\n\t\n\tmat3 worldMat = mat3(u_WorldMat);\n\tv_Normal = worldMat * a_Normal;\n\tv_Tangent = worldMat * a_Tangent0.xyz;\n\tv_Binormal = cross(v_Normal, v_Tangent) * a_Tangent0.w;\n\t\n\tv_ViewDir = u_CameraPos - positionWorld.xyz;\n\tgl_Position = position;\n\tgl_Position=remapGLPositionZ(gl_Position);\n}'},function(t,e,i){"use strict";var a=i(87),r=i(551),s=i(552),n=i(553),o=i(287),l=i(290),h=i(181),_=i(192),c=i(33),d=i(303),u=i(136),f=i(30),m=i(305),p=i(103);class g{static _createSprite3DInstance(t,e,i){var u;switch(t.type){case"Scene3D":u=new h.a;break;case"Sprite3D":u=new c.a;break;case"MeshSprite3D":u=new o.a,i&&t.props.isStatic&&i.push(u);break;case"SkinnedMeshSprite3D":u=new _.a;break;case"SimpleSkinnedMeshSprite3D":u=new m.a;break;case"ShuriKenParticle3D":u=new l.a;break;case"Camera":u=new a.a;break;case"DirectionLight":u=new r.a;break;case"PointLight":u=new s.a;break;case"SpotLight":u=new n.a;break;case"TrailSprite3D":u=new d.a;break;case"ReflectionProbe":u=new p.a;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var f=t.child;if(f)for(var v=0,T=f.length;v<T;v++){var E=g._createSprite3DInstance(f[v],e,i);u.addChild(E)}return e[t.instanceID]=u,u}static _createComponentInstance(t,e,i){var a=e[t.instanceID];a._parse(t.props,e);var r=t.child;if(r)for(var s=0,n=r.length;s<n;s++)g._createComponentInstance(r[s],e,i);var o=t.components;if(o)for(var l=0,h=o.length;l<h;l++){var _=o[l],c=f.a.getRegClass(_.type);if(c)a.addComponent(c)._parse(_,i);else console.warn("Unkown component type.")}}static _createNodeByJson02(t,e){var i={},a={component:[],data:[]},r=g._createSprite3DInstance(t,i,e);return g._createComponentInstance(t,i,a),g._createInteractInstance(a,i),r}static _createInteractInstance(t,e){for(var i=t.component,a=t.data,r=0,s=i.length;r<s;r++)i[r]._parseInteractive(a[r],e)}static _parse(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];var e,i=t.data,a=[];switch(t.version){case"LAYAHIERARCHY:02":e=g._createNodeByJson02(i,a);break;default:e=g._createNodeByJson(i,a)}return u.a.combine(e,a),e}static _parseScene(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];var e,i=t.data,a=[];switch(t.version){case"LAYASCENE3D:02":e=g._createNodeByJson02(i,a);break;default:e=g._createNodeByJson(i,a)}return u.a.combine(null,a),e}static _createNodeByJson(t,e){var i;switch(t.type){case"Scene3D":i=new h.a;break;case"Sprite3D":i=new c.a;break;case"MeshSprite3D":i=new o.a,e&&t.props.isStatic&&e.push(i);break;case"SkinnedMeshSprite3D":i=new _.a;break;case"ShuriKenParticle3D":i=new l.a;break;case"Camera":i=new a.a;break;case"DirectionLight":i=new r.a;break;case"PointLight":i=new s.a;break;case"SpotLight":i=new n.a;break;case"TrailSprite3D":i=new d.a;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var u=t.child;if(u)for(var m=0,p=u.length;m<p;m++){var v=g._createNodeByJson(u[m],e);i.addChild(v)}var T=t.components;if(T)for(var E=0,S=T.length;E<S;E++){var R=T[E],x=f.a.getRegClass(R.type);if(x)i.addComponent(x)._parse(R);else console.warn("Unkown component type.")}return i._parse(t.props,null),i}}e.a=g},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1),n=i(100),o=i(180);e.a=class extends n.a{get shadowCascadesMode(){return this._shadowCascadesMode}set shadowCascadesMode(t){this._shadowCascadesMode=t}get shadowTwoCascadeSplits(){return this._shadowTwoCascadeSplits}set shadowTwoCascadeSplits(t){this._shadowTwoCascadeSplits=t}get shadowFourCascadeSplits(){return this._shadowFourCascadeSplits}set shadowFourCascadeSplits(t){if(t.x>t.y||t.y>t.z||t.z>1)throw"DiretionLight:Invalid value.";t.cloneTo(this._shadowFourCascadeSplits)}constructor(){super(),r()(this,"_direction",new s.a),r()(this,"_shadowCascadesMode",o.a.NoCascades),r()(this,"_shadowTwoCascadeSplits",1/3),r()(this,"_shadowFourCascadeSplits",new s.a(1/15,.2,7/15)),this._lightType=n.b.Directional}_addToLightQueue(){this._scene._directionLights.add(this)}_removeFromLightQueue(){this._scene._directionLights.remove(this)}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(100);e.a=class extends s.a{get range(){return this._range}set range(t){this._range=t}constructor(){super(),r()(this,"_range",void 0),this._range=6,this._lightType=s.b.Point}_addToLightQueue(){this._scene._pointLights.add(this)}_removeFromLightQueue(){this._scene._pointLights.remove(this)}_parse(t,e){super._parse(t,e),this.range=t.range}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(1),n=i(100);e.a=class extends n.a{get spotAngle(){return this._spotAngle}set spotAngle(t){this._spotAngle=Math.max(Math.min(t,179),0)}get range(){return this._range}set range(t){this._range=t}constructor(){super(),r()(this,"_spotAngle",void 0),r()(this,"_range",void 0),r()(this,"_direction",void 0),this._spotAngle=30,this._range=10,this._direction=new s.a,this._lightType=n.b.Spot}_addToLightQueue(){this._scene._spotLights.add(this)}_removeFromLightQueue(){this._scene._spotLights.remove(this)}_parse(t,e){super._parse(t,e),this.range=t.range,this.spotAngle=t.spotAngle}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(6),n=i(190),o=i(135),l=i(33),h=i(64),_=i(191),c=i(9),d=i(5),u=i(20),f=i(102),m=i(104),p=i(13);class g extends n.a{get simpleAnimatorTexture(){return this._simpleAnimatorTexture}set simpleAnimatorTexture(t){this._simpleAnimatorTexture=t,this._simpleAnimatorTextureSize=t.width,this._shaderValues.setTexture(g.SIMPLE_SIMPLEANIMATORTEXTURE,t),t._addReference(),this._shaderValues.setNumber(g.SIMPLE_SIMPLEANIMATORTEXTURESIZE,this._simpleAnimatorTextureSize)}get simpleAnimatorOffset(){return this._simpleAnimatorOffset}set simpleAnimatorOffset(t){t.cloneTo(this._simpleAnimatorOffset)}constructor(t){super(t),r()(this,"_simpleAnimatorTexture",void 0),r()(this,"_simpleAnimatorParams",void 0),r()(this,"_simpleAnimatorTextureSize",void 0),r()(this,"_simpleAnimatorOffset",void 0),r()(this,"_bonesNums",void 0),this._simpleAnimatorParams=new d.a,this._simpleAnimatorOffset=new u.a,this._shaderValues.addDefine(_.a.SHADERDEFINE_SIMPLEBONE),this._shaderValues.addDefine(_.a.SHADERDEFINE_BONE)}_computeAnimatorParamsData(){this._cacheMesh&&(this._simpleAnimatorParams.x=this._simpleAnimatorOffset.x,this._simpleAnimatorParams.y=Math.round(this._simpleAnimatorOffset.y)*this._bonesNums*4)}_createRenderElement(){return new o.a}_setCacheAnimator(t){this._cacheAnimator=t,this._shaderValues.addDefine(_.a.SHADERDEFINE_SIMPLEBONE)}_onMeshChange(t){super._onMeshChange(t),this._cacheMesh=t}_renderUpdate(t,e){var i=t.renderElement;switch(i.renderType){case h.a.RENDERTYPE_NORMAL:if(this._cacheAnimator){var a=this._cacheAnimator.owner.transform.worldMatrix;this._shaderValues.setMatrix4x4(l.a.WORLDMATRIX,a)}else this._shaderValues.setMatrix4x4(l.a.WORLDMATRIX,e.worldMatrix);this._computeAnimatorParamsData(),this._shaderValues.setVector(g.SIMPLE_SIMPLEANIMATORPARAMS,this._simpleAnimatorParams);break;case h.a.RENDERTYPE_INSTANCEBATCH:var r=f.a.instance.instanceWorldMatrixData,s=i.instanceBatchElementList,n=s.elements,o=s.length;if(this._cacheAnimator)for(var _=0;_<o;_++){var c=n[_].render._cacheAnimator.owner._transform.worldMatrix;r.set(c.elements,16*_)}else for(_=0;_<o;_++)r.set(n[_]._transform.worldMatrix.elements,16*_);var d=f.a.instance.instanceWorldMatrixBuffer;d.orphanStorage(),d.setData(r.buffer,0,0,16*o*4),this._shaderValues.addDefine(m.a.SHADERDEFINE_GPU_INSTANCE);var u=f.a.instance.instanceSimpleAnimatorData;if(this._cacheAnimator)for(_=0;_<o;_++){var p=n[_].render;p._computeAnimatorParamsData();var v=p._simpleAnimatorParams,T=4*_;u[T]=v.x,u[T+1]=v.y}else for(_=0;_<o;_++)u[T]=0,u[T+1]=0;var E=f.a.instance.instanceSimpleAnimatorBuffer;E.orphanStorage(),E.setData(u.buffer,0,0,4*o*4)}}_renderUpdateWithCamera(t,e){var i=t.projectionViewMatrix;if(i){var a=t.renderElement;switch(a.renderType){case h.a.RENDERTYPE_NORMAL:if(this._cacheAnimator){var r=this._cacheAnimator.owner._transform.worldMatrix;c.a.multiply(i,r,this._projectionViewWorldMatrix),this._shaderValues.setMatrix4x4(l.a.MVPMATRIX,this._projectionViewWorldMatrix)}else c.a.multiply(i,e.worldMatrix,this._projectionViewWorldMatrix),this._shaderValues.setMatrix4x4(l.a.MVPMATRIX,this._projectionViewWorldMatrix);break;case h.a.RENDERTYPE_INSTANCEBATCH:var s=f.a.instance.instanceMVPMatrixData,n=a.instanceBatchElementList,o=n.elements,_=n.length;if(this._cacheAnimator)for(var d=0;d<_;d++){var u=o[d].render._cacheAnimator.owner._transform.worldMatrix;p.a.mulMatrixByArray(i.elements,0,u.elements,0,s,16*d)}else for(d=0;d<_;d++){u=o[d]._transform.worldMatrix;p.a.mulMatrixByArray(i.elements,0,u.elements,0,s,16*d)}var m=f.a.instance.instanceMVPMatrixBuffer;m.orphanStorage(),m.setData(s.buffer,0,0,16*_*4)}}}_destroy(){this._cacheRootBone&&!this._cacheRootBone.destroyed&&this._cacheRootBone.transform.off(s.a.TRANSFORM_CHANGED,this,this._onWorldMatNeedChange),this._simpleAnimatorTexture&&this._simpleAnimatorTexture._removeReference(),this._simpleAnimatorTexture=null}}e.a=g,r()(g,"SIMPLE_SIMPLEANIMATORTEXTURE",void 0),r()(g,"SIMPLE_SIMPLEANIMATORPARAMS",void 0),r()(g,"SIMPLE_SIMPLEANIMATORTEXTURESIZE",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a);e.a=class{constructor(t,e,i,a){r()(this,"_idata",[])}getArrayData(){return this._idata}getPtrID(){return 0}beginEncoding(){}endEncoding(){}clearEncoding(){this._idata.length=0}getCount(){return this._idata.length}add_ShaderValue(t){this._idata.push(t)}addShaderUniform(t){this.add_ShaderValue(t)}}},function(t,e,i){"use strict";var a=i(90),r=i(106),s=i(557),n=i(558);class o{static _parse(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];var e=new r.a;return o.read(t,e,e._subMeshes),e}static read(t,e,i){var r=new a.a(t);r.pos=0;var o=r.readUTFString();switch(o){case"LAYAMODEL:0301":case"LAYAMODEL:0400":case"LAYAMODEL:0401":s.a.parse(r,o,e,i);break;case"LAYAMODEL:05":case"LAYAMODEL:COMPRESSION_05":case"LAYAMODEL:0501":case"LAYAMODEL:COMPRESSION_0501":n.a.parse(r,o,e,i);break;default:throw new Error("MeshReader: unknown mesh version.")}e._setSubMeshes(i),"LAYAMODEL:0501"!=o&&"LAYAMODEL:COMPRESSION_0501"!=o&&e.calculateBounds()}}e.a=o},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(57),n=i(14),o=i(25),l=i(9),h=i(106),_=i(137),c=i(2),d=i(39);class u{static parse(t,e,i,a){u._mesh=i,u._subMeshes=a,u._version=e,u._readData=t,u.READ_DATA(),u.READ_BLOCK(),u.READ_STRINGS();for(var r=0,s=u._BLOCK.count;r<s;r++){u._readData.pos=u._BLOCK.blockStarts[r];var n=u._readData.getUint16(),o=u._strings[n],l=u["READ_"+o];if(null==l)throw new Error("model file err,no this function:"+n+" "+o);l.call(null)}u._strings.length=0,u._readData=null,u._version=null,u._mesh=null,u._subMeshes=null}static _readString(){return u._strings[u._readData.getUint16()]}static READ_DATA(){u._DATA.offset=u._readData.getUint32(),u._DATA.size=u._readData.getUint32()}static READ_BLOCK(){for(var t=u._BLOCK.count=u._readData.getUint16(),e=u._BLOCK.blockStarts=[],i=u._BLOCK.blockLengths=[],a=0;a<t;a++)e.push(u._readData.getUint32()),i.push(u._readData.getUint32())}static READ_STRINGS(){var t=u._readData.getUint32(),e=u._readData.getUint16(),i=u._readData.pos;u._readData.pos=t+u._DATA.offset;for(var a=0;a<e;a++)u._strings[a]=u._readData.readUTFString();u._readData.pos=i}static READ_MESH(){var t,e=c.a.instance,i=(u._readString(),u._readData.__getBuffer()),a=0,r=u._readData.getInt16(),_=u._DATA.offset;for(t=0;t<r;t++){var f,m=_+u._readData.getUint32(),p=u._readData.getUint32(),g=i.slice(m,m+p),v=new Float32Array(g),T=u._readString();switch(u._version){case"LAYAMODEL:0301":case"LAYAMODEL:0400":f=n.a.getVertexDeclaration(T);break;case"LAYAMODEL:0401":f=n.a.getVertexDeclaration(T,!1);break;default:throw new Error("LoadModelV03: unknown version.")}if(!f)throw new Error("LoadModelV03: unknown vertexDeclaration.");var E=new o.a(4*v.length,e.STATIC_DRAW,!0);E.vertexDeclaration=f,E.setData(v.buffer),u._mesh._vertexBuffer=E,u._mesh._vertexCount+=E._byteLength/f.vertexStride,a+=4*v.length}var S=_+u._readData.getUint32(),R=u._readData.getUint32(),x=new Uint16Array(i.slice(S,S+R)),A=new s.a(d.a.UInt16,R/2,e.STATIC_DRAW,!0);A.setData(x),u._mesh._indexBuffer=A,a+=2*A.indexCount,u._mesh._setBuffer(u._mesh._vertexBuffer,A),u._mesh._setCPUMemory(a),u._mesh._setGPUMemory(a);var y=u._mesh._boneNames=[],I=u._readData.getUint16();for(y.length=I,t=0;t<I;t++)y[t]=u._strings[u._readData.getUint16()];u._readData.pos+=8;var C=u._readData.getUint32(),M=u._readData.getUint32(),D=new Float32Array(i.slice(_+C,_+C+M)),b=D.length,L=u._mesh._inverseBindPosesBuffer=new ArrayBuffer(4*b);for(u._mesh._inverseBindPoses=[],u._mesh._instanceBufferStateType=0!=b?h.a.MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR:h.a.MESH_INSTANCEBUFFER_TYPE_NORMAL,u._mesh._setInstanceBuffer(u._mesh._instanceBufferStateType),t=0;t<b;t+=16){var O=new l.a(D[t+0],D[t+1],D[t+2],D[t+3],D[t+4],D[t+5],D[t+6],D[t+7],D[t+8],D[t+9],D[t+10],D[t+11],D[t+12],D[t+13],D[t+14],D[t+15],new Float32Array(L,4*t,16));u._mesh._inverseBindPoses[t/16]=O}return!0}static READ_SUBMESH(){var t=u._readData.__getBuffer(),e=new _.a(u._mesh);u._readData.getInt16(),u._readData.getUint32(),u._readData.getUint32();var i=u._readData.getUint32(),a=u._readData.getUint32(),r=u._mesh._indexBuffer;e._indexBuffer=r,e._setIndexRange(i,a);var s=u._mesh._vertexBuffer;e._vertexBuffer=s;var n=u._DATA.offset,o=e._subIndexBufferStart,l=e._subIndexBufferCount,c=e._boneIndicesList,d=u._readData.getUint16();o.length=d,l.length=d,c.length=d;var f=u._mesh._skinnedMatrixCaches,m=u._subMeshes.length;f.length=u._mesh._inverseBindPoses.length;for(var p=0;p<d;p++){o[p]=u._readData.getUint32(),l[p]=u._readData.getUint32();for(var g=u._readData.getUint32(),v=u._readData.getUint32(),T=c[p]=new Uint16Array(t.slice(n+g,n+g+v)),E=T.length,S=0;S<E;S++){var R=T[S];f[R]||(f[R]=new h.b(m,p,S))}}return u._subMeshes.push(e),!0}}e.a=u,r()(u,"_BLOCK",{count:0}),r()(u,"_DATA",{offset:0,size:0}),r()(u,"_strings",[]),r()(u,"_readData",void 0),r()(u,"_version",void 0),r()(u,"_mesh",void 0),r()(u,"_subMeshes",void 0)},function(t,e,i){"use strict";var a=i(18),r=(i.n(a),i(0)),s=i.n(r),n=i(2),o=i(114),l=i(57),h=i(39),_=i(14),c=i(25),d=i(9),u=i(106),f=i(137);class m{static parse(t,e,i,a){m._mesh=i,m._subMeshes=a,m._version=e,m._readData=t,m.READ_DATA(),m.READ_BLOCK(),m.READ_STRINGS();for(var r=0,s=m._BLOCK.count;r<s;r++){m._readData.pos=m._BLOCK.blockStarts[r];var n=m._readData.getUint16(),o=m._strings[n],l=m["READ_"+o];if(null==l)throw new Error("model file err,no this function:"+n+" "+o);l.call(null)}m._strings.length=0,m._readData=null,m._version=null,m._mesh=null,m._subMeshes=null}static _readString(){return m._strings[m._readData.getUint16()]}static READ_DATA(){m._DATA.offset=m._readData.getUint32(),m._DATA.size=m._readData.getUint32()}static READ_BLOCK(){for(var t=m._BLOCK.count=m._readData.getUint16(),e=m._BLOCK.blockStarts=[],i=m._BLOCK.blockLengths=[],a=0;a<t;a++)e.push(m._readData.getUint32()),i.push(m._readData.getUint32())}static READ_STRINGS(){var t=m._readData.getUint32(),e=m._readData.getUint16(),i=m._readData.pos;m._readData.pos=t+m._DATA.offset;for(var a=0;a<e;a++)m._strings[a]=m._readData.readUTFString();m._readData.pos=i}static READ_MESH(){var t,e=n.a.instance,i=0,a=(m._readString(),m._readData),r=a.__getBuffer(),s=a.getInt16(),f=m._DATA.offset;for(t=0;t<s;t++){var p,g,v,T=f+a.getUint32(),E=a.getUint32(),S=m._readString(),R=_.a.getVertexDeclaration(S,!1),x=R.vertexStride,A=S.split(","),y=A.length,I=m._mesh;switch(m._version){case"LAYAMODEL:05":case"LAYAMODEL:0501":p=r.slice(T,T+E*x),g=new Float32Array(p),v=new Uint8Array(p);break;case"LAYAMODEL:COMPRESSION_05":case"LAYAMODEL:COMPRESSION_0501":p=new ArrayBuffer(x*E),g=new Float32Array(p),v=new Uint8Array(p);var C=a.pos;a.pos=T;for(var M=0;M<E;M++)for(var D,b=M*x,L=0;L<y;L++)switch(A[L]){case"POSITION":g[D=b/4]=o.a.convertToNumber(a.getUint16()),g[D+1]=o.a.convertToNumber(a.getUint16()),g[D+2]=o.a.convertToNumber(a.getUint16()),b+=12;break;case"NORMAL":g[D=b/4]=a.getUint8()/127.5-1,g[D+1]=a.getUint8()/127.5-1,g[D+2]=a.getUint8()/127.5-1,b+=12;break;case"COLOR":g[D=b/4]=a.getUint8()/255,g[D+1]=a.getUint8()/255,g[D+2]=a.getUint8()/255,g[D+3]=a.getUint8()/255,b+=16;break;case"UV":case"UV1":g[D=b/4]=o.a.convertToNumber(a.getUint16()),g[D+1]=o.a.convertToNumber(a.getUint16()),b+=8;break;case"BLENDWEIGHT":g[D=b/4]=a.getUint8()/255,g[D+1]=a.getUint8()/255,g[D+2]=a.getUint8()/255,g[D+3]=a.getUint8()/255,b+=16;break;case"BLENDINDICES":v[b]=a.getUint8(),v[b+1]=a.getUint8(),v[b+2]=a.getUint8(),v[b+3]=a.getUint8(),b+=4;break;case"TANGENT":g[D=b/4]=a.getUint8()/127.5-1,g[D+1]=a.getUint8()/127.5-1,g[D+2]=a.getUint8()/127.5-1,g[D+3]=a.getUint8()/127.5-1,b+=16}a.pos=C}var O=new c.a(p.byteLength,e.STATIC_DRAW,!0);O.vertexDeclaration=R,O.setData(p);E=O._byteLength/R.vertexStride;I._indexFormat=E>65535?h.a.UInt32:h.a.UInt16,I._vertexBuffer=O,I._vertexCount+=E,i+=4*g.length}var P,N=f+a.getUint32(),w=a.getUint32();P=I.indexFormat==h.a.UInt32?new Uint32Array(r.slice(N,N+w)):new Uint16Array(r.slice(N,N+w));var B=new l.a(I.indexFormat,P.length,e.STATIC_DRAW,!0);if(B.setData(P),I._indexBuffer=B,I._setBuffer(I._vertexBuffer,B),i+=2*B.indexCount,I._setCPUMemory(i),I._setGPUMemory(i),"LAYAMODEL:0501"==m._version||"LAYAMODEL:COMPRESSION_0501"==m._version){var F=I.bounds,V=F.getMin(),U=F.getMax();V.setValue(a.getFloat32(),a.getFloat32(),a.getFloat32()),U.setValue(a.getFloat32(),a.getFloat32(),a.getFloat32()),F.setMin(V),F.setMax(U),I.bounds=F}var G=I._boneNames=[],H=a.getUint16();for(G.length=H,t=0;t<H;t++)G[t]=m._strings[a.getUint16()];var z=a.getUint32(),k=a.getUint32(),W=new Float32Array(r.slice(f+z,f+z+k)),X=W.length,Y=I._inverseBindPosesBuffer=new ArrayBuffer(4*X);for(I._inverseBindPoses=[],I._instanceBufferStateType=0!=X?u.a.MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR:u.a.MESH_INSTANCEBUFFER_TYPE_NORMAL,I._setInstanceBuffer(I._instanceBufferStateType),t=0;t<X;t+=16){var j=new d.a(W[t+0],W[t+1],W[t+2],W[t+3],W[t+4],W[t+5],W[t+6],W[t+7],W[t+8],W[t+9],W[t+10],W[t+11],W[t+12],W[t+13],W[t+14],W[t+15],new Float32Array(Y,4*t,16));I._inverseBindPoses[t/16]=j}return!0}static READ_SUBMESH(){var t=m._readData,e=t.__getBuffer(),i=new f.a(m._mesh);t.getInt16();var a=t.getUint32(),r=t.getUint32(),s=m._mesh._indexBuffer;i._indexBuffer=s,i._setIndexRange(a,r);var n=m._mesh._vertexBuffer;i._vertexBuffer=n;var o=m._DATA.offset,l=i._subIndexBufferStart,h=i._subIndexBufferCount,_=i._boneIndicesList,c=t.getUint16();l.length=c,h.length=c,_.length=c;var d=m._mesh._skinnedMatrixCaches,p=m._subMeshes.length;d.length=m._mesh._inverseBindPoses.length;for(var g=0;g<c;g++){l[g]=t.getUint32(),h[g]=t.getUint32();for(var v=t.getUint32(),T=t.getUint32(),E=_[g]=new Uint16Array(e.slice(o+v,o+v+T)),S=0,R=E.length;S<R;S++){var x=E[S];d[x]||(d[x]=new u.b(p,g,S))}}return m._subMeshes.push(i),!0}}e.a=m,s()(m,"_BLOCK",{count:0}),s()(m,"_DATA",{offset:0,size:0}),s()(m,"_strings",[]),s()(m,"_readData",void 0),s()(m,"_version",void 0),s()(m,"_mesh",void 0),s()(m,"_subMeshes",void 0)},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(14),n=i(5),o=i(560),l=i(561),h=i(7),_=i(130),c=i(22),d=i(182),u=i(46);class f extends c.a{static __init__(){var t={a_Position:s.a.MESH_POSITION0},e={u_TintColor:h.a.PERIOD_MATERIAL,u_TextureHDRParams:h.a.PERIOD_MATERIAL,u_Rotation:h.a.PERIOD_MATERIAL,u_Texture:h.a.PERIOD_MATERIAL,u_ViewProjection:h.a.PERIOD_CAMERA},i=h.a.add("SkyPanoramic"),a=new _.a(t,e);i.addSubShader(a),a.addShaderPass(l.a,o.a)}get tintColor(){return this._shaderValues.getVector(f.TINTCOLOR)}set tintColor(t){this._shaderValues.setVector(f.TINTCOLOR,t)}get exposure(){return this._exposure}set exposure(t){this._exposure!==t&&(this._exposure=t,this._textureDecodeFormat==d.a.RGBM?this._textureHDRParams.x=t*u.a._rgbmRange:this._textureHDRParams.x=t)}get rotation(){return this._shaderValues.getNumber(f.ROTATION)}set rotation(t){this._shaderValues.setNumber(f.ROTATION,t)}get panoramicTexture(){return this._shaderValues.getTexture(f.TEXTURE)}set panoramicTexture(t){this._shaderValues.setTexture(f.TEXTURE,t)}get panoramicTextureDecodeFormat(){return this._textureDecodeFormat}set panoramicTextureDecodeFormat(t){this._textureDecodeFormat!==t&&(this._textureDecodeFormat=t,t==d.a.RGBM?this._textureHDRParams.x=this._exposure*u.a._rgbmRange:this._textureHDRParams.x=this._exposure)}constructor(){super(),r()(this,"_exposure",1),r()(this,"_textureDecodeFormat",d.a.Normal),r()(this,"_textureHDRParams",new n.a(1,0,0,1)),this.setShaderName("SkyPanoramic");var t=this._shaderValues;t.setVector(f.TINTCOLOR,new n.a(.5,.5,.5,.5)),t.setNumber(f.ROTATION,0),t.setVector(f.TEXTURE_HDR_PARAMS,this._textureHDRParams)}}e.a=f,r()(f,"TINTCOLOR",h.a.propertyNameToID("u_TintColor")),r()(f,"EXPOSURE",h.a.propertyNameToID("u_Exposure")),r()(f,"ROTATION",h.a.propertyNameToID("u_Rotation")),r()(f,"TEXTURE",h.a.propertyNameToID("u_Texture")),r()(f,"TEXTURE_HDR_PARAMS",h.a.propertyNameToID("u_TextureHDRParams"))},function(t,e,i){"use strict";e.a='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#define PI 3.14159265359\n#include "Lighting.glsl";\n\nuniform sampler2D u_Texture;\nuniform vec4 u_TextureHDRParams;\nuniform vec4 u_TintColor;\n\nvarying vec3 v_Texcoord;\nvarying vec2 v_Image180ScaleAndCutoff;\nvarying vec4 v_Layout3DScaleAndOffset;\n\nvec2 ToRadialCoords(vec3 coords)\n{\n\tvec3 normalizedCoords = normalize(coords);\n\tfloat latitude = acos(normalizedCoords.y);\n\tfloat longitude = atan(normalizedCoords.z,normalizedCoords.x);\n\tvec2 sphereCoords = vec2(longitude, latitude) * vec2(0.5/PI, 1.0/PI);\n\treturn vec2(0.5,1.0) - sphereCoords;\n}\n\n\nvoid main()\n{\t\n\tvec2 tc = ToRadialCoords(v_Texcoord);\n\tif (tc.x > v_Image180ScaleAndCutoff.y)\n\t\tgl_FragColor=vec4(0,0,0,1);\n\ttc.x = mod(tc.x*v_Image180ScaleAndCutoff.x, 1.0);\n\ttc = (tc + v_Layout3DScaleAndOffset.xy) * v_Layout3DScaleAndOffset.zw;\n\n\tmediump vec4 tex = texture2D (u_Texture, tc);\n\tmediump vec3 c = decodeHDR (tex, u_TextureHDRParams.x);\n\tc = c * u_TintColor.rgb * 2.0;//Gamma Space is 2.0,linear space is 4.59479380\n\tgl_FragColor=vec4(c, 1.0);\n}\n\n'},function(t,e,i){"use strict";e.a='#include "Lighting.glsl";\n\n#define PI 3.14159265359\n\nattribute vec4 a_Position;\n\nuniform mat4 u_ViewProjection;\nuniform float u_Rotation;\n\nvarying vec3 v_Texcoord;\nvarying vec2 v_Image180ScaleAndCutoff;\nvarying vec4 v_Layout3DScaleAndOffset;\n\nvec4 rotateAroundYInDegrees (vec4 vertex, float degrees)\n{\n\tfloat angle = degrees * PI / 180.0;\n\tfloat sina=sin(angle);\n\tfloat cosa=cos(angle);\n\tmat2 m = mat2(cosa, -sina, sina, cosa);\n\treturn vec4(m*vertex.xz, vertex.yw).xzyw;\n}\n\n\t\t\nvoid main()\n{\n\tvec4 position = rotateAroundYInDegrees(a_Position, u_Rotation);\n\tgl_Position = u_ViewProjection*position;\n\n\tv_Texcoord=vec3(-a_Position.x,-a_Position.y,a_Position.z);// NOTE: -a_Position.x convert coords system\n\n\t// Calculate constant horizontal scale and cutoff for 180 (vs 360) image type\n\tv_Image180ScaleAndCutoff = vec2(1.0, 1.0);// 360 degree mode\n\n\t// Calculate constant scale and offset for 3D layouts\n\tv_Layout3DScaleAndOffset = vec4(0,0,1,1);\n}\n'},function(t,e,i){"use strict";var a=i(306),r=i(50),s=i(125);e.a=class extends a.a{constructor(){super(a.a.CONSTRAINT_FIXED_CONSTRAINT_TYPE),this.breakForce=-1,this.breakTorque=-1}_addToSimulation(){this._simulation&&this._simulation.addConstraint(this,this.enabled)}_removeFromSimulation(){this._simulation.removeConstraint(this),this._simulation=null}_createConstraint(){if(this.ownBody&&this.ownBody._simulation&&this.connectedBody&&this.connectedBody._simulation){var t=r.a._bullet;this._btConstraint=t.btFixedConstraint_create(this.ownBody.btColliderObject,this._btframATrans,this.connectedBody.btColliderObject,this._btframBTrans),this._btJointFeedBackObj=t.btJointFeedback_create(this._btConstraint),t.btTypedConstraint_setJointFeedback(this._btConstraint,this._btJointFeedBackObj),this._simulation=this.owner._scene.physicsSimulation,this._addToSimulation(),r.a._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0)}}_onAdded(){super._onAdded()}_onEnable(){this._btConstraint&&(super._onEnable(),this._btConstraint&&r.a._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0))}_onDisable(){super._onDisable(),this.connectedBody||this._removeFromSimulation(),this._btConstraint&&r.a._bullet.btTypedConstraint_setEnabled(this._btConstraint,!1)}_onDestroy(){super._onDestroy()}_parse(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super._parse(t),-1!=t.rigidbodyID&&-1!=t.connectRigidbodyID&&(e.component.push(this),e.data.push(t)),void 0!=t.breakForce&&(this.breakForce=t.breakForce),void 0!=t.breakTorque&&(this.breakTorque=t.breakTorque)}_parseInteractive(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var i=e[t.rigidbodyID].getComponent(s.a),a=e[t.connectRigidbodyID].getComponent(s.a);this.ownBody=i,this.connectedBody=a}_cloneTo(t){}}},function(t,e,i){"use strict";var a=i(0),r=i.n(a),s=i(306),n=i(50),o=i(1),l=i(125);class h extends s.a{constructor(){super(s.a.CONSTRAINT_D6_SPRING_CONSTRAINT_TYPE),r()(this,"_btAxis",void 0),r()(this,"_btSecondaryAxis",void 0),r()(this,"_axis",new o.a),r()(this,"_secondaryAxis",new o.a),r()(this,"_minLinearLimit",new o.a),r()(this,"_maxLinearLimit",new o.a),r()(this,"_minAngularLimit",new o.a),r()(this,"_maxAngularLimit",new o.a),r()(this,"_linearLimitSpring",new o.a),r()(this,"_angularLimitSpring",new o.a),r()(this,"_linearBounce",new o.a),r()(this,"_angularBounce",new o.a),r()(this,"_linearDamp",new o.a),r()(this,"_angularDamp",new o.a),r()(this,"_xMotion",0),r()(this,"_yMotion",0),r()(this,"_zMotion",0),r()(this,"_angularXMotion",0),r()(this,"_angularYMotion",0),r()(this,"_angularZMotion",0);var t=n.a._bullet;this._btAxis=t.btVector3_create(-1,0,0),this._btSecondaryAxis=t.btVector3_create(0,1,0)}get axis(){return this._axis}get secondaryAxis(){return this._secondaryAxis}set maxAngularLimit(t){t.cloneTo(this._maxAngularLimit)}set minAngularLimit(t){t.cloneTo(this._minAngularLimit)}get maxAngularLimit(){return this._maxAngularLimit}get minAngularLimit(){return this._minAngularLimit}set maxLinearLimit(t){t.cloneTo(this._maxLinearLimit)}set minLinearLimit(t){t.cloneTo(this._minLinearLimit)}get maxLinearLimit(){return this._maxLinearLimit}get minLinearLimit(){return this._minLinearLimit}set XMotion(t){this._xMotion!=t&&(this._xMotion=t,this.setLimit(h.MOTION_LINEAR_INDEX_X,t,-this._maxLinearLimit.x,-this._minLinearLimit.x))}get XMotion(){return this._xMotion}set YMotion(t){this._yMotion!=t&&(this._yMotion=t,this.setLimit(h.MOTION_LINEAR_INDEX_Y,t,this._minLinearLimit.y,this._maxLinearLimit.y))}get YMotion(){return this._yMotion}set ZMotion(t){this._zMotion!=t&&(this._zMotion=t,this.setLimit(h.MOTION_LINEAR_INDEX_Z,t,this._minLinearLimit.z,this._maxLinearLimit.z))}get ZMotion(){return this._zMotion}set angularXMotion(t){this._angularXMotion!=t&&(this._angularXMotion=t,this.setLimit(h.MOTION_ANGULAR_INDEX_X,t,-this._maxAngularLimit.x,-this._minAngularLimit.x))}get angularXMotion(){return this._angularXMotion}set angularYMotion(t){this._angularYMotion!=t&&(this._angularYMotion=t,this.setLimit(h.MOTION_ANGULAR_INDEX_Y,t,this._minAngularLimit.y,this._maxAngularLimit.y))}get angularYMotion(){return this._angularYMotion}set angularZMotion(t){this._angularZMotion!=t&&(this._angularZMotion=t,this.setLimit(h.MOTION_ANGULAR_INDEX_Z,t,this._minAngularLimit.z,this._maxAngularLimit.z))}get angularZMotion(){return this._angularZMotion}set linearLimitSpring(t){o.a.equals(this._linearLimitSpring,t)||(t.cloneTo(this._linearLimitSpring),this.setSpring(h.MOTION_LINEAR_INDEX_X,t.x),this.setSpring(h.MOTION_LINEAR_INDEX_Y,t.y),this.setSpring(h.MOTION_LINEAR_INDEX_Z,t.z))}get linearLimitSpring(){return this._linearLimitSpring}set angularLimitSpring(t){o.a.equals(this._angularLimitSpring,t)||(t.cloneTo(this._angularLimitSpring),this.setSpring(h.MOTION_ANGULAR_INDEX_X,t.x),this.setSpring(h.MOTION_ANGULAR_INDEX_Y,t.y),this.setSpring(h.MOTION_ANGULAR_INDEX_Z,t.z))}get angularLimitSpring(){return this._angularLimitSpring}set linearBounce(t){o.a.equals(this._linearBounce,t)||(t.cloneTo(this._linearBounce),this.setBounce(h.MOTION_LINEAR_INDEX_X,t.x),this.setBounce(h.MOTION_LINEAR_INDEX_Y,t.y),this.setBounce(h.MOTION_LINEAR_INDEX_Z,t.z))}get linearBounce(){return this._linearBounce}set angularBounce(t){o.a.equals(this._angularBounce,t)||(t.cloneTo(this._angularBounce),this.setBounce(h.MOTION_ANGULAR_INDEX_X,t.x),this.setBounce(h.MOTION_ANGULAR_INDEX_Y,t.y),this.setBounce(h.MOTION_ANGULAR_INDEX_Z,t.z))}get angularBounce(){return this._angularBounce}set linearDamp(t){o.a.equals(this._linearDamp,t)||(t.cloneTo(this._linearDamp),this.setDamping(h.MOTION_LINEAR_INDEX_X,t.x),this.setDamping(h.MOTION_LINEAR_INDEX_Y,t.y),this.setDamping(h.MOTION_LINEAR_INDEX_Z,t.z))}get linearDamp(){return this._linearDamp}set angularDamp(t){o.a.equals(this._angularDamp,t)||(t.cloneTo(this._angularDamp),this.setDamping(h.MOTION_ANGULAR_INDEX_X,t.x),this.setDamping(h.MOTION_ANGULAR_INDEX_Y,t.y),this.setDamping(h.MOTION_ANGULAR_INDEX_Z,t.z))}get angularDamp(){return this._angularDamp}set anchor(t){t.cloneTo(this._anchor),this.setFrames()}get anchor(){return this._anchor}set connectAnchor(t){t.cloneTo(this._connectAnchor),this.setFrames()}get connectAnchor(){return this._connectAnchor}setAxis(t,e){if(this._btConstraint){var i=n.a._bullet;this._axis.setValue(t.x,t.y,t.y),this._secondaryAxis.setValue(e.x,e.y,e.z),this._btAxis=i.btVector3_setValue(-t.x,t.y,t.z),this._btSecondaryAxis=i.btVector3_setValue(-e.x,e.y,e.z),i.btGeneric6DofSpring2Constraint_setAxis(this._btConstraint,this._btAxis,this._btSecondaryAxis)}}setLimit(t,e,i,a){if(this._btConstraint){var r=n.a._bullet;switch(e){case h.CONFIG_MOTION_TYPE_LOCKED:r.btGeneric6DofSpring2Constraint_setLimit(this._btConstraint,t,0,0);break;case h.CONFIG_MOTION_TYPE_LIMITED:i<a&&r.btGeneric6DofSpring2Constraint_setLimit(this._btConstraint,t,i,a);break;case h.CONFIG_MOTION_TYPE_FREE:r.btGeneric6DofSpring2Constraint_setLimit(this._btConstraint,t,1,0);break;default:throw"No Type of Axis Motion"}}}setSpring(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._btConstraint){var a=n.a._bullet,r=e>0;a.btGeneric6DofSpring2Constraint_enableSpring(this._btConstraint,t,r),r&&a.btGeneric6DofSpring2Constraint_setStiffness(this._btConstraint,t,e,i)}}setBounce(t,e){if(this._btConstraint){var i=n.a._bullet;e=e<=0?0:e,i.btGeneric6DofSpring2Constraint_setBounce(this._btConstraint,t,e)}}setDamping(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._btConstraint){var a=n.a._bullet;e=e<=0?0:e,a.btGeneric6DofSpring2Constraint_setDamping(this._btConstraint,t,e,i)}}setEquilibriumPoint(t,e){n.a._bullet.btGeneric6DofSpring2Constraint_setEquilibriumPoint(this._btConstraint,t,e)}enableMotor(t,e){n.a._bullet.btGeneric6DofSpring2Constraint_enableMotor(this._btConstraint,t,e)}setServo(t,e){n.a._bullet.btGeneric6DofSpring2Constraint_setServo(this._btConstraint,t,e)}setTargetVelocity(t,e){n.a._bullet.btGeneric6DofSpring2Constraint_setTargetVelocity(this._btConstraint,t,e)}setTargetPosition(t,e){n.a._bullet.btGeneric6DofSpring2Constraint_setServoTarget(this._btConstraint,t,e)}setMaxMotorForce(t,e){n.a._bullet.btGeneric6DofSpring2Constraint_setMaxMotorForce(this._btConstraint,t,e)}setParam(t,e,i){n.a._bullet.btTypedConstraint_setParam(this._btConstraint,t,e,i)}setFrames(){super.setFrames();var t=n.a._bullet;this._btConstraint&&t.btGeneric6DofSpring2Constraint_setFrames(this._btConstraint,this._btframATrans,this._btframBTrans)}_addToSimulation(){this._simulation&&this._simulation.addConstraint(this,this.enabled)}_removeFromSimulation(){this._simulation.removeConstraint(this),this._simulation=null}_createConstraint(){var t=n.a._bullet;this._btConstraint=t.btGeneric6DofSpring2Constraint_create(this.ownBody.btColliderObject,this._btframAPos,this.connectedBody.btColliderObject,this._btframBPos,h.RO_XYZ),this._btJointFeedBackObj=t.btJointFeedback_create(this._btConstraint),t.btTypedConstraint_setJointFeedback(this._btConstraint,this._btJointFeedBackObj),this._simulation=this.owner._scene.physicsSimulation,this._initAllConstraintInfo(),this._addToSimulation(),n.a._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0)}_initAllConstraintInfo(){this.setLimit(h.MOTION_LINEAR_INDEX_X,this._xMotion,-this._maxLinearLimit.x,-this._minLinearLimit.x),this.setLimit(h.MOTION_LINEAR_INDEX_Y,this._yMotion,this._minLinearLimit.y,this._maxLinearLimit.y),this.setLimit(h.MOTION_LINEAR_INDEX_Z,this._zMotion,this._minLinearLimit.z,this._maxLinearLimit.z),this.setLimit(h.MOTION_ANGULAR_INDEX_X,this._angularXMotion,-this._maxAngularLimit.x,-this._minAngularLimit.x),this.setLimit(h.MOTION_ANGULAR_INDEX_Y,this._angularYMotion,this._minAngularLimit.y,this._maxAngularLimit.y),this.setLimit(h.MOTION_ANGULAR_INDEX_Z,this._angularZMotion,this._minAngularLimit.z,this._maxAngularLimit.z),this.setSpring(h.MOTION_LINEAR_INDEX_X,this._linearLimitSpring.x),this.setSpring(h.MOTION_LINEAR_INDEX_Y,this._linearLimitSpring.y),this.setSpring(h.MOTION_LINEAR_INDEX_Z,this._linearLimitSpring.z),this.setSpring(h.MOTION_ANGULAR_INDEX_X,this._angularLimitSpring.x),this.setSpring(h.MOTION_ANGULAR_INDEX_Y,this._angularLimitSpring.y),this.setSpring(h.MOTION_ANGULAR_INDEX_Z,this._angularLimitSpring.z),this.setBounce(h.MOTION_LINEAR_INDEX_X,this._linearBounce.x),this.setBounce(h.MOTION_LINEAR_INDEX_Y,this._linearBounce.y),this.setBounce(h.MOTION_LINEAR_INDEX_Z,this._linearBounce.z),this.setBounce(h.MOTION_ANGULAR_INDEX_X,this._angularBounce.x),this.setBounce(h.MOTION_ANGULAR_INDEX_Y,this._angularBounce.y),this.setBounce(h.MOTION_ANGULAR_INDEX_Z,this._angularBounce.z),this.setDamping(h.MOTION_LINEAR_INDEX_X,this._linearDamp.x),this.setDamping(h.MOTION_LINEAR_INDEX_Y,this._linearDamp.y),this.setDamping(h.MOTION_LINEAR_INDEX_Z,this._linearDamp.z),this.setDamping(h.MOTION_ANGULAR_INDEX_X,this._angularDamp.x),this.setDamping(h.MOTION_ANGULAR_INDEX_Y,this._angularDamp.y),this.setDamping(h.MOTION_ANGULAR_INDEX_Z,this._angularDamp.z),this.setFrames(),this.setEquilibriumPoint(0,0)}_onAdded(){super._onAdded()}_onEnable(){this._btConstraint&&(super._onEnable(),this._btConstraint&&n.a._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0))}_onDisable(){super._onDisable(),this.connectedBody||this._removeFromSimulation(),this._btConstraint&&n.a._bullet.btTypedConstraint_setEnabled(this._btConstraint,!1)}_parse(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super._parse(t),this._axis.fromArray(t.axis),this._secondaryAxis.fromArray(t.secondaryAxis);var i=t.linearLimit;this._minLinearLimit.setValue(-i,-i,-i),this._maxLinearLimit.setValue(i,i,i);var a=t.linearLimitSpring;this._linearLimitSpring.setValue(a,a,a);var r=t.linearLimitDamper;this._linearDamp.setValue(r,r,r);var s=t.linearLimitBounciness;this._linearBounce.setValue(s,s,s);var n=t.lowAngularXLimit,o=t.highAngularXLimit,l=t.angularYLimit,h=t.angularZLimit;this._minAngularLimit.setValue(n,-l,-h),this._maxAngularLimit.setValue(o,l,h);var _=t.highAngularXLimitBounciness,c=t.angularYLimitBounciness,d=t.angularZLimitBounciness;this._angularBounce.setValue(_,c,d);var u=t.angularXLimitSpring,f=t.angularYZLimitSpring;this._angularLimitSpring.setValue(u,f,f);var m=t.angularXLimitDamper,p=t.angularYZLimitDamper;this._angularDamp.setValue(m,p,p),this.XMotion=t.xMotion,this.YMotion=t.yMotion,this.ZMotion=t.zMotion,this.angularXMotion=t.angularXMotion,this.angularYMotion=t.angularYMotion,this.angularZMotion=t.angularZMotion,-1!=t.rigidbodyID&&-1!=t.connectRigidbodyID&&(e.component.push(this),e.data.push(t)),void 0!=t.breakForce&&(this.breakForce=t.breakForce),void 0!=t.breakTorque&&(this.breakTorque=t.breakTorque)}_parseInteractive(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var i=e[t.rigidbodyID].getComponent(l.a),a=e[t.connectRigidbodyID].getComponent(l.a);this.ownBody=i,this.connectedBody=a}_onDestroy(){super._onDestroy()}_cloneTo(t){}}e.a=h,r()(h,"CONFIG_MOTION_TYPE_LOCKED",0),r()(h,"CONFIG_MOTION_TYPE_LIMITED",1),r()(h,"CONFIG_MOTION_TYPE_FREE",2),r()(h,"MOTION_LINEAR_INDEX_X",0),r()(h,"MOTION_LINEAR_INDEX_Y",1),r()(h,"MOTION_LINEAR_INDEX_Z",2),r()(h,"MOTION_ANGULAR_INDEX_X",3),r()(h,"MOTION_ANGULAR_INDEX_Y",4),r()(h,"MOTION_ANGULAR_INDEX_Z",5),r()(h,"RO_XYZ",0),r()(h,"RO_XZY",1),r()(h,"RO_YXZ",2),r()(h,"RO_YZX",3),r()(h,"RO_ZXY",4),r()(h,"RO_ZYX",5)}]);